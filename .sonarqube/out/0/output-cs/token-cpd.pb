Ù
IC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str 2
)2 3
]3 4
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str 4
)4 5
]5 6
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
["" 
assembly"" 	
:""	 

AssemblyVersion"" 
("" 
$str"" $
)""$ %
]""% &
[## 
assembly## 	
:##	 

AssemblyFileVersion## 
(## 
$str## (
)##( )
]##) *≤
QC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\SancionesEmpleadoMostrar.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class $
SancionesEmpleadoMostrar )
{		 
public

 
string

 

idEmpleado

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
string 
titulo 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
DateTime 
dateRegister $
{$ %
get& )
;) *
set+ .
;. /
}0 1
public $
SancionesEmpleadoMostrar '
(' (
)( )
{ 	
} 	
public $
SancionesEmpleadoMostrar '
(' (
string( .

idEmpleado/ 9
,9 :
string; A
tituloB H
,H I
stringJ P
descriptionQ \
,\ ]
DateTime^ f
dateRegisterg s
)s t
{ 	
this 
. 

idEmpleado 
= 

idEmpleado (
;( )
this 
. 
titulo 
= 
titulo  
;  !
this 
. 
description 
= 
description *
;* +
this 
. 
dateRegister 
= 
dateRegister  ,
;, -
} 	
} 
} û
BC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\Sanciones.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public		 

class		 
	Sanciones		 
{

 
[ 	
Display	 
( 
Name 
= 
$str  
)  !
]! "
[ 	
DataType	 
( 
DataType 
. 
Text 
)  
]  !
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
Required	 
( 
ErrorMessage 
=  
$str! <
)< =
]= >
public 
string 
title 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Display	 
( 
Name 
= 
$str %
)% &
]& '
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
DataType	 
( 
DataType 
. 
Text 
)  
]  !
[ 	
Required	 
( 
ErrorMessage 
=  
$str! <
)< =
]= >
public 
string 
description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
	Sanciones 
( 
) 
{ 	
} 	
public 
	Sanciones 
( 
string  
title! &
,& '
string( .
description/ :
): ;
{ 	
this 
. 
title 
= 
title 
; 
this 
. 
description 
= 
description *
;* +
}   	
}!! 
}"" Œ

DC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\ReportDates.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public		 

class		 
ReportDates		 
{

 
[ 	
Display	 
( 
Name 
= 
$str )
)) *
]* +
public 
DateTime 
start 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
Display	 
( 
Name 
= 
$str %
)% &
]& '
public 
DateTime 
end 
{ 
get !
;! "
set# &
;& '
}( )
public 
ReportDates 
( 
) 
{ 	
} 	
public 
ReportDates 
( 
DateTime #
start$ )
,) *
DateTime+ 3
end4 7
)7 8
{ 	
this 
. 
start 
= 
start 
; 
this 
. 
end 
= 
end 
; 
} 	
} 
} ¢(
FC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\OwnerAuxiliar.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{		 
public

 

class

 
OwnerAuxiliar

 
{ 
public 
OwnerAuxiliar 
( 
) 
{ 	
} 	
public 
OwnerAuxiliar 
( 
string #
nit$ '
,' (
string) /
doc0 3
)3 4
{ 	
this 
. 
nit 
= 
nit 
; 
this 
. 
doc 
= 
doc 
; 
} 	
[ 	
Display	 
( 
Name 
= 
$str 
) 
] 
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 8
)8 9
]9 :
public 
string 
nit 
{ 
get 
;  
set! $
;$ %
}& '
[ 	
Display	 
( 
Name 
= 
$str #
)# $
]$ %
[ 	
DataType	 
( 
DataType 
. 
Url 
) 
]  
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
Required	 
( 
ErrorMessage 
=  
$str! >
)> ?
]? @
public   
string   
doc   
{   
get   
;    
set  ! $
;  $ %
}  & '
[!! 	
Display!!	 
(!! 
Name!! 
=!! 
$str!!  
)!!  !
]!!! "
["" 	
	MinLength""	 
("" 
$num"" 
)"" 
]"" 
[## 	
	MaxLength##	 
(## 
$num## 
)## 
]## 
[$$ 	
DataType$$	 
($$ 
DataType$$ 
.$$ 
Text$$ 
)$$  
]$$  !
[%% 	
Required%%	 
(%% 
ErrorMessage%% 
=%%  
$str%%! <
)%%< =
]%%= >
public&& 
string&& 
name&& 
{&& 
get&&  
;&&  !
set&&" %
;&&% &
}&&' (
['' 	
Display''	 
('' 
Name'' 
='' 
$str'' "
)''" #
]''# $
[(( 	
	MinLength((	 
((( 
$num(( 
)(( 
](( 
[)) 	
	MaxLength))	 
()) 
$num)) 
))) 
])) 
[** 	
DataType**	 
(** 
DataType** 
.** 
Text** 
)**  
]**  !
[++ 	
Required++	 
(++ 
ErrorMessage++ 
=++  
$str++! >
)++> ?
]++? @
public,, 
string,, 
lastname,, 
{,,  
get,,! $
;,,$ %
set,,& )
;,,) *
},,+ ,
[-- 	
Display--	 
(-- 
Name-- 
=-- 
$str-- "
)--" #
]--# $
[.. 	
	MinLength..	 
(.. 
$num.. 
).. 
].. 
[// 	
	MaxLength//	 
(// 
$num// 
)// 
]// 
[00 	
DataType00	 
(00 
DataType00 
.00 
PhoneNumber00 &
)00& '
]00' (
[11 	
Required11	 
(11 
ErrorMessage11 
=11  
$str11! >
)11> ?
]11? @
public22 
string22 
phone22 
{22 
get22 !
;22! "
set22# &
;22& '
}22( )
public44 
OwnerAuxiliar44 
(44 
string44 #
nit44$ '
,44' (
string44) /
doc440 3
,443 4
string445 ;
name44< @
,44@ A
string44B H
lastname44I Q
,44Q R
string44S Y
phone44Z _
)44_ `
:44a b
this44c g
(44g h
nit44h k
,44k l
doc44m p
)44p q
{55 	
this66 
.66 
name66 
=66 
name66 
;66 
this77 
.77 
lastname77 
=77 
lastname77 $
;77$ %
this88 
.88 
phone88 
=88 
phone88 
;88 
}99 	
}:: 
};; ¬#
IC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MuestraSearchMap.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public		 

class		 
MuestraSearchMap		 !
{

 
[ 	
Display	 
( 
Name 
= 
$str 
)  
]  !
public 
string 
nameLine 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Display	 
( 
Name 
= 
$str 
) 
] 
public 
string 
description !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Display	 
( 
Name 
= 
$str  
)  !
]! "
public 
decimal 
price 
{ 
get "
;" #
set$ '
;' (
}) *
public 
decimal 
[ 
] 

StartPoint #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
decimal 
[ 
] 
EndPoint !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
List 
< 
decimal 
[ 
] 
> 
IntermediatePoints 1
{2 3
get4 7
;7 8
set9 <
;< =
}> ?
public 
List 
< 
string 
[ 
] 
> #
IntermediateCheckpoints 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
public 
List 
< 
string 
[ 
] 
> 
NameCheckpoint ,
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
public 
List 
< !
CheckpointInSearchMap )
>) *
ultCheckpoints+ 9
{9 :
get; >
;> ?
set@ C
;C D
}E F
public 
MuestraSearchMap 
(  
)  !
{ 	
} 	
public 
MuestraSearchMap 
(  
string  &
nameLine' /
,/ 0
string1 7
description8 C
,C D
decimalE L
priceM R
,R S
decimalT [
[[ \
]\ ]

startPoint^ h
,h i
decimalj q
[q r
]r s
endPointt |
,| }
List	~ Ç
<
Ç É
decimal
É ä
[
ä ã
]
ã å
>
å ç 
intermediatePoints
é †
,
† °
List
¢ ¶
<
¶ ß
string
ß ≠
[
≠ Æ
]
Æ Ø
>
Ø ∞%
intermediateCheckpoints
± »
,
» …
List
  Œ
<
Œ œ
string
œ ’
[
’ ÷
]
÷ ◊
>
◊ ÿ
nameCheckpoint
Ÿ Á
,
Á Ë
List
È Ì
<
Ì Ó#
CheckpointInSearchMap
Ó É
>
É Ñ
ultCheckpoints
Ö ì
)
ì î
{ 	
this 
. 
nameLine 
= 
nameLine $
;$ %
this 
. 
description 
= 
description *
;* +
this   
.   
price   
=   
price   
;   

StartPoint!! 
=!! 

startPoint!! #
;!!# $
EndPoint"" 
="" 
endPoint"" 
;""  
IntermediatePoints## 
=##  
intermediatePoints##! 3
;##3 4#
IntermediateCheckpoints$$ #
=$$$ %#
intermediateCheckpoints$$& =
;$$= >
NameCheckpoint%% 
=%% 
nameCheckpoint%% +
;%%+ ,
this&& 
.&& 
ultCheckpoints&& 
=&&  !
ultCheckpoints&&" 0
;&&0 1
}'' 	
}(( 
})) ÷%
JC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MuestraRutasMapas.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public		 

class		 
MuestraRutasMapas		 "
{

 
public 
List 
< 
RutasMostrar  
>  !
ListRutasMostrar" 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
public 
List 
< 
ParadasMostrar "
>" #
ListParadasMostrar$ 6
{7 8
get9 <
;< =
set> A
;A B
}C D
public 
int 

NumeroRuta 
{ 
get  #
;# $
set% (
;( )
}* +
public 
List 
< 
BloqueosMostrar #
># $
ListBloqueosMostrar% 8
{9 :
get; >
;> ?
set@ C
;C D
}E F
public 
MuestraRutasMapas  
(  !
)! "
{ 	
} 	
public 
MuestraRutasMapas  
(  !
List! %
<% &
RutasMostrar& 2
>2 3
listRutasMostrar4 D
,D E
ListF J
<J K
ParadasMostrarK Y
>Y Z
listParadasMostrar[ m
,m n
into r

numeroRutas }
,} ~
List	 É
<
É Ñ
BloqueosMostrar
Ñ ì
>
ì î!
listBloqueosMostrar
ï ®
)
® ©
{ 	
ListRutasMostrar 
= 
listRutasMostrar /
;/ 0
ListParadasMostrar 
=  
listParadasMostrar! 3
;3 4

NumeroRuta 
= 

numeroRuta #
;# $
ListBloqueosMostrar 
=  !
listBloqueosMostrar" 5
;5 6
} 	
public 
double &
CalcularDistanciaHaversine 0
(0 1
decimal1 8
lat19 =
,= >
decimal? F
lon1G K
,K L
decimalM T
lat2U Y
,Y Z
decimal[ b
lon2c g
)g h
{ 	
const 
double 
RadioTierra $
=% &
$num' +
;+ ,
double   
dLat   
=   
(   
double   !
)  ! "
(  " #
lat2  # '
-  ( )
lat1  * .
)  . /
*  0 1
Math  2 6
.  6 7
PI  7 9
/  : ;
$num  < A
;  A B
double!! 
dLon!! 
=!! 
(!! 
double!! !
)!!! "
(!!" #
lon2!!# '
-!!( )
lon1!!* .
)!!. /
*!!0 1
Math!!2 6
.!!6 7
PI!!7 9
/!!: ;
$num!!< A
;!!A B
double## 
a## 
=## 
Math## 
.## 
Sin## 
(##  
dLat##  $
/##% &
$num##' (
)##( )
*##* +
Math##, 0
.##0 1
Sin##1 4
(##4 5
dLat##5 9
/##: ;
$num##< =
)##= >
+##? @
Math$$ 
.$$ 
Cos$$ 
($$  
($$  !
double$$! '
)$$' (
lat1$$( ,
*$$- .
Math$$/ 3
.$$3 4
PI$$4 6
/$$7 8
$num$$9 >
)$$> ?
*$$@ A
Math$$B F
.$$F G
Cos$$G J
($$J K
($$K L
double$$L R
)$$R S
lat2$$S W
*$$X Y
Math$$Z ^
.$$^ _
PI$$_ a
/$$b c
$num$$d i
)$$i j
*$$k l
Math%% 
.%% 
Sin%% 
(%%  
dLon%%  $
/%%% &
$num%%' (
)%%( )
*%%* +
Math%%, 0
.%%0 1
Sin%%1 4
(%%4 5
dLon%%5 9
/%%: ;
$num%%< =
)%%= >
;%%> ?
double&& 
c&& 
=&& 
$num&& 
*&& 
Math&& 
.&&  
Atan2&&  %
(&&% &
Math&&& *
.&&* +
Sqrt&&+ /
(&&/ 0
a&&0 1
)&&1 2
,&&2 3
Math&&4 8
.&&8 9
Sqrt&&9 =
(&&= >
$num&&> ?
-&&@ A
a&&B C
)&&C D
)&&D E
;&&E F
return'' 
RadioTierra'' 
*''  
c''! "
;''" #
}(( 	
})) 
}** Ó
HC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MuestraRouteMap.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
MuestraRouteMap  
{		 
public

 
decimal

 
[

 
]

 

StartPoint

 #
{

$ %
get

& )
;

) *
set

+ .
;

. /
}

0 1
public 
decimal 
[ 
] 
EndPoint !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
List 
< 
decimal 
[ 
] 
> 
IntermediatePoints 1
{2 3
get4 7
;7 8
set9 <
;< =
}> ?
public 
List 
< 
MuestraRoute  
>  !
muestraRoutes" /
{0 1
get2 5
;5 6
set7 :
;: ;
}< =
public 
List 
< 
string 
[ 
] 
> #
IntermediateCheckpoints 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
public 
int 
NumberRoute 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
MuestraRouteMap 
( 
)  
{ 	
} 	
public 
MuestraRouteMap 
( 
decimal &
[& '
]' (

startPoint) 3
,3 4
decimal5 <
[< =
]= >
endPoint? G
,G H
ListI M
<M N
decimalN U
[U V
]V W
>W X
intermediatePointsY k
,k l
Listm q
<q r
MuestraRouter ~
>~ 
muestraRoutes
Ä ç
)
ç é
{ 	

StartPoint 
= 

startPoint #
;# $
EndPoint 
= 
endPoint 
;  
IntermediatePoints 
=  
intermediatePoints! 3
;3 4
this 
. 
muestraRoutes 
=  
muestraRoutes! .
;. /
} 	
} 
} —-
EC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MuestraRoute.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{		 
public

 

class

 
MuestraRoute

 
{ 
public 
int 
idRoute 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
idLine 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
idPlace 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Display	 
( 
Name 
= 
$str #
)# $
]$ %
public 
string 
	extention 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Display	 
( 
Name 
= 
$str *
)* +
]+ ,
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
DataType	 
( 
DataType 
. 
Text 
)  
]  !
[ 	
Required	 
( 
ErrorMessage 
=  
$str! E
)E F
]F G
public 
string 
descriptionPlace &
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
[ 	
Display	 
( 
Name 
= 
$str ,
), -
]- .
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
DataType	 
( 
DataType 
. 
Text 
)  
]  !
[ 	
Required	 
( 
ErrorMessage 
=  
$str! G
)G H
]H I
public 
string 
latitud_longitud &
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
int 
? 
numberRoute 
{  !
get" %
;% &
set' *
;* +
}, -
public 
MuestraRoute 
( 
) 
{ 	
}!! 	
public## 
MuestraRoute## 
(## 
int## 
idRoute##  '
,##' (
string##) /
idLine##0 6
,##6 7
int##8 ;
idPlace##< C
,##C D
string##E K
	extention##L U
,##U V
string##W ]
descriptionPlace##^ n
,##n o
string##p v
latitud_longitud	##w á
)
##á à
{$$ 	
this%% 
.%% 
idRoute%% 
=%% 
idRoute%% "
;%%" #
this&& 
.&& 
idLine&& 
=&& 
idLine&&  
;&&  !
this'' 
.'' 
idPlace'' 
='' 
idPlace'' "
;''" #
this(( 
.(( 
	extention(( 
=(( 
	extention(( &
;((& '
this)) 
.)) 
descriptionPlace)) !
=))" #
descriptionPlace))$ 4
;))4 5
this** 
.** 
latitud_longitud** !
=**" #
latitud_longitud**$ 4
;**4 5
}++ 	
public,, 
MuestraRoute,, 
(,, 
int,, 
idRoute,,  '
,,,' (
string,,) /
idLine,,0 6
,,,6 7
int,,8 ;
idPlace,,< C
,,,C D
string,,E K
	extention,,L U
,,,U V
string,,W ]
descriptionPlace,,^ n
),,n o
{-- 	
this.. 
... 
idRoute.. 
=.. 
idRoute.. "
;.." #
this// 
.// 
idLine// 
=// 
idLine//  
;//  !
this00 
.00 
idPlace00 
=00 
idPlace00 "
;00" #
this11 
.11 
	extention11 
=11 
	extention11 &
;11& '
this22 
.22 
descriptionPlace22 !
=22" #
descriptionPlace22$ 4
;224 5
}33 	
public55 
MuestraRoute55 
(55 
int55 
idRoute55  '
,55' (
string55) /
idLine550 6
,556 7
int558 ;
idPlace55< C
,55C D
string55E K
	extention55L U
,55U V
string55W ]
descriptionPlace55^ n
,55n o
string55p v
latitud_longitud	55w á
,
55á à
int
55â å
?
55å ç
numberRoute
55é ô
)
55ô ö
:
55õ ú
this
55ù °
(
55° ¢
idRoute
55¢ ©
,
55© ™
idLine
55´ ±
,
55± ≤
idPlace
55≥ ∫
,
55∫ ª
	extention
55º ≈
,
55≈ ∆
descriptionPlace
55« ◊
,
55◊ ÿ
latitud_longitud
55Ÿ È
)
55È Í
{66 	
this77 
.77 
numberRoute77 
=77 
numberRoute77 *
;77* +
}88 	
}99 
}:: ã
FC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MuestraReport.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
MuestraReport 
{		 
public

 
int

 
idCheckpoint

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
public 
string 
name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 

idEmployee  
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
plate 
{ 
get !
;! "
set# &
;& '
}( )
public 
DateTime 
dateRegister $
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
descCheckpoint $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
MuestraReport 
( 
) 
{ 	
} 	
public 
MuestraReport 
( 
int  
idCheckpoint! -
,- .
string/ 5
name6 :
,: ;
string< B

idEmployeeC M
,M N
stringO U
plateV [
,[ \
DateTime] e
dateRegisterf r
,r s
stringt z
descCheckpoint	{ â
)
â ä
{ 	
this 
. 
idCheckpoint 
= 
idCheckpoint  ,
;, -
this 
. 
name 
= 
name 
; 
this 
. 

idEmployee 
= 

idEmployee (
;( )
this 
. 
plate 
= 
plate 
; 
this 
. 
dateRegister 
= 
dateRegister  ,
;, -
this 
. 
descCheckpoint 
=  !
descCheckpoint" 0
;0 1
} 	
} 
} Ê
EC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MuestraOwner.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{		 
public

 

class

 
MuestraOwner

 
{ 
public 
MuestraOwner 
( 
) 
{ 	
} 	
public 
MuestraOwner 
( 
string "
idLine# )
,) *
string+ 1
idPerson2 :
,: ;
string< B
nitC F
,F G
stringH N
docO R
)R S
{ 	
this 
. 
idLine 
= 
idLine  
;  !
this 
. 
idPerson 
= 
idPerson $
;$ %
this 
. 
nit 
= 
nit 
; 
this 
. 
doc 
= 
doc 
; 
} 	
public 
MuestraOwner 
( 
string "
idLine# )
,) *
string+ 1
idPerson2 :
,: ;
string< B
nitC F
,F G
stringH N
docO R
,R S
intT W
idOwnerX _
)_ `
:a b
thisc g
(g h
idLineh n
,n o
idPersonp x
,x y
nitz }
,} ~
doc	 Ç
)
Ç É
{ 	
this 
. 
idOwner 
= 
idOwner "
;" #
} 	
[ 	
Display	 
( 
Name 
= 
$str 
) 
] 
public 
string 
idLine 
{ 
get "
;" #
set$ '
;' (
}) *
[   	
Display  	 
(   
Name   
=   
$str   
)   
]   
public!! 
string!! 
idPerson!! 
{!!  
get!!! $
;!!$ %
set!!& )
;!!) *
}!!+ ,
["" 	
Display""	 
("" 
Name"" 
="" 
$str"" 
)"" 
]"" 
public## 
string## 
nit## 
{## 
get## 
;##  
set##! $
;##$ %
}##& '
[$$ 	
Display$$	 
($$ 
Name$$ 
=$$ 
$str$$ #
)$$# $
]$$$ %
public%% 
string%% 
doc%% 
{%% 
get%% 
;%%  
set%%! $
;%%$ %
}%%& '
public&& 
int&& 
idOwner&& 
{&& 
get&&  
;&&  !
set&&" %
;&&% &
}&&' (
}'' 
}(( Ã
DC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MuestraLine.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{		 
public

 

class

 
MuestraLine

 
{ 
[ 	
Display	 
( 
Name 
= 
$str 
)  
]  !
public 
string 
nameLine 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Display	 
( 
Name 
= 
$str 
) 
] 
public 
string 
description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
List 
< 
MuestraRutasMapas %
>% &
muestraRutasMapas' 8
{8 9
get: =
;= >
set? B
;B C
}D E
public 
MuestraLine 
( 
) 
{ 	
} 	
public 
MuestraLine 
( 
string !
nameLine" *
,* +
string, 2
description3 >
,> ?
List@ D
<D E
MuestraRutasMapasE V
>V W
muestraRutasMapasX i
)i j
{ 	
this 
. 
nameLine 
= 
nameLine $
;$ %
this 
. 
description 
= 
description *
;* +
this 
. 
muestraRutasMapas "
=# $
muestraRutasMapas% 6
;6 7
} 	
} 
} Ê
HC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MuestraEmployee.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{		 
public

 

class

 
MuestraEmployee

  
{ 
[ 	
Display	 
( 
Name 
= 
$str 
) 
] 
public 
string 

idEmployee  
{! "
get# &
;& '
set( +
;+ ,
}- .
[ 	
Display	 
( 
Name 
= 
$str  
)  !
]! "
public 
string 
name 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Display	 
( 
Name 
= 
$str !
)! "
]" #
public 
decimal 
salary 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
Display	 
( 
Name 
= 
$str +
)+ ,
], -
public 
string 
plate 
{ 
get !
;! "
set# &
;& '
}( )
public 
int 
idRole 
{ 
get 
;  
set! $
;$ %
}& '
[ 	
Display	 
( 
Name 
= 
$str *
)* +
]+ ,
public 
string 
description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
MuestraEmployee 
( 
)  
{ 	
} 	
public 
MuestraEmployee 
( 
string %

idEmployee& 0
,0 1
string2 8
name9 =
,= >
decimal? F
salaryG M
,M N
stringO U
plateV [
,[ \
int] `
idRolea g
,g h
stringi o
descriptionp {
){ |
{ 	
this 
. 

idEmployee 
= 

idEmployee (
;( )
this 
. 
name 
= 
name 
; 
this   
.   
salary   
=   
salary    
;    !
this!! 
.!! 
plate!! 
=!! 
plate!! 
;!! 
this"" 
."" 
idRole"" 
="" 
idRole""  
;""  !
this## 
.## 
description## 
=## 
description## *
;##* +
}$$ 	
}%% 
}&& ◊
JC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MuestraCheckpoint.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
MuestraCheckpoint "
{		 
public

 
decimal

 
[

 
]

 

StartPoint

 #
{

$ %
get

& )
;

) *
set

+ .
;

. /
}

0 1
public 
decimal 
[ 
] 
EndPoint !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
List 
< 
decimal 
[ 
] 
> 
IntermediatePoints 1
{2 3
get4 7
;7 8
set9 <
;< =
}> ?
public 
List 
< 
string 
[ 
] 
> #
IntermediateCheckpoints 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
public 
List 
< 

Checkpoint 
> 
checkpoints  +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
public 
MuestraCheckpoint  
(  !
)! "
{ 	
} 	
public 
MuestraCheckpoint  
(  !
decimal! (
[( )
]) *

startPoint+ 5
,5 6
decimal7 >
[> ?
]? @
endPointA I
,I J
ListK O
<O P
decimalP W
[W X
]X Y
>Y Z
intermediatePoints[ m
,m n
Listo s
<s t
stringt z
[z {
]{ |
>| }$
intermediateCheckpoints	~ ï
,
ï ñ
List
ó õ
<
õ ú

Checkpoint
ú ¶
>
¶ ß
checkpoints
® ≥
)
≥ ¥
{ 	

StartPoint 
= 

startPoint #
;# $
EndPoint 
= 
endPoint 
;  
IntermediatePoints 
=  
intermediatePoints! 3
;3 4#
IntermediateCheckpoints #
=$ %#
intermediateCheckpoints& =
;= >
this 
. 
checkpoints 
= 
checkpoints *
;* +
} 	
} 
} π3
>C:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\Login.cs
	namespace		 	#
ProyectoControlLineaBus		
 !
.		! "
Models		" (
{

 
public 

class 
Login 
{ 
[ 	
Display	 
( 
Name 
= 
$str "
)" #
]# $
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
Required	 
( 
ErrorMessage 
=  
$str! =
)= >
]> ?
public 
string 
Username 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
Display	 
( 
Name 
= 
$str $
)$ %
]% &
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
public 
string 
Password 
{ 
get  #
;# $
set% (
;( )
}* +
public 
Login 
( 
) 
{ 	
} 	
public 
Login 
( 
string 
username $
,$ %
string& ,
password- 5
)5 6
{ 	
Username 
= 
username 
;  
Password 
= 
password 
;  
} 	
public 
int 
? $
GetRoleSessionFromCookie ,
(, -
HttpRequestBase- <
request= D
)D E
{   	

HttpCookie"" 

authCookie"" !
=""" #
request""$ +
.""+ ,
Cookies"", 3
[""3 4
FormsAuthentication""4 G
.""G H
FormsCookieName""H W
]""W X
;""X Y
if## 
(## 

authCookie## 
!=## 
null## "
)##" #
{$$ %
FormsAuthenticationTicket&& )
ticket&&* 0
=&&1 2
FormsAuthentication&&3 F
.&&F G
Decrypt&&G N
(&&N O

authCookie&&O Y
.&&Y Z
Value&&Z _
)&&_ `
;&&` a
if(( 
((( 
ticket(( 
!=(( 
null(( "
&&((# %
!((& '
ticket((' -
.((- .
Expired((. 5
)((5 6
{)) 
var** 

cookieData** "
=**# $

Newtonsoft**% /
.**/ 0
Json**0 4
.**4 5
JsonConvert**5 @
.**@ A
DeserializeObject**A R
<**R S
dynamic**S Z
>**Z [
(**[ \
ticket**\ b
.**b c
UserData**c k
)**k l
;**l m
return-- 
(-- 
int-- 
?--  
)--  !

cookieData--! +
.--+ ,
RoleId--, 2
;--2 3
}.. 
}// 
return22 
null22 
;22 
}33 	
public44 
string44 
GetLineaFromCookie44 (
(44( )
HttpRequestBase44) 8
request449 @
)44@ A
{55 	

HttpCookie77 

authCookie77 !
=77" #
request77$ +
.77+ ,
Cookies77, 3
[773 4
FormsAuthentication774 G
.77G H
FormsCookieName77H W
]77W X
;77X Y
if88 
(88 

authCookie88 
!=88 
null88 "
)88" #
{99 %
FormsAuthenticationTicket;; )
ticket;;* 0
=;;1 2
FormsAuthentication;;3 F
.;;F G
Decrypt;;G N
(;;N O

authCookie;;O Y
.;;Y Z
Value;;Z _
);;_ `
;;;` a
if== 
(== 
ticket== 
!=== 
null== "
&&==# %
!==& '
ticket==' -
.==- .
Expired==. 5
)==5 6
{>> 
var?? 

cookieData?? "
=??# $

Newtonsoft??% /
.??/ 0
Json??0 4
.??4 5
JsonConvert??5 @
.??@ A
DeserializeObject??A R
<??R S
dynamic??S Z
>??Z [
(??[ \
ticket??\ b
.??b c
UserData??c k
)??k l
;??l m
returnBB 
(BB 
stringBB "
)BB" #

cookieDataBB# -
.BB- .
LineaBB. 3
;BB3 4
}CC 
}DD 
returnGG 
nullGG 
;GG 
}HH 	
publicII 
stringII #
GetEmployeeIdFromCookieII -
(II- .
HttpRequestBaseII. =
requestII> E
)IIE F
{JJ 	

HttpCookieKK 

authCookieKK !
=KK" #
requestKK$ +
.KK+ ,
CookiesKK, 3
[KK3 4
FormsAuthenticationKK4 G
.KKG H
FormsCookieNameKKH W
]KKW X
;KKX Y
ifLL 
(LL 

authCookieLL 
!=LL 
nullLL "
)LL" #
{MM %
FormsAuthenticationTicketNN )
ticketNN* 0
=NN1 2
FormsAuthenticationNN3 F
.NNF G
DecryptNNG N
(NNN O

authCookieNNO Y
.NNY Z
ValueNNZ _
)NN_ `
;NN` a
ifPP 
(PP 
ticketPP 
!=PP 
nullPP "
&&PP# %
!PP& '
ticketPP' -
.PP- .
ExpiredPP. 5
)PP5 6
{QQ 
varRR 

cookieDataRR "
=RR# $

NewtonsoftRR% /
.RR/ 0
JsonRR0 4
.RR4 5
JsonConvertRR5 @
.RR@ A
DeserializeObjectRRA R
<RRR S
dynamicRRS Z
>RRZ [
(RR[ \
ticketRR\ b
.RRb c
UserDataRRc k
)RRk l
;RRl m
returnSS 
(SS 
stringSS "
)SS" #

cookieDataSS# -
.SS- .

EmployeeIdSS. 8
;SS8 9
}TT 
}UU 
returnWW 
nullWW 
;WW 
}XX 	
}YY 
}ZZ ®
DC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\LineControl.cs
	namespace		 	#
ProyectoControlLineaBus		
 !
.		! "
Models		" (
{

 
public 

class 
LineControl 
{ 
[ 	
Display	 
( 
Name 
= 
$str #
)# $
]$ %
public 
string 
	extention 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
Display	 
( 
Name 
= 
$str 
)  
]  !
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
DataType	 
( 
DataType 
. 
Text 
)  
]  !
[ 	
Required	 
( 
ErrorMessage 
=  
$str! G
)G H
]H I
public 
string 
nameLine 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
Nullable 
< 
decimal 
>  
price! &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
description !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Display	 
( 
Name 
= 
$str 
) 
]  
[ 	
DataType	 
( 
DataType 
. 
EmailAddress '
)' (
]( )
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 9
)9 :
]: ;
public 
string 
email 
{ 
get !
;! "
set# &
;& '
}( )
public 
LineControl 
( 
) 
{ 	
}   	
public"" 
LineControl"" 
("" 
string"" !
	extention""" +
,""+ ,
string""- 3
nameLine""4 <
,""< =
decimal""> E
?""E F
price""G L
,""L M
string""N T
description""U `
,""` a
int""b e
?""e f
status""g m
,""m n
string""o u
email""v {
)""{ |
{## 	
this$$ 
.$$ 
	extention$$ 
=$$ 
	extention$$ &
;$$& '
this%% 
.%% 
nameLine%% 
=%% 
nameLine%% $
;%%$ %
this&& 
.&& 
price&& 
=&& 
price&& 
;&& 
this'' 
.'' 
description'' 
='' 
description'' *
;''* +
this(( 
.(( 
email(( 
=(( 
email(( 
;(( 
})) 	
}++ 
},, ﬂ6
GC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\EmployeeChofer.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public		 

class		 
EmployeeChofer		 
{

 
[ 	
Display	 
( 
Name 
= 
$str 
) 
] 
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
DataType	 
( 
DataType 
. 
Text 
)  
]  !
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 8
)8 9
]9 :
public 
string 

idEmployee  
{! "
get# &
;& '
set( +
;+ ,
}- .
[ 	
Display	 
( 
Name 
= 
$str  
)  !
]! "
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
DataType	 
( 
DataType 
. 
Text 
)  
]  !
[ 	
Required	 
( 
ErrorMessage 
=  
$str! <
)< =
]= >
public 
string 
name 
{ 
get 
;  
set! $
;$ %
}& '
[ 	
Display	 
( 
Name 
= 
$str "
)" #
]# $
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
DataType	 
( 
DataType 
. 
Text 
)  
]  !
[ 	
Required	 
( 
ErrorMessage 
=  
$str! >
)> ?
]? @
public 
string 
lastname 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Display	 
( 
Name 
= 
$str ,
), -
]- .
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[   	
DataType  	 
(   
DataType   
.   
Text   
)    
]    !
[!! 	
Required!!	 
(!! 
ErrorMessage!! 
=!!  
$str!!! H
)!!H I
]!!I J
public"" 
string"" 
plate"" 
{"" 
get"" !
;""! "
set""# &
;""& '
}""( )
[## 	
Display##	 
(## 
Name## 
=## 
$str## !
)##! "
]##" #
[$$ 	
DataType$$	 
($$ 
DataType$$ 
.$$ 
Currency$$ #
)$$# $
]$$$ %
[%% 	
Required%%	 
(%% 
ErrorMessage%% 
=%%  
$str%%! =
)%%= >
]%%> ?
public&& 
decimal&& 
salary&& 
{&& 
get&&  #
;&&# $
set&&% (
;&&( )
}&&* +
['' 	
Display''	 
('' 
Name'' 
='' 
$str''  
)''  !
]''! "
[(( 	
DataType((	 
((( 
DataType(( 
.(( 
EmailAddress(( '
)((' (
]((( )
[)) 	
Required))	 
()) 
ErrorMessage)) 
=))  
$str))! ;
))); <
]))< =
public** 
string** 
email** 
{** 
get** !
;**! "
set**# &
;**& '
}**( )
public++ 
EmployeeChofer++ 
(++ 
)++ 
{,, 	
}.. 	
public00 
EmployeeChofer00 
(00 
string00 $

idEmployee00% /
,00/ 0
string001 7
name008 <
,00< =
string00> D
lastname00E M
,00M N
string00O U
plate00V [
,00[ \
decimal00] d
salary00e k
)00k l
{11 	
this22 
.22 

idEmployee22 
=22 

idEmployee22 (
;22( )
this33 
.33 
name33 
=33 
name33 
;33 
this44 
.44 
lastname44 
=44 
lastname44 $
;44$ %
this55 
.55 
plate55 
=55 
plate55 
;55 
this66 
.66 
salary66 
=66 
salary66  
;66  !
}77 	
public88 
EmployeeChofer88 
(88 
string88 $

idEmployee88% /
,88/ 0
string881 7
name888 <
,88< =
string88> D
lastname88E M
,88M N
string88O U
plate88V [
)88[ \
{99 	
this:: 
.:: 

idEmployee:: 
=:: 

idEmployee:: (
;::( )
this;; 
.;; 
name;; 
=;; 
name;; 
;;; 
this<< 
.<< 
lastname<< 
=<< 
lastname<< $
;<<$ %
this== 
.== 
plate== 
=== 
plate== 
;== 
}>> 	
public@@ 
EmployeeChofer@@ 
(@@ 
string@@ $

idEmployee@@% /
,@@/ 0
string@@1 7
name@@8 <
,@@< =
string@@> D
lastname@@E M
,@@M N
string@@O U
plate@@V [
,@@[ \
decimal@@] d
salary@@e k
,@@k l
string@@m s
email@@t y
)@@y z
:@@{ |
this	@@} Å
(
@@Å Ç

idEmployee
@@Ç å
,
@@å ç
name
@@é í
,
@@í ì
lastname
@@î ú
,
@@ú ù
plate
@@û £
,
@@£ §
salary
@@• ´
)
@@´ ¨
{AA 	
thisBB 
.BB 
emailBB 
=BB 
emailBB 
;BB 
}CC 	
}DD 
}EE Ö
HC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\LayoutViewModel.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
LayoutViewModel  
{		 
public

 
int

 
?

 
RoleSession

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
public 
string 

EmployeeId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
Linea 
{ 
get !
;! "
set# &
;& '
}( )
} 
} ß]
HC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\EmployeeControl.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
EmployeeControl  
{ 
[ 	
Display	 
( 
Name 
= 
$str 
) 
] 
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
DataType	 
( 
DataType 
. 
Text 
)  
]  !
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 7
)7 8
]8 9
public 
string 

idEmployee  
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
Display	 
( 
Name 
= 
$str !
)! "
]" #
[ 	
DataType	 
( 
DataType 
. 
Currency #
)# $
]$ %
public 
decimal 
salary 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
Display	 
( 
Name 
= 
$str  
)  !
]! "
[ 	
DataType	 
( 
DataType 
. 
EmailAddress '
)' (
]( )
[ 	
Required	 
( 
ErrorMessage 
=  
$str! ;
); <
]< =
public 
string 
email 
{ 
get !
;! "
set# &
;& '
}( )
public 
int 
idCheckpoint 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
Display	 
( 
Name 
= 
$str  
)  !
]! "
[ 	
	MinLength	 
( 
$num 
) 
] 
[   	
	MaxLength  	 
(   
$num   
)   
]   
[!! 	
DataType!!	 
(!! 
DataType!! 
.!! 
Text!! 
)!!  
]!!  !
["" 	
Required""	 
("" 
ErrorMessage"" 
=""  
$str""! ;
)""; <
]""< =
public## 
string## 
name## 
{## 
get##  
;##  !
set##" %
;##% &
}##' (
[$$ 	
Display$$	 
($$ 
Name$$ 
=$$ 
$str$$ "
)$$" #
]$$# $
[%% 	
	MinLength%%	 
(%% 
$num%% 
)%% 
]%% 
[&& 	
	MaxLength&&	 
(&& 
$num&& 
)&& 
]&& 
['' 	
DataType''	 
('' 
DataType'' 
.'' 
Text'' 
)''  
]''  !
[(( 	
Required((	 
((( 
ErrorMessage(( 
=((  
$str((! =
)((= >
]((> ?
public)) 
string)) 
lastname)) 
{))  
get))! $
;))$ %
set))& )
;))) *
}))+ ,
public** 

Checkpoint** 

checkpoint** $
{**% &
get**' *
;*** +
set**, /
;**/ 0
}**1 2
public++ 
EmployeeControl++ 
(++ 
)++  
{,, 	
}.. 	
public00 
EmployeeControl00 
(00 
string00 %

idEmployee00& 0
,000 1
decimal002 9
salary00: @
,00@ A
string00B H
email00I N
,00N O
int00P S
idCheckpoint00T `
,00` a
string00b h
name00i m
,00m n
string00o u
lastname00v ~
,00~ 

Checkpoint
00Ä ä

checkpoint
00ã ï
)
00ï ñ
:
00ó ò
this
00ô ù
(
00ù û

idEmployee
00û ®
,
00® ©
salary
00™ ∞
,
00∞ ±
email
00≤ ∑
,
00∑ ∏
idCheckpoint
00π ≈
)
00≈ ∆
{11 	
this22 
.22 
name22 
=22 
name22 
;22 
this33 
.33 
lastname33 
=33 
lastname33 $
;33$ %
this44 
.44 

checkpoint44 
=44 

checkpoint44 (
;44( )
}55 	
public77 
EmployeeControl77 
(77 
string77 %

idEmployee77& 0
,770 1
decimal772 9
salary77: @
,77@ A
string77B H
email77I N
,77N O
int77P S
idCheckpoint77T `
)77` a
{88 	
this99 
.99 

idEmployee99 
=99 

idEmployee99 (
;99( )
this:: 
.:: 
salary:: 
=:: 
salary::  
;::  !
this;; 
.;; 
email;; 
=;; 
email;; 
;;; 
this<< 
.<< 
idCheckpoint<< 
=<< 
idCheckpoint<<  ,
;<<, -
}== 	
public>> 
string>> 
GenerarUsername>> %
(>>% &
string>>& ,
name>>- 1
,>>1 2
string>>3 9
lastname>>: B
)>>B C
{?? 	
User@@ 
user@@ 
=@@ 
new@@ 
User@@  
(@@  !
)@@! "
;@@" #
stringAA 
usernameAA 
=AA 
$strAA  
;AA  !
charAA" &
uAA' (
=AA) *
nameAA+ /
[AA/ 0
$numAA0 1
]AA1 2
;AA2 3
charAA4 8
lAA9 :
=AA; <
lastnameAA= E
[AAE F
$numAAF G
]AAG H
;AAH I
RandomBB 
rdmBB 
=BB 
newBB 
RandomBB #
(BB# $
)BB$ %
;BB% &
stringCC 
usernameVerCC 
=CC  
$strCC! #
;CC# $
whileDD 
(DD 
usernameDD 
==DD 
usernameVerDD *
)DD* +
{EE 
usernameFF 
=FF 
uFF 
.FF 
ToStringFF %
(FF% &
)FF& '
+FF' (
lFF) *
.FF* +
ToStringFF+ 3
(FF3 4
)FF4 5
;FF5 6
forGG 
(GG 
intGG 
iGG 
=GG 
$numGG 
;GG 
iGG  !
<GG" #
$numGG$ %
;GG% &
iGG' (
++GG( *
)GG* +
{HH 
usernameII 
=II 
usernameII '
+II( )
rdmII* -
.II- .
NextII. 2
(II2 3
$numII3 4
,II4 5
$numII6 8
)II8 9
;II9 :
}JJ 
usingKK 
(KK 
dbModelsKK 
contextKK  '
=KK( )
newKK* -
dbModelsKK. 6
(KK6 7
)KK7 8
)KK8 9
{LL 
userMM 
=MM 
contextMM "
.MM" #
UserMM# '
.MM' (
WhereMM( -
(MM- .
xMM. /
=>MM0 2
xMM3 4
.MM4 5
usernameMM5 =
.MM= >
ToStringMM> F
(MMF G
)MMG H
==MMI K
usernameMML T
)MMT U
.MMU V
FirstOrDefaultMMV d
(MMd e
)MMe f
;MMf g
}NN 
ifOO 
(OO 
userOO 
!=OO 
nullOO  
)OO  !
usernameVerOO" -
=OO. /
userOO0 4
.OO4 5
passwordOO5 =
;OO= >
}PP 
returnQQ 
usernameQQ 
.QQ 
ToUpperQQ #
(QQ# $
)QQ$ %
.QQ% &
TrimQQ& *
(QQ* +
)QQ+ ,
;QQ, -
}RR 	
publicSS 
stringSS 
GenerarPasswordSS %
(SS% &
)SS& '
{TT 	
stringUU 
passUU 
=UU 
$strUU 
;UU 
RandomVV 
rdmVV 
=VV 
newVV 
RandomVV #
(VV# $
)VV$ %
;VV% &
forWW 
(WW 
intWW 
iWW 
=WW 
$numWW 
;WW 
iWW 
<WW 
$numWW  !
;WW! "
iWW# $
++WW$ &
)WW& '
passWW( ,
=WW- .
passWW/ 3
+WW4 5
rdmWW6 9
.WW9 :
NextWW: >
(WW> ?
$numWW? @
,WW@ A
$numWWB D
)WWD E
;WWE F
returnXX 
passXX 
;XX 
}YY 	
publicZZ 
voidZZ 
EnviarCorreoZZ  
(ZZ  !
stringZZ! '
emailZZ( -
,ZZ- .
stringZZ/ 5
usernameZZ6 >
,ZZ> ?
stringZZ@ F
contraseniaZZG R
)ZZR S
{[[ 	
string\\ 

smtpServer\\ 
=\\ 
$str\\  0
;\\0 1
int]] 
smtpPort]] 
=]] 
$num]] 
;]] 
string^^ 
correoRemitente^^ "
=^^# $
$str^^% 8
;^^8 9
string__ 
contrase√±a__ 
=__ 
$str__  5
;__5 6
stringbb 
destinatariobb 
=bb  !
emailbb" '
;bb' (
stringcc 
asuntocc 
=cc 
$strcc $
;cc$ %
stringdd 
cuerpoMensajedd  
=dd! "
$strdd# U
+ddU V
usernameddW _
+dd_ `
$strdd` o
+ddo p
contraseniaddp {
;dd{ |

SmtpClientgg 
clienteSmtpgg "
=gg# $
newgg% (

SmtpClientgg) 3
(gg3 4

smtpServergg4 >
,gg> ?
smtpPortgg@ H
)ggH I
;ggI J
clienteSmtphh 
.hh 
Credentialshh #
=hh$ %
newhh& )
NetworkCredentialhh* ;
(hh; <
correoRemitentehh< K
,hhK L
contrase√±ahhM W
)hhW X
;hhX Y
clienteSmtpii 
.ii 
	EnableSslii !
=ii" #
trueii$ (
;ii( )
MailMessagell 
mensajell 
=ll  !
newll" %
MailMessagell& 1
(ll1 2
correoRemitentell2 A
,llA B
destinatariollC O
,llO P
asuntollQ W
,llW X
cuerpoMensajellY f
)llf g
;llg h
trynn 
{oo 
clienteSmtpqq 
.qq 
Sendqq  
(qq  !
mensajeqq! (
)qq( )
;qq) *
Consolerr 
.rr 
	WriteLinerr !
(rr! "
$strrr" =
)rr= >
;rr> ?
}ss 
catchtt 
(tt 
	Exceptiontt 
extt 
)tt  
{uu 
Consolevv 
.vv 
	WriteLinevv !
(vv! "
$strvv" ?
+vv@ A
exvvB D
.vvD E
MessagevvE L
)vvL M
;vvM N
}ww 
}yy 	
}zz 
}{{ ÷
AC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\EditPass.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{		 
public

 

class

 
EditPass

 
{ 
public 
EditPass 
( 
) 
{ 	
} 	
public 
EditPass 
( 
string 
password '
,' (
string) /
confirmPassword0 ?
)? @
{ 	
Password 
= 
password 
;  
ConfirmPassword 
= 
confirmPassword -
;- .
} 	
[ 	
Display	 
( 
Name 
= 
$str 5
)5 6
]6 7
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
DataType	 
( 
DataType 
. 
Password #
)# $
]$ %
[ 	
Required	 
( 
ErrorMessage 
=  
$str! ?
)? @
]@ A
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Display	 
( 
Name 
= 
$str :
): ;
]; <
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[   	
DataType  	 
(   
DataType   
.   
Password   #
)  # $
]  $ %
[!! 	
Required!!	 
(!! 
ErrorMessage!! 
=!!  
$str!!! ?
)!!? @
]!!@ A
public"" 
string"" 
ConfirmPassword"" %
{""& '
get""( +
;""+ ,
set""- 0
;""0 1
}""2 3
public## 
bool## 
IsValidString## !
(##! "
string##" (
input##) .
)##. /
{$$ 	
if%% 
(%% 
input%% 
.%% 
Length%% 
>=%% 
$num%%  !
)%%! "
{&& 
int'' 

digitCount'' 
=''  
$num''! "
;''" #
int(( 
uppercaseCount(( "
=((# $
$num((% &
;((& '
foreach)) 
()) 
char)) 
c)) 
in))  "
input))# (
)))( )
{** 
if++ 
(++ 
char++ 
.++ 
IsDigit++ $
(++$ %
c++% &
)++& '
)++' (

digitCount,, "
++,," $
;,,$ %
else-- 
if-- 
(-- 
char-- !
.--! "
IsUpper--" )
(--) *
c--* +
)--+ ,
)--, -
uppercaseCount.. &
++..& (
;..( )
}// 
if00 
(00 

digitCount00 
>=00 !
$num00" #
&&00$ &
uppercaseCount00' 5
>=006 8
$num009 :
)00: ;
return00< B
true00C G
;00G H
}11 
return22 
false22 
;22 
}33 	
}55 
}66 Û
=C:\Users\Ferna\Desktop\ProyectoControlLineaBus\Global.asax.cs
	namespace		 	#
ProyectoControlLineaBus		
 !
{

 
public 

class 
MvcApplication 
:  !
System" (
.( )
Web) ,
., -
HttpApplication- <
{ 
	protected 
void 
Application_Start (
(( )
)) *
{ 	
AreaRegistration 
. 
RegisterAllAreas -
(- .
). /
;/ 0
FilterConfig 
. !
RegisterGlobalFilters .
(. /
GlobalFilters/ <
.< =
Filters= D
)D E
;E F
RouteConfig 
. 
RegisterRoutes &
(& '

RouteTable' 1
.1 2
Routes2 8
)8 9
;9 :
BundleConfig 
. 
RegisterBundles (
(( )
BundleTable) 4
.4 5
Bundles5 <
)< =
;= >
} 	
} 
} â
NC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\CheckpointInSearchMap.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class !
CheckpointInSearchMap &
{		 
public

 
string

 

idEmployee

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
int 
idCheckpoint 
{  !
get" %
;% &
set' *
;* +
}, -
public 
DateTime 
dateRegister $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
int 
status 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
name 
{ 
get  
;  !
set" %
;% &
}' (
public 
long 
dateMin 
{ 
get  
;  !
set" %
;% &
}' (
public !
CheckpointInSearchMap $
($ %
)% &
{ 	
} 	
public !
CheckpointInSearchMap $
($ %
string% +

idEmployee, 6
,6 7
int8 ;
idCheckpoint< H
,H I
DateTimeJ R
dateRegisterS _
,_ `
inta d
statuse k
,k l
stringm s
namet x
,x y
longz ~
dateMin	 Ü
)
Ü á
{ 	
this 
. 

idEmployee 
= 

idEmployee (
;( )
this 
. 
idCheckpoint 
= 
idCheckpoint  ,
;, -
this 
. 
dateRegister 
= 
dateRegister  ,
;, -
this 
. 
status 
= 
status  
;  !
this 
. 
name 
= 
name 
; 
this 
. 
dateMin 
= 
dateMin "
;" #
} 	
} 
} ‘
FC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\AddCheckpoint.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{		 
public

 

class

 
AddCheckpoint

 
{ 
[ 	
Display	 
( 
Name 
= 
$str 4
)4 5
]5 6
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
DataType	 
( 
DataType 
. 
Text 
)  
]  !
[ 	
Required	 
( 
ErrorMessage 
=  
$str! <
)< =
]= >
public 
string 
description !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Display	 
( 
Name 
= 
$str Y
)Y Z
]Z [
public 
bool 
final 
{ 
get 
;  
set! $
;$ %
}& '
[ 	
Display	 
( 
Name 
= 
$str ,
), -
]- .
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
DataType	 
( 
DataType 
. 
Text 
)  
]  !
[ 	
Required	 
( 
ErrorMessage 
=  
$str! I
)I J
]J K
public 
string 
latitud_longitud &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
AddCheckpoint 
( 
) 
{ 	
} 	
public 
AddCheckpoint 
( 
string #
description$ /
,/ 0
bool1 5
final6 ;
); <
{   	
this!! 
.!! 
description!! 
=!! 
description!! *
;!!* +
this"" 
."" 
final"" 
="" 
final"" 
;"" 
}## 	
public%% 
AddCheckpoint%% 
(%% 
string%% #
description%%$ /
,%%/ 0
bool%%1 5
final%%6 ;
,%%; <
string%%= C
latitud_longitud%%D T
)%%T U
:%%V W
this%%X \
(%%\ ]
description%%] h
,%%h i
final%%j o
)%%o p
{&& 	
this'' 
.'' 
latitud_longitud'' !
=''" #
latitud_longitud''$ 4
;''4 5
}(( 	
})) 
}** é¥
SC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Controllers\TimeControlController.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Controllers" -
{		 
public

 

class

 !
TimeControlController

 &
:

' (

Controller

) 3
{ 
public 
ActionResult 
Index !
(! "
)" #
{ 	
try 
{ 
Login 
logi 
= 
new  
Login! &
(& '
)' (
;( )
var 

authResult 
=  
AutenticarPasosRol! 3
(3 4
$num4 5
)5 6
;6 7
if 
( 

authResult 
!= !
null" &
)& '
return( .

authResult/ 9
;9 :
string 
Linea 
= 
logi #
.# $
GetLineaFromCookie$ 6
(6 7
Request7 >
)> ?
.? @
ToString@ H
(H I
)I J
;J K
string 
Employee 
=  !
logi" &
.& '#
GetEmployeeIdFromCookie' >
(> ?
Request? F
)F G
.G H
ToStringH P
(P Q
)Q R
;R S
List 
< 
TimeControl  
>  !
timeControl" -
=. /
new0 3
List4 8
<8 9
TimeControl9 D
>D E
(E F
)F G
;G H
TimeZoneInfo 
boliviaTimeZone ,
=- .
TimeZoneInfo/ ;
.; <"
FindSystemTimeZoneById< R
(R S
$strS m
)m n
;n o
DateTime 
boliviaTime $
=% &
TimeZoneInfo' 3
.3 4
ConvertTime4 ?
(? @
DateTime@ H
.H I
UtcNowI O
,O P
boliviaTimeZoneQ `
)` a
;a b

Checkpoint 

checkpoint %
=& '
new( +

Checkpoint, 6
(6 7
)7 8
;8 9
using 
( 
dbModels 
context  '
=( )
new* -
dbModels. 6
(6 7
)7 8
)8 9

checkpoint 
=  
context! (
.( )

Checkpoint) 3
.3 4
Where4 9
(9 :
x: ;
=>< >
x? @
.@ A
idLineA G
==H J
LineaK P
&&Q S
xT U
.U V

idEmployeeV `
==a c
Employeed l
)l m
.m n
FirstOrDefaultn |
(| }
)} ~
;~ 
if 
( 

checkpoint 
!=  
null  $
)$ %
{ 
Employee 
employee %
=& '
new( +
Employee, 4
(4 5
)5 6
;6 7
using 
( 
dbModels #
context$ +
=, -
new. 1
dbModels2 :
(: ;
); <
)< =
timeControl   #
=  $ %
context  & -
.  - .
TimeControl  . 9
.  9 :
ToList  : @
(  @ A
)  A B
.  B C
Where  C H
(  H I
x  I J
=>  K M
x  N O
.  O P
idCheckpoint  P \
==  ] _

checkpoint  ` j
.  j k
idCheckpoint  k w
&&  x z
DateTime	  { É
.
  É Ñ
Parse
  Ñ â
(
  â ä
x
  ä ã
.
  ã å
dateRegister
  å ò
.
  ò ô
ToString
  ô °
(
  ° ¢
)
  ¢ £
)
  £ §
.
  § •
ToString
  • ≠
(
  ≠ Æ
$str
  Æ ∫
)
  ∫ ª
==
  º æ
boliviaTime
  ø  
.
    À
ToString
  À ”
(
  ” ‘
$str
  ‘ ‡
)
  ‡ ·
)
  · ‚
.
  ‚ „
ToList
  „ È
(
  È Í
)
  Í Î
;
  Î Ï
ViewBag!! 
.!! 
Mensaje!! #
=!!$ %
$str!!& (
;!!( )
return"" 
View"" 
(""  
timeControl""  +
)""+ ,
;"", -
}## 
ViewBag$$ 
.$$ 
Mensaje$$ 
=$$  !
$str$$" N
;$$N O
return%% 
View%% 
(%% 
)%% 
;%% 
}&& 
catch'' 
('' 
	Exception'' 
)'' 
{(( 
return)) 
RedirectToAction)) '
())' (
$str))( /
,))/ 0
$str))1 7
)))7 8
;))8 9
}** 
}++ 	
public-- 
ActionResult-- 
Create-- "
(--" #
)--# $
{.. 	
try// 
{00 
Login11 
logi11 
=11 
new11  
Login11! &
(11& '
)11' (
;11( )
var22 

authResult22 
=22  
AutenticarPasosRol22! 3
(223 4
$num224 5
)225 6
;226 7
if33 
(33 

authResult33 
!=33 !
null33" &
)33& '
return33( .

authResult33/ 9
;339 :
string44 
Linea44 
=44 
logi44 #
.44# $
GetLineaFromCookie44$ 6
(446 7
Request447 >
)44> ?
.44? @
ToString44@ H
(44H I
)44I J
;44J K
string55 
Employee55 
=55  !
logi55" &
.55& '#
GetEmployeeIdFromCookie55' >
(55> ?
Request55? F
)55F G
.55G H
ToString55H P
(55P Q
)55Q R
;55R S

Checkpoint66 

checkpoint66 %
=66& '
new66( +

Checkpoint66, 6
(666 7
)667 8
;668 9
List77 
<77 
Employee77 
>77 
em77 !
=77" #
new77$ '
List77( ,
<77, -
Employee77- 5
>775 6
(776 7
)777 8
;778 9
MuestraRutasMapas88 !
muestraRutasMapas88" 3
=884 5
new886 9
MuestraRutasMapas88: K
(88K L
)88L M
;88M N
TimeZoneInfo99 
boliviaTimeZone99 ,
=99- .
TimeZoneInfo99/ ;
.99; <"
FindSystemTimeZoneById99< R
(99R S
$str99S m
)99m n
;99n o
DateTime:: 
boliviaTime:: $
=::% &
TimeZoneInfo::' 3
.::3 4
ConvertTime::4 ?
(::? @
DateTime::@ H
.::H I
UtcNow::I O
,::O P
boliviaTimeZone::Q `
)::` a
;::a b
List;; 
<;; 
MuestraControlador;; '
>;;' (
muestraControlador;;) ;
=;;< =
new;;> A
List;;B F
<;;F G
MuestraControlador;;G Y
>;;Y Z
(;;Z [
);;[ \
;;;\ ]
int<< 
	numTicket<< 
=<< 
$num<<  !
;<<! "
DateTime<<# +
final<<, 1
=<<2 3
boliviaTime<<4 ?
;<<? @
int== 
count== 
=== 
$num== 
;== 
using>> 
(>> 
dbModels>> 
context>>  '
=>>( )
new>>* -
dbModels>>. 6
(>>6 7
)>>7 8
)>>8 9
em>>: <
=>>= >
context>>? F
.>>F G
Employee>>G O
.>>O P
Where>>P U
(>>U V
x>>V W
=>>>X Z
x>>[ \
.>>\ ]
status>>] c
!=>>d f
$num>>g h
&&>>i k
x>>l m
.>>m n
plate>>n s
!=>>t v
null>>w {
&&>>| ~
x	>> Ä
.
>>Ä Å
enabled
>>Å à
>
>>â ä
$num
>>ã å
&&
>>ç è
x
>>ê ë
.
>>ë í
idLine
>>í ò
==
>>ô õ
Linea
>>ú °
)
>>° ¢
.
>>¢ £
ToList
>>£ ©
(
>>© ™
)
>>™ ´
;
>>´ ¨
if?? 
(?? 
em?? 
==?? 
null?? 
)?? 
{@@ 
TempDataAA 
[AA 
$strAA !
]AA! "
=AA# $
$strAA% F
;AAF G
returnBB 
ViewBB 
(BB  
)BB  !
;BB! "
}CC 
usingDD 
(DD 
dbModelsDD 
contextDD  '
=DD( )
newDD* -
dbModelsDD. 6
(DD6 7
)DD7 8
)DD8 9

checkpointDD: D
=DDE F
contextDDG N
.DDN O

CheckpointDDO Y
.DDY Z
WhereDDZ _
(DD_ `
xDD` a
=>DDb d
xDDe f
.DDf g
idLineDDg m
==DDn p
LineaDDq v
&&DDw y
xDDz {
.DD{ |

idEmployee	DD| Ü
==
DDá â
Employee
DDä í
)
DDí ì
.
DDì î
FirstOrDefault
DDî ¢
(
DD¢ £
)
DD£ §
;
DD§ •
foreachEE 
(EE 
varEE 
empleadoEE %
inEE& (
emEE) +
)EE+ ,
{FF 
	numTicketGG 
=GG 
$numGG  !
;GG! "
finalHH 
=HH 
boliviaTimeHH '
;HH' (
ListII 
<II 
stringII 
>II  
retrasosII! )
=II* +
newII, /
ListII0 4
<II4 5
stringII5 ;
>II; <
(II< =
)II= >
;II> ?
ListJJ 
<JJ 
stringJJ 
>JJ  
incidenciasJJ! ,
=JJ- .
newJJ/ 2
ListJJ3 7
<JJ7 8
stringJJ8 >
>JJ> ?
(JJ? @
)JJ@ A
;JJA B
intKK 

ordenCheckKK "
=KK# $
$numKK% &
;KK& '
intLL 
choferCheckLL #
=LL$ %
$numLL& '
;LL' (
usingMM 
(MM 
dbModelsMM #
contextMM$ +
=MM, -
newMM. 1
dbModelsMM2 :
(MM: ;
)MM; <
)MM< =
{NN 
varPP 
timeControlsPP (
=PP) *
contextPP+ 2
.PP2 3
TimeControlPP3 >
.QQ 
WhereQQ "
(QQ" #
xQQ# $
=>QQ% '
xQQ( )
.QQ) *

idEmployeeQQ* 4
==QQ5 7
empleadoQQ8 @
.QQ@ A

idEmployeeQQA K
&&QQL N
xQQO P
.QQP Q
dateRegisterQQQ ]
.QQ] ^
HasValueQQ^ f
)QQf g
.RR 
AsEnumerableRR )
(RR) *
)RR* +
.SS 
OrderBySS $
(SS$ %
xSS% &
=>SS' )
MathSS* .
.SS. /
AbsSS/ 2
(SS2 3
(SS3 4
xSS4 5
.SS5 6
dateRegisterSS6 B
.SSB C
ValueSSC H
-SSI J
boliviaTimeSSK V
)SSV W
.SSW X
TotalSecondsSSX d
)SSd e
)SSe f
.TT 
ToListTT #
(TT# $
)TT$ %
;TT% &
varVV 
timeControlVV '
=VV( )
timeControlsVV* 6
.VV6 7
FirstOrDefaultVV7 E
(VVE F
)VVF G
;VVG H
varWW 
cverificationWW )
=WW* +
contextWW, 3
.WW3 4

CheckpointWW4 >
.WW> ?
WhereWW? D
(WWD E
xWWE F
=>WWG I
xWWJ K
.WWK L
idCheckpointWWL X
==WWY [
timeControlWW\ g
.WWg h
idCheckpointWWh t
)WWt u
.WWu v
FirstOrDefault	WWv Ñ
(
WWÑ Ö
)
WWÖ Ü
;
WWÜ á
intXX 
numTypeRouteXX (
=XX) *
intXX+ .
.XX. /
ParseXX/ 4
(XX4 5
cverificationXX5 B
.XXB C
numberRouteXXC N
.XXN O
ToStringXXO W
(XXW X
)XXX Y
)XXY Z
;XXZ [
ifYY 
(YY 
timeControlYY '
!=YY( *
nullYY+ /
)YY/ 0
{ZZ 
if[[ 
([[  
timeControl[[  +
.[[+ ,
dateRegister[[, 8
!=[[9 ;
null[[< @
&&[[A C
timeControl[[D O
.[[O P
	numTicket[[P Y
!=[[Z \
null[[] a
)[[a b
{\\ 
var]]  #
checkpoints]]$ /
=]]0 1
context]]2 9
.]]9 :

Checkpoint]]: D
.]]D E
Where]]E J
(]]J K
x]]K L
=>]]M O
x]]P Q
.]]Q R
idLine]]R X
==]]Y [
Linea]]\ a
&&]]b d
x]]e f
.]]f g
status]]g m
!=]]n p
$num]]q r
&&]]s u
x]]v w
.]]w x
numberRoute	]]x É
==
]]Ñ Ü
numTypeRoute
]]á ì
)
]]ì î
.
]]î ï
ToList
]]ï õ
(
]]õ ú
)
]]ú ù
;
]]ù û
var^^  #
listCheckpoint^^$ 2
=^^3 4
context^^5 <
.^^< =

Checkpoint^^= G
.^^G H
Where^^H M
(^^M N
x^^N O
=>^^P R
x^^S T
.^^T U
idLine^^U [
==^^\ ^
Linea^^_ d
&&^^e g
x^^h i
.^^i j

idEmployee^^j t
==^^u w
Employee	^^x Ä
)
^^Ä Å
.
^^Å Ç
ToList
^^Ç à
(
^^à â
)
^^â ä
;
^^ä ã
var__  #
checkpointsEnComun__$ 6
=__7 8
checkpoints__9 D
.``  !
Where``! &
(``& '
cp``' )
=>``* ,
listCheckpoint``- ;
.``; <
Any``< ?
(``? @
lc``@ B
=>``C E
lc``F H
.``H I
idCheckpoint``I U
==``V X
cp``Y [
.``[ \
idCheckpoint``\ h
)``h i
)``i j
.aa  !
FirstOrDefaultaa! /
(aa/ 0
)aa0 1
;aa1 2
ifbb  "
(bb# $
checkpointsEnComunbb$ 6
!=bb7 9
nullbb: >
)bb> ?
{cc  !
intdd$ '
statusPrimeradd( 5
=dd6 7
$numdd8 9
;dd9 :
ifee$ &
(ee' (
timeControlee( 3
.ee3 4
enableee4 :
==ee; =
$numee> ?
||ee@ B
timeControleeC N
.eeN O
enableeeO U
==eeV X
$numeeY Z
)eeZ [
statusPrimeraee\ i
=eej k
$numeel m
;eem n

Checkpointff$ .
primerCheckpointff/ ?
=ff@ A
checkpointsffB M
.ffM N
FirstOrDefaultffN \
(ff\ ]
rff] ^
=>ff_ a
rffb c
.ffc d
statusffd j
==ffk m
statusPrimeraffn {
)ff{ |
;ff| }
ifgg$ &
(gg' (
primerCheckpointgg( 8
!=gg9 ;
nullgg< @
)gg@ A
{hh$ %
checkpointsii( 3
=ii4 5
checkpointsii6 A
.jj, -
OrderByjj- 4
(jj4 5
routejj5 :
=>jj; =
muestraRutasMapasjj> O
.jjO P&
CalcularDistanciaHaversinejjP j
(jjj k
(kk0 1
decimalkk1 8
)kk8 9
primerCheckpointkk9 I
.kkI J
latitudkkJ Q
,kkQ R
(ll0 1
decimalll1 8
)ll8 9
primerCheckpointll9 I
.llI J
longitudllJ R
,llR S
routemm0 5
.mm5 6
latitudmm6 =
,mm= >
routenn0 5
.nn5 6
longitudnn6 >
)nn> ?
)nn? @
.oo, -
ToListoo- 3
(oo3 4
)oo4 5
;oo5 6
}pp$ %

checkpointqq$ .
=qq/ 0
contextqq1 8
.qq8 9

Checkpointqq9 C
.qqC D
WhereqqD I
(qqI J
xqqJ K
=>qqL N
xqqO P
.qqP Q
idLineqqQ W
==qqX Z
Lineaqq[ `
&&qqa c
xqqd e
.qqe f

idEmployeeqqf p
==qqq s
Employeeqqt |
&&qq} 
x
qqÄ Å
.
qqÅ Ç
numberRoute
qqÇ ç
==
qqé ê
numTypeRoute
qqë ù
)
qqù û
.
qqû ü
FirstOrDefault
qqü ≠
(
qq≠ Æ
)
qqÆ Ø
;
qqØ ∞
forrr$ '
(rr( )
intrr) ,
irr- .
=rr/ 0
$numrr1 2
;rr2 3
irr4 5
<rr6 7
checkpointsrr8 C
.rrC D
CountrrD I
;rrI J
irrK L
++rrL N
)rrN O
{ss$ %
counttt( -
++tt- /
;tt/ 0
ifuu( *
(uu+ ,

checkpointuu, 6
.uu6 7
idCheckpointuu7 C
==uuD F
checkpointsuuG R
[uuR S
iuuS T
]uuT U
.uuU V
idCheckpointuuV b
)uub c

ordenCheckuud n
=uuo p
countuuq v
;uuv w
ifvv( *
(vv+ ,
timeControlvv, 7
.vv7 8
idCheckpointvv8 D
==vvE G
checkpointsvvH S
[vvS T
ivvT U
]vvU V
.vvV W
idCheckpointvvW c
)vvc d
choferCheckvve p
=vvq r
countvvs x
;vvx y
}ww$ %
ifxx$ &
(xx' (
timeControlxx( 3
.xx3 4
	numTicketxx4 =
==xx> @
nullxxA E
)xxE F
{xxG H
timeControlxxI T
.xxT U
	numTicketxxU ^
=xx_ `
$numxxa b
;xxb c
	numTicketxxd m
=xxn o
$numxxp q
;xxq r
}xxs t
elseyy$ (
{yy) *
	numTicketyy+ 4
=yy5 6
(yy7 8
intyy8 ;
)yy; <
timeControlyy< G
.yyG H
	numTicketyyH Q
;yyQ R
}yyS T
ifzz$ &
(zz' (
timeControlzz( 3
.zz3 4
dateRegisterzz4 @
!=zzA C
nullzzD H
)zzH I
finalzzJ O
=zzP Q
DateTimezzR Z
.zzZ [
Parsezz[ `
(zz` a
timeControlzza l
.zzl m
dateRegisterzzm y
.zzy z
ToString	zzz Ç
(
zzÇ É
)
zzÉ Ñ
)
zzÑ Ö
;
zzÖ Ü
}{{  !
}|| 
}}} 
if~~ 
(~~ 

ordenCheck~~ &
>~~' (
choferCheck~~) 4
)~~4 5
muestraControlador .
.. /
Add/ 2
(2 3
new3 6
MuestraControlador7 I
(I J
empleadoJ R
.R S

idEmployeeS ]
,] ^
empleado_ g
.g h
plateh m
,m n
nullo s
,s t
nullu y
,y z
final	{ Ä
,
Ä Å
	numTicket
Ç ã
)
ã å
)
å ç
;
ç é
}
ÄÄ 
}
ÅÅ  
muestraControlador
ÇÇ "
=
ÇÇ# $ 
muestraControlador
ÇÇ% 7
.
ÇÇ7 8
OrderBy
ÇÇ8 ?
(
ÇÇ? @
x
ÇÇ@ A
=>
ÇÇB D
x
ÇÇE F
.
ÇÇF G
	numTicket
ÇÇG P
)
ÇÇP Q
.
ÇÇQ R
ToList
ÇÇR X
(
ÇÇX Y
)
ÇÇY Z
;
ÇÇZ [
return
ÉÉ 
View
ÉÉ 
(
ÉÉ  
muestraControlador
ÉÉ .
)
ÉÉ. /
;
ÉÉ/ 0
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
)
ÖÖ 
{
ÜÜ 
return
áá 
RedirectToAction
áá '
(
áá' (
$str
áá( /
,
áá/ 0
$str
áá1 7
)
áá7 8
;
áá8 9
}
àà 
}
ââ 	
[
åå 	
HttpPost
åå	 
]
åå 
public
çç 
ActionResult
çç 
Create
çç "
(
çç" #
string
çç# )
plate
çç* /
)
çç/ 0
{
éé 	
try
èè 
{
êê 
Login
ëë 
logi
ëë 
=
ëë 
new
ëë  
Login
ëë! &
(
ëë& '
)
ëë' (
;
ëë( )
var
íí 

authResult
íí 
=
íí   
AutenticarPasosRol
íí! 3
(
íí3 4
$num
íí4 5
)
íí5 6
;
íí6 7
if
ìì 
(
ìì 

authResult
ìì 
!=
ìì !
null
ìì" &
)
ìì& '
return
ìì( .

authResult
ìì/ 9
;
ìì9 :
string
îî 
Linea
îî 
=
îî 
logi
îî #
.
îî# $ 
GetLineaFromCookie
îî$ 6
(
îî6 7
Request
îî7 >
)
îî> ?
.
îî? @
ToString
îî@ H
(
îîH I
)
îîI J
;
îîJ K
string
ïï 
Employee
ïï 
=
ïï  !
logi
ïï" &
.
ïï& '%
GetEmployeeIdFromCookie
ïï' >
(
ïï> ?
Request
ïï? F
)
ïïF G
.
ïïG H
ToString
ïïH P
(
ïïP Q
)
ïïQ R
;
ïïR S
TimeZoneInfo
ññ 
boliviaTimeZone
ññ ,
=
ññ- .
TimeZoneInfo
ññ/ ;
.
ññ; <$
FindSystemTimeZoneById
ññ< R
(
ññR S
$str
ññS m
)
ññm n
;
ññn o
DateTime
óó 
boliviaTime
óó $
=
óó% &
TimeZoneInfo
óó' 3
.
óó3 4
ConvertTime
óó4 ?
(
óó? @
DateTime
óó@ H
.
óóH I
UtcNow
óóI O
,
óóO P
boliviaTimeZone
óóQ `
)
óó` a
;
óóa b
if
òò 
(
òò 
plate
òò 
==
òò 
null
òò !
)
òò! "
return
òò# )
RedirectToAction
òò* :
(
òò: ;
$str
òò; C
)
òòC D
;
òòD E
Employee
ôô 
em
ôô 
=
ôô 
new
ôô !
Employee
ôô" *
(
ôô* +
)
ôô+ ,
;
ôô, -
using
öö 
(
öö 
dbModels
öö 
context
öö  '
=
öö( )
new
öö* -
dbModels
öö. 6
(
öö6 7
)
öö7 8
)
öö8 9
{
õõ 
em
úú 
=
úú 
context
úú  
.
úú  !
Employee
úú! )
.
úú) *
Where
úú* /
(
úú/ 0
x
úú0 1
=>
úú2 4
x
úú5 6
.
úú6 7
plate
úú7 <
.
úú< =
ToLower
úú= D
(
úúD E
)
úúE F
.
úúF G
Trim
úúG K
(
úúK L
)
úúL M
==
úúN P
plate
úúQ V
.
úúV W
ToLower
úúW ^
(
úú^ _
)
úú_ `
.
úú` a
Trim
úúa e
(
úúe f
)
úúf g
&&
úúh j
x
úúk l
.
úúl m
idLine
úúm s
==
úút v
Linea
úúw |
)
úú| }
.
úú} ~
FirstOrDefaultúú~ å
(úúå ç
)úúç é
;úúé è
}
ùù 
if
ûû 
(
ûû 
em
ûû 
==
ûû 
null
ûû 
)
ûû 
{
üü 
TempData
†† 
[
†† 
$str
†† !
]
††! "
=
††# $
$str
††% N
;
††N O
return
°° 
View
°° 
(
°°  
)
°°  !
;
°°! "
}
¢¢ 

Checkpoint
££ 

checkpoint
££ %
=
££& '
new
££( +

Checkpoint
££, 6
(
££6 7
)
££7 8
;
££8 9
TimeControl
§§ 
time
§§  
=
§§! "
new
§§# &
TimeControl
§§' 2
(
§§2 3
)
§§3 4
;
§§4 5
TimeControl
•• 
timeAnterior
•• (
=
••) *
new
••+ .
TimeControl
••/ :
(
••: ;
)
••; <
;
••< =
using
¶¶ 
(
¶¶ 
dbModels
¶¶ 
context
¶¶  '
=
¶¶( )
new
¶¶* -
dbModels
¶¶. 6
(
¶¶6 7
)
¶¶7 8
)
¶¶8 9
{
ßß 
int
®® 
	numTicket
®® !
=
®®" #
context
®®$ +
.
®®+ ,
TimeControl
®®, 7
.
©© 
Where
©© 
(
©© 
x
©© 
=>
©© 
x
©©  !
.
©©! "
plate
©©" '
==
©©( *
plate
©©+ 0
)
©©0 1
.
™™ 
Max
™™ 
(
™™ 
x
™™ 
=>
™™ 
(
™™ 
int
™™ "
?
™™" #
)
™™# $
x
™™$ %
.
™™% &
	numTicket
™™& /
)
™™/ 0
??
™™1 3
$num
™™4 5
;
™™5 6
var
´´ 
times
´´ 
=
´´ 
context
´´  '
.
´´' (
TimeControl
´´( 3
.
´´3 4
Where
´´4 9
(
´´9 :
x
´´: ;
=>
´´< >
x
´´? @
.
´´@ A

idEmployee
´´A K
==
´´L N
em
´´O Q
.
´´Q R

idEmployee
´´R \
&&
´´] _
	numTicket
´´` i
==
´´j l
x
´´m n
.
´´n o
	numTicket
´´o x
)
´´x y
.
´´y z
ToList´´z Ä
(´´Ä Å
)´´Å Ç
;´´Ç É
var
¨¨ 

listChecks
¨¨ "
=
¨¨# $
context
¨¨% ,
.
¨¨, -

Checkpoint
¨¨- 7
.
¨¨7 8
Where
¨¨8 =
(
¨¨= >
x
¨¨> ?
=>
¨¨@ B
x
¨¨C D
.
¨¨D E
idLine
¨¨E K
==
¨¨L N
Linea
¨¨O T
&&
¨¨U W
x
¨¨X Y
.
¨¨Y Z

idEmployee
¨¨Z d
==
¨¨e g
Employee
¨¨h p
)
¨¨p q
.
¨¨q r
ToList
¨¨r x
(
¨¨x y
)
¨¨y z
;
¨¨z {
var
≠≠ 
idsCoincidentes
≠≠ '
=
≠≠( )
times
≠≠* /
.
ÆÆ 
Where
ÆÆ 
(
ÆÆ 
t
ÆÆ 
=>
ÆÆ 

listChecks
ÆÆ  *
.
ÆÆ* +
Any
ÆÆ+ .
(
ÆÆ. /
c
ÆÆ/ 0
=>
ÆÆ1 3
c
ÆÆ4 5
.
ÆÆ5 6
idCheckpoint
ÆÆ6 B
==
ÆÆC E
t
ÆÆF G
.
ÆÆG H
idCheckpoint
ÆÆH T
)
ÆÆT U
)
ÆÆU V
.
ØØ 
Select
ØØ 
(
ØØ 
t
ØØ 
=>
ØØ  
t
ØØ! "
.
ØØ" #
idCheckpoint
ØØ# /
)
ØØ/ 0
.
∞∞ 
FirstOrDefault
∞∞ #
(
∞∞# $
)
∞∞$ %
;
∞∞% &

checkpoint
±± 
=
±±  
context
±±! (
.
±±( )

Checkpoint
±±) 3
.
±±3 4
Where
±±4 9
(
±±9 :
x
±±: ;
=>
±±< >
x
±±? @
.
±±@ A
idCheckpoint
±±A M
==
±±N P
idsCoincidentes
±±Q `
&&
±±a c
x
±±d e
.
±±e f
idLine
±±f l
==
±±m o
Linea
±±p u
&&
±±v x
x
±±y z
.
±±z {

idEmployee±±{ Ö
==±±Ü à
Employee±±â ë
)±±ë í
.±±í ì
FirstOrDefault±±ì °
(±±° ¢
)±±¢ £
;±±£ §
if
≤≤ 
(
≤≤ 

checkpoint
≤≤ "
!=
≤≤# %
null
≤≤& *
)
≤≤* +
{
≥≥ 
time
¥¥ 
=
¥¥ 
context
¥¥ &
.
¥¥& '
TimeControl
¥¥' 2
.
¥¥2 3
Where
¥¥3 8
(
¥¥8 9
x
¥¥9 :
=>
¥¥; =
x
¥¥> ?
.
¥¥? @
idCheckpoint
¥¥@ L
==
¥¥M O

checkpoint
¥¥P Z
.
¥¥Z [
idCheckpoint
¥¥[ g
&&
¥¥h j
x
¥¥k l
.
¥¥l m

idEmployee
¥¥m w
==
¥¥x z
em
¥¥{ }
.
¥¥} ~

idEmployee¥¥~ à
&&¥¥â ã
	numTicket¥¥å ï
==¥¥ñ ò
x¥¥ô ö
.¥¥ö õ
	numTicket¥¥õ §
)¥¥§ •
.¥¥• ¶
FirstOrDefault¥¥¶ ¥
(¥¥¥ µ
)¥¥µ ∂
;¥¥∂ ∑
time
µµ 
.
µµ 
dateRegister
µµ )
=
µµ* +
boliviaTime
µµ, 7
;
µµ7 8
if
∂∂ 
(
∂∂ 

checkpoint
∂∂ &
.
∂∂& '
status
∂∂' -
==
∂∂. 0
$num
∂∂1 2
||
∂∂3 5

checkpoint
∂∂6 @
.
∂∂@ A
status
∂∂A G
==
∂∂H J
$num
∂∂K L
)
∂∂L M
{
∂∂N O
em
∂∂P R
.
∂∂R S
enabled
∂∂S Z
=
∂∂[ \
$num
∂∂] ^
;
∂∂^ _
context
∂∂` g
.
∂∂g h
Entry
∂∂h m
(
∂∂m n
em
∂∂n p
)
∂∂p q
.
∂∂q r
State
∂∂r w
=
∂∂x y
System∂∂z Ä
.∂∂Ä Å
Data∂∂Å Ö
.∂∂Ö Ü
Entity∂∂Ü å
.∂∂å ç
EntityState∂∂ç ò
.∂∂ò ô
Modified∂∂ô °
;∂∂° ¢
}∂∂£ §
if
∑∑ 
(
∑∑ 
	numTicket
∑∑ %
!=
∑∑& (
$num
∑∑) *
)
∑∑* +
{
∏∏ 
var
ππ 
timeControlChofer
ππ  1
=
ππ2 3
context
ππ4 ;
.
ππ; <
TimeControl
ππ< G
.
ππG H
Where
ππH M
(
ππM N
x
ππN O
=>
ππP R
x
ππS T
.
ππT U
idCheckpoint
ππU a
==
ππb d

checkpoint
ππe o
.
ππo p
idCheckpoint
ππp |
)
ππ| }
.
ππ} ~
ToListππ~ Ñ
(ππÑ Ö
)ππÖ Ü
;ππÜ á
var
∫∫ 
ticketCercano
∫∫  -
=
∫∫. /
timeControlChofer
∫∫0 A
.
∫∫A B
Where
∫∫B G
(
∫∫G H
x
∫∫H I
=>
∫∫J L
x
∫∫M N
.
∫∫N O
	numTicket
∫∫O X
<
∫∫Y Z
	numTicket
∫∫[ d
)
∫∫d e
.
∫∫e f
OrderByDescending
∫∫f w
(
∫∫w x
x
∫∫x y
=>
∫∫z |
x
∫∫} ~
.
∫∫~ 
	numTicket∫∫ à
)∫∫à â
.∫∫â ä
FirstOrDefault∫∫ä ò
(∫∫ò ô
)∫∫ô ö
;∫∫ö õ
if
ªª 
(
ªª  
ticketCercano
ªª  -
!=
ªª. 0
null
ªª1 5
)
ªª5 6
{
ºº 
timeAnterior
ΩΩ  ,
=
ΩΩ- .
context
ΩΩ/ 6
.
ΩΩ6 7
TimeControl
ΩΩ7 B
.
ΩΩB C
Where
ΩΩC H
(
ΩΩH I
x
ΩΩI J
=>
ΩΩK M
x
ΩΩN O
.
ΩΩO P
idCheckpoint
ΩΩP \
==
ΩΩ] _

checkpoint
ΩΩ` j
.
ΩΩj k
idCheckpoint
ΩΩk w
&&
ΩΩx z
x
ΩΩ{ |
.
ΩΩ| }
	numTicketΩΩ} Ü
==ΩΩá â
ticketCercanoΩΩä ó
.ΩΩó ò
	numTicketΩΩò °
)ΩΩ° ¢
.ΩΩ¢ £
FirstOrDefaultΩΩ£ ±
(ΩΩ± ≤
)ΩΩ≤ ≥
;ΩΩ≥ ¥
if
ææ  "
(
ææ# $
timeAnterior
ææ$ 0
!=
ææ1 3
null
ææ4 8
)
ææ8 9
if
øø$ &
(
øø' (
timeAnterior
øø( 4
.
øø4 5
dateRegister
øø5 A
==
øøB D
null
øøE I
)
øøI J
{
¿¿$ %
timeAnterior
¡¡( 4
.
¡¡4 5
enable
¡¡5 ;
=
¡¡< =
timeAnterior
¡¡> J
.
¡¡J K
enable
¡¡K Q
+
¡¡R S
$num
¡¡T U
;
¡¡U V
context
¬¬( /
.
¬¬/ 0
Entry
¬¬0 5
(
¬¬5 6
timeAnterior
¬¬6 B
)
¬¬B C
.
¬¬C D
State
¬¬D I
=
¬¬J K
System
¬¬L R
.
¬¬R S
Data
¬¬S W
.
¬¬W X
Entity
¬¬X ^
.
¬¬^ _
EntityState
¬¬_ j
.
¬¬j k
Modified
¬¬k s
;
¬¬s t
}
√√$ %
}
ƒƒ 
}
≈≈ 
context
∆∆ 
.
∆∆  
Entry
∆∆  %
(
∆∆% &
time
∆∆& *
)
∆∆* +
.
∆∆+ ,
State
∆∆, 1
=
∆∆2 3
System
∆∆4 :
.
∆∆: ;
Data
∆∆; ?
.
∆∆? @
Entity
∆∆@ F
.
∆∆F G
EntityState
∆∆G R
.
∆∆R S
Modified
∆∆S [
;
∆∆[ \
context
»» 
.
»»  
SaveChanges
»»  +
(
»»+ ,
)
»», -
;
»»- .
}
…… 
}
ÀÀ 
return
ÃÃ 
RedirectToAction
ÃÃ '
(
ÃÃ' (
$str
ÃÃ( 0
)
ÃÃ0 1
;
ÃÃ1 2
}
ÕÕ 
catch
ŒŒ 
(
ŒŒ 
	Exception
ŒŒ 
)
ŒŒ 
{
œœ 
return
–– 
RedirectToAction
–– '
(
––' (
$str
––( /
,
––/ 0
$str
––1 7
)
––7 8
;
––8 9
}
—— 
}
‘‘ 	
public
’’ 
ActionResult
’’  
AutenticarPasosRol
’’ .
(
’’. /
int
’’/ 2
role
’’3 7
)
’’7 8
{
÷÷ 	
if
◊◊ 
(
◊◊ 
!
◊◊ 
User
◊◊ 
.
◊◊ 
Identity
◊◊ 
.
◊◊ 
IsAuthenticated
◊◊ .
)
◊◊. /
return
◊◊0 6
RedirectToAction
◊◊7 G
(
◊◊G H
$str
◊◊H O
,
◊◊O P
$str
◊◊Q W
)
◊◊W X
;
◊◊X Y
Login
ÿÿ 
logi
ÿÿ 
=
ÿÿ 
new
ÿÿ 
Login
ÿÿ "
(
ÿÿ" #
)
ÿÿ# $
;
ÿÿ$ %
int
ŸŸ 
?
ŸŸ 
roleSession
ŸŸ 
=
ŸŸ 
logi
ŸŸ #
.
ŸŸ# $&
GetRoleSessionFromCookie
ŸŸ$ <
(
ŸŸ< =
Request
ŸŸ= D
)
ŸŸD E
;
ŸŸE F
if
⁄⁄ 
(
⁄⁄ 
roleSession
⁄⁄ 
==
⁄⁄ 
null
⁄⁄ #
||
⁄⁄$ &
roleSession
⁄⁄' 2
!=
⁄⁄3 5
role
⁄⁄6 :
)
⁄⁄: ;
return
⁄⁄< B
RedirectToAction
⁄⁄C S
(
⁄⁄S T
$str
⁄⁄T [
,
⁄⁄[ \
$str
⁄⁄] c
)
⁄⁄c d
;
⁄⁄d e
return
€€ 
null
€€ 
;
€€ 
}
‹‹ 	
public
›› 
ActionResult
›› %
OptionsPrincipalControl
›› 3
(
››3 4
)
››4 5
{
ﬁﬁ 	
try
ﬂﬂ 
{
‡‡ 
Login
·· 
logi
·· 
=
·· 
new
··  
Login
··! &
(
··& '
)
··' (
;
··( )
var
‚‚ 

authResult
‚‚ 
=
‚‚   
AutenticarPasosRol
‚‚! 3
(
‚‚3 4
$num
‚‚4 5
)
‚‚5 6
;
‚‚6 7
if
„„ 
(
„„ 

authResult
„„ 
!=
„„ !
null
„„" &
)
„„& '
return
„„( .

authResult
„„/ 9
;
„„9 :
string
‰‰ 
Linea
‰‰ 
=
‰‰ 
logi
‰‰ #
.
‰‰# $ 
GetLineaFromCookie
‰‰$ 6
(
‰‰6 7
Request
‰‰7 >
)
‰‰> ?
.
‰‰? @
ToString
‰‰@ H
(
‰‰H I
)
‰‰I J
;
‰‰J K
string
ÂÂ 

idEmployee
ÂÂ !
=
ÂÂ" #
logi
ÂÂ$ (
.
ÂÂ( )%
GetEmployeeIdFromCookie
ÂÂ) @
(
ÂÂ@ A
Request
ÂÂA H
)
ÂÂH I
.
ÂÂI J
ToString
ÂÂJ R
(
ÂÂR S
)
ÂÂS T
;
ÂÂT U
using
ÊÊ 
(
ÊÊ 
dbModels
ÊÊ 
context
ÊÊ  '
=
ÊÊ( )
new
ÊÊ* -
dbModels
ÊÊ. 6
(
ÊÊ6 7
)
ÊÊ7 8
)
ÊÊ8 9
{
ÁÁ 
var
ËË 

checkpoint
ËË "
=
ËË# $
context
ËË% ,
.
ËË, -

Checkpoint
ËË- 7
.
ËË7 8
Where
ËË8 =
(
ËË= >
x
ËË> ?
=>
ËË@ B
x
ËËC D
.
ËËD E

idEmployee
ËËE O
==
ËËP R

idEmployee
ËËS ]
)
ËË] ^
.
ËË^ _
FirstOrDefault
ËË_ m
(
ËËm n
)
ËËn o
;
ËËo p
if
ÈÈ 
(
ÈÈ 

checkpoint
ÈÈ "
.
ÈÈ" #
status
ÈÈ# )
==
ÈÈ* ,
$num
ÈÈ- .
||
ÈÈ/ 1

checkpoint
ÈÈ2 <
.
ÈÈ< =
status
ÈÈ= C
==
ÈÈD F
$num
ÈÈG H
)
ÈÈH I
return
ÍÍ 
View
ÍÍ #
(
ÍÍ# $
)
ÍÍ$ %
;
ÍÍ% &
else
ÎÎ 
return
ÎÎ 
RedirectToAction
ÎÎ  0
(
ÎÎ0 1
$str
ÎÎ1 9
,
ÎÎ9 :
$str
ÎÎ; H
)
ÎÎH I
;
ÎÎI J
}
ÏÏ 
}
ÌÌ 
catch
ÓÓ 
(
ÓÓ 
	Exception
ÓÓ 
)
ÓÓ 
{
ÔÔ 
return
 
RedirectToAction
 '
(
' (
$str
( /
,
/ 0
$str
1 7
)
7 8
;
8 9
}
ÒÒ 
}
ÚÚ 	
public
ÛÛ 
ActionResult
ÛÛ 
SalidaCreate
ÛÛ (
(
ÛÛ( )
)
ÛÛ) *
{
ÙÙ 	
try
ıı 
{
ˆˆ 
Login
˜˜ 
logi
˜˜ 
=
˜˜ 
new
˜˜  
Login
˜˜! &
(
˜˜& '
)
˜˜' (
;
˜˜( )
var
¯¯ 

authResult
¯¯ 
=
¯¯   
AutenticarPasosRol
¯¯! 3
(
¯¯3 4
$num
¯¯4 5
)
¯¯5 6
;
¯¯6 7
if
˘˘ 
(
˘˘ 

authResult
˘˘ 
!=
˘˘ !
null
˘˘" &
)
˘˘& '
return
˘˘( .

authResult
˘˘/ 9
;
˘˘9 :
string
˙˙ 
Linea
˙˙ 
=
˙˙ 
logi
˙˙ #
.
˙˙# $ 
GetLineaFromCookie
˙˙$ 6
(
˙˙6 7
Request
˙˙7 >
)
˙˙> ?
.
˙˙? @
ToString
˙˙@ H
(
˙˙H I
)
˙˙I J
;
˙˙J K
string
˚˚ 
Employee
˚˚ 
=
˚˚  !
logi
˚˚" &
.
˚˚& '%
GetEmployeeIdFromCookie
˚˚' >
(
˚˚> ?
Request
˚˚? F
)
˚˚F G
.
˚˚G H
ToString
˚˚H P
(
˚˚P Q
)
˚˚Q R
;
˚˚R S

Checkpoint
¸¸ 

checkpoint
¸¸ %
=
¸¸& '
new
¸¸( +

Checkpoint
¸¸, 6
(
¸¸6 7
)
¸¸7 8
;
¸¸8 9
List
˝˝ 
<
˝˝ 
Employee
˝˝ 
>
˝˝ 
em
˝˝ !
=
˝˝" #
new
˝˝$ '
List
˝˝( ,
<
˝˝, -
Employee
˝˝- 5
>
˝˝5 6
(
˝˝6 7
)
˝˝7 8
;
˝˝8 9
MuestraRutasMapas
˛˛ !
muestraRutasMapas
˛˛" 3
=
˛˛4 5
new
˛˛6 9
MuestraRutasMapas
˛˛: K
(
˛˛K L
)
˛˛L M
;
˛˛M N
TimeZoneInfo
ˇˇ 
boliviaTimeZone
ˇˇ ,
=
ˇˇ- .
TimeZoneInfo
ˇˇ/ ;
.
ˇˇ; <$
FindSystemTimeZoneById
ˇˇ< R
(
ˇˇR S
$str
ˇˇS m
)
ˇˇm n
;
ˇˇn o
DateTime
ÄÄ 
boliviaTime
ÄÄ $
=
ÄÄ% &
TimeZoneInfo
ÄÄ' 3
.
ÄÄ3 4
ConvertTime
ÄÄ4 ?
(
ÄÄ? @
DateTime
ÄÄ@ H
.
ÄÄH I
UtcNow
ÄÄI O
,
ÄÄO P
boliviaTimeZone
ÄÄQ `
)
ÄÄ` a
;
ÄÄa b
List
ÅÅ 
<
ÅÅ  
MuestraControlador
ÅÅ '
>
ÅÅ' ( 
muestraControlador
ÅÅ) ;
=
ÅÅ< =
new
ÅÅ> A
List
ÅÅB F
<
ÅÅF G 
MuestraControlador
ÅÅG Y
>
ÅÅY Z
(
ÅÅZ [
)
ÅÅ[ \
;
ÅÅ\ ]
int
ÇÇ 
	numTicket
ÇÇ 
=
ÇÇ 
$num
ÇÇ  !
;
ÇÇ! "
DateTime
ÇÇ# +
final
ÇÇ, 1
=
ÇÇ2 3
boliviaTime
ÇÇ4 ?
;
ÇÇ? @
using
ÉÉ 
(
ÉÉ 
dbModels
ÉÉ 
context
ÉÉ  '
=
ÉÉ( )
new
ÉÉ* -
dbModels
ÉÉ. 6
(
ÉÉ6 7
)
ÉÉ7 8
)
ÉÉ8 9
em
ÉÉ: <
=
ÉÉ= >
context
ÉÉ? F
.
ÉÉF G
Employee
ÉÉG O
.
ÉÉO P
Where
ÉÉP U
(
ÉÉU V
x
ÉÉV W
=>
ÉÉX Z
x
ÉÉ[ \
.
ÉÉ\ ]
status
ÉÉ] c
!=
ÉÉd f
$num
ÉÉg h
&&
ÉÉi k
x
ÉÉl m
.
ÉÉm n
plate
ÉÉn s
!=
ÉÉt v
null
ÉÉw {
&&
ÉÉ| ~
(ÉÉ Ä
xÉÉÄ Å
.ÉÉÅ Ç
enabledÉÉÇ â
==ÉÉä å
nullÉÉç ë
||ÉÉí î
xÉÉï ñ
.ÉÉñ ó
enabledÉÉó û
==ÉÉü °
$numÉÉ¢ £
)ÉÉ£ §
&&ÉÉ• ß
xÉÉ® ©
.ÉÉ© ™
idLineÉÉ™ ∞
==ÉÉ± ≥
LineaÉÉ¥ π
)ÉÉπ ∫
.ÉÉ∫ ª
ToListÉÉª ¡
(ÉÉ¡ ¬
)ÉÉ¬ √
;ÉÉ√ ƒ
if
ÑÑ 
(
ÑÑ 
em
ÑÑ 
==
ÑÑ 
null
ÑÑ 
)
ÑÑ 
{
ÖÖ 
TempData
ÜÜ 
[
ÜÜ 
$str
ÜÜ !
]
ÜÜ! "
=
ÜÜ# $
$str
ÜÜ% F
;
ÜÜF G
return
áá 
View
áá 
(
áá  
)
áá  !
;
áá! "
}
àà 
using
ââ 
(
ââ 
dbModels
ââ 
context
ââ  '
=
ââ( )
new
ââ* -
dbModels
ââ. 6
(
ââ6 7
)
ââ7 8
)
ââ8 9

checkpoint
ââ: D
=
ââE F
context
ââG N
.
ââN O

Checkpoint
ââO Y
.
ââY Z
Where
ââZ _
(
ââ_ `
x
ââ` a
=>
ââb d
x
ââe f
.
ââf g
idLine
ââg m
==
âân p
Linea
ââq v
&&
ââw y
x
ââz {
.
ââ{ |

idEmployeeââ| Ü
==ââá â
Employeeââä í
)ââí ì
.ââì î
FirstOrDefaultââî ¢
(ââ¢ £
)ââ£ §
;ââ§ •
if
ää 
(
ää 

checkpoint
ää 
.
ää 
status
ää %
<
ää& '
$num
ää( )
)
ää) *
return
ää+ 1
RedirectToAction
ää2 B
(
ääB C
$str
ääC J
,
ääJ K
$str
ääL R
)
ääR S
;
ääS T
foreach
ãã 
(
ãã 
var
ãã 
empleado
ãã %
in
ãã& (
em
ãã) +
)
ãã+ ,
{
åå 
	numTicket
çç 
=
çç 
$num
çç  !
;
çç! "
final
éé 
=
éé 
boliviaTime
éé '
;
éé' (
List
èè 
<
èè 
string
èè 
>
èè  
retrasos
èè! )
=
èè* +
new
èè, /
List
èè0 4
<
èè4 5
string
èè5 ;
>
èè; <
(
èè< =
)
èè= >
;
èè> ?
List
êê 
<
êê 
string
êê 
>
êê  
incidencias
êê! ,
=
êê- .
new
êê/ 2
List
êê3 7
<
êê7 8
string
êê8 >
>
êê> ?
(
êê? @
)
êê@ A
;
êêA B
using
ëë 
(
ëë 
dbModels
ëë #
context
ëë$ +
=
ëë, -
new
ëë. 1
dbModels
ëë2 :
(
ëë: ;
)
ëë; <
)
ëë< =
{
íí 
var
îî 
timeControls
îî (
=
îî) *
context
îî+ 2
.
îî2 3
TimeControl
îî3 >
.
ïï 
Where
ïï "
(
ïï" #
x
ïï# $
=>
ïï% '
x
ïï( )
.
ïï) *

idEmployee
ïï* 4
==
ïï5 7
empleado
ïï8 @
.
ïï@ A

idEmployee
ïïA K
&&
ïïL N
x
ïïO P
.
ïïP Q
dateRegister
ïïQ ]
.
ïï] ^
HasValue
ïï^ f
)
ïïf g
.
ññ 
AsEnumerable
ññ )
(
ññ) *
)
ññ* +
.
óó 
OrderBy
óó $
(
óó$ %
x
óó% &
=>
óó' )
Math
óó* .
.
óó. /
Abs
óó/ 2
(
óó2 3
(
óó3 4
x
óó4 5
.
óó5 6
dateRegister
óó6 B
.
óóB C
Value
óóC H
-
óóI J
boliviaTime
óóK V
)
óóV W
.
óóW X
TotalSeconds
óóX d
)
óód e
)
óóe f
.
òò 
ToList
òò #
(
òò# $
)
òò$ %
;
òò% &
var
öö 
timeControl
öö '
=
öö( )
timeControls
öö* 6
.
öö6 7
FirstOrDefault
öö7 E
(
ööE F
)
ööF G
;
ööG H
if
õõ 
(
õõ 
timeControl
õõ '
!=
õõ( *
null
õõ+ /
)
õõ/ 0
{
úú 
var
ùù 
cverification
ùù  -
=
ùù. /
context
ùù0 7
.
ùù7 8

Checkpoint
ùù8 B
.
ùùB C
Where
ùùC H
(
ùùH I
x
ùùI J
=>
ùùK M
x
ùùN O
.
ùùO P
idCheckpoint
ùùP \
==
ùù] _
timeControl
ùù` k
.
ùùk l
idCheckpoint
ùùl x
)
ùùx y
.
ùùy z
FirstOrDefaultùùz à
(ùùà â
)ùùâ ä
;ùùä ã
int
ûû 
numTypeRoute
ûû  ,
=
ûû- .
int
ûû/ 2
.
ûû2 3
Parse
ûû3 8
(
ûû8 9
cverification
ûû9 F
.
ûûF G
numberRoute
ûûG R
.
ûûR S
ToString
ûûS [
(
ûû[ \
)
ûû\ ]
)
ûû] ^
;
ûû^ _
if
üü 
(
üü  
timeControl
üü  +
.
üü+ ,
dateRegister
üü, 8
!=
üü9 ;
null
üü< @
&&
üüA C
timeControl
üüD O
.
üüO P
	numTicket
üüP Y
!=
üüZ \
null
üü] a
)
üüa b
{
†† 
timeControls
°°  ,
=
°°- .
context
°°/ 6
.
°°6 7
TimeControl
°°7 B
.
°°B C
Where
°°C H
(
°°H I
x
°°I J
=>
°°K M
x
°°N O
.
°°O P
	numTicket
°°P Y
==
°°Z \
timeControl
°°] h
.
°°h i
	numTicket
°°i r
&&
°°s u
x
°°v w
.
°°w x

idEmployee°°x Ç
==°°É Ö
timeControl°°Ü ë
.°°ë í

idEmployee°°í ú
)°°ú ù
.°°ù û
ToList°°û §
(°°§ •
)°°• ¶
;°°¶ ß
List
££  $
<
££$ %

Checkpoint
££% /
>
££/ 0
checkpoints
££1 <
=
££= >
context
££? F
.
££F G

Checkpoint
££G Q
.
££Q R
Where
££R W
(
££W X
x
££X Y
=>
££Z \
x
££] ^
.
££^ _
idLine
££_ e
==
££f h
Linea
££i n
&&
££o q
x
££r s
.
££s t
status
££t z
!=
££{ }
$num
££~ 
&&££Ä Ç
x££É Ñ
.££Ñ Ö
numberRoute££Ö ê
==££ë ì
numTypeRoute££î †
)££† °
.££° ¢
ToList££¢ ®
(££® ©
)££© ™
;££™ ´
if
§§  "
(
§§# $
timeControls
§§$ 0
.
§§0 1
Any
§§1 4
(
§§4 5
)
§§5 6
)
§§6 7
{
••  !
int
¶¶$ '
statusPrimera
¶¶( 5
=
¶¶6 7
$num
¶¶8 9
;
¶¶9 :
if
ßß$ &
(
ßß' (
timeControl
ßß( 3
.
ßß3 4
enable
ßß4 :
==
ßß; =
$num
ßß> ?
||
ßß@ B
timeControl
ßßC N
.
ßßN O
enable
ßßO U
==
ßßV X
$num
ßßY Z
)
ßßZ [
statusPrimera
ßß\ i
=
ßßj k
$num
ßßl m
;
ßßm n

Checkpoint
®®$ .
primerCheckpoint
®®/ ?
=
®®@ A
checkpoints
®®B M
.
®®M N
FirstOrDefault
®®N \
(
®®\ ]
r
®®] ^
=>
®®_ a
r
®®b c
.
®®c d
status
®®d j
==
®®k m
statusPrimera
®®n {
)
®®{ |
;
®®| }
List
©©$ (
<
©©( )

Checkpoint
©©) 3
>
©©3 4
checkpointsorder
©©5 E
=
©©F G
new
©©H K
List
©©L P
<
©©P Q

Checkpoint
©©Q [
>
©©[ \
(
©©\ ]
)
©©] ^
;
©©^ _
if
™™$ &
(
™™' (
primerCheckpoint
™™( 8
!=
™™9 ;
null
™™< @
)
™™@ A
{
´´$ %
checkpointsorder
¨¨( 8
=
¨¨9 :
checkpoints
¨¨; F
.
≠≠, -
OrderBy
≠≠- 4
(
≠≠4 5
route
≠≠5 :
=>
≠≠; =
muestraRutasMapas
≠≠> O
.
≠≠O P(
CalcularDistanciaHaversine
≠≠P j
(
≠≠j k
(
ÆÆ0 1
decimal
ÆÆ1 8
)
ÆÆ8 9
primerCheckpoint
ÆÆ9 I
.
ÆÆI J
latitud
ÆÆJ Q
,
ÆÆQ R
(
ØØ0 1
decimal
ØØ1 8
)
ØØ8 9
primerCheckpoint
ØØ9 I
.
ØØI J
longitud
ØØJ R
,
ØØR S
route
∞∞0 5
.
∞∞5 6
latitud
∞∞6 =
,
∞∞= >
route
±±0 5
.
±±5 6
longitud
±±6 >
)
±±> ?
)
±±? @
.
≤≤, -
ToList
≤≤- 3
(
≤≤3 4
)
≤≤4 5
;
≤≤5 6
}
≥≥$ %
timeControls
¥¥$ 0
=
¥¥1 2
timeControls
¥¥3 ?
.
¥¥? @
OrderBy
¥¥@ G
(
¥¥G H
x
¥¥H I
=>
¥¥J L
x
¥¥M N
.
¥¥N O
dateRegister
¥¥O [
)
¥¥[ \
.
¥¥\ ]
ToList
¥¥] c
(
¥¥c d
)
¥¥d e
;
¥¥e f
foreach
µµ$ +
(
µµ, -
var
µµ- 0
item
µµ1 5
in
µµ6 8
timeControls
µµ9 E
)
µµE F
{
∂∂$ %
if
∑∑( *
(
∑∑+ ,
item
∑∑, 0
.
∑∑0 1
dateRegister
∑∑1 =
==
∑∑> @
null
∑∑A E
)
∑∑E F
{
∏∏( )
var
ππ, /
check
ππ0 5
=
ππ6 7
context
ππ8 ?
.
ππ? @

Checkpoint
ππ@ J
.
ππJ K
Where
ππK P
(
ππP Q
x
ππQ R
=>
ππS U
x
ππV W
.
ππW X
idCheckpoint
ππX d
==
ππe g
item
ππh l
.
ππl m
idCheckpoint
ππm y
)
ππy z
.
ππz {
FirstOrDefaultππ{ â
(ππâ ä
)ππä ã
;ππã å
incidencias
∫∫, 7
.
∫∫7 8
Add
∫∫8 ;
(
∫∫; <
$str
∫∫< Y
+
∫∫Z [
check
∫∫\ a
.
∫∫a b
description
∫∫b m
+
∫∫m n
$str
∫∫o w
+
∫∫w x
check
∫∫x }
.
∫∫} ~
numberRoute∫∫~ â
)∫∫â ä
;∫∫ä ã
}
ªª( )
if
ºº( *
(
ºº+ ,
item
ºº, 0
.
ºº0 1
enable
ºº1 7
>
ºº8 9
$num
ºº: ;
&&
ºº< >
item
ºº? C
.
ººC D
dateRegister
ººD P
!=
ººQ S
null
ººT X
)
ººX Y
{
ΩΩ( )
var
ææ, /
check
ææ0 5
=
ææ6 7
context
ææ8 ?
.
ææ? @

Checkpoint
ææ@ J
.
ææJ K
Where
ææK P
(
ææP Q
x
ææQ R
=>
ææS U
x
ææV W
.
ææW X
idCheckpoint
ææX d
==
ææe g
item
ææh l
.
ææl m
idCheckpoint
ææm y
)
ææy z
.
ææz {
FirstOrDefaultææ{ â
(ææâ ä
)ææä ã
;ææã å
var
øø, /
timeControlChofer
øø0 A
=
øøB C
context
øøD K
.
øøK L
TimeControl
øøL W
.
øøW X
Where
øøX ]
(
øø] ^
x
øø^ _
=>
øø` b
x
øøc d
.
øød e
idCheckpoint
øøe q
==
øør t
check
øøu z
.
øøz {
idCheckpointøø{ á
)øøá à
.øøà â
ToListøøâ è
(øøè ê
)øøê ë
;øøë í
var
¿¿, /
ticketCercano
¿¿0 =
=
¿¿> ?
timeControlChofer
¿¿@ Q
.
¿¿Q R
Where
¿¿R W
(
¿¿W X
x
¿¿X Y
=>
¿¿Z \
x
¿¿] ^
.
¿¿^ _
	numTicket
¿¿_ h
>
¿¿i j
timeControl
¿¿k v
.
¿¿v w
	numTicket¿¿w Ä
)¿¿Ä Å
.¿¿Å Ç
OrderBy¿¿Ç â
(¿¿â ä
x¿¿ä ã
=>¿¿å é
x¿¿è ê
.¿¿ê ë
	numTicket¿¿ë ö
)¿¿ö õ
.¿¿õ ú
FirstOrDefault¿¿ú ™
(¿¿™ ´
)¿¿´ ¨
;¿¿¨ ≠
var
¡¡, /%
timeControlChoferLePaso
¡¡0 G
=
¡¡H I
context
¡¡J Q
.
¡¡Q R
TimeControl
¡¡R ]
.
¡¡] ^
Where
¡¡^ c
(
¡¡c d
x
¡¡d e
=>
¡¡f h
x
¡¡i j
.
¡¡j k
	numTicket
¡¡k t
==
¡¡u w
ticketCercano¡¡x Ö
.¡¡Ö Ü
	numTicket¡¡Ü è
&&¡¡ê í
x¡¡ì î
.¡¡î ï
idCheckpoint¡¡ï °
==¡¡¢ §
item¡¡• ©
.¡¡© ™
idCheckpoint¡¡™ ∂
)¡¡∂ ∑
.¡¡∑ ∏
FirstOrDefault¡¡∏ ∆
(¡¡∆ «
)¡¡« »
;¡¡» …
var
¬¬, /
chofer
¬¬0 6
=
¬¬7 8
context
¬¬9 @
.
¬¬@ A
Person
¬¬A G
.
¬¬G H
Where
¬¬H M
(
¬¬M N
x
¬¬N O
=>
¬¬P R
x
¬¬S T
.
¬¬T U
nit
¬¬U X
==
¬¬Y [%
timeControlChoferLePaso
¬¬\ s
.
¬¬s t

idEmployee
¬¬t ~
)
¬¬~ 
.¬¬ Ä
FirstOrDefault¬¬Ä é
(¬¬é è
)¬¬è ê
;¬¬ê ë
incidencias
√√, 7
.
√√7 8
Add
√√8 ;
(
√√; <
$str
√√< S
+
√√T U
chofer
√√V \
.
√√\ ]
name
√√] a
+
√√b c
$str
√√d g
+
√√h i
chofer
√√j p
.
√√p q
lastname
√√q y
+
√√z {
$str√√| Ç
+√√É Ñ
check√√Ö ä
.√√ä ã
description√√ã ñ
+√√ó ò
$str√√ô °
+√√¢ £
check√√§ ©
.√√© ™
numberRoute√√™ µ
)√√µ ∂
;√√∂ ∑
}
ƒƒ( )
if
≈≈( *
(
≈≈+ ,
item
≈≈, 0
.
≈≈0 1
dateRegister
≈≈1 =
!=
≈≈> @
null
≈≈A E
)
≈≈E F
{
∆∆( )
var
««, /
check
««0 5
=
««6 7
context
««8 ?
.
««? @

Checkpoint
««@ J
.
««J K
Where
««K P
(
««P Q
x
««Q R
=>
««S U
x
««V W
.
««W X
idCheckpoint
««X d
==
««e g
item
««h l
.
««l m
idCheckpoint
««m y
)
««y z
.
««z {
FirstOrDefault««{ â
(««â ä
)««ä ã
;««ã å
retrasos
»», 4
.
»»4 5
Add
»»5 8
(
»»8 9
$str
»»9 @
+
»»A B
check
»»C H
.
»»H I
description
»»I T
+
»»U V
$str
»»W ^
+
»»_ `
item
»»a e
.
»»e f
dateRegister
»»f r
+
»»s t
$str
»»u }
+
»»~ 
check»»Ä Ö
.»»Ö Ü
numberRoute»»Ü ë
)»»ë í
;»»í ì
}
……( )
}
  $ %
List
ÀÀ$ (
<
ÀÀ( )
TimeControl
ÀÀ) 4
>
ÀÀ4 5
orderTimeControl
ÀÀ6 F
=
ÀÀG H
new
ÀÀI L
List
ÀÀM Q
<
ÀÀQ R
TimeControl
ÀÀR ]
>
ÀÀ] ^
(
ÀÀ^ _
)
ÀÀ_ `
;
ÀÀ` a
foreach
ÃÃ$ +
(
ÃÃ, -
var
ÃÃ- 0
item
ÃÃ1 5
in
ÃÃ6 8
checkpointsorder
ÃÃ9 I
)
ÃÃI J
{
ÕÕ$ %
TimeControl
ŒŒ( 3
timeControlOrder
ŒŒ4 D
=
ŒŒE F
timeControls
ŒŒG S
.
ŒŒS T
Where
ŒŒT Y
(
ŒŒY Z
x
ŒŒZ [
=>
ŒŒ\ ^
x
ŒŒ_ `
.
ŒŒ` a
idCheckpoint
ŒŒa m
==
ŒŒn p
item
ŒŒq u
.
ŒŒu v
idCheckpointŒŒv Ç
)ŒŒÇ É
.ŒŒÉ Ñ
FirstOrDefaultŒŒÑ í
(ŒŒí ì
)ŒŒì î
;ŒŒî ï
orderTimeControl
œœ( 8
.
œœ8 9
Add
œœ9 <
(
œœ< =
timeControlOrder
œœ= M
)
œœM N
;
œœN O
}
––$ %
if
——$ &
(
——' (
timeControl
——( 3
.
——3 4
enable
——4 :
==
——; =
$num
——> ?
||
——@ B
timeControl
——C N
.
——N O
enable
——O U
==
——V X
$num
——Y Z
)
——Z [
{
““$ %
for
””( +
(
””, -
int
””- 0
i
””1 2
=
””3 4
$num
””5 6
;
””6 7
i
””8 9
<
””: ;
orderTimeControl
””< L
.
””L M
Count
””M R
-
””S T
$num
””U V
;
””V W
i
””X Y
++
””Y [
)
””[ \
{
‘‘( )
if
’’, .
(
’’/ 0
orderTimeControl
’’0 @
[
’’@ A
i
’’A B
+
’’C D
$num
’’E F
]
’’F G
.
’’G H
dateRegister
’’H T
.
’’T U
HasValue
’’U ]
&&
’’^ `
orderTimeControl
’’a q
[
’’q r
i
’’r s
]
’’s t
.
’’t u
dateRegister’’u Å
.’’Å Ç
HasValue’’Ç ä
)’’ä ã
{
÷÷, -
var
◊◊0 3
checkpointPrimer
◊◊4 D
=
◊◊E F
checkpoints
◊◊G R
.
◊◊R S
Where
◊◊S X
(
◊◊X Y
x
◊◊Y Z
=>
◊◊[ ]
x
◊◊^ _
.
◊◊_ `
status
◊◊` f
==
◊◊g i
$num
◊◊j k
&&
◊◊l n
x
◊◊o p
.
◊◊p q
idLine
◊◊q w
==
◊◊x z
Linea◊◊{ Ä
)◊◊Ä Å
.◊◊Å Ç
FirstOrDefault◊◊Ç ê
(◊◊ê ë
)◊◊ë í
;◊◊í ì
var
ÿÿ0 3
timeControlInicio
ÿÿ4 E
=
ÿÿF G
timeControls
ÿÿH T
.
ÿÿT U
Where
ÿÿU Z
(
ÿÿZ [
x
ÿÿ[ \
=>
ÿÿ] _
x
ÿÿ` a
.
ÿÿa b
idCheckpoint
ÿÿb n
==
ÿÿo q
checkpointPrimerÿÿr Ç
.ÿÿÇ É
idCheckpointÿÿÉ è
&&ÿÿê í
timeControlÿÿì û
.ÿÿû ü
	numTicketÿÿü ®
==ÿÿ© ´
xÿÿ¨ ≠
.ÿÿ≠ Æ
	numTicketÿÿÆ ∑
)ÿÿ∑ ∏
.ÿÿ∏ π
FirstOrDefaultÿÿπ «
(ÿÿ« »
)ÿÿ» …
;ÿÿ…  

Checkpoint
ŸŸ0 :
checkpoint1
ŸŸ; F
=
ŸŸG H
new
ŸŸI L

Checkpoint
ŸŸM W
(
ŸŸW X
)
ŸŸX Y
;
ŸŸY Z
double
⁄⁄0 6
minutosParaParada
⁄⁄7 H
=
⁄⁄I J
$num
⁄⁄K L
;
⁄⁄L M
double
€€0 6
medicionTime
€€7 C
=
€€D E
(
€€F G
orderTimeControl
€€G W
[
€€W X
i
€€X Y
+
€€Z [
$num
€€\ ]
]
€€] ^
.
€€^ _
dateRegister
€€_ k
.
€€k l
Value
€€l q
-
€€r s
orderTimeControl€€t Ñ
[€€Ñ Ö
i€€Ö Ü
]€€Ü á
.€€á à
dateRegister€€à î
.€€î ï
Value€€ï ö
)€€ö õ
.€€õ ú
TotalMinutes€€ú ®
;€€® ©
checkpoint1
‹‹0 ;
=
‹‹< =
checkpointsorder
‹‹> N
.
‹‹N O
Where
‹‹O T
(
‹‹T U
x
‹‹U V
=>
‹‹W Y
x
‹‹Z [
.
‹‹[ \
idCheckpoint
‹‹\ h
==
‹‹i k
orderTimeControl
‹‹l |
[
‹‹| }
i
‹‹} ~
+‹‹ Ä
$num‹‹Å Ç
]‹‹Ç É
.‹‹É Ñ
idCheckpoint‹‹Ñ ê
)‹‹ê ë
.‹‹ë í
FirstOrDefault‹‹í †
(‹‹† °
)‹‹° ¢
;‹‹¢ £
TimeSpan
››0 8
timeSpan
››9 A
=
››B C
new
››D G
TimeSpan
››H P
(
››P Q
)
››Q R
;
››R S
if
ﬁﬁ0 2
(
ﬁﬁ3 4
DateTime
ﬁﬁ4 <
.
ﬁﬁ< =
Parse
ﬁﬁ= B
(
ﬁﬁB C
timeControlInicio
ﬁﬁC T
.
ﬁﬁT U
dateRegister
ﬁﬁU a
.
ﬁﬁa b
ToString
ﬁﬁb j
(
ﬁﬁj k
)
ﬁﬁk l
)
ﬁﬁl m
.
ﬁﬁm n
	DayOfWeek
ﬁﬁn w
==
ﬁﬁx z
	DayOfWeekﬁﬁ{ Ñ
.ﬁﬁÑ Ö
	WednesdayﬁﬁÖ é
||ﬁﬁè ë
DateTimeﬁﬁí ö
.ﬁﬁö õ
Parseﬁﬁõ †
(ﬁﬁ† °!
timeControlInicioﬁﬁ° ≤
.ﬁﬁ≤ ≥
dateRegisterﬁﬁ≥ ø
.ﬁﬁø ¿
ToStringﬁﬁ¿ »
(ﬁﬁ» …
)ﬁﬁ…  
)ﬁﬁ  À
.ﬁﬁÀ Ã
	DayOfWeekﬁﬁÃ ’
==ﬁﬁ÷ ÿ
	DayOfWeekﬁﬁŸ ‚
.ﬁﬁ‚ „
Saturdayﬁﬁ„ Î
)ﬁﬁÎ Ï
{
ﬂﬂ0 1
string
‡‡4 :
[
‡‡: ;
]
‡‡; <
partes
‡‡= C
=
‡‡D E
checkpoint1
‡‡F Q
.
‡‡Q R
minArrivalMarket
‡‡R b
.
‡‡b c
Trim
‡‡c g
(
‡‡g h
)
‡‡h i
.
‡‡i j
Split
‡‡j o
(
‡‡o p
$char
‡‡p s
)
‡‡s t
;
‡‡t u
minutosParaParada
··4 E
=
··F G
(
··H I
double
··I O
.
··O P
Parse
··P U
(
··U V
partes
··V \
[
··\ ]
$num
··] ^
]
··^ _
)
··_ `
*
··a b
$num
··c e
)
··e f
+
··g h
double
··i o
.
··o p
Parse
··p u
(
··u v
partes
··v |
[
··| }
$num
··} ~
]
··~ 
)·· Ä
;··Ä Å
}
‚‚0 1
else
„„0 4
{
‰‰0 1
string
ÂÂ4 :
[
ÂÂ: ;
]
ÂÂ; <
partes
ÂÂ= C
=
ÂÂD E
checkpoint1
ÂÂF Q
.
ÂÂQ R

minArrival
ÂÂR \
.
ÂÂ\ ]
Trim
ÂÂ] a
(
ÂÂa b
)
ÂÂb c
.
ÂÂc d
Split
ÂÂd i
(
ÂÂi j
$char
ÂÂj m
)
ÂÂm n
;
ÂÂn o
minutosParaParada
ÊÊ4 E
=
ÊÊF G
(
ÊÊH I
double
ÊÊI O
.
ÊÊO P
Parse
ÊÊP U
(
ÊÊU V
partes
ÊÊV \
[
ÊÊ\ ]
$num
ÊÊ] ^
]
ÊÊ^ _
)
ÊÊ_ `
*
ÊÊa b
$num
ÊÊc e
)
ÊÊe f
+
ÊÊg h
double
ÊÊi o
.
ÊÊo p
Parse
ÊÊp u
(
ÊÊu v
partes
ÊÊv |
[
ÊÊ| }
$num
ÊÊ} ~
]
ÊÊ~ 
)ÊÊ Ä
;ÊÊÄ Å
}
ÁÁ0 1
double
ËË0 6
diferenciaMinutos
ËË7 H
=
ËËI J
medicionTime
ËËK W
-
ËËX Y
minutosParaParada
ËËZ k
;
ËËk l
int
ÈÈ0 3

diferencia
ÈÈ4 >
=
ÈÈ? @
(
ÈÈA B
int
ÈÈB E
)
ÈÈE F
Math
ÈÈF J
.
ÈÈJ K
Floor
ÈÈK P
(
ÈÈP Q
diferenciaMinutos
ÈÈQ b
)
ÈÈb c
;
ÈÈc d
var
ÍÍ0 3
check
ÍÍ4 9
=
ÍÍ: ;
checkpoints
ÍÍ< G
.
ÍÍG H
Where
ÍÍH M
(
ÍÍM N
x
ÍÍN O
=>
ÍÍP R
x
ÍÍS T
.
ÍÍT U
idCheckpoint
ÍÍU a
==
ÍÍb d
orderTimeControl
ÍÍe u
[
ÍÍu v
i
ÍÍv w
+
ÍÍx y
$num
ÍÍz {
]
ÍÍ{ |
.
ÍÍ| }
idCheckpointÍÍ} â
)ÍÍâ ä
.ÍÍä ã
FirstOrDefaultÍÍã ô
(ÍÍô ö
)ÍÍö õ
;ÍÍõ ú
if
ÎÎ0 2
(
ÎÎ3 4
minutosParaParada
ÎÎ4 E
<
ÎÎF G
medicionTime
ÎÎH T
)
ÎÎT U
{
ÏÏ0 1
incidencias
ÌÌ4 ?
.
ÌÌ? @
Add
ÌÌ@ C
(
ÌÌC D
$str
ÌÌD a
+
ÌÌb c
check
ÌÌd i
.
ÌÌi j
description
ÌÌj u
+
ÌÌv w
$str
ÌÌx 
+ÌÌÄ Å

diferenciaÌÌÇ å
+ÌÌç é
$strÌÌè ï
+ÌÌñ ó
$strÌÌò †
+ÌÌ° ¢
checkÌÌ£ ®
.ÌÌ® ©
numberRouteÌÌ© ¥
)ÌÌ¥ µ
;ÌÌµ ∂
}
ÓÓ0 1
}
ÔÔ, -
}
( )
}
ÒÒ$ %
else
ÚÚ$ (
if
ÚÚ) +
(
ÚÚ, -
timeControl
ÚÚ- 8
.
ÚÚ8 9
enable
ÚÚ9 ?
==
ÚÚ@ B
$num
ÚÚC D
||
ÚÚE G
timeControl
ÚÚH S
.
ÚÚS T
enable
ÚÚT Z
==
ÚÚ[ ]
$num
ÚÚ^ _
)
ÚÚ_ `
{
ÛÛ$ %
for
ÙÙ( +
(
ÙÙ, -
int
ÙÙ- 0
i
ÙÙ1 2
=
ÙÙ3 4
$num
ÙÙ5 6
;
ÙÙ6 7
i
ÙÙ8 9
<
ÙÙ: ;
checkpoints
ÙÙ< G
.
ÙÙG H
Count
ÙÙH M
-
ÙÙN O
$num
ÙÙP Q
;
ÙÙQ R
i
ÙÙS T
++
ÙÙT V
)
ÙÙV W
{
ıı( )
if
ˆˆ, .
(
ˆˆ/ 0
orderTimeControl
ˆˆ0 @
[
ˆˆ@ A
i
ˆˆA B
]
ˆˆB C
.
ˆˆC D
dateRegister
ˆˆD P
.
ˆˆP Q
HasValue
ˆˆQ Y
&&
ˆˆZ \
orderTimeControl
ˆˆ] m
[
ˆˆm n
i
ˆˆn o
+
ˆˆp q
$num
ˆˆr s
]
ˆˆs t
.
ˆˆt u
dateRegisterˆˆu Å
.ˆˆÅ Ç
HasValueˆˆÇ ä
)ˆˆä ã
{
˜˜, -
var
¯¯0 3
checkpointPrimer
¯¯4 D
=
¯¯E F
checkpoints
¯¯G R
.
¯¯R S
Where
¯¯S X
(
¯¯X Y
x
¯¯Y Z
=>
¯¯[ ]
x
¯¯^ _
.
¯¯_ `
status
¯¯` f
==
¯¯g i
$num
¯¯j k
&&
¯¯l n
x
¯¯o p
.
¯¯p q
idLine
¯¯q w
==
¯¯x z
Linea¯¯{ Ä
)¯¯Ä Å
.¯¯Å Ç
FirstOrDefault¯¯Ç ê
(¯¯ê ë
)¯¯ë í
;¯¯í ì
var
˘˘0 3
timeControlInicio
˘˘4 E
=
˘˘F G
timeControls
˘˘H T
.
˘˘T U
Where
˘˘U Z
(
˘˘Z [
x
˘˘[ \
=>
˘˘] _
x
˘˘` a
.
˘˘a b
idCheckpoint
˘˘b n
==
˘˘o q
checkpointPrimer˘˘r Ç
.˘˘Ç É
idCheckpoint˘˘É è
&&˘˘ê í
timeControl˘˘ì û
.˘˘û ü
	numTicket˘˘ü ®
==˘˘© ´
x˘˘¨ ≠
.˘˘≠ Æ
	numTicket˘˘Æ ∑
)˘˘∑ ∏
.˘˘∏ π
FirstOrDefault˘˘π «
(˘˘« »
)˘˘» …
;˘˘…  

Checkpoint
˙˙0 :
checkpoint1
˙˙; F
=
˙˙G H
new
˙˙I L

Checkpoint
˙˙M W
(
˙˙W X
)
˙˙X Y
;
˙˙Y Z
double
˚˚0 6
minutosParaParada
˚˚7 H
=
˚˚I J
$num
˚˚K L
;
˚˚L M
double
¸¸0 6
medicionTime
¸¸7 C
=
¸¸D E
(
¸¸F G
orderTimeControl
¸¸G W
[
¸¸W X
i
¸¸X Y
+
¸¸Z [
$num
¸¸\ ]
]
¸¸] ^
.
¸¸^ _
dateRegister
¸¸_ k
.
¸¸k l
Value
¸¸l q
-
¸¸r s
orderTimeControl¸¸t Ñ
[¸¸Ñ Ö
i¸¸Ö Ü
]¸¸Ü á
.¸¸á à
dateRegister¸¸à î
.¸¸î ï
Value¸¸ï ö
)¸¸ö õ
.¸¸õ ú
TotalMinutes¸¸ú ®
;¸¸® ©
checkpoint1
˝˝0 ;
=
˝˝< =
checkpoints
˝˝> I
.
˝˝I J
Where
˝˝J O
(
˝˝O P
x
˝˝P Q
=>
˝˝R T
x
˝˝U V
.
˝˝V W
idCheckpoint
˝˝W c
==
˝˝d f
orderTimeControl
˝˝g w
[
˝˝w x
i
˝˝x y
]
˝˝y z
.
˝˝z {
idCheckpoint˝˝{ á
)˝˝á à
.˝˝à â
FirstOrDefault˝˝â ó
(˝˝ó ò
)˝˝ò ô
;˝˝ô ö
TimeSpan
˛˛0 8
timeSpan
˛˛9 A
=
˛˛B C
new
˛˛D G
TimeSpan
˛˛H P
(
˛˛P Q
)
˛˛Q R
;
˛˛R S
if
ˇˇ0 2
(
ˇˇ3 4
DateTime
ˇˇ4 <
.
ˇˇ< =
Parse
ˇˇ= B
(
ˇˇB C
timeControlInicio
ˇˇC T
.
ˇˇT U
dateRegister
ˇˇU a
.
ˇˇa b
ToString
ˇˇb j
(
ˇˇj k
)
ˇˇk l
)
ˇˇl m
.
ˇˇm n
	DayOfWeek
ˇˇn w
==
ˇˇx z
	DayOfWeekˇˇ{ Ñ
.ˇˇÑ Ö
	WednesdayˇˇÖ é
||ˇˇè ë
DateTimeˇˇí ö
.ˇˇö õ
Parseˇˇõ †
(ˇˇ† °!
timeControlInicioˇˇ° ≤
.ˇˇ≤ ≥
dateRegisterˇˇ≥ ø
.ˇˇø ¿
ToStringˇˇ¿ »
(ˇˇ» …
)ˇˇ…  
)ˇˇ  À
.ˇˇÀ Ã
	DayOfWeekˇˇÃ ’
==ˇˇ÷ ÿ
	DayOfWeekˇˇŸ ‚
.ˇˇ‚ „
Saturdayˇˇ„ Î
)ˇˇÎ Ï
timeSpan
ÄÄ4 <
=
ÄÄ= >
TimeSpan
ÄÄ? G
.
ÄÄG H
Parse
ÄÄH M
(
ÄÄM N
checkpoint1
ÄÄN Y
.
ÄÄY Z
minArrivalMarket
ÄÄZ j
)
ÄÄj k
;
ÄÄk l
else
ÅÅ0 4
timeSpan
ÅÅ5 =
=
ÅÅ> ?
TimeSpan
ÅÅ@ H
.
ÅÅH I
Parse
ÅÅI N
(
ÅÅN O
checkpoint1
ÅÅO Z
.
ÅÅZ [

minArrival
ÅÅ[ e
)
ÅÅe f
;
ÅÅf g
minutosParaParada
ÇÇ0 A
=
ÇÇB C
timeSpan
ÇÇD L
.
ÇÇL M
TotalMinutes
ÇÇM Y
;
ÇÇY Z
double
ÉÉ0 6
diferenciaMinutos
ÉÉ7 H
=
ÉÉI J
medicionTime
ÉÉK W
-
ÉÉX Y
minutosParaParada
ÉÉZ k
;
ÉÉk l
int
ÑÑ0 3

diferencia
ÑÑ4 >
=
ÑÑ? @
(
ÑÑA B
int
ÑÑB E
)
ÑÑE F
Math
ÑÑF J
.
ÑÑJ K
Floor
ÑÑK P
(
ÑÑP Q
diferenciaMinutos
ÑÑQ b
)
ÑÑb c
;
ÑÑc d
var
ÖÖ0 3
check
ÖÖ4 9
=
ÖÖ: ;
checkpoints
ÖÖ< G
.
ÖÖG H
Where
ÖÖH M
(
ÖÖM N
x
ÖÖN O
=>
ÖÖP R
x
ÖÖS T
.
ÖÖT U
idCheckpoint
ÖÖU a
==
ÖÖb d
orderTimeControl
ÖÖe u
[
ÖÖu v
i
ÖÖv w
+
ÖÖx y
$num
ÖÖz {
]
ÖÖ{ |
.
ÖÖ| }
idCheckpointÖÖ} â
)ÖÖâ ä
.ÖÖä ã
FirstOrDefaultÖÖã ô
(ÖÖô ö
)ÖÖö õ
;ÖÖõ ú
if
ÜÜ0 2
(
ÜÜ3 4
minutosParaParada
ÜÜ4 E
<
ÜÜF G
medicionTime
ÜÜH T
)
ÜÜT U
{
áá0 1
incidencias
àà4 ?
.
àà? @
Add
àà@ C
(
ààC D
$str
ààD a
+
ààb c
check
ààd i
.
àài j
description
ààj u
+
ààv w
$str
ààx 
+ààÄ Å

diferenciaààÇ å
+ààç é
$strààè ï
+ààñ ó
$strààò †
+àà° ¢
checkàà£ ®
.àà® ©
numberRouteàà© ¥
)àà¥ µ
;ààµ ∂
}
ââ0 1
}
ää, -
}
ãã( )
}
åå$ %
if
çç$ &
(
çç' (
timeControl
çç( 3
.
çç3 4
	numTicket
çç4 =
==
çç> @
null
ççA E
)
ççE F
{
ççG H
timeControl
ççI T
.
ççT U
	numTicket
ççU ^
=
çç_ `
$num
çça b
;
ççb c
	numTicket
ççd m
=
ççn o
$num
ççp q
;
ççq r
}
ççs t
else
éé$ (
{
éé) *
	numTicket
éé+ 4
=
éé5 6
(
éé7 8
int
éé8 ;
)
éé; <
timeControl
éé< G
.
ééG H
	numTicket
ééH Q
;
ééQ R
}
ééS T
if
èè$ &
(
èè' (
timeControl
èè( 3
.
èè3 4
dateRegister
èè4 @
!=
èèA C
null
èèD H
)
èèH I
final
èèJ O
=
èèP Q
DateTime
èèR Z
.
èèZ [
Parse
èè[ `
(
èè` a
timeControl
èèa l
.
èèl m
dateRegister
èèm y
.
èèy z
ToStringèèz Ç
(èèÇ É
)èèÉ Ñ
)èèÑ Ö
;èèÖ Ü
}
êê  !
}
ëë 
}
íí  
muestraControlador
ìì *
.
ìì* +
Add
ìì+ .
(
ìì. /
new
ìì/ 2 
MuestraControlador
ìì3 E
(
ììE F
empleado
ììF N
.
ììN O

idEmployee
ììO Y
,
ììY Z
empleado
ìì[ c
.
ììc d
plate
ììd i
,
ììi j
retrasos
ììk s
,
ììs t
incidenciasììu Ä
,ììÄ Å
finalììÇ á
,ììá à
	numTicketììâ í
)ììí ì
)ììì î
;ììî ï
}
îî 
}
ïï 
List
ññ 
<
ññ 

Checkpoint
ññ 
>
ññ  
checkpointss
ññ! -
=
ññ. /
new
ññ0 3
List
ññ4 8
<
ññ8 9

Checkpoint
ññ9 C
>
ññC D
(
ññD E
)
ññE F
;
ññF G
using
óó 
(
óó 
dbModels
óó 
context
óó  '
=
óó( )
new
óó* -
dbModels
óó. 6
(
óó6 7
)
óó7 8
)
óó8 9
checkpointss
òò  
=
òò! "
context
òò# *
.
òò* +

Checkpoint
òò+ 5
.
òò5 6
Where
òò6 ;
(
òò; <
x
òò< =
=>
òò> @
x
òòA B
.
òòB C

idEmployee
òòC M
==
òòN P
Employee
òòP X
&&
òòY [
x
òò\ ]
.
òò] ^
status
òò^ d
>
òòe f
$num
òòg h
)
òòh i
.
òòi j
ToList
òòj p
(
òòp q
)
òòq r
;
òòr s 
muestraControlador
ôô "
=
ôô# $ 
muestraControlador
ôô% 7
.
ôô7 8
OrderBy
ôô8 ?
(
ôô? @
x
ôô@ A
=>
ôôB D
x
ôôE F
.
ôôF G
	numTicket
ôôG P
)
ôôP Q
.
ôôQ R
ToList
ôôR X
(
ôôX Y
)
ôôY Z
;
ôôZ [
int
öö 
firstCheckpointId
öö %
=
öö& '
checkpointss
öö( 4
.
öö4 5
FirstOrDefault
öö5 C
(
ööC D
)
ööD E
?
ööE F
.
ööF G
numberRoute
ööG R
??
ööS U
$num
ööV W
;
ööW X
ViewBag
õõ 
.
õõ 
Checkpoints
õõ #
=
õõ$ %
new
õõ& )

SelectList
õõ* 4
(
õõ4 5
checkpointss
õõ5 A
,
õõA B
$str
õõC P
,
õõP Q
$str
õõR _
,
õõ_ `
firstCheckpointId
õõa r
)
õõr s
;
õõs t
return
úú 
View
úú 
(
úú  
muestraControlador
úú .
)
úú. /
;
úú/ 0
}
ùù 
catch
ûû 
(
ûû 
	Exception
ûû 
)
ûû 
{
üü 
return
†† 
RedirectToAction
†† '
(
††' (
$str
††( /
,
††/ 0
$str
††1 7
)
††7 8
;
††8 9
}
°° 
}
§§ 	
[
•• 	
HttpPost
••	 
]
•• 
public
¶¶ 
ActionResult
¶¶ 
SalidaCreate
¶¶ (
(
¶¶( )
string
¶¶) /
plate
¶¶0 5
,
¶¶5 6
int
¶¶7 :"
SelectedCheckpointId
¶¶; O
)
¶¶O P
{
ßß 	
try
®® 
{
©© 
Login
™™ 
logi
™™ 
=
™™ 
new
™™  
Login
™™! &
(
™™& '
)
™™' (
;
™™( )
var
´´ 

authResult
´´ 
=
´´   
AutenticarPasosRol
´´! 3
(
´´3 4
$num
´´4 5
)
´´5 6
;
´´6 7
if
¨¨ 
(
¨¨ 

authResult
¨¨ 
!=
¨¨ !
null
¨¨" &
)
¨¨& '
return
¨¨( .

authResult
¨¨/ 9
;
¨¨9 :
string
≠≠ 
Linea
≠≠ 
=
≠≠ 
logi
≠≠ #
.
≠≠# $ 
GetLineaFromCookie
≠≠$ 6
(
≠≠6 7
Request
≠≠7 >
)
≠≠> ?
.
≠≠? @
ToString
≠≠@ H
(
≠≠H I
)
≠≠I J
;
≠≠J K
string
ÆÆ 
Employee
ÆÆ 
=
ÆÆ  !
logi
ÆÆ" &
.
ÆÆ& '%
GetEmployeeIdFromCookie
ÆÆ' >
(
ÆÆ> ?
Request
ÆÆ? F
)
ÆÆF G
.
ÆÆG H
ToString
ÆÆH P
(
ÆÆP Q
)
ÆÆQ R
;
ÆÆR S
TimeZoneInfo
ØØ 
boliviaTimeZone
ØØ ,
=
ØØ- .
TimeZoneInfo
ØØ/ ;
.
ØØ; <$
FindSystemTimeZoneById
ØØ< R
(
ØØR S
$str
ØØS m
)
ØØm n
;
ØØn o
DateTime
∞∞ 
boliviaTime
∞∞ $
=
∞∞% &
TimeZoneInfo
∞∞' 3
.
∞∞3 4
ConvertTime
∞∞4 ?
(
∞∞? @
DateTime
∞∞@ H
.
∞∞H I
UtcNow
∞∞I O
,
∞∞O P
boliviaTimeZone
∞∞Q `
)
∞∞` a
;
∞∞a b
Employee
±± 
em
±± 
=
±± 
new
±± !
Employee
±±" *
(
±±* +
)
±±+ ,
;
±±, -
using
≤≤ 
(
≤≤ 
dbModels
≤≤ 
context
≤≤  '
=
≤≤( )
new
≤≤* -
dbModels
≤≤. 6
(
≤≤6 7
)
≤≤7 8
)
≤≤8 9
{
≥≥ 
em
¥¥ 
=
¥¥ 
context
¥¥  
.
¥¥  !
Employee
¥¥! )
.
¥¥) *
Where
¥¥* /
(
¥¥/ 0
x
¥¥0 1
=>
¥¥2 4
x
¥¥5 6
.
¥¥6 7
plate
¥¥7 <
.
¥¥< =
ToLower
¥¥= D
(
¥¥D E
)
¥¥E F
.
¥¥F G
Trim
¥¥G K
(
¥¥K L
)
¥¥L M
==
¥¥N P
plate
¥¥Q V
.
¥¥V W
ToLower
¥¥W ^
(
¥¥^ _
)
¥¥_ `
.
¥¥` a
Trim
¥¥a e
(
¥¥e f
)
¥¥f g
&&
¥¥h j
x
¥¥k l
.
¥¥l m
idLine
¥¥m s
==
¥¥t v
Linea
¥¥w |
)
¥¥| }
.
¥¥} ~
FirstOrDefault¥¥~ å
(¥¥å ç
)¥¥ç é
;¥¥é è
}
µµ 
if
∂∂ 
(
∂∂ 
em
∂∂ 
==
∂∂ 
null
∂∂ 
)
∂∂ 
{
∑∑ 
TempData
∏∏ 
[
∏∏ 
$str
∏∏ !
]
∏∏! "
=
∏∏# $
$str
∏∏% N
;
∏∏N O
return
ππ 
View
ππ 
(
ππ  
)
ππ  !
;
ππ! "
}
∫∫ 

Checkpoint
ªª 

checkpoint
ªª %
=
ªª& '
new
ªª( +

Checkpoint
ªª, 6
(
ªª6 7
)
ªª7 8
;
ªª8 9
List
ºº 
<
ºº 

Checkpoint
ºº 
>
ºº  
	checksver
ºº! *
=
ºº+ ,
new
ºº- 0
List
ºº1 5
<
ºº5 6

Checkpoint
ºº6 @
>
ºº@ A
(
ººA B
)
ººB C
;
ººC D
List
ΩΩ 
<
ΩΩ 
int
ΩΩ 
>
ΩΩ 
numTicketss
ΩΩ %
=
ΩΩ& '
new
ΩΩ( +
List
ΩΩ, 0
<
ΩΩ0 1
int
ΩΩ1 4
>
ΩΩ4 5
(
ΩΩ5 6
)
ΩΩ6 7
;
ΩΩ7 8
using
øø 
(
øø 
dbModels
øø 
context
øø  '
=
øø( )
new
øø* -
dbModels
øø. 6
(
øø6 7
)
øø7 8
)
øø8 9
{
¿¿ 

checkpoint
¡¡ 
=
¡¡  
context
¡¡! (
.
¡¡( )

Checkpoint
¡¡) 3
.
¡¡3 4
Where
¡¡4 9
(
¡¡9 :
x
¡¡: ;
=>
¡¡< >
x
¡¡? @
.
¡¡@ A
idLine
¡¡A G
==
¡¡H J
Linea
¡¡K P
&&
¡¡Q S
x
¡¡T U
.
¡¡U V

idEmployee
¡¡V `
==
¡¡a c
Employee
¡¡d l
&&
¡¡m o
x
¡¡p q
.
¡¡q r
numberRoute
¡¡r }
==¡¡~ Ä$
SelectedCheckpointId¡¡Å ï
)¡¡ï ñ
.¡¡ñ ó
FirstOrDefault¡¡ó •
(¡¡• ¶
)¡¡¶ ß
;¡¡ß ®
var
¬¬ 
checks
¬¬ 
=
¬¬  
context
¬¬! (
.
¬¬( )

Checkpoint
¬¬) 3
.
¬¬3 4
Where
¬¬4 9
(
¬¬9 :
x
¬¬: ;
=>
¬¬< >
x
¬¬? @
.
¬¬@ A
idLine
¬¬A G
==
¬¬H J
Linea
¬¬K P
&&
¬¬Q S
(
¬¬T U
x
¬¬U V
.
¬¬V W
status
¬¬W ]
==
¬¬^ `
$num
¬¬a b
||
¬¬c e
x
¬¬f g
.
¬¬g h
status
¬¬h n
==
¬¬o q
$num
¬¬r s
)
¬¬s t
)
¬¬t u
.
¬¬u v
ToList
¬¬v |
(
¬¬| }
)
¬¬} ~
;
¬¬~ 
foreach
√√ 
(
√√ 
var
√√  
item
√√! %
in
√√& (
checks
√√) /
)
√√/ 0
{
ƒƒ 
int
≈≈ 
timec
≈≈ !
=
≈≈" #
context
≈≈$ +
.
≈≈+ ,
TimeControl
≈≈, 7
.
∆∆ 
Where
∆∆ 
(
∆∆ 
x
∆∆  
=>
∆∆! #
x
∆∆$ %
.
∆∆% &
idCheckpoint
∆∆& 2
==
∆∆3 5
item
∆∆6 :
.
∆∆: ;
idCheckpoint
∆∆; G
)
∆∆G H
.
«« 
Select
«« 
(
««  
x
««  !
=>
««" $
(
««% &
int
««& )
?
««) *
)
««* +
x
««+ ,
.
««, -
	numTicket
««- 6
)
««6 7
.
»» 
Max
»» 
(
»» 
)
»» 
??
»» !
$num
»»" #
;
»»# $
numTicketss
…… #
.
……# $
Add
……$ '
(
……' (
timec
……( -
)
……- .
;
……. /
}
   
}
ÀÀ 
using
ÃÃ 
(
ÃÃ 
dbModels
ÃÃ 
context
ÃÃ  '
=
ÃÃ( )
new
ÃÃ* -
dbModels
ÃÃ. 6
(
ÃÃ6 7
)
ÃÃ7 8
)
ÃÃ8 9
{
ÕÕ 
int
ŒŒ 
	numTicket
ŒŒ !
=
ŒŒ" #
numTicketss
ŒŒ$ /
.
ŒŒ/ 0
Max
ŒŒ0 3
(
ŒŒ3 4
)
ŒŒ4 5
;
ŒŒ5 6
var
œœ 
checks
œœ 
=
œœ  
context
œœ! (
.
œœ( )

Checkpoint
œœ) 3
.
œœ3 4
Where
œœ4 9
(
œœ9 :
x
œœ: ;
=>
œœ< >
x
œœ? @
.
œœ@ A
idLine
œœA G
==
œœH J
Linea
œœK P
&&
œœQ S
x
œœT U
.
œœU V
status
œœV \
!=
œœ] _
$num
œœ` a
&&
œœb d
x
œœe f
.
œœf g
numberRoute
œœg r
==
œœs u#
SelectedCheckpointIdœœv ä
)œœä ã
.œœã å
ToListœœå í
(œœí ì
)œœì î
;œœî ï
int
–– 
enabledEmployee
–– '
=
––( )
$num
––* +
;
––+ ,
int
––- 0
enableTimeControl
––1 B
=
––C D
$num
––E F
;
––F G
if
—— 
(
—— 

checkpoint
—— "
.
——" #
status
——# )
==
——* ,
$num
——- .
)
——. /
{
——0 1
enabledEmployee
——2 A
=
——B C
$num
——D E
;
——E F
enableTimeControl
——G X
=
——Y Z
$num
——[ \
;
——\ ]
}
——^ _
if
““ 
(
““ 
checks
““ 
.
““ 
Count
““ $
>
““% &
$num
““' (
)
““( )
{
”” 
	numTicket
‘‘ !
++
‘‘! #
;
‘‘# $
foreach
’’ 
(
’’  !
var
’’! $
check
’’% *
in
’’+ -
checks
’’. 4
)
’’4 5
{
÷÷ 
TimeControl
◊◊ '
time
◊◊( ,
=
◊◊- .
new
◊◊/ 2
TimeControl
◊◊3 >
(
◊◊> ?
)
◊◊? @
;
◊◊@ A
if
ÿÿ 
(
ÿÿ  

checkpoint
ÿÿ  *
.
ÿÿ* +
idCheckpoint
ÿÿ+ 7
!=
ÿÿ8 :
check
ÿÿ; @
.
ÿÿ@ A
idCheckpoint
ÿÿA M
)
ÿÿM N
time
ÿÿO S
.
ÿÿS T
dateRegister
ÿÿT `
=
ÿÿa b
null
ÿÿc g
;
ÿÿg h
else
ŸŸ  
time
ŸŸ! %
.
ŸŸ% &
dateRegister
ŸŸ& 2
=
ŸŸ3 4
boliviaTime
ŸŸ5 @
;
ŸŸ@ A
time
⁄⁄  
.
⁄⁄  !
idCheckpoint
⁄⁄! -
=
⁄⁄. /
check
⁄⁄0 5
.
⁄⁄5 6
idCheckpoint
⁄⁄6 B
;
⁄⁄B C
time
€€  
.
€€  !

idEmployee
€€! +
=
€€, -
em
€€. 0
.
€€0 1

idEmployee
€€1 ;
;
€€; <
time
‹‹  
.
‹‹  !
plate
‹‹! &
=
‹‹' (
plate
‹‹) .
.
‹‹. /
ToUpper
‹‹/ 6
(
‹‹6 7
)
‹‹7 8
.
‹‹8 9
Trim
‹‹9 =
(
‹‹= >
)
‹‹> ?
;
‹‹? @
time
››  
.
››  !
enable
››! '
=
››( )
enableTimeControl
››* ;
;
››; <
time
ﬁﬁ  
.
ﬁﬁ  !
	numTicket
ﬁﬁ! *
=
ﬁﬁ+ ,
	numTicket
ﬁﬁ- 6
;
ﬁﬁ6 7
context
‡‡ #
.
‡‡# $
TimeControl
‡‡$ /
.
‡‡/ 0
Add
‡‡0 3
(
‡‡3 4
time
‡‡4 8
)
‡‡8 9
;
‡‡9 :
}
·· 
em
‚‚ 
.
‚‚ 
enabled
‚‚ "
=
‚‚# $
enabledEmployee
‚‚% 4
;
‚‚4 5
context
„„ 
.
„„  
Entry
„„  %
(
„„% &
em
„„& (
)
„„( )
.
„„) *
State
„„* /
=
„„0 1
System
„„2 8
.
„„8 9
Data
„„9 =
.
„„= >
Entity
„„> D
.
„„D E
EntityState
„„E P
.
„„P Q
Modified
„„Q Y
;
„„Y Z
}
‰‰ 
context
ÂÂ 
.
ÂÂ 
SaveChanges
ÂÂ '
(
ÂÂ' (
)
ÂÂ( )
;
ÂÂ) *
}
ÊÊ 
return
ÁÁ 
RedirectToAction
ÁÁ '
(
ÁÁ' (
$str
ÁÁ( 6
)
ÁÁ6 7
;
ÁÁ7 8
}
ËË 
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
)
ÈÈ 
{
ÍÍ 
return
ÎÎ 
RedirectToAction
ÎÎ '
(
ÎÎ' (
$str
ÎÎ( /
,
ÎÎ/ 0
$str
ÎÎ1 7
)
ÎÎ7 8
;
ÎÎ8 9
}
ÏÏ 
}
ÌÌ 	
}
ÓÓ 
}ÔÔ ◊
EC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\RutasMostrar.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Controllers" -
{ 
public 

class 
RutasMostrar 
{		 
public

 
int

 
idRoute

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
public 
decimal 
latitud 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
decimal 
longitud 
{  !
get" %
;% &
set' *
;* +
}+ ,
public 
string 
name 
{ 
get !
;! "
set# &
;& '
}( )
public 
int 
? 
status 
{ 
get  
;  !
set" %
;% &
}' (
public 
int 
numPoint 
{ 
get !
;! "
set# &
;& '
}( )
public 
RutasMostrar 
( 
) 
{ 	
} 	
public 
RutasMostrar 
( 
int 
idRoute  '
,' (
decimal) 0
latitud1 8
,8 9
decimal: A
longitudB J
,J K
stringL R
nameS W
,W X
intY \
?\ ]
status^ d
,d e
intf i
numPointj r
)r s
{ 	
this 
. 
idRoute 
= 
idRoute "
;" #
this 
. 
latitud 
= 
latitud "
;" #
this 
. 
longitud 
= 
longitud $
;$ %
this 
. 
name 
= 
name 
; 
this 
. 
status 
= 
status  
;  !
this 
. 
numPoint 
= 
numPoint $
;$ %
} 	
} 
} ∂
EC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\ParadasOrden.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
ParadasOrden 
{		 
public

 
int

 
id

 
{

 
get

 
;

 
set

  
;

  !
}

" #
public 
int 
status 
{ 
get 
; 
set  #
;# $
}% &
public 
decimal 
latitud 
{ 
get  #
;# $
set% (
;( )
}* +
public 
decimal 
longitud 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
ParadasOrden 
( 
) 
{ 	
} 	
public 
ParadasOrden 
( 
int 
id  "
," #
int$ '
status( .
,. /
decimal0 7
latitud8 ?
,? @
decimalA H
longitudI Q
)Q R
{ 	
this 
. 
id 
= 
id 
; 
this 
. 
status 
= 
status  
;  !
this 
. 
latitud 
= 
latitud "
;" #
this 
. 
longitud 
= 
longitud $
;$ %
} 	
} 
} ø˙
NC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Controllers\ReportController.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Controllers" -
{ 
public 

class 
ReportController !
:" #

Controller$ .
{ 
public 
ActionResult 
	ReportDay %
(% &
)& '
{ 	
try 
{ 
Login 
logi 
= 
new  
Login! &
(& '
)' (
;( )
var 

authResult 
=  
AutenticarPasosRol! 3
(3 4
$num4 5
)5 6
;6 7
if 
( 

authResult 
!= !
null" &
)& '
return( .

authResult/ 9
;9 :
string 
Linea 
= 
logi #
.# $
GetLineaFromCookie$ 6
(6 7
Request7 >
)> ?
.? @
ToString@ H
(H I
)I J
;J K
List 
< 

Checkpoint 
>  

checkpoint! +
=, -
new. 1
List2 6
<6 7

Checkpoint7 A
>A B
(B C
)C D
;D E
List 
< 
MuestraReport "
>" #
report$ *
=+ ,
new- 0
List1 5
<5 6
MuestraReport6 C
>C D
(D E
)E F
;F G
TimeZoneInfo 
boliviaTimeZone ,
=- .
TimeZoneInfo/ ;
.; <"
FindSystemTimeZoneById< R
(R S
$strS m
)m n
;n o
DateTime 
boliviaTime $
=% &
TimeZoneInfo' 3
.3 4
ConvertTime4 ?
(? @
DateTime@ H
.H I
UtcNowI O
,O P
boliviaTimeZoneQ `
)` a
;a b
Employee 
employee !
=" #
new$ '
Employee( 0
(0 1
)1 2
;2 3
Person 
person 
= 
new  #
Person$ *
(* +
)+ ,
;, -
using 
( 
dbModels 
context  '
=( )
new* -
dbModels. 6
(6 7
)7 8
)8 9

checkpoint: D
=E F
contextG N
.N O

CheckpointO Y
.Y Z
WhereZ _
(_ `
x` a
=>b d
xe f
.f g
idLineg m
==n p
Lineaq v
)v w
.w x
ToListx ~
(~ 
)	 Ä
;
Ä Å
List 
< 
TimeControl  
>  !
time" &
=' (
new) ,
List- 1
<1 2
TimeControl2 =
>= >
(> ?
)? @
;@ A
using 
( 
dbModels 
context  '
=( )
new* -
dbModels. 6
(6 7
)7 8
)8 9
foreach   
(   
var    
item  ! %
in  & (

checkpoint  ) 3
)  3 4
{!! 
time"" 
="" 
context"" &
.""& '
TimeControl""' 2
.""2 3
ToList""3 9
(""9 :
)"": ;
.""; <
Where""< A
(""A B
x""B C
=>""D F
x""G H
.""H I
idCheckpoint""I U
==""V X
item""Y ]
.""] ^
idCheckpoint""^ j
&&""k m
DateTime""n v
.""v w
Parse""w |
(""| }
x""} ~
.""~ 
dateRegister	"" ã
.
""ã å
ToString
""å î
(
""î ï
)
""ï ñ
)
""ñ ó
.
""ó ò
ToString
""ò †
(
""† °
$str
""° ≠
)
""≠ Æ
==
""Ø ±
boliviaTime
""≤ Ω
.
""Ω æ
ToString
""æ ∆
(
""∆ «
$str
""« ”
)
""” ‘
)
""‘ ’
.
""’ ÷
ToList
""÷ ‹
(
""‹ ›
)
""› ﬁ
;
""ﬁ ﬂ
foreach## 
(##  !
var##! $
item2##% *
in##+ -
time##. 2
)##2 3
report$$ "
.$$" #
Add$$# &
($$& '
new$$' *
MuestraReport$$+ 8
($$8 9
item$$9 =
.$$= >
idCheckpoint$$> J
,$$J K
$str$$L N
,$$N O
item2$$P U
.$$U V

idEmployee$$V `
,$$` a
item2$$b g
.$$g h
plate$$h m
,$$m n
DateTime$$o w
.$$w x
Parse$$x }
($$} ~
item2	$$~ É
.
$$É Ñ
dateRegister
$$Ñ ê
.
$$ê ë
ToString
$$ë ô
(
$$ô ö
)
$$ö õ
)
$$õ ú
,
$$ú ù
item
$$û ¢
.
$$¢ £
description
$$£ Æ
)
$$Æ Ø
)
$$Ø ∞
;
$$∞ ±
}%% 
using&& 
(&& 
dbModels&& 
context&&  '
=&&( )
new&&* -
dbModels&&. 6
(&&6 7
)&&7 8
)&&8 9
foreach'' 
('' 
var''  
item''! %
in''& (
report'') /
)''/ 0
{(( 
person)) 
=))  
context))! (
.))( )
Person))) /
.))/ 0
Where))0 5
())5 6
x))6 7
=>))8 :
x)); <
.))< =
nit))= @
==))A C
item))D H
.))H I

idEmployee))I S
)))S T
.))T U
FirstOrDefault))U c
())c d
)))d e
;))e f
item** 
.** 
name** !
=**" #
person**$ *
.*** +
name**+ /
+**0 1
$str**2 5
+**6 7
person**8 >
.**> ?
lastname**? G
;**G H
}++ 
using,, 
(,, 
dbModels,, 
context,,  '
=,,( )
new,,* -
dbModels,,. 6
(,,6 7
),,7 8
),,8 9
foreach-- 
(-- 
var--  
item--! %
in--& (
report--) /
)--/ 0
{.. 
employee//  
=//! "
context//# *
.//* +
Employee//+ 3
.//3 4
Where//4 9
(//9 :
x//: ;
=>//< >
x//? @
.//@ A

idEmployee//A K
.//K L
ToString//L T
(//T U
)//U V
==//W Y
item//Z ^
.//^ _

idEmployee//_ i
.//i j
ToString//j r
(//r s
)//s t
)//t u
.//u v
FirstOrDefault	//v Ñ
(
//Ñ Ö
)
//Ö Ü
;
//Ü á
item00 
.00 

idEmployee00 '
=00( )
employee00* 2
.002 3

idEmployee003 =
;00= >
}11 
bool22 

verificado22 
=22  !
false22" '
;22' (
ViewBag33 
.33 
Hoy33 
=33 
boliviaTime33 )
.33) *
ToString33* 2
(332 3
)333 4
;334 5
foreach44 
(44 
var44 
item44 !
in44" $
report44% +
)44+ ,
if55 
(55 
item55 
.55 
name55 !
.55! "
Trim55" &
(55& '
)55' (
!=55) +
$str55, .
)55. /

verificado550 :
=55; <
true55= A
;55A B
if66 
(66 
!66 

verificado66 
)66  
report66! '
.66' (
Add66( +
(66+ ,
new66, /
MuestraReport660 =
(66= >
$num66> ?
,66? @
$str66A j
,66j k
$str66l o
,66o p
$str66q t
,66t u
boliviaTime	66v Å
,
66Å Ç
$str
66É Ü
)
66Ü á
)
66á à
;
66à â
return77 
View77 
(77 
report77 "
)77" #
;77# $
}88 
catch99 
(99 
	Exception99 
)99 
{:: 
return;; 
RedirectToAction;; '
(;;' (
$str;;( /
,;;/ 0
$str;;1 7
);;7 8
;;;8 9
}<< 
}== 	
public>> 
ActionResult>> 
PrintedReportDay>> ,
(>>, -
string>>- 3
linea>>4 9
)>>9 :
{?? 	
try@@ 
{AA 
LoginBB 
logiBB 
=BB 
newBB  
LoginBB! &
(BB& '
)BB' (
;BB( )
varCC 

authResultCC 
=CC  
AutenticarPasosRolCC! 3
(CC3 4
$numCC4 5
)CC5 6
;CC6 7
ifDD 
(DD 

authResultDD 
!=DD !
nullDD" &
)DD& '
returnDD( .

authResultDD/ 9
;DD9 :
stringEE 
LineaEE 
=EE 
logiEE #
.EE# $
GetLineaFromCookieEE$ 6
(EE6 7
RequestEE7 >
)EE> ?
.EE? @
ToStringEE@ H
(EEH I
)EEI J
;EEJ K
ListFF 
<FF 

CheckpointFF 
>FF  

checkpointFF! +
=FF, -
newFF. 1
ListFF2 6
<FF6 7

CheckpointFF7 A
>FFA B
(FFB C
)FFC D
;FFD E
ListGG 
<GG 
MuestraReportGG "
>GG" #
reportGG$ *
=GG+ ,
newGG- 0
ListGG1 5
<GG5 6
MuestraReportGG6 C
>GGC D
(GGD E
)GGE F
;GGF G
EmployeeHH 
employeeHH !
=HH" #
newHH$ '
EmployeeHH( 0
(HH0 1
)HH1 2
;HH2 3
PersonII 
personII 
=II 
newII  #
PersonII$ *
(II* +
)II+ ,
;II, -
TimeZoneInfoJJ 
boliviaTimeZoneJJ ,
=JJ- .
TimeZoneInfoJJ/ ;
.JJ; <"
FindSystemTimeZoneByIdJJ< R
(JJR S
$strJJS m
)JJm n
;JJn o
DateTimeKK 
boliviaTimeKK $
=KK% &
TimeZoneInfoKK' 3
.KK3 4
ConvertTimeKK4 ?
(KK? @
DateTimeKK@ H
.KKH I
UtcNowKKI O
,KKO P
boliviaTimeZoneKKQ `
)KK` a
;KKa b
usingLL 
(LL 
dbModelsLL 
contextLL  '
=LL( )
newLL* -
dbModelsLL. 6
(LL6 7
)LL7 8
)LL8 9

checkpointLL: D
=LLE F
contextLLG N
.LLN O

CheckpointLLO Y
.LLY Z
WhereLLZ _
(LL_ `
xLL` a
=>LLb d
xLLe f
.LLf g
idLineLLg m
==LLn p
LineaLLq v
)LLv w
.LLw x
ToListLLx ~
(LL~ 
)	LL Ä
;
LLÄ Å
ListMM 
<MM 
TimeControlMM  
>MM  !
timeMM" &
=MM' (
newMM) ,
ListMM- 1
<MM1 2
TimeControlMM2 =
>MM= >
(MM> ?
)MM? @
;MM@ A
usingNN 
(NN 
dbModelsNN 
contextNN  '
=NN( )
newNN* -
dbModelsNN. 6
(NN6 7
)NN7 8
)NN8 9
foreachOO 
(OO 
varOO  
itemOO! %
inOO& (

checkpointOO) 3
)OO3 4
{PP 
timeQQ 
=QQ 
contextQQ &
.QQ& '
TimeControlQQ' 2
.QQ2 3
ToListQQ3 9
(QQ9 :
)QQ: ;
.QQ; <
WhereQQ< A
(QQA B
xQQB C
=>QQD F
xQQG H
.QQH I
idCheckpointQQI U
==QQV X
itemQQY ]
.QQ] ^
idCheckpointQQ^ j
&&QQk m
DateTimeQQn v
.QQv w
ParseQQw |
(QQ| }
xQQ} ~
.QQ~ 
dateRegister	QQ ã
.
QQã å
ToString
QQå î
(
QQî ï
)
QQï ñ
)
QQñ ó
.
QQó ò
ToString
QQò †
(
QQ† °
$str
QQ° ≠
)
QQ≠ Æ
==
QQØ ±
boliviaTime
QQ≤ Ω
.
QQΩ æ
ToString
QQæ ∆
(
QQ∆ «
$str
QQ« ”
)
QQ” ‘
)
QQ‘ ’
.
QQ’ ÷
ToList
QQ÷ ‹
(
QQ‹ ›
)
QQ› ﬁ
;
QQﬁ ﬂ
foreachRR 
(RR  !
varRR! $
item2RR% *
inRR+ -
timeRR. 2
)RR2 3
reportSS "
.SS" #
AddSS# &
(SS& '
newSS' *
MuestraReportSS+ 8
(SS8 9
itemSS9 =
.SS= >
idCheckpointSS> J
,SSJ K
$strSSL N
,SSN O
item2SSP U
.SSU V

idEmployeeSSV `
,SS` a
item2SSb g
.SSg h
plateSSh m
,SSm n
DateTimeSSo w
.SSw x
ParseSSx }
(SS} ~
item2	SS~ É
.
SSÉ Ñ
dateRegister
SSÑ ê
.
SSê ë
ToString
SSë ô
(
SSô ö
)
SSö õ
)
SSõ ú
,
SSú ù
item
SSû ¢
.
SS¢ £
description
SS£ Æ
)
SSÆ Ø
)
SSØ ∞
;
SS∞ ±
}TT 
usingUU 
(UU 
dbModelsUU 
contextUU  '
=UU( )
newUU* -
dbModelsUU. 6
(UU6 7
)UU7 8
)UU8 9
foreachVV 
(VV 
varVV  
itemVV! %
inVV& (
reportVV) /
)VV/ 0
{WW 
personXX 
=XX  
contextXX! (
.XX( )
PersonXX) /
.XX/ 0
WhereXX0 5
(XX5 6
xXX6 7
=>XX8 :
xXX; <
.XX< =
nitXX= @
==XXA C
itemXXD H
.XXH I

idEmployeeXXI S
)XXS T
.XXT U
FirstOrDefaultXXU c
(XXc d
)XXd e
;XXe f
itemYY 
.YY 
nameYY !
=YY" #
personYY$ *
.YY* +
nameYY+ /
+YY0 1
$strYY2 5
+YY6 7
personYY8 >
.YY> ?
lastnameYY? G
;YYG H
}ZZ 
using[[ 
([[ 
dbModels[[ 
context[[  '
=[[( )
new[[* -
dbModels[[. 6
([[6 7
)[[7 8
)[[8 9
foreach\\ 
(\\ 
var\\  
item\\! %
in\\& (
report\\) /
)\\/ 0
{]] 
employee^^  
=^^! "
context^^# *
.^^* +
Employee^^+ 3
.^^3 4
Where^^4 9
(^^9 :
x^^: ;
=>^^< >
x^^? @
.^^@ A

idEmployee^^A K
.^^K L
ToString^^L T
(^^T U
)^^U V
==^^W Y
item^^Z ^
.^^^ _

idEmployee^^_ i
.^^i j
ToString^^j r
(^^r s
)^^s t
)^^t u
.^^u v
FirstOrDefault	^^v Ñ
(
^^Ñ Ö
)
^^Ö Ü
;
^^Ü á
item__ 
.__ 

idEmployee__ '
=__( )
employee__* 2
.__2 3

idEmployee__3 =
;__= >
}`` 
boolaa 

verificadoaa 
=aa  !
falseaa" '
;aa' (
ViewBagbb 
.bb 
Hoybb 
=bb 
boliviaTimebb )
.bb) *
ToStringbb* 2
(bb2 3
)bb3 4
;bb4 5
foreachcc 
(cc 
varcc 
itemcc !
incc" $
reportcc% +
)cc+ ,
ifdd 
(dd 
itemdd 
.dd 
namedd !
.dd! "
Trimdd" &
(dd& '
)dd' (
!=dd) +
$strdd, .
)dd. /

verificadodd0 :
=dd; <
truedd= A
;ddA B
ifee 
(ee 
!ee 

verificadoee 
)ee  
reportee! '
.ee' (
Addee( +
(ee+ ,
newee, /
MuestraReportee0 =
(ee= >
$numee> ?
,ee? @
$streeA j
,eej k
$streel o
,eeo p
$streeq t
,eet u
boliviaTime	eev Å
,
eeÅ Ç
$str
eeÉ Ü
)
eeÜ á
)
eeá à
;
eeà â
returnff 
Viewff 
(ff 
reportff "
)ff" #
;ff# $
}gg 
catchhh 
(hh 
	Exceptionhh 
)hh 
{ii 
returnjj 
RedirectToActionjj '
(jj' (
$strjj( /
,jj/ 0
$strjj1 7
)jj7 8
;jj8 9
}kk 
}ll 	
publicmm 
ActionResultmm 
ReportRequestDatesmm .
(mm. /
)mm/ 0
{nn 	
varoo 

authResultoo 
=oo 
AutenticarPasosRoloo /
(oo/ 0
$numoo0 1
)oo1 2
;oo2 3
ifpp 
(pp 

authResultpp 
!=pp 
nullpp "
)pp" #
returnpp$ *

authResultpp+ 5
;pp5 6
Sessionqq 
[qq 
$strqq 
]qq 
=qq 
nullqq #
;qq# $
Sessionqq% ,
[qq, -
$strqq- 2
]qq2 3
=qq4 5
nullqq6 :
;qq: ;
returnrr 
Viewrr 
(rr 
)rr 
;rr 
}ss 	
[tt 	
HttpPosttt	 
]tt 
publicuu 
ActionResultuu 
ReportRequestDatesuu .
(uu. /
ReportDatesuu/ :
reportuu; A
)uuA B
{vv 	
tryww 
{xx 
varyy 

authResultyy 
=yy  
AutenticarPasosRolyy! 3
(yy3 4
$numyy4 5
)yy5 6
;yy6 7
ifzz 
(zz 

authResultzz 
!=zz !
nullzz" &
)zz& '
returnzz( .

authResultzz/ 9
;zz9 :
Session{{ 
[{{ 
$str{{ 
]{{  
={{! "
report{{# )
.{{) *
start{{* /
;{{/ 0
Session{{1 8
[{{8 9
$str{{9 >
]{{> ?
={{@ A
report{{B H
.{{H I
end{{I L
;{{L M
if|| 
(|| 
report|| 
.|| 
end|| 
<||  
report||! '
.||' (
start||( -
)||- .
{}} 
ViewBag~~ 
.~~ 
note~~  
=~~! "
$str~~# @
;~~@ A
return 
View 
(  
)  !
;! "
}
ÄÄ 
return
ÅÅ 
RedirectToAction
ÅÅ '
(
ÅÅ' (
$str
ÅÅ( 5
)
ÅÅ5 6
;
ÅÅ6 7
}
ÇÇ 
catch
ÉÉ 
(
ÉÉ 
	Exception
ÉÉ 
)
ÉÉ 
{
ÑÑ 
return
ÖÖ 
RedirectToAction
ÖÖ '
(
ÖÖ' (
$str
ÖÖ( /
,
ÖÖ/ 0
$str
ÖÖ1 7
)
ÖÖ7 8
;
ÖÖ8 9
}
ÜÜ 
}
áá 	
public
ââ 
ActionResult
ââ 
ReportDates
ââ '
(
ââ' (
)
ââ( )
{
ää 	
try
ãã 
{
åå 
Login
çç 
logi
çç 
=
çç 
new
çç  
Login
çç! &
(
çç& '
)
çç' (
;
çç( )
var
éé 

authResult
éé 
=
éé   
AutenticarPasosRol
éé! 3
(
éé3 4
$num
éé4 5
)
éé5 6
;
éé6 7
if
èè 
(
èè 

authResult
èè 
!=
èè !
null
èè" &
)
èè& '
return
èè( .

authResult
èè/ 9
;
èè9 :
string
êê 
Linea
êê 
=
êê 
logi
êê #
.
êê# $ 
GetLineaFromCookie
êê$ 6
(
êê6 7
Request
êê7 >
)
êê> ?
.
êê? @
ToString
êê@ H
(
êêH I
)
êêI J
;
êêJ K
if
ëë 
(
ëë 
Session
ëë 
[
ëë 
$str
ëë #
]
ëë# $
==
ëë% '
null
ëë( ,
||
ëë- /
Session
ëë0 7
[
ëë7 8
$str
ëë8 =
]
ëë= >
==
ëë? A
null
ëëB F
)
ëëF G
return
ëëH N
RedirectToAction
ëëO _
(
ëë_ `
$str
ëë` g
,
ëëg h
$str
ëëi o
)
ëëo p
;
ëëp q
DateTime
íí 
start
íí 
=
íí  
DateTime
íí! )
.
íí) *
Parse
íí* /
(
íí/ 0
Session
íí0 7
[
íí7 8
$str
íí8 ?
]
íí? @
.
íí@ A
ToString
ííA I
(
ííI J
)
ííJ K
)
ííK L
;
ííL M
DateTime
ìì 
end
ìì 
=
ìì 
DateTime
ìì '
.
ìì' (
Parse
ìì( -
(
ìì- .
Session
ìì. 5
[
ìì5 6
$str
ìì6 ;
]
ìì; <
.
ìì< =
ToString
ìì= E
(
ììE F
)
ììF G
)
ììG H
;
ììH I
List
îî 
<
îî 

Checkpoint
îî 
>
îî  

checkpoint
îî! +
=
îî, -
new
îî. 1
List
îî2 6
<
îî6 7

Checkpoint
îî7 A
>
îîA B
(
îîB C
)
îîC D
;
îîD E
List
ïï 
<
ïï 
MuestraReport
ïï "
>
ïï" #
report
ïï$ *
=
ïï+ ,
new
ïï- 0
List
ïï1 5
<
ïï5 6
MuestraReport
ïï6 C
>
ïïC D
(
ïïD E
)
ïïE F
;
ïïF G
Employee
ññ 
employee
ññ !
=
ññ" #
new
ññ$ '
Employee
ññ( 0
(
ññ0 1
)
ññ1 2
;
ññ2 3
Person
óó 
person
óó 
=
óó 
new
óó  #
Person
óó$ *
(
óó* +
)
óó+ ,
;
óó, -
TimeZoneInfo
òò 
boliviaTimeZone
òò ,
=
òò- .
TimeZoneInfo
òò/ ;
.
òò; <$
FindSystemTimeZoneById
òò< R
(
òòR S
$str
òòS m
)
òòm n
;
òòn o
DateTime
ôô 
boliviaTime
ôô $
=
ôô% &
TimeZoneInfo
ôô' 3
.
ôô3 4
ConvertTime
ôô4 ?
(
ôô? @
DateTime
ôô@ H
.
ôôH I
UtcNow
ôôI O
,
ôôO P
boliviaTimeZone
ôôQ `
)
ôô` a
;
ôôa b
using
öö 
(
öö 
dbModels
öö 
context
öö  '
=
öö( )
new
öö* -
dbModels
öö. 6
(
öö6 7
)
öö7 8
)
öö8 9

checkpoint
öö: D
=
ööE F
context
ööG N
.
ööN O

Checkpoint
ööO Y
.
ööY Z
Where
ööZ _
(
öö_ `
x
öö` a
=>
ööb d
x
ööe f
.
ööf g
idLine
öög m
==
öön p
Linea
ööq v
)
ööv w
.
ööw x
ToList
ööx ~
(
öö~ 
)öö Ä
;ööÄ Å
List
õõ 
<
õõ 
TimeControl
õõ  
>
õõ  !
time
õõ" &
=
õõ' (
new
õõ) ,
List
õõ- 1
<
õõ1 2
TimeControl
õõ2 =
>
õõ= >
(
õõ> ?
)
õõ? @
;
õõ@ A
end
úú 
=
úú 
end
úú 
.
úú 
AddDays
úú !
(
úú! "
$num
úú" #
)
úú# $
;
úú$ %
using
ùù 
(
ùù 
dbModels
ùù 
context
ùù  '
=
ùù( )
new
ùù* -
dbModels
ùù. 6
(
ùù6 7
)
ùù7 8
)
ùù8 9
foreach
ûû 
(
ûû 
var
ûû  
item
ûû! %
in
ûû& (

checkpoint
ûû) 3
)
ûû3 4
{
üü 
time
†† 
=
†† 
context
†† &
.
††& '
TimeControl
††' 2
.
††2 3
ToList
††3 9
(
††9 :
)
††: ;
.
††; <
Where
††< A
(
††A B
x
††B C
=>
††D F
x
††G H
.
††H I
idCheckpoint
††I U
==
††V X
item
††Y ]
.
††] ^
idCheckpoint
††^ j
&&
††k m
x
††n o
.
††o p
dateRegister
††p |
>=
††} 
start††Ä Ö
&&††Ü à
x††â ä
.††ä ã
dateRegister††ã ó
<=††ò ö
end††õ û
)††û ü
.††ü †
ToList††† ¶
(††¶ ß
)††ß ®
;††® ©
foreach
°° 
(
°°  !
var
°°! $
item2
°°% *
in
°°+ -
time
°°. 2
)
°°2 3
report
¢¢ "
.
¢¢" #
Add
¢¢# &
(
¢¢& '
new
¢¢' *
MuestraReport
¢¢+ 8
(
¢¢8 9
item
¢¢9 =
.
¢¢= >
idCheckpoint
¢¢> J
,
¢¢J K
$str
¢¢L N
,
¢¢N O
item2
¢¢P U
.
¢¢U V

idEmployee
¢¢V `
,
¢¢` a
item2
¢¢b g
.
¢¢g h
plate
¢¢h m
,
¢¢m n
DateTime
¢¢o w
.
¢¢w x
Parse
¢¢x }
(
¢¢} ~
item2¢¢~ É
.¢¢É Ñ
dateRegister¢¢Ñ ê
.¢¢ê ë
ToString¢¢ë ô
(¢¢ô ö
)¢¢ö õ
)¢¢õ ú
,¢¢ú ù
item¢¢û ¢
.¢¢¢ £
description¢¢£ Æ
)¢¢Æ Ø
)¢¢Ø ∞
;¢¢∞ ±
}
££ 
using
§§ 
(
§§ 
dbModels
§§ 
context
§§  '
=
§§( )
new
§§* -
dbModels
§§. 6
(
§§6 7
)
§§7 8
)
§§8 9
foreach
•• 
(
•• 
var
••  
item
••! %
in
••& (
report
••) /
)
••/ 0
{
¶¶ 
person
ßß 
=
ßß  
context
ßß! (
.
ßß( )
Person
ßß) /
.
ßß/ 0
Where
ßß0 5
(
ßß5 6
x
ßß6 7
=>
ßß8 :
x
ßß; <
.
ßß< =
nit
ßß= @
==
ßßA C
item
ßßD H
.
ßßH I

idEmployee
ßßI S
)
ßßS T
.
ßßT U
FirstOrDefault
ßßU c
(
ßßc d
)
ßßd e
;
ßße f
item
®® 
.
®® 
name
®® !
=
®®" #
person
®®$ *
.
®®* +
name
®®+ /
+
®®0 1
$str
®®2 5
+
®®6 7
person
®®8 >
.
®®> ?
lastname
®®? G
;
®®G H
}
©© 
using
™™ 
(
™™ 
dbModels
™™ 
context
™™  '
=
™™( )
new
™™* -
dbModels
™™. 6
(
™™6 7
)
™™7 8
)
™™8 9
foreach
´´ 
(
´´ 
var
´´  
item
´´! %
in
´´& (
report
´´) /
)
´´/ 0
{
¨¨ 
employee
≠≠  
=
≠≠! "
context
≠≠# *
.
≠≠* +
Employee
≠≠+ 3
.
≠≠3 4
Where
≠≠4 9
(
≠≠9 :
x
≠≠: ;
=>
≠≠< >
x
≠≠? @
.
≠≠@ A

idEmployee
≠≠A K
==
≠≠L N
item
≠≠O S
.
≠≠S T

idEmployee
≠≠T ^
)
≠≠^ _
.
≠≠_ `
FirstOrDefault
≠≠` n
(
≠≠n o
)
≠≠o p
;
≠≠p q
item
ÆÆ 
.
ÆÆ 

idEmployee
ÆÆ '
=
ÆÆ( )
employee
ÆÆ* 2
.
ÆÆ2 3

idEmployee
ÆÆ3 =
;
ÆÆ= >
}
ØØ 
bool
∞∞ 

verificado
∞∞ 
=
∞∞  !
false
∞∞" '
;
∞∞' (
ViewBag
±± 
.
±± 
Start
±± 
=
±± 
start
±±  %
.
±±% &
ToString
±±& .
(
±±. /
$str
±±/ ;
)
±±; <
;
±±< =
ViewBag
≤≤ 
.
≤≤ 
End
≤≤ 
=
≤≤ 
end
≤≤ !
.
≤≤! "
ToString
≤≤" *
(
≤≤* +
$str
≤≤+ 7
)
≤≤7 8
;
≤≤8 9
ViewBag
≥≥ 
.
≥≥ 
Hoy
≥≥ 
=
≥≥ 
boliviaTime
≥≥ )
.
≥≥) *
ToString
≥≥* 2
(
≥≥2 3
)
≥≥3 4
;
≥≥4 5
foreach
¥¥ 
(
¥¥ 
var
¥¥ 
item
¥¥ !
in
¥¥" $
report
¥¥% +
)
¥¥+ ,
if
µµ 
(
µµ 
item
µµ 
.
µµ 
name
µµ !
.
µµ! "
Trim
µµ" &
(
µµ& '
)
µµ' (
!=
µµ) +
$str
µµ, .
)
µµ. /

verificado
µµ0 :
=
µµ; <
true
µµ= A
;
µµA B
if
∂∂ 
(
∂∂ 
!
∂∂ 

verificado
∂∂ 
)
∂∂  
report
∂∂! '
.
∂∂' (
Add
∂∂( +
(
∂∂+ ,
new
∂∂, /
MuestraReport
∂∂0 =
(
∂∂= >
$num
∂∂> ?
,
∂∂? @
$str
∂∂A n
,
∂∂n o
$str
∂∂p s
,
∂∂s t
$str
∂∂u x
,
∂∂x y
boliviaTime∂∂z Ö
,∂∂Ö Ü
$str∂∂á ä
)∂∂ä ã
)∂∂ã å
;∂∂å ç
return
∑∑ 
View
∑∑ 
(
∑∑ 
report
∑∑ "
)
∑∑" #
;
∑∑# $
}
∏∏ 
catch
ππ 
(
ππ 
	Exception
ππ 
)
ππ 
{
∫∫ 
return
ªª 
RedirectToAction
ªª '
(
ªª' (
$str
ªª( /
,
ªª/ 0
$str
ªª1 7
)
ªª7 8
;
ªª8 9
}
ºº 
}
ΩΩ 	
public
ææ 
ActionResult
ææ  
PrintedReportDates
ææ .
(
ææ. /
string
ææ/ 5
linea
ææ6 ;
,
ææ; <
DateTime
ææ= E
start
ææF K
,
ææL M
DateTime
ææN V
end
ææW Z
)
ææZ [
{
øø 	
try
¿¿ 
{
¡¡ 
Login
¬¬ 
logi
¬¬ 
=
¬¬ 
new
¬¬  
Login
¬¬! &
(
¬¬& '
)
¬¬' (
;
¬¬( )
string
√√ 
Linea
√√ 
=
√√ 
logi
√√ #
.
√√# $ 
GetLineaFromCookie
√√$ 6
(
√√6 7
Request
√√7 >
)
√√> ?
.
√√? @
ToString
√√@ H
(
√√H I
)
√√I J
;
√√J K
List
ƒƒ 
<
ƒƒ 

Checkpoint
ƒƒ 
>
ƒƒ  

checkpoint
ƒƒ! +
=
ƒƒ, -
new
ƒƒ. 1
List
ƒƒ2 6
<
ƒƒ6 7

Checkpoint
ƒƒ7 A
>
ƒƒA B
(
ƒƒB C
)
ƒƒC D
;
ƒƒD E
List
≈≈ 
<
≈≈ 
MuestraReport
≈≈ "
>
≈≈" #
report
≈≈$ *
=
≈≈+ ,
new
≈≈- 0
List
≈≈1 5
<
≈≈5 6
MuestraReport
≈≈6 C
>
≈≈C D
(
≈≈D E
)
≈≈E F
;
≈≈F G
Employee
∆∆ 
employee
∆∆ !
=
∆∆" #
new
∆∆$ '
Employee
∆∆( 0
(
∆∆0 1
)
∆∆1 2
;
∆∆2 3
Person
«« 
person
«« 
=
«« 
new
««  #
Person
««$ *
(
««* +
)
««+ ,
;
««, -
TimeZoneInfo
»» 
boliviaTimeZone
»» ,
=
»»- .
TimeZoneInfo
»»/ ;
.
»»; <$
FindSystemTimeZoneById
»»< R
(
»»R S
$str
»»S m
)
»»m n
;
»»n o
DateTime
…… 
boliviaTime
…… $
=
……% &
TimeZoneInfo
……' 3
.
……3 4
ConvertTime
……4 ?
(
……? @
DateTime
……@ H
.
……H I
UtcNow
……I O
,
……O P
boliviaTimeZone
……Q `
)
……` a
;
……a b
using
   
(
   
dbModels
   
context
    '
=
  ( )
new
  * -
dbModels
  . 6
(
  6 7
)
  7 8
)
  8 9

checkpoint
  : D
=
  E F
context
  G N
.
  N O

Checkpoint
  O Y
.
  Y Z
Where
  Z _
(
  _ `
x
  ` a
=>
  b d
x
  e f
.
  f g
idLine
  g m
==
  n p
Linea
  q v
)
  v w
.
  w x
ToList
  x ~
(
  ~ 
)   Ä
;  Ä Å
List
ÀÀ 
<
ÀÀ 
TimeControl
ÀÀ  
>
ÀÀ  !
time
ÀÀ" &
=
ÀÀ' (
new
ÀÀ) ,
List
ÀÀ- 1
<
ÀÀ1 2
TimeControl
ÀÀ2 =
>
ÀÀ= >
(
ÀÀ> ?
)
ÀÀ? @
;
ÀÀ@ A
end
ÃÃ 
=
ÃÃ 
end
ÃÃ 
.
ÃÃ 
AddDays
ÃÃ !
(
ÃÃ! "
$num
ÃÃ" #
)
ÃÃ# $
;
ÃÃ$ %
using
ÕÕ 
(
ÕÕ 
dbModels
ÕÕ 
context
ÕÕ  '
=
ÕÕ( )
new
ÕÕ* -
dbModels
ÕÕ. 6
(
ÕÕ6 7
)
ÕÕ7 8
)
ÕÕ8 9
foreach
ŒŒ 
(
ŒŒ 
var
ŒŒ  
item
ŒŒ! %
in
ŒŒ& (

checkpoint
ŒŒ) 3
)
ŒŒ3 4
{
œœ 
time
–– 
=
–– 
context
–– &
.
––& '
TimeControl
––' 2
.
––2 3
ToList
––3 9
(
––9 :
)
––: ;
.
––; <
Where
––< A
(
––A B
x
––B C
=>
––D F
x
––G H
.
––H I
idCheckpoint
––I U
==
––V X
item
––Y ]
.
––] ^
idCheckpoint
––^ j
&&
––k m
x
––n o
.
––o p
dateRegister
––p |
>=
––} 
start––Ä Ö
&&––Ü à
x––â ä
.––ä ã
dateRegister––ã ó
<=––ò ö
end––õ û
)––û ü
.––ü †
ToList––† ¶
(––¶ ß
)––ß ®
;––® ©
foreach
—— 
(
——  !
var
——! $
item2
——% *
in
——+ -
time
——. 2
)
——2 3
report
““ "
.
““" #
Add
““# &
(
““& '
new
““' *
MuestraReport
““+ 8
(
““8 9
item
““9 =
.
““= >
idCheckpoint
““> J
,
““J K
$str
““L N
,
““N O
item2
““P U
.
““U V

idEmployee
““V `
,
““` a
item2
““b g
.
““g h
plate
““h m
,
““m n
DateTime
““o w
.
““w x
Parse
““x }
(
““} ~
item2““~ É
.““É Ñ
dateRegister““Ñ ê
.““ê ë
ToString““ë ô
(““ô ö
)““ö õ
)““õ ú
,““ú ù
item““û ¢
.““¢ £
description““£ Æ
)““Æ Ø
)““Ø ∞
;““∞ ±
}
”” 
using
‘‘ 
(
‘‘ 
dbModels
‘‘ 
context
‘‘  '
=
‘‘( )
new
‘‘* -
dbModels
‘‘. 6
(
‘‘6 7
)
‘‘7 8
)
‘‘8 9
foreach
’’ 
(
’’ 
var
’’  
item
’’! %
in
’’& (
report
’’) /
)
’’/ 0
{
÷÷ 
person
◊◊ 
=
◊◊  
context
◊◊! (
.
◊◊( )
Person
◊◊) /
.
◊◊/ 0
Where
◊◊0 5
(
◊◊5 6
x
◊◊6 7
=>
◊◊8 :
x
◊◊; <
.
◊◊< =
nit
◊◊= @
==
◊◊A C
item
◊◊D H
.
◊◊H I

idEmployee
◊◊I S
)
◊◊S T
.
◊◊T U
FirstOrDefault
◊◊U c
(
◊◊c d
)
◊◊d e
;
◊◊e f
item
ÿÿ 
.
ÿÿ 
name
ÿÿ !
=
ÿÿ" #
person
ÿÿ$ *
.
ÿÿ* +
name
ÿÿ+ /
+
ÿÿ0 1
$str
ÿÿ2 5
+
ÿÿ6 7
person
ÿÿ8 >
.
ÿÿ> ?
lastname
ÿÿ? G
;
ÿÿG H
}
ŸŸ 
using
⁄⁄ 
(
⁄⁄ 
dbModels
⁄⁄ 
context
⁄⁄  '
=
⁄⁄( )
new
⁄⁄* -
dbModels
⁄⁄. 6
(
⁄⁄6 7
)
⁄⁄7 8
)
⁄⁄8 9
foreach
€€ 
(
€€ 
var
€€  
item
€€! %
in
€€& (
report
€€) /
)
€€/ 0
{
‹‹ 
employee
››  
=
››! "
context
››# *
.
››* +
Employee
››+ 3
.
››3 4
Where
››4 9
(
››9 :
x
››: ;
=>
››< >
x
››? @
.
››@ A

idEmployee
››A K
==
››L N
item
››O S
.
››S T

idEmployee
››T ^
)
››^ _
.
››_ `
FirstOrDefault
››` n
(
››n o
)
››o p
;
››p q
item
ﬁﬁ 
.
ﬁﬁ 

idEmployee
ﬁﬁ '
=
ﬁﬁ( )
employee
ﬁﬁ* 2
.
ﬁﬁ2 3

idEmployee
ﬁﬁ3 =
;
ﬁﬁ= >
}
ﬂﬂ 
bool
‡‡ 

verificado
‡‡ 
=
‡‡  !
false
‡‡" '
;
‡‡' (
ViewBag
·· 
.
·· 
Start
·· 
=
·· 
start
··  %
.
··% &
ToString
··& .
(
··. /
$str
··/ ;
)
··; <
;
··< =
ViewBag
‚‚ 
.
‚‚ 
End
‚‚ 
=
‚‚ 
end
‚‚ !
.
‚‚! "
ToString
‚‚" *
(
‚‚* +
$str
‚‚+ 7
)
‚‚7 8
;
‚‚8 9
ViewBag
„„ 
.
„„ 
Hoy
„„ 
=
„„ 
boliviaTime
„„ )
.
„„) *
ToString
„„* 2
(
„„2 3
)
„„3 4
;
„„4 5
foreach
‰‰ 
(
‰‰ 
var
‰‰ 
item
‰‰ !
in
‰‰" $
report
‰‰% +
)
‰‰+ ,
if
ÂÂ 
(
ÂÂ 
item
ÂÂ 
.
ÂÂ 
name
ÂÂ !
.
ÂÂ! "
Trim
ÂÂ" &
(
ÂÂ& '
)
ÂÂ' (
!=
ÂÂ) +
$str
ÂÂ, .
)
ÂÂ. /

verificado
ÂÂ0 :
=
ÂÂ; <
true
ÂÂ= A
;
ÂÂA B
if
ÊÊ 
(
ÊÊ 
!
ÊÊ 

verificado
ÊÊ 
)
ÊÊ  
report
ÊÊ! '
.
ÊÊ' (
Add
ÊÊ( +
(
ÊÊ+ ,
new
ÊÊ, /
MuestraReport
ÊÊ0 =
(
ÊÊ= >
$num
ÊÊ> ?
,
ÊÊ? @
$str
ÊÊA n
,
ÊÊn o
$str
ÊÊp s
,
ÊÊs t
$str
ÊÊu x
,
ÊÊx y
boliviaTimeÊÊz Ö
,ÊÊÖ Ü
$strÊÊá ä
)ÊÊä ã
)ÊÊã å
;ÊÊå ç
return
ÁÁ 
View
ÁÁ 
(
ÁÁ 
report
ÁÁ "
)
ÁÁ" #
;
ÁÁ# $
}
ËË 
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
)
ÈÈ 
{
ÍÍ 
return
ÎÎ 
RedirectToAction
ÎÎ '
(
ÎÎ' (
$str
ÎÎ( /
,
ÎÎ/ 0
$str
ÎÎ1 7
)
ÎÎ7 8
;
ÎÎ8 9
}
ÏÏ 
}
ÌÌ 	
public
ÓÓ 
ActionResult
ÓÓ 
ReportDayEmployee
ÓÓ -
(
ÓÓ- .
string
ÓÓ. 4
id
ÓÓ5 7
)
ÓÓ7 8
{
ÔÔ 	
try
 
{
ÒÒ 
if
ÚÚ 
(
ÚÚ 
id
ÚÚ 
==
ÚÚ 
null
ÚÚ 
)
ÚÚ 
return
ÚÚ  &
RedirectToAction
ÚÚ' 7
(
ÚÚ7 8
$str
ÚÚ8 ?
,
ÚÚ? @
$str
ÚÚA G
)
ÚÚG H
;
ÚÚH I
Login
ÛÛ 
logi
ÛÛ 
=
ÛÛ 
new
ÛÛ  
Login
ÛÛ! &
(
ÛÛ& '
)
ÛÛ' (
;
ÛÛ( )
var
ÙÙ 

authResult
ÙÙ 
=
ÙÙ   
AutenticarPasosRol
ÙÙ! 3
(
ÙÙ3 4
$num
ÙÙ4 5
)
ÙÙ5 6
;
ÙÙ6 7
if
ıı 
(
ıı 

authResult
ıı 
!=
ıı !
null
ıı" &
)
ıı& '
return
ıı( .

authResult
ıı/ 9
;
ıı9 :
string
ˆˆ 
Linea
ˆˆ 
=
ˆˆ 
logi
ˆˆ #
.
ˆˆ# $ 
GetLineaFromCookie
ˆˆ$ 6
(
ˆˆ6 7
Request
ˆˆ7 >
)
ˆˆ> ?
.
ˆˆ? @
ToString
ˆˆ@ H
(
ˆˆH I
)
ˆˆI J
;
ˆˆJ K
ViewBag
˜˜ 
.
˜˜ 
NIT
˜˜ 
=
˜˜ 
id
˜˜  
;
˜˜  !
List
¯¯ 
<
¯¯ 

Checkpoint
¯¯ 
>
¯¯  

checkpoint
¯¯! +
=
¯¯, -
new
¯¯. 1
List
¯¯2 6
<
¯¯6 7

Checkpoint
¯¯7 A
>
¯¯A B
(
¯¯B C
)
¯¯C D
;
¯¯D E
List
˘˘ 
<
˘˘ 
MuestraReport
˘˘ "
>
˘˘" #
report
˘˘$ *
=
˘˘+ ,
new
˘˘- 0
List
˘˘1 5
<
˘˘5 6
MuestraReport
˘˘6 C
>
˘˘C D
(
˘˘D E
)
˘˘E F
;
˘˘F G
Employee
˙˙ 
employee
˙˙ !
=
˙˙" #
new
˙˙$ '
Employee
˙˙( 0
(
˙˙0 1
)
˙˙1 2
;
˙˙2 3
Person
˚˚ 
person
˚˚ 
=
˚˚ 
new
˚˚  #
Person
˚˚$ *
(
˚˚* +
)
˚˚+ ,
;
˚˚, -
TimeZoneInfo
¸¸ 
boliviaTimeZone
¸¸ ,
=
¸¸- .
TimeZoneInfo
¸¸/ ;
.
¸¸; <$
FindSystemTimeZoneById
¸¸< R
(
¸¸R S
$str
¸¸S m
)
¸¸m n
;
¸¸n o
DateTime
˝˝ 
boliviaTime
˝˝ $
=
˝˝% &
TimeZoneInfo
˝˝' 3
.
˝˝3 4
ConvertTime
˝˝4 ?
(
˝˝? @
DateTime
˝˝@ H
.
˝˝H I
UtcNow
˝˝I O
,
˝˝O P
boliviaTimeZone
˝˝Q `
)
˝˝` a
;
˝˝a b
using
˛˛ 
(
˛˛ 
dbModels
˛˛ 
context
˛˛  '
=
˛˛( )
new
˛˛* -
dbModels
˛˛. 6
(
˛˛6 7
)
˛˛7 8
)
˛˛8 9

checkpoint
˛˛: D
=
˛˛E F
context
˛˛G N
.
˛˛N O

Checkpoint
˛˛O Y
.
˛˛Y Z
Where
˛˛Z _
(
˛˛_ `
x
˛˛` a
=>
˛˛b d
x
˛˛e f
.
˛˛f g
idLine
˛˛g m
==
˛˛n p
Linea
˛˛q v
)
˛˛v w
.
˛˛w x
ToList
˛˛x ~
(
˛˛~ 
)˛˛ Ä
;˛˛Ä Å
List
ˇˇ 
<
ˇˇ 
TimeControl
ˇˇ  
>
ˇˇ  !
time
ˇˇ" &
=
ˇˇ' (
new
ˇˇ) ,
List
ˇˇ- 1
<
ˇˇ1 2
TimeControl
ˇˇ2 =
>
ˇˇ= >
(
ˇˇ> ?
)
ˇˇ? @
;
ˇˇ@ A
using
ÄÄ 
(
ÄÄ 
dbModels
ÄÄ 
context
ÄÄ  '
=
ÄÄ( )
new
ÄÄ* -
dbModels
ÄÄ. 6
(
ÄÄ6 7
)
ÄÄ7 8
)
ÄÄ8 9
foreach
ÅÅ 
(
ÅÅ 
var
ÅÅ  
item
ÅÅ! %
in
ÅÅ& (

checkpoint
ÅÅ) 3
)
ÅÅ3 4
{
ÇÇ 
time
ÉÉ 
=
ÉÉ 
context
ÉÉ &
.
ÉÉ& '
TimeControl
ÉÉ' 2
.
ÉÉ2 3
ToList
ÉÉ3 9
(
ÉÉ9 :
)
ÉÉ: ;
.
ÉÉ; <
Where
ÉÉ< A
(
ÉÉA B
x
ÉÉB C
=>
ÉÉD F
x
ÉÉG H
.
ÉÉH I
idCheckpoint
ÉÉI U
==
ÉÉV X
item
ÉÉY ]
.
ÉÉ] ^
idCheckpoint
ÉÉ^ j
&&
ÉÉk m
x
ÉÉn o
.
ÉÉo p

idEmployee
ÉÉp z
==
ÉÉ{ }
idÉÉ~ Ä
&&ÉÉÅ É
DateTimeÉÉÑ å
.ÉÉå ç
ParseÉÉç í
(ÉÉí ì
xÉÉì î
.ÉÉî ï
dateRegisterÉÉï °
.ÉÉ° ¢
ToStringÉÉ¢ ™
(ÉÉ™ ´
)ÉÉ´ ¨
)ÉÉ¨ ≠
.ÉÉ≠ Æ
ToStringÉÉÆ ∂
(ÉÉ∂ ∑
$strÉÉ∑ √
)ÉÉ√ ƒ
==ÉÉ≈ «
boliviaTimeÉÉ» ”
.ÉÉ” ‘
ToStringÉÉ‘ ‹
(ÉÉ‹ ›
$strÉÉ› È
)ÉÉÈ Í
)ÉÉÍ Î
.ÉÉÎ Ï
ToListÉÉÏ Ú
(ÉÉÚ Û
)ÉÉÛ Ù
;ÉÉÙ ı
foreach
ÑÑ 
(
ÑÑ  !
var
ÑÑ! $
item2
ÑÑ% *
in
ÑÑ+ -
time
ÑÑ. 2
)
ÑÑ2 3
report
ÖÖ "
.
ÖÖ" #
Add
ÖÖ# &
(
ÖÖ& '
new
ÖÖ' *
MuestraReport
ÖÖ+ 8
(
ÖÖ8 9
item
ÖÖ9 =
.
ÖÖ= >
idCheckpoint
ÖÖ> J
,
ÖÖJ K
$str
ÖÖL N
,
ÖÖN O
item2
ÖÖP U
.
ÖÖU V

idEmployee
ÖÖV `
,
ÖÖ` a
item2
ÖÖb g
.
ÖÖg h
plate
ÖÖh m
,
ÖÖm n
DateTime
ÖÖo w
.
ÖÖw x
Parse
ÖÖx }
(
ÖÖ} ~
item2ÖÖ~ É
.ÖÖÉ Ñ
dateRegisterÖÖÑ ê
.ÖÖê ë
ToStringÖÖë ô
(ÖÖô ö
)ÖÖö õ
)ÖÖõ ú
,ÖÖú ù
itemÖÖû ¢
.ÖÖ¢ £
descriptionÖÖ£ Æ
)ÖÖÆ Ø
)ÖÖØ ∞
;ÖÖ∞ ±
}
ÜÜ 
using
áá 
(
áá 
dbModels
áá 
context
áá  '
=
áá( )
new
áá* -
dbModels
áá. 6
(
áá6 7
)
áá7 8
)
áá8 9
foreach
àà 
(
àà 
var
àà  
item
àà! %
in
àà& (
report
àà) /
)
àà/ 0
{
ââ 
person
ää 
=
ää  
context
ää! (
.
ää( )
Person
ää) /
.
ää/ 0
Where
ää0 5
(
ää5 6
x
ää6 7
=>
ää8 :
x
ää; <
.
ää< =
nit
ää= @
==
ääA C
item
ääD H
.
ääH I

idEmployee
ääI S
)
ääS T
.
ääT U
FirstOrDefault
ääU c
(
ääc d
)
ääd e
;
ääe f
item
ãã 
.
ãã 
name
ãã !
=
ãã" #
person
ãã$ *
.
ãã* +
name
ãã+ /
+
ãã0 1
$str
ãã2 5
+
ãã6 7
person
ãã8 >
.
ãã> ?
lastname
ãã? G
;
ããG H
}
åå 
using
çç 
(
çç 
dbModels
çç 
context
çç  '
=
çç( )
new
çç* -
dbModels
çç. 6
(
çç6 7
)
çç7 8
)
çç8 9
foreach
éé 
(
éé 
var
éé  
item
éé! %
in
éé& (
report
éé) /
)
éé/ 0
{
èè 
employee
êê  
=
êê! "
context
êê# *
.
êê* +
Employee
êê+ 3
.
êê3 4
Where
êê4 9
(
êê9 :
x
êê: ;
=>
êê< >
x
êê? @
.
êê@ A

idEmployee
êêA K
.
êêK L
ToString
êêL T
(
êêT U
)
êêU V
==
êêW Y
item
êêZ ^
.
êê^ _

idEmployee
êê_ i
.
êêi j
ToString
êêj r
(
êêr s
)
êês t
)
êêt u
.
êêu v
FirstOrDefaultêêv Ñ
(êêÑ Ö
)êêÖ Ü
;êêÜ á
item
ëë 
.
ëë 

idEmployee
ëë '
=
ëë( )
employee
ëë* 2
.
ëë2 3

idEmployee
ëë3 =
;
ëë= >
}
íí 
bool
ìì 

verificado
ìì 
=
ìì  !
false
ìì" '
;
ìì' (
ViewBag
îî 
.
îî 
Hoy
îî 
=
îî 
boliviaTime
îî )
.
îî) *
ToString
îî* 2
(
îî2 3
)
îî3 4
;
îî4 5
Session
ïï 
[
ïï 
$str
ïï %
]
ïï% &
=
ïï' (
id
ïï) +
;
ïï+ ,
foreach
ññ 
(
ññ 
var
ññ 
item
ññ !
in
ññ" $
report
ññ% +
)
ññ+ ,
if
óó 
(
óó 
item
óó 
.
óó 
name
óó !
.
óó! "
Trim
óó" &
(
óó& '
)
óó' (
!=
óó) +
$str
óó, .
)
óó. /

verificado
óó0 :
=
óó; <
true
óó= A
;
óóA B
if
òò 
(
òò 
!
òò 

verificado
òò 
)
òò  
report
òò! '
.
òò' (
Add
òò( +
(
òò+ ,
new
òò, /
MuestraReport
òò0 =
(
òò= >
$num
òò> ?
,
òò? @
$str
òòA j
,
òòj k
$str
òòl o
,
òòo p
$str
òòq t
,
òòt u
boliviaTimeòòv Å
,òòÅ Ç
$stròòÉ Ü
)òòÜ á
)òòá à
;òòà â
return
ôô 
View
ôô 
(
ôô 
report
ôô "
)
ôô" #
;
ôô# $
}
öö 
catch
õõ 
(
õõ 
	Exception
õõ 
)
õõ 
{
úú 
return
ùù 
RedirectToAction
ùù '
(
ùù' (
$str
ùù( /
,
ùù/ 0
$str
ùù1 7
)
ùù7 8
;
ùù8 9
}
ûû 
}
üü 	
public
†† 
ActionResult
†† &
PrintedReportDayEmployee
†† 4
(
††4 5
string
††5 ;
id
††< >
,
††> ?
string
††@ F
linea
††G L
)
††L M
{
°° 	
try
¢¢ 
{
££ 
Login
§§ 
logi
§§ 
=
§§ 
new
§§  
Login
§§! &
(
§§& '
)
§§' (
;
§§( )
string
•• 
Linea
•• 
=
•• 
logi
•• #
.
••# $ 
GetLineaFromCookie
••$ 6
(
••6 7
Request
••7 >
)
••> ?
.
••? @
ToString
••@ H
(
••H I
)
••I J
;
••J K
ViewBag
¶¶ 
.
¶¶ 
NIT
¶¶ 
=
¶¶ 
id
¶¶  
;
¶¶  !
List
ßß 
<
ßß 

Checkpoint
ßß 
>
ßß  

checkpoint
ßß! +
=
ßß, -
new
ßß. 1
List
ßß2 6
<
ßß6 7

Checkpoint
ßß7 A
>
ßßA B
(
ßßB C
)
ßßC D
;
ßßD E
List
®® 
<
®® 
MuestraReport
®® "
>
®®" #
report
®®$ *
=
®®+ ,
new
®®- 0
List
®®1 5
<
®®5 6
MuestraReport
®®6 C
>
®®C D
(
®®D E
)
®®E F
;
®®F G
Employee
©© 
employee
©© !
=
©©" #
new
©©$ '
Employee
©©( 0
(
©©0 1
)
©©1 2
;
©©2 3
Person
™™ 
person
™™ 
=
™™ 
new
™™  #
Person
™™$ *
(
™™* +
)
™™+ ,
;
™™, -
TimeZoneInfo
´´ 
boliviaTimeZone
´´ ,
=
´´- .
TimeZoneInfo
´´/ ;
.
´´; <$
FindSystemTimeZoneById
´´< R
(
´´R S
$str
´´S m
)
´´m n
;
´´n o
DateTime
¨¨ 
boliviaTime
¨¨ $
=
¨¨% &
TimeZoneInfo
¨¨' 3
.
¨¨3 4
ConvertTime
¨¨4 ?
(
¨¨? @
DateTime
¨¨@ H
.
¨¨H I
UtcNow
¨¨I O
,
¨¨O P
boliviaTimeZone
¨¨Q `
)
¨¨` a
;
¨¨a b
using
≠≠ 
(
≠≠ 
dbModels
≠≠ 
context
≠≠  '
=
≠≠( )
new
≠≠* -
dbModels
≠≠. 6
(
≠≠6 7
)
≠≠7 8
)
≠≠8 9

checkpoint
≠≠: D
=
≠≠E F
context
≠≠G N
.
≠≠N O

Checkpoint
≠≠O Y
.
≠≠Y Z
Where
≠≠Z _
(
≠≠_ `
x
≠≠` a
=>
≠≠b d
x
≠≠e f
.
≠≠f g
idLine
≠≠g m
==
≠≠n p
Linea
≠≠q v
)
≠≠v w
.
≠≠w x
ToList
≠≠x ~
(
≠≠~ 
)≠≠ Ä
;≠≠Ä Å
List
ÆÆ 
<
ÆÆ 
TimeControl
ÆÆ  
>
ÆÆ  !
time
ÆÆ" &
=
ÆÆ' (
new
ÆÆ) ,
List
ÆÆ- 1
<
ÆÆ1 2
TimeControl
ÆÆ2 =
>
ÆÆ= >
(
ÆÆ> ?
)
ÆÆ? @
;
ÆÆ@ A
using
ØØ 
(
ØØ 
dbModels
ØØ 
context
ØØ  '
=
ØØ( )
new
ØØ* -
dbModels
ØØ. 6
(
ØØ6 7
)
ØØ7 8
)
ØØ8 9
foreach
∞∞ 
(
∞∞ 
var
∞∞  
item
∞∞! %
in
∞∞& (

checkpoint
∞∞) 3
)
∞∞3 4
{
±± 
time
≤≤ 
=
≤≤ 
context
≤≤ &
.
≤≤& '
TimeControl
≤≤' 2
.
≤≤2 3
ToList
≤≤3 9
(
≤≤9 :
)
≤≤: ;
.
≤≤; <
Where
≤≤< A
(
≤≤A B
x
≤≤B C
=>
≤≤D F
x
≤≤G H
.
≤≤H I
idCheckpoint
≤≤I U
==
≤≤V X
item
≤≤Y ]
.
≤≤] ^
idCheckpoint
≤≤^ j
&&
≤≤k m
x
≤≤n o
.
≤≤o p

idEmployee
≤≤p z
==
≤≤{ }
id≤≤~ Ä
&&≤≤Å É
DateTime≤≤Ñ å
.≤≤å ç
Parse≤≤ç í
(≤≤í ì
x≤≤ì î
.≤≤î ï
dateRegister≤≤ï °
.≤≤° ¢
ToString≤≤¢ ™
(≤≤™ ´
)≤≤´ ¨
)≤≤¨ ≠
.≤≤≠ Æ
ToString≤≤Æ ∂
(≤≤∂ ∑
$str≤≤∑ √
)≤≤√ ƒ
==≤≤≈ «
boliviaTime≤≤» ”
.≤≤” ‘
ToString≤≤‘ ‹
(≤≤‹ ›
$str≤≤› È
)≤≤È Í
)≤≤Í Î
.≤≤Î Ï
ToList≤≤Ï Ú
(≤≤Ú Û
)≤≤Û Ù
;≤≤Ù ı
foreach
≥≥ 
(
≥≥  !
var
≥≥! $
item2
≥≥% *
in
≥≥+ -
time
≥≥. 2
)
≥≥2 3
report
¥¥ "
.
¥¥" #
Add
¥¥# &
(
¥¥& '
new
¥¥' *
MuestraReport
¥¥+ 8
(
¥¥8 9
item
¥¥9 =
.
¥¥= >
idCheckpoint
¥¥> J
,
¥¥J K
$str
¥¥L N
,
¥¥N O
item2
¥¥P U
.
¥¥U V

idEmployee
¥¥V `
,
¥¥` a
item2
¥¥b g
.
¥¥g h
plate
¥¥h m
,
¥¥m n
DateTime
¥¥o w
.
¥¥w x
Parse
¥¥x }
(
¥¥} ~
item2¥¥~ É
.¥¥É Ñ
dateRegister¥¥Ñ ê
.¥¥ê ë
ToString¥¥ë ô
(¥¥ô ö
)¥¥ö õ
)¥¥õ ú
,¥¥ú ù
item¥¥û ¢
.¥¥¢ £
description¥¥£ Æ
)¥¥Æ Ø
)¥¥Ø ∞
;¥¥∞ ±
}
µµ 
using
∂∂ 
(
∂∂ 
dbModels
∂∂ 
context
∂∂  '
=
∂∂( )
new
∂∂* -
dbModels
∂∂. 6
(
∂∂6 7
)
∂∂7 8
)
∂∂8 9
foreach
∑∑ 
(
∑∑ 
var
∑∑  
item
∑∑! %
in
∑∑& (
report
∑∑) /
)
∑∑/ 0
{
∏∏ 
person
ππ 
=
ππ  
context
ππ! (
.
ππ( )
Person
ππ) /
.
ππ/ 0
Where
ππ0 5
(
ππ5 6
x
ππ6 7
=>
ππ8 :
x
ππ; <
.
ππ< =
nit
ππ= @
==
ππA C
item
ππD H
.
ππH I

idEmployee
ππI S
)
ππS T
.
ππT U
FirstOrDefault
ππU c
(
ππc d
)
ππd e
;
ππe f
item
∫∫ 
.
∫∫ 
name
∫∫ !
=
∫∫" #
person
∫∫$ *
.
∫∫* +
name
∫∫+ /
+
∫∫0 1
$str
∫∫2 5
+
∫∫6 7
person
∫∫8 >
.
∫∫> ?
lastname
∫∫? G
;
∫∫G H
}
ªª 
using
ºº 
(
ºº 
dbModels
ºº 
context
ºº  '
=
ºº( )
new
ºº* -
dbModels
ºº. 6
(
ºº6 7
)
ºº7 8
)
ºº8 9
foreach
ΩΩ 
(
ΩΩ 
var
ΩΩ  
item
ΩΩ! %
in
ΩΩ& (
report
ΩΩ) /
)
ΩΩ/ 0
{
ææ 
employee
øø  
=
øø! "
context
øø# *
.
øø* +
Employee
øø+ 3
.
øø3 4
Where
øø4 9
(
øø9 :
x
øø: ;
=>
øø< >
x
øø? @
.
øø@ A

idEmployee
øøA K
.
øøK L
ToString
øøL T
(
øøT U
)
øøU V
==
øøW Y
item
øøZ ^
.
øø^ _

idEmployee
øø_ i
.
øøi j
ToString
øøj r
(
øør s
)
øøs t
)
øøt u
.
øøu v
FirstOrDefaultøøv Ñ
(øøÑ Ö
)øøÖ Ü
;øøÜ á
item
¿¿ 
.
¿¿ 

idEmployee
¿¿ '
=
¿¿( )
employee
¿¿* 2
.
¿¿2 3

idEmployee
¿¿3 =
;
¿¿= >
}
¡¡ 
bool
¬¬ 

verificado
¬¬ 
=
¬¬  !
false
¬¬" '
;
¬¬' (
ViewBag
√√ 
.
√√ 
Hoy
√√ 
=
√√ 
boliviaTime
√√ )
.
√√) *
ToString
√√* 2
(
√√2 3
)
√√3 4
;
√√4 5
foreach
ƒƒ 
(
ƒƒ 
var
ƒƒ 
item
ƒƒ !
in
ƒƒ" $
report
ƒƒ% +
)
ƒƒ+ ,
if
≈≈ 
(
≈≈ 
item
≈≈ 
.
≈≈ 
name
≈≈ !
.
≈≈! "
Trim
≈≈" &
(
≈≈& '
)
≈≈' (
!=
≈≈) +
$str
≈≈, .
)
≈≈. /

verificado
≈≈0 :
=
≈≈; <
true
≈≈= A
;
≈≈A B
if
∆∆ 
(
∆∆ 
!
∆∆ 

verificado
∆∆ 
)
∆∆  
report
∆∆! '
.
∆∆' (
Add
∆∆( +
(
∆∆+ ,
new
∆∆, /
MuestraReport
∆∆0 =
(
∆∆= >
$num
∆∆> ?
,
∆∆? @
$str
∆∆A j
,
∆∆j k
$str
∆∆l o
,
∆∆o p
$str
∆∆q t
,
∆∆t u
boliviaTime∆∆v Å
,∆∆Å Ç
$str∆∆É Ü
)∆∆Ü á
)∆∆á à
;∆∆à â
return
«« 
View
«« 
(
«« 
report
«« "
)
««" #
;
««# $
}
»» 
catch
…… 
(
…… 
	Exception
…… 
)
…… 
{
   
return
ÀÀ 
RedirectToAction
ÀÀ '
(
ÀÀ' (
$str
ÀÀ( /
,
ÀÀ/ 0
$str
ÀÀ1 7
)
ÀÀ7 8
;
ÀÀ8 9
}
ÃÃ 
}
ÕÕ 	
public
ŒŒ 
ActionResult
ŒŒ (
ReportRequestDatesEmployee
ŒŒ 6
(
ŒŒ6 7
)
ŒŒ7 8
{
œœ 	
var
–– 

authResult
–– 
=
––  
AutenticarPasosRol
–– /
(
––/ 0
$num
––0 1
)
––1 2
;
––2 3
if
—— 
(
—— 

authResult
—— 
!=
—— 
null
—— "
)
——" #
return
——$ *

authResult
——+ 5
;
——5 6
if
““ 
(
““ 
Session
““ 
[
““ 
$str
““ %
]
““% &
==
““' )
null
““* .
)
““. /
return
““0 6
RedirectToAction
““7 G
(
““G H
$str
““H O
,
““O P
$str
““Q W
)
““W X
;
““X Y
string
”” 
id
”” 
=
”” 
Session
”” 
[
””  
$str
””  -
]
””- .
.
””. /
ToString
””/ 7
(
””7 8
)
””8 9
;
””9 :
ViewBag
‘‘ 
.
‘‘ 
NIT
‘‘ 
=
‘‘ 
id
‘‘ 
;
‘‘ 
Session
’’ 
[
’’ 
$str
’’ 
]
’’ 
=
’’  !
id
’’" $
;
’’$ %
Session
÷÷ 
[
÷÷ 
$str
÷÷ 
]
÷÷ 
=
÷÷ 
null
÷÷ #
;
÷÷# $
Session
÷÷% ,
[
÷÷, -
$str
÷÷- 2
]
÷÷2 3
=
÷÷4 5
null
÷÷6 :
;
÷÷: ;
return
◊◊ 
View
◊◊ 
(
◊◊ 
)
◊◊ 
;
◊◊ 
}
ÿÿ 	
[
ŸŸ 	
HttpPost
ŸŸ	 
]
ŸŸ 
public
⁄⁄ 
ActionResult
⁄⁄ (
ReportRequestDatesEmployee
⁄⁄ 6
(
⁄⁄6 7
ReportDates
⁄⁄7 B
report
⁄⁄C I
)
⁄⁄I J
{
€€ 	
try
‹‹ 
{
›› 
var
ﬁﬁ 

authResult
ﬁﬁ 
=
ﬁﬁ   
AutenticarPasosRol
ﬁﬁ! 3
(
ﬁﬁ3 4
$num
ﬁﬁ4 5
)
ﬁﬁ5 6
;
ﬁﬁ6 7
if
ﬂﬂ 
(
ﬂﬂ 

authResult
ﬂﬂ 
!=
ﬂﬂ !
null
ﬂﬂ" &
)
ﬂﬂ& '
return
ﬂﬂ( .

authResult
ﬂﬂ/ 9
;
ﬂﬂ9 :
Session
‡‡ 
[
‡‡ 
$str
‡‡ 
]
‡‡  
=
‡‡! "
report
‡‡# )
.
‡‡) *
start
‡‡* /
;
‡‡/ 0
Session
‡‡1 8
[
‡‡8 9
$str
‡‡9 >
]
‡‡> ?
=
‡‡@ A
report
‡‡B H
.
‡‡H I
end
‡‡I L
;
‡‡L M
if
·· 
(
·· 
report
·· 
.
·· 
end
·· 
<
··  
report
··! '
.
··' (
start
··( -
)
··- .
{
‚‚ 
ViewBag
„„ 
.
„„ 
note
„„  
=
„„! "
$str
„„# @
;
„„@ A
return
‰‰ 
View
‰‰ 
(
‰‰  
)
‰‰  !
;
‰‰! "
}
ÂÂ 
return
ÊÊ 
RedirectToAction
ÊÊ '
(
ÊÊ' (
$str
ÊÊ( =
)
ÊÊ= >
;
ÊÊ> ?
}
ÁÁ 
catch
ËË 
(
ËË 
	Exception
ËË 
)
ËË 
{
ÈÈ 
return
ÍÍ 
RedirectToAction
ÍÍ '
(
ÍÍ' (
$str
ÍÍ( /
,
ÍÍ/ 0
$str
ÍÍ1 7
)
ÍÍ7 8
;
ÍÍ8 9
}
ÎÎ 
}
ÏÏ 	
public
ÓÓ 
ActionResult
ÓÓ !
ReportDatesEmployee
ÓÓ /
(
ÓÓ/ 0
)
ÓÓ0 1
{
ÔÔ 	
try
 
{
ÒÒ 
Login
ÚÚ 
logi
ÚÚ 
=
ÚÚ 
new
ÚÚ  
Login
ÚÚ! &
(
ÚÚ& '
)
ÚÚ' (
;
ÚÚ( )
var
ÛÛ 

authResult
ÛÛ 
=
ÛÛ   
AutenticarPasosRol
ÛÛ! 3
(
ÛÛ3 4
$num
ÛÛ4 5
)
ÛÛ5 6
;
ÛÛ6 7
if
ÙÙ 
(
ÙÙ 

authResult
ÙÙ 
!=
ÙÙ !
null
ÙÙ" &
)
ÙÙ& '
return
ÙÙ( .

authResult
ÙÙ/ 9
;
ÙÙ9 :
string
ıı 
Linea
ıı 
=
ıı 
logi
ıı #
.
ıı# $ 
GetLineaFromCookie
ıı$ 6
(
ıı6 7
Request
ıı7 >
)
ıı> ?
.
ıı? @
ToString
ıı@ H
(
ııH I
)
ııI J
;
ııJ K
if
ˆˆ 
(
ˆˆ 
Session
ˆˆ 
[
ˆˆ 
$str
ˆˆ #
]
ˆˆ# $
==
ˆˆ% '
null
ˆˆ( ,
||
ˆˆ- /
Session
ˆˆ0 7
[
ˆˆ7 8
$str
ˆˆ8 =
]
ˆˆ= >
==
ˆˆ? A
null
ˆˆB F
||
ˆˆG I
Session
ˆˆJ Q
[
ˆˆQ R
$str
ˆˆR \
]
ˆˆ\ ]
==
ˆˆ^ `
null
ˆˆa e
)
ˆˆe f
return
ˆˆg m
RedirectToAction
ˆˆn ~
(
ˆˆ~ 
$strˆˆ Ü
,ˆˆÜ á
$strˆˆà é
)ˆˆé è
;ˆˆè ê
string
˜˜ 
id
˜˜ 
=
˜˜ 
Session
˜˜ #
[
˜˜# $
$str
˜˜$ .
]
˜˜. /
.
˜˜/ 0
ToString
˜˜0 8
(
˜˜8 9
)
˜˜9 :
;
˜˜: ;
DateTime
¯¯ 
start
¯¯ 
=
¯¯  
DateTime
¯¯! )
.
¯¯) *
Parse
¯¯* /
(
¯¯/ 0
Session
¯¯0 7
[
¯¯7 8
$str
¯¯8 ?
]
¯¯? @
.
¯¯@ A
ToString
¯¯A I
(
¯¯I J
)
¯¯J K
)
¯¯K L
;
¯¯L M
DateTime
˘˘ 
end
˘˘ 
=
˘˘ 
DateTime
˘˘ '
.
˘˘' (
Parse
˘˘( -
(
˘˘- .
Session
˘˘. 5
[
˘˘5 6
$str
˘˘6 ;
]
˘˘; <
.
˘˘< =
ToString
˘˘= E
(
˘˘E F
)
˘˘F G
)
˘˘G H
;
˘˘H I
ViewBag
˙˙ 
.
˙˙ 
NIT
˙˙ 
=
˙˙ 
id
˙˙  
;
˙˙  !
List
˚˚ 
<
˚˚ 

Checkpoint
˚˚ 
>
˚˚  

checkpoint
˚˚! +
=
˚˚, -
new
˚˚. 1
List
˚˚2 6
<
˚˚6 7

Checkpoint
˚˚7 A
>
˚˚A B
(
˚˚B C
)
˚˚C D
;
˚˚D E
List
¸¸ 
<
¸¸ 
MuestraReport
¸¸ "
>
¸¸" #
report
¸¸$ *
=
¸¸+ ,
new
¸¸- 0
List
¸¸1 5
<
¸¸5 6
MuestraReport
¸¸6 C
>
¸¸C D
(
¸¸D E
)
¸¸E F
;
¸¸F G
Employee
˝˝ 
employee
˝˝ !
=
˝˝" #
new
˝˝$ '
Employee
˝˝( 0
(
˝˝0 1
)
˝˝1 2
;
˝˝2 3
Person
˛˛ 
person
˛˛ 
=
˛˛ 
new
˛˛  #
Person
˛˛$ *
(
˛˛* +
)
˛˛+ ,
;
˛˛, -
TimeZoneInfo
ˇˇ 
boliviaTimeZone
ˇˇ ,
=
ˇˇ- .
TimeZoneInfo
ˇˇ/ ;
.
ˇˇ; <$
FindSystemTimeZoneById
ˇˇ< R
(
ˇˇR S
$str
ˇˇS m
)
ˇˇm n
;
ˇˇn o
DateTime
ÄÄ 
boliviaTime
ÄÄ $
=
ÄÄ% &
TimeZoneInfo
ÄÄ' 3
.
ÄÄ3 4
ConvertTime
ÄÄ4 ?
(
ÄÄ? @
DateTime
ÄÄ@ H
.
ÄÄH I
UtcNow
ÄÄI O
,
ÄÄO P
boliviaTimeZone
ÄÄQ `
)
ÄÄ` a
;
ÄÄa b
using
ÅÅ 
(
ÅÅ 
dbModels
ÅÅ 
context
ÅÅ  '
=
ÅÅ( )
new
ÅÅ* -
dbModels
ÅÅ. 6
(
ÅÅ6 7
)
ÅÅ7 8
)
ÅÅ8 9

checkpoint
ÅÅ: D
=
ÅÅE F
context
ÅÅG N
.
ÅÅN O

Checkpoint
ÅÅO Y
.
ÅÅY Z
Where
ÅÅZ _
(
ÅÅ_ `
x
ÅÅ` a
=>
ÅÅb d
x
ÅÅe f
.
ÅÅf g
idLine
ÅÅg m
==
ÅÅn p
Linea
ÅÅq v
)
ÅÅv w
.
ÅÅw x
ToList
ÅÅx ~
(
ÅÅ~ 
)ÅÅ Ä
;ÅÅÄ Å
List
ÇÇ 
<
ÇÇ 
TimeControl
ÇÇ  
>
ÇÇ  !
time
ÇÇ" &
=
ÇÇ' (
new
ÇÇ) ,
List
ÇÇ- 1
<
ÇÇ1 2
TimeControl
ÇÇ2 =
>
ÇÇ= >
(
ÇÇ> ?
)
ÇÇ? @
;
ÇÇ@ A
end
ÉÉ 
=
ÉÉ 
end
ÉÉ 
.
ÉÉ 
AddDays
ÉÉ !
(
ÉÉ! "
$num
ÉÉ" #
)
ÉÉ# $
;
ÉÉ$ %
using
ÑÑ 
(
ÑÑ 
dbModels
ÑÑ 
context
ÑÑ  '
=
ÑÑ( )
new
ÑÑ* -
dbModels
ÑÑ. 6
(
ÑÑ6 7
)
ÑÑ7 8
)
ÑÑ8 9
foreach
ÖÖ 
(
ÖÖ 
var
ÖÖ  
item
ÖÖ! %
in
ÖÖ& (

checkpoint
ÖÖ) 3
)
ÖÖ3 4
{
ÜÜ 
time
áá 
=
áá 
context
áá &
.
áá& '
TimeControl
áá' 2
.
áá2 3
ToList
áá3 9
(
áá9 :
)
áá: ;
.
áá; <
Where
áá< A
(
ááA B
x
ááB C
=>
ááD F
x
ááG H
.
ááH I
idCheckpoint
ááI U
==
ááV X
item
ááY ]
.
áá] ^
idCheckpoint
áá^ j
&&
áák m
x
áán o
.
ááo p

idEmployee
ááp z
==
áá{ }
idáá~ Ä
&&ááÅ É
xááÑ Ö
.ááÖ Ü
dateRegisterááÜ í
>=ááì ï
startááñ õ
&&ááú û
xááü †
.áá† °
dateRegisteráá° ≠
<=ááÆ ∞
endáá± ¥
)áá¥ µ
.ááµ ∂
ToListáá∂ º
(ááº Ω
)ááΩ æ
;ááæ ø
foreach
àà 
(
àà  !
var
àà! $
item2
àà% *
in
àà+ -
time
àà. 2
)
àà2 3
report
ââ "
.
ââ" #
Add
ââ# &
(
ââ& '
new
ââ' *
MuestraReport
ââ+ 8
(
ââ8 9
item
ââ9 =
.
ââ= >
idCheckpoint
ââ> J
,
ââJ K
$str
ââL N
,
ââN O
item2
ââP U
.
ââU V

idEmployee
ââV `
,
ââ` a
item2
ââb g
.
ââg h
plate
ââh m
,
ââm n
DateTime
ââo w
.
ââw x
Parse
ââx }
(
ââ} ~
item2ââ~ É
.ââÉ Ñ
dateRegisterââÑ ê
.ââê ë
ToStringââë ô
(ââô ö
)ââö õ
)ââõ ú
,ââú ù
itemââû ¢
.ââ¢ £
descriptionââ£ Æ
)ââÆ Ø
)ââØ ∞
;ââ∞ ±
}
ää 
using
ãã 
(
ãã 
dbModels
ãã 
context
ãã  '
=
ãã( )
new
ãã* -
dbModels
ãã. 6
(
ãã6 7
)
ãã7 8
)
ãã8 9
foreach
åå 
(
åå 
var
åå  
item
åå! %
in
åå& (
report
åå) /
)
åå/ 0
{
çç 
person
éé 
=
éé  
context
éé! (
.
éé( )
Person
éé) /
.
éé/ 0
Where
éé0 5
(
éé5 6
x
éé6 7
=>
éé8 :
x
éé; <
.
éé< =
nit
éé= @
==
ééA C
item
ééD H
.
ééH I

idEmployee
ééI S
)
ééS T
.
ééT U
FirstOrDefault
ééU c
(
ééc d
)
ééd e
;
éée f
item
èè 
.
èè 
name
èè !
=
èè" #
person
èè$ *
.
èè* +
name
èè+ /
+
èè0 1
$str
èè2 5
+
èè6 7
person
èè8 >
.
èè> ?
lastname
èè? G
;
èèG H
}
êê 
using
ëë 
(
ëë 
dbModels
ëë 
context
ëë  '
=
ëë( )
new
ëë* -
dbModels
ëë. 6
(
ëë6 7
)
ëë7 8
)
ëë8 9
foreach
íí 
(
íí 
var
íí  
item
íí! %
in
íí& (
report
íí) /
)
íí/ 0
{
ìì 
employee
îî  
=
îî! "
context
îî# *
.
îî* +
Employee
îî+ 3
.
îî3 4
Where
îî4 9
(
îî9 :
x
îî: ;
=>
îî< >
x
îî? @
.
îî@ A

idEmployee
îîA K
==
îîL N
item
îîO S
.
îîS T

idEmployee
îîT ^
)
îî^ _
.
îî_ `
FirstOrDefault
îî` n
(
îîn o
)
îîo p
;
îîp q
item
ïï 
.
ïï 

idEmployee
ïï '
=
ïï( )
employee
ïï* 2
.
ïï2 3

idEmployee
ïï3 =
;
ïï= >
}
ññ 
bool
óó 

verificado
óó 
=
óó  !
false
óó" '
;
óó' (
ViewBag
òò 
.
òò 
Start
òò 
=
òò 
start
òò  %
.
òò% &
ToString
òò& .
(
òò. /
$str
òò/ ;
)
òò; <
;
òò< =
ViewBag
ôô 
.
ôô 
End
ôô 
=
ôô 
end
ôô !
.
ôô! "
ToString
ôô" *
(
ôô* +
$str
ôô+ 7
)
ôô7 8
;
ôô8 9
ViewBag
öö 
.
öö 
Hoy
öö 
=
öö 
boliviaTime
öö )
.
öö) *
ToString
öö* 2
(
öö2 3
)
öö3 4
;
öö4 5
foreach
õõ 
(
õõ 
var
õõ 
item
õõ !
in
õõ" $
report
õõ% +
)
õõ+ ,
if
úú 
(
úú 
item
úú 
.
úú 
name
úú !
.
úú! "
Trim
úú" &
(
úú& '
)
úú' (
!=
úú) +
$str
úú, .
)
úú. /

verificado
úú0 :
=
úú; <
true
úú= A
;
úúA B
if
ùù 
(
ùù 
!
ùù 

verificado
ùù 
)
ùù  
report
ùù! '
.
ùù' (
Add
ùù( +
(
ùù+ ,
new
ùù, /
MuestraReport
ùù0 =
(
ùù= >
$num
ùù> ?
,
ùù? @
$str
ùùA n
,
ùùn o
$str
ùùp s
,
ùùs t
$str
ùùu x
,
ùùx y
boliviaTimeùùz Ö
,ùùÖ Ü
$strùùá ä
)ùùä ã
)ùùã å
;ùùå ç
return
ûû 
View
ûû 
(
ûû 
report
ûû "
)
ûû" #
;
ûû# $
}
üü 
catch
†† 
(
†† 
	Exception
†† 
)
†† 
{
°° 
return
¢¢ 
RedirectToAction
¢¢ '
(
¢¢' (
$str
¢¢( /
,
¢¢/ 0
$str
¢¢1 7
)
¢¢7 8
;
¢¢8 9
}
££ 
}
§§ 	
public
•• 
ActionResult
•• (
PrintedReportDatesEmployee
•• 6
(
••6 7
string
••7 =
id
••> @
,
••@ A
DateTime
••B J
start
••K P
,
••P Q
DateTime
••R Z
end
••[ ^
,
••^ _
string
••` f
linea
••g l
)
••l m
{
¶¶ 	
try
ßß 
{
®® 
Login
©© 
logi
©© 
=
©© 
new
©©  
Login
©©! &
(
©©& '
)
©©' (
;
©©( )
string
™™ 
Linea
™™ 
=
™™ 
logi
™™ #
.
™™# $ 
GetLineaFromCookie
™™$ 6
(
™™6 7
Request
™™7 >
)
™™> ?
.
™™? @
ToString
™™@ H
(
™™H I
)
™™I J
;
™™J K
ViewBag
´´ 
.
´´ 
NIT
´´ 
=
´´ 
id
´´  
;
´´  !
List
¨¨ 
<
¨¨ 

Checkpoint
¨¨ 
>
¨¨  

checkpoint
¨¨! +
=
¨¨, -
new
¨¨. 1
List
¨¨2 6
<
¨¨6 7

Checkpoint
¨¨7 A
>
¨¨A B
(
¨¨B C
)
¨¨C D
;
¨¨D E
List
≠≠ 
<
≠≠ 
MuestraReport
≠≠ "
>
≠≠" #
report
≠≠$ *
=
≠≠+ ,
new
≠≠- 0
List
≠≠1 5
<
≠≠5 6
MuestraReport
≠≠6 C
>
≠≠C D
(
≠≠D E
)
≠≠E F
;
≠≠F G
Employee
ÆÆ 
employee
ÆÆ !
=
ÆÆ" #
new
ÆÆ$ '
Employee
ÆÆ( 0
(
ÆÆ0 1
)
ÆÆ1 2
;
ÆÆ2 3
Person
ØØ 
person
ØØ 
=
ØØ 
new
ØØ  #
Person
ØØ$ *
(
ØØ* +
)
ØØ+ ,
;
ØØ, -
TimeZoneInfo
∞∞ 
boliviaTimeZone
∞∞ ,
=
∞∞- .
TimeZoneInfo
∞∞/ ;
.
∞∞; <$
FindSystemTimeZoneById
∞∞< R
(
∞∞R S
$str
∞∞S m
)
∞∞m n
;
∞∞n o
DateTime
±± 
boliviaTime
±± $
=
±±% &
TimeZoneInfo
±±' 3
.
±±3 4
ConvertTime
±±4 ?
(
±±? @
DateTime
±±@ H
.
±±H I
UtcNow
±±I O
,
±±O P
boliviaTimeZone
±±Q `
)
±±` a
;
±±a b
using
≤≤ 
(
≤≤ 
dbModels
≤≤ 
context
≤≤  '
=
≤≤( )
new
≤≤* -
dbModels
≤≤. 6
(
≤≤6 7
)
≤≤7 8
)
≤≤8 9

checkpoint
≤≤: D
=
≤≤E F
context
≤≤G N
.
≤≤N O

Checkpoint
≤≤O Y
.
≤≤Y Z
Where
≤≤Z _
(
≤≤_ `
x
≤≤` a
=>
≤≤b d
x
≤≤e f
.
≤≤f g
idLine
≤≤g m
==
≤≤n p
Linea
≤≤q v
)
≤≤v w
.
≤≤w x
ToList
≤≤x ~
(
≤≤~ 
)≤≤ Ä
;≤≤Ä Å
List
≥≥ 
<
≥≥ 
TimeControl
≥≥  
>
≥≥  !
time
≥≥" &
=
≥≥' (
new
≥≥) ,
List
≥≥- 1
<
≥≥1 2
TimeControl
≥≥2 =
>
≥≥= >
(
≥≥> ?
)
≥≥? @
;
≥≥@ A
end
¥¥ 
=
¥¥ 
end
¥¥ 
.
¥¥ 
AddDays
¥¥ !
(
¥¥! "
$num
¥¥" #
)
¥¥# $
;
¥¥$ %
using
µµ 
(
µµ 
dbModels
µµ 
context
µµ  '
=
µµ( )
new
µµ* -
dbModels
µµ. 6
(
µµ6 7
)
µµ7 8
)
µµ8 9
foreach
∂∂ 
(
∂∂ 
var
∂∂  
item
∂∂! %
in
∂∂& (

checkpoint
∂∂) 3
)
∂∂3 4
{
∑∑ 
time
∏∏ 
=
∏∏ 
context
∏∏ &
.
∏∏& '
TimeControl
∏∏' 2
.
∏∏2 3
ToList
∏∏3 9
(
∏∏9 :
)
∏∏: ;
.
∏∏; <
Where
∏∏< A
(
∏∏A B
x
∏∏B C
=>
∏∏D F
x
∏∏G H
.
∏∏H I
idCheckpoint
∏∏I U
==
∏∏V X
item
∏∏Y ]
.
∏∏] ^
idCheckpoint
∏∏^ j
&&
∏∏k m
x
∏∏n o
.
∏∏o p

idEmployee
∏∏p z
==
∏∏{ }
id∏∏~ Ä
&&∏∏Å É
x∏∏Ñ Ö
.∏∏Ö Ü
dateRegister∏∏Ü í
>=∏∏ì ï
start∏∏ñ õ
&&∏∏ú û
x∏∏ü †
.∏∏† °
dateRegister∏∏° ≠
<=∏∏Æ ∞
end∏∏± ¥
)∏∏¥ µ
.∏∏µ ∂
ToList∏∏∂ º
(∏∏º Ω
)∏∏Ω æ
;∏∏æ ø
foreach
ππ 
(
ππ  !
var
ππ! $
item2
ππ% *
in
ππ+ -
time
ππ. 2
)
ππ2 3
report
∫∫ "
.
∫∫" #
Add
∫∫# &
(
∫∫& '
new
∫∫' *
MuestraReport
∫∫+ 8
(
∫∫8 9
item
∫∫9 =
.
∫∫= >
idCheckpoint
∫∫> J
,
∫∫J K
$str
∫∫L N
,
∫∫N O
item2
∫∫P U
.
∫∫U V

idEmployee
∫∫V `
,
∫∫` a
item2
∫∫b g
.
∫∫g h
plate
∫∫h m
,
∫∫m n
DateTime
∫∫o w
.
∫∫w x
Parse
∫∫x }
(
∫∫} ~
item2∫∫~ É
.∫∫É Ñ
dateRegister∫∫Ñ ê
.∫∫ê ë
ToString∫∫ë ô
(∫∫ô ö
)∫∫ö õ
)∫∫õ ú
,∫∫ú ù
item∫∫û ¢
.∫∫¢ £
description∫∫£ Æ
)∫∫Æ Ø
)∫∫Ø ∞
;∫∫∞ ±
}
ªª 
using
ºº 
(
ºº 
dbModels
ºº 
context
ºº  '
=
ºº( )
new
ºº* -
dbModels
ºº. 6
(
ºº6 7
)
ºº7 8
)
ºº8 9
foreach
ΩΩ 
(
ΩΩ 
var
ΩΩ  
item
ΩΩ! %
in
ΩΩ& (
report
ΩΩ) /
)
ΩΩ/ 0
{
ææ 
person
øø 
=
øø  
context
øø! (
.
øø( )
Person
øø) /
.
øø/ 0
Where
øø0 5
(
øø5 6
x
øø6 7
=>
øø8 :
x
øø; <
.
øø< =
nit
øø= @
==
øøA C
item
øøD H
.
øøH I

idEmployee
øøI S
)
øøS T
.
øøT U
FirstOrDefault
øøU c
(
øøc d
)
øød e
;
øøe f
item
¿¿ 
.
¿¿ 
name
¿¿ !
=
¿¿" #
person
¿¿$ *
.
¿¿* +
name
¿¿+ /
+
¿¿0 1
$str
¿¿2 5
+
¿¿6 7
person
¿¿8 >
.
¿¿> ?
lastname
¿¿? G
;
¿¿G H
}
¡¡ 
using
¬¬ 
(
¬¬ 
dbModels
¬¬ 
context
¬¬  '
=
¬¬( )
new
¬¬* -
dbModels
¬¬. 6
(
¬¬6 7
)
¬¬7 8
)
¬¬8 9
foreach
√√ 
(
√√ 
var
√√  
item
√√! %
in
√√& (
report
√√) /
)
√√/ 0
{
ƒƒ 
employee
≈≈  
=
≈≈! "
context
≈≈# *
.
≈≈* +
Employee
≈≈+ 3
.
≈≈3 4
Where
≈≈4 9
(
≈≈9 :
x
≈≈: ;
=>
≈≈< >
x
≈≈? @
.
≈≈@ A

idEmployee
≈≈A K
==
≈≈L N
item
≈≈O S
.
≈≈S T

idEmployee
≈≈T ^
)
≈≈^ _
.
≈≈_ `
FirstOrDefault
≈≈` n
(
≈≈n o
)
≈≈o p
;
≈≈p q
item
∆∆ 
.
∆∆ 

idEmployee
∆∆ '
=
∆∆( )
employee
∆∆* 2
.
∆∆2 3

idEmployee
∆∆3 =
;
∆∆= >
}
«« 
bool
»» 

verificado
»» 
=
»»  !
false
»»" '
;
»»' (
ViewBag
…… 
.
…… 
Start
…… 
=
…… 
start
……  %
.
……% &
ToString
……& .
(
……. /
$str
……/ ;
)
……; <
;
……< =
ViewBag
   
.
   
End
   
=
   
end
   !
.
  ! "
ToString
  " *
(
  * +
$str
  + 7
)
  7 8
;
  8 9
ViewBag
ÀÀ 
.
ÀÀ 
Hoy
ÀÀ 
=
ÀÀ 
boliviaTime
ÀÀ )
.
ÀÀ) *
ToString
ÀÀ* 2
(
ÀÀ2 3
)
ÀÀ3 4
;
ÀÀ4 5
foreach
ÃÃ 
(
ÃÃ 
var
ÃÃ 
item
ÃÃ !
in
ÃÃ" $
report
ÃÃ% +
)
ÃÃ+ ,
if
ÕÕ 
(
ÕÕ 
item
ÕÕ 
.
ÕÕ 
name
ÕÕ !
.
ÕÕ! "
Trim
ÕÕ" &
(
ÕÕ& '
)
ÕÕ' (
!=
ÕÕ) +
$str
ÕÕ, .
)
ÕÕ. /

verificado
ÕÕ0 :
=
ÕÕ; <
true
ÕÕ= A
;
ÕÕA B
if
ŒŒ 
(
ŒŒ 
!
ŒŒ 

verificado
ŒŒ 
)
ŒŒ  
report
ŒŒ! '
.
ŒŒ' (
Add
ŒŒ( +
(
ŒŒ+ ,
new
ŒŒ, /
MuestraReport
ŒŒ0 =
(
ŒŒ= >
$num
ŒŒ> ?
,
ŒŒ? @
$str
ŒŒA n
,
ŒŒn o
$str
ŒŒp s
,
ŒŒs t
$str
ŒŒu x
,
ŒŒx y
boliviaTimeŒŒz Ö
,ŒŒÖ Ü
$strŒŒá ä
)ŒŒä ã
)ŒŒã å
;ŒŒå ç
return
œœ 
View
œœ 
(
œœ 
report
œœ "
)
œœ" #
;
œœ# $
}
–– 
catch
—— 
(
—— 
	Exception
—— 
)
—— 
{
““ 
return
”” 
RedirectToAction
”” '
(
””' (
$str
””( /
,
””/ 0
$str
””1 7
)
””7 8
;
””8 9
}
‘‘ 
}
’’ 	
public
÷÷ 
ActionResult
÷÷ 
PrintReportDay
÷÷ *
(
÷÷* +
)
÷÷+ ,
{
◊◊ 	
Login
ÿÿ 
logi
ÿÿ 
=
ÿÿ 
new
ÿÿ 
Login
ÿÿ "
(
ÿÿ" #
)
ÿÿ# $
;
ÿÿ$ %
var
ŸŸ 

authResult
ŸŸ 
=
ŸŸ  
AutenticarPasosRol
ŸŸ /
(
ŸŸ/ 0
$num
ŸŸ0 1
)
ŸŸ1 2
;
ŸŸ2 3
if
⁄⁄ 
(
⁄⁄ 

authResult
⁄⁄ 
!=
⁄⁄ 
null
⁄⁄ "
)
⁄⁄" #
return
⁄⁄$ *

authResult
⁄⁄+ 5
;
⁄⁄5 6
string
€€ 
Linea
€€ 
=
€€ 
logi
€€ 
.
€€   
GetLineaFromCookie
€€  2
(
€€2 3
Request
€€3 :
)
€€: ;
.
€€; <
ToString
€€< D
(
€€D E
)
€€E F
;
€€F G
TimeZoneInfo
‹‹ 
boliviaTimeZone
‹‹ (
=
‹‹) *
TimeZoneInfo
‹‹+ 7
.
‹‹7 8$
FindSystemTimeZoneById
‹‹8 N
(
‹‹N O
$str
‹‹O i
)
‹‹i j
;
‹‹j k
DateTime
›› 
boliviaTime
››  
=
››! "
TimeZoneInfo
››# /
.
››/ 0
ConvertTime
››0 ;
(
››; <
DateTime
››< D
.
››D E
UtcNow
››E K
,
››K L
boliviaTimeZone
››M \
)
››\ ]
;
››] ^
return
ﬁﬁ 
new
ﬁﬁ 
ActionAsPdf
ﬁﬁ "
(
ﬁﬁ" #
$str
ﬁﬁ# 5
,
ﬁﬁ5 6
new
ﬁﬁ7 :
{
ﬁﬁ; <
linea
ﬁﬁ< A
=
ﬁﬁB C
Linea
ﬁﬁD I
.
ﬁﬁI J
ToString
ﬁﬁJ R
(
ﬁﬁR S
)
ﬁﬁS T
}
ﬁﬁT U
)
ﬁﬁU V
{
ﬁﬁW X
FileName
ﬁﬁY a
=
ﬁﬁb c
$str
ﬁﬁd p
+
ﬁﬁq r
boliviaTime
ﬁﬁs ~
.
ﬁﬁ~ 
Dayﬁﬁ Ç
+ﬁﬁÉ Ñ
boliviaTimeﬁﬁÖ ê
.ﬁﬁê ë
Monthﬁﬁë ñ
+ﬁﬁó ò
boliviaTimeﬁﬁô §
.ﬁﬁ§ •
Yearﬁﬁ• ©
+ﬁﬁ™ ´
$strﬁﬁ¨ ≤
}ﬁﬁ≥ ¥
;ﬁﬁ¥ µ
}
ﬂﬂ 	
public
‡‡ 
ActionResult
‡‡ $
PrintReportDayEmployee
‡‡ 2
(
‡‡2 3
)
‡‡3 4
{
·· 	
Login
‚‚ 
logi
‚‚ 
=
‚‚ 
new
‚‚ 
Login
‚‚ "
(
‚‚" #
)
‚‚# $
;
‚‚$ %
var
„„ 

authResult
„„ 
=
„„  
AutenticarPasosRol
„„ /
(
„„/ 0
$num
„„0 1
)
„„1 2
;
„„2 3
if
‰‰ 
(
‰‰ 

authResult
‰‰ 
!=
‰‰ 
null
‰‰ "
)
‰‰" #
return
‰‰$ *

authResult
‰‰+ 5
;
‰‰5 6
string
ÂÂ 
Linea
ÂÂ 
=
ÂÂ 
logi
ÂÂ 
.
ÂÂ   
GetLineaFromCookie
ÂÂ  2
(
ÂÂ2 3
Request
ÂÂ3 :
)
ÂÂ: ;
.
ÂÂ; <
ToString
ÂÂ< D
(
ÂÂD E
)
ÂÂE F
;
ÂÂF G
if
ÊÊ 
(
ÊÊ 
Session
ÊÊ 
[
ÊÊ 
$str
ÊÊ %
]
ÊÊ% &
==
ÊÊ' )
null
ÊÊ* .
)
ÊÊ. /
return
ÊÊ0 6
RedirectToAction
ÊÊ7 G
(
ÊÊG H
$str
ÊÊH O
,
ÊÊO P
$str
ÊÊQ W
)
ÊÊW X
;
ÊÊX Y
TimeZoneInfo
ÁÁ 
boliviaTimeZone
ÁÁ (
=
ÁÁ) *
TimeZoneInfo
ÁÁ+ 7
.
ÁÁ7 8$
FindSystemTimeZoneById
ÁÁ8 N
(
ÁÁN O
$str
ÁÁO i
)
ÁÁi j
;
ÁÁj k
DateTime
ËË 
boliviaTime
ËË  
=
ËË! "
TimeZoneInfo
ËË# /
.
ËË/ 0
ConvertTime
ËË0 ;
(
ËË; <
DateTime
ËË< D
.
ËËD E
UtcNow
ËËE K
,
ËËK L
boliviaTimeZone
ËËM \
)
ËË\ ]
;
ËË] ^
return
ÈÈ 
new
ÈÈ 
ActionAsPdf
ÈÈ "
(
ÈÈ" #
$str
ÈÈ# =
,
ÈÈ= >
new
ÈÈ? B
{
ÈÈC D
id
ÈÈD F
=
ÈÈG H
Session
ÈÈI P
[
ÈÈP Q
$str
ÈÈQ ^
]
ÈÈ^ _
.
ÈÈ_ `
ToString
ÈÈ` h
(
ÈÈh i
)
ÈÈi j
,
ÈÈj k
linea
ÈÈl q
=
ÈÈr s
Linea
ÈÈt y
.
ÈÈy z
ToStringÈÈz Ç
(ÈÈÇ É
)ÈÈÉ Ñ
}ÈÈÖ Ü
)ÈÈÜ á
{ÈÈà â
FileNameÈÈä í
=ÈÈì î
$strÈÈï ™
+ÈÈ´ ¨
SessionÈÈ≠ ¥
[ÈÈ¥ µ
$strÈÈµ ¬
]ÈÈ¬ √
.ÈÈ√ ƒ
ToStringÈÈƒ Ã
(ÈÈÃ Õ
)ÈÈÕ Œ
+ÈÈœ –
$strÈÈ— ‘
+ÈÈ’ ÷
boliviaTimeÈÈ◊ ‚
.ÈÈ‚ „
DayÈÈ„ Ê
+ÈÈÁ Ë
boliviaTimeÈÈÈ Ù
.ÈÈÙ ı
MonthÈÈı ˙
+ÈÈ˚ ¸
boliviaTimeÈÈ˝ à
.ÈÈà â
YearÈÈâ ç
+ÈÈé è
$strÈÈê ñ
}ÈÈó ò
;ÈÈò ô
}
ÍÍ 	
public
ÎÎ 
ActionResult
ÎÎ 
PrintReportDates
ÎÎ ,
(
ÎÎ, -
)
ÎÎ- .
{
ÏÏ 	
Login
ÌÌ 
logi
ÌÌ 
=
ÌÌ 
new
ÌÌ 
Login
ÌÌ "
(
ÌÌ" #
)
ÌÌ# $
;
ÌÌ$ %
var
ÓÓ 

authResult
ÓÓ 
=
ÓÓ  
AutenticarPasosRol
ÓÓ /
(
ÓÓ/ 0
$num
ÓÓ0 1
)
ÓÓ1 2
;
ÓÓ2 3
if
ÔÔ 
(
ÔÔ 

authResult
ÔÔ 
!=
ÔÔ 
null
ÔÔ "
)
ÔÔ" #
return
ÔÔ$ *

authResult
ÔÔ+ 5
;
ÔÔ5 6
string
 
Linea
 
=
 
logi
 
.
   
GetLineaFromCookie
  2
(
2 3
Request
3 :
)
: ;
.
; <
ToString
< D
(
D E
)
E F
;
F G
if
ÒÒ 
(
ÒÒ 
Session
ÒÒ 
[
ÒÒ 
$str
ÒÒ 
]
ÒÒ  
==
ÒÒ! #
null
ÒÒ$ (
||
ÒÒ) +
Session
ÒÒ, 3
[
ÒÒ3 4
$str
ÒÒ4 9
]
ÒÒ9 :
==
ÒÒ; =
null
ÒÒ> B
)
ÒÒB C
return
ÒÒD J
RedirectToAction
ÒÒK [
(
ÒÒ[ \
$str
ÒÒ\ c
,
ÒÒc d
$str
ÒÒe k
)
ÒÒk l
;
ÒÒl m
TimeZoneInfo
ÚÚ 
boliviaTimeZone
ÚÚ (
=
ÚÚ) *
TimeZoneInfo
ÚÚ+ 7
.
ÚÚ7 8$
FindSystemTimeZoneById
ÚÚ8 N
(
ÚÚN O
$str
ÚÚO i
)
ÚÚi j
;
ÚÚj k
DateTime
ÛÛ 
boliviaTime
ÛÛ  
=
ÛÛ! "
TimeZoneInfo
ÛÛ# /
.
ÛÛ/ 0
ConvertTime
ÛÛ0 ;
(
ÛÛ; <
DateTime
ÛÛ< D
.
ÛÛD E
UtcNow
ÛÛE K
,
ÛÛK L
boliviaTimeZone
ÛÛM \
)
ÛÛ\ ]
;
ÛÛ] ^
return
ÙÙ 
new
ÙÙ 
ActionAsPdf
ÙÙ "
(
ÙÙ" #
$str
ÙÙ# 7
,
ÙÙ7 8
new
ÙÙ8 ;
{
ÙÙ< =
linea
ÙÙ= B
=
ÙÙC D
Linea
ÙÙE J
,
ÙÙJ K
start
ÙÙL Q
=
ÙÙR S
DateTime
ÙÙT \
.
ÙÙ\ ]
Parse
ÙÙ] b
(
ÙÙb c
Session
ÙÙc j
[
ÙÙj k
$str
ÙÙk r
]
ÙÙr s
.
ÙÙs t
ToString
ÙÙt |
(
ÙÙ| }
)
ÙÙ} ~
)
ÙÙ~ 
,ÙÙ Ä
endÙÙÅ Ñ
=ÙÙÖ Ü
DateTimeÙÙá è
.ÙÙè ê
ParseÙÙê ï
(ÙÙï ñ
SessionÙÙñ ù
[ÙÙù û
$strÙÙû £
]ÙÙ£ §
.ÙÙ§ •
ToStringÙÙ• ≠
(ÙÙ≠ Æ
)ÙÙÆ Ø
)ÙÙØ ∞
}ÙÙ± ≤
)ÙÙ≤ ≥
{ÙÙ¥ µ
FileNameÙÙ∂ æ
=ÙÙø ¿
$strÙÙ¡ ÷
+ÙÙ◊ ÿ
boliviaTimeÙÙŸ ‰
.ÙÙ‰ Â
DayÙÙÂ Ë
+ÙÙÈ Í
boliviaTimeÙÙÎ ˆ
.ÙÙˆ ˜
MonthÙÙ˜ ¸
+ÙÙ˝ ˛
boliviaTimeÙÙˇ ä
.ÙÙä ã
YearÙÙã è
+ÙÙê ë
$strÙÙí ò
}ÙÙô ö
;ÙÙö õ
}
ıı 	
public
ˆˆ 
ActionResult
ˆˆ &
PrintReportDatesEmployee
ˆˆ 4
(
ˆˆ4 5
)
ˆˆ5 6
{
˜˜ 	
Login
¯¯ 
logi
¯¯ 
=
¯¯ 
new
¯¯ 
Login
¯¯ "
(
¯¯" #
)
¯¯# $
;
¯¯$ %
var
˘˘ 

authResult
˘˘ 
=
˘˘  
AutenticarPasosRol
˘˘ /
(
˘˘/ 0
$num
˘˘0 1
)
˘˘1 2
;
˘˘2 3
if
˙˙ 
(
˙˙ 

authResult
˙˙ 
!=
˙˙ 
null
˙˙ "
)
˙˙" #
return
˙˙$ *

authResult
˙˙+ 5
;
˙˙5 6
string
˚˚ 
Linea
˚˚ 
=
˚˚ 
logi
˚˚ 
.
˚˚   
GetLineaFromCookie
˚˚  2
(
˚˚2 3
Request
˚˚3 :
)
˚˚: ;
.
˚˚; <
ToString
˚˚< D
(
˚˚D E
)
˚˚E F
;
˚˚F G
if
¸¸ 
(
¸¸ 
Session
¸¸ 
[
¸¸ 
$str
¸¸ 
]
¸¸  
==
¸¸! #
null
¸¸$ (
||
¸¸) +
Session
¸¸, 3
[
¸¸3 4
$str
¸¸4 9
]
¸¸9 :
==
¸¸; =
null
¸¸> B
)
¸¸B C
return
¸¸D J
RedirectToAction
¸¸K [
(
¸¸[ \
$str
¸¸\ c
,
¸¸c d
$str
¸¸e k
)
¸¸k l
;
¸¸l m
TimeZoneInfo
˝˝ 
boliviaTimeZone
˝˝ (
=
˝˝) *
TimeZoneInfo
˝˝+ 7
.
˝˝7 8$
FindSystemTimeZoneById
˝˝8 N
(
˝˝N O
$str
˝˝O i
)
˝˝i j
;
˝˝j k
DateTime
˛˛ 
boliviaTime
˛˛  
=
˛˛! "
TimeZoneInfo
˛˛# /
.
˛˛/ 0
ConvertTime
˛˛0 ;
(
˛˛; <
DateTime
˛˛< D
.
˛˛D E
UtcNow
˛˛E K
,
˛˛K L
boliviaTimeZone
˛˛M \
)
˛˛\ ]
;
˛˛] ^
return
ˇˇ 
new
ˇˇ 
ActionAsPdf
ˇˇ "
(
ˇˇ" #
$str
ˇˇ# ?
,
ˇˇ? @
new
ˇˇA D
{
ˇˇE F
id
ˇˇF H
=
ˇˇI J
Session
ˇˇK R
[
ˇˇR S
$str
ˇˇS `
]
ˇˇ` a
.
ˇˇa b
ToString
ˇˇb j
(
ˇˇj k
)
ˇˇk l
,
ˇˇl m
start
ˇˇn s
=
ˇˇt u
DateTime
ˇˇv ~
.
ˇˇ~ 
Parseˇˇ Ñ
(ˇˇÑ Ö
SessionˇˇÖ å
[ˇˇå ç
$strˇˇç î
]ˇˇî ï
.ˇˇï ñ
ToStringˇˇñ û
(ˇˇû ü
)ˇˇü †
)ˇˇ† °
,ˇˇ° ¢
endˇˇ£ ¶
=ˇˇß ®
DateTimeˇˇ© ±
.ˇˇ± ≤
Parseˇˇ≤ ∑
(ˇˇ∑ ∏
Sessionˇˇ∏ ø
[ˇˇø ¿
$strˇˇ¿ ≈
]ˇˇ≈ ∆
.ˇˇ∆ «
ToStringˇˇ« œ
(ˇˇœ –
)ˇˇ– —
)ˇˇ— “
,ˇˇ“ ”
lineaˇˇ‘ Ÿ
=ˇˇ⁄ €
Lineaˇˇ‹ ·
}ˇˇ‚ „
)ˇˇ„ ‰
{ˇˇÂ Ê
FileNameˇˇÁ Ô
=ˇˇ Ò
$strˇˇÚ á
+ˇˇà â
Sessionˇˇä ë
[ˇˇë í
$strˇˇí ü
]ˇˇü †
.ˇˇ† °
ToStringˇˇ° ©
(ˇˇ© ™
)ˇˇ™ ´
+ˇˇ¨ ≠
$strˇˇÆ ±
+ˇˇ≤ ≥
boliviaTimeˇˇ¥ ø
.ˇˇø ¿
Dayˇˇ¿ √
+ˇˇƒ ≈
boliviaTimeˇˇ∆ —
.ˇˇ— “
Monthˇˇ“ ◊
+ˇˇÿ Ÿ
boliviaTimeˇˇ⁄ Â
.ˇˇÂ Ê
YearˇˇÊ Í
+ˇˇÎ Ï
$strˇˇÌ Û
}ˇˇÙ ı
;ˇˇı ˆ
}
ÄÄ 	
public
ÅÅ 
ActionResult
ÅÅ  
AutenticarPasosRol
ÅÅ .
(
ÅÅ. /
int
ÅÅ/ 2
role
ÅÅ3 7
)
ÅÅ7 8
{
ÇÇ 	
if
ÉÉ 
(
ÉÉ 
!
ÉÉ 
User
ÉÉ 
.
ÉÉ 
Identity
ÉÉ 
.
ÉÉ 
IsAuthenticated
ÉÉ .
)
ÉÉ. /
return
ÉÉ0 6
RedirectToAction
ÉÉ7 G
(
ÉÉG H
$str
ÉÉH O
,
ÉÉO P
$str
ÉÉQ W
)
ÉÉW X
;
ÉÉX Y
Login
ÑÑ 
logi
ÑÑ 
=
ÑÑ 
new
ÑÑ 
Login
ÑÑ "
(
ÑÑ" #
)
ÑÑ# $
;
ÑÑ$ %
int
ÖÖ 
?
ÖÖ 
roleSession
ÖÖ 
=
ÖÖ 
logi
ÖÖ #
.
ÖÖ# $&
GetRoleSessionFromCookie
ÖÖ$ <
(
ÖÖ< =
Request
ÖÖ= D
)
ÖÖD E
;
ÖÖE F
if
ÜÜ 
(
ÜÜ 
roleSession
ÜÜ 
==
ÜÜ 
null
ÜÜ #
||
ÜÜ$ &
roleSession
ÜÜ' 2
!=
ÜÜ3 5
role
ÜÜ6 :
)
ÜÜ: ;
return
ÜÜ< B
RedirectToAction
ÜÜC S
(
ÜÜS T
$str
ÜÜT [
,
ÜÜ[ \
$str
ÜÜ] c
)
ÜÜc d
;
ÜÜd e
return
áá 
null
áá 
;
áá 
}
àà 	
}
ãã 
}åå Áñ
MC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Controllers\RouteController.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Controllers" -
{ 
public 

class 
RouteController  
:! "

Controller# -
{ 
public 
ActionResult 
Index !
(! "
int" %
numTypeRoute& 2
)2 3
{ 	
try 
{ 
Login 
logi 
= 
new  
Login! &
(& '
)' (
;( )
var 

authResult 
=  
AutenticarPasosRol! 3
(3 4
$num4 5
)5 6
;6 7
if 
( 

authResult 
!= !
null" &
)& '
return( .

authResult/ 9
;9 :
string 
Line 
= 
logi "
." #
GetLineaFromCookie# 5
(5 6
Request6 =
)= >
.> ?
ToString? G
(G H
)H I
;I J
List 
< 
MuestraRutasMapas &
>& '
mapa( ,
=- .
new/ 2
List3 7
<7 8
MuestraRutasMapas8 I
>I J
(J K
)K L
;L M
int 
count 
= 
$num 
; 
for   
(   
int   
i   
=   
$num   
;   
i    !
<=  " $
$num  % &
;  & '
i  ( )
++  ) +
)  + ,
{!! 
MuestraRutasMapas"" %
muestraRutasMapas""& 7
=""8 9
new"": =
MuestraRutasMapas""> O
{## 
ListRutasMostrar$$ (
=$$) *
new$$+ .
List$$/ 3
<$$3 4
RutasMostrar$$4 @
>$$@ A
($$A B
)$$B C
,$$C D
ListParadasMostrar%% *
=%%+ ,
new%%- 0
List%%1 5
<%%5 6
ParadasMostrar%%6 D
>%%D E
(%%E F
)%%F G
,%%G H
ListBloqueosMostrar&& +
=&&, -
new&&. 1
List&&2 6
<&&6 7
BloqueosMostrar&&7 F
>&&F G
(&&G H
)&&H I
,&&I J

NumeroRuta'' "
=''# $
i''% &
}(( 
;(( 
List)) 
<)) 
BloqueosMostrar)) (
>))( )
nuevosBloqueos))* 8
=))9 :
new)); >
List))? C
<))C D
BloqueosMostrar))D S
>))S T
())T U
)))U V
;))V W
List** 
<** 
RutasMostrar** %
>**% &
nuevasRutas**' 2
=**3 4
new**5 8
List**9 =
<**= >
RutasMostrar**> J
>**J K
(**K L
)**L M
;**M N
List++ 
<++ 
ParadasMostrar++ '
>++' (
nuevasParadas++) 6
=++7 8
new++9 <
List++= A
<++A B
ParadasMostrar++B P
>++P Q
(++Q R
)++R S
;++S T
using-- 
(-- 
dbModels-- #
context--$ +
=--, -
new--. 1
dbModels--2 :
(--: ;
)--; <
)--< =
{.. 
var// 
checkpoints// '
=//( )
context//* 1
.//1 2

Checkpoint//2 <
.//< =
Where//= B
(//B C
x//C D
=>//E G
x//H I
.//I J
idLine//J P
==//Q S
Line//T X
&&//Y [
x//\ ]
.//] ^
status//^ d
!=//e g
$num//h i
&&//j l
x//m n
.//n o
numberRoute//o z
==//{ }
numTypeRoute	//~ ä
)
//ä ã
.
//ã å
ToList
//å í
(
//í ì
)
//ì î
;
//î ï
var00 
routes00 "
=00# $
context00% ,
.00, -
Route00- 2
.11 
Where11 "
(11" #
x11# $
=>11% '
x11( )
.11) *
idLine11* 0
==111 3
Line114 8
&&119 ;
x11< =
.11= >
numberRoute11> I
==11J L
i11M N
&&11O Q
x11R S
.11S T
numTypeRoute11T `
==11a c
numTypeRoute11d p
)11p q
.22 
ToList22 #
(22# $
)22$ %
;22% &
var33 
	deviation33 %
=33& '
context33( /
.33/ 0
DeviationRote330 =
.33= >
Where33> C
(33C D
x33D E
=>33F H
x33I J
.33J K
idLine33K Q
==33R T
Line33U Y
&&33Z \
x33] ^
.33^ _
numberRoute33_ j
==33k m
i33n o
&&33p r
x33s t
.33t u
numTypeRoute	33u Å
==
33Ç Ñ
numTypeRoute
33Ö ë
)
33ë í
.
33í ì
ToList
33ì ô
(
33ô ö
)
33ö õ
;
33õ ú
if44 
(44 
	deviation44 %
.44% &
Count44& +
>44, -
$num44. /
)44/ 0
{55 
foreach66 #
(66$ %
var66% (
item66) -
in66. 0
	deviation661 :
)66: ;
{77 
List88  $
<88$ %
RutasMostrar88% 1
>881 2
listBloqueos883 ?
=88@ A
new88B E
List88F J
<88J K
RutasMostrar88K W
>88W X
(88X Y
)88Y Z
;88Z [
var99  #
route199$ *
=99+ ,
routes99- 3
.993 4
Where994 9
(999 :
x99: ;
=>99< >
x99? @
.99@ A
idRoute99A H
==99I K
item99L P
.99P Q
idRouteStart99Q ]
&&99^ `
x99a b
.99b c
idLine99c i
==99j l
Line99m q
)99q r
.99r s
FirstOrDefault	99s Å
(
99Å Ç
)
99Ç É
;
99É Ñ
var::  #
route2::$ *
=::+ ,
routes::- 3
.::3 4
Where::4 9
(::9 :
x::: ;
=>::< >
x::? @
.::@ A
idRoute::A H
==::I K
item::L P
.::P Q

idRouteEnd::Q [
&&::\ ^
x::_ `
.::` a
idLine::a g
==::h j
Line::k o
)::o p
.::p q
FirstOrDefault::q 
(	:: Ä
)
::Ä Å
;
::Å Ç
if;;  "
(;;# $
route1;;$ *
!=;;+ -
null;;. 2
&&;;3 5
route2;;6 <
!=;;= ?
null;;@ D
);;D E
{<<  !
var==$ '
routesDeviation==( 7
===8 9
routes==: @
.==@ A
Where==A F
(==F G
x==G H
=>==I K
x==L M
.==M N
numPoint==N V
>===W Y
route1==Z `
.==` a
numPoint==a i
&&==j l
x==m n
.==n o
numPoint==o w
<===x z
route2	=={ Å
.
==Å Ç
numPoint
==Ç ä
&&
==ã ç
x
==é è
.
==è ê
idLine
==ê ñ
==
==ó ô
Line
==ö û
)
==û ü
.
==ü †
ToList
==† ¶
(
==¶ ß
)
==ß ®
;
==® ©
foreach>>$ +
(>>, -
var>>- 0
item2>>1 6
in>>7 9
routesDeviation>>: I
)>>I J
{??$ %
listBloqueos@@( 4
.@@4 5
Add@@5 8
(@@8 9
new@@9 <
RutasMostrar@@= I
(@@I J
item2@@J O
.@@O P
idRoute@@P W
,@@W X
item2@@Y ^
.@@^ _
latitud@@_ f
,@@f g
item2@@h m
.@@m n
logintud@@n v
,@@v w
$str@@x z
,@@z {
item2	@@| Å
.
@@Å Ç
status
@@Ç à
,
@@à â
(
@@ä ã
int
@@ã é
)
@@é è
item2
@@è î
.
@@î ï
numPoint
@@ï ù
)
@@ù û
)
@@û ü
;
@@ü †
}AA$ %
varBB$ '
place1BB( .
=BB/ 0
contextBB1 8
.BB8 9
PlaceBB9 >
.BB> ?
WhereBB? D
(BBD E
xBBE F
=>BBG I
xBBJ K
.BBK L
idPlaceBBL S
==BBT V
route1BBW ]
.BB] ^
idPlaceBB^ e
)BBe f
.BBf g
FirstOrDefaultBBg u
(BBu v
)BBv w
;BBw x
varCC$ '
place2CC( .
=CC/ 0
contextCC1 8
.CC8 9
PlaceCC9 >
.CC> ?
WhereCC? D
(CCD E
xCCE F
=>CCG I
xCCJ K
.CCK L
idPlaceCCL S
==CCT V
route2CCW ]
.CC] ^
idPlaceCC^ e
)CCe f
.CCf g
FirstOrDefaultCCg u
(CCu v
)CCv w
;CCw x
nuevosBloqueosDD$ 2
.DD2 3
AddDD3 6
(DD6 7
newDD7 :
BloqueosMostrarDD; J
(DDJ K
itemDDK O
.DDO P
idDeviationDDP [
,DD[ \
$strDD] f
+DDg h
place1DDi o
.DDo p
descriptionDDp {
+DD| }
$str	DD~ É
+
DDÑ Ö
place2
DDÜ å
.
DDå ç
description
DDç ò
,
DDò ô
listBloqueos
DDö ¶
)
DD¶ ß
)
DDß ®
;
DD® ©
}EE  !
}FF 
}GG 
ifHH 
(HH 
routesHH "
.HH" #
CountHH# (
>HH) *
$numHH+ ,
)HH, -
{II 
countJJ !
=JJ" #
$numJJ$ %
;JJ% &
foreachKK #
(KK$ %
varKK% (
itemKK) -
inKK. 0
routesKK1 7
)KK7 8
{LL 
countMM  %
++MM% '
;MM' (
PlaceNN  %
placeNN& +
=NN, -
contextNN. 5
.NN5 6
PlaceNN6 ;
.NN; <
FirstOrDefaultNN< J
(NNJ K
xNNK L
=>NNM O
xNNP Q
.NNQ R
idPlaceNNR Y
==NNZ \
itemNN] a
.NNa b
idPlaceNNb i
)NNi j
;NNj k
ifOO  "
(OO# $
placeOO$ )
!=OO* ,
nullOO- 1
)OO1 2
{PP  !
nuevasRutasQQ$ /
.QQ/ 0
AddQQ0 3
(QQ3 4
newQQ4 7
RutasMostrarQQ8 D
(QQD E
itemQQE I
.QQI J
idRouteQQJ Q
,QQQ R
itemQQS W
.QQW X
latitudQQX _
,QQ_ `
itemQQa e
.QQe f
logintudQQf n
,QQn o
placeQQp u
.QQu v
description	QQv Å
,
QQÅ Ç
item
QQÉ á
.
QQá à
status
QQà é
,
QQé è
(
QQê ë
int
QQë î
)
QQî ï
item
QQï ô
.
QQô ö
numPoint
QQö ¢
)
QQ¢ £
)
QQ£ §
;
QQ§ •
}RR  !
}SS 
ifUU 
(UU  
nuevasRutasUU  +
.UU+ ,
AnyUU, /
(UU/ 0
)UU0 1
)UU1 2
{VV 
RutasMostrarWW  ,
primeraRutaWW- 8
=WW9 :
nuevasRutasWW; F
.WWF G
FirstOrDefaultWWG U
(WWU V
rWWV W
=>WWX Z
rWW[ \
.WW\ ]
statusWW] c
==WWd f
$numWWg h
)WWh i
;WWi j
ifXX  "
(XX# $
primeraRutaXX$ /
!=XX0 2
nullXX3 7
)XX7 8
{YY  !
nuevasRutasZZ$ /
=ZZ0 1
nuevasRutasZZ2 =
.[[( )
OrderBy[[) 0
([[0 1
route[[1 6
=>[[7 9
route[[: ?
.[[? @
numPoint[[@ H
)[[H I
.\\( )
ToList\\) /
(\\/ 0
)\\0 1
;\\1 2
}]]  !
}^^ 
count__ !
=__" #
$num__$ %
;__% &
foreach`` #
(``$ %
var``% (
item``) -
in``. 0
nuevasRutas``1 <
)``< =
{aa 
itembb  $
.bb$ %
namebb% )
=bb* +
itembb, 0
.bb0 1
namebb1 5
+bb6 7
$strbb8 ;
+bb< =
countbb> C
;bbC D
countcc  %
++cc% '
;cc' (
}dd 
}ee 
ifgg 
(gg 
checkpointsgg '
.gg' (
Countgg( -
>gg. /
$numgg0 1
)gg1 2
{hh 
countii !
=ii" #
$numii$ %
;ii% &
foreachjj #
(jj$ %
varjj% (
itemjj) -
injj. 0
checkpointsjj1 <
)jj< =
{kk 
countll  %
++ll% '
;ll' (
nuevasParadasmm  -
.mm- .
Addmm. 1
(mm1 2
newmm2 5
ParadasMostrarmm6 D
(mmD E
itemmmE I
.mmI J
idCheckpointmmJ V
,mmV W
itemmmX \
.mm\ ]
descriptionmm] h
,mmh i
itemmmj n
.mmn o
statusmmo u
,mmu v
itemmmw {
.mm{ |
latitud	mm| É
,
mmÉ Ñ
item
mmÖ â
.
mmâ ä
longitud
mmä í
)
mmí ì
)
mmì î
;
mmî ï
}nn 
ifpp 
(pp  
nuevasParadaspp  -
.pp- .
Anypp. 1
(pp1 2
)pp2 3
)pp3 4
{qq 
ParadasMostrarrr  .
primeraParadarr/ <
=rr= >
nuevasParadasrr? L
.rrL M
FirstOrDefaultrrM [
(rr[ \
rrr\ ]
=>rr^ `
rrra b
.rrb c
statusrrc i
==rrj l
$numrrm n
)rrn o
;rro p
ifss  "
(ss# $
primeraParadass$ 1
!=ss2 4
nullss5 9
)ss9 :
{tt  !
nuevasParadasuu$ 1
=uu2 3
nuevasParadasuu4 A
.vv( )
OrderByvv) 0
(vv0 1
routevv1 6
=>vv7 9
muestraRutasMapasvv: K
.vvK L&
CalcularDistanciaHaversinevvL f
(vvf g
(ww, -
decimalww- 4
)ww4 5
primeraParadaww5 B
.wwB C
latitudwwC J
,wwJ K
(xx, -
decimalxx- 4
)xx4 5
primeraParadaxx5 B
.xxB C
longitudxxC K
,xxK L
routeyy, 1
.yy1 2
latitudyy2 9
,yy9 :
routezz, 1
.zz1 2
longitudzz2 :
)zz: ;
)zz; <
.{{( )
ToList{{) /
({{/ 0
){{0 1
;{{1 2
}||  !
}}} 
count~~ !
=~~" #
$num~~$ %
;~~% &
foreach #
($ %
var% (
item) -
in. 0
nuevasParadas1 >
)> ?
{
ÄÄ 
item
ÅÅ  $
.
ÅÅ$ %
description
ÅÅ% 0
=
ÅÅ1 2
item
ÅÅ3 7
.
ÅÅ7 8
description
ÅÅ8 C
+
ÅÅD E
$str
ÅÅF I
+
ÅÅJ K
count
ÅÅL Q
;
ÅÅQ R
count
ÇÇ  %
++
ÇÇ% '
;
ÇÇ' (
}
ÉÉ 
}
ÑÑ 
}
ÖÖ 
ViewBag
ÜÜ 
.
ÜÜ 
numTypeRoute
ÜÜ (
=
ÜÜ) *
numTypeRoute
ÜÜ+ 7
;
ÜÜ7 8
muestraRutasMapas
áá %
.
áá% &
ListRutasMostrar
áá& 6
=
áá7 8
nuevasRutas
áá9 D
;
ááD E
muestraRutasMapas
àà %
.
àà% & 
ListParadasMostrar
àà& 8
=
àà9 :
nuevasParadas
àà; H
;
ààH I
muestraRutasMapas
ââ %
.
ââ% &!
ListBloqueosMostrar
ââ& 9
=
ââ: ;
nuevosBloqueos
ââ< J
;
ââJ K
mapa
ää 
.
ää 
Add
ää 
(
ää 
muestraRutasMapas
ää .
)
ää. /
;
ää/ 0
}
ãã 
return
çç 
View
çç 
(
çç 
mapa
çç  
)
çç  !
;
çç! "
}
éé 
catch
èè 
(
èè 
	Exception
èè 
)
èè 
{
êê 
return
ëë 
RedirectToAction
ëë '
(
ëë' (
$str
ëë( /
,
ëë/ 0
$str
ëë1 7
)
ëë7 8
;
ëë8 9
}
íí 
}
ìì 	
public
îî 
ActionResult
îî 

ListRoutes
îî &
(
îî& '
)
îî' (
{
ïï 	
Login
óó 
logi
óó 
=
óó 
new
óó  
Login
óó! &
(
óó& '
)
óó' (
;
óó( )
var
òò 

authResult
òò 
=
òò   
AutenticarPasosRol
òò! 3
(
òò3 4
$num
òò4 5
)
òò5 6
;
òò6 7
if
ôô 
(
ôô 

authResult
ôô 
!=
ôô !
null
ôô" &
)
ôô& '
return
ôô( .

authResult
ôô/ 9
;
ôô9 :
string
öö 
Line
öö 
=
öö 
logi
öö "
.
öö" # 
GetLineaFromCookie
öö# 5
(
öö5 6
Request
öö6 =
)
öö= >
.
öö> ?
ToString
öö? G
(
ööG H
)
ööH I
;
ööI J
List
õõ 
<
õõ 
Route
õõ 
>
õõ 
routes
õõ "
=
õõ# $
new
õõ% (
List
õõ) -
<
õõ- .
Route
õõ. 3
>
õõ3 4
(
õõ4 5
)
õõ5 6
;
õõ6 7
using
úú 
(
úú 
dbModels
úú 
context
úú  '
=
úú( )
new
úú* -
dbModels
úú. 6
(
úú6 7
)
úú7 8
)
úú8 9
{
ùù 
routes
ûû 
=
ûû 
context
ûû $
.
ûû$ %
Route
ûû% *
.
ûû* +
Where
ûû+ 0
(
ûû0 1
x
ûû1 2
=>
ûû3 5
x
ûû6 7
.
ûû7 8
idLine
ûû8 >
==
ûû? A
Line
ûûB F
)
ûûF G
.
ûûG H
GroupBy
ûûH O
(
ûûO P
x
ûûP Q
=>
ûûR T
x
ûûU V
.
ûûV W
numTypeRoute
ûûW c
)
ûûc d
.
ûûd e
Select
ûûe k
(
ûûk l
x
ûûl m
=>
ûûn p
x
ûûq r
.
ûûr s
FirstOrDefaultûûs Å
(ûûÅ Ç
)ûûÇ É
)ûûÉ Ñ
.ûûÑ Ö
ToListûûÖ ã
(ûûã å
)ûûå ç
;ûûç é
}
üü 
return
†† 
View
†† 
(
†† 
routes
†† "
)
††" #
;
††# $
}
¢¢ 	
public
•• 
ActionResult
•• 
Create
•• "
(
••" #
)
••# $
{
¶¶ 	
var
ßß 

authResult
ßß 
=
ßß  
AutenticarPasosRol
ßß /
(
ßß/ 0
$num
ßß0 1
)
ßß1 2
;
ßß2 3
if
®® 
(
®® 

authResult
®® 
!=
®® 
null
®® "
)
®®" #
return
®®$ *

authResult
®®+ 5
;
®®5 6
return
©© 
View
©© 
(
©© 
)
©© 
;
©© 
}
™™ 	
[
≠≠ 	
HttpPost
≠≠	 
]
≠≠ 
public
ÆÆ 
ActionResult
ÆÆ 
Create
ÆÆ "
(
ÆÆ" #
MuestraRoute
ÆÆ# /
muestraRoute
ÆÆ0 <
)
ÆÆ< =
{
ØØ 	
try
∞∞ 
{
±± 
Login
≤≤ 
logi
≤≤ 
=
≤≤ 
new
≤≤  
Login
≤≤! &
(
≤≤& '
)
≤≤' (
;
≤≤( )
var
≥≥ 

authResult
≥≥ 
=
≥≥   
AutenticarPasosRol
≥≥! 3
(
≥≥3 4
$num
≥≥4 5
)
≥≥5 6
;
≥≥6 7
if
¥¥ 
(
¥¥ 

authResult
¥¥ 
!=
¥¥ !
null
¥¥" &
)
¥¥& '
return
¥¥( .

authResult
¥¥/ 9
;
¥¥9 :
string
µµ 
Linea
µµ 
=
µµ 
logi
µµ #
.
µµ# $ 
GetLineaFromCookie
µµ$ 6
(
µµ6 7
Request
µµ7 >
)
µµ> ?
.
µµ? @
ToString
µµ@ H
(
µµH I
)
µµI J
;
µµJ K
string
∂∂ 
description
∂∂ "
=
∂∂# $
muestraRoute
∂∂% 1
.
∂∂1 2
	extention
∂∂2 ;
.
∂∂; <
Trim
∂∂< @
(
∂∂@ A
)
∂∂A B
+
∂∂C D
$str
∂∂E H
+
∂∂I J
muestraRoute
∂∂K W
.
∂∂W X
descriptionPlace
∂∂X h
.
∂∂h i
Trim
∂∂i m
(
∂∂m n
)
∂∂n o
;
∂∂o p
Place
∑∑ 
place
∑∑ 
=
∑∑ 
new
∑∑ !
Place
∑∑" '
(
∑∑' (
)
∑∑( )
;
∑∑) *
using
∏∏ 
(
∏∏ 
dbModels
∏∏ 
context
∏∏  '
=
∏∏( )
new
∏∏* -
dbModels
∏∏. 6
(
∏∏6 7
)
∏∏7 8
)
∏∏8 9
{
ππ 
place
∫∫ 
=
∫∫ 
context
∫∫ #
.
∫∫# $
Place
∫∫$ )
.
∫∫) *
Where
∫∫* /
(
∫∫/ 0
x
∫∫0 1
=>
∫∫2 4
x
∫∫5 6
.
∫∫6 7
description
∫∫7 B
.
∫∫B C
ToLower
∫∫C J
(
∫∫J K
)
∫∫K L
.
∫∫L M
Trim
∫∫M Q
(
∫∫Q R
)
∫∫R S
==
∫∫T V
description
∫∫W b
.
∫∫b c
ToLower
∫∫c j
(
∫∫j k
)
∫∫k l
.
∫∫l m
Trim
∫∫m q
(
∫∫q r
)
∫∫r s
)
∫∫s t
.
∫∫t u
FirstOrDefault∫∫u É
(∫∫É Ñ
)∫∫Ñ Ö
;∫∫Ö Ü
}
ªª 
if
ºº 
(
ºº 
place
ºº 
==
ºº 
null
ºº !
)
ºº! "
using
ΩΩ 
(
ΩΩ 
dbModels
ΩΩ #
context
ΩΩ$ +
=
ΩΩ, -
new
ΩΩ. 1
dbModels
ΩΩ2 :
(
ΩΩ: ;
)
ΩΩ; <
)
ΩΩ< =
{
ææ 
place
øø 
=
øø 
new
øø  #
Place
øø$ )
(
øø) *
)
øø* +
;
øø+ ,
place
¿¿ 
.
¿¿ 
description
¿¿ )
=
¿¿* +
description
¿¿, 7
;
¿¿7 8
context
¡¡ 
.
¡¡  
Place
¡¡  %
.
¡¡% &
Add
¡¡& )
(
¡¡) *
place
¡¡* /
)
¡¡/ 0
;
¡¡0 1
context
¬¬ 
.
¬¬  
SaveChanges
¬¬  +
(
¬¬+ ,
)
¬¬, -
;
¬¬- .
}
√√ 
using
ƒƒ 
(
ƒƒ 
dbModels
ƒƒ 
context
ƒƒ  '
=
ƒƒ( )
new
ƒƒ* -
dbModels
ƒƒ. 6
(
ƒƒ6 7
)
ƒƒ7 8
)
ƒƒ8 9
{
≈≈ 
place
∆∆ 
=
∆∆ 
context
∆∆ #
.
∆∆# $
Place
∆∆$ )
.
∆∆) *
Where
∆∆* /
(
∆∆/ 0
x
∆∆0 1
=>
∆∆2 4
x
∆∆5 6
.
∆∆6 7
description
∆∆7 B
.
∆∆B C
ToLower
∆∆C J
(
∆∆J K
)
∆∆K L
.
∆∆L M
Trim
∆∆M Q
(
∆∆Q R
)
∆∆R S
==
∆∆T V
description
∆∆W b
.
∆∆b c
ToLower
∆∆c j
(
∆∆j k
)
∆∆k l
.
∆∆l m
Trim
∆∆m q
(
∆∆q r
)
∆∆r s
)
∆∆s t
.
∆∆t u
FirstOrDefault∆∆u É
(∆∆É Ñ
)∆∆Ñ Ö
;∆∆Ö Ü
Route
«« 
route
«« 
=
««  !
new
««" %
Route
««& +
(
««+ ,
)
««, -
;
««- .
decimal
»» 
latitud
»» #
=
»»$ %
decimal
»»& -
.
»»- .
Parse
»». 3
(
»»3 4
muestraRoute
»»4 @
.
»»@ A
latitud_longitud
»»A Q
.
»»Q R
Split
»»R W
(
»»W X
$char
»»X [
)
»»[ \
[
»»\ ]
$num
»»] ^
]
»»^ _
.
»»_ `
ToString
»»` h
(
»»h i
)
»»i j
)
»»j k
;
»»k l
decimal
…… 
longitud
…… $
=
……% &
decimal
……' .
.
……. /
Parse
……/ 4
(
……4 5
muestraRoute
……5 A
.
……A B
latitud_longitud
……B R
.
……R S
Split
……S X
(
……X Y
$char
……Y \
)
……\ ]
[
……] ^
$num
……^ _
]
……_ `
.
……` a
ToString
……a i
(
……i j
)
……j k
)
……k l
;
……l m
route
   
.
   
idLine
    
=
  ! "
Linea
  # (
;
  ( )
route
ÀÀ 
.
ÀÀ 
idPlace
ÀÀ !
=
ÀÀ" #
place
ÀÀ$ )
.
ÀÀ) *
idPlace
ÀÀ* 1
;
ÀÀ1 2
route
ÃÃ 
.
ÃÃ 
latitud
ÃÃ !
=
ÃÃ" #
latitud
ÃÃ$ +
;
ÃÃ+ ,
route
ÕÕ 
.
ÕÕ 
logintud
ÕÕ "
=
ÕÕ# $
longitud
ÕÕ% -
;
ÕÕ- .
context
ŒŒ 
.
ŒŒ 
Route
ŒŒ !
.
ŒŒ! "
Add
ŒŒ" %
(
ŒŒ% &
route
ŒŒ& +
)
ŒŒ+ ,
;
ŒŒ, -
context
œœ 
.
œœ 
SaveChanges
œœ '
(
œœ' (
)
œœ( )
;
œœ) *
}
–– 
return
—— 
RedirectToAction
—— '
(
——' (
$str
——( /
)
——/ 0
;
——0 1
}
““ 
catch
”” 
{
‘‘ 
return
’’ 
RedirectToAction
’’ '
(
’’' (
$str
’’( /
,
’’/ 0
$str
’’1 7
)
’’7 8
;
’’8 9
}
÷÷ 
}
◊◊ 	
public
⁄⁄ 
ActionResult
⁄⁄ 
Delete
⁄⁄ "
(
⁄⁄" #
int
⁄⁄# &
id
⁄⁄' )
)
⁄⁄) *
{
€€ 	
try
‹‹ 
{
›› 
var
ﬁﬁ 

authResult
ﬁﬁ 
=
ﬁﬁ   
AutenticarPasosRol
ﬁﬁ! 3
(
ﬁﬁ3 4
$num
ﬁﬁ4 5
)
ﬁﬁ5 6
;
ﬁﬁ6 7
if
ﬂﬂ 
(
ﬂﬂ 

authResult
ﬂﬂ 
!=
ﬂﬂ !
null
ﬂﬂ" &
)
ﬂﬂ& '
return
ﬂﬂ( .

authResult
ﬂﬂ/ 9
;
ﬂﬂ9 :
Route
‡‡ 
route
‡‡ 
=
‡‡ 
new
‡‡ !
Route
‡‡" '
(
‡‡' (
)
‡‡( )
;
‡‡) *
int
·· 
numTypeRoute
··  
=
··! "
$num
··# $
;
··$ %
using
‚‚ 
(
‚‚ 
dbModels
‚‚ 
context
‚‚  '
=
‚‚( )
new
‚‚* -
dbModels
‚‚. 6
(
‚‚6 7
)
‚‚7 8
)
‚‚8 9
{
„„ 
route
‰‰ 
=
‰‰ 
context
‰‰ #
.
‰‰# $
Route
‰‰$ )
.
‰‰) *
Where
‰‰* /
(
‰‰/ 0
x
‰‰0 1
=>
‰‰2 4
x
‰‰5 6
.
‰‰6 7
idRoute
‰‰7 >
==
‰‰? A
id
‰‰B D
)
‰‰D E
.
‰‰E F
FirstOrDefault
‰‰F T
(
‰‰T U
)
‰‰U V
;
‰‰V W
numTypeRoute
ÂÂ  
=
ÂÂ! "
int
ÂÂ# &
.
ÂÂ& '
Parse
ÂÂ' ,
(
ÂÂ, -
route
ÂÂ- 2
.
ÂÂ2 3
numTypeRoute
ÂÂ3 ?
.
ÂÂ? @
ToString
ÂÂ@ H
(
ÂÂH I
)
ÂÂI J
)
ÂÂJ K
;
ÂÂK L
var
ÊÊ 
	deviation
ÊÊ !
=
ÊÊ" #
context
ÊÊ$ +
.
ÊÊ+ ,
DeviationRote
ÊÊ, 9
.
ÊÊ9 :
Where
ÊÊ: ?
(
ÊÊ? @
x
ÊÊ@ A
=>
ÊÊB D
x
ÊÊE F
.
ÊÊF G

idRouteEnd
ÊÊG Q
==
ÊÊR T
route
ÊÊU Z
.
ÊÊZ [
idRoute
ÊÊ[ b
||
ÊÊc e
x
ÊÊf g
.
ÊÊg h
idRouteStart
ÊÊh t
==
ÊÊu w
route
ÊÊx }
.
ÊÊ} ~
idRouteÊÊ~ Ö
)ÊÊÖ Ü
.ÊÊÜ á
ToListÊÊá ç
(ÊÊç é
)ÊÊé è
;ÊÊè ê
context
ÁÁ 
.
ÁÁ 
Route
ÁÁ !
.
ÁÁ! "
Remove
ÁÁ" (
(
ÁÁ( )
route
ÁÁ) .
)
ÁÁ. /
;
ÁÁ/ 0
if
ËË 
(
ËË 
	deviation
ËË !
.
ËË! "
Count
ËË" '
>
ËË( )
$num
ËË* +
)
ËË+ ,
{
ÈÈ 
foreach
ÍÍ 
(
ÍÍ  !
var
ÍÍ! $
item
ÍÍ% )
in
ÍÍ* ,
	deviation
ÍÍ- 6
)
ÍÍ6 7
{
ÎÎ 
context
ÏÏ #
.
ÏÏ# $
DeviationRote
ÏÏ$ 1
.
ÏÏ1 2
Remove
ÏÏ2 8
(
ÏÏ8 9
item
ÏÏ9 =
)
ÏÏ= >
;
ÏÏ> ?
}
ÌÌ 
}
ÓÓ 
context
ÔÔ 
.
ÔÔ 
SaveChanges
ÔÔ '
(
ÔÔ' (
)
ÔÔ( )
;
ÔÔ) *
}
 
return
ÒÒ 
RedirectToAction
ÒÒ '
(
ÒÒ' (
$str
ÒÒ( /
,
ÒÒ/ 0
$str
ÒÒ0 7
,
ÒÒ7 8
new
ÒÒ9 <
{
ÒÒ= >
numTypeRoute
ÒÒ? K
=
ÒÒL M
numTypeRoute
ÒÒN Z
}
ÒÒ[ \
)
ÒÒ\ ]
;
ÒÒ] ^
}
ÚÚ 
catch
ÛÛ 
{
ÙÙ 
return
ıı 
RedirectToAction
ıı '
(
ıı' (
$str
ıı( /
,
ıı/ 0
$str
ıı1 7
)
ıı7 8
;
ıı8 9
}
ˆˆ 
}
˜˜ 	
public
¯¯ 
ActionResult
¯¯  
AutenticarPasosRol
¯¯ .
(
¯¯. /
int
¯¯/ 2
role
¯¯3 7
)
¯¯7 8
{
˘˘ 	
if
˙˙ 
(
˙˙ 
!
˙˙ 
User
˙˙ 
.
˙˙ 
Identity
˙˙ 
.
˙˙ 
IsAuthenticated
˙˙ .
)
˙˙. /
return
˙˙0 6
RedirectToAction
˙˙7 G
(
˙˙G H
$str
˙˙H O
,
˙˙O P
$str
˙˙Q W
)
˙˙W X
;
˙˙X Y
Login
˚˚ 
logi
˚˚ 
=
˚˚ 
new
˚˚ 
Login
˚˚ "
(
˚˚" #
)
˚˚# $
;
˚˚$ %
int
¸¸ 
?
¸¸ 
roleSession
¸¸ 
=
¸¸ 
logi
¸¸ #
.
¸¸# $&
GetRoleSessionFromCookie
¸¸$ <
(
¸¸< =
Request
¸¸= D
)
¸¸D E
;
¸¸E F
if
˝˝ 
(
˝˝ 
roleSession
˝˝ 
==
˝˝ 
null
˝˝ #
||
˝˝$ &
roleSession
˝˝' 2
!=
˝˝3 5
role
˝˝6 :
)
˝˝: ;
return
˝˝< B
RedirectToAction
˝˝C S
(
˝˝S T
$str
˝˝T [
,
˝˝[ \
$str
˝˝] c
)
˝˝c d
;
˝˝d e
return
˛˛ 
null
˛˛ 
;
˛˛ 
}
ˇˇ 	
public
ÄÄ 
ActionResult
ÄÄ  
IndexCheckAndRoute
ÄÄ .
(
ÄÄ. /
)
ÄÄ/ 0
{
ÅÅ 	
try
ÇÇ 
{
ÉÉ 
Login
ÑÑ 
logi
ÑÑ 
=
ÑÑ 
new
ÑÑ  
Login
ÑÑ! &
(
ÑÑ& '
)
ÑÑ' (
;
ÑÑ( )
var
ÖÖ 

authResult
ÖÖ 
=
ÖÖ   
AutenticarPasosRol
ÖÖ! 3
(
ÖÖ3 4
$num
ÖÖ4 5
)
ÖÖ5 6
;
ÖÖ6 7
if
ÜÜ 
(
ÜÜ 

authResult
ÜÜ 
!=
ÜÜ !
null
ÜÜ" &
)
ÜÜ& '
return
ÜÜ( .

authResult
ÜÜ/ 9
;
ÜÜ9 :
string
àà 
Line
àà 
=
àà 
logi
àà "
.
àà" # 
GetLineaFromCookie
àà# 5
(
àà5 6
Request
àà6 =
)
àà= >
.
àà> ?
ToString
àà? G
(
ààG H
)
ààH I
;
ààI J
List
ââ 
<
ââ 
MuestraRutasMapas
ââ &
>
ââ& '
mapa
ââ( ,
=
ââ- .
new
ââ/ 2
List
ââ3 7
<
ââ7 8
MuestraRutasMapas
ââ8 I
>
ââI J
(
ââJ K
)
ââK L
;
ââL M
int
ää 
count
ää 
=
ää 
$num
ää 
;
ää 
for
ãã 
(
ãã 
int
ãã 
i
ãã 
=
ãã 
$num
ãã 
;
ãã 
i
ãã  !
<=
ãã" $
$num
ãã% &
;
ãã& '
i
ãã( )
++
ãã) +
)
ãã+ ,
{
åå 
MuestraRutasMapas
çç %
muestraRutasMapas
çç& 7
=
çç8 9
new
çç: =
MuestraRutasMapas
çç> O
{
éé 
ListRutasMostrar
èè (
=
èè) *
new
èè+ .
List
èè/ 3
<
èè3 4
RutasMostrar
èè4 @
>
èè@ A
(
èèA B
)
èèB C
,
èèC D 
ListParadasMostrar
êê *
=
êê+ ,
new
êê- 0
List
êê1 5
<
êê5 6
ParadasMostrar
êê6 D
>
êêD E
(
êêE F
)
êêF G
,
êêG H

NumeroRuta
ëë "
=
ëë# $
i
ëë% &
}
íí 
;
íí 
List
îî 
<
îî 
RutasMostrar
îî %
>
îî% &
nuevasRutas
îî' 2
=
îî3 4
new
îî5 8
List
îî9 =
<
îî= >
RutasMostrar
îî> J
>
îîJ K
(
îîK L
)
îîL M
;
îîM N
List
ïï 
<
ïï 
ParadasMostrar
ïï '
>
ïï' (
nuevasParadas
ïï) 6
=
ïï7 8
new
ïï9 <
List
ïï= A
<
ïïA B
ParadasMostrar
ïïB P
>
ïïP Q
(
ïïQ R
)
ïïR S
;
ïïS T
using
óó 
(
óó 
dbModels
óó #
context
óó$ +
=
óó, -
new
óó. 1
dbModels
óó2 :
(
óó: ;
)
óó; <
)
óó< =
{
òò 
var
ôô 
checkpoints
ôô '
=
ôô( )
context
ôô+ 2
.
ôô2 3

Checkpoint
ôô3 =
.
ôô= >
Where
ôô> C
(
ôôC D
x
ôôD E
=>
ôôF H
x
ôôI J
.
ôôJ K
idLine
ôôK Q
==
ôôR T
Line
ôôU Y
&&
ôôZ \
x
ôô] ^
.
ôô^ _
status
ôô_ e
==
ôôf h
$num
ôôi j
&&
ôôk m
x
ôôn o
.
ôôo p
numberRoute
ôôp {
==
ôô| ~
$numôô Ä
)ôôÄ Å
.ôôÅ Ç
ToListôôÇ à
(ôôà â
)ôôâ ä
;ôôä ã
var
öö 
routes
öö "
=
öö# $
context
öö% ,
.
öö, -
Route
öö- 2
.
õõ 
Where
õõ "
(
õõ" #
x
õõ# $
=>
õõ% '
x
õõ( )
.
õõ) *
idLine
õõ* 0
==
õõ1 3
Line
õõ4 8
&&
õõ9 ;
x
õõ< =
.
õõ= >
numberRoute
õõ> I
==
õõJ L
i
õõM N
)
õõN O
.
úú 
ToList
úú #
(
úú# $
)
úú$ %
;
úú% &
if
ûû 
(
ûû 
routes
ûû "
.
ûû" #
Count
ûû# (
>
ûû) *
$num
ûû+ ,
)
ûû, -
{
üü 
count
†† !
=
††" #
$num
††$ %
;
††% &
foreach
°° #
(
°°$ %
var
°°% (
item
°°) -
in
°°. 0
routes
°°1 7
)
°°7 8
{
¢¢ 
count
££  %
++
££% '
;
££' (
Place
§§  %
place
§§& +
=
§§, -
context
§§. 5
.
§§5 6
Place
§§6 ;
.
§§; <
FirstOrDefault
§§< J
(
§§J K
x
§§K L
=>
§§M O
x
§§P Q
.
§§Q R
idPlace
§§R Y
==
§§Z \
item
§§] a
.
§§a b
idPlace
§§b i
)
§§i j
;
§§j k
if
••  "
(
••# $
place
••$ )
!=
••* ,
null
••- 1
)
••1 2
{
¶¶  !
nuevasRutas
ßß$ /
.
ßß/ 0
Add
ßß0 3
(
ßß3 4
new
ßß4 7
RutasMostrar
ßß8 D
(
ßßD E
item
ßßE I
.
ßßI J
idRoute
ßßJ Q
,
ßßQ R
item
ßßS W
.
ßßW X
latitud
ßßX _
,
ßß_ `
item
ßßa e
.
ßße f
logintud
ßßf n
,
ßßn o
place
ßßp u
.
ßßu v
descriptionßßv Å
+ßßÇ É
$strßßÉ Ü
+ßßá à
countßßà ç
,ßßç é
itemßßè ì
.ßßì î
statusßßî ö
,ßßö õ
(ßßú ù
intßßù †
)ßß† °
itemßß° •
.ßß• ¶
numPointßß¶ Æ
)ßßÆ Ø
)ßßØ ∞
;ßß∞ ±
}
®®  !
}
©© 
if
´´ 
(
´´  
nuevasRutas
´´  +
.
´´+ ,
Any
´´, /
(
´´/ 0
)
´´0 1
)
´´1 2
{
¨¨ 
RutasMostrar
≠≠  ,
primeraRuta
≠≠- 8
=
≠≠9 :
nuevasRutas
≠≠; F
.
≠≠F G
FirstOrDefault
≠≠G U
(
≠≠U V
r
≠≠V W
=>
≠≠X Z
r
≠≠[ \
.
≠≠\ ]
status
≠≠] c
==
≠≠d f
$num
≠≠g h
)
≠≠h i
;
≠≠i j
if
ÆÆ  "
(
ÆÆ# $
primeraRuta
ÆÆ$ /
!=
ÆÆ0 2
null
ÆÆ3 7
)
ÆÆ7 8
{
ØØ  !
nuevasRutas
∞∞$ /
=
∞∞0 1
nuevasRutas
∞∞2 =
.
±±( )
OrderBy
±±) 0
(
±±0 1
route
±±1 6
=>
±±7 9
route
±±: ?
.
±±? @
numPoint
±±@ H
)
±±H I
.
≤≤( )
ToList
≤≤) /
(
≤≤/ 0
)
≤≤0 1
;
≤≤1 2
}
≥≥  !
}
¥¥ 
}
µµ 
if
∑∑ 
(
∑∑ 
checkpoints
∑∑ '
.
∑∑' (
Count
∑∑( -
>
∑∑. /
$num
∑∑0 1
)
∑∑1 2
{
∏∏ 
count
ππ !
=
ππ" #
$num
ππ$ %
;
ππ% &
foreach
∫∫ #
(
∫∫$ %
var
∫∫% (
item
∫∫) -
in
∫∫. 0
checkpoints
∫∫1 <
)
∫∫< =
{
ªª 
count
ºº  %
++
ºº% '
;
ºº' (
nuevasParadas
ΩΩ  -
.
ΩΩ- .
Add
ΩΩ. 1
(
ΩΩ1 2
new
ΩΩ2 5
ParadasMostrar
ΩΩ6 D
(
ΩΩD E
item
ΩΩE I
.
ΩΩI J
idCheckpoint
ΩΩJ V
,
ΩΩV W
item
ΩΩX \
.
ΩΩ\ ]
description
ΩΩ] h
+
ΩΩi j
$str
ΩΩk n
+
ΩΩo p
count
ΩΩq v
+
ΩΩw x
$str
ΩΩy {
,
ΩΩ{ |
itemΩΩ} Å
.ΩΩÅ Ç
statusΩΩÇ à
,ΩΩà â
itemΩΩä é
.ΩΩé è
latitudΩΩè ñ
,ΩΩñ ó
itemΩΩò ú
.ΩΩú ù
longitudΩΩù •
)ΩΩ• ¶
)ΩΩ¶ ß
;ΩΩß ®
}
ææ 
if
¿¿ 
(
¿¿  
nuevasParadas
¿¿  -
.
¿¿- .
Any
¿¿. 1
(
¿¿1 2
)
¿¿2 3
)
¿¿3 4
{
¡¡ 
ParadasMostrar
¬¬  .
primeraParada
¬¬/ <
=
¬¬= >
nuevasParadas
¬¬? L
.
¬¬L M
FirstOrDefault
¬¬M [
(
¬¬[ \
r
¬¬\ ]
=>
¬¬^ `
r
¬¬a b
.
¬¬b c
status
¬¬c i
==
¬¬j l
$num
¬¬m n
)
¬¬n o
;
¬¬o p
if
√√  "
(
√√# $
primeraParada
√√$ 1
!=
√√2 4
null
√√5 9
)
√√9 :
{
ƒƒ  !
nuevasParadas
≈≈$ 1
=
≈≈2 3
nuevasParadas
≈≈4 A
.
∆∆( )
OrderBy
∆∆) 0
(
∆∆0 1
route
∆∆1 6
=>
∆∆7 9
muestraRutasMapas
∆∆: K
.
∆∆K L(
CalcularDistanciaHaversine
∆∆L f
(
∆∆f g
(
««, -
decimal
««- 4
)
««4 5
primeraParada
««5 B
.
««B C
latitud
««C J
,
««J K
(
»», -
decimal
»»- 4
)
»»4 5
primeraParada
»»5 B
.
»»B C
longitud
»»C K
,
»»K L
route
……, 1
.
……1 2
latitud
……2 9
,
……9 :
route
  , 1
.
  1 2
longitud
  2 :
)
  : ;
)
  ; <
.
ÀÀ( )
ToList
ÀÀ) /
(
ÀÀ/ 0
)
ÀÀ0 1
;
ÀÀ1 2
}
ÃÃ  !
}
ÕÕ 
}
ŒŒ 
}
œœ 
muestraRutasMapas
–– %
.
––% &
ListRutasMostrar
––& 6
=
––7 8
nuevasRutas
––9 D
;
––D E
muestraRutasMapas
—— %
.
——% & 
ListParadasMostrar
——& 8
=
——9 :
nuevasParadas
——; H
;
——H I
mapa
““ 
.
““ 
Add
““ 
(
““ 
muestraRutasMapas
““ .
)
““. /
;
““/ 0
}
”” 
return
’’ 
View
’’ 
(
’’ 
mapa
’’  
)
’’  !
;
’’! "
}
÷÷ 
catch
◊◊ 
(
◊◊ 
	Exception
◊◊ 
)
◊◊ 
{
ÿÿ 
return
ŸŸ 
RedirectToAction
ŸŸ '
(
ŸŸ' (
$str
ŸŸ( /
,
ŸŸ/ 0
$str
ŸŸ1 7
)
ŸŸ7 8
;
ŸŸ8 9
}
⁄⁄ 
}
€€ 	
public
›› 
ActionResult
›› "
IndexUbicacionesRuta
›› 0
(
››0 1
int
››1 4
NumRuta
››5 <
,
››< =
int
››> A
numTypeRoute
››B N
)
››N O
{
ﬁﬁ 	
try
ﬂﬂ 
{
‡‡ 
Login
·· 
logi
·· 
=
·· 
new
··  
Login
··! &
(
··& '
)
··' (
;
··( )
var
‚‚ 

authResult
‚‚ 
=
‚‚   
AutenticarPasosRol
‚‚! 3
(
‚‚3 4
$num
‚‚4 5
)
‚‚5 6
;
‚‚6 7
if
„„ 
(
„„ 

authResult
„„ 
!=
„„ !
null
„„" &
)
„„& '
return
„„( .

authResult
„„/ 9
;
„„9 :
if
‰‰ 
(
‰‰ 
NumRuta
‰‰ 
.
‰‰ 
ToString
‰‰ $
(
‰‰$ %
)
‰‰% &
==
‰‰' )
null
‰‰* .
)
‰‰. /
return
‰‰0 6
RedirectToAction
‰‰7 G
(
‰‰G H
$str
‰‰H \
,
‰‰\ ]
$str
‰‰^ e
)
‰‰e f
;
‰‰f g
string
ÂÂ 
Line
ÂÂ 
=
ÂÂ 
logi
ÂÂ "
.
ÂÂ" # 
GetLineaFromCookie
ÂÂ# 5
(
ÂÂ5 6
Request
ÂÂ6 =
)
ÂÂ= >
.
ÂÂ> ?
ToString
ÂÂ? G
(
ÂÂG H
)
ÂÂH I
;
ÂÂI J
List
ÊÊ 
<
ÊÊ 
RutasMostrar
ÊÊ !
>
ÊÊ! "
	rutasList
ÊÊ# ,
=
ÊÊ- .
new
ÊÊ/ 2
List
ÊÊ3 7
<
ÊÊ7 8
RutasMostrar
ÊÊ8 D
>
ÊÊD E
(
ÊÊE F
)
ÊÊF G
;
ÊÊG H
using
ËË 
(
ËË 
dbModels
ËË 
context
ËË  '
=
ËË( )
new
ËË* -
dbModels
ËË. 6
(
ËË6 7
)
ËË7 8
)
ËË8 9
{
ÈÈ 
var
ÍÍ 
routes
ÍÍ 
=
ÍÍ  
context
ÍÍ! (
.
ÍÍ( )
Route
ÍÍ) .
.
ÎÎ 
Where
ÎÎ 
(
ÎÎ 
x
ÎÎ  
=>
ÎÎ! #
x
ÎÎ$ %
.
ÎÎ% &
idLine
ÎÎ& ,
==
ÎÎ- /
Line
ÎÎ0 4
&&
ÎÎ5 7
x
ÎÎ8 9
.
ÎÎ9 :
numberRoute
ÎÎ: E
==
ÎÎF H
NumRuta
ÎÎI P
&&
ÎÎQ S
x
ÎÎT U
.
ÎÎU V
numTypeRoute
ÎÎV b
==
ÎÎc e
numTypeRoute
ÎÎf r
)
ÎÎr s
.
ÏÏ 
OrderBy
ÏÏ  
(
ÏÏ  !
x
ÏÏ! "
=>
ÏÏ# %
x
ÏÏ& '
.
ÏÏ' (
numPoint
ÏÏ( 0
)
ÏÏ0 1
.
ÌÌ 
ToList
ÌÌ 
(
ÌÌ  
)
ÌÌ  !
;
ÌÌ! "
foreach
ÔÔ 
(
ÔÔ 
var
ÔÔ  
item
ÔÔ! %
in
ÔÔ& (
routes
ÔÔ) /
)
ÔÔ/ 0
{
 
Place
ÒÒ 
place
ÒÒ #
=
ÒÒ$ %
context
ÒÒ& -
.
ÒÒ- .
Place
ÒÒ. 3
.
ÒÒ3 4
FirstOrDefault
ÒÒ4 B
(
ÒÒB C
x
ÒÒC D
=>
ÒÒE G
x
ÒÒH I
.
ÒÒI J
idPlace
ÒÒJ Q
==
ÒÒR T
item
ÒÒU Y
.
ÒÒY Z
idPlace
ÒÒZ a
)
ÒÒa b
;
ÒÒb c
if
ÚÚ 
(
ÚÚ 
place
ÚÚ !
!=
ÚÚ" $
null
ÚÚ% )
)
ÚÚ) *
{
ÛÛ 
	rutasList
ÙÙ %
.
ÙÙ% &
Add
ÙÙ& )
(
ÙÙ) *
new
ÙÙ* -
RutasMostrar
ÙÙ. :
(
ÙÙ: ;
item
ÙÙ; ?
.
ÙÙ? @
idRoute
ÙÙ@ G
,
ÙÙG H
item
ÙÙI M
.
ÙÙM N
latitud
ÙÙN U
,
ÙÙU V
item
ÙÙW [
.
ÙÙ[ \
logintud
ÙÙ\ d
,
ÙÙd e
place
ÙÙf k
.
ÙÙk l
description
ÙÙl w
,
ÙÙw x
item
ÙÙy }
.
ÙÙ} ~
statusÙÙ~ Ñ
,ÙÙÑ Ö
(ÙÙÜ á
intÙÙá ä
)ÙÙä ã
itemÙÙã è
.ÙÙè ê
numPointÙÙê ò
)ÙÙò ô
)ÙÙô ö
;ÙÙö õ
}
ıı 
}
ˆˆ 
}
˜˜ 
ViewBag
¯¯ 
.
¯¯ 
RouteChunks
¯¯ #
=
¯¯$ %
	rutasList
¯¯& /
;
¯¯/ 0
ViewBag
˘˘ 
.
˘˘ 
NumRuta
˘˘ 
=
˘˘  !
NumRuta
˘˘" )
;
˘˘) *
Session
˙˙ 
[
˙˙ 
$str
˙˙ !
]
˙˙! "
=
˙˙# $
NumRuta
˙˙% ,
;
˙˙, -
ViewBag
˚˚ 
.
˚˚ 
numTypeRoute
˚˚ $
=
˚˚% &
numTypeRoute
˚˚' 3
;
˚˚3 4
return
¸¸ 
View
¸¸ 
(
¸¸ 
)
¸¸ 
;
¸¸ 
}
˝˝ 
catch
˛˛ 
(
˛˛ 
	Exception
˛˛ 
ex
˛˛ 
)
˛˛  
{
ˇˇ 
return
ÅÅ 
RedirectToAction
ÅÅ '
(
ÅÅ' (
$str
ÅÅ( /
,
ÅÅ/ 0
$str
ÅÅ1 7
)
ÅÅ7 8
;
ÅÅ8 9
}
ÇÇ 
}
ÉÉ 	
[
ÜÜ 	
HttpPost
ÜÜ	 
]
ÜÜ 
public
áá 
ActionResult
áá "
IndexUbicacionesRuta
áá 0
(
áá0 1
string
áá1 7
ubicaciones
áá8 C
,
ááC D
int
ááE H
numTypeRoute
ááI U
)
ááU V
{
àà 	
try
ââ 
{
ää 
Login
ãã 
logi
ãã 
=
ãã 
new
ãã  
Login
ãã! &
(
ãã& '
)
ãã' (
;
ãã( )
var
åå 

authResult
åå 
=
åå   
AutenticarPasosRol
åå! 3
(
åå3 4
$num
åå4 5
)
åå5 6
;
åå6 7
if
çç 
(
çç 

authResult
çç 
!=
çç !
null
çç" &
)
çç& '
return
çç( .

authResult
çç/ 9
;
çç9 :
if
éé 
(
éé 
Session
éé 
[
éé 
$str
éé %
]
éé% &
==
éé' )
null
éé* .
)
éé. /
return
éé0 6
RedirectToAction
éé7 G
(
ééG H
$str
ééH \
,
éé\ ]
$str
éé^ e
)
éée f
;
ééf g
if
èè 
(
èè 
ubicaciones
èè 
==
èè  "
null
èè# '
)
èè' (
return
èè) /
RedirectToAction
èè0 @
(
èè@ A
$str
èèA U
,
èèU V
$str
èèW ^
)
èè^ _
;
èè_ `
string
êê 
Line
êê 
=
êê 
logi
êê "
.
êê" # 
GetLineaFromCookie
êê# 5
(
êê5 6
Request
êê6 =
)
êê= >
.
êê> ?
ToString
êê? G
(
êêG H
)
êêH I
;
êêI J
int
ëë 
numRut
ëë 
=
ëë 
int
ëë  
.
ëë  !
Parse
ëë! &
(
ëë& '
Session
ëë' .
[
ëë. /
$str
ëë/ 8
]
ëë8 9
.
ëë9 :
ToString
ëë: B
(
ëëB C
)
ëëC D
)
ëëD E
;
ëëE F
string
îî 
[
îî 
]
îî  
ubicacionesConvert
îî +
=
îî, -
JsonConvert
îî. 9
.
îî9 :
DeserializeObject
îî: K
<
îîK L
string
îîL R
[
îîR S
]
îîS T
>
îîT U
(
îîU V
ubicaciones
îîV a
)
îîa b
;
îîb c
int
ïï 
?
ïï 
maxNumPoint
ïï  
=
ïï! "
$num
ïï# $
;
ïï$ %
using
ññ 
(
ññ 
dbModels
ññ 
context
ññ  '
=
ññ( )
new
ññ* -
dbModels
ññ. 6
(
ññ6 7
)
ññ7 8
)
ññ8 9
maxNumPoint
ññ: E
=
ññF G
context
ññH O
.
ññO P
Route
ññP U
.
ññU V
Where
ññV [
(
ññ[ \
x
ññ\ ]
=>
ññ^ `
x
ñña b
.
ññb c
idLine
ññc i
==
ññj l
Line
ññm q
)
ññq r
.
ññr s
Max
ññs v
(
ññv w
x
ññw x
=>
ññy {
x
ññ| }
.
ññ} ~
numPointññ~ Ü
)ññÜ á
;ññá à
int
óó 
count
óó 
=
óó 
$num
óó 
;
óó 
int
óó "
?
óó" #
numPoint
óó$ ,
=
óó- .
maxNumPoint
óó/ :
;
óó: ;
using
òò 
(
òò 
dbModels
òò 
context
òò  '
=
òò( )
new
òò* -
dbModels
òò. 6
(
òò6 7
)
òò7 8
)
òò8 9
{
ôô 
foreach
öö 
(
öö 
var
öö  
item
öö! %
in
öö& ( 
ubicacionesConvert
öö) ;
)
öö; <
{
õõ 
count
úú 
++
úú 
;
úú  
if
ùù 
(
ùù 
!
ùù 
string
ùù #
.
ùù# $
IsNullOrEmpty
ùù$ 1
(
ùù1 2
item
ùù2 6
)
ùù6 7
)
ùù7 8
{
ûû 
string
†† "
[
††" #
]
††# $,
seccionesNombreLatitudLongitud
††% C
=
††D E
item
††F J
.
††J K
Split
††K P
(
††P Q
$char
††Q T
)
††T U
;
††U V
if
¢¢ 
(
¢¢  ,
seccionesNombreLatitudLongitud
¢¢  >
.
¢¢> ?
Length
¢¢? E
>=
¢¢F H
$num
¢¢I J
)
¢¢J K
{
££ 
string
§§  &
description
§§' 2
=
§§3 4,
seccionesNombreLatitudLongitud
§§5 S
[
§§S T
$num
§§T U
]
§§U V
.
§§V W
Trim
§§W [
(
§§[ \
)
§§\ ]
;
§§] ^
if
••  "
(
••# $
description
••$ /
==
••0 2
null
••3 7
)
••7 8
return
••9 ?
RedirectToAction
••@ P
(
••P Q
$str
••Q e
,
••e f
$str
••g n
)
••n o
;
••o p
decimal
¶¶  '
latitud
¶¶( /
=
¶¶0 1
Convert
¶¶2 9
.
¶¶9 :
	ToDecimal
¶¶: C
(
¶¶C D,
seccionesNombreLatitudLongitud
¶¶D b
[
¶¶b c
$num
¶¶c d
]
¶¶d e
.
¶¶e f
Trim
¶¶f j
(
¶¶j k
)
¶¶k l
,
¶¶l m
System
¶¶n t
.
¶¶t u
Globalization¶¶u Ç
.¶¶Ç É
CultureInfo¶¶É é
.¶¶é è 
InvariantCulture¶¶è ü
)¶¶ü †
;¶¶† °
decimal
ßß  '
longitud
ßß( 0
=
ßß1 2
Convert
ßß3 :
.
ßß: ;
	ToDecimal
ßß; D
(
ßßD E,
seccionesNombreLatitudLongitud
ßßE c
[
ßßc d
$num
ßßd e
]
ßße f
.
ßßf g
Trim
ßßg k
(
ßßk l
)
ßßl m
,
ßßm n
System
ßßo u
.
ßßu v
Globalizationßßv É
.ßßÉ Ñ
CultureInfoßßÑ è
.ßßè ê 
InvariantCultureßßê †
)ßß† °
;ßß° ¢
Place
®®  %
place
®®& +
=
®®, -
context
®®. 5
.
®®5 6
Place
®®6 ;
.
®®; <
FirstOrDefault
®®< J
(
®®J K
x
®®K L
=>
®®M O
x
®®P Q
.
®®Q R
description
®®R ]
==
®®^ `
description
®®a l
)
®®l m
;
®®m n
if
©©  "
(
©©# $
place
©©$ )
==
©©* ,
null
©©- 1
)
©©1 2
{
™™  !
place
´´$ )
=
´´* +
new
´´, /
Place
´´0 5
{
¨¨$ %
description
≠≠( 3
=
≠≠4 5
description
≠≠6 A
}
ÆÆ$ %
;
ÆÆ% &
context
ØØ$ +
.
ØØ+ ,
Place
ØØ, 1
.
ØØ1 2
Add
ØØ2 5
(
ØØ5 6
place
ØØ6 ;
)
ØØ; <
;
ØØ< =
context
∞∞$ +
.
∞∞+ ,
SaveChanges
∞∞, 7
(
∞∞7 8
)
∞∞8 9
;
∞∞9 :
}
±±  !
numPoint
≤≤  (
++
≤≤( *
;
≤≤* +
Route
¥¥  %
route
¥¥& +
=
¥¥, -
new
¥¥. 1
Route
¥¥2 7
{
µµ  !
numberRoute
∂∂$ /
=
∂∂0 1
numRut
∂∂2 8
,
∂∂8 9
idLine
∑∑$ *
=
∑∑+ ,
Line
∑∑- 1
,
∑∑1 2
status
∏∏$ *
=
∏∏+ ,
$num
∏∏- .
,
∏∏. /
latitud
ππ$ +
=
ππ, -
latitud
ππ. 5
,
ππ5 6
logintud
∫∫$ ,
=
∫∫- .
longitud
∫∫/ 7
,
∫∫7 8
idPlace
ªª$ +
=
ªª, -
place
ªª. 3
.
ªª3 4
idPlace
ªª4 ;
,
ªª; <
numPoint
ºº$ ,
=
ºº- .
numPoint
ºº/ 7
,
ºº7 8
numTypeRoute
ΩΩ$ 0
=
ΩΩ1 2
numTypeRoute
ΩΩ3 ?
}
ææ  !
;
ææ! "
context
¿¿  '
.
¿¿' (
Route
¿¿( -
.
¿¿- .
Add
¿¿. 1
(
¿¿1 2
route
¿¿2 7
)
¿¿7 8
;
¿¿8 9
}
¡¡ 
}
¬¬ 
}
√√ 
context
ƒƒ 
.
ƒƒ 
SaveChanges
ƒƒ '
(
ƒƒ' (
)
ƒƒ( )
;
ƒƒ) *
}
≈≈ 
return
«« 
RedirectToAction
«« '
(
««' (
$str
««( >
,
««> ?
$str
««@ G
,
««G H
new
««I L
{
««M N
NumRuta
««O V
=
««W X
numRut
««Y _
,
««_ `
numTypeRoute
««a m
}
««n o
)
««o p
;
««p q
}
»» 
catch
…… 
(
…… 
	Exception
…… 
)
…… 
{
   
throw
ÃÃ 
;
ÃÃ 
}
ÕÕ 
}
ŒŒ 	
public
œœ 
ActionResult
œœ 
RevertDelete
œœ (
(
œœ( )
int
œœ) ,
numTypeRoute
œœ- 9
)
œœ9 :
{
–– 	
try
—— 
{
““ 
Login
”” 
logi
”” 
=
”” 
new
””  
Login
””! &
(
””& '
)
””' (
;
””( )
var
‘‘ 

authResult
‘‘ 
=
‘‘   
AutenticarPasosRol
‘‘! 3
(
‘‘3 4
$num
‘‘4 5
)
‘‘5 6
;
‘‘6 7
if
’’ 
(
’’ 

authResult
’’ 
!=
’’ !
null
’’" &
)
’’& '
return
’’( .

authResult
’’/ 9
;
’’9 :
Route
÷÷ 
route
÷÷ 
=
÷÷ 
new
÷÷ !
Route
÷÷" '
(
÷÷' (
)
÷÷( )
;
÷÷) *
if
◊◊ 
(
◊◊ 
Session
◊◊ 
[
◊◊ 
$str
◊◊ %
]
◊◊% &
==
◊◊' )
null
◊◊* .
)
◊◊. /
return
◊◊0 6
RedirectToAction
◊◊7 G
(
◊◊G H
$str
◊◊H \
,
◊◊\ ]
$str
◊◊^ e
)
◊◊e f
;
◊◊f g
string
ÿÿ 
Line
ÿÿ 
=
ÿÿ 
logi
ÿÿ "
.
ÿÿ" # 
GetLineaFromCookie
ÿÿ# 5
(
ÿÿ5 6
Request
ÿÿ6 =
)
ÿÿ= >
.
ÿÿ> ?
ToString
ÿÿ? G
(
ÿÿG H
)
ÿÿH I
;
ÿÿI J
int
ŸŸ 
numRut
ŸŸ 
=
ŸŸ 
int
ŸŸ  
.
ŸŸ  !
Parse
ŸŸ! &
(
ŸŸ& '
Session
ŸŸ' .
[
ŸŸ. /
$str
ŸŸ/ 8
]
ŸŸ8 9
.
ŸŸ9 :
ToString
ŸŸ: B
(
ŸŸB C
)
ŸŸC D
)
ŸŸD E
;
ŸŸE F
int
⁄⁄ 
?
⁄⁄ 
maxNumPoint
⁄⁄  
=
⁄⁄! "
$num
⁄⁄# $
;
⁄⁄$ %
using
€€ 
(
€€ 
dbModels
€€ 
context
€€  '
=
€€( )
new
€€* -
dbModels
€€. 6
(
€€6 7
)
€€7 8
)
€€8 9
maxNumPoint
€€: E
=
€€F G
context
€€H O
.
€€O P
Route
€€P U
.
€€U V
Where
€€V [
(
€€[ \
x
€€\ ]
=>
€€^ `
x
€€a b
.
€€b c
idLine
€€c i
==
€€j l
Line
€€m q
&&
€€r t
x
€€u v
.
€€v w
numberRoute€€w Ç
==€€É Ö
numRut€€Ü å
&&€€ç è
x€€ê ë
.€€ë í
numTypeRoute€€í û
==€€ü °
numTypeRoute€€¢ Æ
)€€Æ Ø
.€€Ø ∞
Max€€∞ ≥
(€€≥ ¥
x€€¥ µ
=>€€∂ ∏
x€€π ∫
.€€∫ ª
numPoint€€ª √
)€€√ ƒ
;€€ƒ ≈
if
‹‹ 
(
‹‹ 
maxNumPoint
‹‹ 
>
‹‹  
$num
‹‹! "
)
‹‹" #
using
›› 
(
›› 
dbModels
›› 
context
››  '
=
››( )
new
››* -
dbModels
››. 6
(
››6 7
)
››7 8
)
››8 9
{
ﬁﬁ 
route
ﬂﬂ 
=
ﬂﬂ 
context
ﬂﬂ #
.
ﬂﬂ# $
Route
ﬂﬂ$ )
.
ﬂﬂ) *
Where
ﬂﬂ* /
(
ﬂﬂ/ 0
x
ﬂﬂ0 1
=>
ﬂﬂ2 4
x
ﬂﬂ5 6
.
ﬂﬂ6 7
numPoint
ﬂﬂ7 ?
==
ﬂﬂ@ B
maxNumPoint
ﬂﬂC N
&&
ﬂﬂO Q
x
ﬂﬂR S
.
ﬂﬂS T
numberRoute
ﬂﬂT _
==
ﬂﬂ` b
numRut
ﬂﬂc i
&&
ﬂﬂj l
x
ﬂﬂm n
.
ﬂﬂn o
numTypeRoute
ﬂﬂo {
==
ﬂﬂ| ~
numTypeRouteﬂﬂ ã
&&ﬂﬂå é
xﬂﬂè ê
.ﬂﬂê ë
idLineﬂﬂë ó
==ﬂﬂò ö
Lineﬂﬂõ ü
)ﬂﬂü †
.ﬂﬂ† °
FirstOrDefaultﬂﬂ° Ø
(ﬂﬂØ ∞
)ﬂﬂ∞ ±
;ﬂﬂ± ≤
var
‡‡ 
	deviation
‡‡ !
=
‡‡" #
context
‡‡$ +
.
‡‡+ ,
DeviationRote
‡‡, 9
.
‡‡9 :
Where
‡‡: ?
(
‡‡? @
x
‡‡@ A
=>
‡‡B D
x
‡‡E F
.
‡‡F G

idRouteEnd
‡‡G Q
==
‡‡R T
route
‡‡U Z
.
‡‡Z [
idRoute
‡‡[ b
||
‡‡c e
x
‡‡f g
.
‡‡g h
idRouteStart
‡‡h t
==
‡‡u w
route
‡‡x }
.
‡‡} ~
idRoute‡‡~ Ö
)‡‡Ö Ü
.‡‡Ü á
ToList‡‡á ç
(‡‡ç é
)‡‡é è
;‡‡è ê
context
·· 
.
·· 
Route
·· !
.
··! "
Remove
··" (
(
··( )
route
··) .
)
··. /
;
··/ 0
if
‚‚ 
(
‚‚ 
	deviation
‚‚ !
.
‚‚! "
Count
‚‚" '
>
‚‚( )
$num
‚‚* +
)
‚‚+ ,
{
„„ 
foreach
‰‰ 
(
‰‰  !
var
‰‰! $
item
‰‰% )
in
‰‰* ,
	deviation
‰‰- 6
)
‰‰6 7
{
ÂÂ 
context
ÊÊ #
.
ÊÊ# $
DeviationRote
ÊÊ$ 1
.
ÊÊ1 2
Remove
ÊÊ2 8
(
ÊÊ8 9
item
ÊÊ9 =
)
ÊÊ= >
;
ÊÊ> ?
}
ÁÁ 
}
ËË 
context
ÈÈ 
.
ÈÈ 
SaveChanges
ÈÈ '
(
ÈÈ' (
)
ÈÈ( )
;
ÈÈ) *
}
ÍÍ 
return
ÎÎ 
RedirectToAction
ÎÎ '
(
ÎÎ' (
$str
ÎÎ( >
,
ÎÎ> ?
$str
ÎÎ@ G
,
ÎÎG H
new
ÎÎI L
{
ÎÎM N
NumRuta
ÎÎO V
=
ÎÎW X
numRut
ÎÎY _
,
ÎÎ_ `
numTypeRoute
ÎÎa m
=
ÎÎn o
numTypeRoute
ÎÎp |
}
ÎÎ} ~
)
ÎÎ~ 
;ÎÎ Ä
}
ÏÏ 
catch
ÌÌ 
{
ÓÓ 
return
ÔÔ 
RedirectToAction
ÔÔ '
(
ÔÔ' (
$str
ÔÔ( /
,
ÔÔ/ 0
$str
ÔÔ1 7
)
ÔÔ7 8
;
ÔÔ8 9
}
 
}
ÒÒ 	
public
ÚÚ 
ActionResult
ÚÚ 
RegisterCheck
ÚÚ )
(
ÚÚ) *
int
ÚÚ* -
numTypeRoute
ÚÚ. :
)
ÚÚ: ;
{
ÛÛ 	
try
ÙÙ 
{
ıı 
Login
ˆˆ 
logi
ˆˆ 
=
ˆˆ 
new
ˆˆ  
Login
ˆˆ! &
(
ˆˆ& '
)
ˆˆ' (
;
ˆˆ( )
var
˜˜ 

authResult
˜˜ 
=
˜˜   
AutenticarPasosRol
˜˜! 3
(
˜˜3 4
$num
˜˜4 5
)
˜˜5 6
;
˜˜6 7
if
¯¯ 
(
¯¯ 

authResult
¯¯ 
!=
¯¯ !
null
¯¯" &
)
¯¯& '
return
¯¯( .

authResult
¯¯/ 9
;
¯¯9 :
string
˙˙ 
Line
˙˙ 
=
˙˙ 
logi
˙˙ "
.
˙˙" # 
GetLineaFromCookie
˙˙# 5
(
˙˙5 6
Request
˙˙6 =
)
˙˙= >
.
˙˙> ?
ToString
˙˙? G
(
˙˙G H
)
˙˙H I
;
˙˙I J
List
˚˚ 
<
˚˚ 
MuestraRutasMapas
˚˚ &
>
˚˚& '
mapa
˚˚( ,
=
˚˚- .
new
˚˚/ 2
List
˚˚3 7
<
˚˚7 8
MuestraRutasMapas
˚˚8 I
>
˚˚I J
(
˚˚J K
)
˚˚K L
;
˚˚L M
int
¸¸ 
count
¸¸ 
=
¸¸ 
$num
¸¸ 
;
¸¸ 
for
˝˝ 
(
˝˝ 
int
˝˝ 
i
˝˝ 
=
˝˝ 
$num
˝˝ 
;
˝˝ 
i
˝˝  !
<=
˝˝" $
$num
˝˝% &
;
˝˝& '
i
˝˝( )
++
˝˝) +
)
˝˝+ ,
{
˛˛ 
MuestraRutasMapas
ˇˇ %
muestraRutasMapas
ˇˇ& 7
=
ˇˇ8 9
new
ˇˇ: =
MuestraRutasMapas
ˇˇ> O
{
ÄÄ 
ListRutasMostrar
ÅÅ (
=
ÅÅ) *
new
ÅÅ+ .
List
ÅÅ/ 3
<
ÅÅ3 4
RutasMostrar
ÅÅ4 @
>
ÅÅ@ A
(
ÅÅA B
)
ÅÅB C
,
ÅÅC D 
ListParadasMostrar
ÇÇ *
=
ÇÇ+ ,
new
ÇÇ- 0
List
ÇÇ1 5
<
ÇÇ5 6
ParadasMostrar
ÇÇ6 D
>
ÇÇD E
(
ÇÇE F
)
ÇÇF G
,
ÇÇG H

NumeroRuta
ÉÉ "
=
ÉÉ# $
i
ÉÉ% &
}
ÑÑ 
;
ÑÑ 
List
ÜÜ 
<
ÜÜ 
RutasMostrar
ÜÜ %
>
ÜÜ% &
nuevasRutas
ÜÜ' 2
=
ÜÜ3 4
new
ÜÜ5 8
List
ÜÜ9 =
<
ÜÜ= >
RutasMostrar
ÜÜ> J
>
ÜÜJ K
(
ÜÜK L
)
ÜÜL M
;
ÜÜM N
List
áá 
<
áá 
ParadasMostrar
áá '
>
áá' (
nuevasParadas
áá) 6
=
áá7 8
new
áá9 <
List
áá= A
<
ááA B
ParadasMostrar
ááB P
>
ááP Q
(
ááQ R
)
ááR S
;
ááS T
using
ââ 
(
ââ 
dbModels
ââ #
context
ââ$ +
=
ââ, -
new
ââ. 1
dbModels
ââ2 :
(
ââ: ;
)
ââ; <
)
ââ< =
{
ää 
var
ãã 
checkpoints
ãã '
=
ãã( )
context
ãã* 1
.
ãã1 2

Checkpoint
ãã2 <
.
ãã< =
Where
ãã= B
(
ããB C
x
ããC D
=>
ããE G
x
ããH I
.
ããI J
idLine
ããJ P
==
ããQ S
Line
ããT X
&&
ããY [
x
ãã\ ]
.
ãã] ^
status
ãã^ d
==
ããe g
$num
ããh i
&&
ããj l
x
ããm n
.
ããn o
numberRoute
ãão z
==
ãã{ }
numTypeRouteãã~ ä
)ããä ã
.ããã å
ToListããå í
(ããí ì
)ããì î
;ããî ï
var
åå 
routes
åå "
=
åå# $
context
åå% ,
.
åå, -
Route
åå- 2
.
çç 
Where
çç "
(
çç" #
x
çç# $
=>
çç% '
x
çç( )
.
çç) *
idLine
çç* 0
==
çç1 3
Line
çç4 8
&&
çç9 ;
x
çç< =
.
çç= >
numberRoute
çç> I
==
ççJ L
i
ççM N
&&
ççO Q
x
ççR S
.
ççS T
numTypeRoute
ççT `
==
çça c
numTypeRoute
ççd p
)
ççp q
.
éé 
ToList
éé #
(
éé# $
)
éé$ %
;
éé% &
if
êê 
(
êê 
routes
êê "
.
êê" #
Count
êê# (
>
êê) *
$num
êê+ ,
)
êê, -
{
ëë 
count
íí !
=
íí" #
$num
íí$ %
;
íí% &
foreach
ìì #
(
ìì$ %
var
ìì% (
item
ìì) -
in
ìì. 0
routes
ìì1 7
)
ìì7 8
{
îî 
count
ïï  %
++
ïï% '
;
ïï' (
Place
ññ  %
place
ññ& +
=
ññ, -
context
ññ. 5
.
ññ5 6
Place
ññ6 ;
.
ññ; <
FirstOrDefault
ññ< J
(
ññJ K
x
ññK L
=>
ññM O
x
ññP Q
.
ññQ R
idPlace
ññR Y
==
ññZ \
item
ññ] a
.
ñña b
idPlace
ññb i
)
ññi j
;
ññj k
if
óó  "
(
óó# $
place
óó$ )
!=
óó* ,
null
óó- 1
)
óó1 2
{
òò  !
nuevasRutas
ôô$ /
.
ôô/ 0
Add
ôô0 3
(
ôô3 4
new
ôô4 7
RutasMostrar
ôô8 D
(
ôôD E
item
ôôE I
.
ôôI J
idRoute
ôôJ Q
,
ôôQ R
item
ôôS W
.
ôôW X
latitud
ôôX _
,
ôô_ `
item
ôôa e
.
ôôe f
logintud
ôôf n
,
ôôn o
place
ôôp u
.
ôôu v
descriptionôôv Å
,ôôÅ Ç
itemôôÉ á
.ôôá à
statusôôà é
,ôôé è
(ôôê ë
intôôë î
)ôôî ï
itemôôï ô
.ôôô ö
numPointôôö ¢
)ôô¢ £
)ôô£ §
;ôô§ •
}
öö  !
}
õõ 
if
ùù 
(
ùù  
nuevasRutas
ùù  +
.
ùù+ ,
Any
ùù, /
(
ùù/ 0
)
ùù0 1
)
ùù1 2
{
ûû 
RutasMostrar
üü  ,
primeraRuta
üü- 8
=
üü9 :
nuevasRutas
üü; F
.
üüF G
FirstOrDefault
üüG U
(
üüU V
r
üüV W
=>
üüX Z
r
üü[ \
.
üü\ ]
status
üü] c
==
üüd f
$num
üüg h
)
üüh i
;
üüi j
if
††  "
(
††# $
primeraRuta
††$ /
!=
††0 2
null
††3 7
)
††7 8
{
°°  !
nuevasRutas
¢¢$ /
=
¢¢0 1
nuevasRutas
¢¢2 =
.
££( )
OrderBy
££) 0
(
££0 1
route
££1 6
=>
££7 9
route
££: ?
.
££? @
numPoint
££@ H
)
££H I
.
§§( )
ToList
§§) /
(
§§/ 0
)
§§0 1
;
§§1 2
}
••  !
}
¶¶ 
foreach
ßß #
(
ßß$ %
var
ßß% (
item
ßß) -
in
ßß. 0
nuevasParadas
ßß1 >
)
ßß> ?
{
®® 
count
©©  %
++
©©% '
;
©©' (
item
™™  $
.
™™$ %
description
™™% 0
=
™™1 2
item
™™3 7
.
™™7 8
description
™™8 C
+
™™D E
$str
™™F I
+
™™J K
count
™™L Q
;
™™Q R
}
´´ 
}
¨¨ 
if
ÆÆ 
(
ÆÆ 
checkpoints
ÆÆ '
.
ÆÆ' (
Count
ÆÆ( -
>
ÆÆ. /
$num
ÆÆ0 1
)
ÆÆ1 2
{
ØØ 
count
∞∞ !
=
∞∞" #
$num
∞∞$ %
;
∞∞% &
foreach
±± #
(
±±$ %
var
±±% (
item
±±) -
in
±±. 0
checkpoints
±±1 <
)
±±< =
{
≤≤ 
nuevasParadas
¥¥  -
.
¥¥- .
Add
¥¥. 1
(
¥¥1 2
new
¥¥2 5
ParadasMostrar
¥¥6 D
(
¥¥D E
item
¥¥E I
.
¥¥I J
idCheckpoint
¥¥J V
,
¥¥V W
item
¥¥X \
.
¥¥\ ]
description
¥¥] h
,
¥¥h i
item
¥¥j n
.
¥¥n o
status
¥¥o u
,
¥¥u v
item
¥¥w {
.
¥¥{ |
latitud¥¥| É
,¥¥É Ñ
item¥¥Ö â
.¥¥â ä
longitud¥¥ä í
)¥¥í ì
)¥¥ì î
;¥¥î ï
}
µµ 
if
∑∑ 
(
∑∑  
nuevasParadas
∑∑  -
.
∑∑- .
Any
∑∑. 1
(
∑∑1 2
)
∑∑2 3
)
∑∑3 4
{
∏∏ 
ParadasMostrar
ππ  .
primeraParada
ππ/ <
=
ππ= >
nuevasParadas
ππ? L
.
ππL M
FirstOrDefault
ππM [
(
ππ[ \
r
ππ\ ]
=>
ππ^ `
r
ππa b
.
ππb c
status
ππc i
==
ππj l
$num
ππm n
)
ππn o
;
ππo p
if
∫∫  "
(
∫∫# $
primeraParada
∫∫$ 1
!=
∫∫2 4
null
∫∫5 9
)
∫∫9 :
{
ªª  !
nuevasParadas
ºº$ 1
=
ºº2 3
nuevasParadas
ºº4 A
.
ΩΩ( )
OrderBy
ΩΩ) 0
(
ΩΩ0 1
route
ΩΩ1 6
=>
ΩΩ7 9
muestraRutasMapas
ΩΩ: K
.
ΩΩK L(
CalcularDistanciaHaversine
ΩΩL f
(
ΩΩf g
(
ææ, -
decimal
ææ- 4
)
ææ4 5
primeraParada
ææ5 B
.
ææB C
latitud
ææC J
,
ææJ K
(
øø, -
decimal
øø- 4
)
øø4 5
primeraParada
øø5 B
.
øøB C
longitud
øøC K
,
øøK L
route
¿¿, 1
.
¿¿1 2
latitud
¿¿2 9
,
¿¿9 :
route
¡¡, 1
.
¡¡1 2
longitud
¡¡2 :
)
¡¡: ;
)
¡¡; <
.
¬¬( )
ToList
¬¬) /
(
¬¬/ 0
)
¬¬0 1
;
¬¬1 2
}
√√  !
}
ƒƒ 
foreach
≈≈ #
(
≈≈$ %
var
≈≈% (
item
≈≈) -
in
≈≈. 0
nuevasParadas
≈≈1 >
)
≈≈> ?
{
∆∆ 
count
««  %
++
««% '
;
««' (
item
»»  $
.
»»$ %
description
»»% 0
=
»»1 2
item
»»3 7
.
»»7 8
description
»»8 C
+
»»D E
$str
»»F I
+
»»J K
count
»»L Q
;
»»Q R
}
…… 
}
   
}
ÀÀ 
muestraRutasMapas
ÃÃ %
.
ÃÃ% &
ListRutasMostrar
ÃÃ& 6
=
ÃÃ7 8
nuevasRutas
ÃÃ9 D
;
ÃÃD E
muestraRutasMapas
ÕÕ %
.
ÕÕ% & 
ListParadasMostrar
ÕÕ& 8
=
ÕÕ9 :
nuevasParadas
ÕÕ; H
;
ÕÕH I
mapa
ŒŒ 
.
ŒŒ 
Add
ŒŒ 
(
ŒŒ 
muestraRutasMapas
ŒŒ .
)
ŒŒ. /
;
ŒŒ/ 0
}
œœ 
ViewBag
–– 
.
–– 
numTypeRoute
–– $
=
––% &
numTypeRoute
––' 3
;
––3 4
return
—— 
View
—— 
(
—— 
mapa
——  
)
——  !
;
——! "
}
““ 
catch
”” 
(
”” 
	Exception
”” 
)
”” 
{
‘‘ 
return
’’ 
RedirectToAction
’’ '
(
’’' (
$str
’’( /
,
’’/ 0
$str
’’1 7
)
’’7 8
;
’’8 9
}
÷÷ 
}
◊◊ 	
[
ÿÿ 	
HttpPost
ÿÿ	 
]
ÿÿ 
public
ŸŸ 
ActionResult
ŸŸ 
RegisterCheck
ŸŸ )
(
ŸŸ) *
string
ŸŸ* 0
ubicaciones
ŸŸ1 <
,
ŸŸ< =
string
ŸŸ> D
hora
ŸŸE I
,
ŸŸI J
string
ŸŸK Q
minuto
ŸŸR X
,
ŸŸX Y
string
ŸŸZ `
horaMercado
ŸŸa l
,
ŸŸl m
string
ŸŸn t
minutoMercadoŸŸu Ç
,ŸŸÇ É
intŸŸÑ á
numTypeRouteŸŸà î
)ŸŸî ï
{
⁄⁄ 	
try
€€ 
{
‹‹ 
Login
›› 
logi
›› 
=
›› 
new
››  
Login
››! &
(
››& '
)
››' (
;
››( )
var
ﬁﬁ 

authResult
ﬁﬁ 
=
ﬁﬁ   
AutenticarPasosRol
ﬁﬁ! 3
(
ﬁﬁ3 4
$num
ﬁﬁ4 5
)
ﬁﬁ5 6
;
ﬁﬁ6 7
if
ﬂﬂ 
(
ﬂﬂ 

authResult
ﬂﬂ 
!=
ﬂﬂ !
null
ﬂﬂ" &
)
ﬂﬂ& '
return
ﬂﬂ( .

authResult
ﬂﬂ/ 9
;
ﬂﬂ9 :
string
‡‡ 
Line
‡‡ 
=
‡‡ 
logi
‡‡ "
.
‡‡" # 
GetLineaFromCookie
‡‡# 5
(
‡‡5 6
Request
‡‡6 =
)
‡‡= >
.
‡‡> ?
ToString
‡‡? G
(
‡‡G H
)
‡‡H I
;
‡‡I J
if
·· 
(
·· 
ubicaciones
·· 
==
··  "
null
··# '
)
··' (
return
··) /
RedirectToAction
··0 @
(
··@ A
$str
··A P
,
··P Q
$str
··R Y
)
··Y Z
;
··Z [
using
‰‰ 
(
‰‰ 
dbModels
‰‰ 
context
‰‰  '
=
‰‰( )
new
‰‰* -
dbModels
‰‰. 6
(
‰‰6 7
)
‰‰7 8
)
‰‰8 9
{
ÂÂ 
string
ÁÁ 
[
ÁÁ 
]
ÁÁ ,
seccionesNombreLatitudLongitud
ÁÁ ;
=
ÁÁ< =
ubicaciones
ÁÁ> I
.
ÁÁI J
Split
ÁÁJ O
(
ÁÁO P
$char
ÁÁP S
)
ÁÁS T
;
ÁÁT U
if
ÈÈ 
(
ÈÈ ,
seccionesNombreLatitudLongitud
ÈÈ 6
.
ÈÈ6 7
Length
ÈÈ7 =
>=
ÈÈ> @
$num
ÈÈA B
)
ÈÈB C
{
ÍÍ 
string
ÎÎ 
horaCompleta
ÎÎ +
=
ÎÎ, -
hora
ÎÎ. 2
+
ÎÎ3 4
$str
ÎÎ5 8
+
ÎÎ9 :
minuto
ÎÎ; A
;
ÎÎA B
string
ÏÏ !
horaCompletaMercado
ÏÏ 2
=
ÏÏ3 4
horaMercado
ÏÏ5 @
+
ÏÏA B
$str
ÏÏC F
+
ÏÏG H
minutoMercado
ÏÏI V
;
ÏÏV W
string
ÌÌ 
description
ÌÌ *
=
ÌÌ+ ,,
seccionesNombreLatitudLongitud
ÌÌ- K
[
ÌÌK L
$num
ÌÌL M
]
ÌÌM N
.
ÌÌN O
Trim
ÌÌO S
(
ÌÌS T
)
ÌÌT U
;
ÌÌU V
if
ÓÓ 
(
ÓÓ 
description
ÓÓ '
==
ÓÓ( *
null
ÓÓ+ /
)
ÓÓ/ 0
return
ÓÓ1 7
RedirectToAction
ÓÓ8 H
(
ÓÓH I
$str
ÓÓI ]
,
ÓÓ] ^
$str
ÓÓ_ f
)
ÓÓf g
;
ÓÓg h
decimal
ÔÔ 
latitud
ÔÔ  '
=
ÔÔ( )
Convert
ÔÔ* 1
.
ÔÔ1 2
	ToDecimal
ÔÔ2 ;
(
ÔÔ; <,
seccionesNombreLatitudLongitud
ÔÔ< Z
[
ÔÔZ [
$num
ÔÔ[ \
]
ÔÔ\ ]
.
ÔÔ] ^
Trim
ÔÔ^ b
(
ÔÔb c
)
ÔÔc d
,
ÔÔd e
System
ÔÔf l
.
ÔÔl m
Globalization
ÔÔm z
.
ÔÔz {
CultureInfoÔÔ{ Ü
.ÔÔÜ á 
InvariantCultureÔÔá ó
)ÔÔó ò
;ÔÔò ô
decimal
 
longitud
  (
=
) *
Convert
+ 2
.
2 3
	ToDecimal
3 <
(
< =,
seccionesNombreLatitudLongitud
= [
[
[ \
$num
\ ]
]
] ^
.
^ _
Trim
_ c
(
c d
)
d e
,
e f
System
g m
.
m n
Globalization
n {
.
{ |
CultureInfo| á
.á à 
InvariantCultureà ò
)ò ô
;ô ö

Checkpoint
ÚÚ "

checkpoint
ÚÚ# -
=
ÚÚ. /
new
ÚÚ0 3

Checkpoint
ÚÚ4 >
{
ÛÛ 
numberRoute
ÙÙ '
=
ÙÙ( )
numTypeRoute
ÙÙ* 6
,
ÙÙ6 7
idLine
ıı "
=
ıı# $
Line
ıı% )
,
ıı) *
status
ˆˆ "
=
ˆˆ# $
$num
ˆˆ% &
,
ˆˆ& '
latitud
˜˜ #
=
˜˜$ %
latitud
˜˜& -
,
˜˜- .
longitud
¯¯ $
=
¯¯% &
longitud
¯¯' /
,
¯¯/ 0
description
˘˘ '
=
˘˘( )
$str
˘˘* 3
+
˘˘4 5
description
˘˘6 A
,
˘˘A B

minArrival
˙˙ &
=
˙˙' (
horaCompleta
˙˙) 5
,
˙˙5 6
minArrivalMarket
˚˚ ,
=
˚˚- .!
horaCompletaMercado
˚˚/ B
}
¸¸ 
;
¸¸ 
context
˝˝ 
.
˝˝  

Checkpoint
˝˝  *
.
˝˝* +
Add
˝˝+ .
(
˝˝. /

checkpoint
˝˝/ 9
)
˝˝9 :
;
˝˝: ;
}
˛˛ 
context
ÅÅ 
.
ÅÅ 
SaveChanges
ÅÅ '
(
ÅÅ' (
)
ÅÅ( )
;
ÅÅ) *
}
ÇÇ 
return
ÉÉ 
RedirectToAction
ÉÉ '
(
ÉÉ' (
$str
ÉÉ( 7
,
ÉÉ7 8
$str
ÉÉ9 @
,
ÉÉ@ A
new
ÉÉB E
{
ÉÉF G
numTypeRoute
ÉÉH T
=
ÉÉU V
numTypeRoute
ÉÉW c
}
ÉÉc d
)
ÉÉd e
;
ÉÉe f
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
)
ÖÖ 
{
ÜÜ 
return
àà 
RedirectToAction
àà '
(
àà' (
$str
àà( /
,
àà/ 0
$str
àà1 7
)
àà7 8
;
àà8 9
}
ââ 
}
ää 	
public
ãã 
ActionResult
ãã 
	EditCheck
ãã %
(
ãã% &
int
ãã& )
id
ãã* ,
,
ãã, -
int
ãã. 1
numTypeRoute
ãã2 >
)
ãã> ?
{
åå 	
try
çç 
{
éé 
Login
èè 
logi
èè 
=
èè 
new
èè  
Login
èè! &
(
èè& '
)
èè' (
;
èè( )
var
êê 

authResult
êê 
=
êê   
AutenticarPasosRol
êê! 3
(
êê3 4
$num
êê4 5
)
êê5 6
;
êê6 7
if
ëë 
(
ëë 

authResult
ëë 
!=
ëë !
null
ëë" &
)
ëë& '
return
ëë( .

authResult
ëë/ 9
;
ëë9 :
string
ìì 
Line
ìì 
=
ìì 
logi
ìì "
.
ìì" # 
GetLineaFromCookie
ìì# 5
(
ìì5 6
Request
ìì6 =
)
ìì= >
.
ìì> ?
ToString
ìì? G
(
ììG H
)
ììH I
;
ììI J
List
îî 
<
îî 
MuestraRutasMapas
îî &
>
îî& '
mapa
îî( ,
=
îî- .
new
îî/ 2
List
îî3 7
<
îî7 8
MuestraRutasMapas
îî8 I
>
îîI J
(
îîJ K
)
îîK L
;
îîL M
int
ïï 
count
ïï 
=
ïï 
$num
ïï 
;
ïï 
for
ññ 
(
ññ 
int
ññ 
i
ññ 
=
ññ 
$num
ññ 
;
ññ 
i
ññ  !
<=
ññ" $
$num
ññ% &
;
ññ& '
i
ññ( )
++
ññ) +
)
ññ+ ,
{
óó 
MuestraRutasMapas
òò %
muestraRutasMapas
òò& 7
=
òò8 9
new
òò: =
MuestraRutasMapas
òò> O
{
ôô 
ListRutasMostrar
öö (
=
öö) *
new
öö+ .
List
öö/ 3
<
öö3 4
RutasMostrar
öö4 @
>
öö@ A
(
ööA B
)
ööB C
,
ööC D 
ListParadasMostrar
õõ *
=
õõ+ ,
new
õõ- 0
List
õõ1 5
<
õõ5 6
ParadasMostrar
õõ6 D
>
õõD E
(
õõE F
)
õõF G
,
õõG H

NumeroRuta
úú "
=
úú# $
i
úú% &
}
ùù 
;
ùù 
List
üü 
<
üü 
RutasMostrar
üü %
>
üü% &
nuevasRutas
üü' 2
=
üü3 4
new
üü5 8
List
üü9 =
<
üü= >
RutasMostrar
üü> J
>
üüJ K
(
üüK L
)
üüL M
;
üüM N
List
†† 
<
†† 
ParadasMostrar
†† '
>
††' (
nuevasParadas
††) 6
=
††7 8
new
††9 <
List
††= A
<
††A B
ParadasMostrar
††B P
>
††P Q
(
††Q R
)
††R S
;
††S T
using
¢¢ 
(
¢¢ 
dbModels
¢¢ #
context
¢¢$ +
=
¢¢, -
new
¢¢. 1
dbModels
¢¢2 :
(
¢¢: ;
)
¢¢; <
)
¢¢< =
{
££ 
var
§§ 
checkpoints
§§ '
=
§§( )
context
§§* 1
.
§§1 2

Checkpoint
§§2 <
.
§§< =
Where
§§= B
(
§§B C
x
§§C D
=>
§§E G
x
§§H I
.
§§I J
idLine
§§J P
==
§§Q S
Line
§§T X
&&
§§Y [
x
§§\ ]
.
§§] ^
status
§§^ d
==
§§e g
$num
§§h i
&&
§§j l
x
§§m n
.
§§n o
numberRoute
§§o z
==
§§{ }
numTypeRoute§§~ ä
&&§§ã ç
x§§é è
.§§è ê
idCheckpoint§§ê ú
==§§ù ü
id§§† ¢
)§§¢ £
.§§£ §
ToList§§§ ™
(§§™ ´
)§§´ ¨
;§§¨ ≠
var
•• 
routes
•• "
=
••# $
context
••% ,
.
••, -
Route
••- 2
.
¶¶ 
Where
¶¶ "
(
¶¶" #
x
¶¶# $
=>
¶¶% '
x
¶¶( )
.
¶¶) *
idLine
¶¶* 0
==
¶¶1 3
Line
¶¶4 8
&&
¶¶9 ;
x
¶¶< =
.
¶¶= >
numberRoute
¶¶> I
==
¶¶J L
i
¶¶M N
&&
¶¶O Q
x
¶¶R S
.
¶¶S T
numTypeRoute
¶¶T `
==
¶¶a c
numTypeRoute
¶¶d p
)
¶¶p q
.
ßß 
ToList
ßß #
(
ßß# $
)
ßß$ %
;
ßß% &
if
©© 
(
©© 
routes
©© "
.
©©" #
Count
©©# (
>
©©) *
$num
©©+ ,
)
©©, -
{
™™ 
count
´´ !
=
´´" #
$num
´´$ %
;
´´% &
foreach
¨¨ #
(
¨¨$ %
var
¨¨% (
item
¨¨) -
in
¨¨. 0
routes
¨¨1 7
)
¨¨7 8
{
≠≠ 
count
ÆÆ  %
++
ÆÆ% '
;
ÆÆ' (
Place
ØØ  %
place
ØØ& +
=
ØØ, -
context
ØØ. 5
.
ØØ5 6
Place
ØØ6 ;
.
ØØ; <
FirstOrDefault
ØØ< J
(
ØØJ K
x
ØØK L
=>
ØØM O
x
ØØP Q
.
ØØQ R
idPlace
ØØR Y
==
ØØZ \
item
ØØ] a
.
ØØa b
idPlace
ØØb i
)
ØØi j
;
ØØj k
if
∞∞  "
(
∞∞# $
place
∞∞$ )
!=
∞∞* ,
null
∞∞- 1
)
∞∞1 2
{
±±  !
nuevasRutas
≤≤$ /
.
≤≤/ 0
Add
≤≤0 3
(
≤≤3 4
new
≤≤4 7
RutasMostrar
≤≤8 D
(
≤≤D E
item
≤≤E I
.
≤≤I J
idRoute
≤≤J Q
,
≤≤Q R
item
≤≤S W
.
≤≤W X
latitud
≤≤X _
,
≤≤_ `
item
≤≤a e
.
≤≤e f
logintud
≤≤f n
,
≤≤n o
place
≤≤p u
.
≤≤u v
description≤≤v Å
+≤≤Ç É
$str≤≤Ñ á
+≤≤à â
count≤≤ä è
,≤≤è ê
item≤≤ë ï
.≤≤ï ñ
status≤≤ñ ú
,≤≤ú ù
(≤≤û ü
int≤≤ü ¢
)≤≤¢ £
item≤≤£ ß
.≤≤ß ®
numPoint≤≤® ∞
)≤≤∞ ±
)≤≤± ≤
;≤≤≤ ≥
}
≥≥  !
}
¥¥ 
if
∂∂ 
(
∂∂  
nuevasRutas
∂∂  +
.
∂∂+ ,
Any
∂∂, /
(
∂∂/ 0
)
∂∂0 1
)
∂∂1 2
{
∑∑ 
RutasMostrar
∏∏  ,
primeraRuta
∏∏- 8
=
∏∏9 :
nuevasRutas
∏∏; F
.
∏∏F G
FirstOrDefault
∏∏G U
(
∏∏U V
r
∏∏V W
=>
∏∏X Z
r
∏∏[ \
.
∏∏\ ]
status
∏∏] c
==
∏∏d f
$num
∏∏g h
)
∏∏h i
;
∏∏i j
if
ππ  "
(
ππ# $
primeraRuta
ππ$ /
!=
ππ0 2
null
ππ3 7
)
ππ7 8
{
∫∫  !
nuevasRutas
ªª$ /
=
ªª0 1
nuevasRutas
ªª2 =
.
ºº( )
OrderBy
ºº) 0
(
ºº0 1
route
ºº1 6
=>
ºº7 9
route
ºº: ?
.
ºº? @
numPoint
ºº@ H
)
ººH I
.
ΩΩ( )
ToList
ΩΩ) /
(
ΩΩ/ 0
)
ΩΩ0 1
;
ΩΩ1 2
}
ææ  !
}
øø 
}
¿¿ 
if
¬¬ 
(
¬¬ 
checkpoints
¬¬ '
.
¬¬' (
Count
¬¬( -
>
¬¬. /
$num
¬¬0 1
)
¬¬1 2
{
√√ 
foreach
≈≈ #
(
≈≈$ %
var
≈≈% (
item
≈≈) -
in
≈≈. 0
checkpoints
≈≈1 <
)
≈≈< =
{
∆∆ 
nuevasParadas
««  -
.
««- .
Add
««. 1
(
««1 2
new
««2 5
ParadasMostrar
««6 D
(
««D E
item
««E I
.
««I J
idCheckpoint
««J V
,
««V W
item
««X \
.
««\ ]
description
««] h
,
««h i
item
««j n
.
««n o
status
««o u
,
««u v
item
««w {
.
««{ |
latitud««| É
,««É Ñ
item««Ö â
.««â ä
longitud««ä í
)««í ì
)««ì î
;««î ï
}
»» 
if
   
(
    
nuevasParadas
    -
.
  - .
Any
  . 1
(
  1 2
)
  2 3
)
  3 4
{
ÀÀ 
ParadasMostrar
ÃÃ  .
primeraParada
ÃÃ/ <
=
ÃÃ= >
nuevasParadas
ÃÃ? L
.
ÃÃL M
FirstOrDefault
ÃÃM [
(
ÃÃ[ \
r
ÃÃ\ ]
=>
ÃÃ^ `
r
ÃÃa b
.
ÃÃb c
status
ÃÃc i
==
ÃÃj l
$num
ÃÃm n
)
ÃÃn o
;
ÃÃo p
if
ÕÕ  "
(
ÕÕ# $
primeraParada
ÕÕ$ 1
!=
ÕÕ2 4
null
ÕÕ5 9
)
ÕÕ9 :
{
ŒŒ  !
nuevasParadas
œœ$ 1
=
œœ2 3
nuevasParadas
œœ4 A
.
––( )
OrderBy
––) 0
(
––0 1
route
––1 6
=>
––7 9
muestraRutasMapas
––: K
.
––K L(
CalcularDistanciaHaversine
––L f
(
––f g
(
——, -
decimal
——- 4
)
——4 5
primeraParada
——5 B
.
——B C
latitud
——C J
,
——J K
(
““, -
decimal
““- 4
)
““4 5
primeraParada
““5 B
.
““B C
longitud
““C K
,
““K L
route
””, 1
.
””1 2
latitud
””2 9
,
””9 :
route
‘‘, 1
.
‘‘1 2
longitud
‘‘2 :
)
‘‘: ;
)
‘‘; <
.
’’( )
ToList
’’) /
(
’’/ 0
)
’’0 1
;
’’1 2
}
÷÷  !
}
◊◊ 
}
ÿÿ 
}
ŸŸ 
List
⁄⁄ 
<
⁄⁄ 
string
⁄⁄ 
>
⁄⁄  
horas
⁄⁄! &
=
⁄⁄' (
new
⁄⁄) ,
List
⁄⁄- 1
<
⁄⁄1 2
string
⁄⁄2 8
>
⁄⁄8 9
(
⁄⁄9 :
)
⁄⁄: ;
;
⁄⁄; <
List
€€ 
<
€€ 
string
€€ 
>
€€  
minutos
€€! (
=
€€) *
new
€€+ .
List
€€/ 3
<
€€3 4
string
€€4 :
>
€€: ;
{
€€< =
$str
€€= A
,
€€A B
$str
€€B F
,
€€F G
$str
€€H L
,
€€L M
$str
€€N R
,
€€R S
$str
€€T X
,
€€X Y
$str
€€Z ^
}
€€^ _
;
€€_ `
for
‹‹ 
(
‹‹ 
int
‹‹ 
hour
‹‹ !
=
‹‹" #
$num
‹‹$ %
;
‹‹% &
hour
‹‹' +
<
‹‹, -
$num
‹‹. 0
;
‹‹0 1
hour
‹‹2 6
++
‹‹6 8
)
‹‹8 9
{
›› 
horas
ﬁﬁ 
.
ﬁﬁ 
Add
ﬁﬁ !
(
ﬁﬁ! "
hour
ﬁﬁ" &
.
ﬁﬁ& '
ToString
ﬁﬁ' /
(
ﬁﬁ/ 0
$str
ﬁﬁ0 4
)
ﬁﬁ4 5
)
ﬁﬁ5 6
;
ﬁﬁ6 7
}
ﬂﬂ 

Checkpoint
‡‡ 
check
‡‡ $
=
‡‡% &
new
‡‡' *

Checkpoint
‡‡+ 5
(
‡‡5 6
)
‡‡6 7
;
‡‡7 8
using
·· 
(
·· 
dbModels
·· #
context
··$ +
=
··, -
new
··. 1
dbModels
··2 :
(
··: ;
)
··; <
)
··< =
check
··> C
=
··D E
context
··F M
.
··M N

Checkpoint
··N X
.
··X Y
Where
··Y ^
(
··^ _
x
··_ `
=>
··a c
x
··d e
.
··e f
idCheckpoint
··f r
==
··s u
id
··v x
)
··x y
.
··y z
FirstOrDefault··z à
(··à â
)··â ä
;··ä ã
string
„„ 
[
„„ 
]
„„ 
HourMinArrival
„„ +
=
„„, -
check
„„. 3
.
„„3 4

minArrival
„„4 >
.
„„> ?
Trim
„„? C
(
„„C D
)
„„D E
.
„„E F
Split
„„F K
(
„„K L
$char
„„L O
)
„„O P
;
„„P Q
string
‰‰ 
[
‰‰ 
]
‰‰ "
HourMinArrivalMarket
‰‰ 1
=
‰‰2 3
check
‰‰4 9
.
‰‰9 :
minArrivalMarket
‰‰: J
.
‰‰J K
Trim
‰‰K O
(
‰‰O P
)
‰‰P Q
.
‰‰Q R
Split
‰‰R W
(
‰‰W X
$char
‰‰X [
)
‰‰[ \
;
‰‰\ ]
ViewBag
ÊÊ 
.
ÊÊ 
Hours
ÊÊ !
=
ÊÊ" #
new
ÊÊ$ '

SelectList
ÊÊ( 2
(
ÊÊ2 3
horas
ÊÊ3 8
,
ÊÊ8 9
HourMinArrival
ÊÊ: H
[
ÊÊH I
$num
ÊÊI J
]
ÊÊJ K
)
ÊÊK L
;
ÊÊL M
ViewBag
ÁÁ 
.
ÁÁ 
Minutes
ÁÁ #
=
ÁÁ$ %
new
ÁÁ& )

SelectList
ÁÁ* 4
(
ÁÁ4 5
minutos
ÁÁ5 <
,
ÁÁ< =
HourMinArrival
ÁÁ> L
[
ÁÁL M
$num
ÁÁM N
]
ÁÁN O
)
ÁÁO P
;
ÁÁP Q
ViewBag
ËË 
.
ËË 
Hours2
ËË "
=
ËË# $
new
ËË% (

SelectList
ËË) 3
(
ËË3 4
horas
ËË4 9
,
ËË9 :"
HourMinArrivalMarket
ËË; O
[
ËËO P
$num
ËËP Q
]
ËËQ R
)
ËËR S
;
ËËS T
ViewBag
ÈÈ 
.
ÈÈ 
Minutes2
ÈÈ $
=
ÈÈ% &
new
ÈÈ' *

SelectList
ÈÈ+ 5
(
ÈÈ5 6
minutos
ÈÈ6 =
,
ÈÈ= >"
HourMinArrivalMarket
ÈÈ? S
[
ÈÈS T
$num
ÈÈT U
]
ÈÈU V
)
ÈÈV W
;
ÈÈW X
muestraRutasMapas
ÍÍ %
.
ÍÍ% &
ListRutasMostrar
ÍÍ& 6
=
ÍÍ7 8
nuevasRutas
ÍÍ9 D
;
ÍÍD E
muestraRutasMapas
ÎÎ %
.
ÎÎ% & 
ListParadasMostrar
ÎÎ& 8
=
ÎÎ9 :
nuevasParadas
ÎÎ; H
;
ÎÎH I
ViewBag
ÏÏ 
.
ÏÏ 
numTypeRoute
ÏÏ (
=
ÏÏ) *
numTypeRoute
ÏÏ+ 7
;
ÏÏ7 8
Session
ÌÌ 
[
ÌÌ 
$str
ÌÌ (
]
ÌÌ( )
=
ÌÌ* +
id
ÌÌ, .
;
ÌÌ. /
mapa
ÓÓ 
.
ÓÓ 
Add
ÓÓ 
(
ÓÓ 
muestraRutasMapas
ÓÓ .
)
ÓÓ. /
;
ÓÓ/ 0
}
ÔÔ 
return
ÒÒ 
View
ÒÒ 
(
ÒÒ 
mapa
ÒÒ  
)
ÒÒ  !
;
ÒÒ! "
}
ÚÚ 
catch
ÛÛ 
(
ÛÛ 
	Exception
ÛÛ 
)
ÛÛ 
{
ÙÙ 
return
ıı 
RedirectToAction
ıı '
(
ıı' (
$str
ıı( /
,
ıı/ 0
$str
ıı1 7
)
ıı7 8
;
ıı8 9
}
ˆˆ 
}
˜˜ 	
[
¯¯ 	
HttpPost
¯¯	 
]
¯¯ 
public
˘˘ 
ActionResult
˘˘ 
	EditCheck
˘˘ %
(
˘˘% &
string
˘˘& ,
ubicaciones
˘˘- 8
,
˘˘8 9
string
˘˘: @
hora
˘˘A E
,
˘˘E F
string
˘˘G M
minuto
˘˘N T
,
˘˘T U
string
˘˘V \
horaMercado
˘˘] h
,
˘˘h i
string
˘˘j p
minutoMercado
˘˘q ~
)
˘˘~ 
{
˙˙ 	
try
˚˚ 
{
¸¸ 
Login
˝˝ 
logi
˝˝ 
=
˝˝ 
new
˝˝  
Login
˝˝! &
(
˝˝& '
)
˝˝' (
;
˝˝( )
var
˛˛ 

authResult
˛˛ 
=
˛˛   
AutenticarPasosRol
˛˛! 3
(
˛˛3 4
$num
˛˛4 5
)
˛˛5 6
;
˛˛6 7
if
ˇˇ 
(
ˇˇ 

authResult
ˇˇ 
!=
ˇˇ !
null
ˇˇ" &
)
ˇˇ& '
return
ˇˇ( .

authResult
ˇˇ/ 9
;
ˇˇ9 :
if
ÄÄ 
(
ÄÄ 
Session
ÄÄ 
[
ÄÄ 
$str
ÄÄ '
]
ÄÄ' (
==
ÄÄ) +
null
ÄÄ, 0
)
ÄÄ0 1
return
ÄÄ2 8
RedirectToAction
ÄÄ9 I
(
ÄÄI J
$str
ÄÄJ Q
,
ÄÄQ R
$str
ÄÄS Y
)
ÄÄY Z
;
ÄÄZ [
string
ÅÅ 
Line
ÅÅ 
=
ÅÅ 
logi
ÅÅ "
.
ÅÅ" # 
GetLineaFromCookie
ÅÅ# 5
(
ÅÅ5 6
Request
ÅÅ6 =
)
ÅÅ= >
.
ÅÅ> ?
ToString
ÅÅ? G
(
ÅÅG H
)
ÅÅH I
;
ÅÅI J
int
ÇÇ 
id
ÇÇ 
=
ÇÇ 
int
ÇÇ 
.
ÇÇ 
Parse
ÇÇ "
(
ÇÇ" #
Session
ÇÇ# *
[
ÇÇ* +
$str
ÇÇ+ 7
]
ÇÇ7 8
.
ÇÇ8 9
ToString
ÇÇ9 A
(
ÇÇA B
)
ÇÇB C
)
ÇÇC D
;
ÇÇD E

Checkpoint
ÉÉ 
check
ÉÉ  
=
ÉÉ! "
new
ÉÉ# &

Checkpoint
ÉÉ' 1
(
ÉÉ1 2
)
ÉÉ2 3
;
ÉÉ3 4
using
ÑÑ 
(
ÑÑ 
dbModels
ÑÑ 
context
ÑÑ  '
=
ÑÑ( )
new
ÑÑ* -
dbModels
ÑÑ. 6
(
ÑÑ6 7
)
ÑÑ7 8
)
ÑÑ8 9
check
ÑÑ: ?
=
ÑÑ@ A
context
ÑÑB I
.
ÑÑI J

Checkpoint
ÑÑJ T
.
ÑÑT U
Where
ÑÑU Z
(
ÑÑZ [
x
ÑÑ[ \
=>
ÑÑ] _
x
ÑÑ` a
.
ÑÑa b
idCheckpoint
ÑÑb n
==
ÑÑo q
id
ÑÑr t
)
ÑÑt u
.
ÑÑu v
FirstOrDefaultÑÑv Ñ
(ÑÑÑ Ö
)ÑÑÖ Ü
;ÑÑÜ á
using
ÖÖ 
(
ÖÖ 
dbModels
ÖÖ 
context
ÖÖ  '
=
ÖÖ( )
new
ÖÖ* -
dbModels
ÖÖ. 6
(
ÖÖ6 7
)
ÖÖ7 8
)
ÖÖ8 9
{
ÜÜ 
string
àà 
[
àà 
]
àà ,
seccionesNombreLatitudLongitud
àà ;
=
àà< =
ubicaciones
àà> I
.
ààI J
Split
ààJ O
(
ààO P
$char
ààP S
)
ààS T
;
ààT U
string
ââ 
horaCompleta
ââ '
=
ââ( )
hora
ââ* .
+
ââ/ 0
$str
ââ1 4
+
ââ5 6
minuto
ââ7 =
;
ââ= >
string
ää !
horaCompletaMercado
ää .
=
ää/ 0
horaMercado
ää1 <
+
ää= >
$str
ää? B
+
ääC D
minutoMercado
ääE R
;
ääR S
if
ãã 
(
ãã ,
seccionesNombreLatitudLongitud
ãã 6
.
ãã6 7
Length
ãã7 =
>=
ãã> @
$num
ããA B
)
ããB C
{
åå 
string
çç 
description
çç *
=
çç+ ,,
seccionesNombreLatitudLongitud
çç- K
[
ççK L
$num
ççL M
]
ççM N
.
ççN O
Trim
ççO S
(
ççS T
)
ççT U
;
ççU V
check
éé 
.
éé 
description
éé )
=
éé* +
$str
éé, 5
+
éé5 6
description
éé6 A
;
ééA B
check
èè 
.
èè 
latitud
èè %
=
èè& '
Convert
èè( /
.
èè/ 0
	ToDecimal
èè0 9
(
èè9 :,
seccionesNombreLatitudLongitud
èè: X
[
èèX Y
$num
èèY Z
]
èèZ [
.
èè[ \
Trim
èè\ `
(
èè` a
)
èèa b
,
èèb c
System
èèd j
.
èèj k
Globalization
èèk x
.
èèx y
CultureInfoèèy Ñ
.èèÑ Ö 
InvariantCultureèèÖ ï
)èèï ñ
;èèñ ó
check
êê 
.
êê 
longitud
êê &
=
êê' (
Convert
êê) 0
.
êê0 1
	ToDecimal
êê1 :
(
êê: ;,
seccionesNombreLatitudLongitud
êê; Y
[
êêY Z
$num
êêZ [
]
êê[ \
.
êê\ ]
Trim
êê] a
(
êêa b
)
êêb c
,
êêc d
System
êêe k
.
êêk l
Globalization
êêl y
.
êêy z
CultureInfoêêz Ö
.êêÖ Ü 
InvariantCultureêêÜ ñ
)êêñ ó
;êêó ò
}
ëë 
check
íí 
.
íí 

minArrival
íí $
=
íí% &
horaCompleta
íí' 3
;
íí3 4
check
ìì 
.
ìì 
minArrivalMarket
ìì *
=
ìì+ ,!
horaCompletaMercado
ìì- @
;
ìì@ A
context
îî 
.
îî 
Entry
îî !
(
îî! "
check
îî" '
)
îî' (
.
îî( )
State
îî) .
=
îî/ 0
System
îî1 7
.
îî7 8
Data
îî8 <
.
îî< =
Entity
îî= C
.
îîC D
EntityState
îîD O
.
îîO P
Modified
îîP X
;
îîX Y
context
ïï 
.
ïï 
SaveChanges
ïï '
(
ïï' (
)
ïï( )
;
ïï) *
}
ññ 
return
óó 
RedirectToAction
óó '
(
óó' (
$str
óó( /
,
óó/ 0
$str
óó1 8
,
óó8 9
new
óó: =
{
óó> ?
numTypeRoute
óó@ L
=
óóN O
check
óóP U
.
óóU V
numberRoute
óóV a
}
óóa b
)
óób c
;
óóc d
}
òò 
catch
ôô 
(
ôô 
	Exception
ôô 
)
ôô 
{
öö 
return
õõ 
RedirectToAction
õõ '
(
õõ' (
$str
õõ( /
,
õõ/ 0
$str
õõ1 7
)
õõ7 8
;
õõ8 9
}
úú 
}
ùù 	
public
ûû 
ActionResult
ûû 
ViewDeviation1
ûû *
(
ûû* +
int
ûû+ .
numTypeRoute
ûû/ ;
)
ûû; <
{
üü 	
try
†† 
{
°° 
Login
¢¢ 
logi
¢¢ 
=
¢¢ 
new
¢¢  
Login
¢¢! &
(
¢¢& '
)
¢¢' (
;
¢¢( )
var
££ 

authResult
££ 
=
££   
AutenticarPasosRol
££! 3
(
££3 4
$num
££4 5
)
££5 6
;
££6 7
if
§§ 
(
§§ 

authResult
§§ 
!=
§§ !
null
§§" &
)
§§& '
return
§§( .

authResult
§§/ 9
;
§§9 :
string
¶¶ 
Line
¶¶ 
=
¶¶ 
logi
¶¶ "
.
¶¶" # 
GetLineaFromCookie
¶¶# 5
(
¶¶5 6
Request
¶¶6 =
)
¶¶= >
.
¶¶> ?
ToString
¶¶? G
(
¶¶G H
)
¶¶H I
;
¶¶I J
List
ßß 
<
ßß 
MuestraRutasMapas
ßß &
>
ßß& '
mapa
ßß( ,
=
ßß- .
new
ßß/ 2
List
ßß3 7
<
ßß7 8
MuestraRutasMapas
ßß8 I
>
ßßI J
(
ßßJ K
)
ßßK L
;
ßßL M
int
®® 
count
®® 
=
®® 
$num
®® 
;
®® 
for
©© 
(
©© 
int
©© 
i
©© 
=
©© 
$num
©© 
;
©© 
i
©©  !
<=
©©" $
$num
©©% &
;
©©& '
i
©©( )
++
©©) +
)
©©+ ,
{
™™ 
MuestraRutasMapas
´´ %
muestraRutasMapas
´´& 7
=
´´8 9
new
´´: =
MuestraRutasMapas
´´> O
{
¨¨ 
ListRutasMostrar
≠≠ (
=
≠≠) *
new
≠≠+ .
List
≠≠/ 3
<
≠≠3 4
RutasMostrar
≠≠4 @
>
≠≠@ A
(
≠≠A B
)
≠≠B C
,
≠≠C D 
ListParadasMostrar
ÆÆ *
=
ÆÆ+ ,
new
ÆÆ- 0
List
ÆÆ1 5
<
ÆÆ5 6
ParadasMostrar
ÆÆ6 D
>
ÆÆD E
(
ÆÆE F
)
ÆÆF G
,
ÆÆG H!
ListBloqueosMostrar
ØØ +
=
ØØ, -
new
ØØ. 1
List
ØØ2 6
<
ØØ6 7
BloqueosMostrar
ØØ7 F
>
ØØF G
(
ØØG H
)
ØØH I
,
ØØI J

NumeroRuta
∞∞ "
=
∞∞# $
i
∞∞% &
}
±± 
;
±± 
List
≤≤ 
<
≤≤ 
BloqueosMostrar
≤≤ (
>
≤≤( )
nuevosBloqueos
≤≤* 8
=
≤≤9 :
new
≤≤; >
List
≤≤? C
<
≤≤C D
BloqueosMostrar
≤≤D S
>
≤≤S T
(
≤≤T U
)
≤≤U V
;
≤≤V W
List
≥≥ 
<
≥≥ 
RutasMostrar
≥≥ %
>
≥≥% &
nuevasRutas
≥≥' 2
=
≥≥3 4
new
≥≥5 8
List
≥≥9 =
<
≥≥= >
RutasMostrar
≥≥> J
>
≥≥J K
(
≥≥K L
)
≥≥L M
;
≥≥M N
List
¥¥ 
<
¥¥ 
ParadasMostrar
¥¥ '
>
¥¥' (
nuevasParadas
¥¥) 6
=
¥¥7 8
new
¥¥9 <
List
¥¥= A
<
¥¥A B
ParadasMostrar
¥¥B P
>
¥¥P Q
(
¥¥Q R
)
¥¥R S
;
¥¥S T
using
∂∂ 
(
∂∂ 
dbModels
∂∂ #
context
∂∂$ +
=
∂∂, -
new
∂∂. 1
dbModels
∂∂2 :
(
∂∂: ;
)
∂∂; <
)
∂∂< =
{
∑∑ 
var
∏∏ 
checkpoints
∏∏ '
=
∏∏( )
context
∏∏* 1
.
∏∏1 2

Checkpoint
∏∏2 <
.
∏∏< =
Where
∏∏= B
(
∏∏B C
x
∏∏C D
=>
∏∏E G
x
∏∏H I
.
∏∏I J
idLine
∏∏J P
==
∏∏Q S
Line
∏∏T X
&&
∏∏Y [
x
∏∏\ ]
.
∏∏] ^
status
∏∏^ d
!=
∏∏e g
$num
∏∏h i
&&
∏∏j l
x
∏∏m n
.
∏∏n o
numberRoute
∏∏o z
==
∏∏{ }
numTypeRoute∏∏~ ä
)∏∏ä ã
.∏∏ã å
ToList∏∏å í
(∏∏í ì
)∏∏ì î
;∏∏î ï
var
ππ 
routes
ππ "
=
ππ# $
context
ππ% ,
.
ππ, -
Route
ππ- 2
.
∫∫ 
Where
∫∫ "
(
∫∫" #
x
∫∫# $
=>
∫∫% '
x
∫∫( )
.
∫∫) *
idLine
∫∫* 0
==
∫∫1 3
Line
∫∫4 8
&&
∫∫9 ;
x
∫∫< =
.
∫∫= >
numberRoute
∫∫> I
==
∫∫J L
i
∫∫M N
&&
∫∫O Q
x
∫∫R S
.
∫∫S T
numTypeRoute
∫∫T `
==
∫∫a c
numTypeRoute
∫∫d p
)
∫∫p q
.
ªª 
ToList
ªª #
(
ªª# $
)
ªª$ %
;
ªª% &
var
ºº 
	deviation
ºº %
=
ºº& '
context
ºº( /
.
ºº/ 0
DeviationRote
ºº0 =
.
ºº= >
Where
ºº> C
(
ººC D
x
ººD E
=>
ººF H
x
ººI J
.
ººJ K
idLine
ººK Q
==
ººR T
Line
ººU Y
&&
ººZ \
x
ºº] ^
.
ºº^ _
numberRoute
ºº_ j
==
ººk m
i
ººn o
&&
ººp r
x
ººs t
.
ººt u
numTypeRouteººu Å
==ººÇ Ñ
numTypeRouteººÖ ë
)ººë í
.ººí ì
ToListººì ô
(ººô ö
)ººö õ
;ººõ ú
if
ΩΩ 
(
ΩΩ 
	deviation
ΩΩ %
.
ΩΩ% &
Count
ΩΩ& +
>
ΩΩ, -
$num
ΩΩ. /
)
ΩΩ/ 0
{
ææ 
foreach
øø #
(
øø$ %
var
øø% (
item
øø) -
in
øø. 0
	deviation
øø1 :
)
øø: ;
{
¿¿ 
List
¡¡  $
<
¡¡$ %
RutasMostrar
¡¡% 1
>
¡¡1 2
listBloqueos
¡¡3 ?
=
¡¡@ A
new
¡¡B E
List
¡¡F J
<
¡¡J K
RutasMostrar
¡¡K W
>
¡¡W X
(
¡¡X Y
)
¡¡Y Z
;
¡¡Z [
var
¬¬  #
route1
¬¬$ *
=
¬¬+ ,
routes
¬¬- 3
.
¬¬3 4
Where
¬¬4 9
(
¬¬9 :
x
¬¬: ;
=>
¬¬< >
x
¬¬? @
.
¬¬@ A
idRoute
¬¬A H
==
¬¬I K
item
¬¬L P
.
¬¬P Q
idRouteStart
¬¬Q ]
&&
¬¬^ `
x
¬¬a b
.
¬¬b c
idLine
¬¬c i
==
¬¬j l
Line
¬¬m q
)
¬¬q r
.
¬¬r s
FirstOrDefault¬¬s Å
(¬¬Å Ç
)¬¬Ç É
;¬¬É Ñ
var
√√  #
route2
√√$ *
=
√√+ ,
routes
√√- 3
.
√√3 4
Where
√√4 9
(
√√9 :
x
√√: ;
=>
√√< >
x
√√? @
.
√√@ A
idRoute
√√A H
==
√√I K
item
√√L P
.
√√P Q

idRouteEnd
√√Q [
&&
√√\ ^
x
√√_ `
.
√√` a
idLine
√√a g
==
√√h j
Line
√√k o
)
√√o p
.
√√p q
FirstOrDefault
√√q 
(√√ Ä
)√√Ä Å
;√√Å Ç
if
ƒƒ  "
(
ƒƒ# $
route1
ƒƒ$ *
!=
ƒƒ+ -
null
ƒƒ. 2
&&
ƒƒ3 5
route2
ƒƒ6 <
!=
ƒƒ= ?
null
ƒƒ@ D
)
ƒƒD E
{
≈≈  !
var
∆∆$ '
routesDeviation
∆∆( 7
=
∆∆8 9
routes
∆∆: @
.
∆∆@ A
Where
∆∆A F
(
∆∆F G
x
∆∆G H
=>
∆∆I K
x
∆∆L M
.
∆∆M N
numPoint
∆∆N V
>=
∆∆W Y
route1
∆∆Z `
.
∆∆` a
numPoint
∆∆a i
&&
∆∆j l
x
∆∆m n
.
∆∆n o
numPoint
∆∆o w
<=
∆∆x z
route2∆∆{ Å
.∆∆Å Ç
numPoint∆∆Ç ä
&&∆∆ã ç
x∆∆é è
.∆∆è ê
idLine∆∆ê ñ
==∆∆ó ô
Line∆∆ö û
)∆∆û ü
.∆∆ü †
ToList∆∆† ¶
(∆∆¶ ß
)∆∆ß ®
;∆∆® ©
foreach
««$ +
(
««, -
var
««- 0
item2
««1 6
in
««7 9
routesDeviation
««: I
)
««I J
{
»»$ %
listBloqueos
……( 4
.
……4 5
Add
……5 8
(
……8 9
new
……9 <
RutasMostrar
……= I
(
……I J
item2
……J O
.
……O P
idRoute
……P W
,
……W X
item2
……Y ^
.
……^ _
latitud
……_ f
,
……f g
item2
……h m
.
……m n
logintud
……n v
,
……v w
$str
……x z
,
……z {
item2……| Å
.……Å Ç
status……Ç à
,……à â
(……ä ã
int……ã é
)……é è
item2……è î
.……î ï
numPoint……ï ù
)……ù û
)……û ü
;……ü †
}
  $ %
var
ÀÀ$ '
place1
ÀÀ( .
=
ÀÀ/ 0
context
ÀÀ1 8
.
ÀÀ8 9
Place
ÀÀ9 >
.
ÀÀ> ?
Where
ÀÀ? D
(
ÀÀD E
x
ÀÀE F
=>
ÀÀG I
x
ÀÀJ K
.
ÀÀK L
idPlace
ÀÀL S
==
ÀÀT V
route1
ÀÀW ]
.
ÀÀ] ^
idPlace
ÀÀ^ e
)
ÀÀe f
.
ÀÀf g
FirstOrDefault
ÀÀg u
(
ÀÀu v
)
ÀÀv w
;
ÀÀw x
var
ÃÃ$ '
place2
ÃÃ( .
=
ÃÃ/ 0
context
ÃÃ1 8
.
ÃÃ8 9
Place
ÃÃ9 >
.
ÃÃ> ?
Where
ÃÃ? D
(
ÃÃD E
x
ÃÃE F
=>
ÃÃG I
x
ÃÃJ K
.
ÃÃK L
idPlace
ÃÃL S
==
ÃÃT V
route2
ÃÃW ]
.
ÃÃ] ^
idPlace
ÃÃ^ e
)
ÃÃe f
.
ÃÃf g
FirstOrDefault
ÃÃg u
(
ÃÃu v
)
ÃÃv w
;
ÃÃw x
nuevosBloqueos
ÕÕ$ 2
.
ÕÕ2 3
Add
ÕÕ3 6
(
ÕÕ6 7
new
ÕÕ7 :
BloqueosMostrar
ÕÕ; J
(
ÕÕJ K
item
ÕÕK O
.
ÕÕO P
idDeviation
ÕÕP [
,
ÕÕ[ \
$str
ÕÕ] f
+
ÕÕg h
place1
ÕÕi o
.
ÕÕo p
description
ÕÕp {
+
ÕÕ| }
$strÕÕ~ É
+ÕÕÑ Ö
place2ÕÕÜ å
.ÕÕå ç
descriptionÕÕç ò
,ÕÕò ô
listBloqueosÕÕö ¶
,ÕÕ¶ ß
(ÕÕ® ©
doubleÕÕ© Ø
)ÕÕØ ∞
route1ÕÕ∞ ∂
.ÕÕ∂ ∑
latitudÕÕ∑ æ
,ÕÕæ ø
(ÕÕ¿ ¡
doubleÕÕ¡ «
)ÕÕ« »
route2ÕÕ» Œ
.ÕÕŒ œ
logintudÕÕœ ◊
)ÕÕ◊ ÿ
)ÕÕÿ Ÿ
;ÕÕŸ ⁄
}
ŒŒ  !
}
œœ 
}
–– 
if
—— 
(
—— 
routes
—— "
.
——" #
Count
——# (
>
——) *
$num
——+ ,
)
——, -
{
““ 
count
”” !
=
””" #
$num
””$ %
;
””% &
foreach
‘‘ #
(
‘‘$ %
var
‘‘% (
item
‘‘) -
in
‘‘. 0
routes
‘‘1 7
)
‘‘7 8
{
’’ 
count
÷÷  %
++
÷÷% '
;
÷÷' (
Place
◊◊  %
place
◊◊& +
=
◊◊, -
context
◊◊. 5
.
◊◊5 6
Place
◊◊6 ;
.
◊◊; <
FirstOrDefault
◊◊< J
(
◊◊J K
x
◊◊K L
=>
◊◊M O
x
◊◊P Q
.
◊◊Q R
idPlace
◊◊R Y
==
◊◊Z \
item
◊◊] a
.
◊◊a b
idPlace
◊◊b i
)
◊◊i j
;
◊◊j k
if
ÿÿ  "
(
ÿÿ# $
place
ÿÿ$ )
!=
ÿÿ* ,
null
ÿÿ- 1
)
ÿÿ1 2
{
ŸŸ  !
nuevasRutas
⁄⁄$ /
.
⁄⁄/ 0
Add
⁄⁄0 3
(
⁄⁄3 4
new
⁄⁄4 7
RutasMostrar
⁄⁄8 D
(
⁄⁄D E
item
⁄⁄E I
.
⁄⁄I J
idRoute
⁄⁄J Q
,
⁄⁄Q R
item
⁄⁄S W
.
⁄⁄W X
latitud
⁄⁄X _
,
⁄⁄_ `
item
⁄⁄a e
.
⁄⁄e f
logintud
⁄⁄f n
,
⁄⁄n o
place
⁄⁄p u
.
⁄⁄u v
description⁄⁄v Å
,⁄⁄Å Ç
item⁄⁄É á
.⁄⁄á à
status⁄⁄à é
,⁄⁄é è
(⁄⁄ê ë
int⁄⁄ë î
)⁄⁄î ï
item⁄⁄ï ô
.⁄⁄ô ö
numPoint⁄⁄ö ¢
)⁄⁄¢ £
)⁄⁄£ §
;⁄⁄§ •
}
€€  !
}
‹‹ 
if
ﬁﬁ 
(
ﬁﬁ  
nuevasRutas
ﬁﬁ  +
.
ﬁﬁ+ ,
Any
ﬁﬁ, /
(
ﬁﬁ/ 0
)
ﬁﬁ0 1
)
ﬁﬁ1 2
{
ﬂﬂ 
RutasMostrar
‡‡  ,
primeraRuta
‡‡- 8
=
‡‡9 :
nuevasRutas
‡‡; F
.
‡‡F G
FirstOrDefault
‡‡G U
(
‡‡U V
r
‡‡V W
=>
‡‡X Z
r
‡‡[ \
.
‡‡\ ]
status
‡‡] c
==
‡‡d f
$num
‡‡g h
)
‡‡h i
;
‡‡i j
if
··  "
(
··# $
primeraRuta
··$ /
!=
··0 2
null
··3 7
)
··7 8
{
‚‚  !
nuevasRutas
„„$ /
=
„„0 1
nuevasRutas
„„2 =
.
‰‰( )
OrderBy
‰‰) 0
(
‰‰0 1
route
‰‰1 6
=>
‰‰7 9
route
‰‰: ?
.
‰‰? @
numPoint
‰‰@ H
)
‰‰H I
.
ÂÂ( )
ToList
ÂÂ) /
(
ÂÂ/ 0
)
ÂÂ0 1
;
ÂÂ1 2
}
ÊÊ  !
}
ÁÁ 
count
ËË !
=
ËË" #
$num
ËË$ %
;
ËË% &
foreach
ÈÈ #
(
ÈÈ$ %
var
ÈÈ% (
item
ÈÈ) -
in
ÈÈ. 0
nuevasRutas
ÈÈ1 <
)
ÈÈ< =
{
ÍÍ 
item
ÎÎ  $
.
ÎÎ$ %
name
ÎÎ% )
=
ÎÎ* +
item
ÎÎ, 0
.
ÎÎ0 1
name
ÎÎ1 5
+
ÎÎ6 7
$str
ÎÎ8 ;
+
ÎÎ< =
count
ÎÎ> C
;
ÎÎC D
count
ÏÏ  %
++
ÏÏ% '
;
ÏÏ' (
}
ÌÌ 
}
ÓÓ 
if
 
(
 
checkpoints
 '
.
' (
Count
( -
>
. /
$num
0 1
)
1 2
{
ÒÒ 
count
ÚÚ !
=
ÚÚ" #
$num
ÚÚ$ %
;
ÚÚ% &
foreach
ÛÛ #
(
ÛÛ$ %
var
ÛÛ% (
item
ÛÛ) -
in
ÛÛ. 0
checkpoints
ÛÛ1 <
)
ÛÛ< =
{
ÙÙ 
count
ıı  %
++
ıı% '
;
ıı' (
nuevasParadas
ˆˆ  -
.
ˆˆ- .
Add
ˆˆ. 1
(
ˆˆ1 2
new
ˆˆ2 5
ParadasMostrar
ˆˆ6 D
(
ˆˆD E
item
ˆˆE I
.
ˆˆI J
idCheckpoint
ˆˆJ V
,
ˆˆV W
item
ˆˆX \
.
ˆˆ\ ]
description
ˆˆ] h
,
ˆˆh i
item
ˆˆj n
.
ˆˆn o
status
ˆˆo u
,
ˆˆu v
item
ˆˆw {
.
ˆˆ{ |
latitudˆˆ| É
,ˆˆÉ Ñ
itemˆˆÖ â
.ˆˆâ ä
longitudˆˆä í
)ˆˆí ì
)ˆˆì î
;ˆˆî ï
}
˜˜ 
if
˘˘ 
(
˘˘  
nuevasParadas
˘˘  -
.
˘˘- .
Any
˘˘. 1
(
˘˘1 2
)
˘˘2 3
)
˘˘3 4
{
˙˙ 
ParadasMostrar
˚˚  .
primeraParada
˚˚/ <
=
˚˚= >
nuevasParadas
˚˚? L
.
˚˚L M
FirstOrDefault
˚˚M [
(
˚˚[ \
r
˚˚\ ]
=>
˚˚^ `
r
˚˚a b
.
˚˚b c
status
˚˚c i
==
˚˚j l
$num
˚˚m n
)
˚˚n o
;
˚˚o p
if
¸¸  "
(
¸¸# $
primeraParada
¸¸$ 1
!=
¸¸2 4
null
¸¸5 9
)
¸¸9 :
{
˝˝  !
nuevasParadas
˛˛$ 1
=
˛˛2 3
nuevasParadas
˛˛4 A
.
ˇˇ( )
OrderBy
ˇˇ) 0
(
ˇˇ0 1
route
ˇˇ1 6
=>
ˇˇ7 9
muestraRutasMapas
ˇˇ: K
.
ˇˇK L(
CalcularDistanciaHaversine
ˇˇL f
(
ˇˇf g
(
ÄÄ, -
decimal
ÄÄ- 4
)
ÄÄ4 5
primeraParada
ÄÄ5 B
.
ÄÄB C
latitud
ÄÄC J
,
ÄÄJ K
(
ÅÅ, -
decimal
ÅÅ- 4
)
ÅÅ4 5
primeraParada
ÅÅ5 B
.
ÅÅB C
longitud
ÅÅC K
,
ÅÅK L
route
ÇÇ, 1
.
ÇÇ1 2
latitud
ÇÇ2 9
,
ÇÇ9 :
route
ÉÉ, 1
.
ÉÉ1 2
longitud
ÉÉ2 :
)
ÉÉ: ;
)
ÉÉ; <
.
ÑÑ( )
ToList
ÑÑ) /
(
ÑÑ/ 0
)
ÑÑ0 1
;
ÑÑ1 2
}
ÖÖ  !
}
ÜÜ 
count
áá !
=
áá" #
$num
áá$ %
;
áá% &
foreach
àà #
(
àà$ %
var
àà% (
item
àà) -
in
àà. 0
nuevasParadas
àà1 >
)
àà> ?
{
ââ 
item
ää  $
.
ää$ %
description
ää% 0
=
ää1 2
item
ää3 7
.
ää7 8
description
ää8 C
+
ääD E
$str
ääF I
+
ääJ K
count
ääL Q
;
ääQ R
count
ãã  %
++
ãã% '
;
ãã' (
}
åå 
}
çç 
}
éé 
muestraRutasMapas
èè %
.
èè% &
ListRutasMostrar
èè& 6
=
èè7 8
nuevasRutas
èè9 D
;
èèD E
muestraRutasMapas
êê %
.
êê% & 
ListParadasMostrar
êê& 8
=
êê9 :
nuevasParadas
êê; H
;
êêH I
muestraRutasMapas
ëë %
.
ëë% &!
ListBloqueosMostrar
ëë& 9
=
ëë: ;
nuevosBloqueos
ëë< J
;
ëëJ K
ViewBag
íí 
.
íí 
numTypeRoute
íí (
=
íí) *
numTypeRoute
íí+ 7
;
íí7 8
mapa
ìì 
.
ìì 
Add
ìì 
(
ìì 
muestraRutasMapas
ìì .
)
ìì. /
;
ìì/ 0
}
îî 
return
ññ 
View
ññ 
(
ññ 
mapa
ññ  
)
ññ  !
;
ññ! "
}
óó 
catch
òò 
(
òò 
	Exception
òò 
)
òò 
{
ôô 
return
öö 
RedirectToAction
öö '
(
öö' (
$str
öö( /
,
öö/ 0
$str
öö1 7
)
öö7 8
;
öö8 9
}
õõ 
}
úú 	
public
ùù 
ActionResult
ùù 
ViewDeviation2
ùù *
(
ùù* +
int
ùù+ .
numTypeRoute
ùù/ ;
)
ùù; <
{
ûû 	
try
üü 
{
†† 
Login
°° 
logi
°° 
=
°° 
new
°°  
Login
°°! &
(
°°& '
)
°°' (
;
°°( )
var
¢¢ 

authResult
¢¢ 
=
¢¢   
AutenticarPasosRol
¢¢! 3
(
¢¢3 4
$num
¢¢4 5
)
¢¢5 6
;
¢¢6 7
if
££ 
(
££ 

authResult
££ 
!=
££ !
null
££" &
)
££& '
return
££( .

authResult
££/ 9
;
££9 :
string
•• 
Line
•• 
=
•• 
logi
•• "
.
••" # 
GetLineaFromCookie
••# 5
(
••5 6
Request
••6 =
)
••= >
.
••> ?
ToString
••? G
(
••G H
)
••H I
;
••I J
List
¶¶ 
<
¶¶ 
MuestraRutasMapas
¶¶ &
>
¶¶& '
mapa
¶¶( ,
=
¶¶- .
new
¶¶/ 2
List
¶¶3 7
<
¶¶7 8
MuestraRutasMapas
¶¶8 I
>
¶¶I J
(
¶¶J K
)
¶¶K L
;
¶¶L M
int
ßß 
count
ßß 
=
ßß 
$num
ßß 
;
ßß 
for
®® 
(
®® 
int
®® 
i
®® 
=
®® 
$num
®® 
;
®® 
i
®®  !
<=
®®" $
$num
®®% &
;
®®& '
i
®®( )
++
®®) +
)
®®+ ,
{
©© 
MuestraRutasMapas
™™ %
muestraRutasMapas
™™& 7
=
™™8 9
new
™™: =
MuestraRutasMapas
™™> O
{
´´ 
ListRutasMostrar
¨¨ (
=
¨¨) *
new
¨¨+ .
List
¨¨/ 3
<
¨¨3 4
RutasMostrar
¨¨4 @
>
¨¨@ A
(
¨¨A B
)
¨¨B C
,
¨¨C D 
ListParadasMostrar
≠≠ *
=
≠≠+ ,
new
≠≠- 0
List
≠≠1 5
<
≠≠5 6
ParadasMostrar
≠≠6 D
>
≠≠D E
(
≠≠E F
)
≠≠F G
,
≠≠G H!
ListBloqueosMostrar
ÆÆ +
=
ÆÆ, -
new
ÆÆ. 1
List
ÆÆ2 6
<
ÆÆ6 7
BloqueosMostrar
ÆÆ7 F
>
ÆÆF G
(
ÆÆG H
)
ÆÆH I
,
ÆÆI J

NumeroRuta
ØØ "
=
ØØ# $
i
ØØ% &
}
∞∞ 
;
∞∞ 
List
±± 
<
±± 
BloqueosMostrar
±± (
>
±±( )
nuevosBloqueos
±±* 8
=
±±9 :
new
±±; >
List
±±? C
<
±±C D
BloqueosMostrar
±±D S
>
±±S T
(
±±T U
)
±±U V
;
±±V W
List
≤≤ 
<
≤≤ 
RutasMostrar
≤≤ %
>
≤≤% &
nuevasRutas
≤≤' 2
=
≤≤3 4
new
≤≤5 8
List
≤≤9 =
<
≤≤= >
RutasMostrar
≤≤> J
>
≤≤J K
(
≤≤K L
)
≤≤L M
;
≤≤M N
List
≥≥ 
<
≥≥ 
ParadasMostrar
≥≥ '
>
≥≥' (
nuevasParadas
≥≥) 6
=
≥≥7 8
new
≥≥9 <
List
≥≥= A
<
≥≥A B
ParadasMostrar
≥≥B P
>
≥≥P Q
(
≥≥Q R
)
≥≥R S
;
≥≥S T
using
µµ 
(
µµ 
dbModels
µµ #
context
µµ$ +
=
µµ, -
new
µµ. 1
dbModels
µµ2 :
(
µµ: ;
)
µµ; <
)
µµ< =
{
∂∂ 
var
∑∑ 
checkpoints
∑∑ '
=
∑∑( )
context
∑∑* 1
.
∑∑1 2

Checkpoint
∑∑2 <
.
∑∑< =
Where
∑∑= B
(
∑∑B C
x
∑∑C D
=>
∑∑E G
x
∑∑H I
.
∑∑I J
idLine
∑∑J P
==
∑∑Q S
Line
∑∑T X
&&
∑∑Y [
x
∑∑\ ]
.
∑∑] ^
status
∑∑^ d
!=
∑∑e g
$num
∑∑h i
&&
∑∑j l
x
∑∑m n
.
∑∑n o
numberRoute
∑∑o z
==
∑∑{ }
numTypeRoute∑∑~ ä
)∑∑ä ã
.∑∑ã å
ToList∑∑å í
(∑∑í ì
)∑∑ì î
;∑∑î ï
var
∏∏ 
routes
∏∏ "
=
∏∏# $
context
∏∏% ,
.
∏∏, -
Route
∏∏- 2
.
ππ 
Where
ππ "
(
ππ" #
x
ππ# $
=>
ππ% '
x
ππ( )
.
ππ) *
idLine
ππ* 0
==
ππ1 3
Line
ππ4 8
&&
ππ9 ;
x
ππ< =
.
ππ= >
numberRoute
ππ> I
==
ππJ L
i
ππM N
&&
ππO Q
x
ππR S
.
ππS T
numTypeRoute
ππT `
==
ππa c
numTypeRoute
ππd p
)
ππp q
.
∫∫ 
ToList
∫∫ #
(
∫∫# $
)
∫∫$ %
;
∫∫% &
var
ªª 
	deviation
ªª %
=
ªª& '
context
ªª( /
.
ªª/ 0
DeviationRote
ªª0 =
.
ªª= >
Where
ªª> C
(
ªªC D
x
ªªD E
=>
ªªF H
x
ªªI J
.
ªªJ K
idLine
ªªK Q
==
ªªR T
Line
ªªU Y
&&
ªªZ \
x
ªª] ^
.
ªª^ _
numberRoute
ªª_ j
==
ªªk m
i
ªªn o
&&
ªªp r
x
ªªs t
.
ªªt u
numTypeRouteªªu Å
==ªªÇ Ñ
numTypeRouteªªÖ ë
)ªªë í
.ªªí ì
ToListªªì ô
(ªªô ö
)ªªö õ
;ªªõ ú
if
ºº 
(
ºº 
	deviation
ºº %
.
ºº% &
Count
ºº& +
>
ºº, -
$num
ºº. /
)
ºº/ 0
{
ΩΩ 
foreach
ææ #
(
ææ$ %
var
ææ% (
item
ææ) -
in
ææ. 0
	deviation
ææ1 :
)
ææ: ;
{
øø 
List
¿¿  $
<
¿¿$ %
RutasMostrar
¿¿% 1
>
¿¿1 2
listBloqueos
¿¿3 ?
=
¿¿@ A
new
¿¿B E
List
¿¿F J
<
¿¿J K
RutasMostrar
¿¿K W
>
¿¿W X
(
¿¿X Y
)
¿¿Y Z
;
¿¿Z [
var
¡¡  #
route1
¡¡$ *
=
¡¡+ ,
routes
¡¡- 3
.
¡¡3 4
Where
¡¡4 9
(
¡¡9 :
x
¡¡: ;
=>
¡¡< >
x
¡¡? @
.
¡¡@ A
idRoute
¡¡A H
==
¡¡I K
item
¡¡L P
.
¡¡P Q
idRouteStart
¡¡Q ]
&&
¡¡^ `
x
¡¡a b
.
¡¡b c
idLine
¡¡c i
==
¡¡j l
Line
¡¡m q
)
¡¡q r
.
¡¡r s
FirstOrDefault¡¡s Å
(¡¡Å Ç
)¡¡Ç É
;¡¡É Ñ
var
¬¬  #
route2
¬¬$ *
=
¬¬+ ,
routes
¬¬- 3
.
¬¬3 4
Where
¬¬4 9
(
¬¬9 :
x
¬¬: ;
=>
¬¬< >
x
¬¬? @
.
¬¬@ A
idRoute
¬¬A H
==
¬¬I K
item
¬¬L P
.
¬¬P Q

idRouteEnd
¬¬Q [
&&
¬¬\ ^
x
¬¬_ `
.
¬¬` a
idLine
¬¬a g
==
¬¬h j
Line
¬¬k o
)
¬¬o p
.
¬¬p q
FirstOrDefault
¬¬q 
(¬¬ Ä
)¬¬Ä Å
;¬¬Å Ç
if
√√  "
(
√√# $
route1
√√$ *
!=
√√+ -
null
√√. 2
&&
√√3 5
route2
√√6 <
!=
√√< >
null
√√> B
)
√√C D
{
ƒƒ  !
var
≈≈$ '
routesDeviation
≈≈( 7
=
≈≈8 9
routes
≈≈: @
.
≈≈@ A
Where
≈≈A F
(
≈≈F G
x
≈≈G H
=>
≈≈I K
x
≈≈L M
.
≈≈M N
numPoint
≈≈N V
>=
≈≈W Y
route1
≈≈Z `
.
≈≈` a
numPoint
≈≈a i
&&
≈≈j l
x
≈≈m n
.
≈≈n o
numPoint
≈≈o w
<=
≈≈x z
route2≈≈{ Å
.≈≈Å Ç
numPoint≈≈Ç ä
&&≈≈ã ç
x≈≈é è
.≈≈è ê
idLine≈≈ê ñ
==≈≈ó ô
Line≈≈ö û
)≈≈û ü
.≈≈ü †
ToList≈≈† ¶
(≈≈¶ ß
)≈≈ß ®
;≈≈® ©
foreach
∆∆$ +
(
∆∆, -
var
∆∆- 0
item2
∆∆1 6
in
∆∆7 9
routesDeviation
∆∆: I
)
∆∆I J
{
««$ %
listBloqueos
»»( 4
.
»»4 5
Add
»»5 8
(
»»8 9
new
»»9 <
RutasMostrar
»»= I
(
»»I J
item2
»»J O
.
»»O P
idRoute
»»P W
,
»»W X
item2
»»Y ^
.
»»^ _
latitud
»»_ f
,
»»f g
item2
»»h m
.
»»m n
logintud
»»n v
,
»»v w
$str
»»x z
,
»»z {
item2»»| Å
.»»Å Ç
status»»Ç à
,»»à â
(»»ä ã
int»»ã é
)»»é è
item2»»è î
.»»î ï
numPoint»»ï ù
)»»ù û
)»»û ü
;»»ü †
}
……$ %
var
  $ '
place1
  ( .
=
  / 0
context
  1 8
.
  8 9
Place
  9 >
.
  > ?
Where
  ? D
(
  D E
x
  E F
=>
  G I
x
  J K
.
  K L
idPlace
  L S
==
  T V
route1
  W ]
.
  ] ^
idPlace
  ^ e
)
  e f
.
  f g
FirstOrDefault
  g u
(
  u v
)
  v w
;
  w x
var
ÀÀ$ '
place2
ÀÀ( .
=
ÀÀ/ 0
context
ÀÀ1 8
.
ÀÀ8 9
Place
ÀÀ9 >
.
ÀÀ> ?
Where
ÀÀ? D
(
ÀÀD E
x
ÀÀE F
=>
ÀÀG I
x
ÀÀJ K
.
ÀÀK L
idPlace
ÀÀL S
==
ÀÀT V
route2
ÀÀW ]
.
ÀÀ] ^
idPlace
ÀÀ^ e
)
ÀÀe f
.
ÀÀf g
FirstOrDefault
ÀÀg u
(
ÀÀu v
)
ÀÀv w
;
ÀÀw x
nuevosBloqueos
ÃÃ$ 2
.
ÃÃ2 3
Add
ÃÃ3 6
(
ÃÃ6 7
new
ÃÃ7 :
BloqueosMostrar
ÃÃ; J
(
ÃÃJ K
item
ÃÃK O
.
ÃÃO P
idDeviation
ÃÃP [
,
ÃÃ[ \
$str
ÃÃ] f
+
ÃÃg h
place1
ÃÃi o
.
ÃÃo p
description
ÃÃp {
+
ÃÃ| }
$strÃÃ~ É
+ÃÃÑ Ö
place2ÃÃÜ å
.ÃÃå ç
descriptionÃÃç ò
,ÃÃò ô
listBloqueosÃÃö ¶
,ÃÃ¶ ß
(ÃÃ® ©
doubleÃÃ© Ø
)ÃÃØ ∞
route1ÃÃ∞ ∂
.ÃÃ∂ ∑
latitudÃÃ∑ æ
,ÃÃæ ø
(ÃÃ¿ ¡
doubleÃÃ¡ «
)ÃÃ« »
route2ÃÃ» Œ
.ÃÃŒ œ
logintudÃÃœ ◊
)ÃÃ◊ ÿ
)ÃÃÿ Ÿ
;ÃÃŸ ⁄
}
ÕÕ  !
}
ŒŒ 
}
œœ 
if
–– 
(
–– 
routes
–– "
.
––" #
Count
––# (
>
––) *
$num
––+ ,
)
––, -
{
—— 
count
““ !
=
““" #
$num
““$ %
;
““% &
foreach
”” #
(
””$ %
var
””% (
item
””) -
in
””. 0
routes
””1 7
)
””7 8
{
‘‘ 
count
’’  %
++
’’% '
;
’’' (
Place
÷÷  %
place
÷÷& +
=
÷÷, -
context
÷÷. 5
.
÷÷5 6
Place
÷÷6 ;
.
÷÷; <
FirstOrDefault
÷÷< J
(
÷÷J K
x
÷÷K L
=>
÷÷M O
x
÷÷P Q
.
÷÷Q R
idPlace
÷÷R Y
==
÷÷Z \
item
÷÷] a
.
÷÷a b
idPlace
÷÷b i
)
÷÷i j
;
÷÷j k
if
◊◊  "
(
◊◊# $
place
◊◊$ )
!=
◊◊* ,
null
◊◊- 1
)
◊◊1 2
{
ÿÿ  !
nuevasRutas
ŸŸ$ /
.
ŸŸ/ 0
Add
ŸŸ0 3
(
ŸŸ3 4
new
ŸŸ4 7
RutasMostrar
ŸŸ8 D
(
ŸŸD E
item
ŸŸE I
.
ŸŸI J
idRoute
ŸŸJ Q
,
ŸŸQ R
item
ŸŸS W
.
ŸŸW X
latitud
ŸŸX _
,
ŸŸ_ `
item
ŸŸa e
.
ŸŸe f
logintud
ŸŸf n
,
ŸŸn o
place
ŸŸp u
.
ŸŸu v
descriptionŸŸv Å
,ŸŸÅ Ç
itemŸŸÉ á
.ŸŸá à
statusŸŸà é
,ŸŸé è
(ŸŸê ë
intŸŸë î
)ŸŸî ï
itemŸŸï ô
.ŸŸô ö
numPointŸŸö ¢
)ŸŸ¢ £
)ŸŸ£ §
;ŸŸ§ •
}
⁄⁄  !
}
€€ 
if
›› 
(
››  
nuevasRutas
››  +
.
››+ ,
Any
››, /
(
››/ 0
)
››0 1
)
››1 2
{
ﬁﬁ 
RutasMostrar
ﬂﬂ  ,
primeraRuta
ﬂﬂ- 8
=
ﬂﬂ9 :
nuevasRutas
ﬂﬂ; F
.
ﬂﬂF G
FirstOrDefault
ﬂﬂG U
(
ﬂﬂU V
r
ﬂﬂV W
=>
ﬂﬂX Z
r
ﬂﬂ[ \
.
ﬂﬂ\ ]
status
ﬂﬂ] c
==
ﬂﬂd f
$num
ﬂﬂg h
)
ﬂﬂh i
;
ﬂﬂi j
if
‡‡  "
(
‡‡# $
primeraRuta
‡‡$ /
!=
‡‡0 2
null
‡‡3 7
)
‡‡7 8
{
··  !
nuevasRutas
‚‚$ /
=
‚‚0 1
nuevasRutas
‚‚2 =
.
„„( )
OrderBy
„„) 0
(
„„0 1
route
„„1 6
=>
„„7 9
route
„„: ?
.
„„? @
numPoint
„„@ H
)
„„H I
.
‰‰( )
ToList
‰‰) /
(
‰‰/ 0
)
‰‰0 1
;
‰‰1 2
}
ÂÂ  !
}
ÊÊ 
count
ÁÁ !
=
ÁÁ" #
$num
ÁÁ$ %
;
ÁÁ% &
foreach
ËË #
(
ËË$ %
var
ËË% (
item
ËË) -
in
ËË. 0
nuevasRutas
ËË1 <
)
ËË< =
{
ÈÈ 
item
ÍÍ  $
.
ÍÍ$ %
name
ÍÍ% )
=
ÍÍ* +
item
ÍÍ, 0
.
ÍÍ0 1
name
ÍÍ1 5
+
ÍÍ6 7
$str
ÍÍ8 ;
+
ÍÍ< =
count
ÍÍ> C
;
ÍÍC D
count
ÎÎ  %
++
ÎÎ% '
;
ÎÎ' (
}
ÏÏ 
}
ÌÌ 
if
ÔÔ 
(
ÔÔ 
checkpoints
ÔÔ '
.
ÔÔ' (
Count
ÔÔ( -
>
ÔÔ. /
$num
ÔÔ0 1
)
ÔÔ1 2
{
 
count
ÒÒ !
=
ÒÒ" #
$num
ÒÒ$ %
;
ÒÒ% &
foreach
ÚÚ #
(
ÚÚ$ %
var
ÚÚ% (
item
ÚÚ) -
in
ÚÚ. 0
checkpoints
ÚÚ1 <
)
ÚÚ< =
{
ÛÛ 
count
ÙÙ  %
++
ÙÙ% '
;
ÙÙ' (
nuevasParadas
ıı  -
.
ıı- .
Add
ıı. 1
(
ıı1 2
new
ıı2 5
ParadasMostrar
ıı6 D
(
ııD E
item
ııE I
.
ııI J
idCheckpoint
ııJ V
,
ııV W
item
ııX \
.
ıı\ ]
description
ıı] h
,
ııh i
item
ııj n
.
ıın o
status
ııo u
,
ııu v
item
ııw {
.
ıı{ |
latitudıı| É
,ııÉ Ñ
itemııÖ â
.ııâ ä
longitudııä í
)ııí ì
)ııì î
;ııî ï
}
ˆˆ 
if
¯¯ 
(
¯¯  
nuevasParadas
¯¯  -
.
¯¯- .
Any
¯¯. 1
(
¯¯1 2
)
¯¯2 3
)
¯¯3 4
{
˘˘ 
ParadasMostrar
˙˙  .
primeraParada
˙˙/ <
=
˙˙= >
nuevasParadas
˙˙? L
.
˙˙L M
FirstOrDefault
˙˙M [
(
˙˙[ \
r
˙˙\ ]
=>
˙˙^ `
r
˙˙a b
.
˙˙b c
status
˙˙c i
==
˙˙j l
$num
˙˙m n
)
˙˙n o
;
˙˙o p
if
˚˚  "
(
˚˚# $
primeraParada
˚˚$ 1
!=
˚˚2 4
null
˚˚5 9
)
˚˚9 :
{
¸¸  !
nuevasParadas
˝˝$ 1
=
˝˝2 3
nuevasParadas
˝˝4 A
.
˛˛( )
OrderBy
˛˛) 0
(
˛˛0 1
route
˛˛1 6
=>
˛˛7 9
muestraRutasMapas
˛˛: K
.
˛˛K L(
CalcularDistanciaHaversine
˛˛L f
(
˛˛f g
(
ˇˇ, -
decimal
ˇˇ- 4
)
ˇˇ4 5
primeraParada
ˇˇ5 B
.
ˇˇB C
latitud
ˇˇC J
,
ˇˇJ K
(
ÄÄ, -
decimal
ÄÄ- 4
)
ÄÄ4 5
primeraParada
ÄÄ5 B
.
ÄÄB C
longitud
ÄÄC K
,
ÄÄK L
route
ÅÅ, 1
.
ÅÅ1 2
latitud
ÅÅ2 9
,
ÅÅ9 :
route
ÇÇ, 1
.
ÇÇ1 2
longitud
ÇÇ2 :
)
ÇÇ: ;
)
ÇÇ; <
.
ÉÉ( )
ToList
ÉÉ) /
(
ÉÉ/ 0
)
ÉÉ0 1
;
ÉÉ1 2
}
ÑÑ  !
}
ÖÖ 
count
ÜÜ !
=
ÜÜ" #
$num
ÜÜ$ %
;
ÜÜ% &
foreach
áá #
(
áá$ %
var
áá% (
item
áá) -
in
áá. 0
nuevasParadas
áá1 >
)
áá> ?
{
àà 
item
ââ  $
.
ââ$ %
description
ââ% 0
=
ââ1 2
item
ââ3 7
.
ââ7 8
description
ââ8 C
+
ââD E
$str
ââF I
+
ââJ K
count
ââL Q
;
ââQ R
count
ää  %
++
ää% '
;
ää' (
}
ãã 
}
åå 
}
çç 
muestraRutasMapas
éé %
.
éé% &
ListRutasMostrar
éé& 6
=
éé7 8
nuevasRutas
éé9 D
;
ééD E
muestraRutasMapas
èè %
.
èè% & 
ListParadasMostrar
èè& 8
=
èè9 :
nuevasParadas
èè; H
;
èèH I
muestraRutasMapas
êê %
.
êê% &!
ListBloqueosMostrar
êê& 9
=
êê: ;
nuevosBloqueos
êê< J
;
êêJ K
ViewBag
ëë 
.
ëë 
numTypeRoute
ëë (
=
ëë) *
numTypeRoute
ëë+ 7
;
ëë7 8
mapa
íí 
.
íí 
Add
íí 
(
íí 
muestraRutasMapas
íí .
)
íí. /
;
íí/ 0
}
ìì 
return
ïï 
View
ïï 
(
ïï 
mapa
ïï  
)
ïï  !
;
ïï! "
}
ññ 
catch
óó 
(
óó 
	Exception
óó 
)
óó 
{
òò 
return
ôô 
RedirectToAction
ôô '
(
ôô' (
$str
ôô( /
,
ôô/ 0
$str
ôô1 7
)
ôô7 8
;
ôô8 9
}
öö 
}
õõ 	
public
úú 
ActionResult
úú 
DeleteDeviation1
úú ,
(
úú, -
int
úú- 0
id
úú1 3
)
úú3 4
{
ùù 	
try
ûû 
{
üü 
var
†† 

authResult
†† 
=
††   
AutenticarPasosRol
††! 3
(
††3 4
$num
††4 5
)
††5 6
;
††6 7
if
°° 
(
°° 

authResult
°° 
!=
°° !
null
°°" &
)
°°& '
return
°°( .

authResult
°°/ 9
;
°°9 :
DeviationRote
¢¢ 
deviationRoute
¢¢ ,
=
¢¢- .
new
¢¢/ 2
DeviationRote
¢¢3 @
(
¢¢@ A
)
¢¢A B
;
¢¢B C
int
££ 
numTypeRoute
££  
=
££! "
$num
££# $
;
££$ %
using
§§ 
(
§§ 
dbModels
§§ 
context
§§  '
=
§§( )
new
§§* -
dbModels
§§. 6
(
§§6 7
)
§§7 8
)
§§8 9
{
•• 
deviationRoute
¶¶ "
=
¶¶# $
context
¶¶% ,
.
¶¶, -
DeviationRote
¶¶- :
.
¶¶: ;
Where
¶¶; @
(
¶¶@ A
x
¶¶A B
=>
¶¶C E
x
¶¶F G
.
¶¶G H
idDeviation
¶¶H S
==
¶¶T V
id
¶¶W Y
)
¶¶Y Z
.
¶¶Z [
FirstOrDefault
¶¶[ i
(
¶¶i j
)
¶¶j k
;
¶¶k l
var
ßß 
route
ßß 
=
ßß 
context
ßß  '
.
ßß' (
Route
ßß( -
.
ßß- .
Where
ßß. 3
(
ßß3 4
x
ßß4 5
=>
ßß6 8
x
ßß9 :
.
ßß: ;
idRoute
ßß; B
==
ßßC E
deviationRoute
ßßF T
.
ßßT U
idRouteStart
ßßU a
)
ßßa b
.
ßßb c
FirstOrDefault
ßßc q
(
ßßq r
)
ßßr s
;
ßßs t
numTypeRoute
®®  
=
®®! "
int
®®# &
.
®®& '
Parse
®®' ,
(
®®, -
route
®®- 2
.
®®2 3
numTypeRoute
®®3 ?
.
®®? @
ToString
®®@ H
(
®®H I
)
®®I J
)
®®J K
;
®®K L
context
©© 
.
©© 
DeviationRote
©© )
.
©©) *
Remove
©©* 0
(
©©0 1
deviationRoute
©©1 ?
)
©©? @
;
©©@ A
context
™™ 
.
™™ 
SaveChanges
™™ '
(
™™' (
)
™™( )
;
™™) *
}
´´ 
return
¨¨ 
RedirectToAction
¨¨ '
(
¨¨' (
$str
¨¨( 8
,
¨¨8 9
new
¨¨: =
{
¨¨> ?
numTypeRoute
¨¨@ L
=
¨¨N O
numTypeRoute
¨¨P \
}
¨¨] ^
)
¨¨^ _
;
¨¨_ `
}
≠≠ 
catch
ÆÆ 
{
ØØ 
return
∞∞ 
RedirectToAction
∞∞ '
(
∞∞' (
$str
∞∞( /
,
∞∞/ 0
$str
∞∞1 7
)
∞∞7 8
;
∞∞8 9
}
±± 
}
≤≤ 	
public
≥≥ 
ActionResult
≥≥ 
DeleteDeviation2
≥≥ ,
(
≥≥, -
int
≥≥- 0
id
≥≥1 3
)
≥≥3 4
{
¥¥ 	
try
µµ 
{
∂∂ 
var
∑∑ 

authResult
∑∑ 
=
∑∑   
AutenticarPasosRol
∑∑! 3
(
∑∑3 4
$num
∑∑4 5
)
∑∑5 6
;
∑∑6 7
if
∏∏ 
(
∏∏ 

authResult
∏∏ 
!=
∏∏ !
null
∏∏" &
)
∏∏& '
return
∏∏( .

authResult
∏∏/ 9
;
∏∏9 :
DeviationRote
ππ 
deviationRoute
ππ ,
=
ππ- .
new
ππ/ 2
DeviationRote
ππ3 @
(
ππ@ A
)
ππA B
;
ππB C
int
∫∫ 
numTypeRoute
∫∫  
=
∫∫! "
$num
∫∫# $
;
∫∫$ %
using
ªª 
(
ªª 
dbModels
ªª 
context
ªª  '
=
ªª( )
new
ªª* -
dbModels
ªª. 6
(
ªª6 7
)
ªª7 8
)
ªª8 9
{
ºº 
deviationRoute
ΩΩ "
=
ΩΩ# $
context
ΩΩ% ,
.
ΩΩ, -
DeviationRote
ΩΩ- :
.
ΩΩ: ;
Where
ΩΩ; @
(
ΩΩ@ A
x
ΩΩA B
=>
ΩΩC E
x
ΩΩF G
.
ΩΩG H
idDeviation
ΩΩH S
==
ΩΩT V
id
ΩΩW Y
)
ΩΩY Z
.
ΩΩZ [
FirstOrDefault
ΩΩ[ i
(
ΩΩi j
)
ΩΩj k
;
ΩΩk l
var
ææ 
route
ææ 
=
ææ 
context
ææ  '
.
ææ' (
Route
ææ( -
.
ææ- .
Where
ææ. 3
(
ææ3 4
x
ææ4 5
=>
ææ6 8
x
ææ9 :
.
ææ: ;
idRoute
ææ; B
==
ææC E
deviationRoute
ææF T
.
ææT U
idRouteStart
ææU a
)
ææa b
.
ææb c
FirstOrDefault
ææc q
(
ææq r
)
æær s
;
ææs t
numTypeRoute
øø  
=
øø! "
int
øø# &
.
øø& '
Parse
øø' ,
(
øø, -
route
øø- 2
.
øø2 3
numTypeRoute
øø3 ?
.
øø? @
ToString
øø@ H
(
øøH I
)
øøI J
)
øøJ K
;
øøK L
context
¿¿ 
.
¿¿ 
DeviationRote
¿¿ )
.
¿¿) *
Remove
¿¿* 0
(
¿¿0 1
deviationRoute
¿¿1 ?
)
¿¿? @
;
¿¿@ A
context
¡¡ 
.
¡¡ 
SaveChanges
¡¡ '
(
¡¡' (
)
¡¡( )
;
¡¡) *
}
¬¬ 
return
√√ 
RedirectToAction
√√ '
(
√√' (
$str
√√( 8
,
√√8 9
new
√√: =
{
√√> ?
numTypeRoute
√√@ L
=
√√M N
numTypeRoute
√√O [
}
√√\ ]
)
√√] ^
;
√√^ _
}
ƒƒ 
catch
≈≈ 
{
∆∆ 
return
«« 
RedirectToAction
«« '
(
««' (
$str
««( /
,
««/ 0
$str
««1 7
)
««7 8
;
««8 9
}
»» 
}
…… 	
public
   
ActionResult
   "
ReportRuta1Deviation
   0
(
  0 1
int
  1 4
numTypeRoute
  5 A
)
  A B
{
ÀÀ 	
try
ÃÃ 
{
ÕÕ 
Login
ŒŒ 
logi
ŒŒ 
=
ŒŒ 
new
ŒŒ  
Login
ŒŒ! &
(
ŒŒ& '
)
ŒŒ' (
;
ŒŒ( )
var
œœ 

authResult
œœ 
=
œœ   
AutenticarPasosRol
œœ! 3
(
œœ3 4
$num
œœ4 5
)
œœ5 6
;
œœ6 7
if
–– 
(
–– 

authResult
–– 
!=
–– !
null
––" &
)
––& '
return
––( .

authResult
––/ 9
;
––9 :
string
““ 
Line
““ 
=
““ 
logi
““ "
.
““" # 
GetLineaFromCookie
““# 5
(
““5 6
Request
““6 =
)
““= >
.
““> ?
ToString
““? G
(
““G H
)
““H I
;
““I J
List
”” 
<
”” 
Route
”” 
>
”” 
	routesVer
”” %
=
””& '
new
””( +
List
””, 0
<
””0 1
Route
””1 6
>
””6 7
(
””7 8
)
””8 9
;
””9 :
using
‘‘ 
(
‘‘ 
dbModels
‘‘ 
context
‘‘  '
=
‘‘( )
new
‘‘* -
dbModels
‘‘. 6
(
‘‘6 7
)
‘‘7 8
)
‘‘8 9
	routesVer
’’ 
=
’’ 
context
’’  '
.
’’' (
Route
’’( -
.
’’- .
Where
’’. 3
(
’’3 4
x
’’4 5
=>
’’6 8
x
’’9 :
.
’’: ;
numberRoute
’’; F
==
’’G I
$num
’’J K
&&
’’L N
x
’’O P
.
’’P Q
idLine
’’Q W
==
’’X Z
Line
’’[ _
&&
’’` b
x
’’c d
.
’’d e
numTypeRoute
’’e q
==
’’r t
numTypeRoute’’u Å
)’’Å Ç
.’’Ç É
ToList’’É â
(’’â ä
)’’ä ã
;’’ã å
if
÷÷ 
(
÷÷ 
	routesVer
÷÷ 
.
÷÷ 
Count
÷÷ #
<
÷÷$ %
$num
÷÷& '
)
÷÷' (
return
÷÷) /
RedirectToAction
÷÷0 @
(
÷÷@ A
$str
÷÷A Q
,
÷÷Q R
$str
÷÷S Z
,
÷÷Z [
new
÷÷\ _
{
÷÷` a
numTypeRoute
÷÷b n
=
÷÷o p
numTypeRoute
÷÷q }
}
÷÷~ 
)÷÷ Ä
;÷÷Ä Å
List
◊◊ 
<
◊◊ 
MuestraRutasMapas
◊◊ &
>
◊◊& '
mapa
◊◊( ,
=
◊◊- .
new
◊◊/ 2
List
◊◊3 7
<
◊◊7 8
MuestraRutasMapas
◊◊8 I
>
◊◊I J
(
◊◊J K
)
◊◊K L
;
◊◊L M
int
ÿÿ 
count
ÿÿ 
=
ÿÿ 
$num
ÿÿ 
;
ÿÿ 
for
ŸŸ 
(
ŸŸ 
int
ŸŸ 
i
ŸŸ 
=
ŸŸ 
$num
ŸŸ 
;
ŸŸ 
i
ŸŸ  !
<=
ŸŸ" $
$num
ŸŸ% &
;
ŸŸ& '
i
ŸŸ( )
++
ŸŸ) +
)
ŸŸ+ ,
{
⁄⁄ 
MuestraRutasMapas
€€ %
muestraRutasMapas
€€& 7
=
€€8 9
new
€€: =
MuestraRutasMapas
€€> O
{
‹‹ 
ListRutasMostrar
›› (
=
››) *
new
››+ .
List
››/ 3
<
››3 4
RutasMostrar
››4 @
>
››@ A
(
››A B
)
››B C
,
››C D 
ListParadasMostrar
ﬁﬁ *
=
ﬁﬁ+ ,
new
ﬁﬁ- 0
List
ﬁﬁ1 5
<
ﬁﬁ5 6
ParadasMostrar
ﬁﬁ6 D
>
ﬁﬁD E
(
ﬁﬁE F
)
ﬁﬁF G
,
ﬁﬁG H!
ListBloqueosMostrar
ﬂﬂ +
=
ﬂﬂ, -
new
ﬂﬂ. 1
List
ﬂﬂ2 6
<
ﬂﬂ6 7
BloqueosMostrar
ﬂﬂ7 F
>
ﬂﬂF G
(
ﬂﬂG H
)
ﬂﬂH I
,
ﬂﬂI J

NumeroRuta
‡‡ "
=
‡‡# $
i
‡‡% &
}
·· 
;
·· 
List
‚‚ 
<
‚‚ 
BloqueosMostrar
‚‚ (
>
‚‚( )
nuevosBloqueos
‚‚* 8
=
‚‚9 :
new
‚‚; >
List
‚‚? C
<
‚‚C D
BloqueosMostrar
‚‚D S
>
‚‚S T
(
‚‚T U
)
‚‚U V
;
‚‚V W
List
„„ 
<
„„ 
RutasMostrar
„„ %
>
„„% &
nuevasRutas
„„' 2
=
„„3 4
new
„„5 8
List
„„9 =
<
„„= >
RutasMostrar
„„> J
>
„„J K
(
„„K L
)
„„L M
;
„„M N
List
‰‰ 
<
‰‰ 
ParadasMostrar
‰‰ '
>
‰‰' (
nuevasParadas
‰‰) 6
=
‰‰7 8
new
‰‰9 <
List
‰‰= A
<
‰‰A B
ParadasMostrar
‰‰B P
>
‰‰P Q
(
‰‰Q R
)
‰‰R S
;
‰‰S T
using
ÊÊ 
(
ÊÊ 
dbModels
ÊÊ #
context
ÊÊ$ +
=
ÊÊ, -
new
ÊÊ. 1
dbModels
ÊÊ2 :
(
ÊÊ: ;
)
ÊÊ; <
)
ÊÊ< =
{
ÁÁ 
var
ËË 
checkpoints
ËË '
=
ËË( )
context
ËË* 1
.
ËË1 2

Checkpoint
ËË2 <
.
ËË< =
Where
ËË= B
(
ËËB C
x
ËËC D
=>
ËËE G
x
ËËH I
.
ËËI J
idLine
ËËJ P
==
ËËQ S
Line
ËËT X
&&
ËËY [
x
ËË\ ]
.
ËË] ^
status
ËË^ d
!=
ËËe g
$num
ËËh i
&&
ËËj l
x
ËËm n
.
ËËn o
numberRoute
ËËo z
==
ËË{ }
numTypeRouteËË~ ä
)ËËä ã
.ËËã å
ToListËËå í
(ËËí ì
)ËËì î
;ËËî ï
var
ÈÈ 
routes
ÈÈ "
=
ÈÈ# $
context
ÈÈ% ,
.
ÈÈ, -
Route
ÈÈ- 2
.
ÍÍ 
Where
ÍÍ "
(
ÍÍ" #
x
ÍÍ# $
=>
ÍÍ% '
x
ÍÍ( )
.
ÍÍ) *
idLine
ÍÍ* 0
==
ÍÍ1 3
Line
ÍÍ4 8
&&
ÍÍ9 ;
x
ÍÍ< =
.
ÍÍ= >
numberRoute
ÍÍ> I
==
ÍÍJ L
i
ÍÍM N
&&
ÍÍO Q
x
ÍÍR S
.
ÍÍS T
numTypeRoute
ÍÍT `
==
ÍÍa c
numTypeRoute
ÍÍd p
)
ÍÍp q
.
ÎÎ 
ToList
ÎÎ #
(
ÎÎ# $
)
ÎÎ$ %
;
ÎÎ% &
var
ÏÏ 
	deviation
ÏÏ %
=
ÏÏ& '
context
ÏÏ( /
.
ÏÏ/ 0
DeviationRote
ÏÏ0 =
.
ÏÏ= >
Where
ÏÏ> C
(
ÏÏC D
x
ÏÏD E
=>
ÏÏF H
x
ÏÏI J
.
ÏÏJ K
idLine
ÏÏK Q
==
ÏÏR T
Line
ÏÏU Y
&&
ÏÏZ \
x
ÏÏ] ^
.
ÏÏ^ _
numberRoute
ÏÏ_ j
==
ÏÏk m
i
ÏÏn o
&&
ÏÏp r
x
ÏÏs t
.
ÏÏt u
idLine
ÏÏu {
==
ÏÏ| ~
LineÏÏ É
&&ÏÏÑ Ü
xÏÏá à
.ÏÏà â
numTypeRouteÏÏâ ï
==ÏÏñ ò
numTypeRouteÏÏô •
)ÏÏ• ¶
.ÏÏ¶ ß
ToListÏÏß ≠
(ÏÏ≠ Æ
)ÏÏÆ Ø
;ÏÏØ ∞
if
ÌÌ 
(
ÌÌ 
	deviation
ÌÌ %
.
ÌÌ% &
Count
ÌÌ& +
>
ÌÌ, -
$num
ÌÌ. /
)
ÌÌ/ 0
{
ÓÓ 
foreach
ÔÔ #
(
ÔÔ$ %
var
ÔÔ% (
item
ÔÔ) -
in
ÔÔ. 0
	deviation
ÔÔ1 :
)
ÔÔ: ;
{
 
List
ÒÒ  $
<
ÒÒ$ %
RutasMostrar
ÒÒ% 1
>
ÒÒ1 2
listBloqueos
ÒÒ3 ?
=
ÒÒ@ A
new
ÒÒB E
List
ÒÒF J
<
ÒÒJ K
RutasMostrar
ÒÒK W
>
ÒÒW X
(
ÒÒX Y
)
ÒÒY Z
;
ÒÒZ [
var
ÚÚ  #
route1
ÚÚ$ *
=
ÚÚ+ ,
routes
ÚÚ- 3
.
ÚÚ3 4
Where
ÚÚ4 9
(
ÚÚ9 :
x
ÚÚ: ;
=>
ÚÚ< >
x
ÚÚ? @
.
ÚÚ@ A
idRoute
ÚÚA H
==
ÚÚI K
item
ÚÚL P
.
ÚÚP Q
idRouteStart
ÚÚQ ]
&&
ÚÚ^ `
x
ÚÚa b
.
ÚÚb c
idLine
ÚÚc i
==
ÚÚj l
Line
ÚÚm q
)
ÚÚq r
.
ÚÚr s
FirstOrDefaultÚÚs Å
(ÚÚÅ Ç
)ÚÚÇ É
;ÚÚÉ Ñ
var
ÛÛ  #
route2
ÛÛ$ *
=
ÛÛ+ ,
routes
ÛÛ- 3
.
ÛÛ3 4
Where
ÛÛ4 9
(
ÛÛ9 :
x
ÛÛ: ;
=>
ÛÛ< >
x
ÛÛ? @
.
ÛÛ@ A
idRoute
ÛÛA H
==
ÛÛI K
item
ÛÛL P
.
ÛÛP Q

idRouteEnd
ÛÛQ [
&&
ÛÛ\ ^
x
ÛÛ_ `
.
ÛÛ` a
idLine
ÛÛa g
==
ÛÛh j
Line
ÛÛk o
)
ÛÛo p
.
ÛÛp q
FirstOrDefault
ÛÛq 
(ÛÛ Ä
)ÛÛÄ Å
;ÛÛÅ Ç
if
ÙÙ  "
(
ÙÙ# $
route1
ÙÙ$ *
!=
ÙÙ+ -
null
ÙÙ. 2
&&
ÙÙ3 5
route2
ÙÙ6 <
!=
ÙÙ= ?
null
ÙÙ@ D
)
ÙÙD E
{
ıı  !
var
ˆˆ$ '
routesDeviation
ˆˆ( 7
=
ˆˆ8 9
routes
ˆˆ: @
.
ˆˆ@ A
Where
ˆˆA F
(
ˆˆF G
x
ˆˆG H
=>
ˆˆI K
x
ˆˆL M
.
ˆˆM N
numPoint
ˆˆN V
>=
ˆˆW Y
route1
ˆˆZ `
.
ˆˆ` a
numPoint
ˆˆa i
&&
ˆˆj l
x
ˆˆm n
.
ˆˆn o
numPoint
ˆˆo w
<=
ˆˆx z
route2ˆˆ{ Å
.ˆˆÅ Ç
numPointˆˆÇ ä
&&ˆˆã ç
xˆˆé è
.ˆˆè ê
idLineˆˆê ñ
==ˆˆó ô
Lineˆˆö û
)ˆˆû ü
.ˆˆü †
ToListˆˆ† ¶
(ˆˆ¶ ß
)ˆˆß ®
;ˆˆ® ©
foreach
˜˜$ +
(
˜˜, -
var
˜˜- 0
item2
˜˜1 6
in
˜˜7 9
routesDeviation
˜˜: I
)
˜˜I J
{
¯¯$ %
listBloqueos
˘˘( 4
.
˘˘4 5
Add
˘˘5 8
(
˘˘8 9
new
˘˘9 <
RutasMostrar
˘˘= I
(
˘˘I J
item2
˘˘J O
.
˘˘O P
idRoute
˘˘P W
,
˘˘W X
item2
˘˘Y ^
.
˘˘^ _
latitud
˘˘_ f
,
˘˘f g
item2
˘˘h m
.
˘˘m n
logintud
˘˘n v
,
˘˘v w
$str
˘˘x z
,
˘˘z {
item2˘˘| Å
.˘˘Å Ç
status˘˘Ç à
,˘˘à â
(˘˘ä ã
int˘˘ã é
)˘˘é è
item2˘˘è î
.˘˘î ï
numPoint˘˘ï ù
)˘˘ù û
)˘˘û ü
;˘˘ü †
}
˙˙$ %
var
˚˚$ '
place1
˚˚( .
=
˚˚/ 0
context
˚˚1 8
.
˚˚8 9
Place
˚˚9 >
.
˚˚> ?
Where
˚˚? D
(
˚˚D E
x
˚˚E F
=>
˚˚G I
x
˚˚J K
.
˚˚K L
idPlace
˚˚L S
==
˚˚T V
route1
˚˚W ]
.
˚˚] ^
idPlace
˚˚^ e
)
˚˚e f
.
˚˚f g
FirstOrDefault
˚˚g u
(
˚˚u v
)
˚˚v w
;
˚˚w x
var
¸¸$ '
place2
¸¸( .
=
¸¸/ 0
context
¸¸1 8
.
¸¸8 9
Place
¸¸9 >
.
¸¸> ?
Where
¸¸? D
(
¸¸D E
x
¸¸E F
=>
¸¸G I
x
¸¸J K
.
¸¸K L
idPlace
¸¸L S
==
¸¸T V
route2
¸¸W ]
.
¸¸] ^
idPlace
¸¸^ e
)
¸¸e f
.
¸¸f g
FirstOrDefault
¸¸g u
(
¸¸u v
)
¸¸v w
;
¸¸w x
nuevosBloqueos
˝˝$ 2
.
˝˝2 3
Add
˝˝3 6
(
˝˝6 7
new
˝˝7 :
BloqueosMostrar
˝˝; J
(
˝˝J K
item
˝˝K O
.
˝˝O P
idDeviation
˝˝P [
,
˝˝[ \
$str
˝˝] f
+
˝˝g h
place1
˝˝i o
.
˝˝o p
description
˝˝p {
+
˝˝| }
$str˝˝~ É
+˝˝Ñ Ö
place2˝˝Ü å
.˝˝å ç
description˝˝ç ò
,˝˝ò ô
listBloqueos˝˝ö ¶
,˝˝¶ ß
(˝˝® ©
double˝˝© Ø
)˝˝Ø ∞
route1˝˝∞ ∂
.˝˝∂ ∑
latitud˝˝∑ æ
,˝˝æ ø
(˝˝¿ ¡
double˝˝¡ «
)˝˝« »
route2˝˝» Œ
.˝˝Œ œ
logintud˝˝œ ◊
)˝˝◊ ÿ
)˝˝ÿ Ÿ
;˝˝Ÿ ⁄
}
˛˛  !
}
ˇˇ 
}
Ä	Ä	 
if
Å	Å	 
(
Å	Å	 
routes
Å	Å	 "
.
Å	Å	" #
Count
Å	Å	# (
>
Å	Å	) *
$num
Å	Å	+ ,
)
Å	Å	, -
{
Ç	Ç	 
count
É	É	 !
=
É	É	" #
$num
É	É	$ %
;
É	É	% &
foreach
Ñ	Ñ	 #
(
Ñ	Ñ	$ %
var
Ñ	Ñ	% (
item
Ñ	Ñ	) -
in
Ñ	Ñ	. 0
routes
Ñ	Ñ	1 7
)
Ñ	Ñ	7 8
{
Ö	Ö	 
count
Ü	Ü	  %
++
Ü	Ü	% '
;
Ü	Ü	' (
Place
á	á	  %
place
á	á	& +
=
á	á	, -
context
á	á	. 5
.
á	á	5 6
Place
á	á	6 ;
.
á	á	; <
FirstOrDefault
á	á	< J
(
á	á	J K
x
á	á	K L
=>
á	á	M O
x
á	á	P Q
.
á	á	Q R
idPlace
á	á	R Y
==
á	á	Z \
item
á	á	] a
.
á	á	a b
idPlace
á	á	b i
)
á	á	i j
;
á	á	j k
if
à	à	  "
(
à	à	# $
place
à	à	$ )
!=
à	à	* ,
null
à	à	- 1
)
à	à	1 2
{
â	â	  !
nuevasRutas
ä	ä	$ /
.
ä	ä	/ 0
Add
ä	ä	0 3
(
ä	ä	3 4
new
ä	ä	4 7
RutasMostrar
ä	ä	8 D
(
ä	ä	D E
item
ä	ä	E I
.
ä	ä	I J
idRoute
ä	ä	J Q
,
ä	ä	Q R
item
ä	ä	S W
.
ä	ä	W X
latitud
ä	ä	X _
,
ä	ä	_ `
item
ä	ä	a e
.
ä	ä	e f
logintud
ä	ä	f n
,
ä	ä	n o
place
ä	ä	p u
.
ä	ä	u v
descriptionä	ä	v Å
,ä	ä	Å Ç
itemä	ä	É á
.ä	ä	á à
statusä	ä	à é
,ä	ä	é è
(ä	ä	ê ë
intä	ä	ë î
)ä	ä	î ï
itemä	ä	ï ô
.ä	ä	ô ö
numPointä	ä	ö ¢
)ä	ä	¢ £
)ä	ä	£ §
;ä	ä	§ •
}
ã	ã	  !
}
å	å	 
if
é	é	 
(
é	é	  
nuevasRutas
é	é	  +
.
é	é	+ ,
Any
é	é	, /
(
é	é	/ 0
)
é	é	0 1
)
é	é	1 2
{
è	è	 
RutasMostrar
ê	ê	  ,
primeraRuta
ê	ê	- 8
=
ê	ê	9 :
nuevasRutas
ê	ê	; F
.
ê	ê	F G
FirstOrDefault
ê	ê	G U
(
ê	ê	U V
r
ê	ê	V W
=>
ê	ê	X Z
r
ê	ê	[ \
.
ê	ê	\ ]
status
ê	ê	] c
==
ê	ê	d f
$num
ê	ê	g h
)
ê	ê	h i
;
ê	ê	i j
if
ë	ë	  "
(
ë	ë	# $
primeraRuta
ë	ë	$ /
!=
ë	ë	0 2
null
ë	ë	3 7
)
ë	ë	7 8
{
í	í	  !
nuevasRutas
ì	ì	$ /
=
ì	ì	0 1
nuevasRutas
ì	ì	2 =
.
î	î	( )
OrderBy
î	î	) 0
(
î	î	0 1
route
î	î	1 6
=>
î	î	7 9
route
î	î	: ?
.
î	î	? @
numPoint
î	î	@ H
)
î	î	H I
.
ï	ï	( )
ToList
ï	ï	) /
(
ï	ï	/ 0
)
ï	ï	0 1
;
ï	ï	1 2
}
ñ	ñ	  !
}
ó	ó	 
count
ò	ò	 !
=
ò	ò	" #
$num
ò	ò	$ %
;
ò	ò	% &
foreach
ô	ô	 #
(
ô	ô	$ %
var
ô	ô	% (
item
ô	ô	) -
in
ô	ô	. 0
nuevasRutas
ô	ô	1 <
)
ô	ô	< =
{
ö	ö	 
item
õ	õ	  $
.
õ	õ	$ %
name
õ	õ	% )
=
õ	õ	* +
item
õ	õ	, 0
.
õ	õ	0 1
name
õ	õ	1 5
+
õ	õ	6 7
$str
õ	õ	8 ;
+
õ	õ	< =
count
õ	õ	> C
;
õ	õ	C D
count
ú	ú	  %
++
ú	ú	% '
;
ú	ú	' (
}
ù	ù	 
}
û	û	 
if
†	†	 
(
†	†	 
checkpoints
†	†	 '
.
†	†	' (
Count
†	†	( -
>
†	†	. /
$num
†	†	0 1
)
†	†	1 2
{
°	°	 
count
¢	¢	 !
=
¢	¢	" #
$num
¢	¢	$ %
;
¢	¢	% &
foreach
£	£	 #
(
£	£	$ %
var
£	£	% (
item
£	£	) -
in
£	£	. 0
checkpoints
£	£	1 <
)
£	£	< =
{
§	§	 
count
•	•	  %
++
•	•	% '
;
•	•	' (
nuevasParadas
¶	¶	  -
.
¶	¶	- .
Add
¶	¶	. 1
(
¶	¶	1 2
new
¶	¶	2 5
ParadasMostrar
¶	¶	6 D
(
¶	¶	D E
item
¶	¶	E I
.
¶	¶	I J
idCheckpoint
¶	¶	J V
,
¶	¶	V W
item
¶	¶	X \
.
¶	¶	\ ]
description
¶	¶	] h
,
¶	¶	h i
item
¶	¶	j n
.
¶	¶	n o
status
¶	¶	o u
,
¶	¶	u v
item
¶	¶	w {
.
¶	¶	{ |
latitud¶	¶	| É
,¶	¶	É Ñ
item¶	¶	Ö â
.¶	¶	â ä
longitud¶	¶	ä í
)¶	¶	í ì
)¶	¶	ì î
;¶	¶	î ï
}
ß	ß	 
if
©	©	 
(
©	©	  
nuevasParadas
©	©	  -
.
©	©	- .
Any
©	©	. 1
(
©	©	1 2
)
©	©	2 3
)
©	©	3 4
{
™	™	 
ParadasMostrar
´	´	  .
primeraParada
´	´	/ <
=
´	´	= >
nuevasParadas
´	´	? L
.
´	´	L M
FirstOrDefault
´	´	M [
(
´	´	[ \
r
´	´	\ ]
=>
´	´	^ `
r
´	´	a b
.
´	´	b c
status
´	´	c i
==
´	´	j l
$num
´	´	m n
)
´	´	n o
;
´	´	o p
if
¨	¨	  "
(
¨	¨	# $
primeraParada
¨	¨	$ 1
!=
¨	¨	2 4
null
¨	¨	5 9
)
¨	¨	9 :
{
≠	≠	  !
nuevasParadas
Æ	Æ	$ 1
=
Æ	Æ	2 3
nuevasParadas
Æ	Æ	4 A
.
Ø	Ø	( )
OrderBy
Ø	Ø	) 0
(
Ø	Ø	0 1
route
Ø	Ø	1 6
=>
Ø	Ø	7 9
muestraRutasMapas
Ø	Ø	: K
.
Ø	Ø	K L(
CalcularDistanciaHaversine
Ø	Ø	L f
(
Ø	Ø	f g
(
∞	∞	, -
decimal
∞	∞	- 4
)
∞	∞	4 5
primeraParada
∞	∞	5 B
.
∞	∞	B C
latitud
∞	∞	C J
,
∞	∞	J K
(
±	±	, -
decimal
±	±	- 4
)
±	±	4 5
primeraParada
±	±	5 B
.
±	±	B C
longitud
±	±	C K
,
±	±	K L
route
≤	≤	, 1
.
≤	≤	1 2
latitud
≤	≤	2 9
,
≤	≤	9 :
route
≥	≥	, 1
.
≥	≥	1 2
longitud
≥	≥	2 :
)
≥	≥	: ;
)
≥	≥	; <
.
¥	¥	( )
ToList
¥	¥	) /
(
¥	¥	/ 0
)
¥	¥	0 1
;
¥	¥	1 2
}
µ	µ	  !
}
∂	∂	 
count
∑	∑	 !
=
∑	∑	" #
$num
∑	∑	$ %
;
∑	∑	% &
foreach
∏	∏	 #
(
∏	∏	$ %
var
∏	∏	% (
item
∏	∏	) -
in
∏	∏	. 0
nuevasParadas
∏	∏	1 >
)
∏	∏	> ?
{
π	π	 
item
∫	∫	  $
.
∫	∫	$ %
description
∫	∫	% 0
=
∫	∫	1 2
item
∫	∫	3 7
.
∫	∫	7 8
description
∫	∫	8 C
+
∫	∫	D E
$str
∫	∫	F I
+
∫	∫	J K
count
∫	∫	L Q
;
∫	∫	Q R
count
ª	ª	  %
++
ª	ª	% '
;
ª	ª	' (
}
º	º	 
}
Ω	Ω	 
}
æ	æ	 
muestraRutasMapas
ø	ø	 %
.
ø	ø	% &
ListRutasMostrar
ø	ø	& 6
=
ø	ø	7 8
nuevasRutas
ø	ø	9 D
;
ø	ø	D E
muestraRutasMapas
¿	¿	 %
.
¿	¿	% & 
ListParadasMostrar
¿	¿	& 8
=
¿	¿	9 :
nuevasParadas
¿	¿	; H
;
¿	¿	H I
muestraRutasMapas
¡	¡	 %
.
¡	¡	% &!
ListBloqueosMostrar
¡	¡	& 9
=
¡	¡	: ;
nuevosBloqueos
¡	¡	< J
;
¡	¡	J K
ViewBag
¬	¬	 
.
¬	¬	 
numTypeRoute
¬	¬	 (
=
¬	¬	) *
numTypeRoute
¬	¬	+ 7
;
¬	¬	7 8
mapa
√	√	 
.
√	√	 
Add
√	√	 
(
√	√	 
muestraRutasMapas
√	√	 .
)
√	√	. /
;
√	√	/ 0
}
ƒ	ƒ	 
return
∆	∆	 
View
∆	∆	 
(
∆	∆	 
mapa
∆	∆	  
)
∆	∆	  !
;
∆	∆	! "
}
«	«	 
catch
»	»	 
(
»	»	 
	Exception
»	»	 
)
»	»	 
{
…	…	 
return
 	 	 
RedirectToAction
 	 	 '
(
 	 	' (
$str
 	 	( /
,
 	 	/ 0
$str
 	 	1 7
)
 	 	7 8
;
 	 	8 9
}
À	À	 
}
Ã	Ã	 	
[
Õ	Õ	 	
HttpPost
Õ	Õ		 
]
Õ	Õ	 
public
Œ	Œ	 
ActionResult
Œ	Œ	 "
ReportRuta1Deviation
Œ	Œ	 0
(
Œ	Œ	0 1
string
Œ	Œ	1 7
ubicaciones
Œ	Œ	8 C
,
Œ	Œ	C D
int
Œ	Œ	E H
numTypeRoute
Œ	Œ	I U
)
Œ	Œ	U V
{
œ	œ	 	
try
–	–	 
{
—	—	 
Login
“	“	 
logi
“	“	 
=
“	“	 
new
“	“	  
Login
“	“	! &
(
“	“	& '
)
“	“	' (
;
“	“	( )
var
”	”	 

authResult
”	”	 
=
”	”	   
AutenticarPasosRol
”	”	! 3
(
”	”	3 4
$num
”	”	4 5
)
”	”	5 6
;
”	”	6 7
if
‘	‘	 
(
‘	‘	 

authResult
‘	‘	 
!=
‘	‘	 !
null
‘	‘	" &
)
‘	‘	& '
return
‘	‘	( .

authResult
‘	‘	/ 9
;
‘	‘	9 :
string
’	’	 
Line
’	’	 
=
’	’	 
logi
’	’	 "
.
’	’	" # 
GetLineaFromCookie
’	’	# 5
(
’	’	5 6
Request
’	’	6 =
)
’	’	= >
.
’	’	> ?
ToString
’	’	? G
(
’	’	G H
)
’	’	H I
;
’	’	I J
string
◊	◊	 
[
◊	◊	 
]
◊	◊	  
ubicacionesConvert
◊	◊	 +
=
◊	◊	, -
ubicaciones
◊	◊	. 9
.
◊	◊	9 :
Split
◊	◊	: ?
(
◊	◊	? @
new
◊	◊	@ C
[
◊	◊	C D
]
◊	◊	D E
{
◊	◊	F G
$char
◊	◊	H L
}
◊	◊	M N
,
◊	◊	N O 
StringSplitOptions
◊	◊	P b
.
◊	◊	b c 
RemoveEmptyEntries
◊	◊	c u
)
◊	◊	u v
;
◊	◊	v w
List
ÿ	ÿ	 
<
ÿ	ÿ	 
Route
ÿ	ÿ	 
>
ÿ	ÿ	 
routes
ÿ	ÿ	 "
=
ÿ	ÿ	# $
new
ÿ	ÿ	% (
List
ÿ	ÿ	) -
<
ÿ	ÿ	- .
Route
ÿ	ÿ	. 3
>
ÿ	ÿ	3 4
(
ÿ	ÿ	4 5
)
ÿ	ÿ	5 6
;
ÿ	ÿ	6 7
using
Ÿ	Ÿ	 
(
Ÿ	Ÿ	 
dbModels
Ÿ	Ÿ	 
context
Ÿ	Ÿ	  '
=
Ÿ	Ÿ	( )
new
Ÿ	Ÿ	* -
dbModels
Ÿ	Ÿ	. 6
(
Ÿ	Ÿ	6 7
)
Ÿ	Ÿ	7 8
)
Ÿ	Ÿ	8 9
routes
⁄	⁄	 
=
⁄	⁄	 
context
⁄	⁄	 $
.
⁄	⁄	$ %
Route
⁄	⁄	% *
.
⁄	⁄	* +
Where
⁄	⁄	+ 0
(
⁄	⁄	0 1
x
⁄	⁄	1 2
=>
⁄	⁄	3 5
x
⁄	⁄	6 7
.
⁄	⁄	7 8
numberRoute
⁄	⁄	8 C
==
⁄	⁄	D F
$num
⁄	⁄	G H
&&
⁄	⁄	I K
x
⁄	⁄	L M
.
⁄	⁄	M N
idLine
⁄	⁄	N T
==
⁄	⁄	U W
Line
⁄	⁄	X \
&&
⁄	⁄	] _
x
⁄	⁄	` a
.
⁄	⁄	a b
status
⁄	⁄	b h
!=
⁄	⁄	i k
$num
⁄	⁄	l m
&&
⁄	⁄	n p
x
⁄	⁄	q r
.
⁄	⁄	r s
numTypeRoute
⁄	⁄	s 
==⁄	⁄	Ä Ç
numTypeRoute⁄	⁄	É è
)⁄	⁄	è ê
.⁄	⁄	ê ë
ToList⁄	⁄	ë ó
(⁄	⁄	ó ò
)⁄	⁄	ò ô
;⁄	⁄	ô ö
if
€	€	 
(
€	€	 
routes
€	€	 
.
€	€	 
Count
€	€	  
<
€	€	! "
$num
€	€	# $
)
€	€	$ %
return
€	€	& ,
RedirectToAction
€	€	- =
(
€	€	= >
$str
€	€	> N
,
€	€	N O
$str
€	€	P W
,
€	€	W X
new
€	€	Y \
{
€	€	] ^
numTypeRoute
€	€	_ k
=
€	€	l m
numTypeRoute
€	€	n z
}
€	€	{ |
)
€	€	| }
;
€	€	} ~
if
‹	‹	 
(
‹	‹	  
ubicacionesConvert
‹	‹	 &
.
‹	‹	& '
Length
‹	‹	' -
==
‹	‹	. 0
$num
‹	‹	1 2
)
‹	‹	2 3
{
›	›	 
string
ﬂ	ﬂ	 
[
ﬂ	ﬂ	 
]
ﬂ	ﬂ	 
primeraUbicacion
ﬂ	ﬂ	 -
=
ﬂ	ﬂ	. / 
ubicacionesConvert
ﬂ	ﬂ	0 B
[
ﬂ	ﬂ	B C
$num
ﬂ	ﬂ	C D
]
ﬂ	ﬂ	D E
.
ﬂ	ﬂ	E F
Split
ﬂ	ﬂ	F K
(
ﬂ	ﬂ	K L
$char
ﬂ	ﬂ	L O
)
ﬂ	ﬂ	O P
;
ﬂ	ﬂ	P Q
decimal
‡	‡	 
latitud1
‡	‡	 $
=
‡	‡	% &
Convert
‡	‡	' .
.
‡	‡	. /
	ToDecimal
‡	‡	/ 8
(
‡	‡	8 9
primeraUbicacion
‡	‡	9 I
[
‡	‡	I J
$num
‡	‡	J K
]
‡	‡	K L
,
‡	‡	L M
System
‡	‡	N T
.
‡	‡	T U
Globalization
‡	‡	U b
.
‡	‡	b c
CultureInfo
‡	‡	c n
.
‡	‡	n o
InvariantCulture
‡	‡	o 
)‡	‡	 Ä
;‡	‡	Ä Å
decimal
·	·	 
	longitud1
·	·	 %
=
·	·	& '
Convert
·	·	( /
.
·	·	/ 0
	ToDecimal
·	·	0 9
(
·	·	9 :
primeraUbicacion
·	·	: J
[
·	·	J K
$num
·	·	K L
]
·	·	L M
,
·	·	M N
System
·	·	O U
.
·	·	U V
Globalization
·	·	V c
.
·	·	c d
CultureInfo
·	·	d o
.
·	·	o p
InvariantCulture·	·	p Ä
)·	·	Ä Å
;·	·	Å Ç
string
‰	‰	 
[
‰	‰	 
]
‰	‰	 
segundaUbicacion
‰	‰	 -
=
‰	‰	. / 
ubicacionesConvert
‰	‰	0 B
[
‰	‰	B C
$num
‰	‰	C D
]
‰	‰	D E
.
‰	‰	E F
Split
‰	‰	F K
(
‰	‰	K L
$char
‰	‰	L O
)
‰	‰	O P
;
‰	‰	P Q
decimal
Â	Â	 
latitud2
Â	Â	 $
=
Â	Â	% &
Convert
Â	Â	' .
.
Â	Â	. /
	ToDecimal
Â	Â	/ 8
(
Â	Â	8 9
segundaUbicacion
Â	Â	9 I
[
Â	Â	I J
$num
Â	Â	J K
]
Â	Â	K L
,
Â	Â	L M
System
Â	Â	N T
.
Â	Â	T U
Globalization
Â	Â	U b
.
Â	Â	b c
CultureInfo
Â	Â	c n
.
Â	Â	n o
InvariantCulture
Â	Â	o 
)Â	Â	 Ä
;Â	Â	Ä Å
decimal
Ê	Ê	 
	longitud2
Ê	Ê	 %
=
Ê	Ê	& '
Convert
Ê	Ê	( /
.
Ê	Ê	/ 0
	ToDecimal
Ê	Ê	0 9
(
Ê	Ê	9 :
segundaUbicacion
Ê	Ê	: J
[
Ê	Ê	J K
$num
Ê	Ê	K L
]
Ê	Ê	L M
,
Ê	Ê	M N
System
Ê	Ê	O U
.
Ê	Ê	U V
Globalization
Ê	Ê	V c
.
Ê	Ê	c d
CultureInfo
Ê	Ê	d o
.
Ê	Ê	o p
InvariantCultureÊ	Ê	p Ä
)Ê	Ê	Ä Å
;Ê	Ê	Å Ç
List
Ë	Ë	 
<
Ë	Ë	 
Route
Ë	Ë	 
>
Ë	Ë	 
	RouteList
Ë	Ë	  )
=
Ë	Ë	* +
new
Ë	Ë	, /
List
Ë	Ë	0 4
<
Ë	Ë	4 5
Route
Ë	Ë	5 :
>
Ë	Ë	: ;
(
Ë	Ë	; <
)
Ë	Ë	< =
;
Ë	Ë	= >
List
Ë	Ë	? C
<
Ë	Ë	C D
Route
Ë	Ë	D I
>
Ë	Ë	I J

RouteOrder
Ë	Ë	K U
=
Ë	Ë	V W
new
Ë	Ë	X [
List
Ë	Ë	\ `
<
Ë	Ë	` a
Route
Ë	Ë	a f
>
Ë	Ë	f g
(
Ë	Ë	g h
)
Ë	Ë	h i
;
Ë	Ë	i j
List
Ë	Ë	k o
<
Ë	Ë	o p
Route
Ë	Ë	p u
>
Ë	Ë	u v
RouteOrder2Ë	Ë	w Ç
=Ë	Ë	É Ñ
newË	Ë	Ö à
ListË	Ë	â ç
<Ë	Ë	ç é
RouteË	Ë	é ì
>Ë	Ë	ì î
(Ë	Ë	î ï
)Ë	Ë	ï ñ
;Ë	Ë	ñ ó
MuestraRutasMapas
È	È	 %
muestraRutasMapas
È	È	& 7
=
È	È	8 9
new
È	È	: =
MuestraRutasMapas
È	È	> O
(
È	È	O P
)
È	È	P Q
;
È	È	Q R
using
Í	Í	 
(
Í	Í	 
dbModels
Í	Í	 #
context
Í	Í	$ +
=
Í	Í	, -
new
Í	Í	. 1
dbModels
Í	Í	2 :
(
Í	Í	: ;
)
Í	Í	; <
)
Í	Í	< =
	RouteList
Í	Í	> G
=
Í	Í	H I
context
Í	Í	J Q
.
Í	Í	Q R
Route
Í	Í	R W
.
Í	Í	W X
Where
Í	Í	X ]
(
Í	Í	] ^
x
Í	Í	^ _
=>
Í	Í	` b
x
Í	Í	c d
.
Í	Í	d e
idLine
Í	Í	e k
==
Í	Í	l n
Line
Í	Í	o s
&&
Í	Í	t v
x
Í	Í	w x
.
Í	Í	x y
numberRouteÍ	Í	y Ñ
==Í	Í	Ö á
$numÍ	Í	à â
&&Í	Í	ä å
xÍ	Í	ç é
.Í	Í	é è
statusÍ	Í	è ï
!=Í	Í	ñ ò
$numÍ	Í	ô ö
&&Í	Í	õ ù
xÍ	Í	û ü
.Í	Í	ü †
numTypeRouteÍ	Í	† ¨
==Í	Í	≠ Ø
numTypeRouteÍ	Í	∞ º
)Í	Í	º Ω
.Í	Í	Ω æ
ToListÍ	Í	æ ƒ
(Í	Í	ƒ ≈
)Í	Í	≈ ∆
;Í	Í	∆ «
List
Î	Î	 
<
Î	Î	 
Route
Î	Î	 
>
Î	Î	 

RouteList2
Î	Î	  *
=
Î	Î	+ ,
	RouteList
Î	Î	- 6
;
Î	Î	6 7
int
Ï	Ï	 
idInicio
Ï	Ï	  
=
Ï	Ï	! "
$num
Ï	Ï	# $
;
Ï	Ï	$ %
int
Ï	Ï	& )
idFinal
Ï	Ï	* 1
=
Ï	Ï	2 3
$num
Ï	Ï	4 5
;
Ï	Ï	5 6
bool
Ï	Ï	7 ;
verificacion
Ï	Ï	< H
=
Ï	Ï	I J
false
Ï	Ï	K P
;
Ï	Ï	P Q
int
Ï	Ï	R U
count
Ï	Ï	V [
=
Ï	Ï	\ ]
$num
Ï	Ï	^ _
;
Ï	Ï	_ `
while
Ì	Ì	 
(
Ì	Ì	 
verificacion
Ì	Ì	 '
==
Ì	Ì	( *
false
Ì	Ì	+ 0
)
Ì	Ì	0 1
{
Ó	Ó	 

RouteOrder
Ô	Ô	 "
=
Ô	Ô	# $
	RouteList
Ô	Ô	% .
.
		$ %
OrderBy
		% ,
(
		, -
route
		- 2
=>
		3 5
muestraRutasMapas
		6 G
.
		G H(
CalcularDistanciaHaversine
		H b
(
		b c
(
Ò	Ò	( )
decimal
Ò	Ò	) 0
)
Ò	Ò	0 1
latitud1
Ò	Ò	1 9
,
Ò	Ò	9 :
(
Ú	Ú	( )
decimal
Ú	Ú	) 0
)
Ú	Ú	0 1
	longitud1
Ú	Ú	1 :
,
Ú	Ú	: ;
(
Û	Û	( )
decimal
Û	Û	) 0
)
Û	Û	0 1
route
Û	Û	1 6
.
Û	Û	6 7
latitud
Û	Û	7 >
,
Û	Û	> ?
(
Ù	Ù	( )
decimal
Ù	Ù	) 0
)
Ù	Ù	0 1
route
Ù	Ù	1 6
.
Ù	Ù	6 7
logintud
Ù	Ù	7 ?
)
Ù	Ù	? @
)
Ù	Ù	@ A
.
ı	ı	$ %
ToList
ı	ı	% +
(
ı	ı	+ ,
)
ı	ı	, -
;
ı	ı	- .
RouteOrder2
ˆ	ˆ	 #
=
ˆ	ˆ	$ %

RouteList2
ˆ	ˆ	& 0
.
˜	˜	$ %
OrderBy
˜	˜	% ,
(
˜	˜	, -
route
˜	˜	- 2
=>
˜	˜	3 5
muestraRutasMapas
˜	˜	6 G
.
˜	˜	G H(
CalcularDistanciaHaversine
˜	˜	H b
(
˜	˜	b c
(
¯	¯	( )
decimal
¯	¯	) 0
)
¯	¯	0 1
latitud2
¯	¯	1 9
,
¯	¯	9 :
(
˘	˘	( )
decimal
˘	˘	) 0
)
˘	˘	0 1
	longitud2
˘	˘	1 :
,
˘	˘	: ;
(
˙	˙	( )
decimal
˙	˙	) 0
)
˙	˙	0 1
route
˙	˙	1 6
.
˙	˙	6 7
latitud
˙	˙	7 >
,
˙	˙	> ?
(
˚	˚	( )
decimal
˚	˚	) 0
)
˚	˚	0 1
route
˚	˚	1 6
.
˚	˚	6 7
logintud
˚	˚	7 ?
)
˚	˚	? @
)
˚	˚	@ A
.
¸	¸	$ %
ToList
¸	¸	% +
(
¸	¸	+ ,
)
¸	¸	, -
;
¸	¸	- .
if
˝	˝	 
(
˝	˝	 

RouteOrder
˝	˝	 &
[
˝	˝	& '
$num
˝	˝	' (
]
˝	˝	( )
==
˝	˝	* ,
null
˝	˝	- 1
||
˝	˝	2 4
RouteOrder2
˝	˝	5 @
[
˝	˝	@ A
count
˝	˝	A F
]
˝	˝	F G
==
˝	˝	H J
null
˝	˝	K O
)
˝	˝	O P
{
˛	˛	 
return
ˇ	ˇ	 "
RedirectToAction
ˇ	ˇ	# 3
(
ˇ	ˇ	3 4
$str
ˇ	ˇ	4 D
,
ˇ	ˇ	D E
$str
ˇ	ˇ	F M
,
ˇ	ˇ	M N
new
ˇ	ˇ	O R
{
ˇ	ˇ	S T
numTypeRoute
ˇ	ˇ	U a
=
ˇ	ˇ	c d
numTypeRoute
ˇ	ˇ	e q
}
ˇ	ˇ	r s
)
ˇ	ˇ	s t
;
ˇ	ˇ	t u
}
Ä
Ä
 
if
Å
Å
 
(
Å
Å
 

RouteOrder
Å
Å
 &
[
Å
Å
& '
$num
Å
Å
' (
]
Å
Å
( )
.
Å
Å
) *
numPoint
Å
Å
* 2
>
Å
Å
3 4
RouteOrder2
Å
Å
5 @
[
Å
Å
@ A
count
Å
Å
A F
]
Å
Å
F G
.
Å
Å
G H
numPoint
Å
Å
H P
)
Å
Å
P Q
{
Ç
Ç
 
idInicio
É
É
 $
=
É
É
% &
int
É
É
' *
.
É
É
* +
Parse
É
É
+ 0
(
É
É
0 1
RouteOrder2
É
É
1 <
[
É
É
< =
count
É
É
= B
]
É
É
B C
.
É
É
C D
idRoute
É
É
D K
.
É
É
K L
ToString
É
É
L T
(
É
É
T U
)
É
É
U V
)
É
É
V W
;
É
É
W X
idFinal
Ñ
Ñ
 #
=
Ñ
Ñ
$ %
int
Ñ
Ñ
& )
.
Ñ
Ñ
) *
Parse
Ñ
Ñ
* /
(
Ñ
Ñ
/ 0

RouteOrder
Ñ
Ñ
0 :
[
Ñ
Ñ
: ;
$num
Ñ
Ñ
; <
]
Ñ
Ñ
< =
.
Ñ
Ñ
= >
idRoute
Ñ
Ñ
> E
.
Ñ
Ñ
E F
ToString
Ñ
Ñ
F N
(
Ñ
Ñ
N O
)
Ñ
Ñ
O P
)
Ñ
Ñ
P Q
;
Ñ
Ñ
Q R
}
Ö
Ö
 
else
Ü
Ü
 
{
á
á
 
idFinal
à
à
 #
=
à
à
$ %
int
à
à
& )
.
à
à
) *
Parse
à
à
* /
(
à
à
/ 0
RouteOrder2
à
à
0 ;
[
à
à
; <
count
à
à
< A
]
à
à
A B
.
à
à
B C
idRoute
à
à
C J
.
à
à
J K
ToString
à
à
K S
(
à
à
S T
)
à
à
T U
)
à
à
U V
;
à
à
V W
idInicio
â
â
 $
=
â
â
% &
int
â
â
' *
.
â
â
* +
Parse
â
â
+ 0
(
â
â
0 1

RouteOrder
â
â
1 ;
[
â
â
; <
$num
â
â
< =
]
â
â
= >
.
â
â
> ?
idRoute
â
â
? F
.
â
â
F G
ToString
â
â
G O
(
â
â
O P
)
â
â
P Q
)
â
â
Q R
;
â
â
R S
}
ä
ä
 
if
ã
ã
 
(
ã
ã
 
idInicio
ã
ã
 $
!=
ã
ã
% '
idFinal
ã
ã
( /
)
ã
ã
/ 0
verificacion
ã
ã
1 =
=
ã
ã
> ?
true
ã
ã
@ D
;
ã
ã
D E
count
å
å
 
++
å
å
 
;
å
å
  
}
ç
ç
 
using
é
é
 
(
é
é
 
dbModels
é
é
 #
context
é
é
$ +
=
é
é
, -
new
é
é
. 1
dbModels
é
é
2 :
(
é
é
: ;
)
é
é
; <
)
é
é
< =
{
è
è
 
DeviationRote
ê
ê
 %
deviationRoute
ê
ê
& 4
=
ê
ê
5 6
new
ê
ê
7 :
DeviationRote
ê
ê
; H
{
ë
ë
 
numberRoute
í
í
 '
=
í
í
( )
$num
í
í
* +
,
í
í
+ ,
idLine
ì
ì
 "
=
ì
ì
# $
Line
ì
ì
% )
,
ì
ì
) *
idRouteStart
î
î
 (
=
î
î
) *
idInicio
î
î
+ 3
,
î
î
3 4

idRouteEnd
ï
ï
 &
=
ï
ï
' (
idFinal
ï
ï
) 0
,
ï
ï
0 1
numTypeRoute
ñ
ñ
 (
=
ñ
ñ
) *
numTypeRoute
ñ
ñ
+ 7
}
ó
ó
 
;
ó
ó
 
context
ò
ò
 
.
ò
ò
  
DeviationRote
ò
ò
  -
.
ò
ò
- .
Add
ò
ò
. 1
(
ò
ò
1 2
deviationRoute
ò
ò
2 @
)
ò
ò
@ A
;
ò
ò
A B
context
ô
ô
 
.
ô
ô
  
SaveChanges
ô
ô
  +
(
ô
ô
+ ,
)
ô
ô
, -
;
ô
ô
- .
}
ö
ö
 
return
õ
õ
 
RedirectToAction
õ
õ
 +
(
õ
õ
+ ,
$str
õ
õ
, <
,
õ
õ
< =
$str
õ
õ
> E
,
õ
õ
E F
new
õ
õ
G J
{
õ
õ
K L
numTypeRoute
õ
õ
M Y
=
õ
õ
Z [
numTypeRoute
õ
õ
\ h
}
õ
õ
i j
)
õ
õ
j k
;
õ
õ
k l
}
ú
ú
 
else
ù
ù
 
return
ù
ù
 
RedirectToAction
ù
ù
 ,
(
ù
ù
, -
$str
ù
ù
- =
,
ù
ù
= >
$str
ù
ù
? F
,
ù
ù
F G
new
ù
ù
H K
{
ù
ù
L M
numTypeRoute
ù
ù
N Z
=
ù
ù
[ \
numTypeRoute
ù
ù
] i
}
ù
ù
j k
)
ù
ù
k l
;
ù
ù
l m
}
û
û
 
catch
ü
ü
 
(
ü
ü
 
	Exception
ü
ü
 
)
ü
ü
 
{
†
†
 
return
°
°
 
RedirectToAction
°
°
 '
(
°
°
' (
$str
°
°
( /
,
°
°
/ 0
$str
°
°
1 7
)
°
°
7 8
;
°
°
8 9
}
¢
¢
 
}
£
£
 	
public
§
§
 
ActionResult
§
§
 "
ReportRuta2Deviation
§
§
 0
(
§
§
0 1
int
§
§
1 4
numTypeRoute
§
§
5 A
)
§
§
A B
{
•
•
 	
try
¶
¶
 
{
ß
ß
 
Login
®
®
 
logi
®
®
 
=
®
®
 
new
®
®
  
Login
®
®
! &
(
®
®
& '
)
®
®
' (
;
®
®
( )
var
©
©
 

authResult
©
©
 
=
©
©
   
AutenticarPasosRol
©
©
! 3
(
©
©
3 4
$num
©
©
4 5
)
©
©
5 6
;
©
©
6 7
if
™
™
 
(
™
™
 

authResult
™
™
 
!=
™
™
 !
null
™
™
" &
)
™
™
& '
return
™
™
( .

authResult
™
™
/ 9
;
™
™
9 :
string
¨
¨
 
Line
¨
¨
 
=
¨
¨
 
logi
¨
¨
 "
.
¨
¨
" # 
GetLineaFromCookie
¨
¨
# 5
(
¨
¨
5 6
Request
¨
¨
6 =
)
¨
¨
= >
.
¨
¨
> ?
ToString
¨
¨
? G
(
¨
¨
G H
)
¨
¨
H I
;
¨
¨
I J
List
≠
≠
 
<
≠
≠
 
Route
≠
≠
 
>
≠
≠
 
	routesVer
≠
≠
 %
=
≠
≠
& '
new
≠
≠
( +
List
≠
≠
, 0
<
≠
≠
0 1
Route
≠
≠
1 6
>
≠
≠
6 7
(
≠
≠
7 8
)
≠
≠
8 9
;
≠
≠
9 :
using
Æ
Æ
 
(
Æ
Æ
 
dbModels
Æ
Æ
 
context
Æ
Æ
  '
=
Æ
Æ
( )
new
Æ
Æ
* -
dbModels
Æ
Æ
. 6
(
Æ
Æ
6 7
)
Æ
Æ
7 8
)
Æ
Æ
8 9
	routesVer
Ø
Ø
 
=
Ø
Ø
 
context
Ø
Ø
  '
.
Ø
Ø
' (
Route
Ø
Ø
( -
.
Ø
Ø
- .
Where
Ø
Ø
. 3
(
Ø
Ø
3 4
x
Ø
Ø
4 5
=>
Ø
Ø
6 8
x
Ø
Ø
9 :
.
Ø
Ø
: ;
numberRoute
Ø
Ø
; F
==
Ø
Ø
G I
$num
Ø
Ø
J K
&&
Ø
Ø
L N
x
Ø
Ø
O P
.
Ø
Ø
P Q
idLine
Ø
Ø
Q W
==
Ø
Ø
X Z
Line
Ø
Ø
[ _
&&
Ø
Ø
` b
x
Ø
Ø
c d
.
Ø
Ø
d e
numTypeRoute
Ø
Ø
e q
==
Ø
Ø
r t
numTypeRouteØ
Ø
u Å
)Ø
Ø
Å Ç
.Ø
Ø
Ç É
ToListØ
Ø
É â
(Ø
Ø
â ä
)Ø
Ø
ä ã
;Ø
Ø
ã å
if
∞
∞
 
(
∞
∞
 
	routesVer
∞
∞
 
.
∞
∞
 
Count
∞
∞
 #
<
∞
∞
$ %
$num
∞
∞
& '
)
∞
∞
' (
return
∞
∞
) /
RedirectToAction
∞
∞
0 @
(
∞
∞
@ A
$str
∞
∞
A Q
,
∞
∞
Q R
$str
∞
∞
S Z
,
∞
∞
Z [
new
∞
∞
\ _
{
∞
∞
` a
numTypeRoute
∞
∞
b n
=
∞
∞
o p
numTypeRoute
∞
∞
q }
}
∞
∞
~ 
)∞
∞
 Ä
;∞
∞
Ä Å
List
±
±
 
<
±
±
 
MuestraRutasMapas
±
±
 &
>
±
±
& '
mapa
±
±
( ,
=
±
±
- .
new
±
±
/ 2
List
±
±
3 7
<
±
±
7 8
MuestraRutasMapas
±
±
8 I
>
±
±
I J
(
±
±
J K
)
±
±
K L
;
±
±
L M
int
≤
≤
 
count
≤
≤
 
=
≤
≤
 
$num
≤
≤
 
;
≤
≤
 
for
≥
≥
 
(
≥
≥
 
int
≥
≥
 
i
≥
≥
 
=
≥
≥
 
$num
≥
≥
 
;
≥
≥
 
i
≥
≥
  !
<=
≥
≥
" $
$num
≥
≥
% &
;
≥
≥
& '
i
≥
≥
( )
++
≥
≥
) +
)
≥
≥
+ ,
{
¥
¥
 
MuestraRutasMapas
µ
µ
 %
muestraRutasMapas
µ
µ
& 7
=
µ
µ
8 9
new
µ
µ
: =
MuestraRutasMapas
µ
µ
> O
{
∂
∂
 
ListRutasMostrar
∑
∑
 (
=
∑
∑
) *
new
∑
∑
+ .
List
∑
∑
/ 3
<
∑
∑
3 4
RutasMostrar
∑
∑
4 @
>
∑
∑
@ A
(
∑
∑
A B
)
∑
∑
B C
,
∑
∑
C D 
ListParadasMostrar
∏
∏
 *
=
∏
∏
+ ,
new
∏
∏
- 0
List
∏
∏
1 5
<
∏
∏
5 6
ParadasMostrar
∏
∏
6 D
>
∏
∏
D E
(
∏
∏
E F
)
∏
∏
F G
,
∏
∏
G H!
ListBloqueosMostrar
π
π
 +
=
π
π
, -
new
π
π
. 1
List
π
π
2 6
<
π
π
6 7
BloqueosMostrar
π
π
7 F
>
π
π
F G
(
π
π
G H
)
π
π
H I
,
π
π
I J

NumeroRuta
∫
∫
 "
=
∫
∫
# $
i
∫
∫
% &
}
ª
ª
 
;
ª
ª
 
List
º
º
 
<
º
º
 
BloqueosMostrar
º
º
 (
>
º
º
( )
nuevosBloqueos
º
º
* 8
=
º
º
9 :
new
º
º
; >
List
º
º
? C
<
º
º
C D
BloqueosMostrar
º
º
D S
>
º
º
S T
(
º
º
T U
)
º
º
U V
;
º
º
V W
List
Ω
Ω
 
<
Ω
Ω
 
RutasMostrar
Ω
Ω
 %
>
Ω
Ω
% &
nuevasRutas
Ω
Ω
' 2
=
Ω
Ω
3 4
new
Ω
Ω
5 8
List
Ω
Ω
9 =
<
Ω
Ω
= >
RutasMostrar
Ω
Ω
> J
>
Ω
Ω
J K
(
Ω
Ω
K L
)
Ω
Ω
L M
;
Ω
Ω
M N
List
æ
æ
 
<
æ
æ
 
ParadasMostrar
æ
æ
 '
>
æ
æ
' (
nuevasParadas
æ
æ
) 6
=
æ
æ
7 8
new
æ
æ
9 <
List
æ
æ
= A
<
æ
æ
A B
ParadasMostrar
æ
æ
B P
>
æ
æ
P Q
(
æ
æ
Q R
)
æ
æ
R S
;
æ
æ
S T
using
¿
¿
 
(
¿
¿
 
dbModels
¿
¿
 #
context
¿
¿
$ +
=
¿
¿
, -
new
¿
¿
. 1
dbModels
¿
¿
2 :
(
¿
¿
: ;
)
¿
¿
; <
)
¿
¿
< =
{
¡
¡
 
var
¬
¬
 
checkpoints
¬
¬
 '
=
¬
¬
( )
context
¬
¬
* 1
.
¬
¬
1 2

Checkpoint
¬
¬
2 <
.
¬
¬
< =
Where
¬
¬
= B
(
¬
¬
B C
x
¬
¬
C D
=>
¬
¬
E G
x
¬
¬
H I
.
¬
¬
I J
idLine
¬
¬
J P
==
¬
¬
Q S
Line
¬
¬
T X
&&
¬
¬
Y [
x
¬
¬
\ ]
.
¬
¬
] ^
status
¬
¬
^ d
!=
¬
¬
e g
$num
¬
¬
h i
&&
¬
¬
j l
x
¬
¬
m n
.
¬
¬
n o
numberRoute
¬
¬
o z
==
¬
¬
{ }
numTypeRoute¬
¬
~ ä
)¬
¬
ä ã
.¬
¬
ã å
ToList¬
¬
å í
(¬
¬
í ì
)¬
¬
ì î
;¬
¬
î ï
var
√
√
 
routes
√
√
 "
=
√
√
# $
context
√
√
% ,
.
√
√
, -
Route
√
√
- 2
.
ƒ
ƒ
 
Where
ƒ
ƒ
 "
(
ƒ
ƒ
" #
x
ƒ
ƒ
# $
=>
ƒ
ƒ
% '
x
ƒ
ƒ
( )
.
ƒ
ƒ
) *
idLine
ƒ
ƒ
* 0
==
ƒ
ƒ
1 3
Line
ƒ
ƒ
4 8
&&
ƒ
ƒ
9 ;
x
ƒ
ƒ
< =
.
ƒ
ƒ
= >
numberRoute
ƒ
ƒ
> I
==
ƒ
ƒ
J L
i
ƒ
ƒ
M N
&&
ƒ
ƒ
O Q
x
ƒ
ƒ
R S
.
ƒ
ƒ
S T
numTypeRoute
ƒ
ƒ
T `
==
ƒ
ƒ
a c
numTypeRoute
ƒ
ƒ
d p
)
ƒ
ƒ
p q
.
≈
≈
 
ToList
≈
≈
 #
(
≈
≈
# $
)
≈
≈
$ %
;
≈
≈
% &
var
∆
∆
 
	deviation
∆
∆
 %
=
∆
∆
& '
context
∆
∆
( /
.
∆
∆
/ 0
DeviationRote
∆
∆
0 =
.
∆
∆
= >
Where
∆
∆
> C
(
∆
∆
C D
x
∆
∆
D E
=>
∆
∆
F H
x
∆
∆
I J
.
∆
∆
J K
idLine
∆
∆
K Q
==
∆
∆
R T
Line
∆
∆
U Y
&&
∆
∆
Z \
x
∆
∆
] ^
.
∆
∆
^ _
numberRoute
∆
∆
_ j
==
∆
∆
k m
i
∆
∆
n o
&&
∆
∆
p r
x
∆
∆
s t
.
∆
∆
t u
idLine
∆
∆
u {
==
∆
∆
| ~
Line∆
∆
 É
&&∆
∆
Ñ Ü
x∆
∆
á à
.∆
∆
à â
numTypeRoute∆
∆
â ï
==∆
∆
ñ ò
numTypeRoute∆
∆
ô •
)∆
∆
• ¶
.∆
∆
¶ ß
ToList∆
∆
ß ≠
(∆
∆
≠ Æ
)∆
∆
Æ Ø
;∆
∆
Ø ∞
if
«
«
 
(
«
«
 
	deviation
«
«
 %
.
«
«
% &
Count
«
«
& +
>
«
«
, -
$num
«
«
. /
)
«
«
/ 0
{
»
»
 
foreach
…
…
 #
(
…
…
$ %
var
…
…
% (
item
…
…
) -
in
…
…
. 0
	deviation
…
…
1 :
)
…
…
: ;
{
 
 
 
List
À
À
  $
<
À
À
$ %
RutasMostrar
À
À
% 1
>
À
À
1 2
listBloqueos
À
À
3 ?
=
À
À
@ A
new
À
À
B E
List
À
À
F J
<
À
À
J K
RutasMostrar
À
À
K W
>
À
À
W X
(
À
À
X Y
)
À
À
Y Z
;
À
À
Z [
var
Ã
Ã
  #
route1
Ã
Ã
$ *
=
Ã
Ã
+ ,
routes
Ã
Ã
- 3
.
Ã
Ã
3 4
Where
Ã
Ã
4 9
(
Ã
Ã
9 :
x
Ã
Ã
: ;
=>
Ã
Ã
< >
x
Ã
Ã
? @
.
Ã
Ã
@ A
idRoute
Ã
Ã
A H
==
Ã
Ã
I K
item
Ã
Ã
L P
.
Ã
Ã
P Q
idRouteStart
Ã
Ã
Q ]
&&
Ã
Ã
^ `
x
Ã
Ã
a b
.
Ã
Ã
b c
idLine
Ã
Ã
c i
==
Ã
Ã
j l
Line
Ã
Ã
m q
)
Ã
Ã
q r
.
Ã
Ã
r s
FirstOrDefaultÃ
Ã
s Å
(Ã
Ã
Å Ç
)Ã
Ã
Ç É
;Ã
Ã
É Ñ
var
Õ
Õ
  #
route2
Õ
Õ
$ *
=
Õ
Õ
+ ,
routes
Õ
Õ
- 3
.
Õ
Õ
3 4
Where
Õ
Õ
4 9
(
Õ
Õ
9 :
x
Õ
Õ
: ;
=>
Õ
Õ
< >
x
Õ
Õ
? @
.
Õ
Õ
@ A
idRoute
Õ
Õ
A H
==
Õ
Õ
I K
item
Õ
Õ
L P
.
Õ
Õ
P Q

idRouteEnd
Õ
Õ
Q [
&&
Õ
Õ
\ ^
x
Õ
Õ
_ `
.
Õ
Õ
` a
idLine
Õ
Õ
a g
==
Õ
Õ
h j
Line
Õ
Õ
k o
)
Õ
Õ
o p
.
Õ
Õ
p q
FirstOrDefault
Õ
Õ
q 
(Õ
Õ
 Ä
)Õ
Õ
Ä Å
;Õ
Õ
Å Ç
if
Œ
Œ
  "
(
Œ
Œ
# $
route1
Œ
Œ
$ *
!=
Œ
Œ
+ -
null
Œ
Œ
. 2
&&
Œ
Œ
3 5
route2
Œ
Œ
6 <
!=
Œ
Œ
= ?
null
Œ
Œ
@ D
)
Œ
Œ
D E
{
œ
œ
  !
var
–
–
$ '
routesDeviation
–
–
( 7
=
–
–
8 9
routes
–
–
: @
.
–
–
@ A
Where
–
–
A F
(
–
–
F G
x
–
–
G H
=>
–
–
I K
x
–
–
L M
.
–
–
M N
numPoint
–
–
N V
>=
–
–
W Y
route1
–
–
Z `
.
–
–
` a
numPoint
–
–
a i
&&
–
–
j l
x
–
–
m n
.
–
–
n o
numPoint
–
–
o w
<=
–
–
x z
route2–
–
{ Å
.–
–
Å Ç
numPoint–
–
Ç ä
&&–
–
ã ç
x–
–
é è
.–
–
è ê
idLine–
–
ê ñ
==–
–
ó ô
Line–
–
ö û
)–
–
û ü
.–
–
ü †
ToList–
–
† ¶
(–
–
¶ ß
)–
–
ß ®
;–
–
® ©
foreach
—
—
$ +
(
—
—
, -
var
—
—
- 0
item2
—
—
1 6
in
—
—
7 9
routesDeviation
—
—
: I
)
—
—
I J
{
“
“
$ %
listBloqueos
”
”
( 4
.
”
”
4 5
Add
”
”
5 8
(
”
”
8 9
new
”
”
9 <
RutasMostrar
”
”
= I
(
”
”
I J
item2
”
”
J O
.
”
”
O P
idRoute
”
”
P W
,
”
”
W X
item2
”
”
Y ^
.
”
”
^ _
latitud
”
”
_ f
,
”
”
f g
item2
”
”
h m
.
”
”
m n
logintud
”
”
n v
,
”
”
v w
$str
”
”
x z
,
”
”
z {
item2”
”
| Å
.”
”
Å Ç
status”
”
Ç à
,”
”
à â
(”
”
ä ã
int”
”
ã é
)”
”
é è
item2”
”
è î
.”
”
î ï
numPoint”
”
ï ù
)”
”
ù û
)”
”
û ü
;”
”
ü †
}
‘
‘
$ %
var
’
’
$ '
place1
’
’
( .
=
’
’
/ 0
context
’
’
1 8
.
’
’
8 9
Place
’
’
9 >
.
’
’
> ?
Where
’
’
? D
(
’
’
D E
x
’
’
E F
=>
’
’
G I
x
’
’
J K
.
’
’
K L
idPlace
’
’
L S
==
’
’
T V
route1
’
’
W ]
.
’
’
] ^
idPlace
’
’
^ e
)
’
’
e f
.
’
’
f g
FirstOrDefault
’
’
g u
(
’
’
u v
)
’
’
v w
;
’
’
w x
var
÷
÷
$ '
place2
÷
÷
( .
=
÷
÷
/ 0
context
÷
÷
1 8
.
÷
÷
8 9
Place
÷
÷
9 >
.
÷
÷
> ?
Where
÷
÷
? D
(
÷
÷
D E
x
÷
÷
E F
=>
÷
÷
G I
x
÷
÷
J K
.
÷
÷
K L
idPlace
÷
÷
L S
==
÷
÷
T V
route2
÷
÷
W ]
.
÷
÷
] ^
idPlace
÷
÷
^ e
)
÷
÷
e f
.
÷
÷
f g
FirstOrDefault
÷
÷
g u
(
÷
÷
u v
)
÷
÷
v w
;
÷
÷
w x
nuevosBloqueos
◊
◊
$ 2
.
◊
◊
2 3
Add
◊
◊
3 6
(
◊
◊
6 7
new
◊
◊
7 :
BloqueosMostrar
◊
◊
; J
(
◊
◊
J K
item
◊
◊
K O
.
◊
◊
O P
idDeviation
◊
◊
P [
,
◊
◊
[ \
$str
◊
◊
] f
+
◊
◊
g h
place1
◊
◊
i o
.
◊
◊
o p
description
◊
◊
p {
+
◊
◊
| }
$str◊
◊
~ É
+◊
◊
Ñ Ö
place2◊
◊
Ü å
.◊
◊
å ç
description◊
◊
ç ò
,◊
◊
ò ô
listBloqueos◊
◊
ö ¶
,◊
◊
¶ ß
(◊
◊
® ©
double◊
◊
© Ø
)◊
◊
Ø ∞
route1◊
◊
∞ ∂
.◊
◊
∂ ∑
latitud◊
◊
∑ æ
,◊
◊
æ ø
(◊
◊
¿ ¡
double◊
◊
¡ «
)◊
◊
« »
route2◊
◊
» Œ
.◊
◊
Œ œ
logintud◊
◊
œ ◊
)◊
◊
◊ ÿ
)◊
◊
ÿ Ÿ
;◊
◊
Ÿ ⁄
}
ÿ
ÿ
  !
}
Ÿ
Ÿ
 
}
⁄
⁄
 
if
€
€
 
(
€
€
 
routes
€
€
 "
.
€
€
" #
Count
€
€
# (
>
€
€
) *
$num
€
€
+ ,
)
€
€
, -
{
‹
‹
 
count
›
›
 !
=
›
›
" #
$num
›
›
$ %
;
›
›
% &
foreach
ﬁ
ﬁ
 #
(
ﬁ
ﬁ
$ %
var
ﬁ
ﬁ
% (
item
ﬁ
ﬁ
) -
in
ﬁ
ﬁ
. 0
routes
ﬁ
ﬁ
1 7
)
ﬁ
ﬁ
7 8
{
ﬂ
ﬂ
 
count
‡
‡
  %
++
‡
‡
% '
;
‡
‡
' (
Place
·
·
  %
place
·
·
& +
=
·
·
, -
context
·
·
. 5
.
·
·
5 6
Place
·
·
6 ;
.
·
·
; <
FirstOrDefault
·
·
< J
(
·
·
J K
x
·
·
K L
=>
·
·
M O
x
·
·
P Q
.
·
·
Q R
idPlace
·
·
R Y
==
·
·
Z \
item
·
·
] a
.
·
·
a b
idPlace
·
·
b i
)
·
·
i j
;
·
·
j k
if
‚
‚
  "
(
‚
‚
# $
place
‚
‚
$ )
!=
‚
‚
* ,
null
‚
‚
- 1
)
‚
‚
1 2
{
„
„
  !
nuevasRutas
‰
‰
$ /
.
‰
‰
/ 0
Add
‰
‰
0 3
(
‰
‰
3 4
new
‰
‰
4 7
RutasMostrar
‰
‰
8 D
(
‰
‰
D E
item
‰
‰
E I
.
‰
‰
I J
idRoute
‰
‰
J Q
,
‰
‰
Q R
item
‰
‰
S W
.
‰
‰
W X
latitud
‰
‰
X _
,
‰
‰
_ `
item
‰
‰
a e
.
‰
‰
e f
logintud
‰
‰
f n
,
‰
‰
n o
place
‰
‰
p u
.
‰
‰
u v
description‰
‰
v Å
,‰
‰
Å Ç
item‰
‰
É á
.‰
‰
á à
status‰
‰
à é
,‰
‰
é è
(‰
‰
ê ë
int‰
‰
ë î
)‰
‰
î ï
item‰
‰
ï ô
.‰
‰
ô ö
numPoint‰
‰
ö ¢
)‰
‰
¢ £
)‰
‰
£ §
;‰
‰
§ •
}
Â
Â
  !
}
Ê
Ê
 
if
Ë
Ë
 
(
Ë
Ë
  
nuevasRutas
Ë
Ë
  +
.
Ë
Ë
+ ,
Any
Ë
Ë
, /
(
Ë
Ë
/ 0
)
Ë
Ë
0 1
)
Ë
Ë
1 2
{
È
È
 
RutasMostrar
Í
Í
  ,
primeraRuta
Í
Í
- 8
=
Í
Í
9 :
nuevasRutas
Í
Í
; F
.
Í
Í
F G
FirstOrDefault
Í
Í
G U
(
Í
Í
U V
r
Í
Í
V W
=>
Í
Í
X Z
r
Í
Í
[ \
.
Í
Í
\ ]
status
Í
Í
] c
==
Í
Í
d f
$num
Í
Í
g h
)
Í
Í
h i
;
Í
Í
i j
if
Î
Î
  "
(
Î
Î
# $
primeraRuta
Î
Î
$ /
!=
Î
Î
0 2
null
Î
Î
3 7
)
Î
Î
7 8
{
Ï
Ï
  !
nuevasRutas
Ì
Ì
$ /
=
Ì
Ì
0 1
nuevasRutas
Ì
Ì
2 =
.
Ó
Ó
( )
OrderBy
Ó
Ó
) 0
(
Ó
Ó
0 1
route
Ó
Ó
1 6
=>
Ó
Ó
7 9
route
Ó
Ó
: ?
.
Ó
Ó
? @
numPoint
Ó
Ó
@ H
)
Ó
Ó
H I
.
Ô
Ô
( )
ToList
Ô
Ô
) /
(
Ô
Ô
/ 0
)
Ô
Ô
0 1
;
Ô
Ô
1 2
}


  !
}
Ò
Ò
 
count
Ú
Ú
 !
=
Ú
Ú
" #
$num
Ú
Ú
$ %
;
Ú
Ú
% &
foreach
Û
Û
 #
(
Û
Û
$ %
var
Û
Û
% (
item
Û
Û
) -
in
Û
Û
. 0
nuevasRutas
Û
Û
1 <
)
Û
Û
< =
{
Ù
Ù
 
item
ı
ı
  $
.
ı
ı
$ %
name
ı
ı
% )
=
ı
ı
* +
item
ı
ı
, 0
.
ı
ı
0 1
name
ı
ı
1 5
+
ı
ı
6 7
$str
ı
ı
8 ;
+
ı
ı
< =
count
ı
ı
> C
;
ı
ı
C D
count
ˆ
ˆ
  %
++
ˆ
ˆ
% '
;
ˆ
ˆ
' (
}
˜
˜
 
}
¯
¯
 
if
˙
˙
 
(
˙
˙
 
checkpoints
˙
˙
 '
.
˙
˙
' (
Count
˙
˙
( -
>
˙
˙
. /
$num
˙
˙
0 1
)
˙
˙
1 2
{
˚
˚
 
count
¸
¸
 !
=
¸
¸
" #
$num
¸
¸
$ %
;
¸
¸
% &
foreach
˝
˝
 #
(
˝
˝
$ %
var
˝
˝
% (
item
˝
˝
) -
in
˝
˝
. 0
checkpoints
˝
˝
1 <
)
˝
˝
< =
{
˛
˛
 
count
ˇ
ˇ
  %
++
ˇ
ˇ
% '
;
ˇ
ˇ
' (
nuevasParadas
ÄÄ  -
.
ÄÄ- .
Add
ÄÄ. 1
(
ÄÄ1 2
new
ÄÄ2 5
ParadasMostrar
ÄÄ6 D
(
ÄÄD E
item
ÄÄE I
.
ÄÄI J
idCheckpoint
ÄÄJ V
,
ÄÄV W
item
ÄÄX \
.
ÄÄ\ ]
description
ÄÄ] h
,
ÄÄh i
item
ÄÄj n
.
ÄÄn o
status
ÄÄo u
,
ÄÄu v
item
ÄÄw {
.
ÄÄ{ |
latitudÄÄ| É
,ÄÄÉ Ñ
itemÄÄÖ â
.ÄÄâ ä
longitudÄÄä í
)ÄÄí ì
)ÄÄì î
;ÄÄî ï
}
ÅÅ 
if
ÉÉ 
(
ÉÉ  
nuevasParadas
ÉÉ  -
.
ÉÉ- .
Any
ÉÉ. 1
(
ÉÉ1 2
)
ÉÉ2 3
)
ÉÉ3 4
{
ÑÑ 
ParadasMostrar
ÖÖ  .
primeraParada
ÖÖ/ <
=
ÖÖ= >
nuevasParadas
ÖÖ? L
.
ÖÖL M
FirstOrDefault
ÖÖM [
(
ÖÖ[ \
r
ÖÖ\ ]
=>
ÖÖ^ `
r
ÖÖa b
.
ÖÖb c
status
ÖÖc i
==
ÖÖj l
$num
ÖÖm n
)
ÖÖn o
;
ÖÖo p
if
ÜÜ  "
(
ÜÜ# $
primeraParada
ÜÜ$ 1
!=
ÜÜ2 4
null
ÜÜ5 9
)
ÜÜ9 :
{
áá  !
nuevasParadas
àà$ 1
=
àà2 3
nuevasParadas
àà4 A
.
ââ( )
OrderBy
ââ) 0
(
ââ0 1
route
ââ1 6
=>
ââ7 9
muestraRutasMapas
ââ: K
.
ââK L(
CalcularDistanciaHaversine
ââL f
(
ââf g
(
ää, -
decimal
ää- 4
)
ää4 5
primeraParada
ää5 B
.
ääB C
latitud
ääC J
,
ääJ K
(
ãã, -
decimal
ãã- 4
)
ãã4 5
primeraParada
ãã5 B
.
ããB C
longitud
ããC K
,
ããK L
route
åå, 1
.
åå1 2
latitud
åå2 9
,
åå9 :
route
çç, 1
.
çç1 2
longitud
çç2 :
)
çç: ;
)
çç; <
.
éé( )
ToList
éé) /
(
éé/ 0
)
éé0 1
;
éé1 2
}
èè  !
}
êê 
count
ëë !
=
ëë" #
$num
ëë$ %
;
ëë% &
foreach
íí #
(
íí$ %
var
íí% (
item
íí) -
in
íí. 0
nuevasParadas
íí1 >
)
íí> ?
{
ìì 
item
îî  $
.
îî$ %
description
îî% 0
=
îî1 2
item
îî3 7
.
îî7 8
description
îî8 C
+
îîD E
$str
îîF I
+
îîJ K
count
îîL Q
;
îîQ R
count
ïï  %
++
ïï% '
;
ïï' (
}
ññ 
}
óó 
}
òò 
muestraRutasMapas
ôô %
.
ôô% &
ListRutasMostrar
ôô& 6
=
ôô7 8
nuevasRutas
ôô9 D
;
ôôD E
muestraRutasMapas
öö %
.
öö% & 
ListParadasMostrar
öö& 8
=
öö9 :
nuevasParadas
öö; H
;
ööH I
muestraRutasMapas
õõ %
.
õõ% &!
ListBloqueosMostrar
õõ& 9
=
õõ: ;
nuevosBloqueos
õõ< J
;
õõJ K
ViewBag
úú 
.
úú 
numTypeRoute
úú (
=
úú) *
numTypeRoute
úú+ 7
;
úú7 8
mapa
ùù 
.
ùù 
Add
ùù 
(
ùù 
muestraRutasMapas
ùù .
)
ùù. /
;
ùù/ 0
}
ûû 
return
†† 
View
†† 
(
†† 
mapa
††  
)
††  !
;
††! "
}
°° 
catch
¢¢ 
(
¢¢ 
	Exception
¢¢ 
)
¢¢ 
{
££ 
return
§§ 
RedirectToAction
§§ '
(
§§' (
$str
§§( /
,
§§/ 0
$str
§§1 7
)
§§7 8
;
§§8 9
}
•• 
}
¶¶ 	
[
ßß 	
HttpPost
ßß	 
]
ßß 
public
®® 
ActionResult
®® "
ReportRuta2Deviation
®® 0
(
®®0 1
string
®®1 7
ubicaciones
®®8 C
,
®®C D
int
®®E H
numTypeRoute
®®I U
)
®®U V
{
©© 	
try
™™ 
{
´´ 
Login
¨¨ 
logi
¨¨ 
=
¨¨ 
new
¨¨  
Login
¨¨! &
(
¨¨& '
)
¨¨' (
;
¨¨( )
var
≠≠ 

authResult
≠≠ 
=
≠≠   
AutenticarPasosRol
≠≠! 3
(
≠≠3 4
$num
≠≠4 5
)
≠≠5 6
;
≠≠6 7
if
ÆÆ 
(
ÆÆ 

authResult
ÆÆ 
!=
ÆÆ !
null
ÆÆ" &
)
ÆÆ& '
return
ÆÆ( .

authResult
ÆÆ/ 9
;
ÆÆ9 :
string
ØØ 
Line
ØØ 
=
ØØ 
logi
ØØ "
.
ØØ" # 
GetLineaFromCookie
ØØ# 5
(
ØØ5 6
Request
ØØ6 =
)
ØØ= >
.
ØØ> ?
ToString
ØØ? G
(
ØØG H
)
ØØH I
;
ØØI J
List
∞∞ 
<
∞∞ 
Route
∞∞ 
>
∞∞ 
	routesVer
∞∞ %
=
∞∞& '
new
∞∞( +
List
∞∞, 0
<
∞∞0 1
Route
∞∞1 6
>
∞∞6 7
(
∞∞7 8
)
∞∞8 9
;
∞∞9 :
using
±± 
(
±± 
dbModels
±± 
context
±±  '
=
±±( )
new
±±* -
dbModels
±±. 6
(
±±6 7
)
±±7 8
)
±±8 9
	routesVer
≤≤ 
=
≤≤ 
context
≤≤  '
.
≤≤' (
Route
≤≤( -
.
≤≤- .
Where
≤≤. 3
(
≤≤3 4
x
≤≤4 5
=>
≤≤6 8
x
≤≤9 :
.
≤≤: ;
numberRoute
≤≤; F
==
≤≤G I
$num
≤≤J K
&&
≤≤L N
x
≤≤O P
.
≤≤P Q
idLine
≤≤Q W
==
≤≤X Z
Line
≤≤[ _
&&
≤≤` b
x
≤≤c d
.
≤≤d e
numTypeRoute
≤≤e q
==
≤≤r t
numTypeRoute≤≤u Å
)≤≤Å Ç
.≤≤Ç É
ToList≤≤É â
(≤≤â ä
)≤≤ä ã
;≤≤ã å
if
≥≥ 
(
≥≥ 
	routesVer
≥≥ 
.
≥≥ 
Count
≥≥ "
<
≥≥" #
$num
≥≥# $
)
≥≥$ %
return
≥≥& ,
RedirectToAction
≥≥- =
(
≥≥= >
$str
≥≥> N
,
≥≥N O
$str
≥≥P W
,
≥≥W X
new
≥≥Y \
{
≥≥] ^
numTypeRoute
≥≥_ k
=
≥≥l m
numTypeRoute
≥≥n z
}
≥≥{ |
)
≥≥| }
;
≥≥} ~
string
¥¥ 
[
¥¥ 
]
¥¥  
ubicacionesConvert
¥¥ +
=
¥¥, -
ubicaciones
¥¥. 9
.
¥¥9 :
Split
¥¥: ?
(
¥¥? @
new
¥¥@ C
[
¥¥C D
]
¥¥D E
{
¥¥F G
$char
¥¥H L
}
¥¥M N
,
¥¥N O 
StringSplitOptions
¥¥P b
.
¥¥b c 
RemoveEmptyEntries
¥¥c u
)
¥¥u v
;
¥¥v w
if
∂∂ 
(
∂∂  
ubicacionesConvert
∂∂ &
.
∂∂& '
Length
∂∂' -
==
∂∂. 0
$num
∂∂1 2
)
∂∂2 3
{
∑∑ 
string
ππ 
[
ππ 
]
ππ 
primeraUbicacion
ππ -
=
ππ. / 
ubicacionesConvert
ππ0 B
[
ππB C
$num
ππC D
]
ππD E
.
ππE F
Split
ππF K
(
ππK L
$char
ππL O
)
ππO P
;
ππP Q
decimal
∫∫ 
latitud1
∫∫ $
=
∫∫% &
Convert
∫∫' .
.
∫∫. /
	ToDecimal
∫∫/ 8
(
∫∫8 9
primeraUbicacion
∫∫9 I
[
∫∫I J
$num
∫∫J K
]
∫∫K L
,
∫∫L M
System
∫∫N T
.
∫∫T U
Globalization
∫∫U b
.
∫∫b c
CultureInfo
∫∫c n
.
∫∫n o
InvariantCulture
∫∫o 
)∫∫ Ä
;∫∫Ä Å
decimal
ªª 
	longitud1
ªª %
=
ªª& '
Convert
ªª( /
.
ªª/ 0
	ToDecimal
ªª0 9
(
ªª9 :
primeraUbicacion
ªª: J
[
ªªJ K
$num
ªªK L
]
ªªL M
,
ªªM N
System
ªªO U
.
ªªU V
Globalization
ªªV c
.
ªªc d
CultureInfo
ªªd o
.
ªªo p
InvariantCultureªªp Ä
)ªªÄ Å
;ªªÅ Ç
string
ææ 
[
ææ 
]
ææ 
segundaUbicacion
ææ -
=
ææ. / 
ubicacionesConvert
ææ0 B
[
ææB C
$num
ææC D
]
ææD E
.
ææE F
Split
ææF K
(
ææK L
$char
ææL O
)
ææO P
;
ææP Q
decimal
øø 
latitud2
øø $
=
øø% &
Convert
øø' .
.
øø. /
	ToDecimal
øø/ 8
(
øø8 9
segundaUbicacion
øø9 I
[
øøI J
$num
øøJ K
]
øøK L
,
øøL M
System
øøN T
.
øøT U
Globalization
øøU b
.
øøb c
CultureInfo
øøc n
.
øøn o
InvariantCulture
øøo 
)øø Ä
;øøÄ Å
decimal
¿¿ 
	longitud2
¿¿ %
=
¿¿& '
Convert
¿¿( /
.
¿¿/ 0
	ToDecimal
¿¿0 9
(
¿¿9 :
segundaUbicacion
¿¿: J
[
¿¿J K
$num
¿¿K L
]
¿¿L M
,
¿¿M N
System
¿¿O U
.
¿¿U V
Globalization
¿¿V c
.
¿¿c d
CultureInfo
¿¿d o
.
¿¿o p
InvariantCulture¿¿p Ä
)¿¿Ä Å
;¿¿Å Ç
List
¬¬ 
<
¬¬ 
Route
¬¬ 
>
¬¬ 
	RouteList
¬¬  )
=
¬¬* +
new
¬¬, /
List
¬¬0 4
<
¬¬4 5
Route
¬¬5 :
>
¬¬: ;
(
¬¬; <
)
¬¬< =
;
¬¬= >
List
¬¬? C
<
¬¬C D
Route
¬¬D I
>
¬¬I J

RouteOrder
¬¬K U
=
¬¬V W
new
¬¬X [
List
¬¬\ `
<
¬¬` a
Route
¬¬a f
>
¬¬f g
(
¬¬g h
)
¬¬h i
;
¬¬i j
List
¬¬k o
<
¬¬o p
Route
¬¬p u
>
¬¬u v
RouteOrder2¬¬w Ç
=¬¬É Ñ
new¬¬Ö à
List¬¬â ç
<¬¬ç é
Route¬¬é ì
>¬¬ì î
(¬¬î ï
)¬¬ï ñ
;¬¬ñ ó
MuestraRutasMapas
√√ %
muestraRutasMapas
√√& 7
=
√√8 9
new
√√: =
MuestraRutasMapas
√√> O
(
√√O P
)
√√P Q
;
√√Q R
using
ƒƒ 
(
ƒƒ 
dbModels
ƒƒ #
context
ƒƒ$ +
=
ƒƒ, -
new
ƒƒ. 1
dbModels
ƒƒ2 :
(
ƒƒ: ;
)
ƒƒ; <
)
ƒƒ< =
	RouteList
ƒƒ> G
=
ƒƒH I
context
ƒƒJ Q
.
ƒƒQ R
Route
ƒƒR W
.
ƒƒW X
Where
ƒƒX ]
(
ƒƒ] ^
x
ƒƒ^ _
=>
ƒƒ` b
x
ƒƒc d
.
ƒƒd e
idLine
ƒƒe k
==
ƒƒl n
Line
ƒƒo s
&&
ƒƒt v
x
ƒƒw x
.
ƒƒx y
numberRouteƒƒy Ñ
==ƒƒÖ á
$numƒƒà â
&&ƒƒä å
xƒƒç é
.ƒƒé è
statusƒƒè ï
!=ƒƒñ ò
$numƒƒô ö
&&ƒƒõ ù
xƒƒû ü
.ƒƒü †
numTypeRouteƒƒ† ¨
==ƒƒ≠ Ø
numTypeRouteƒƒ∞ º
)ƒƒº Ω
.ƒƒΩ æ
ToListƒƒæ ƒ
(ƒƒƒ ≈
)ƒƒ≈ ∆
;ƒƒ∆ «
List
≈≈ 
<
≈≈ 
Route
≈≈ 
>
≈≈ 

RouteList2
≈≈  *
=
≈≈+ ,
	RouteList
≈≈- 6
;
≈≈6 7
int
∆∆ 
idInicio
∆∆  
=
∆∆! "
$num
∆∆# $
;
∆∆$ %
int
∆∆& )
idFinal
∆∆* 1
=
∆∆2 3
$num
∆∆4 5
;
∆∆5 6
bool
∆∆7 ;
verificacion
∆∆< H
=
∆∆I J
false
∆∆K P
;
∆∆P Q
int
∆∆R U
count
∆∆V [
=
∆∆\ ]
$num
∆∆^ _
;
∆∆_ `
while
«« 
(
«« 
verificacion
«« '
==
««( *
false
««+ 0
)
««0 1
{
»» 

RouteOrder
…… "
=
……# $
	RouteList
……% .
.
  $ %
OrderBy
  % ,
(
  , -
route
  - 2
=>
  3 5
muestraRutasMapas
  6 G
.
  G H(
CalcularDistanciaHaversine
  H b
(
  b c
(
ÀÀ( )
decimal
ÀÀ) 0
)
ÀÀ0 1
latitud1
ÀÀ1 9
,
ÀÀ9 :
(
ÃÃ( )
decimal
ÃÃ) 0
)
ÃÃ0 1
	longitud1
ÃÃ1 :
,
ÃÃ: ;
(
ÕÕ( )
decimal
ÕÕ) 0
)
ÕÕ0 1
route
ÕÕ1 6
.
ÕÕ6 7
latitud
ÕÕ7 >
,
ÕÕ> ?
(
ŒŒ( )
decimal
ŒŒ) 0
)
ŒŒ0 1
route
ŒŒ1 6
.
ŒŒ6 7
logintud
ŒŒ7 ?
)
ŒŒ? @
)
ŒŒ@ A
.
œœ$ %
ToList
œœ% +
(
œœ+ ,
)
œœ, -
;
œœ- .
RouteOrder2
–– #
=
––$ %

RouteList2
––& 0
.
——$ %
OrderBy
——% ,
(
——, -
route
——- 2
=>
——3 5
muestraRutasMapas
——6 G
.
——G H(
CalcularDistanciaHaversine
——H b
(
——b c
(
““( )
decimal
““) 0
)
““0 1
latitud2
““1 9
,
““9 :
(
””( )
decimal
””) 0
)
””0 1
	longitud2
””1 :
,
””: ;
(
‘‘( )
decimal
‘‘) 0
)
‘‘0 1
route
‘‘1 6
.
‘‘6 7
latitud
‘‘7 >
,
‘‘> ?
(
’’( )
decimal
’’) 0
)
’’0 1
route
’’1 6
.
’’6 7
logintud
’’7 ?
)
’’? @
)
’’@ A
.
÷÷$ %
ToList
÷÷% +
(
÷÷+ ,
)
÷÷, -
;
÷÷- .
if
◊◊ 
(
◊◊ 

RouteOrder
◊◊ &
[
◊◊& '
$num
◊◊' (
]
◊◊( )
==
◊◊* ,
null
◊◊- 1
||
◊◊2 4
RouteOrder2
◊◊5 @
[
◊◊@ A
count
◊◊A F
]
◊◊F G
==
◊◊H J
null
◊◊K O
)
◊◊O P
{
ÿÿ 
return
ŸŸ "
RedirectToAction
ŸŸ# 3
(
ŸŸ3 4
$str
ŸŸ4 D
,
ŸŸD E
$str
ŸŸF M
,
ŸŸM N
new
ŸŸO R
{
ŸŸS T
numTypeRoute
ŸŸU a
=
ŸŸc d
numTypeRoute
ŸŸe q
}
ŸŸr s
)
ŸŸs t
;
ŸŸt u
}
⁄⁄ 
if
€€ 
(
€€ 

RouteOrder
€€ &
[
€€& '
$num
€€' (
]
€€( )
.
€€) *
numPoint
€€* 2
>
€€3 4
RouteOrder2
€€5 @
[
€€@ A
count
€€A F
]
€€F G
.
€€G H
numPoint
€€H P
)
€€P Q
{
‹‹ 
idInicio
›› $
=
››% &
int
››' *
.
››* +
Parse
››+ 0
(
››0 1
RouteOrder2
››1 <
[
››< =
count
››= B
]
››B C
.
››C D
idRoute
››D K
.
››K L
ToString
››L T
(
››T U
)
››U V
)
››V W
;
››W X
idFinal
ﬁﬁ #
=
ﬁﬁ$ %
int
ﬁﬁ& )
.
ﬁﬁ) *
Parse
ﬁﬁ* /
(
ﬁﬁ/ 0

RouteOrder
ﬁﬁ0 :
[
ﬁﬁ: ;
$num
ﬁﬁ; <
]
ﬁﬁ< =
.
ﬁﬁ= >
idRoute
ﬁﬁ> E
.
ﬁﬁE F
ToString
ﬁﬁF N
(
ﬁﬁN O
)
ﬁﬁO P
)
ﬁﬁP Q
;
ﬁﬁQ R
}
ﬂﬂ 
else
‡‡ 
{
·· 
idFinal
‚‚ #
=
‚‚$ %
int
‚‚& )
.
‚‚) *
Parse
‚‚* /
(
‚‚/ 0
RouteOrder2
‚‚0 ;
[
‚‚; <
count
‚‚< A
]
‚‚A B
.
‚‚B C
idRoute
‚‚C J
.
‚‚J K
ToString
‚‚K S
(
‚‚S T
)
‚‚T U
)
‚‚U V
;
‚‚V W
idInicio
„„ $
=
„„% &
int
„„' *
.
„„* +
Parse
„„+ 0
(
„„0 1

RouteOrder
„„1 ;
[
„„; <
$num
„„< =
]
„„= >
.
„„> ?
idRoute
„„? F
.
„„F G
ToString
„„G O
(
„„O P
)
„„P Q
)
„„Q R
;
„„R S
}
‰‰ 
if
ÂÂ 
(
ÂÂ 
idInicio
ÂÂ $
!=
ÂÂ% '
idFinal
ÂÂ( /
)
ÂÂ/ 0
verificacion
ÂÂ1 =
=
ÂÂ> ?
true
ÂÂ@ D
;
ÂÂD E
count
ÊÊ 
++
ÊÊ 
;
ÊÊ  
}
ÁÁ 
using
ËË 
(
ËË 
dbModels
ËË #
context
ËË$ +
=
ËË, -
new
ËË. 1
dbModels
ËË2 :
(
ËË: ;
)
ËË; <
)
ËË< =
{
ÈÈ 
DeviationRote
ÍÍ %
deviationRoute
ÍÍ& 4
=
ÍÍ5 6
new
ÍÍ7 :
DeviationRote
ÍÍ; H
{
ÎÎ 
numberRoute
ÏÏ '
=
ÏÏ( )
$num
ÏÏ* +
,
ÏÏ+ ,
idLine
ÌÌ "
=
ÌÌ# $
Line
ÌÌ% )
,
ÌÌ) *
idRouteStart
ÓÓ (
=
ÓÓ) *
idInicio
ÓÓ+ 3
,
ÓÓ3 4

idRouteEnd
ÔÔ &
=
ÔÔ' (
idFinal
ÔÔ) 0
,
ÔÔ0 1
numTypeRoute
 (
=
) *
numTypeRoute
+ 7
}
ÒÒ 
;
ÒÒ 
context
ÚÚ 
.
ÚÚ  
DeviationRote
ÚÚ  -
.
ÚÚ- .
Add
ÚÚ. 1
(
ÚÚ1 2
deviationRoute
ÚÚ2 @
)
ÚÚ@ A
;
ÚÚA B
context
ÛÛ 
.
ÛÛ  
SaveChanges
ÛÛ  +
(
ÛÛ+ ,
)
ÛÛ, -
;
ÛÛ- .
}
ÙÙ 
return
ıı 
RedirectToAction
ıı +
(
ıı+ ,
$str
ıı, <
,
ıı< =
$str
ıı> E
,
ııE F
new
ııG J
{
ııK L
numTypeRoute
ııM Y
=
ıı[ \
numTypeRoute
ıı] i
}
ııj k
)
ıık l
;
ııl m
}
ˆˆ 
else
˜˜ 
return
˜˜ 
RedirectToAction
˜˜ ,
(
˜˜, -
$str
˜˜- =
,
˜˜= >
$str
˜˜? F
,
˜˜F G
new
˜˜H K
{
˜˜L M
numTypeRoute
˜˜N Z
=
˜˜[ \
numTypeRoute
˜˜] i
}
˜˜j k
)
˜˜k l
;
˜˜l m
}
¯¯ 
catch
˘˘ 
(
˘˘ 
	Exception
˘˘ 
)
˘˘ 
{
˙˙ 
return
˚˚ 
RedirectToAction
˚˚ '
(
˚˚' (
$str
˚˚( /
,
˚˚/ 0
$str
˚˚1 7
)
˚˚7 8
;
˚˚8 9
}
¸¸ 
}
˛˛ 	
public
ˇˇ 
ActionResult
ˇˇ 
DeleteAllRoutes1
ˇˇ ,
(
ˇˇ, -
)
ˇˇ- .
{
ÄÄ 	
try
ÅÅ 
{
ÇÇ 
Login
ÉÉ 
logi
ÉÉ 
=
ÉÉ 
new
ÉÉ  
Login
ÉÉ! &
(
ÉÉ& '
)
ÉÉ' (
;
ÉÉ( )
var
ÑÑ 

authResult
ÑÑ 
=
ÑÑ   
AutenticarPasosRol
ÑÑ! 3
(
ÑÑ3 4
$num
ÑÑ4 5
)
ÑÑ5 6
;
ÑÑ6 7
if
ÖÖ 
(
ÖÖ 

authResult
ÖÖ 
!=
ÖÖ !
null
ÖÖ" &
)
ÖÖ& '
return
ÖÖ( .

authResult
ÖÖ/ 9
;
ÖÖ9 :
string
ÜÜ 
Line
ÜÜ 
=
ÜÜ 
logi
ÜÜ "
.
ÜÜ" # 
GetLineaFromCookie
ÜÜ# 5
(
ÜÜ5 6
Request
ÜÜ6 =
)
ÜÜ= >
.
ÜÜ> ?
ToString
ÜÜ? G
(
ÜÜG H
)
ÜÜH I
;
ÜÜI J
List
àà 
<
àà 
Route
àà 
>
àà 
route
àà !
=
àà" #
new
àà$ '
List
àà( ,
<
àà, -
Route
àà- 2
>
àà2 3
(
àà3 4
)
àà4 5
;
àà5 6
using
ââ 
(
ââ 
dbModels
ââ 
context
ââ  '
=
ââ( )
new
ââ* -
dbModels
ââ. 6
(
ââ6 7
)
ââ7 8
)
ââ8 9
route
ââ: ?
=
ââ@ A
context
ââB I
.
ââI J
Route
ââJ O
.
ââO P
Where
ââP U
(
ââU V
x
ââV W
=>
ââX Z
x
ââ[ \
.
ââ\ ]
idLine
ââ] c
==
ââd f
Line
ââg k
&&
ââl n
x
ââo p
.
ââp q
numberRoute
ââq |
==
ââ} 
$numââÄ Å
)ââÅ Ç
.ââÇ É
ToListââÉ â
(âââ ä
)ââä ã
;ââã å
if
ää 
(
ää 
route
ää 
.
ää 
Count
ää 
>
ää  !
$num
ää" #
)
ää# $
{
ãã 
using
åå 
(
åå 
dbModels
åå #
context
åå$ +
=
åå, -
new
åå. 1
dbModels
åå2 :
(
åå: ;
)
åå; <
)
åå< =
{
çç 
foreach
éé 
(
éé  !
var
éé! $
item
éé% )
in
éé* ,
route
éé- 2
)
éé2 3
{
èè 
context
êê #
.
êê# $
Route
êê$ )
.
êê) *
Remove
êê* 0
(
êê0 1
item
êê1 5
)
êê5 6
;
êê6 7
}
ëë 
context
íí 
.
íí  
SaveChanges
íí  +
(
íí+ ,
)
íí, -
;
íí- .
}
ìì 
}
îî 
return
ññ 
RedirectToAction
ññ '
(
ññ' (
$str
ññ( /
,
ññ/ 0
$str
ññ1 8
)
ññ8 9
;
ññ9 :
}
óó 
catch
òò 
(
òò 
	Exception
òò 
)
òò 
{
ôô 
return
öö 
RedirectToAction
öö '
(
öö' (
$str
öö( /
,
öö/ 0
$str
öö1 7
)
öö7 8
;
öö8 9
}
õõ 
}
úú 	
public
ùù 
ActionResult
ùù 
DeleteAllRoutes2
ùù ,
(
ùù, -
)
ùù- .
{
ûû 	
try
üü 
{
†† 
Login
°° 
logi
°° 
=
°° 
new
°°  
Login
°°! &
(
°°& '
)
°°' (
;
°°( )
var
¢¢ 

authResult
¢¢ 
=
¢¢   
AutenticarPasosRol
¢¢! 3
(
¢¢3 4
$num
¢¢4 5
)
¢¢5 6
;
¢¢6 7
if
££ 
(
££ 

authResult
££ 
!=
££ !
null
££" &
)
££& '
return
££( .

authResult
££/ 9
;
££9 :
string
§§ 
Line
§§ 
=
§§ 
logi
§§ "
.
§§" # 
GetLineaFromCookie
§§# 5
(
§§5 6
Request
§§6 =
)
§§= >
.
§§> ?
ToString
§§? G
(
§§G H
)
§§H I
;
§§I J
List
¶¶ 
<
¶¶ 
Route
¶¶ 
>
¶¶ 
route
¶¶ !
=
¶¶" #
new
¶¶$ '
List
¶¶( ,
<
¶¶, -
Route
¶¶- 2
>
¶¶2 3
(
¶¶3 4
)
¶¶4 5
;
¶¶5 6
using
ßß 
(
ßß 
dbModels
ßß 
context
ßß  '
=
ßß( )
new
ßß* -
dbModels
ßß. 6
(
ßß6 7
)
ßß7 8
)
ßß8 9
route
ßß: ?
=
ßß@ A
context
ßßB I
.
ßßI J
Route
ßßJ O
.
ßßO P
Where
ßßP U
(
ßßU V
x
ßßV W
=>
ßßX Z
x
ßß[ \
.
ßß\ ]
idLine
ßß] c
==
ßßd f
Line
ßßg k
&&
ßßl n
x
ßßo p
.
ßßp q
numberRoute
ßßq |
==
ßß} 
$numßßÄ Å
)ßßÅ Ç
.ßßÇ É
ToListßßÉ â
(ßßâ ä
)ßßä ã
;ßßã å
if
®® 
(
®® 
route
®® 
.
®® 
Count
®® 
>
®®  !
$num
®®" #
)
®®# $
{
©© 
using
™™ 
(
™™ 
dbModels
™™ #
context
™™$ +
=
™™, -
new
™™. 1
dbModels
™™2 :
(
™™: ;
)
™™; <
)
™™< =
{
´´ 
foreach
¨¨ 
(
¨¨  !
var
¨¨! $
item
¨¨% )
in
¨¨* ,
route
¨¨- 2
)
¨¨2 3
{
≠≠ 
context
ÆÆ #
.
ÆÆ# $
Route
ÆÆ$ )
.
ÆÆ) *
Remove
ÆÆ* 0
(
ÆÆ0 1
item
ÆÆ1 5
)
ÆÆ5 6
;
ÆÆ6 7
}
ØØ 
context
∞∞ 
.
∞∞  
SaveChanges
∞∞  +
(
∞∞+ ,
)
∞∞, -
;
∞∞- .
}
±± 
}
≤≤ 
return
¥¥ 
RedirectToAction
¥¥ '
(
¥¥' (
$str
¥¥( /
,
¥¥/ 0
$str
¥¥1 8
)
¥¥8 9
;
¥¥9 :
}
µµ 
catch
∂∂ 
(
∂∂ 
	Exception
∂∂ 
)
∂∂ 
{
∑∑ 
return
∏∏ 
RedirectToAction
∏∏ '
(
∏∏' (
$str
∏∏( /
,
∏∏/ 0
$str
∏∏1 7
)
∏∏7 8
;
∏∏8 9
}
ππ 
}
∫∫ 	
public
ªª 
ActionResult
ªª 
Parada1
ªª #
(
ªª# $
int
ªª$ '
numTypeRoute
ªª( 4
)
ªª4 5
{
ºº 	
try
ΩΩ 
{
ææ 
Login
øø 
logi
øø 
=
øø 
new
øø  
Login
øø! &
(
øø& '
)
øø' (
;
øø( )
var
¿¿ 

authResult
¿¿ 
=
¿¿   
AutenticarPasosRol
¿¿! 3
(
¿¿3 4
$num
¿¿4 5
)
¿¿5 6
;
¿¿6 7
if
¡¡ 
(
¡¡ 

authResult
¡¡ 
!=
¡¡ !
null
¡¡" &
)
¡¡& '
return
¡¡( .

authResult
¡¡/ 9
;
¡¡9 :
string
√√ 
Line
√√ 
=
√√ 
logi
√√ "
.
√√" # 
GetLineaFromCookie
√√# 5
(
√√5 6
Request
√√6 =
)
√√= >
.
√√> ?
ToString
√√? G
(
√√G H
)
√√H I
;
√√I J
List
ƒƒ 
<
ƒƒ 
MuestraRutasMapas
ƒƒ &
>
ƒƒ& '
mapa
ƒƒ( ,
=
ƒƒ- .
new
ƒƒ/ 2
List
ƒƒ3 7
<
ƒƒ7 8
MuestraRutasMapas
ƒƒ8 I
>
ƒƒI J
(
ƒƒJ K
)
ƒƒK L
;
ƒƒL M
int
≈≈ 
count
≈≈ 
=
≈≈ 
$num
≈≈ 
;
≈≈ 
for
∆∆ 
(
∆∆ 
int
∆∆ 
i
∆∆ 
=
∆∆ 
$num
∆∆ 
;
∆∆ 
i
∆∆  !
<=
∆∆" $
$num
∆∆% &
;
∆∆& '
i
∆∆( )
++
∆∆) +
)
∆∆+ ,
{
«« 
MuestraRutasMapas
»» %
muestraRutasMapas
»»& 7
=
»»8 9
new
»»: =
MuestraRutasMapas
»»> O
{
…… 
ListRutasMostrar
   (
=
  ) *
new
  + .
List
  / 3
<
  3 4
RutasMostrar
  4 @
>
  @ A
(
  A B
)
  B C
,
  C D 
ListParadasMostrar
ÀÀ *
=
ÀÀ+ ,
new
ÀÀ- 0
List
ÀÀ1 5
<
ÀÀ5 6
ParadasMostrar
ÀÀ6 D
>
ÀÀD E
(
ÀÀE F
)
ÀÀF G
,
ÀÀG H

NumeroRuta
ÃÃ "
=
ÃÃ# $
i
ÃÃ% &
}
ÕÕ 
;
ÕÕ 
List
œœ 
<
œœ 
RutasMostrar
œœ %
>
œœ% &
nuevasRutas
œœ' 2
=
œœ3 4
new
œœ5 8
List
œœ9 =
<
œœ= >
RutasMostrar
œœ> J
>
œœJ K
(
œœK L
)
œœL M
;
œœM N
List
–– 
<
–– 
ParadasMostrar
–– '
>
––' (
nuevasParadas
––) 6
=
––7 8
new
––9 <
List
––= A
<
––A B
ParadasMostrar
––B P
>
––P Q
(
––Q R
)
––R S
;
––S T
using
““ 
(
““ 
dbModels
““ #
context
““$ +
=
““, -
new
““. 1
dbModels
““2 :
(
““: ;
)
““; <
)
““< =
{
”” 
var
‘‘ 
checkpoints
‘‘ '
=
‘‘( )
context
‘‘* 1
.
‘‘1 2

Checkpoint
‘‘2 <
.
‘‘< =
Where
‘‘= B
(
‘‘B C
x
‘‘C D
=>
‘‘E G
x
‘‘H I
.
‘‘I J
idLine
‘‘J P
==
‘‘Q S
Line
‘‘T X
&&
‘‘Y [
x
‘‘\ ]
.
‘‘] ^
status
‘‘^ d
==
‘‘e g
$num
‘‘h i
&&
‘‘j l
x
‘‘m n
.
‘‘n o
numberRoute
‘‘o z
==
‘‘{ }
numTypeRoute‘‘~ ä
)‘‘ä ã
.‘‘ã å
ToList‘‘å í
(‘‘í ì
)‘‘ì î
;‘‘î ï
var
’’ 
routes
’’ "
=
’’# $
context
’’% ,
.
’’, -
Route
’’- 2
.
÷÷ 
Where
÷÷ "
(
÷÷" #
x
÷÷# $
=>
÷÷% '
x
÷÷( )
.
÷÷) *
idLine
÷÷* 0
==
÷÷1 3
Line
÷÷4 8
&&
÷÷9 ;
x
÷÷< =
.
÷÷= >
numberRoute
÷÷> I
==
÷÷J L
i
÷÷M N
&&
÷÷O Q
x
÷÷R S
.
÷÷S T
numTypeRoute
÷÷T `
==
÷÷a c
numTypeRoute
÷÷d p
)
÷÷p q
.
◊◊ 
ToList
◊◊ #
(
◊◊# $
)
◊◊$ %
;
◊◊% &
if
ŸŸ 
(
ŸŸ 
routes
ŸŸ "
.
ŸŸ" #
Count
ŸŸ# (
>
ŸŸ) *
$num
ŸŸ+ ,
)
ŸŸ, -
{
⁄⁄ 
count
€€ !
=
€€" #
$num
€€$ %
;
€€% &
foreach
‹‹ #
(
‹‹$ %
var
‹‹% (
item
‹‹) -
in
‹‹. 0
routes
‹‹1 7
)
‹‹7 8
{
›› 
count
ﬁﬁ  %
++
ﬁﬁ% '
;
ﬁﬁ' (
Place
ﬂﬂ  %
place
ﬂﬂ& +
=
ﬂﬂ, -
context
ﬂﬂ. 5
.
ﬂﬂ5 6
Place
ﬂﬂ6 ;
.
ﬂﬂ; <
FirstOrDefault
ﬂﬂ< J
(
ﬂﬂJ K
x
ﬂﬂK L
=>
ﬂﬂM O
x
ﬂﬂP Q
.
ﬂﬂQ R
idPlace
ﬂﬂR Y
==
ﬂﬂZ \
item
ﬂﬂ] a
.
ﬂﬂa b
idPlace
ﬂﬂb i
)
ﬂﬂi j
;
ﬂﬂj k
if
‡‡  "
(
‡‡# $
place
‡‡$ )
!=
‡‡* ,
null
‡‡- 1
)
‡‡1 2
{
··  !
nuevasRutas
‚‚$ /
.
‚‚/ 0
Add
‚‚0 3
(
‚‚3 4
new
‚‚4 7
RutasMostrar
‚‚8 D
(
‚‚D E
item
‚‚E I
.
‚‚I J
idRoute
‚‚J Q
,
‚‚Q R
item
‚‚S W
.
‚‚W X
latitud
‚‚X _
,
‚‚_ `
item
‚‚a e
.
‚‚e f
logintud
‚‚f n
,
‚‚n o
place
‚‚p u
.
‚‚u v
description‚‚v Å
+‚‚Ç É
$str‚‚Ñ á
+‚‚à â
count‚‚ä è
,‚‚è ê
item‚‚ë ï
.‚‚ï ñ
status‚‚ñ ú
,‚‚ú ù
(‚‚û ü
int‚‚ü ¢
)‚‚¢ £
item‚‚£ ß
.‚‚ß ®
numPoint‚‚® ∞
)‚‚∞ ±
)‚‚± ≤
;‚‚≤ ≥
}
„„  !
}
‰‰ 
if
ÊÊ 
(
ÊÊ  
nuevasRutas
ÊÊ  +
.
ÊÊ+ ,
Any
ÊÊ, /
(
ÊÊ/ 0
)
ÊÊ0 1
)
ÊÊ1 2
{
ÁÁ 
RutasMostrar
ËË  ,
primeraRuta
ËË- 8
=
ËË9 :
nuevasRutas
ËË; F
.
ËËF G
FirstOrDefault
ËËG U
(
ËËU V
r
ËËV W
=>
ËËX Z
r
ËË[ \
.
ËË\ ]
status
ËË] c
==
ËËd f
$num
ËËg h
)
ËËh i
;
ËËi j
if
ÈÈ  "
(
ÈÈ# $
primeraRuta
ÈÈ$ /
!=
ÈÈ0 2
null
ÈÈ3 7
)
ÈÈ7 8
{
ÍÍ  !
nuevasRutas
ÎÎ$ /
=
ÎÎ0 1
nuevasRutas
ÎÎ2 =
.
ÏÏ( )
OrderBy
ÏÏ) 0
(
ÏÏ0 1
route
ÏÏ1 6
=>
ÏÏ7 9
route
ÏÏ: ?
.
ÏÏ? @
numPoint
ÏÏ@ H
)
ÏÏH I
.
ÌÌ( )
ToList
ÌÌ) /
(
ÌÌ/ 0
)
ÌÌ0 1
;
ÌÌ1 2
}
ÓÓ  !
}
ÔÔ 
}
 
if
ÚÚ 
(
ÚÚ 
checkpoints
ÚÚ '
.
ÚÚ' (
Count
ÚÚ( -
>
ÚÚ. /
$num
ÚÚ0 1
)
ÚÚ1 2
{
ÛÛ 
foreach
ıı #
(
ıı$ %
var
ıı% (
item
ıı) -
in
ıı. 0
checkpoints
ıı1 <
)
ıı< =
{
ˆˆ 
nuevasParadas
˜˜  -
.
˜˜- .
Add
˜˜. 1
(
˜˜1 2
new
˜˜2 5
ParadasMostrar
˜˜6 D
(
˜˜D E
item
˜˜E I
.
˜˜I J
idCheckpoint
˜˜J V
,
˜˜V W
item
˜˜X \
.
˜˜\ ]
description
˜˜] h
,
˜˜h i
item
˜˜j n
.
˜˜n o
status
˜˜o u
,
˜˜u v
item
˜˜w {
.
˜˜{ |
latitud˜˜| É
,˜˜É Ñ
item˜˜Ö â
.˜˜â ä
longitud˜˜ä í
)˜˜í ì
)˜˜ì î
;˜˜î ï
}
¯¯ 
if
˙˙ 
(
˙˙  
nuevasParadas
˙˙  -
.
˙˙- .
Any
˙˙. 1
(
˙˙1 2
)
˙˙2 3
)
˙˙3 4
{
˚˚ 
ParadasMostrar
¸¸  .
primeraParada
¸¸/ <
=
¸¸= >
nuevasParadas
¸¸? L
.
¸¸L M
FirstOrDefault
¸¸M [
(
¸¸[ \
r
¸¸\ ]
=>
¸¸^ `
r
¸¸a b
.
¸¸b c
status
¸¸c i
==
¸¸j l
$num
¸¸m n
)
¸¸n o
;
¸¸o p
if
˝˝  "
(
˝˝# $
primeraParada
˝˝$ 1
!=
˝˝2 4
null
˝˝5 9
)
˝˝9 :
{
˛˛  !
nuevasParadas
ˇˇ$ 1
=
ˇˇ2 3
nuevasParadas
ˇˇ4 A
.
ÄÄ( )
OrderBy
ÄÄ) 0
(
ÄÄ0 1
route
ÄÄ1 6
=>
ÄÄ7 9
muestraRutasMapas
ÄÄ: K
.
ÄÄK L(
CalcularDistanciaHaversine
ÄÄL f
(
ÄÄf g
(
ÅÅ, -
decimal
ÅÅ- 4
)
ÅÅ4 5
primeraParada
ÅÅ5 B
.
ÅÅB C
latitud
ÅÅC J
,
ÅÅJ K
(
ÇÇ, -
decimal
ÇÇ- 4
)
ÇÇ4 5
primeraParada
ÇÇ5 B
.
ÇÇB C
longitud
ÇÇC K
,
ÇÇK L
route
ÉÉ, 1
.
ÉÉ1 2
latitud
ÉÉ2 9
,
ÉÉ9 :
route
ÑÑ, 1
.
ÑÑ1 2
longitud
ÑÑ2 :
)
ÑÑ: ;
)
ÑÑ; <
.
ÖÖ( )
ToList
ÖÖ) /
(
ÖÖ/ 0
)
ÖÖ0 1
;
ÖÖ1 2
}
ÜÜ  !
}
áá 
}
àà 
}
ââ 
muestraRutasMapas
ää %
.
ää% &
ListRutasMostrar
ää& 6
=
ää7 8
nuevasRutas
ää9 D
;
ääD E
muestraRutasMapas
ãã %
.
ãã% & 
ListParadasMostrar
ãã& 8
=
ãã9 :
nuevasParadas
ãã; H
;
ããH I
ViewBag
åå 
.
åå 
numTypeRoute
åå (
=
åå) *
numTypeRoute
åå+ 7
;
åå7 8
mapa
çç 
.
çç 
Add
çç 
(
çç 
muestraRutasMapas
çç .
)
çç. /
;
çç/ 0
}
éé 
Session
èè 
[
èè 
$str
èè &
]
èè& '
=
èè( )
numTypeRoute
èè* 6
;
èè6 7
return
êê 
View
êê 
(
êê 
mapa
êê  
)
êê  !
;
êê! "
}
ëë 
catch
íí 
(
íí 
	Exception
íí 
)
íí 
{
ìì 
return
îî 
RedirectToAction
îî '
(
îî' (
$str
îî( /
,
îî/ 0
$str
îî1 7
)
îî7 8
;
îî8 9
}
ïï 
}
ññ 	
[
óó 	
HttpPost
óó	 
]
óó 
public
òò 
ActionResult
òò 
Parada1
òò #
(
òò# $
string
òò$ *
ubicaciones
òò+ 6
)
òò6 7
{
ôô 	
try
öö 
{
õõ 
Login
úú 
logi
úú 
=
úú 
new
úú  
Login
úú! &
(
úú& '
)
úú' (
;
úú( )
var
ùù 

authResult
ùù 
=
ùù   
AutenticarPasosRol
ùù! 3
(
ùù3 4
$num
ùù4 5
)
ùù5 6
;
ùù6 7
if
ûû 
(
ûû 

authResult
ûû 
!=
ûû !
null
ûû" &
)
ûû& '
return
ûû( .

authResult
ûû/ 9
;
ûû9 :
string
üü 
Line
üü 
=
üü 
logi
üü "
.
üü" # 
GetLineaFromCookie
üü# 5
(
üü5 6
Request
üü6 =
)
üü= >
.
üü> ?
ToString
üü? G
(
üüG H
)
üüH I
;
üüI J
if
†† 
(
†† 
Session
†† 
[
†† 
$str
†† *
]
††* +
==
††, .
null
††/ 3
)
††3 4
{
°° 
}
££ 
int
§§ 
numTypeRoute
§§  
=
§§! "
int
§§# &
.
§§& '
Parse
§§' ,
(
§§, -
Session
§§- 4
[
§§4 5
$str
§§5 C
]
§§C D
.
§§D E
ToString
§§E M
(
§§M N
)
§§N O
)
§§O P
;
§§P Q

Checkpoint
•• 
check
••  
=
••! "
new
••# &

Checkpoint
••' 1
(
••1 2
)
••2 3
;
••3 4
Route
¶¶ 
route
¶¶ 
=
¶¶ 
new
¶¶ !
Route
¶¶" '
(
¶¶' (
)
¶¶( )
;
¶¶) *
using
ßß 
(
ßß 
dbModels
ßß 
context
ßß  '
=
ßß( )
new
ßß* -
dbModels
ßß. 6
(
ßß6 7
)
ßß7 8
)
ßß8 9
check
ßß: ?
=
ßß@ A
context
ßßB I
.
ßßI J

Checkpoint
ßßJ T
.
ßßT U
Where
ßßU Z
(
ßßZ [
x
ßß[ \
=>
ßß] _
x
ßß` a
.
ßßa b
status
ßßb h
==
ßßi k
$num
ßßl m
&&
ßßn p
x
ßßq r
.
ßßr s
idLine
ßßs y
==
ßßz |
Lineßß} Å
&&ßßÇ Ñ
xßßÖ Ü
.ßßÜ á
numberRouteßßá í
==ßßì ï
numTypeRouteßßñ ¢
)ßß¢ £
.ßß£ §
FirstOrDefaultßß§ ≤
(ßß≤ ≥
)ßß≥ ¥
;ßß¥ µ
using
®® 
(
®® 
dbModels
®® 
context
®®  '
=
®®( )
new
®®* -
dbModels
®®. 6
(
®®6 7
)
®®7 8
)
®®8 9
route
®®: ?
=
®®@ A
context
®®B I
.
®®I J
Route
®®J O
.
®®O P
Where
®®P U
(
®®U V
x
®®V W
=>
®®X Z
x
®®[ \
.
®®\ ]
status
®®] c
==
®®d f
$num
®®g h
&&
®®i k
x
®®l m
.
®®m n
idLine
®®n t
==
®®u w
Line
®®x |
&&
®®} 
x®®Ä Å
.®®Å Ç
numberRoute®®Ç ç
==®®é ê
$num®®ë í
&&®®ì ï
x®®ñ ó
.®®ó ò
numTypeRoute®®ò §
==®®• ß
numTypeRoute®®® ¥
)®®¥ µ
.®®µ ∂
FirstOrDefault®®∂ ƒ
(®®ƒ ≈
)®®≈ ∆
;®®∆ «
if
©© 
(
©© 
check
©© 
!=
©© 
null
©© !
&&
©©" $
route
©©% *
!=
©©+ -
null
©©. 2
)
©©2 3
using
™™ 
(
™™ 
dbModels
™™ #
context
™™$ +
=
™™, -
new
™™. 1
dbModels
™™2 :
(
™™: ;
)
™™; <
)
™™< =
{
´´ 
string
≠≠ 
[
≠≠ 
]
≠≠  ,
seccionesNombreLatitudLongitud
≠≠! ?
=
≠≠@ A
ubicaciones
≠≠B M
.
≠≠M N
Split
≠≠N S
(
≠≠S T
$char
≠≠T W
)
≠≠W X
;
≠≠X Y
if
ÆÆ 
(
ÆÆ ,
seccionesNombreLatitudLongitud
ÆÆ :
.
ÆÆ: ;
Length
ÆÆ; A
>=
ÆÆB D
$num
ÆÆE F
)
ÆÆF G
{
ØØ 
check
∞∞ !
.
∞∞! "
description
∞∞" -
=
∞∞. /
$str
∞∞0 D
;
∞∞D E
check
±± !
.
±±! "
latitud
±±" )
=
±±* +
Convert
±±, 3
.
±±3 4
	ToDecimal
±±4 =
(
±±= >,
seccionesNombreLatitudLongitud
±±> \
[
±±\ ]
$num
±±] ^
]
±±^ _
.
±±_ `
Trim
±±` d
(
±±d e
)
±±e f
,
±±f g
System
±±h n
.
±±n o
Globalization
±±o |
.
±±| }
CultureInfo±±} à
.±±à â 
InvariantCulture±±â ô
)±±ô ö
;±±ö õ
check
≤≤ !
.
≤≤! "
longitud
≤≤" *
=
≤≤+ ,
Convert
≤≤- 4
.
≤≤4 5
	ToDecimal
≤≤5 >
(
≤≤> ?,
seccionesNombreLatitudLongitud
≤≤? ]
[
≤≤] ^
$num
≤≤^ _
]
≤≤_ `
.
≤≤` a
Trim
≤≤a e
(
≤≤e f
)
≤≤f g
,
≤≤g h
System
≤≤i o
.
≤≤o p
Globalization
≤≤p }
.
≤≤} ~
CultureInfo≤≤~ â
.≤≤â ä 
InvariantCulture≤≤ä ö
)≤≤ö õ
;≤≤õ ú
route
≥≥ !
.
≥≥! "
latitud
≥≥" )
=
≥≥* +
Convert
≥≥, 3
.
≥≥3 4
	ToDecimal
≥≥4 =
(
≥≥= >,
seccionesNombreLatitudLongitud
≥≥> \
[
≥≥\ ]
$num
≥≥] ^
]
≥≥^ _
.
≥≥_ `
Trim
≥≥` d
(
≥≥d e
)
≥≥e f
,
≥≥f g
System
≥≥h n
.
≥≥n o
Globalization
≥≥o |
.
≥≥| }
CultureInfo≥≥} à
.≥≥à â 
InvariantCulture≥≥â ô
)≥≥ô ö
;≥≥ö õ
route
¥¥ !
.
¥¥! "
logintud
¥¥" *
=
¥¥+ ,
Convert
¥¥- 4
.
¥¥4 5
	ToDecimal
¥¥5 >
(
¥¥> ?,
seccionesNombreLatitudLongitud
¥¥? ]
[
¥¥] ^
$num
¥¥^ _
]
¥¥_ `
.
¥¥` a
Trim
¥¥a e
(
¥¥e f
)
¥¥f g
,
¥¥g h
System
¥¥i o
.
¥¥o p
Globalization
¥¥p }
.
¥¥} ~
CultureInfo¥¥~ â
.¥¥â ä 
InvariantCulture¥¥ä ö
)¥¥ö õ
;¥¥õ ú
check
∂∂ !
.
∂∂! "

minArrival
∂∂" ,
=
∂∂- .
$str
∂∂/ 6
;
∂∂6 7
check
∑∑ !
.
∑∑! "
minArrivalMarket
∑∑" 2
=
∑∑3 4
$str
∑∑5 <
;
∑∑< =
context
∏∏ #
.
∏∏# $
Entry
∏∏$ )
(
∏∏) *
route
∏∏* /
)
∏∏/ 0
.
∏∏0 1
State
∏∏1 6
=
∏∏7 8
System
∏∏9 ?
.
∏∏? @
Data
∏∏@ D
.
∏∏D E
Entity
∏∏E K
.
∏∏K L
EntityState
∏∏L W
.
∏∏W X
Modified
∏∏X `
;
∏∏` a
context
ππ #
.
ππ# $
Entry
ππ$ )
(
ππ) *
check
ππ* /
)
ππ/ 0
.
ππ0 1
State
ππ1 6
=
ππ7 8
System
ππ9 ?
.
ππ? @
Data
ππ@ D
.
ππD E
Entity
ππE K
.
ππK L
EntityState
ππL W
.
ππW X
Modified
ππX `
;
ππ` a
context
∫∫ #
.
∫∫# $
SaveChanges
∫∫$ /
(
∫∫/ 0
)
∫∫0 1
;
∫∫1 2
}
ªª 
}
ΩΩ 
else
ææ 
{
øø 
using
¿¿ 
(
¿¿ 
dbModels
¿¿ #
context
¿¿$ +
=
¿¿, -
new
¿¿. 1
dbModels
¿¿2 :
(
¿¿: ;
)
¿¿; <
)
¿¿< =
{
¡¡ 
check
¬¬ 
=
¬¬ 
new
¬¬  #

Checkpoint
¬¬$ .
(
¬¬. /
)
¬¬/ 0
;
¬¬0 1
route
√√ 
=
√√ 
new
√√  #
Route
√√$ )
(
√√) *
)
√√* +
;
√√+ ,
string
ƒƒ 
[
ƒƒ 
]
ƒƒ  ,
seccionesNombreLatitudLongitud
ƒƒ! ?
=
ƒƒ@ A
ubicaciones
ƒƒB M
.
ƒƒM N
Split
ƒƒN S
(
ƒƒS T
$char
ƒƒT W
)
ƒƒW X
;
ƒƒX Y
if
≈≈ 
(
≈≈ ,
seccionesNombreLatitudLongitud
≈≈ :
.
≈≈: ;
Length
≈≈; A
>=
≈≈B D
$num
≈≈E F
)
≈≈F G
{
∆∆ 
string
«« "
description
««# .
=
««/ 0,
seccionesNombreLatitudLongitud
««1 O
[
««O P
$num
««P Q
]
««Q R
.
««R S
Trim
««S W
(
««W X
)
««X Y
;
««Y Z
Place
»» !
place
»»" '
=
»»( )
context
»»* 1
.
»»1 2
Place
»»2 7
.
»»7 8
FirstOrDefault
»»8 F
(
»»F G
x
»»G H
=>
»»I K
x
»»L M
.
»»M N
description
»»N Y
==
»»Z \
description
»»] h
)
»»h i
;
»»i j
if
…… 
(
……  
place
……  %
==
……& (
null
……) -
)
……- .
{
   
place
ÀÀ  %
=
ÀÀ& '
new
ÀÀ( +
Place
ÀÀ, 1
{
ÃÃ  !
description
ÕÕ$ /
=
ÕÕ0 1
description
ÕÕ2 =
}
ŒŒ  !
;
ŒŒ! "
context
œœ  '
.
œœ' (
Place
œœ( -
.
œœ- .
Add
œœ. 1
(
œœ1 2
place
œœ2 7
)
œœ7 8
;
œœ8 9
context
––  '
.
––' (
SaveChanges
––( 3
(
––3 4
)
––4 5
;
––5 6
}
—— 
check
““ !
.
““! "
description
““" -
=
““. /
$str
““0 D
;
““D E
check
”” !
.
””! "
latitud
””" )
=
””* +
Convert
””, 3
.
””3 4
	ToDecimal
””4 =
(
””= >,
seccionesNombreLatitudLongitud
””> \
[
””\ ]
$num
””] ^
]
””^ _
.
””_ `
Trim
””` d
(
””d e
)
””e f
,
””f g
System
””h n
.
””n o
Globalization
””o |
.
””| }
CultureInfo””} à
.””à â 
InvariantCulture””â ô
)””ô ö
;””ö õ
check
‘‘ !
.
‘‘! "
longitud
‘‘" *
=
‘‘+ ,
Convert
‘‘- 4
.
‘‘4 5
	ToDecimal
‘‘5 >
(
‘‘> ?,
seccionesNombreLatitudLongitud
‘‘? ]
[
‘‘] ^
$num
‘‘^ _
]
‘‘_ `
.
‘‘` a
Trim
‘‘a e
(
‘‘e f
)
‘‘f g
,
‘‘g h
System
‘‘i o
.
‘‘o p
Globalization
‘‘p }
.
‘‘} ~
CultureInfo‘‘~ â
.‘‘â ä 
InvariantCulture‘‘ä ö
)‘‘ö õ
;‘‘õ ú
check
’’ !
.
’’! "
status
’’" (
=
’’) *
$num
’’+ ,
;
’’, -
check
’’. 3
.
’’3 4
numberRoute
’’4 ?
=
’’@ A
numTypeRoute
’’B N
;
’’N O
check
÷÷ !
.
÷÷! "
idLine
÷÷" (
=
÷÷) *
Line
÷÷+ /
;
÷÷/ 0
check
÷÷1 6
.
÷÷6 7

minArrival
÷÷7 A
=
÷÷B C
$str
÷÷D K
;
÷÷K L
check
÷÷M R
.
÷÷R S
minArrivalMarket
÷÷S c
=
÷÷d e
$str
÷÷f m
;
÷÷m n
route
ÿÿ !
.
ÿÿ! "
latitud
ÿÿ" )
=
ÿÿ* +
Convert
ÿÿ, 3
.
ÿÿ3 4
	ToDecimal
ÿÿ4 =
(
ÿÿ= >,
seccionesNombreLatitudLongitud
ÿÿ> \
[
ÿÿ\ ]
$num
ÿÿ] ^
]
ÿÿ^ _
.
ÿÿ_ `
Trim
ÿÿ` d
(
ÿÿd e
)
ÿÿe f
,
ÿÿf g
System
ÿÿh n
.
ÿÿn o
Globalization
ÿÿo |
.
ÿÿ| }
CultureInfoÿÿ} à
.ÿÿà â 
InvariantCultureÿÿâ ô
)ÿÿô ö
;ÿÿö õ
route
ŸŸ !
.
ŸŸ! "
logintud
ŸŸ" *
=
ŸŸ+ ,
Convert
ŸŸ- 4
.
ŸŸ4 5
	ToDecimal
ŸŸ5 >
(
ŸŸ> ?,
seccionesNombreLatitudLongitud
ŸŸ? ]
[
ŸŸ] ^
$num
ŸŸ^ _
]
ŸŸ_ `
.
ŸŸ` a
Trim
ŸŸa e
(
ŸŸe f
)
ŸŸf g
,
ŸŸg h
System
ŸŸi o
.
ŸŸo p
Globalization
ŸŸp }
.
ŸŸ} ~
CultureInfoŸŸ~ â
.ŸŸâ ä 
InvariantCultureŸŸä ö
)ŸŸö õ
;ŸŸõ ú
route
⁄⁄ !
.
⁄⁄! "
idPlace
⁄⁄" )
=
⁄⁄* +
place
⁄⁄, 1
.
⁄⁄1 2
idPlace
⁄⁄2 9
;
⁄⁄9 :
route
⁄⁄; @
.
⁄⁄@ A
idLine
⁄⁄A G
=
⁄⁄H I
Line
⁄⁄J N
;
⁄⁄N O
route
⁄⁄P U
.
⁄⁄U V
numberRoute
⁄⁄V a
=
⁄⁄b c
$num
⁄⁄d e
;
⁄⁄e f
route
⁄⁄g l
.
⁄⁄l m
status
⁄⁄m s
=
⁄⁄t u
$num
⁄⁄v w
;
⁄⁄w x
route
⁄⁄y ~
.
⁄⁄~ 
numPoint⁄⁄ á
=⁄⁄à â
$num⁄⁄ä ã
;⁄⁄ã å
route
€€ !
.
€€! "
numTypeRoute
€€" .
=
€€/ 0
numTypeRoute
€€1 =
;
€€= >
context
‹‹ #
.
‹‹# $
Route
‹‹$ )
.
‹‹) *
Add
‹‹* -
(
‹‹- .
route
‹‹. 3
)
‹‹3 4
;
‹‹4 5
context
›› #
.
››# $

Checkpoint
››$ .
.
››. /
Add
››/ 2
(
››2 3
check
››3 8
)
››8 9
;
››9 :
context
ﬁﬁ #
.
ﬁﬁ# $
SaveChanges
ﬁﬁ$ /
(
ﬁﬁ/ 0
)
ﬁﬁ0 1
;
ﬁﬁ1 2
Session
ﬂﬂ #
[
ﬂﬂ# $
$str
ﬂﬂ$ 2
]
ﬂﬂ2 3
=
ﬂﬂ4 5
null
ﬂﬂ6 :
;
ﬂﬂ: ;
}
‡‡ 
}
·· 
}
‚‚ 
return
„„ 
RedirectToAction
„„ '
(
„„' (
$str
„„( 2
,
„„2 3
$str
„„4 :
)
„„: ;
;
„„; <
}
‰‰ 
catch
ÂÂ 
(
ÂÂ 
	Exception
ÂÂ 
)
ÂÂ 
{
ÊÊ 
return
ÁÁ 
RedirectToAction
ÁÁ '
(
ÁÁ' (
$str
ÁÁ( /
,
ÁÁ/ 0
$str
ÁÁ1 7
)
ÁÁ7 8
;
ÁÁ8 9
}
ËË 
}
ÈÈ 	
public
ÎÎ 
ActionResult
ÎÎ 
Parada2
ÎÎ #
(
ÎÎ# $
int
ÎÎ$ '
numTypeRoute
ÎÎ( 4
)
ÎÎ4 5
{
ÏÏ 	
try
ÌÌ 
{
ÓÓ 
Login
ÔÔ 
logi
ÔÔ 
=
ÔÔ 
new
ÔÔ  
Login
ÔÔ! &
(
ÔÔ& '
)
ÔÔ' (
;
ÔÔ( )
var
 

authResult
 
=
   
AutenticarPasosRol
! 3
(
3 4
$num
4 5
)
5 6
;
6 7
if
ÒÒ 
(
ÒÒ 

authResult
ÒÒ 
!=
ÒÒ !
null
ÒÒ" &
)
ÒÒ& '
return
ÒÒ( .

authResult
ÒÒ/ 9
;
ÒÒ9 :
string
ÛÛ 
Line
ÛÛ 
=
ÛÛ 
logi
ÛÛ "
.
ÛÛ" # 
GetLineaFromCookie
ÛÛ# 5
(
ÛÛ5 6
Request
ÛÛ6 =
)
ÛÛ= >
.
ÛÛ> ?
ToString
ÛÛ? G
(
ÛÛG H
)
ÛÛH I
;
ÛÛI J
List
ÙÙ 
<
ÙÙ 
MuestraRutasMapas
ÙÙ &
>
ÙÙ& '
mapa
ÙÙ( ,
=
ÙÙ- .
new
ÙÙ/ 2
List
ÙÙ3 7
<
ÙÙ7 8
MuestraRutasMapas
ÙÙ8 I
>
ÙÙI J
(
ÙÙJ K
)
ÙÙK L
;
ÙÙL M
int
ıı 
count
ıı 
=
ıı 
$num
ıı 
;
ıı 
for
ˆˆ 
(
ˆˆ 
int
ˆˆ 
i
ˆˆ 
=
ˆˆ 
$num
ˆˆ 
;
ˆˆ 
i
ˆˆ  !
<=
ˆˆ" $
$num
ˆˆ% &
;
ˆˆ& '
i
ˆˆ( )
++
ˆˆ) +
)
ˆˆ+ ,
{
˜˜ 
MuestraRutasMapas
¯¯ %
muestraRutasMapas
¯¯& 7
=
¯¯8 9
new
¯¯: =
MuestraRutasMapas
¯¯> O
{
˘˘ 
ListRutasMostrar
˙˙ (
=
˙˙) *
new
˙˙+ .
List
˙˙/ 3
<
˙˙3 4
RutasMostrar
˙˙4 @
>
˙˙@ A
(
˙˙A B
)
˙˙B C
,
˙˙C D 
ListParadasMostrar
˚˚ *
=
˚˚+ ,
new
˚˚- 0
List
˚˚1 5
<
˚˚5 6
ParadasMostrar
˚˚6 D
>
˚˚D E
(
˚˚E F
)
˚˚F G
,
˚˚G H

NumeroRuta
¸¸ "
=
¸¸# $
i
¸¸% &
}
˝˝ 
;
˝˝ 
List
ˇˇ 
<
ˇˇ 
RutasMostrar
ˇˇ %
>
ˇˇ% &
nuevasRutas
ˇˇ' 2
=
ˇˇ3 4
new
ˇˇ5 8
List
ˇˇ9 =
<
ˇˇ= >
RutasMostrar
ˇˇ> J
>
ˇˇJ K
(
ˇˇK L
)
ˇˇL M
;
ˇˇM N
List
ÄÄ 
<
ÄÄ 
ParadasMostrar
ÄÄ '
>
ÄÄ' (
nuevasParadas
ÄÄ) 6
=
ÄÄ7 8
new
ÄÄ9 <
List
ÄÄ= A
<
ÄÄA B
ParadasMostrar
ÄÄB P
>
ÄÄP Q
(
ÄÄQ R
)
ÄÄR S
;
ÄÄS T
using
ÇÇ 
(
ÇÇ 
dbModels
ÇÇ #
context
ÇÇ$ +
=
ÇÇ, -
new
ÇÇ. 1
dbModels
ÇÇ2 :
(
ÇÇ: ;
)
ÇÇ; <
)
ÇÇ< =
{
ÉÉ 
var
ÑÑ 
checkpoints
ÑÑ '
=
ÑÑ( )
context
ÑÑ* 1
.
ÑÑ1 2

Checkpoint
ÑÑ2 <
.
ÑÑ< =
Where
ÑÑ= B
(
ÑÑB C
x
ÑÑC D
=>
ÑÑE G
x
ÑÑH I
.
ÑÑI J
idLine
ÑÑJ P
==
ÑÑQ S
Line
ÑÑT X
&&
ÑÑY [
x
ÑÑ\ ]
.
ÑÑ] ^
status
ÑÑ^ d
==
ÑÑe g
$num
ÑÑh i
&&
ÑÑj l
x
ÑÑm n
.
ÑÑn o
numberRoute
ÑÑo z
==
ÑÑ{ }
numTypeRouteÑÑ~ ä
)ÑÑä ã
.ÑÑã å
ToListÑÑå í
(ÑÑí ì
)ÑÑì î
;ÑÑî ï
var
ÖÖ 
routes
ÖÖ "
=
ÖÖ# $
context
ÖÖ% ,
.
ÖÖ, -
Route
ÖÖ- 2
.
ÜÜ 
Where
ÜÜ "
(
ÜÜ" #
x
ÜÜ# $
=>
ÜÜ% '
x
ÜÜ( )
.
ÜÜ) *
idLine
ÜÜ* 0
==
ÜÜ1 3
Line
ÜÜ4 8
&&
ÜÜ9 ;
x
ÜÜ< =
.
ÜÜ= >
numberRoute
ÜÜ> I
==
ÜÜJ L
i
ÜÜM N
&&
ÜÜO Q
x
ÜÜR S
.
ÜÜS T
numTypeRoute
ÜÜT `
==
ÜÜa c
numTypeRoute
ÜÜd p
)
ÜÜp q
.
áá 
ToList
áá #
(
áá# $
)
áá$ %
;
áá% &
if
ââ 
(
ââ 
routes
ââ "
.
ââ" #
Count
ââ# (
>
ââ) *
$num
ââ+ ,
)
ââ, -
{
ää 
count
ãã !
=
ãã" #
$num
ãã$ %
;
ãã% &
foreach
åå #
(
åå$ %
var
åå% (
item
åå) -
in
åå. 0
routes
åå1 7
)
åå7 8
{
çç 
count
éé  %
++
éé% '
;
éé' (
Place
èè  %
place
èè& +
=
èè, -
context
èè. 5
.
èè5 6
Place
èè6 ;
.
èè; <
FirstOrDefault
èè< J
(
èèJ K
x
èèK L
=>
èèM O
x
èèP Q
.
èèQ R
idPlace
èèR Y
==
èèZ \
item
èè] a
.
èèa b
idPlace
èèb i
)
èèi j
;
èèj k
if
êê  "
(
êê# $
place
êê$ )
!=
êê* ,
null
êê- 1
)
êê1 2
{
ëë  !
nuevasRutas
íí$ /
.
íí/ 0
Add
íí0 3
(
íí3 4
new
íí4 7
RutasMostrar
íí8 D
(
ííD E
item
ííE I
.
ííI J
idRoute
ííJ Q
,
ííQ R
item
ííS W
.
ííW X
latitud
ííX _
,
íí_ `
item
íía e
.
ííe f
logintud
ííf n
,
íín o
place
ííp u
.
ííu v
descriptioníív Å
+ííÇ É
$strííÑ á
+ííà â
countííä è
,ííè ê
itemííë ï
.ííï ñ
statusííñ ú
,ííú ù
(ííû ü
intííü ¢
)íí¢ £
itemíí£ ß
.ííß ®
numPointíí® ∞
)íí∞ ±
)íí± ≤
;íí≤ ≥
}
ìì  !
}
îî 
if
ññ 
(
ññ  
nuevasRutas
ññ  +
.
ññ+ ,
Any
ññ, /
(
ññ/ 0
)
ññ0 1
)
ññ1 2
{
óó 
RutasMostrar
òò  ,
primeraRuta
òò- 8
=
òò9 :
nuevasRutas
òò; F
.
òòF G
FirstOrDefault
òòG U
(
òòU V
r
òòV W
=>
òòX Z
r
òò[ \
.
òò\ ]
status
òò] c
==
òòd f
$num
òòg h
)
òòh i
;
òòi j
if
ôô  "
(
ôô# $
primeraRuta
ôô$ /
!=
ôô0 2
null
ôô3 7
)
ôô7 8
{
öö  !
nuevasRutas
õõ$ /
=
õõ0 1
nuevasRutas
õõ2 =
.
úú( )
OrderBy
úú) 0
(
úú0 1
route
úú1 6
=>
úú7 9
route
úú: ?
.
úú? @
numPoint
úú@ H
)
úúH I
.
ùù( )
ToList
ùù) /
(
ùù/ 0
)
ùù0 1
;
ùù1 2
}
ûû  !
}
üü 
}
†† 
if
¢¢ 
(
¢¢ 
checkpoints
¢¢ '
.
¢¢' (
Count
¢¢( -
>
¢¢. /
$num
¢¢0 1
)
¢¢1 2
{
££ 
foreach
•• #
(
••$ %
var
••% (
item
••) -
in
••. 0
checkpoints
••1 <
)
••< =
{
¶¶ 
nuevasParadas
ßß  -
.
ßß- .
Add
ßß. 1
(
ßß1 2
new
ßß2 5
ParadasMostrar
ßß6 D
(
ßßD E
item
ßßE I
.
ßßI J
idCheckpoint
ßßJ V
,
ßßV W
item
ßßX \
.
ßß\ ]
description
ßß] h
,
ßßh i
item
ßßj n
.
ßßn o
status
ßßo u
,
ßßu v
item
ßßw {
.
ßß{ |
latitudßß| É
,ßßÉ Ñ
itemßßÖ â
.ßßâ ä
longitudßßä í
)ßßí ì
)ßßì î
;ßßî ï
}
®® 
if
™™ 
(
™™  
nuevasParadas
™™  -
.
™™- .
Any
™™. 1
(
™™1 2
)
™™2 3
)
™™3 4
{
´´ 
ParadasMostrar
¨¨  .
primeraParada
¨¨/ <
=
¨¨= >
nuevasParadas
¨¨? L
.
¨¨L M
FirstOrDefault
¨¨M [
(
¨¨[ \
r
¨¨\ ]
=>
¨¨^ `
r
¨¨a b
.
¨¨b c
status
¨¨c i
==
¨¨j l
$num
¨¨m n
)
¨¨n o
;
¨¨o p
if
≠≠  "
(
≠≠# $
primeraParada
≠≠$ 1
!=
≠≠2 4
null
≠≠5 9
)
≠≠9 :
{
ÆÆ  !
nuevasParadas
ØØ$ 1
=
ØØ2 3
nuevasParadas
ØØ4 A
.
∞∞( )
OrderBy
∞∞) 0
(
∞∞0 1
route
∞∞1 6
=>
∞∞7 9
muestraRutasMapas
∞∞: K
.
∞∞K L(
CalcularDistanciaHaversine
∞∞L f
(
∞∞f g
(
±±, -
decimal
±±- 4
)
±±4 5
primeraParada
±±5 B
.
±±B C
latitud
±±C J
,
±±J K
(
≤≤, -
decimal
≤≤- 4
)
≤≤4 5
primeraParada
≤≤5 B
.
≤≤B C
longitud
≤≤C K
,
≤≤K L
route
≥≥, 1
.
≥≥1 2
latitud
≥≥2 9
,
≥≥9 :
route
¥¥, 1
.
¥¥1 2
longitud
¥¥2 :
)
¥¥: ;
)
¥¥; <
.
µµ( )
ToList
µµ) /
(
µµ/ 0
)
µµ0 1
;
µµ1 2
}
∂∂  !
}
∑∑ 
}
∏∏ 
}
ππ 
List
∫∫ 
<
∫∫ 
string
∫∫ 
>
∫∫  
horas
∫∫! &
=
∫∫' (
new
∫∫) ,
List
∫∫- 1
<
∫∫1 2
string
∫∫2 8
>
∫∫8 9
(
∫∫9 :
)
∫∫: ;
;
∫∫; <
List
ªª 
<
ªª 
string
ªª 
>
ªª  
minutos
ªª! (
=
ªª) *
new
ªª+ .
List
ªª/ 3
<
ªª3 4
string
ªª4 :
>
ªª: ;
{
ªª< =
$str
ªª> B
,
ªªB C
$str
ªªD H
,
ªªH I
$str
ªªJ N
,
ªªN O
$str
ªªP T
,
ªªT U
$str
ªªV Z
,
ªªZ [
$str
ªª\ `
}
ªªa b
;
ªªb c
for
ºº 
(
ºº 
int
ºº 
hour
ºº !
=
ºº" #
$num
ºº$ %
;
ºº% &
hour
ºº' +
<
ºº, -
$num
ºº. 0
;
ºº0 1
hour
ºº2 6
++
ºº6 8
)
ºº8 9
{
ΩΩ 
horas
ææ 
.
ææ 
Add
ææ !
(
ææ! "
hour
ææ" &
.
ææ& '
ToString
ææ' /
(
ææ/ 0
$str
ææ0 4
)
ææ4 5
)
ææ5 6
;
ææ6 7
}
øø 

Checkpoint
¿¿ 
check
¿¿ $
=
¿¿% &
new
¿¿' *

Checkpoint
¿¿+ 5
(
¿¿5 6
)
¿¿6 7
;
¿¿7 8
using
¡¡ 
(
¡¡ 
dbModels
¡¡ #
context
¡¡$ +
=
¡¡, -
new
¡¡. 1
dbModels
¡¡2 :
(
¡¡: ;
)
¡¡; <
)
¡¡< =
check
¡¡> C
=
¡¡D E
context
¡¡F M
.
¡¡M N

Checkpoint
¡¡N X
.
¡¡X Y
Where
¡¡Y ^
(
¡¡^ _
x
¡¡_ `
=>
¡¡a c
x
¡¡d e
.
¡¡e f
status
¡¡f l
==
¡¡m o
$num
¡¡p q
&&
¡¡r t
x
¡¡u v
.
¡¡v w
idLine
¡¡w }
==¡¡~ Ä
Line¡¡Å Ö
&&¡¡Ü à
x¡¡â ä
.¡¡ä ã
numberRoute¡¡ã ñ
==¡¡ó ô
numTypeRoute¡¡ö ¶
)¡¡¶ ß
.¡¡ß ®
FirstOrDefault¡¡® ∂
(¡¡∂ ∑
)¡¡∑ ∏
;¡¡∏ π
if
¬¬ 
(
¬¬ 
check
¬¬ 
!=
¬¬  
null
¬¬! %
)
¬¬% &
{
√√ 
string
ƒƒ 
[
ƒƒ 
]
ƒƒ  
HourMinArrival
ƒƒ! /
=
ƒƒ0 1
check
ƒƒ2 7
.
ƒƒ7 8

minArrival
ƒƒ8 B
.
ƒƒB C
Trim
ƒƒC G
(
ƒƒG H
)
ƒƒH I
.
ƒƒI J
Split
ƒƒJ O
(
ƒƒO P
$char
ƒƒP S
)
ƒƒS T
;
ƒƒT U
string
≈≈ 
[
≈≈ 
]
≈≈  "
HourMinArrivalMarket
≈≈! 5
=
≈≈6 7
check
≈≈8 =
.
≈≈= >
minArrivalMarket
≈≈> N
.
≈≈N O
Trim
≈≈O S
(
≈≈S T
)
≈≈T U
.
≈≈U V
Split
≈≈V [
(
≈≈[ \
$char
≈≈\ _
)
≈≈_ `
;
≈≈` a
ViewBag
∆∆ 
.
∆∆  
Hours
∆∆  %
=
∆∆& '
new
∆∆( +

SelectList
∆∆, 6
(
∆∆6 7
horas
∆∆7 <
,
∆∆< =
HourMinArrival
∆∆> L
[
∆∆L M
$num
∆∆M N
]
∆∆N O
)
∆∆O P
;
∆∆P Q
ViewBag
«« 
.
««  
Minutes
««  '
=
««( )
new
««* -

SelectList
««. 8
(
««8 9
minutos
««9 @
,
««@ A
HourMinArrival
««B P
[
««P Q
$num
««Q R
]
««R S
)
««S T
;
««T U
ViewBag
»» 
.
»»  
Hours2
»»  &
=
»»' (
new
»») ,

SelectList
»»- 7
(
»»7 8
horas
»»8 =
,
»»= >"
HourMinArrivalMarket
»»? S
[
»»S T
$num
»»T U
]
»»U V
)
»»V W
;
»»W X
ViewBag
…… 
.
……  
Minutes2
……  (
=
……) *
new
……+ .

SelectList
……/ 9
(
……9 :
minutos
……: A
,
……A B"
HourMinArrivalMarket
……C W
[
……W X
$num
……X Y
]
……Y Z
)
……Z [
;
……[ \
}
   
else
ÀÀ 
{
ÃÃ 
ViewBag
ÕÕ 
.
ÕÕ  
Hours
ÕÕ  %
=
ÕÕ& '
new
ÕÕ( +

SelectList
ÕÕ, 6
(
ÕÕ6 7
horas
ÕÕ7 <
,
ÕÕ< =
$str
ÕÕ> B
)
ÕÕB C
;
ÕÕC D
ViewBag
ŒŒ 
.
ŒŒ  
Minutes
ŒŒ  '
=
ŒŒ( )
new
ŒŒ* -

SelectList
ŒŒ. 8
(
ŒŒ8 9
minutos
ŒŒ9 @
,
ŒŒ@ A
$str
ŒŒB F
)
ŒŒF G
;
ŒŒG H
ViewBag
œœ 
.
œœ  
Hours2
œœ  &
=
œœ' (
new
œœ) ,

SelectList
œœ- 7
(
œœ7 8
horas
œœ8 =
,
œœ= >
$str
œœ? C
)
œœC D
;
œœD E
ViewBag
–– 
.
––  
Minutes2
––  (
=
––) *
new
––+ .

SelectList
––/ 9
(
––9 :
minutos
––: A
,
––A B
$str
––C G
)
––G H
;
––H I
}
—— 
muestraRutasMapas
““ %
.
““% &
ListRutasMostrar
““& 6
=
““7 8
nuevasRutas
““9 D
;
““D E
muestraRutasMapas
”” %
.
””% & 
ListParadasMostrar
””& 8
=
””9 :
nuevasParadas
””; H
;
””H I
mapa
‘‘ 
.
‘‘ 
Add
‘‘ 
(
‘‘ 
muestraRutasMapas
‘‘ .
)
‘‘. /
;
‘‘/ 0
}
’’ 
Session
÷÷ 
[
÷÷ 
$str
÷÷ &
]
÷÷& '
=
÷÷( )
numTypeRoute
÷÷* 6
;
÷÷6 7
ViewBag
◊◊ 
.
◊◊ 
numTypeRoute
◊◊ $
=
◊◊% &
numTypeRoute
◊◊' 3
;
◊◊3 4
return
ÿÿ 
View
ÿÿ 
(
ÿÿ 
mapa
ÿÿ  
)
ÿÿ  !
;
ÿÿ! "
}
ŸŸ 
catch
⁄⁄ 
(
⁄⁄ 
	Exception
⁄⁄ 
)
⁄⁄ 
{
€€ 
return
‹‹ 
RedirectToAction
‹‹ '
(
‹‹' (
$str
‹‹( /
,
‹‹/ 0
$str
‹‹1 7
)
‹‹7 8
;
‹‹8 9
}
›› 
}
ﬁﬁ 	
[
ﬂﬂ 	
HttpPost
ﬂﬂ	 
]
ﬂﬂ 
public
‡‡ 
ActionResult
‡‡ 
Parada2
‡‡ #
(
‡‡# $
string
‡‡$ *
ubicaciones
‡‡+ 6
,
‡‡6 7
string
‡‡8 >
hora
‡‡? C
,
‡‡C D
string
‡‡E K
minuto
‡‡L R
,
‡‡R S
string
‡‡T Z
horaMercado
‡‡[ f
,
‡‡f g
string
‡‡h n
minutoMercado
‡‡o |
)
‡‡| }
{
·· 	
try
‚‚ 
{
„„ 
Login
‰‰ 
logi
‰‰ 
=
‰‰ 
new
‰‰  
Login
‰‰! &
(
‰‰& '
)
‰‰' (
;
‰‰( )
var
ÂÂ 

authResult
ÂÂ 
=
ÂÂ   
AutenticarPasosRol
ÂÂ! 3
(
ÂÂ3 4
$num
ÂÂ4 5
)
ÂÂ5 6
;
ÂÂ6 7
if
ÊÊ 
(
ÊÊ 

authResult
ÊÊ 
!=
ÊÊ !
null
ÊÊ" &
)
ÊÊ& '
return
ÊÊ( .

authResult
ÊÊ/ 9
;
ÊÊ9 :
string
ÁÁ 
Line
ÁÁ 
=
ÁÁ 
logi
ÁÁ "
.
ÁÁ" # 
GetLineaFromCookie
ÁÁ# 5
(
ÁÁ5 6
Request
ÁÁ6 =
)
ÁÁ= >
.
ÁÁ> ?
ToString
ÁÁ? G
(
ÁÁG H
)
ÁÁH I
;
ÁÁI J
if
ËË 
(
ËË 
Session
ËË 
[
ËË 
$str
ËË *
]
ËË* +
==
ËË, .
null
ËË/ 3
)
ËË3 4
{
ÈÈ 
}
ÎÎ 
int
ÏÏ 
numTypeRoute
ÏÏ  
=
ÏÏ! "
int
ÏÏ# &
.
ÏÏ& '
Parse
ÏÏ' ,
(
ÏÏ, -
Session
ÏÏ- 4
[
ÏÏ4 5
$str
ÏÏ5 C
]
ÏÏC D
.
ÏÏD E
ToString
ÏÏE M
(
ÏÏM N
)
ÏÏN O
)
ÏÏO P
;
ÏÏP Q

Checkpoint
ÌÌ 
check
ÌÌ  
=
ÌÌ! "
new
ÌÌ# &

Checkpoint
ÌÌ' 1
(
ÌÌ1 2
)
ÌÌ2 3
;
ÌÌ3 4
Route
ÓÓ 
route
ÓÓ 
=
ÓÓ 
new
ÓÓ !
Route
ÓÓ" '
(
ÓÓ' (
)
ÓÓ( )
;
ÓÓ) *
using
ÔÔ 
(
ÔÔ 
dbModels
ÔÔ 
context
ÔÔ  '
=
ÔÔ( )
new
ÔÔ* -
dbModels
ÔÔ. 6
(
ÔÔ6 7
)
ÔÔ7 8
)
ÔÔ8 9
check
ÔÔ: ?
=
ÔÔ@ A
context
ÔÔB I
.
ÔÔI J

Checkpoint
ÔÔJ T
.
ÔÔT U
Where
ÔÔU Z
(
ÔÔZ [
x
ÔÔ[ \
=>
ÔÔ] _
x
ÔÔ` a
.
ÔÔa b
status
ÔÔb h
==
ÔÔi k
$num
ÔÔl m
&&
ÔÔn p
x
ÔÔq r
.
ÔÔr s
idLine
ÔÔs y
==
ÔÔz |
LineÔÔ} Å
&&ÔÔÇ Ñ
xÔÔÖ Ü
.ÔÔÜ á
numberRouteÔÔá í
==ÔÔì ï
numTypeRouteÔÔñ ¢
)ÔÔ¢ £
.ÔÔ£ §
FirstOrDefaultÔÔ§ ≤
(ÔÔ≤ ≥
)ÔÔ≥ ¥
;ÔÔ¥ µ
using
 
(
 
dbModels
 
context
  '
=
( )
new
* -
dbModels
. 6
(
6 7
)
7 8
)
8 9
route
: ?
=
@ A
context
B I
.
I J
Route
J O
.
O P
Where
P U
(
U V
x
V W
=>
X Z
x
[ \
.
\ ]
status
] c
==
d f
$num
g h
&&
i k
x
l m
.
m n
idLine
n t
==
u w
Line
x |
&&
} 
xÄ Å
.Å Ç
numberRouteÇ ç
==é ê
$numë í
&&ì ï
xñ ó
.ó ò
numTypeRouteò §
==• ß
numTypeRoute® ¥
)¥ µ
.µ ∂
FirstOrDefault∂ ƒ
(ƒ ≈
)≈ ∆
;∆ «
if
ÒÒ 
(
ÒÒ 
check
ÒÒ 
!=
ÒÒ 
null
ÒÒ !
&&
ÒÒ" $
route
ÒÒ% *
!=
ÒÒ+ -
null
ÒÒ. 2
)
ÒÒ2 3
using
ÚÚ 
(
ÚÚ 
dbModels
ÚÚ #
context
ÚÚ$ +
=
ÚÚ, -
new
ÚÚ. 1
dbModels
ÚÚ2 :
(
ÚÚ: ;
)
ÚÚ; <
)
ÚÚ< =
{
ÛÛ 
string
ÙÙ 
[
ÙÙ 
]
ÙÙ  ,
seccionesNombreLatitudLongitud
ÙÙ! ?
=
ÙÙ@ A
ubicaciones
ÙÙB M
.
ÙÙM N
Split
ÙÙN S
(
ÙÙS T
$char
ÙÙT W
)
ÙÙW X
;
ÙÙX Y
if
ıı 
(
ıı ,
seccionesNombreLatitudLongitud
ıı :
.
ıı: ;
Length
ıı; A
>=
ııB D
$num
ııE F
)
ııF G
{
ˆˆ 
check
˜˜ !
.
˜˜! "
description
˜˜" -
=
˜˜. /
$str
˜˜0 I
;
˜˜I J
check
¯¯ !
.
¯¯! "
latitud
¯¯" )
=
¯¯* +
Convert
¯¯, 3
.
¯¯3 4
	ToDecimal
¯¯4 =
(
¯¯= >,
seccionesNombreLatitudLongitud
¯¯> \
[
¯¯\ ]
$num
¯¯] ^
]
¯¯^ _
.
¯¯_ `
Trim
¯¯` d
(
¯¯d e
)
¯¯e f
,
¯¯f g
System
¯¯h n
.
¯¯n o
Globalization
¯¯o |
.
¯¯| }
CultureInfo¯¯} à
.¯¯à â 
InvariantCulture¯¯â ô
)¯¯ô ö
;¯¯ö õ
check
˘˘ !
.
˘˘! "
longitud
˘˘" *
=
˘˘+ ,
Convert
˘˘- 4
.
˘˘4 5
	ToDecimal
˘˘5 >
(
˘˘> ?,
seccionesNombreLatitudLongitud
˘˘? ]
[
˘˘] ^
$num
˘˘^ _
]
˘˘_ `
.
˘˘` a
Trim
˘˘a e
(
˘˘e f
)
˘˘f g
,
˘˘g h
System
˘˘i o
.
˘˘o p
Globalization
˘˘p }
.
˘˘} ~
CultureInfo˘˘~ â
.˘˘â ä 
InvariantCulture˘˘ä ö
)˘˘ö õ
;˘˘õ ú
route
˙˙ !
.
˙˙! "
latitud
˙˙" )
=
˙˙* +
Convert
˙˙, 3
.
˙˙3 4
	ToDecimal
˙˙4 =
(
˙˙= >,
seccionesNombreLatitudLongitud
˙˙> \
[
˙˙\ ]
$num
˙˙] ^
]
˙˙^ _
.
˙˙_ `
Trim
˙˙` d
(
˙˙d e
)
˙˙e f
,
˙˙f g
System
˙˙h n
.
˙˙n o
Globalization
˙˙o |
.
˙˙| }
CultureInfo˙˙} à
.˙˙à â 
InvariantCulture˙˙â ô
)˙˙ô ö
;˙˙ö õ
route
˚˚ !
.
˚˚! "
logintud
˚˚" *
=
˚˚+ ,
Convert
˚˚- 4
.
˚˚4 5
	ToDecimal
˚˚5 >
(
˚˚> ?,
seccionesNombreLatitudLongitud
˚˚? ]
[
˚˚] ^
$num
˚˚^ _
]
˚˚_ `
.
˚˚` a
Trim
˚˚a e
(
˚˚e f
)
˚˚f g
,
˚˚g h
System
˚˚i o
.
˚˚o p
Globalization
˚˚p }
.
˚˚} ~
CultureInfo˚˚~ â
.˚˚â ä 
InvariantCulture˚˚ä ö
)˚˚ö õ
;˚˚õ ú
}
¸¸ 
check
˝˝ 
.
˝˝ 

minArrival
˝˝ (
=
˝˝) *
hora
˝˝+ /
+
˝˝0 1
$str
˝˝2 5
+
˝˝6 7
minuto
˝˝8 >
;
˝˝> ?
check
˛˛ 
.
˛˛ 
minArrivalMarket
˛˛ .
=
˛˛/ 0
horaMercado
˛˛1 <
+
˛˛= >
$str
˛˛? B
+
˛˛C D
minutoMercado
˛˛E R
;
˛˛R S
context
ˇˇ 
.
ˇˇ  
Entry
ˇˇ  %
(
ˇˇ% &
route
ˇˇ& +
)
ˇˇ+ ,
.
ˇˇ, -
State
ˇˇ- 2
=
ˇˇ3 4
System
ˇˇ5 ;
.
ˇˇ; <
Data
ˇˇ< @
.
ˇˇ@ A
Entity
ˇˇA G
.
ˇˇG H
EntityState
ˇˇH S
.
ˇˇS T
Modified
ˇˇT \
;
ˇˇ\ ]
context
ÄÄ 
.
ÄÄ  
Entry
ÄÄ  %
(
ÄÄ% &
check
ÄÄ& +
)
ÄÄ+ ,
.
ÄÄ, -
State
ÄÄ- 2
=
ÄÄ3 4
System
ÄÄ5 ;
.
ÄÄ; <
Data
ÄÄ< @
.
ÄÄ@ A
Entity
ÄÄA G
.
ÄÄG H
EntityState
ÄÄH S
.
ÄÄS T
Modified
ÄÄT \
;
ÄÄ\ ]
context
ÅÅ 
.
ÅÅ  
SaveChanges
ÅÅ  +
(
ÅÅ+ ,
)
ÅÅ, -
;
ÅÅ- .
}
ÇÇ 
else
ÉÉ 
{
ÑÑ 
using
ÖÖ 
(
ÖÖ 
dbModels
ÖÖ #
context
ÖÖ$ +
=
ÖÖ, -
new
ÖÖ. 1
dbModels
ÖÖ2 :
(
ÖÖ: ;
)
ÖÖ; <
)
ÖÖ< =
{
ÜÜ 
check
áá 
=
áá 
new
áá  #

Checkpoint
áá$ .
(
áá. /
)
áá/ 0
;
áá0 1
route
àà 
=
àà 
new
àà  #
Route
àà$ )
(
àà) *
)
àà* +
;
àà+ ,
string
ââ 
[
ââ 
]
ââ  ,
seccionesNombreLatitudLongitud
ââ! ?
=
ââ@ A
ubicaciones
ââB M
.
ââM N
Split
ââN S
(
ââS T
$char
ââT W
)
ââW X
;
ââX Y
if
ää 
(
ää ,
seccionesNombreLatitudLongitud
ää :
.
ää: ;
Length
ää; A
>=
ääB D
$num
ääE F
)
ääF G
{
ãã 
string
åå "
description
åå# .
=
åå/ 0,
seccionesNombreLatitudLongitud
åå1 O
[
ååO P
$num
ååP Q
]
ååQ R
.
ååR S
Trim
ååS W
(
ååW X
)
ååX Y
;
ååY Z
Place
çç !
place
çç" '
=
çç( )
context
çç* 1
.
çç1 2
Place
çç2 7
.
çç7 8
FirstOrDefault
çç8 F
(
ççF G
x
ççG H
=>
ççI K
x
ççL M
.
ççM N
description
ççN Y
==
ççZ \
description
çç] h
)
ççh i
;
ççi j
if
éé 
(
éé  
place
éé  %
==
éé& (
null
éé) -
)
éé- .
{
èè 
place
êê  %
=
êê& '
new
êê( +
Place
êê, 1
{
ëë  !
description
íí$ /
=
íí0 1
description
íí2 =
}
ìì  !
;
ìì! "
context
îî  '
.
îî' (
Place
îî( -
.
îî- .
Add
îî. 1
(
îî1 2
place
îî2 7
)
îî7 8
;
îî8 9
context
ïï  '
.
ïï' (
SaveChanges
ïï( 3
(
ïï3 4
)
ïï4 5
;
ïï5 6
}
ññ 
check
óó !
.
óó! "
description
óó" -
=
óó. /
$str
óó0 I
;
óóI J
check
òò !
.
òò! "
latitud
òò" )
=
òò* +
Convert
òò, 3
.
òò3 4
	ToDecimal
òò4 =
(
òò= >,
seccionesNombreLatitudLongitud
òò> \
[
òò\ ]
$num
òò] ^
]
òò^ _
.
òò_ `
Trim
òò` d
(
òòd e
)
òòe f
,
òòf g
System
òòh n
.
òòn o
Globalization
òòo |
.
òò| }
CultureInfoòò} à
.òòà â 
InvariantCultureòòâ ô
)òòô ö
;òòö õ
check
ôô !
.
ôô! "
longitud
ôô" *
=
ôô+ ,
Convert
ôô- 4
.
ôô4 5
	ToDecimal
ôô5 >
(
ôô> ?,
seccionesNombreLatitudLongitud
ôô? ]
[
ôô] ^
$num
ôô^ _
]
ôô_ `
.
ôô` a
Trim
ôôa e
(
ôôe f
)
ôôf g
,
ôôg h
System
ôôi o
.
ôôo p
Globalization
ôôp }
.
ôô} ~
CultureInfoôô~ â
.ôôâ ä 
InvariantCultureôôä ö
)ôôö õ
;ôôõ ú
check
öö !
.
öö! "
status
öö" (
=
öö) *
$num
öö+ ,
;
öö, -
check
öö. 3
.
öö3 4
numberRoute
öö4 ?
=
öö@ A
numTypeRoute
ööB N
;
ööN O
check
õõ !
.
õõ! "
idLine
õõ" (
=
õõ) *
Line
õõ+ /
;
õõ/ 0
check
õõ1 6
.
õõ6 7

minArrival
õõ7 A
=
õõB C
hora
õõD H
+
õõI J
$str
õõK N
+
õõO P
minuto
õõQ W
;
õõW X
check
õõY ^
.
õõ^ _
minArrivalMarket
õõ_ o
=
õõp q
horaMercado
õõr }
+
õõ~ 
$strõõÄ É
+õõÑ Ö
minutoMercadoõõÜ ì
;õõì î
route
ùù !
.
ùù! "
latitud
ùù" )
=
ùù* +
Convert
ùù, 3
.
ùù3 4
	ToDecimal
ùù4 =
(
ùù= >,
seccionesNombreLatitudLongitud
ùù> \
[
ùù\ ]
$num
ùù] ^
]
ùù^ _
.
ùù_ `
Trim
ùù` d
(
ùùd e
)
ùùe f
,
ùùf g
System
ùùh n
.
ùùn o
Globalization
ùùo |
.
ùù| }
CultureInfoùù} à
.ùùà â 
InvariantCultureùùâ ô
)ùùô ö
;ùùö õ
route
ûû !
.
ûû! "
logintud
ûû" *
=
ûû+ ,
Convert
ûû- 4
.
ûû4 5
	ToDecimal
ûû5 >
(
ûû> ?,
seccionesNombreLatitudLongitud
ûû? ]
[
ûû] ^
$num
ûû^ _
]
ûû_ `
.
ûû` a
Trim
ûûa e
(
ûûe f
)
ûûf g
,
ûûg h
System
ûûi o
.
ûûo p
Globalization
ûûp }
.
ûû} ~
CultureInfoûû~ â
.ûûâ ä 
InvariantCultureûûä ö
)ûûö õ
;ûûõ ú
route
üü !
.
üü! "
idPlace
üü" )
=
üü* +
place
üü, 1
.
üü1 2
idPlace
üü2 9
;
üü9 :
route
üü; @
.
üü@ A
idLine
üüA G
=
üüH I
Line
üüJ N
;
üüN O
route
üüP U
.
üüU V
numberRoute
üüV a
=
üüb c
$num
üüd e
;
üüe f
route
üüg l
.
üül m
status
üüm s
=
üüt u
$num
üüv w
;
üüw x
route
üüy ~
.
üü~ 
numPointüü á
=üüà â
$numüüä ã
;üüã å
route
†† !
.
††! "
numTypeRoute
††" .
=
††/ 0
numTypeRoute
††1 =
;
††= >
context
°° #
.
°°# $
Route
°°$ )
.
°°) *
Add
°°* -
(
°°- .
route
°°. 3
)
°°3 4
;
°°4 5
context
¢¢ #
.
¢¢# $

Checkpoint
¢¢$ .
.
¢¢. /
Add
¢¢/ 2
(
¢¢2 3
check
¢¢3 8
)
¢¢8 9
;
¢¢9 :
context
££ #
.
££# $
SaveChanges
££$ /
(
££/ 0
)
££0 1
;
££1 2
Session
§§ #
[
§§# $
$str
§§$ 2
]
§§2 3
=
§§4 5
null
§§6 :
;
§§: ;
}
•• 
}
¶¶ 
}
ßß 
return
®® 
RedirectToAction
®® '
(
®®' (
$str
®®( 2
,
®®2 3
$str
®®4 :
)
®®: ;
;
®®; <
}
©© 
catch
™™ 
(
™™ 
	Exception
™™ 
)
™™ 
{
´´ 
return
¨¨ 
RedirectToAction
¨¨ '
(
¨¨' (
$str
¨¨( /
,
¨¨/ 0
$str
¨¨1 7
)
¨¨7 8
;
¨¨8 9
}
≠≠ 
}
ÆÆ 	
public
ØØ 
ActionResult
ØØ 
EditParada1Check
ØØ ,
(
ØØ, -
int
ØØ- 0
numTypeRoute
ØØ1 =
)
ØØ= >
{
∞∞ 	
try
±± 
{
≤≤ 
Login
≥≥ 
logi
≥≥ 
=
≥≥ 
new
≥≥  
Login
≥≥! &
(
≥≥& '
)
≥≥' (
;
≥≥( )
var
¥¥ 

authResult
¥¥ 
=
¥¥   
AutenticarPasosRol
¥¥! 3
(
¥¥3 4
$num
¥¥4 5
)
¥¥5 6
;
¥¥6 7
if
µµ 
(
µµ 

authResult
µµ 
!=
µµ !
null
µµ" &
)
µµ& '
return
µµ( .

authResult
µµ/ 9
;
µµ9 :
string
∑∑ 
Line
∑∑ 
=
∑∑ 
logi
∑∑ "
.
∑∑" # 
GetLineaFromCookie
∑∑# 5
(
∑∑5 6
Request
∑∑6 =
)
∑∑= >
.
∑∑> ?
ToString
∑∑? G
(
∑∑G H
)
∑∑H I
;
∑∑I J
List
∏∏ 
<
∏∏ 
MuestraRutasMapas
∏∏ &
>
∏∏& '
mapa
∏∏( ,
=
∏∏- .
new
∏∏/ 2
List
∏∏3 7
<
∏∏7 8
MuestraRutasMapas
∏∏8 I
>
∏∏I J
(
∏∏J K
)
∏∏K L
;
∏∏L M
int
ππ 
count
ππ 
=
ππ 
$num
ππ 
;
ππ 
for
∫∫ 
(
∫∫ 
int
∫∫ 
i
∫∫ 
=
∫∫ 
$num
∫∫ 
;
∫∫ 
i
∫∫  !
<=
∫∫" $
$num
∫∫% &
;
∫∫& '
i
∫∫( )
++
∫∫) +
)
∫∫+ ,
{
ªª 
MuestraRutasMapas
ºº %
muestraRutasMapas
ºº& 7
=
ºº8 9
new
ºº: =
MuestraRutasMapas
ºº> O
{
ΩΩ 
ListRutasMostrar
ææ (
=
ææ) *
new
ææ+ .
List
ææ/ 3
<
ææ3 4
RutasMostrar
ææ4 @
>
ææ@ A
(
ææA B
)
ææB C
,
ææC D 
ListParadasMostrar
øø *
=
øø+ ,
new
øø- 0
List
øø1 5
<
øø5 6
ParadasMostrar
øø6 D
>
øøD E
(
øøE F
)
øøF G
,
øøG H

NumeroRuta
¿¿ "
=
¿¿# $
i
¿¿% &
}
¡¡ 
;
¡¡ 
List
√√ 
<
√√ 
RutasMostrar
√√ %
>
√√% &
nuevasRutas
√√' 2
=
√√3 4
new
√√5 8
List
√√9 =
<
√√= >
RutasMostrar
√√> J
>
√√J K
(
√√K L
)
√√L M
;
√√M N
List
ƒƒ 
<
ƒƒ 
ParadasMostrar
ƒƒ '
>
ƒƒ' (
nuevasParadas
ƒƒ) 6
=
ƒƒ7 8
new
ƒƒ9 <
List
ƒƒ= A
<
ƒƒA B
ParadasMostrar
ƒƒB P
>
ƒƒP Q
(
ƒƒQ R
)
ƒƒR S
;
ƒƒS T
using
∆∆ 
(
∆∆ 
dbModels
∆∆ #
context
∆∆$ +
=
∆∆, -
new
∆∆. 1
dbModels
∆∆2 :
(
∆∆: ;
)
∆∆; <
)
∆∆< =
{
«« 
var
»» 
checkpoints
»» '
=
»»( )
context
»»* 1
.
»»1 2

Checkpoint
»»2 <
.
»»< =
Where
»»= B
(
»»B C
x
»»C D
=>
»»E G
x
»»H I
.
»»I J
idLine
»»J P
==
»»Q S
Line
»»T X
&&
»»Y [
x
»»\ ]
.
»»] ^
numberRoute
»»^ i
==
»»j l
numTypeRoute
»»m y
&&
»»z |
x
»»} ~
.
»»~ 
status»» Ö
==»»Ü à
$num»»â ä
)»»ä ã
.»»ã å
ToList»»å í
(»»í ì
)»»ì î
;»»î ï
var
…… 
routes
…… "
=
……# $
context
……% ,
.
……, -
Route
……- 2
.
   
Where
   "
(
  " #
x
  # $
=>
  % '
x
  ( )
.
  ) *
idLine
  * 0
==
  1 3
Line
  4 8
&&
  9 ;
x
  < =
.
  = >
numberRoute
  > I
==
  J L
i
  M N
&&
  O Q
x
  R S
.
  S T
numTypeRoute
  T `
==
  a c
numTypeRoute
  d p
)
  p q
.
ÀÀ 
ToList
ÀÀ #
(
ÀÀ# $
)
ÀÀ$ %
;
ÀÀ% &
if
ÕÕ 
(
ÕÕ 
routes
ÕÕ "
.
ÕÕ" #
Count
ÕÕ# (
>
ÕÕ) *
$num
ÕÕ+ ,
)
ÕÕ, -
{
ŒŒ 
count
œœ !
=
œœ" #
$num
œœ$ %
;
œœ% &
foreach
–– #
(
––$ %
var
––% (
item
––) -
in
––. 0
routes
––1 7
)
––7 8
{
—— 
count
““  %
++
““% '
;
““' (
Place
””  %
place
””& +
=
””, -
context
””. 5
.
””5 6
Place
””6 ;
.
””; <
FirstOrDefault
””< J
(
””J K
x
””K L
=>
””M O
x
””P Q
.
””Q R
idPlace
””R Y
==
””Z \
item
””] a
.
””a b
idPlace
””b i
)
””i j
;
””j k
if
‘‘  "
(
‘‘# $
place
‘‘$ )
!=
‘‘* ,
null
‘‘- 1
)
‘‘1 2
{
’’  !
nuevasRutas
÷÷$ /
.
÷÷/ 0
Add
÷÷0 3
(
÷÷3 4
new
÷÷4 7
RutasMostrar
÷÷8 D
(
÷÷D E
item
÷÷E I
.
÷÷I J
idRoute
÷÷J Q
,
÷÷Q R
item
÷÷S W
.
÷÷W X
latitud
÷÷X _
,
÷÷_ `
item
÷÷a e
.
÷÷e f
logintud
÷÷f n
,
÷÷n o
place
÷÷p u
.
÷÷u v
description÷÷v Å
+÷÷Ç É
$str÷÷Ñ á
+÷÷à â
count÷÷ä è
,÷÷è ê
item÷÷ë ï
.÷÷ï ñ
status÷÷ñ ú
,÷÷ú ù
(÷÷û ü
int÷÷ü ¢
)÷÷¢ £
item÷÷£ ß
.÷÷ß ®
numPoint÷÷® ∞
)÷÷∞ ±
)÷÷± ≤
;÷÷≤ ≥
}
◊◊  !
}
ÿÿ 
if
⁄⁄ 
(
⁄⁄  
nuevasRutas
⁄⁄  +
.
⁄⁄+ ,
Any
⁄⁄, /
(
⁄⁄/ 0
)
⁄⁄0 1
)
⁄⁄1 2
{
€€ 
RutasMostrar
‹‹  ,
primeraRuta
‹‹- 8
=
‹‹9 :
nuevasRutas
‹‹; F
.
‹‹F G
FirstOrDefault
‹‹G U
(
‹‹U V
r
‹‹V W
=>
‹‹X Z
r
‹‹[ \
.
‹‹\ ]
status
‹‹] c
==
‹‹d f
$num
‹‹g h
)
‹‹h i
;
‹‹i j
if
››  "
(
››# $
primeraRuta
››$ /
!=
››0 2
null
››3 7
)
››7 8
{
ﬁﬁ  !
nuevasRutas
ﬂﬂ$ /
=
ﬂﬂ0 1
nuevasRutas
ﬂﬂ2 =
.
‡‡( )
OrderBy
‡‡) 0
(
‡‡0 1
route
‡‡1 6
=>
‡‡7 9
route
‡‡: ?
.
‡‡? @
numPoint
‡‡@ H
)
‡‡H I
.
··( )
ToList
··) /
(
··/ 0
)
··0 1
;
··1 2
}
‚‚  !
}
„„ 
}
‰‰ 
if
ÊÊ 
(
ÊÊ 
checkpoints
ÊÊ '
.
ÊÊ' (
Count
ÊÊ( -
>
ÊÊ. /
$num
ÊÊ0 1
)
ÊÊ1 2
{
ÁÁ 
foreach
ÈÈ #
(
ÈÈ$ %
var
ÈÈ% (
item
ÈÈ) -
in
ÈÈ. 0
checkpoints
ÈÈ1 <
)
ÈÈ< =
{
ÍÍ 
nuevasParadas
ÎÎ  -
.
ÎÎ- .
Add
ÎÎ. 1
(
ÎÎ1 2
new
ÎÎ2 5
ParadasMostrar
ÎÎ6 D
(
ÎÎD E
item
ÎÎE I
.
ÎÎI J
idCheckpoint
ÎÎJ V
,
ÎÎV W
item
ÎÎX \
.
ÎÎ\ ]
description
ÎÎ] h
,
ÎÎh i
item
ÎÎj n
.
ÎÎn o
status
ÎÎo u
,
ÎÎu v
item
ÎÎw {
.
ÎÎ{ |
latitudÎÎ| É
,ÎÎÉ Ñ
itemÎÎÖ â
.ÎÎâ ä
longitudÎÎä í
)ÎÎí ì
)ÎÎì î
;ÎÎî ï
}
ÏÏ 
if
ÓÓ 
(
ÓÓ  
nuevasParadas
ÓÓ  -
.
ÓÓ- .
Any
ÓÓ. 1
(
ÓÓ1 2
)
ÓÓ2 3
)
ÓÓ3 4
{
ÔÔ 
ParadasMostrar
  .
primeraParada
/ <
=
= >
nuevasParadas
? L
.
L M
FirstOrDefault
M [
(
[ \
r
\ ]
=>
^ `
r
a b
.
b c
status
c i
==
j l
$num
m n
)
n o
;
o p
if
ÒÒ  "
(
ÒÒ# $
primeraParada
ÒÒ$ 1
!=
ÒÒ2 4
null
ÒÒ5 9
)
ÒÒ9 :
{
ÚÚ  !
nuevasParadas
ÛÛ$ 1
=
ÛÛ2 3
nuevasParadas
ÛÛ4 A
.
ÙÙ( )
OrderBy
ÙÙ) 0
(
ÙÙ0 1
route
ÙÙ1 6
=>
ÙÙ7 9
muestraRutasMapas
ÙÙ: K
.
ÙÙK L(
CalcularDistanciaHaversine
ÙÙL f
(
ÙÙf g
(
ıı, -
decimal
ıı- 4
)
ıı4 5
primeraParada
ıı5 B
.
ııB C
latitud
ııC J
,
ııJ K
(
ˆˆ, -
decimal
ˆˆ- 4
)
ˆˆ4 5
primeraParada
ˆˆ5 B
.
ˆˆB C
longitud
ˆˆC K
,
ˆˆK L
route
˜˜, 1
.
˜˜1 2
latitud
˜˜2 9
,
˜˜9 :
route
¯¯, 1
.
¯¯1 2
longitud
¯¯2 :
)
¯¯: ;
)
¯¯; <
.
˘˘( )
ToList
˘˘) /
(
˘˘/ 0
)
˘˘0 1
;
˘˘1 2
}
˙˙  !
}
˚˚ 
}
¸¸ 
}
˝˝ 
muestraRutasMapas
˛˛ %
.
˛˛% &
ListRutasMostrar
˛˛& 6
=
˛˛7 8
nuevasRutas
˛˛9 D
;
˛˛D E
muestraRutasMapas
ˇˇ %
.
ˇˇ% & 
ListParadasMostrar
ˇˇ& 8
=
ˇˇ9 :
nuevasParadas
ˇˇ; H
;
ˇˇH I
ViewBag
ÄÄ 
.
ÄÄ 
numTypeRoute
ÄÄ (
=
ÄÄ) *
numTypeRoute
ÄÄ+ 7
;
ÄÄ7 8
mapa
ÅÅ 
.
ÅÅ 
Add
ÅÅ 
(
ÅÅ 
muestraRutasMapas
ÅÅ .
)
ÅÅ. /
;
ÅÅ/ 0
}
ÇÇ 
return
ÑÑ 
View
ÑÑ 
(
ÑÑ 
mapa
ÑÑ  
)
ÑÑ  !
;
ÑÑ! "
}
ÖÖ 
catch
ÜÜ 
(
ÜÜ 
	Exception
ÜÜ 
)
ÜÜ 
{
áá 
return
àà 
RedirectToAction
àà '
(
àà' (
$str
àà( /
,
àà/ 0
$str
àà1 7
)
àà7 8
;
àà8 9
}
ââ 
}
ää 	
[
ãã 	
HttpPost
ãã	 
]
ãã 
public
åå 
ActionResult
åå 
EditParada1Check
åå ,
(
åå, -
string
åå- 3
ubicaciones
åå4 ?
,
åå? @
string
ååA G
hora
ååH L
,
ååL M
string
ååN T
minuto
ååU [
,
åå[ \
string
åå] c
horaMercado
ååd o
,
ååo p
string
ååq w
minutoMercadoååx Ö
,ååÖ Ü
intååá ä
numTypeRouteååã ó
)ååó ò
{
çç 	
try
éé 
{
èè 
Login
êê 
logi
êê 
=
êê 
new
êê  
Login
êê! &
(
êê& '
)
êê' (
;
êê( )
var
ëë 

authResult
ëë 
=
ëë   
AutenticarPasosRol
ëë! 3
(
ëë3 4
$num
ëë4 5
)
ëë5 6
;
ëë6 7
if
íí 
(
íí 

authResult
íí 
!=
íí !
null
íí" &
)
íí& '
return
íí( .

authResult
íí/ 9
;
íí9 :
string
ìì 
Line
ìì 
=
ìì 
logi
ìì "
.
ìì" # 
GetLineaFromCookie
ìì# 5
(
ìì5 6
Request
ìì6 =
)
ìì= >
.
ìì> ?
ToString
ìì? G
(
ììG H
)
ììH I
;
ììI J

Checkpoint
îî 
check
îî  
=
îî! "
new
îî# &

Checkpoint
îî' 1
(
îî1 2
)
îî2 3
;
îî3 4
Route
ïï 
route
ïï 
=
ïï 
new
ïï !
Route
ïï" '
(
ïï' (
)
ïï( )
;
ïï) *
using
ññ 
(
ññ 
dbModels
ññ 
context
ññ  '
=
ññ( )
new
ññ* -
dbModels
ññ. 6
(
ññ6 7
)
ññ7 8
)
ññ8 9
check
ññ: ?
=
ññ@ A
context
ññB I
.
ññI J

Checkpoint
ññJ T
.
ññT U
Where
ññU Z
(
ññZ [
x
ññ[ \
=>
ññ] _
x
ññ` a
.
ñña b
idLine
ññb h
==
ññi k
Line
ññl p
&&
ññq s
x
ññt u
.
ññu v
status
ññv |
==
ññ} 
$numññÄ Å
&&ññÇ Ñ
xññÖ Ü
.ññÜ á
numberRouteññá í
==ññì ï
numTypeRouteñññ ¢
)ññ¢ £
.ññ£ §
FirstOrDefaultññ§ ≤
(ññ≤ ≥
)ññ≥ ¥
;ññ¥ µ
using
óó 
(
óó 
dbModels
óó 
context
óó  '
=
óó( )
new
óó* -
dbModels
óó. 6
(
óó6 7
)
óó7 8
)
óó8 9
route
óó: ?
=
óó@ A
context
óóB I
.
óóI J
Route
óóJ O
.
óóO P
Where
óóP U
(
óóU V
x
óóV W
=>
óóX Z
x
óó[ \
.
óó\ ]
idLine
óó] c
==
óód f
Line
óóg k
&&
óól n
x
óóo p
.
óóp q
status
óóq w
==
óóx z
$num
óó{ |
&&
óó} 
xóóÄ Å
.óóÅ Ç
numberRouteóóÇ ç
==óóé ê
$numóóë í
&&óóì ï
xóóñ ó
.óóó ò
numTypeRouteóóò §
==óó• ß
numTypeRouteóó® ¥
)óó¥ µ
.óóµ ∂
FirstOrDefaultóó∂ ƒ
(óóƒ ≈
)óó≈ ∆
;óó∆ «
using
òò 
(
òò 
dbModels
òò 
context
òò  '
=
òò( )
new
òò* -
dbModels
òò. 6
(
òò6 7
)
òò7 8
)
òò8 9
{
ôô 
string
õõ 
[
õõ 
]
õõ ,
seccionesNombreLatitudLongitud
õõ ;
=
õõ< =
ubicaciones
õõ> I
.
õõI J
Split
õõJ O
(
õõO P
$char
õõP S
)
õõS T
;
õõT U
if
úú 
(
úú ,
seccionesNombreLatitudLongitud
úú 6
.
úú6 7
Length
úú7 =
>=
úú> @
$num
úúA B
)
úúB C
{
ùù 
check
ûû 
.
ûû 
description
ûû )
=
ûû* +
$str
ûû, E
;
ûûE F
check
üü 
.
üü 
latitud
üü %
=
üü& '
Convert
üü( /
.
üü/ 0
	ToDecimal
üü0 9
(
üü9 :,
seccionesNombreLatitudLongitud
üü: X
[
üüX Y
$num
üüY Z
]
üüZ [
.
üü[ \
Trim
üü\ `
(
üü` a
)
üüa b
,
üüb c
System
üüd j
.
üüj k
Globalization
üük x
.
üüx y
CultureInfoüüy Ñ
.üüÑ Ö 
InvariantCultureüüÖ ï
)üüï ñ
;üüñ ó
check
†† 
.
†† 
longitud
†† &
=
††' (
Convert
††) 0
.
††0 1
	ToDecimal
††1 :
(
††: ;,
seccionesNombreLatitudLongitud
††; Y
[
††Y Z
$num
††Z [
]
††[ \
.
††\ ]
Trim
††] a
(
††a b
)
††b c
,
††c d
System
††e k
.
††k l
Globalization
††l y
.
††y z
CultureInfo††z Ö
.††Ö Ü 
InvariantCulture††Ü ñ
)††ñ ó
;††ó ò
route
°° 
.
°° 
latitud
°° %
=
°°& '
Convert
°°( /
.
°°/ 0
	ToDecimal
°°0 9
(
°°9 :,
seccionesNombreLatitudLongitud
°°: X
[
°°X Y
$num
°°Y Z
]
°°Z [
.
°°[ \
Trim
°°\ `
(
°°` a
)
°°a b
,
°°b c
System
°°d j
.
°°j k
Globalization
°°k x
.
°°x y
CultureInfo°°y Ñ
.°°Ñ Ö 
InvariantCulture°°Ö ï
)°°ï ñ
;°°ñ ó
route
¢¢ 
.
¢¢ 
logintud
¢¢ &
=
¢¢' (
Convert
¢¢) 0
.
¢¢0 1
	ToDecimal
¢¢1 :
(
¢¢: ;,
seccionesNombreLatitudLongitud
¢¢; Y
[
¢¢Y Z
$num
¢¢Z [
]
¢¢[ \
.
¢¢\ ]
Trim
¢¢] a
(
¢¢a b
)
¢¢b c
,
¢¢c d
System
¢¢e k
.
¢¢k l
Globalization
¢¢l y
.
¢¢y z
CultureInfo¢¢z Ö
.¢¢Ö Ü 
InvariantCulture¢¢Ü ñ
)¢¢ñ ó
;¢¢ó ò
check
§§ 
.
§§ 

minArrival
§§ (
=
§§) *
$str
§§+ 2
;
§§2 3
check
•• 
.
•• 
minArrivalMarket
•• .
=
••/ 0
$str
••1 8
;
••8 9
context
¶¶ 
.
¶¶  
Entry
¶¶  %
(
¶¶% &
route
¶¶& +
)
¶¶+ ,
.
¶¶, -
State
¶¶- 2
=
¶¶3 4
System
¶¶5 ;
.
¶¶; <
Data
¶¶< @
.
¶¶@ A
Entity
¶¶A G
.
¶¶G H
EntityState
¶¶H S
.
¶¶S T
Modified
¶¶T \
;
¶¶\ ]
context
ßß 
.
ßß  
Entry
ßß  %
(
ßß% &
check
ßß& +
)
ßß+ ,
.
ßß, -
State
ßß- 2
=
ßß3 4
System
ßß5 ;
.
ßß; <
Data
ßß< @
.
ßß@ A
Entity
ßßA G
.
ßßG H
EntityState
ßßH S
.
ßßS T
Modified
ßßT \
;
ßß\ ]
context
®® 
.
®®  
SaveChanges
®®  +
(
®®+ ,
)
®®, -
;
®®- .
}
©© 
}
´´ 
return
¨¨ 
RedirectToAction
¨¨ '
(
¨¨' (
$str
¨¨( /
,
¨¨/ 0
$str
¨¨1 8
,
¨¨8 9
new
¨¨: =
{
¨¨> ?
numTypeRoute
¨¨@ L
=
¨¨N O
numTypeRoute
¨¨P \
}
¨¨] ^
)
¨¨^ _
;
¨¨_ `
}
≠≠ 
catch
ÆÆ 
(
ÆÆ 
	Exception
ÆÆ 
)
ÆÆ 
{
ØØ 
return
∞∞ 
RedirectToAction
∞∞ '
(
∞∞' (
$str
∞∞( /
,
∞∞/ 0
$str
∞∞1 7
)
∞∞7 8
;
∞∞8 9
}
±± 
}
≤≤ 	
public
≥≥ 
ActionResult
≥≥ 
EditParada2Check
≥≥ ,
(
≥≥, -
int
≥≥- 0
numTypeRoute
≥≥1 =
)
≥≥= >
{
¥¥ 	
try
µµ 
{
∂∂ 
Login
∑∑ 
logi
∑∑ 
=
∑∑ 
new
∑∑  
Login
∑∑! &
(
∑∑& '
)
∑∑' (
;
∑∑( )
var
∏∏ 

authResult
∏∏ 
=
∏∏   
AutenticarPasosRol
∏∏! 3
(
∏∏3 4
$num
∏∏4 5
)
∏∏5 6
;
∏∏6 7
if
ππ 
(
ππ 

authResult
ππ 
!=
ππ !
null
ππ" &
)
ππ& '
return
ππ( .

authResult
ππ/ 9
;
ππ9 :
string
ªª 
Line
ªª 
=
ªª 
logi
ªª "
.
ªª" # 
GetLineaFromCookie
ªª# 5
(
ªª5 6
Request
ªª6 =
)
ªª= >
.
ªª> ?
ToString
ªª? G
(
ªªG H
)
ªªH I
;
ªªI J
List
ºº 
<
ºº 
MuestraRutasMapas
ºº &
>
ºº& '
mapa
ºº( ,
=
ºº- .
new
ºº/ 2
List
ºº3 7
<
ºº7 8
MuestraRutasMapas
ºº8 I
>
ººI J
(
ººJ K
)
ººK L
;
ººL M
int
ΩΩ 
count
ΩΩ 
=
ΩΩ 
$num
ΩΩ 
;
ΩΩ 
for
ææ 
(
ææ 
int
ææ 
i
ææ 
=
ææ 
$num
ææ 
;
ææ 
i
ææ  !
<=
ææ" $
$num
ææ% &
;
ææ& '
i
ææ( )
++
ææ) +
)
ææ+ ,
{
øø 
MuestraRutasMapas
¿¿ %
muestraRutasMapas
¿¿& 7
=
¿¿8 9
new
¿¿: =
MuestraRutasMapas
¿¿> O
{
¡¡ 
ListRutasMostrar
¬¬ (
=
¬¬) *
new
¬¬+ .
List
¬¬/ 3
<
¬¬3 4
RutasMostrar
¬¬4 @
>
¬¬@ A
(
¬¬A B
)
¬¬B C
,
¬¬C D 
ListParadasMostrar
√√ *
=
√√+ ,
new
√√- 0
List
√√1 5
<
√√5 6
ParadasMostrar
√√6 D
>
√√D E
(
√√E F
)
√√F G
,
√√G H

NumeroRuta
ƒƒ "
=
ƒƒ# $
i
ƒƒ% &
}
≈≈ 
;
≈≈ 
List
«« 
<
«« 
RutasMostrar
«« %
>
««% &
nuevasRutas
««' 2
=
««3 4
new
««5 8
List
««9 =
<
««= >
RutasMostrar
««> J
>
««J K
(
««K L
)
««L M
;
««M N
List
»» 
<
»» 
ParadasMostrar
»» '
>
»»' (
nuevasParadas
»») 6
=
»»7 8
new
»»9 <
List
»»= A
<
»»A B
ParadasMostrar
»»B P
>
»»P Q
(
»»Q R
)
»»R S
;
»»S T
using
   
(
   
dbModels
   #
context
  $ +
=
  , -
new
  . 1
dbModels
  2 :
(
  : ;
)
  ; <
)
  < =
{
ÀÀ 
var
ÃÃ 
checkpoints
ÃÃ '
=
ÃÃ( )
context
ÃÃ* 1
.
ÃÃ1 2

Checkpoint
ÃÃ2 <
.
ÃÃ< =
Where
ÃÃ= B
(
ÃÃB C
x
ÃÃC D
=>
ÃÃE G
x
ÃÃH I
.
ÃÃI J
idLine
ÃÃJ P
==
ÃÃQ S
Line
ÃÃT X
&&
ÃÃY [
x
ÃÃ\ ]
.
ÃÃ] ^
status
ÃÃ^ d
==
ÃÃe g
$num
ÃÃh i
&&
ÃÃj l
x
ÃÃm n
.
ÃÃn o
numberRoute
ÃÃo z
==
ÃÃ{ }
numTypeRouteÃÃ~ ä
)ÃÃä ã
.ÃÃã å
ToListÃÃå í
(ÃÃí ì
)ÃÃì î
;ÃÃî ï
var
ÕÕ 
routes
ÕÕ "
=
ÕÕ# $
context
ÕÕ% ,
.
ÕÕ, -
Route
ÕÕ- 2
.
ŒŒ 
Where
ŒŒ "
(
ŒŒ" #
x
ŒŒ# $
=>
ŒŒ% '
x
ŒŒ( )
.
ŒŒ) *
idLine
ŒŒ* 0
==
ŒŒ1 3
Line
ŒŒ4 8
&&
ŒŒ9 ;
x
ŒŒ< =
.
ŒŒ= >
numberRoute
ŒŒ> I
==
ŒŒJ L
i
ŒŒM N
&&
ŒŒO Q
x
ŒŒR S
.
ŒŒS T
numTypeRoute
ŒŒT `
==
ŒŒa c
numTypeRoute
ŒŒd p
)
ŒŒp q
.
œœ 
ToList
œœ #
(
œœ# $
)
œœ$ %
;
œœ% &
if
—— 
(
—— 
routes
—— "
.
——" #
Count
——# (
>
——) *
$num
——+ ,
)
——, -
{
““ 
count
”” !
=
””" #
$num
””$ %
;
””% &
foreach
‘‘ #
(
‘‘$ %
var
‘‘% (
item
‘‘) -
in
‘‘. 0
routes
‘‘1 7
)
‘‘7 8
{
’’ 
count
÷÷  %
++
÷÷% '
;
÷÷' (
Place
◊◊  %
place
◊◊& +
=
◊◊, -
context
◊◊. 5
.
◊◊5 6
Place
◊◊6 ;
.
◊◊; <
FirstOrDefault
◊◊< J
(
◊◊J K
x
◊◊K L
=>
◊◊M O
x
◊◊P Q
.
◊◊Q R
idPlace
◊◊R Y
==
◊◊Z \
item
◊◊] a
.
◊◊a b
idPlace
◊◊b i
)
◊◊i j
;
◊◊j k
if
ÿÿ  "
(
ÿÿ# $
place
ÿÿ$ )
!=
ÿÿ* ,
null
ÿÿ- 1
)
ÿÿ1 2
{
ŸŸ  !
nuevasRutas
⁄⁄$ /
.
⁄⁄/ 0
Add
⁄⁄0 3
(
⁄⁄3 4
new
⁄⁄4 7
RutasMostrar
⁄⁄8 D
(
⁄⁄D E
item
⁄⁄E I
.
⁄⁄I J
idRoute
⁄⁄J Q
,
⁄⁄Q R
item
⁄⁄S W
.
⁄⁄W X
latitud
⁄⁄X _
,
⁄⁄_ `
item
⁄⁄a e
.
⁄⁄e f
logintud
⁄⁄f n
,
⁄⁄n o
place
⁄⁄p u
.
⁄⁄u v
description⁄⁄v Å
+⁄⁄Ç É
$str⁄⁄Ñ á
+⁄⁄à â
count⁄⁄ä è
,⁄⁄è ê
item⁄⁄ë ï
.⁄⁄ï ñ
status⁄⁄ñ ú
,⁄⁄ú ù
(⁄⁄û ü
int⁄⁄ü ¢
)⁄⁄¢ £
item⁄⁄£ ß
.⁄⁄ß ®
numPoint⁄⁄® ∞
)⁄⁄∞ ±
)⁄⁄± ≤
;⁄⁄≤ ≥
}
€€  !
}
‹‹ 
if
ﬁﬁ 
(
ﬁﬁ  
nuevasRutas
ﬁﬁ  +
.
ﬁﬁ+ ,
Any
ﬁﬁ, /
(
ﬁﬁ/ 0
)
ﬁﬁ0 1
)
ﬁﬁ1 2
{
ﬂﬂ 
RutasMostrar
‡‡  ,
primeraRuta
‡‡- 8
=
‡‡9 :
nuevasRutas
‡‡; F
.
‡‡F G
FirstOrDefault
‡‡G U
(
‡‡U V
r
‡‡V W
=>
‡‡X Z
r
‡‡[ \
.
‡‡\ ]
status
‡‡] c
==
‡‡d f
$num
‡‡g h
)
‡‡h i
;
‡‡i j
if
··  "
(
··# $
primeraRuta
··$ /
!=
··0 2
null
··3 7
)
··7 8
{
‚‚  !
nuevasRutas
„„$ /
=
„„0 1
nuevasRutas
„„2 =
.
‰‰( )
OrderBy
‰‰) 0
(
‰‰0 1
route
‰‰1 6
=>
‰‰7 9
route
‰‰: ?
.
‰‰? @
numPoint
‰‰@ H
)
‰‰H I
.
ÂÂ( )
ToList
ÂÂ) /
(
ÂÂ/ 0
)
ÂÂ0 1
;
ÂÂ1 2
}
ÊÊ  !
}
ÁÁ 
}
ËË 
if
ÍÍ 
(
ÍÍ 
checkpoints
ÍÍ '
.
ÍÍ' (
Count
ÍÍ( -
>
ÍÍ. /
$num
ÍÍ0 1
)
ÍÍ1 2
{
ÎÎ 
foreach
ÌÌ #
(
ÌÌ$ %
var
ÌÌ% (
item
ÌÌ) -
in
ÌÌ. 0
checkpoints
ÌÌ1 <
)
ÌÌ< =
{
ÓÓ 
nuevasParadas
ÔÔ  -
.
ÔÔ- .
Add
ÔÔ. 1
(
ÔÔ1 2
new
ÔÔ2 5
ParadasMostrar
ÔÔ6 D
(
ÔÔD E
item
ÔÔE I
.
ÔÔI J
idCheckpoint
ÔÔJ V
,
ÔÔV W
item
ÔÔX \
.
ÔÔ\ ]
description
ÔÔ] h
,
ÔÔh i
item
ÔÔj n
.
ÔÔn o
status
ÔÔo u
,
ÔÔu v
item
ÔÔw {
.
ÔÔ{ |
latitudÔÔ| É
,ÔÔÉ Ñ
itemÔÔÖ â
.ÔÔâ ä
longitudÔÔä í
)ÔÔí ì
)ÔÔì î
;ÔÔî ï
}
 
if
ÚÚ 
(
ÚÚ  
nuevasParadas
ÚÚ  -
.
ÚÚ- .
Any
ÚÚ. 1
(
ÚÚ1 2
)
ÚÚ2 3
)
ÚÚ3 4
{
ÛÛ 
ParadasMostrar
ÙÙ  .
primeraParada
ÙÙ/ <
=
ÙÙ= >
nuevasParadas
ÙÙ? L
.
ÙÙL M
FirstOrDefault
ÙÙM [
(
ÙÙ[ \
r
ÙÙ\ ]
=>
ÙÙ^ `
r
ÙÙa b
.
ÙÙb c
status
ÙÙc i
==
ÙÙj l
$num
ÙÙm n
)
ÙÙn o
;
ÙÙo p
if
ıı  "
(
ıı# $
primeraParada
ıı$ 1
!=
ıı2 4
null
ıı5 9
)
ıı9 :
{
ˆˆ  !
nuevasParadas
˜˜$ 1
=
˜˜2 3
nuevasParadas
˜˜4 A
.
¯¯( )
OrderBy
¯¯) 0
(
¯¯0 1
route
¯¯1 6
=>
¯¯7 9
muestraRutasMapas
¯¯: K
.
¯¯K L(
CalcularDistanciaHaversine
¯¯L f
(
¯¯f g
(
˘˘, -
decimal
˘˘- 4
)
˘˘4 5
primeraParada
˘˘5 B
.
˘˘B C
latitud
˘˘C J
,
˘˘J K
(
˙˙, -
decimal
˙˙- 4
)
˙˙4 5
primeraParada
˙˙5 B
.
˙˙B C
longitud
˙˙C K
,
˙˙K L
route
˚˚, 1
.
˚˚1 2
latitud
˚˚2 9
,
˚˚9 :
route
¸¸, 1
.
¸¸1 2
longitud
¸¸2 :
)
¸¸: ;
)
¸¸; <
.
˝˝( )
ToList
˝˝) /
(
˝˝/ 0
)
˝˝0 1
;
˝˝1 2
}
˛˛  !
}
ˇˇ 
}
ÄÄ 
}
ÅÅ 
List
ÇÇ 
<
ÇÇ 
string
ÇÇ 
>
ÇÇ  
horas
ÇÇ! &
=
ÇÇ' (
new
ÇÇ) ,
List
ÇÇ- 1
<
ÇÇ1 2
string
ÇÇ2 8
>
ÇÇ8 9
(
ÇÇ9 :
)
ÇÇ: ;
;
ÇÇ; <
List
ÉÉ 
<
ÉÉ 
string
ÉÉ 
>
ÉÉ  
minutos
ÉÉ! (
=
ÉÉ) *
new
ÉÉ+ .
List
ÉÉ/ 3
<
ÉÉ3 4
string
ÉÉ4 :
>
ÉÉ: ;
{
ÉÉ< =
$str
ÉÉ> B
,
ÉÉB C
$str
ÉÉD H
,
ÉÉH I
$str
ÉÉJ N
,
ÉÉN O
$str
ÉÉP T
,
ÉÉT U
$str
ÉÉV Z
,
ÉÉZ [
$str
ÉÉ\ `
}
ÉÉa b
;
ÉÉb c
for
ÑÑ 
(
ÑÑ 
int
ÑÑ 
hour
ÑÑ !
=
ÑÑ" #
$num
ÑÑ$ %
;
ÑÑ% &
hour
ÑÑ' +
<
ÑÑ, -
$num
ÑÑ. 0
;
ÑÑ0 1
hour
ÑÑ2 6
++
ÑÑ6 8
)
ÑÑ8 9
{
ÖÖ 
horas
ÜÜ 
.
ÜÜ 
Add
ÜÜ !
(
ÜÜ! "
hour
ÜÜ" &
.
ÜÜ& '
ToString
ÜÜ' /
(
ÜÜ/ 0
$str
ÜÜ0 4
)
ÜÜ4 5
)
ÜÜ5 6
;
ÜÜ6 7
}
áá 

Checkpoint
àà 
check
àà $
=
àà% &
new
àà' *

Checkpoint
àà+ 5
(
àà5 6
)
àà6 7
;
àà7 8
using
ââ 
(
ââ 
dbModels
ââ #
context
ââ$ +
=
ââ, -
new
ââ. 1
dbModels
ââ2 :
(
ââ: ;
)
ââ; <
)
ââ< =
check
ââ> C
=
ââD E
context
ââF M
.
ââM N

Checkpoint
ââN X
.
ââX Y
Where
ââY ^
(
ââ^ _
x
ââ_ `
=>
ââa c
x
ââd e
.
ââe f
idLine
ââf l
==
ââm o
Line
ââp t
&&
ââu w
x
ââx y
.
âây z
statusââz Ä
==ââÅ É
$numââÑ Ö
&&ââÜ à
xâââ ä
.ââä ã
numberRouteââã ñ
==ââó ô
numTypeRouteââö ¶
)ââ¶ ß
.ââß ®
FirstOrDefaultââ® ∂
(ââ∂ ∑
)ââ∑ ∏
;ââ∏ π
string
ãã 
[
ãã 
]
ãã 
HourMinArrival
ãã +
=
ãã, -
check
ãã. 3
.
ãã3 4

minArrival
ãã4 >
.
ãã> ?
Trim
ãã? C
(
ããC D
)
ããD E
.
ããE F
Split
ããF K
(
ããK L
$char
ããL O
)
ããO P
;
ããP Q
string
åå 
[
åå 
]
åå "
HourMinArrivalMarket
åå 1
=
åå2 3
check
åå4 9
.
åå9 :
minArrivalMarket
åå: J
.
ååJ K
Trim
ååK O
(
ååO P
)
ååP Q
.
ååQ R
Split
ååR W
(
ååW X
$char
ååX [
)
åå[ \
;
åå\ ]
ViewBag
éé 
.
éé 
Hours
éé !
=
éé" #
new
éé$ '

SelectList
éé( 2
(
éé2 3
horas
éé3 8
,
éé8 9
HourMinArrival
éé: H
[
ééH I
$num
ééI J
]
ééJ K
)
ééK L
;
ééL M
ViewBag
èè 
.
èè 
Minutes
èè #
=
èè$ %
new
èè& )

SelectList
èè* 4
(
èè4 5
minutos
èè5 <
,
èè< =
HourMinArrival
èè> L
[
èèL M
$num
èèM N
]
èèN O
)
èèO P
;
èèP Q
ViewBag
êê 
.
êê 
Hours2
êê "
=
êê# $
new
êê% (

SelectList
êê) 3
(
êê3 4
horas
êê4 9
,
êê9 :"
HourMinArrivalMarket
êê; O
[
êêO P
$num
êêP Q
]
êêQ R
)
êêR S
;
êêS T
ViewBag
ëë 
.
ëë 
Minutes2
ëë $
=
ëë% &
new
ëë' *

SelectList
ëë+ 5
(
ëë5 6
minutos
ëë6 =
,
ëë= >"
HourMinArrivalMarket
ëë? S
[
ëëS T
$num
ëëT U
]
ëëU V
)
ëëV W
;
ëëW X
muestraRutasMapas
íí %
.
íí% &
ListRutasMostrar
íí& 6
=
íí7 8
nuevasRutas
íí9 D
;
ííD E
muestraRutasMapas
ìì %
.
ìì% & 
ListParadasMostrar
ìì& 8
=
ìì9 :
nuevasParadas
ìì; H
;
ììH I
ViewBag
îî 
.
îî 
numTypeRoute
îî (
=
îî) *
numTypeRoute
îî+ 7
;
îî7 8
mapa
ïï 
.
ïï 
Add
ïï 
(
ïï 
muestraRutasMapas
ïï .
)
ïï. /
;
ïï/ 0
}
ññ 
return
òò 
View
òò 
(
òò 
mapa
òò  
)
òò  !
;
òò! "
}
ôô 
catch
öö 
(
öö 
	Exception
öö 
)
öö 
{
õõ 
return
úú 
RedirectToAction
úú '
(
úú' (
$str
úú( /
,
úú/ 0
$str
úú1 7
)
úú7 8
;
úú8 9
}
ùù 
}
ûû 	
[
üü 	
HttpPost
üü	 
]
üü 
public
†† 
ActionResult
†† 
EditParada2Check
†† ,
(
††, -
string
††- 3
ubicaciones
††4 ?
,
††? @
string
††A G
hora
††H L
,
††L M
string
††N T
minuto
††U [
,
††[ \
string
††] c
horaMercado
††d o
,
††o p
string
††q w
minutoMercado††x Ö
,††Ö Ü
int††á ä
numTypeRoute††ã ó
)††ó ò
{
°° 	
try
¢¢ 
{
££ 
Login
§§ 
logi
§§ 
=
§§ 
new
§§  
Login
§§! &
(
§§& '
)
§§' (
;
§§( )
var
•• 

authResult
•• 
=
••   
AutenticarPasosRol
••! 3
(
••3 4
$num
••4 5
)
••5 6
;
••6 7
if
¶¶ 
(
¶¶ 

authResult
¶¶ 
!=
¶¶ !
null
¶¶" &
)
¶¶& '
return
¶¶( .

authResult
¶¶/ 9
;
¶¶9 :
string
ßß 
Line
ßß 
=
ßß 
logi
ßß "
.
ßß" # 
GetLineaFromCookie
ßß# 5
(
ßß5 6
Request
ßß6 =
)
ßß= >
.
ßß> ?
ToString
ßß? G
(
ßßG H
)
ßßH I
;
ßßI J

Checkpoint
®® 
check
®®  
=
®®! "
new
®®# &

Checkpoint
®®' 1
(
®®1 2
)
®®2 3
;
®®3 4
Route
©© 
route
©© 
=
©© 
new
©© !
Route
©©" '
(
©©' (
)
©©( )
;
©©) *
using
™™ 
(
™™ 
dbModels
™™ 
context
™™  '
=
™™( )
new
™™* -
dbModels
™™. 6
(
™™6 7
)
™™7 8
)
™™8 9
check
™™: ?
=
™™@ A
context
™™B I
.
™™I J

Checkpoint
™™J T
.
™™T U
Where
™™U Z
(
™™Z [
x
™™[ \
=>
™™] _
x
™™` a
.
™™a b
idLine
™™b h
==
™™i k
Line
™™l p
&&
™™q s
x
™™t u
.
™™u v
status
™™v |
==
™™} 
$num™™Ä Å
&&™™Ç Ñ
x™™Ö Ü
.™™Ü á
numberRoute™™á í
==™™ì ï
numTypeRoute™™ñ ¢
)™™¢ £
.™™£ §
FirstOrDefault™™§ ≤
(™™≤ ≥
)™™≥ ¥
;™™¥ µ
using
´´ 
(
´´ 
dbModels
´´ 
context
´´  '
=
´´( )
new
´´* -
dbModels
´´. 6
(
´´6 7
)
´´7 8
)
´´8 9
route
´´: ?
=
´´@ A
context
´´B I
.
´´I J
Route
´´J O
.
´´O P
Where
´´P U
(
´´U V
x
´´V W
=>
´´X Z
x
´´[ \
.
´´\ ]
idLine
´´] c
==
´´d f
Line
´´g k
&&
´´l n
x
´´o p
.
´´p q
status
´´q w
==
´´x z
$num
´´{ |
&&
´´} 
x´´Ä Å
.´´Å Ç
numberRoute´´Ç ç
==´´é ê
$num´´ë í
&&´´ì ï
x´´ñ ó
.´´ó ò
numTypeRoute´´ò §
==´´• ß
numTypeRoute´´® ¥
)´´¥ µ
.´´µ ∂
FirstOrDefault´´∂ ƒ
(´´ƒ ≈
)´´≈ ∆
;´´∆ «
using
¨¨ 
(
¨¨ 
dbModels
¨¨ 
context
¨¨  '
=
¨¨( )
new
¨¨* -
dbModels
¨¨. 6
(
¨¨6 7
)
¨¨7 8
)
¨¨8 9
{
≠≠ 
string
ØØ 
[
ØØ 
]
ØØ ,
seccionesNombreLatitudLongitud
ØØ ;
=
ØØ< =
ubicaciones
ØØ> I
.
ØØI J
Split
ØØJ O
(
ØØO P
$char
ØØP S
)
ØØS T
;
ØØT U
if
∞∞ 
(
∞∞ ,
seccionesNombreLatitudLongitud
∞∞ 6
.
∞∞6 7
Length
∞∞7 =
>=
∞∞> @
$num
∞∞A B
)
∞∞B C
{
±± 
check
≤≤ 
.
≤≤ 
description
≤≤ )
=
≤≤* +
$str
≤≤, E
;
≤≤E F
check
≥≥ 
.
≥≥ 
latitud
≥≥ %
=
≥≥& '
Convert
≥≥( /
.
≥≥/ 0
	ToDecimal
≥≥0 9
(
≥≥9 :,
seccionesNombreLatitudLongitud
≥≥: X
[
≥≥X Y
$num
≥≥Y Z
]
≥≥Z [
.
≥≥[ \
Trim
≥≥\ `
(
≥≥` a
)
≥≥a b
,
≥≥b c
System
≥≥d j
.
≥≥j k
Globalization
≥≥k x
.
≥≥x y
CultureInfo≥≥y Ñ
.≥≥Ñ Ö 
InvariantCulture≥≥Ö ï
)≥≥ï ñ
;≥≥ñ ó
check
¥¥ 
.
¥¥ 
longitud
¥¥ &
=
¥¥' (
Convert
¥¥) 0
.
¥¥0 1
	ToDecimal
¥¥1 :
(
¥¥: ;,
seccionesNombreLatitudLongitud
¥¥; Y
[
¥¥Y Z
$num
¥¥Z [
]
¥¥[ \
.
¥¥\ ]
Trim
¥¥] a
(
¥¥a b
)
¥¥b c
,
¥¥c d
System
¥¥e k
.
¥¥k l
Globalization
¥¥l y
.
¥¥y z
CultureInfo¥¥z Ö
.¥¥Ö Ü 
InvariantCulture¥¥Ü ñ
)¥¥ñ ó
;¥¥ó ò
route
µµ 
.
µµ 
latitud
µµ %
=
µµ& '
Convert
µµ( /
.
µµ/ 0
	ToDecimal
µµ0 9
(
µµ9 :,
seccionesNombreLatitudLongitud
µµ: X
[
µµX Y
$num
µµY Z
]
µµZ [
.
µµ[ \
Trim
µµ\ `
(
µµ` a
)
µµa b
,
µµb c
System
µµd j
.
µµj k
Globalization
µµk x
.
µµx y
CultureInfoµµy Ñ
.µµÑ Ö 
InvariantCultureµµÖ ï
)µµï ñ
;µµñ ó
route
∂∂ 
.
∂∂ 
logintud
∂∂ &
=
∂∂' (
Convert
∂∂) 0
.
∂∂0 1
	ToDecimal
∂∂1 :
(
∂∂: ;,
seccionesNombreLatitudLongitud
∂∂; Y
[
∂∂Y Z
$num
∂∂Z [
]
∂∂[ \
.
∂∂\ ]
Trim
∂∂] a
(
∂∂a b
)
∂∂b c
,
∂∂c d
System
∂∂e k
.
∂∂k l
Globalization
∂∂l y
.
∂∂y z
CultureInfo∂∂z Ö
.∂∂Ö Ü 
InvariantCulture∂∂Ü ñ
)∂∂ñ ó
;∂∂ó ò
}
∑∑ 
check
∏∏ 
.
∏∏ 

minArrival
∏∏ $
=
∏∏% &
hora
∏∏' +
+
∏∏, -
$str
∏∏. 1
+
∏∏2 3
minuto
∏∏4 :
;
∏∏: ;
check
ππ 
.
ππ 
minArrivalMarket
ππ *
=
ππ+ ,
horaMercado
ππ- 8
+
ππ9 :
$str
ππ; >
+
ππ? @
minutoMercado
ππA N
;
ππN O
context
∫∫ 
.
∫∫ 
Entry
∫∫ !
(
∫∫! "
route
∫∫" '
)
∫∫' (
.
∫∫( )
State
∫∫) .
=
∫∫/ 0
System
∫∫1 7
.
∫∫7 8
Data
∫∫8 <
.
∫∫< =
Entity
∫∫= C
.
∫∫C D
EntityState
∫∫D O
.
∫∫O P
Modified
∫∫P X
;
∫∫X Y
context
ªª 
.
ªª 
Entry
ªª !
(
ªª! "
check
ªª" '
)
ªª' (
.
ªª( )
State
ªª) .
=
ªª/ 0
System
ªª1 7
.
ªª7 8
Data
ªª8 <
.
ªª< =
Entity
ªª= C
.
ªªC D
EntityState
ªªD O
.
ªªO P
Modified
ªªP X
;
ªªX Y
context
ºº 
.
ºº 
SaveChanges
ºº '
(
ºº' (
)
ºº( )
;
ºº) *
}
ΩΩ 
return
ææ 
RedirectToAction
ææ '
(
ææ' (
$str
ææ( /
,
ææ/ 0
$str
ææ1 8
,
ææ8 9
new
ææ: =
{
ææ> ?
numTypeRoute
ææ@ L
=
ææN O
numTypeRoute
ææP \
}
ææ] ^
)
ææ^ _
;
ææ_ `
}
øø 
catch
¿¿ 
(
¿¿ 
	Exception
¿¿ 
)
¿¿ 
{
¡¡ 
return
¬¬ 
RedirectToAction
¬¬ '
(
¬¬' (
$str
¬¬( /
,
¬¬/ 0
$str
¬¬1 7
)
¬¬7 8
;
¬¬8 9
}
√√ 
}
ƒƒ 	
public
≈≈ 
ActionResult
≈≈ 
CreateNewRuta
≈≈ )
(
≈≈) *
)
≈≈* +
{
∆∆ 	
try
«« 
{
»» 
Login
…… 
logi
…… 
=
…… 
new
……  
Login
……! &
(
……& '
)
……' (
;
……( )
var
   

authResult
   
=
     
AutenticarPasosRol
  ! 3
(
  3 4
$num
  4 5
)
  5 6
;
  6 7
if
ÀÀ 
(
ÀÀ 

authResult
ÀÀ 
!=
ÀÀ !
null
ÀÀ" &
)
ÀÀ& '
return
ÀÀ( .

authResult
ÀÀ/ 9
;
ÀÀ9 :
string
ÃÃ 
Line
ÃÃ 
=
ÃÃ 
logi
ÃÃ "
.
ÃÃ" # 
GetLineaFromCookie
ÃÃ# 5
(
ÃÃ5 6
Request
ÃÃ6 =
)
ÃÃ= >
.
ÃÃ> ?
ToString
ÃÃ? G
(
ÃÃG H
)
ÃÃH I
;
ÃÃI J
int
ÕÕ 
max
ÕÕ 
=
ÕÕ 
$num
ÕÕ 
;
ÕÕ 
using
ŒŒ 
(
ŒŒ 
dbModels
ŒŒ 
context
ŒŒ  '
=
ŒŒ( )
new
ŒŒ* -
dbModels
ŒŒ. 6
(
ŒŒ6 7
)
ŒŒ7 8
)
ŒŒ8 9
{
œœ 
var
–– 
checks
–– 
=
––  
context
––! (
.
––( )

Checkpoint
––) 3
.
––3 4
Where
––4 9
(
––9 :
x
––: ;
=>
––< >
x
––? @
.
––@ A
idLine
––A G
==
––H J
Line
––K O
&&
––P R
x
––S T
.
––T U
status
––U [
>
––\ ]
$num
––^ _
)
––_ `
;
––` a
max
—— 
=
—— 
int
—— 
.
—— 
Parse
—— #
(
——# $
checks
——$ *
.
——* +
Max
——+ .
(
——. /
x
——/ 0
=>
——1 3
x
——4 5
.
——5 6
numberRoute
——6 A
)
——A B
.
——B C
ToString
——C K
(
——K L
)
——L M
)
——M N
;
——N O
max
““ 
+=
““ 
$num
““ 
;
““ 
}
”” 
if
‘‘ 
(
‘‘ 
max
‘‘ 
>
‘‘ 
$num
‘‘ 
)
‘‘ 
{
’’ 
return
÷÷ 
RedirectToAction
÷÷ +
(
÷÷+ ,
$str
÷÷, 5
,
÷÷5 6
new
÷÷7 :
{
÷÷; <
numTypeRoute
÷÷= I
=
÷÷J K
max
÷÷L O
}
÷÷P Q
)
÷÷Q R
;
÷÷R S
}
◊◊ 
return
ÿÿ 
RedirectToAction
ÿÿ '
(
ÿÿ' (
$str
ÿÿ( /
,
ÿÿ/ 0
$str
ÿÿ1 7
)
ÿÿ7 8
;
ÿÿ8 9
}
ŸŸ 
catch
⁄⁄ 
(
⁄⁄ 
	Exception
⁄⁄ 
)
⁄⁄ 
{
€€ 
return
‹‹ 
RedirectToAction
‹‹ '
(
‹‹' (
$str
‹‹( /
,
‹‹/ 0
$str
‹‹1 7
)
‹‹7 8
;
‹‹8 9
}
›› 
}
ﬁﬁ 	
public
ﬂﬂ 
ActionResult
ﬂﬂ 

DeleteRuta
ﬂﬂ &
(
ﬂﬂ& '
int
ﬂﬂ' *
numTypeRoute
ﬂﬂ+ 7
)
ﬂﬂ7 8
{
‡‡ 	
try
·· 
{
‚‚ 
Login
„„ 
logi
„„ 
=
„„ 
new
„„  
Login
„„! &
(
„„& '
)
„„' (
;
„„( )
var
‰‰ 

authResult
‰‰ 
=
‰‰   
AutenticarPasosRol
‰‰! 3
(
‰‰3 4
$num
‰‰4 5
)
‰‰5 6
;
‰‰6 7
if
ÂÂ 
(
ÂÂ 

authResult
ÂÂ 
!=
ÂÂ !
null
ÂÂ" &
)
ÂÂ& '
return
ÂÂ( .

authResult
ÂÂ/ 9
;
ÂÂ9 :
string
ÊÊ 
Line
ÊÊ 
=
ÊÊ 
logi
ÊÊ "
.
ÊÊ" # 
GetLineaFromCookie
ÊÊ# 5
(
ÊÊ5 6
Request
ÊÊ6 =
)
ÊÊ= >
.
ÊÊ> ?
ToString
ÊÊ? G
(
ÊÊG H
)
ÊÊH I
;
ÊÊI J
using
ÁÁ 
(
ÁÁ 
dbModels
ÁÁ 
context
ÁÁ  '
=
ÁÁ( )
new
ÁÁ* -
dbModels
ÁÁ. 6
(
ÁÁ6 7
)
ÁÁ7 8
)
ÁÁ8 9
{
ËË 
List
ÈÈ 
<
ÈÈ 

Checkpoint
ÈÈ #
>
ÈÈ# $
checks
ÈÈ% +
=
ÈÈ, -
context
ÈÈ. 5
.
ÈÈ5 6

Checkpoint
ÈÈ6 @
.
ÈÈ@ A
Where
ÈÈA F
(
ÈÈF G
x
ÈÈG H
=>
ÈÈI K
x
ÈÈL M
.
ÈÈM N
idLine
ÈÈN T
==
ÈÈU W
Line
ÈÈX \
&&
ÈÈ] _
x
ÈÈ` a
.
ÈÈa b
numberRoute
ÈÈb m
==
ÈÈn p
numTypeRoute
ÈÈq }
&&ÈÈ~ Ä
xÈÈÅ Ç
.ÈÈÇ É
statusÈÈÉ â
>ÈÈä ã
$numÈÈå ç
)ÈÈç é
.ÈÈé è
ToListÈÈè ï
(ÈÈï ñ
)ÈÈñ ó
;ÈÈó ò
List
ÍÍ 
<
ÍÍ 
DeviationRote
ÍÍ &
>
ÍÍ& '

deviations
ÍÍ( 2
=
ÍÍ3 4
context
ÍÍ5 <
.
ÍÍ< =
DeviationRote
ÍÍ= J
.
ÍÍJ K
Where
ÍÍK P
(
ÍÍP Q
x
ÍÍQ R
=>
ÍÍS U
x
ÍÍV W
.
ÍÍW X
idLine
ÍÍX ^
==
ÍÍ_ a
Line
ÍÍb f
&&
ÍÍg i
x
ÍÍj k
.
ÍÍk l
numTypeRoute
ÍÍl x
==
ÍÍy {
numTypeRouteÍÍ| à
)ÍÍà â
.ÍÍâ ä
ToListÍÍä ê
(ÍÍê ë
)ÍÍë í
;ÍÍí ì
List
ÎÎ 
<
ÎÎ 
Route
ÎÎ 
>
ÎÎ 
routes
ÎÎ  &
=
ÎÎ' (
context
ÎÎ) 0
.
ÎÎ0 1
Route
ÎÎ1 6
.
ÎÎ6 7
Where
ÎÎ7 <
(
ÎÎ< =
x
ÎÎ= >
=>
ÎÎ? A
x
ÎÎB C
.
ÎÎC D
idLine
ÎÎD J
==
ÎÎK M
Line
ÎÎN R
&&
ÎÎS U
x
ÎÎV W
.
ÎÎW X
numTypeRoute
ÎÎX d
==
ÎÎe g
numTypeRoute
ÎÎh t
)
ÎÎt u
.
ÎÎu v
ToList
ÎÎv |
(
ÎÎ| }
)
ÎÎ} ~
;
ÎÎ~ 
foreach
ÏÏ 
(
ÏÏ 
var
ÏÏ  
item
ÏÏ! %
in
ÏÏ& (
checks
ÏÏ) /
)
ÏÏ/ 0
{
ÌÌ 

Checkpoint
ÓÓ "
check
ÓÓ# (
=
ÓÓ) *
context
ÓÓ+ 2
.
ÓÓ2 3

Checkpoint
ÓÓ3 =
.
ÓÓ= >
Where
ÓÓ> C
(
ÓÓC D
x
ÓÓD E
=>
ÓÓF H
x
ÓÓI J
.
ÓÓJ K
idCheckpoint
ÓÓK W
==
ÓÓX Z
item
ÓÓ[ _
.
ÓÓ_ `
idCheckpoint
ÓÓ` l
)
ÓÓl m
.
ÓÓm n
FirstOrDefault
ÓÓn |
(
ÓÓ| }
)
ÓÓ} ~
;
ÓÓ~ 
check
ÔÔ 
.
ÔÔ 

idEmployee
ÔÔ (
=
ÔÔ) *
null
ÔÔ+ /
;
ÔÔ/ 0
check
 
.
 
status
 $
=
% &
$num
' (
;
( )
context
ÒÒ 
.
ÒÒ  
Entry
ÒÒ  %
(
ÒÒ% &
check
ÒÒ& +
)
ÒÒ+ ,
.
ÒÒ, -
State
ÒÒ- 2
=
ÒÒ3 4
System
ÒÒ5 ;
.
ÒÒ; <
Data
ÒÒ< @
.
ÒÒ@ A
Entity
ÒÒA G
.
ÒÒG H
EntityState
ÒÒH S
.
ÒÒS T
Modified
ÒÒT \
;
ÒÒ\ ]
}
ÚÚ 
foreach
ÛÛ 
(
ÛÛ 
var
ÛÛ  
item
ÛÛ! %
in
ÛÛ& (

deviations
ÛÛ) 3
)
ÛÛ3 4
{
ÙÙ 
DeviationRote
ıı %
check
ıı& +
=
ıı, -
context
ıı. 5
.
ıı5 6
DeviationRote
ıı6 C
.
ııC D
Where
ııD I
(
ııI J
x
ııJ K
=>
ııL N
x
ııO P
.
ııP Q
idDeviation
ııQ \
==
ıı] _
item
ıı` d
.
ııd e
idDeviation
ııe p
)
ııp q
.
ııq r
FirstOrDefaultıır Ä
(ııÄ Å
)ııÅ Ç
;ııÇ É
context
ˆˆ 
.
ˆˆ  
DeviationRote
ˆˆ  -
.
ˆˆ- .
Remove
ˆˆ. 4
(
ˆˆ4 5
check
ˆˆ5 :
)
ˆˆ: ;
;
ˆˆ; <
}
˜˜ 
foreach
¯¯ 
(
¯¯ 
var
¯¯  
item
¯¯! %
in
¯¯& (
routes
¯¯) /
)
¯¯/ 0
{
˘˘ 
Route
˙˙ 
check
˙˙ #
=
˙˙$ %
context
˙˙& -
.
˙˙- .
Route
˙˙. 3
.
˙˙3 4
Where
˙˙4 9
(
˙˙9 :
x
˙˙: ;
=>
˙˙< >
x
˙˙? @
.
˙˙@ A
idRoute
˙˙A H
==
˙˙I K
item
˙˙L P
.
˙˙P Q
idRoute
˙˙Q X
)
˙˙X Y
.
˙˙Y Z
FirstOrDefault
˙˙Z h
(
˙˙h i
)
˙˙i j
;
˙˙j k
context
˚˚ 
.
˚˚  
Route
˚˚  %
.
˚˚% &
Remove
˚˚& ,
(
˚˚, -
check
˚˚- 2
)
˚˚2 3
;
˚˚3 4
}
¸¸ 
context
˝˝ 
.
˝˝ 
SaveChanges
˝˝ '
(
˝˝' (
)
˝˝( )
;
˝˝) *
}
˛˛ 
return
ˇˇ 
RedirectToAction
ˇˇ '
(
ˇˇ' (
$str
ˇˇ( 4
,
ˇˇ4 5
$str
ˇˇ6 =
)
ˇˇ= >
;
ˇˇ> ?
}
ÄÄ 
catch
ÅÅ 
(
ÅÅ 
	Exception
ÅÅ 
)
ÅÅ 
{
ÇÇ 
return
ÉÉ 
RedirectToAction
ÉÉ '
(
ÉÉ' (
$str
ÉÉ( /
,
ÉÉ/ 0
$str
ÉÉ1 7
)
ÉÉ7 8
;
ÉÉ8 9
}
ÑÑ 
}
ÖÖ 	
}
ÜÜ 
}áá Âm
NC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Controllers\PersonController.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Controllers" -
{ 
public 

class 
PersonController !
:" #

Controller$ .
{ 
public 
ActionResult 
Index !
(! "
)" #
{ 	
try 
{ 
var 

authResult 
=  
AutenticarPasosRol! 3
(3 4
$num4 5
)5 6
;6 7
if 
( 

authResult 
!= !
null" &
)& '
return( .

authResult/ 9
;9 :
List 
< 
Person 
> 
list !
=" #
new$ '
List( ,
<, -
Person- 3
>3 4
(4 5
)5 6
;6 7
using 
( 
dbModels 
context  '
=( )
new* -
dbModels. 6
(6 7
)7 8
)8 9
{ 
return 
View 
(  
context  '
.' (
Person( .
.. /
ToList/ 5
(5 6
)6 7
.7 8
Where8 =
(= >
x> ?
=>@ B
xC D
.D E
statusE K
==L N
$numO P
&&Q S
xT U
.U V
phoneV [
!=\ ^
null_ c
)c d
)d e
;e f
} 
} 
catch 
( 
	Exception 
) 
{ 
return 
RedirectToAction '
(' (
$str( /
,/ 0
$str1 7
)7 8
;8 9
}   
}!! 	
public$$ 
ActionResult$$ 
Edit$$  
($$  !
string$$! '
id$$( *
)$$* +
{%% 	
try&& 
{'' 
if(( 
((( 
id(( 
==(( 
null(( 
)(( 
return((  &
RedirectToAction((' 7
(((7 8
$str((8 ?
,((? @
$str((A G
)((G H
;((H I
var)) 

authResult)) 
=))  
AutenticarPasosRol))! 3
())3 4
$num))4 5
)))5 6
;))6 7
if** 
(** 

authResult** 
!=** !
null**" &
)**& '
return**( .

authResult**/ 9
;**9 :
using++ 
(++ 
dbModels++ 
context++  '
=++( )
new++* -
dbModels++. 6
(++6 7
)++7 8
)++8 9
{,, 
Person-- 
person-- !
=--" #
context--$ +
.--+ ,
Person--, 2
.--2 3
Where--3 8
(--8 9
x--9 :
=>--; =
x--> ?
.--? @
nit--@ C
==--D F
id--G I
)--I J
.--J K
FirstOrDefault--K Y
(--Y Z
)--Z [
;--[ \
Session.. 
[.. 
$str.. (
]..( )
=..* +
person.., 2
;..2 3
OwnerAuxiliar// !
ow//" $
=//% &
new//' *
OwnerAuxiliar//+ 8
(//8 9
person//9 ?
.//? @
nit//@ C
,//C D
$str//D F
,//F G
person//G M
.//M N
name//N R
,//R S
person//S Y
.//Y Z
lastname//Z b
,//b c
person//c i
.//i j
phone//j o
)//o p
;//p q
return00 
View00 
(00  
ow00  "
)00" #
;00# $
}11 
}22 
catch33 
(33 
	Exception33 
)33 
{44 
return55 
RedirectToAction55 '
(55' (
$str55( /
,55/ 0
$str551 7
)557 8
;558 9
}66 
}77 	
[:: 	
HttpPost::	 
]:: 
public;; 
ActionResult;; 
Edit;;  
(;;  !
string;;! '
id;;( *
,;;* +
OwnerAuxiliar;;, 9
person;;: @
);;@ A
{<< 	
try== 
{>> 
var?? 

authResult?? 
=??  
AutenticarPasosRol??! 3
(??3 4
$num??4 5
)??5 6
;??6 7
if@@ 
(@@ 

authResult@@ 
!=@@ !
null@@" &
)@@& '
return@@( .

authResult@@/ 9
;@@9 :
PersonAA 
pAA 
=AA 
(AA 
PersonAA "
)AA" #
SessionAA# *
[AA* +
$strAA+ 7
]AA7 8
;AA8 9
PersonBB 
validBB 
=BB 
newBB "
PersonBB# )
(BB) *
)BB* +
;BB+ ,
usingCC 
(CC 
dbModelsCC 
contextCC  '
=CC( )
newCC* -
dbModelsCC. 6
(CC6 7
)CC7 8
)CC8 9
{DD 
validEE 
=EE 
contextEE #
.EE# $
PersonEE$ *
.EE* +
WhereEE+ 0
(EE0 1
xEE1 2
=>EE3 5
xEE6 7
.EE7 8
nitEE8 ;
==EE< >
personEE? E
.EEE F
nitEEF I
&&EEJ L
xEEM N
.EEN O
statusEEO U
==EEV X
$numEEY Z
)EEZ [
.EE[ \
FirstOrDefaultEE\ j
(EEj k
)EEk l
;EEl m
ifFF 
(FF 
validFF 
==FF  
nullFF! %
||FF& (
pFF) *
.FF* +
nitFF+ .
==FF/ 1
personFF2 8
.FF8 9
nitFF9 <
)FF< =
{GG 
pHH 
.HH 
nameHH 
=HH  
personHH! '
.HH' (
nameHH( ,
;HH, -
pII 
.II 
lastnameII "
=II# $
personII% +
.II+ ,
lastnameII, 4
;II4 5
pJJ 
.JJ 
phoneJJ 
=JJ  !
personJJ" (
.JJ( )
phoneJJ) .
;JJ. /
pKK 
.KK 
statusKK  
=KK! "
$numKK# $
;KK$ %
contextLL 
.LL  
EntryLL  %
(LL% &
pLL& '
)LL' (
.LL( )
StateLL) .
=LL/ 0
SystemLL1 7
.LL7 8
DataLL8 <
.LL< =
EntityLL= C
.LLC D
EntityStateLLD O
.LLO P
ModifiedLLP X
;LLX Y
contextMM 
.MM  
SaveChangesMM  +
(MM+ ,
)MM, -
;MM- .
}NN 
elseOO 
TempDataOO !
[OO! "
$strOO" 0
]OO0 1
=OO2 3
$strOO4 W
;OOW X
}PP 
SessionQQ 
[QQ 
$strQQ $
]QQ$ %
=QQ& '
nullQQ( ,
;QQ, -
returnRR 
RedirectToActionRR '
(RR' (
$strRR( /
)RR/ 0
;RR0 1
}SS 
catchTT 
(TT 
	ExceptionTT 
)TT 
{UU 
returnVV 
RedirectToActionVV '
(VV' (
$strVV( /
,VV/ 0
$strVV1 7
)VV7 8
;VV8 9
}WW 
}XX 	
public[[ 
ActionResult[[ 
Delete[[ "
([[" #
string[[# )
id[[* ,
)[[, -
{\\ 	
try]] 
{^^ 
var__ 

authResult__ 
=__  
AutenticarPasosRol__! 3
(__3 4
$num__4 5
)__5 6
;__6 7
if`` 
(`` 

authResult`` 
!=`` !
null``" &
)``& '
return``( .

authResult``/ 9
;``9 :
Employeeaa 
employeeaa !
=aa" #
newaa$ '
Employeeaa( 0
(aa0 1
)aa1 2
;aa2 3
Personbb 
personbb 
=bb 
newbb  #
Personbb$ *
(bb* +
)bb+ ,
;bb, -
Listcc 
<cc 
Ownercc 
>cc 
	ownerListcc %
=cc& '
newcc( +
Listcc, 0
<cc0 1
Ownercc1 6
>cc6 7
(cc7 8
)cc8 9
;cc9 :
usingdd 
(dd 
dbModelsdd 
contextdd  '
=dd( )
newdd* -
dbModelsdd. 6
(dd6 7
)dd7 8
)dd8 9
	ownerListdd: C
=ddD E
contextddF M
.ddM N
OwnerddN S
.ddS T
WhereddT Y
(ddY Z
xddZ [
=>dd\ ^
xdd_ `
.dd` a
idPersondda i
==ddj l
idddm o
)ddo p
.ddp q
ToListddq w
(ddw x
)ddx y
;ddy z
usingee 
(ee 
dbModelsee 
contextee  '
=ee( )
newee* -
dbModelsee. 6
(ee6 7
)ee7 8
)ee8 9
personee: @
=eeA B
contexteeC J
.eeJ K
PersoneeK Q
.eeQ R
WhereeeR W
(eeW X
xeeX Y
=>eeZ \
xee] ^
.ee^ _
nitee_ b
==eec e
ideef h
)eeh i
.eei j
FirstOrDefaulteej x
(eex y
)eey z
;eez {
usingff 
(ff 
dbModelsff 
contextff  '
=ff( )
newff* -
dbModelsff. 6
(ff6 7
)ff7 8
)ff8 9
employeeff: B
=ffC D
contextffE L
.ffL M
EmployeeffM U
.ffU V
WhereffV [
(ff[ \
xff\ ]
=>ff^ `
xffa b
.ffb c

idEmployeeffc m
==ffn p
idffq s
)ffs t
.fft u
FirstOrDefault	ffu É
(
ffÉ Ñ
)
ffÑ Ö
;
ffÖ Ü
ifgg 
(gg 
employeegg 
==gg 
nullgg  $
)gg$ %
persongg& ,
.gg, -
statusgg- 3
=gg4 5
$numgg6 7
;gg7 8
personhh 
.hh 
phonehh 
=hh 
nullhh #
;hh# $
usingii 
(ii 
dbModelsii 
contextii  '
=ii( )
newii* -
dbModelsii. 6
(ii6 7
)ii7 8
)ii8 9
{jj 
contextkk 
.kk 
Entrykk !
(kk! "
personkk" (
)kk( )
.kk) *
Statekk* /
=kk0 1
Systemkk2 8
.kk8 9
Datakk9 =
.kk= >
Entitykk> D
.kkD E
EntityStatekkE P
.kkP Q
ModifiedkkQ Y
;kkY Z
;kk[ \
contextll 
.ll 
SaveChangesll '
(ll' (
)ll( )
;ll) *
}mm 
usingnn 
(nn 
dbModelsnn 
contextnn  '
=nn( )
newnn* -
dbModelsnn. 6
(nn6 7
)nn7 8
)nn8 9
{oo 
foreachpp 
(pp 
varpp  
itempp! %
inpp& (
	ownerListpp) 2
)pp2 3
{qq 
Ownerrr 
owrr  
=rr! "
contextrr# *
.rr* +
Ownerrr+ 0
.rr0 1
Whererr1 6
(rr6 7
xrr7 8
=>rr9 ;
xrr< =
.rr= >
idOwnerrr> E
==rrF H
itemrrI M
.rrM N
idOwnerrrN U
)rrU V
.rrV W
FirstOrDefaultrrW e
(rre f
)rrf g
;rrg h
contextss 
.ss  
Ownerss  %
.ss% &
Removess& ,
(ss, -
owss- /
)ss/ 0
;ss0 1
}tt 
contextuu 
.uu 
SaveChangesuu '
(uu' (
)uu( )
;uu) *
}vv 
returnww 
RedirectToActionww '
(ww' (
$strww( /
,ww/ 0
$strww1 9
)ww9 :
;ww: ;
}xx 
catchyy 
(yy 
	Exceptionyy 
)yy 
{zz 
return{{ 
RedirectToAction{{ '
({{' (
$str{{( /
,{{/ 0
$str{{1 7
){{7 8
;{{8 9
}|| 
}}} 	
public~~ 
ActionResult~~ 
AutenticarPasosRol~~ .
(~~. /
int~~/ 2
role~~3 7
)~~7 8
{ 	
if
ÄÄ 
(
ÄÄ 
!
ÄÄ 
User
ÄÄ 
.
ÄÄ 
Identity
ÄÄ 
.
ÄÄ 
IsAuthenticated
ÄÄ .
)
ÄÄ. /
return
ÄÄ0 6
RedirectToAction
ÄÄ7 G
(
ÄÄG H
$str
ÄÄH O
,
ÄÄO P
$str
ÄÄQ W
)
ÄÄW X
;
ÄÄX Y
Login
ÅÅ 
logi
ÅÅ 
=
ÅÅ 
new
ÅÅ 
Login
ÅÅ "
(
ÅÅ" #
)
ÅÅ# $
;
ÅÅ$ %
int
ÇÇ 
?
ÇÇ 
roleSession
ÇÇ 
=
ÇÇ 
logi
ÇÇ #
.
ÇÇ# $&
GetRoleSessionFromCookie
ÇÇ$ <
(
ÇÇ< =
Request
ÇÇ= D
)
ÇÇD E
;
ÇÇE F
if
ÉÉ 
(
ÉÉ 
roleSession
ÉÉ 
==
ÉÉ 
null
ÉÉ #
||
ÉÉ$ &
roleSession
ÉÉ' 2
!=
ÉÉ3 5
role
ÉÉ6 :
)
ÉÉ: ;
return
ÉÉ< B
RedirectToAction
ÉÉC S
(
ÉÉS T
$str
ÉÉT [
,
ÉÉ[ \
$str
ÉÉ] c
)
ÉÉc d
;
ÉÉd e
return
ÑÑ 
null
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
}
ÜÜ 
}áá ∑
GC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\ParadasMostrar.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Controllers" -
{ 
public 

class 
ParadasMostrar 
{		 
public

 
int

 
idCheckpoint

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
public 
string 
description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
int 
status 
{ 
get 
;  
set! $
;$ %
}& '
public 
decimal 
latitud 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
decimal 
longitud 
{  !
get" %
;% &
set' *
;* +
}, -
public 
ParadasMostrar 
( 
) 
{ 	
} 	
public 
ParadasMostrar 
( 
int !
idCheckpoint" .
,. /
string0 6
description7 B
,B C
intD G
statusH N
,N O
decimalP W
latitudX _
,_ `
decimala h
longitudi q
)q r
{ 	
this 
. 
idCheckpoint 
= 
idCheckpoint  ,
;, -
this 
. 
description 
= 
description *
;* +
this 
. 
status 
= 
status  
;  !
this 
. 
latitud 
= 
latitud "
;" #
this 
. 
longitud 
= 
longitud $
;$ %
} 	
} 
} √
KC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MuestraTodasLineas.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
MuestraTodasLineas #
{		 
public

 
string

 
nameLine

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
public 
List 
< 
MuestraRutasMapas %
>% &

MuestraLin' 1
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
public 
List 
< 
string 
> 
choferesTiempo *
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
MuestraTodasLineas !
(! "
)" #
{ 	
} 	
public 
MuestraTodasLineas !
(! "
string" (
nameLine) 1
,1 2
List3 7
<7 8
MuestraRutasMapas8 I
>I J

MuestraLinK U
)U V
{ 	
this 
. 
nameLine 
= 
nameLine $
;$ %
this 
. 

MuestraLin 
= 

MuestraLin (
;( )
} 	
public 
MuestraTodasLineas !
(! "
string" (
nameLine) 1
,1 2
List3 7
<7 8
MuestraRutasMapas8 I
>I J

muestraLinK U
,U V
ListW [
<[ \
string\ b
>b c
choferesTiempod r
)r s
:t u
thisv z
(z {
nameLine	{ É
,
É Ñ

muestraLin
Ö è
)
è ê
{ 	
this 
. 
choferesTiempo 
=  !
choferesTiempo" 0
;0 1
} 	
} 
} ä
NC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MuestraRutasPasajeros.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class !
MuestraRutasPasajeros &
{		 
public

 
string

 
nameLine

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 
int 
inicio 
{ 
get 
;  
set! $
;$ %
}& '
public 
int 
final 
{ 
get 
; 
set  #
;# $
}% &
public 
List 
< 
MuestraRutasMapas %
>% &

MuestraLin' 1
{2 3
get4 7
;7 8
set9 <
;< =
}> ?
public 
List 
< 
ChoferTiempo  
>  !
choferTiempos" /
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
public !
MuestraRutasPasajeros $
($ %
)% &
{ 	
} 	
public !
MuestraRutasPasajeros $
($ %
string% +
nameLine, 4
,4 5
int6 9
inicio: @
,@ A
intB E
finalF K
,K L
ListM Q
<Q R
MuestraRutasMapasR c
>c d

muestraLine o
,o p
Listq u
<u v
ChoferTiempo	v Ç
>
Ç É
choferTiempos
Ñ ë
)
ë í
{ 	
this 
. 
nameLine 
= 
nameLine $
;$ %
this 
. 
inicio 
= 
inicio  
;  !
this 
. 
final 
= 
final 
; 

MuestraLin 
= 

muestraLin #
;# $
this 
. 
choferTiempos 
=  
choferTiempos! .
;. /
} 	
} 
} ‰
NC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MuestraListCheckpoint.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class !
MuestraListCheckpoint &
{		 
public

 
string

 

idEmployee

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
int 
idCheckpoint 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public !
MuestraListCheckpoint $
($ %
)% &
{ 	
} 	
public !
MuestraListCheckpoint $
($ %
string% +

idEmployee, 6
,6 7
int8 ;
idCheckpoint< H
,H I
stringJ P
descriptionQ \
)\ ]
{ 	
this 
. 

idEmployee 
= 

idEmployee (
;( )
this 
. 
idCheckpoint 
= 
idCheckpoint  ,
;, -
this 
. 
description 
= 
description *
;* +
} 	
} 
} ›
KC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MuestraControlador.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
MuestraControlador #
{		 
public

 
string

 

idEmployee

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
string 
plate 
{ 
get !
;! "
set# &
;& '
}( )
public 
List 
< 
string 
> 
retrasos $
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
List 
< 
string 
> 
incidencias '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
DateTime 
registerDate $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
int 
	numTicket 
{ 
get "
;" #
set$ '
;' (
}) *
public 
MuestraControlador !
(! "
)" #
{ 	
} 	
public 
MuestraControlador !
(! "
string" (

idEmployee) 3
,3 4
string5 ;
plate< A
,A B
ListC G
<G H
stringH N
>N O
retrasosP X
,X Y
ListZ ^
<^ _
string_ e
>e f
incidenciasg r
,r s
DateTimet |
registerDate	} â
,
â ä
int
ã é
	numTicket
è ò
)
ò ô
{ 	
this 
. 

idEmployee 
= 

idEmployee (
;( )
this 
. 
plate 
= 
plate 
; 
this 
. 
retrasos 
= 
retrasos $
;$ %
this 
. 
incidencias 
= 
incidencias *
;* +
this 
. 
registerDate 
= 
registerDate  ,
;, -
this 
. 
	numTicket 
= 
	numTicket &
;& '
} 	
} 
} ‘
NC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MostrarReportesChofer.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class !
MostrarReportesChofer &
{		 
public

 
string

 
Descripcion

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
public 
int 
Month 
{ 
get 
; 
set  #
;# $
}% &
public 
int 
Year 
{ 
get 
; 
set "
;" #
}$ %
public 
int 
Count 
{ 
get 
; 
set  #
;# $
}% &
public !
MostrarReportesChofer $
($ %
)% &
{ 	
} 	
public !
MostrarReportesChofer $
($ %
string% +
descripcion, 7
,7 8
int9 <
month= B
,B C
intD G
yearH L
,L M
intN Q
countR W
)W X
{ 	
Descripcion 
= 
descripcion %
;% &
Month 
= 
month 
; 
Year 
= 
year 
; 
Count 
= 
count 
; 
} 	
} 
} Ç
JC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\LineaRutaPasajero.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
LineaRutaPasajero "
{		 
public

 
string

 
nameLine

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
public 
int 
inicio 
{ 
get 
;  
set! $
;$ %
}& '
public 
int 
final 
{ 
get 
; 
set  #
;# $
}% &
public 
int 
numRuta 
{ 
get  
;  !
set" %
;% &
}' (
public 
int 
numType 
{ 
get  
;  !
set" %
;% &
}' (
public 
LineaRutaPasajero  
(  !
)! "
{ 	
} 	
public 
LineaRutaPasajero  
(  !
string! '
nameLine( 0
,0 1
int2 5
inicio6 <
,< =
int> A
finalB G
,G H
intI L
numRutaM T
,T U
intV Y
numTypeZ a
)a b
{ 	
this 
. 
nameLine 
= 
nameLine $
;$ %
this 
. 
inicio 
= 
inicio  
;  !
this 
. 
final 
= 
final 
; 
this 
. 
numRuta 
= 
numRuta "
;" #
this 
. 
numType 
= 
numType "
;" #
} 	
} 
} ¬
OC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\MostrarFallasMecanicas.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class "
MostrarFallasMecanicas '
{		 
public

 
string

 
plate

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
fallas 
{ 
get "
;" #
set$ '
;' (
}) *
public 
DateTime 

fechaFalla "
{" #
get$ '
;' (
set) ,
;, -
}. /
public "
MostrarFallasMecanicas %
(% &
)& '
{ 	
} 	
public "
MostrarFallasMecanicas %
(% &
string& ,
plate- 2
,2 3
string4 :
fallas; A
,A B
DateTimeC K

fechaFallaL V
)V W
{ 	
this 
. 
plate 
= 
plate 
; 
this 
. 
fallas 
= 
fallas  
;  !
this 
. 

fechaFalla 
= 

fechaFalla (
;( )
} 	
} 
} √&
GC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\EmployeeGestor.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public		 

class		 
EmployeeGestor		 
{

 
[ 	
Display	 
( 
Name 
= 
$str 
) 
] 
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
DataType	 
( 
DataType 
. 
Text 
)  
]  !
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 8
)8 9
]9 :
public 
string 

idEmployee  
{! "
get# &
;& '
set( +
;+ ,
}- .
[ 	
Display	 
( 
Name 
= 
$str  
)  !
]! "
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
DataType	 
( 
DataType 
. 
Text 
)  
]  !
[ 	
Required	 
( 
ErrorMessage 
=  
$str! <
)< =
]= >
public 
string 
name 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Display	 
( 
Name 
= 
$str "
)" #
]# $
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
DataType	 
( 
DataType 
. 
Text 
)  
]  !
[ 	
Required	 
( 
ErrorMessage 
=  
$str! >
)> ?
]? @
public 
string 
lastname 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Display	 
( 
Name 
= 
$str ,
), -
]- .
[ 	
	MinLength	 
( 
$num 
) 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[   	
DataType  	 
(   
DataType   
.   
PhoneNumber   &
)  & '
]  ' (
[!! 	
Required!!	 
(!! 
ErrorMessage!! 
=!!  
$str!!! >
)!!> ?
]!!? @
public"" 
string"" 
phone"" 
{"" 
get"" !
;""! "
set""# &
;""& '
}""( )
[## 	
Display##	 
(## 
Name## 
=## 
$str##  
)##  !
]##! "
[$$ 	
DataType$$	 
($$ 
DataType$$ 
.$$ 
EmailAddress$$ '
)$$' (
]$$( )
[%% 	
Required%%	 
(%% 
ErrorMessage%% 
=%%  
$str%%! ;
)%%; <
]%%< =
public&& 
string&& 
email&& 
{&& 
get&& !
;&&! "
set&&# &
;&&& '
}&&( )
public'' 
EmployeeGestor'' 
('' 
)'' 
{(( 	
}** 	
public,, 
EmployeeGestor,, 
(,, 
string,, $

idEmployee,,% /
,,,/ 0
string,,1 7
name,,8 <
,,,< =
string,,> D
lastname,,E M
,,,M N
string,,O U
phone,,V [
,,,[ \
string,,] c
email,,d i
),,i j
{-- 	
this.. 
... 

idEmployee.. 
=.. 

idEmployee.. (
;..( )
this// 
.// 
name// 
=// 
name// 
;// 
this00 
.00 
lastname00 
=00 
lastname00 $
;00$ %
this11 
.11 
phone11 
=11 
phone11 
;11 
this22 
.22 
email22 
=22 
email22 
;22 
}33 	
}44 
}55 ÿ
FC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\ChoferVueltas.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
ChoferVueltas 
{		 
public

 
string

 

idEmployee

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
int 
vueltas 
{ 
get  
;  !
set" %
;% &
}' (
public 
DateTime 
fecha 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
horario 
{ 
get  #
;# $
set% (
;( )
}* +
public 
ChoferVueltas 
( 
) 
{  
}! "
public 
ChoferVueltas 
( 
string #

idEmployee$ .
,. /
int0 3
vueltas4 ;
,; <
DateTime= E
fechaF K
,K L
stringM S
horarioT [
)[ \
{ 	
this 
. 

idEmployee 
= 

idEmployee (
;( )
this 
. 
vueltas 
= 
vueltas "
;" #
this 
. 
fecha 
= 
fecha 
; 
this 
. 
horario 
= 
horario "
;" #
} 	
} 
} “
EC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\ChoferTiempo.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
ChoferTiempo 
{		 
public

 
string

 
chofer

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
tiempo 
{ 
get "
;" #
set$ '
;' (
}) *
public 
ChoferTiempo 
( 
) 
{ 	
} 	
public 
ChoferTiempo 
( 
string "
chofer# )
,) *
string+ 1
tiempo2 8
)8 9
{ 	
this 
. 
chofer 
= 
chofer  
;  !
this 
. 
tiempo 
= 
tiempo  
;  !
} 	
} 
} ñ
FC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\ChoferRanking.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
ChoferRanking 
{		 
public

 
string

 

idEmployee

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
int 
vueltas 
{ 
get 
;  
set! $
;$ %
}& '
public 
int 
status 
{ 
get 
;  
set! $
;$ %
}& '
public 
ChoferRanking 
( 
) 
{ 	
} 	
public 
ChoferRanking 
( 
string #

idEmployee$ .
,. /
int0 3
vueltas4 ;
,; <
int= @
statusA G
)G H
{ 	
this 
. 

idEmployee 
= 

idEmployee (
;( )
this 
. 
vueltas 
= 
vueltas "
;" #
this 
. 
status 
= 
status  
;  !
} 	
} 
} à	
KC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\ChoferesTiempoAuxi.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
ChoferesTiempoAuxi #
{		 
public

 
string

 
description

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
public 
int 

dateRegist 
{ 
get  #
;# $
set% (
;( )
}* +
public 
ChoferesTiempoAuxi !
(! "
)" #
{ 	
} 	
public 
ChoferesTiempoAuxi !
(! "
string" (
description) 4
,4 5
int6 9

dateRegist: D
)D E
{ 	
this 
. 
description 
= 
description *
;* +
this 
. 

dateRegist 
= 

dateRegist (
;( )
} 	
} 
} Æ	
LC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\ChoferObservaciones.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
ChoferObservaciones $
{		 
public 
string 
observacion !
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DateTime 
fechaObservacion (
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
ChoferObservaciones "
(" #
)# $
{ 	
} 	
public 
ChoferObservaciones "
(" #
string$ *
observacion+ 6
,6 7
DateTime8 @
fechaObservacionA Q
)Q R
{ 	
this 
. 
observacion 
= 
observacion *
;* +
this 
. 
fechaObservacion !
=" #
fechaObservacion$ 4
;4 5
} 	
} 
} Ê
HC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\CheckpointOrden.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
CheckpointOrden  
{		 
public

 
int

 
idCheckpoint

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
public 
int 
orden 
{ 
get 
; 
set  #
;# $
}% &
public 
CheckpointOrden 
( 
)  
{ 	
} 	
public 
CheckpointOrden 
( 
int "
idCheckpoint# /
,/ 0
int1 4
orden5 :
): ;
{ 	
this 
. 
idCheckpoint 
= 
idCheckpoint  ,
;, -
this 
. 
orden 
= 
orden 
; 
} 	
} 
} Í
FC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\CheckNumRoute.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public 

class 
CheckNumRoute 
{		 
public

 
int

 
idCheckpoint

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
public 
int 
numPoint 
{ 
get !
;! "
set# &
;& '
}( )
public 
CheckNumRoute 
( 
) 
{ 	
} 	
public 
CheckNumRoute 
( 
int  
idCheckpoint! -
,- .
int/ 2
numPoint3 ;
); <
{ 	
this 
. 
idCheckpoint 
= 
idCheckpoint  ,
;, -
this 
. 
numPoint 
= 
numPoint $
;$ %
} 	
} 
} â
HC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Models\BloqueosMostrar.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Models" (
{ 
public		 

class		 
BloqueosMostrar		  
{

 
public 
int 
idDeviation 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
name 
{ 
get  
;  !
set" %
;% &
}' (
public 
List 
< 
RutasMostrar  
>  !
ListRutasMostrar" 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
public 
double 
latitud 
{ 
get  #
;# $
set% (
;( )
}* +
public 
double 
longitud 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
BloqueosMostrar 
( 
)  
{ 	
} 	
public 
BloqueosMostrar 
( 
int "
idDeviation# .
,. /
string0 6
name7 ;
,; <
List= A
<A B
RutasMostrarB N
>N O
listRutasMostrarP `
)` a
{ 	
this 
. 
idDeviation 
= 
idDeviation *
;* +
this 
. 
name 
= 
name 
; 
ListRutasMostrar 
= 
listRutasMostrar /
;/ 0
} 	
public 
BloqueosMostrar 
( 
int "
idDeviation# .
,. /
string0 6
name7 ;
,; <
List= A
<A B
RutasMostrarB N
>N O
listRutasMostrarP `
,` a
doubleb h
latitudi p
,p q
doubler x
longitud	y Å
)
Å Ç
:
É Ñ
this
Ö â
(
â ä
idDeviation
ä ï
,
ï ñ
name
ó õ
,
õ ú
listRutasMostrar
ù ≠
)
≠ Æ
{ 	
this 
. 
latitud 
= 
latitud "
;" #
this   
.   
longitud   
=   
longitud   $
;  $ %
}!! 	
}"" 
}## “—
PC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Controllers\SanctionController.cs
	namespace		 	#
ProyectoControlLineaBus		
 !
.		! "
Controllers		" -
{

 
public 

class 
SanctionController #
:$ %

Controller& 0
{ 
public 
ActionResult 
Index !
(! "
)" #
{ 	
try 
{ 
Login 
logi 
= 
new  
Login! &
(& '
)' (
;( )
var 

authResult 
=  
AutenticarPasosRol! 3
(3 4
$num4 5
)5 6
;6 7
if 
( 

authResult 
!= !
null" &
)& '
return( .

authResult/ 9
;9 :
string 
Line 
= 
logi "
." #
GetLineaFromCookie# 5
(5 6
Request6 =
)= >
.> ?
ToString? G
(G H
)H I
;I J
List 
< 
Sanction 
> 
sanction  (
=) *
new+ .
List/ 3
<4 5
Sanction5 =
>= >
(> ?
)? @
;@ A
using 
( 
dbModels 
context  '
=( )
new* -
dbModels. 6
(6 7
)7 8
)8 9
{ 
sanction 
= 
context &
.& '
Sanction' /
./ 0
Where0 5
(5 6
x6 7
=>7 9
x9 :
.: ;
idLine; A
==B D
LineE I
&&J L
xM N
.N O
statusO U
==V X
$numY Z
)Z [
.[ \
ToList\ b
(b c
)c d
;d e
} 
return 
View 
( 
sanction $
)$ %
;% &
} 
catch 
( 
	Exception 
) 
{   
return!! 
RedirectToAction!! '
(!!' (
$str!!( /
,!!/ 0
$str!!1 7
)!!7 8
;!!8 9
}"" 
}## 	
public%% 
ActionResult%% 
Create%% "
(%%" #
)%%# $
{&& 	
try'' 
{(( 
Login** 
logi** 
=** 
new**  
Login**! &
(**& '
)**' (
;**( )
var++ 

authResult++ 
=++  
AutenticarPasosRol++! 3
(++3 4
$num++4 5
)++5 6
;++6 7
if,, 
(,, 

authResult,, 
!=,, !
null,," &
),,& '
return,,( .

authResult,,/ 9
;,,9 :
return-- 
View-- 
(-- 
)-- 
;-- 
}.. 
catch// 
(// 
	Exception// 
)// 
{00 
return11 
RedirectToAction11 '
(11' (
$str11( /
,11/ 0
$str111 7
)117 8
;118 9
}22 
}33 	
[66 	
HttpPost66	 
]66 
public77 
ActionResult77 
Create77 "
(77" #
	Sanciones77# ,
	sanciones77- 6
)776 7
{88 	
try99 
{:: 
Login<< 
logi<< 
=<< 
new<<  
Login<<! &
(<<& '
)<<' (
;<<( )
var== 

authResult== 
===  
AutenticarPasosRol==! 3
(==3 4
$num==4 5
)==5 6
;==6 7
if>> 
(>> 

authResult>> 
!=>> !
null>>" &
)>>& '
return>>( .

authResult>>/ 9
;>>9 :
string@@ 
Line@@ 
=@@ 
logi@@ "
.@@" #
GetLineaFromCookie@@# 5
(@@5 6
Request@@6 =
)@@= >
.@@> ?
ToString@@? G
(@@G H
)@@H I
;@@I J
SanctionAA 
sanctionAA !
=AA" #
newAA$ '
SanctionAA( 0
(AA0 1
)AA1 2
;AA2 3
usingBB 
(BB 
dbModelsBB 
contextBB  '
=BB( )
newBB* -
dbModelsBB. 6
(BB6 7
)BB7 8
)BB8 9
{CC 
sanctionDD 
.DD 
titleDD "
=DD# $
	sancionesDD% .
.DD. /
titleDD/ 4
;DD4 5
sanctionEE 
.EE 
descriptionEE (
=EE) *
	sancionesEE+ 4
.EE4 5
descriptionEE5 @
;EE@ A
sanctionFF 
.FF 
idLineFF #
=FF$ %
LineFF& *
;FF* +
sanctionGG 
.GG 
statusGG #
=GG$ %
$numGG& '
;GG' (
contextHH 
.HH 
SanctionHH $
.HH$ %
AddHH% (
(HH( )
sanctionHH) 1
)HH1 2
;HH2 3
contextII 
.II 
SaveChangesII '
(II' (
)II( )
;II) *
}JJ 
returnKK 
RedirectToActionKK '
(KK' (
$strKK( /
,KK/ 0
$strKK1 ;
)KK; <
;KK< =
}LL 
catchMM 
(MM 
	ExceptionMM 
)MM 
{NN 
returnOO 
RedirectToActionOO '
(OO' (
$strOO( /
,OO/ 0
$strOO1 7
)OO7 8
;OO8 9
}PP 
}QQ 	
publicUU 
ActionResultUU 
DeleteUU "
(UU" #
intUU# &
idUU' )
)UU) *
{VV 	
tryWW 
{XX 
LoginZZ 
logiZZ 
=ZZ 
newZZ  
LoginZZ! &
(ZZ& '
)ZZ' (
;ZZ( )
var[[ 

authResult[[ 
=[[  
AutenticarPasosRol[[! 3
([[3 4
$num[[4 5
)[[5 6
;[[6 7
if\\ 
(\\ 

authResult\\ 
!=\\ !
null\\" &
)\\& '
return\\( .

authResult\\/ 9
;\\9 :
string^^ 
Line^^ 
=^^ 
logi^^ "
.^^" #
GetLineaFromCookie^^# 5
(^^5 6
Request^^6 =
)^^= >
.^^> ?
ToString^^? G
(^^G H
)^^H I
;^^I J
Sanction__ 
sanction__ !
=__" #
new__$ '
Sanction__( 0
(__0 1
)__1 2
;__2 3
using`` 
(`` 
dbModels`` 
context``  '
=``( )
new``* -
dbModels``. 6
(``6 7
)``7 8
)``8 9
{aa 
sanctionbb 
=bb 
contextbb &
.bb& '
Sanctionbb' /
.bb/ 0
Wherebb0 5
(bb5 6
xbb6 7
=>bb8 :
xbb; <
.bb< =

idSanctionbb= G
==bbH J
idbbK M
)bbM N
.bbN O
FirstOrDefaultbbO ]
(bb] ^
)bb^ _
;bb_ `
sanctioncc 
.cc 
statuscc #
=cc$ %
$numcc& '
;cc' (
contextdd 
.dd 
Entrydd !
(dd! "
sanctiondd" *
)dd* +
.dd+ ,
Statedd, 1
=dd2 3
Systemdd4 :
.dd: ;
Datadd; ?
.dd? @
Entitydd@ F
.ddF G
EntityStateddG R
.ddR S
ModifiedddS [
;dd[ \
contextee 
.ee 
SaveChangesee '
(ee' (
)ee( )
;ee) *
}ff 
returngg 
RedirectToActiongg '
(gg' (
$strgg( /
,gg/ 0
$strgg1 ;
)gg; <
;gg< =
}hh 
catchii 
(ii 
	Exceptionii 
)ii 
{jj 
returnkk 
RedirectToActionkk '
(kk' (
$strkk( /
,kk/ 0
$strkk1 7
)kk7 8
;kk8 9
}ll 
}mm 	
publicoo 
ActionResultoo 
VerSancionesoo (
(oo( )
stringoo) /
idoo0 2
)oo2 3
{pp 	
tryqq 
{rr 
Loginss 
logiss 
=ss 
newss  
Loginss! &
(ss& '
)ss' (
;ss( )
vartt 

authResulttt 
=tt  
AutenticarPasosRoltt! 3
(tt3 4
$numtt4 5
)tt5 6
;tt6 7
ifuu 
(uu 

authResultuu 
!=uu !
nulluu" &
)uu& '
returnuu( .

authResultuu/ 9
;uu9 :
stringvv 
Linevv 
=vv 
logivv "
.vv" #
GetLineaFromCookievv# 5
(vv5 6
Requestvv6 =
)vv= >
.vv> ?
ToStringvv? G
(vvG H
)vvH I
;vvI J
Listww 
<ww $
SancionesEmpleadoMostrarww -
>ww- .%
sancionesEmpleadoMostrarsww/ H
=wwI J
newwwK N
ListwwO S
<wwS T$
SancionesEmpleadoMostrarwwT l
>wwl m
(wwm n
)wwn o
;wwo p
usingxx 
(xx 
dbModelsxx 
contextxx  '
=xx( )
newxx* -
dbModelsxx. 6
(xx6 7
)xx7 8
)xx8 9
{yy 
Listzz 
<zz 
Sanctionzz !
>zz! "
	sanctionszz# ,
=zz- .
newzz/ 2
Listzz3 7
<zz7 8
Sanctionzz8 @
>zz@ A
(zzA B
)zzB C
;zzC D
	sanctions{{ 
={{ 
context{{  '
.{{' (
Sanction{{( 0
.{{0 1
Where{{1 6
({{6 7
x{{7 8
=>{{9 ;
x{{< =
.{{= >
idLine{{> D
=={{E G
Line{{H L
&&{{M O
x{{P Q
.{{Q R
status{{R X
=={{Y [
$num{{\ ]
){{] ^
.{{^ _
ToList{{_ e
({{e f
){{f g
;{{g h
if|| 
(|| 
	sanctions|| !
.||! "
Count||" '
<=||' )
$num||) *
)||* +
{}} 
return~~ 
RedirectToAction~~ /
(~~/ 0
$str~~0 8
,~~8 9
$str~~: D
)~~D E
;~~E F
} 
ViewBag
ÄÄ 
.
ÄÄ "
SancionesDisponibles
ÄÄ 0
=
ÄÄ1 2
	sanctions
ÄÄ3 <
;
ÄÄ< =
}
ÅÅ 
List
ÇÇ 
<
ÇÇ 
SanctionEmployee
ÇÇ %
>
ÇÇ% &
sanction
ÇÇ' /
=
ÇÇ0 1
new
ÇÇ2 5
List
ÇÇ6 :
<
ÇÇ: ;
SanctionEmployee
ÇÇ; K
>
ÇÇK L
(
ÇÇL M
)
ÇÇM N
;
ÇÇN O
using
ÉÉ 
(
ÉÉ 
dbModels
ÉÉ 
context
ÉÉ  '
=
ÉÉ( )
new
ÉÉ* -
dbModels
ÉÉ. 6
(
ÉÉ6 7
)
ÉÉ7 8
)
ÉÉ8 9
{
ÑÑ 
sanction
ÖÖ 
=
ÖÖ 
context
ÖÖ &
.
ÖÖ& '
SanctionEmployee
ÖÖ' 7
.
ÖÖ7 8
Where
ÖÖ8 =
(
ÖÖ= >
x
ÖÖ> ?
=>
ÖÖ@ B
x
ÖÖC D
.
ÖÖD E

idEmployee
ÖÖE O
==
ÖÖP R
id
ÖÖS U
)
ÖÖU V
.
ÖÖV W
ToList
ÖÖW ]
(
ÖÖ] ^
)
ÖÖ^ _
;
ÖÖ_ `
if
ÜÜ 
(
ÜÜ 
sanction
ÜÜ  
.
ÜÜ  !
Count
ÜÜ! &
>
ÜÜ' (
$num
ÜÜ) *
)
ÜÜ* +
{
áá 
foreach
àà 
(
àà  !
var
àà! $
item
àà% )
in
àà* ,
sanction
àà- 5
)
àà5 6
{
ââ 
var
ää 
titulo
ää  &
=
ää' (
context
ää) 0
.
ää0 1
Sanction
ää1 9
.
ää9 :
Where
ää: ?
(
ää? @
x
ää@ A
=>
ääB D
x
ääE F
.
ääF G

idSanction
ääG Q
==
ääR T
item
ääU Y
.
ääY Z

idSanction
ääZ d
&&
ääe g
x
ääh i
.
ääi j
status
ääj p
==
ääq s
$num
äät u
)
ääu v
.
ääv w
FirstOrDefaultääw Ö
(ääÖ Ü
)ääÜ á
;ääá à
if
ãã 
(
ãã 
titulo
ãã %
!=
ãã& (
null
ãã) -
)
ãã- .'
sancionesEmpleadoMostrars
åå 5
.
åå5 6
Add
åå6 9
(
åå9 :
new
åå: =&
SancionesEmpleadoMostrar
åå> V
(
ååV W
id
ååW Y
,
ååY Z
titulo
åå[ a
.
ååa b
title
ååb g
,
ååg h
titulo
ååh n
.
åån o
description
ååo z
,
ååz {
DateTimeåå| Ñ
.ååÑ Ö
ParseååÖ ä
(ååä ã
itemååã è
.ååè ê
dateRegisterååê ú
.ååú ù
ToStringååù •
(åå• ¶
)åå¶ ß
)ååß ®
)åå® ©
)åå© ™
;åå™ ´
}
çç 
}
éé 
}
èè 
ViewBag
êê 
.
êê 
ci
êê 
=
êê 
id
êê 
;
êê  
return
ëë 
View
ëë 
(
ëë '
sancionesEmpleadoMostrars
ëë 5
)
ëë5 6
;
ëë6 7
}
íí 
catch
ìì 
(
ìì 
	Exception
ìì 
)
ìì 
{
îî 
return
ïï 
RedirectToAction
ïï '
(
ïï' (
$str
ïï( /
,
ïï/ 0
$str
ïï1 7
)
ïï7 8
;
ïï8 9
}
ññ 
}
óó 	
public
ôô 
ActionResult
ôô $
CreateEmployeeSanction
ôô 2
(
ôô2 3
string
ôô3 9
id
ôô: <
,
ôô< =
int
ôô= @
	sanctione
ôôA J
)
ôôJ K
{
öö 	
try
õõ 
{
úú 
Login
ûû 
logi
ûû 
=
ûû 
new
ûû  
Login
ûû! &
(
ûû& '
)
ûû' (
;
ûû( )
var
üü 

authResult
üü 
=
üü   
AutenticarPasosRol
üü! 3
(
üü3 4
$num
üü4 5
)
üü5 6
;
üü6 7
if
†† 
(
†† 

authResult
†† 
!=
†† !
null
††" &
)
††& '
return
††( .

authResult
††/ 9
;
††9 :
TimeZoneInfo
°° 
boliviaTimeZone
°° ,
=
°°- .
TimeZoneInfo
°°/ ;
.
°°; <$
FindSystemTimeZoneById
°°< R
(
°°R S
$str
°°S m
)
°°m n
;
°°n o
DateTime
¢¢ 
boliviaTime
¢¢ $
=
¢¢% &
TimeZoneInfo
¢¢' 3
.
¢¢3 4
ConvertTime
¢¢4 ?
(
¢¢? @
DateTime
¢¢@ H
.
¢¢H I
UtcNow
¢¢I O
,
¢¢O P
boliviaTimeZone
¢¢Q `
)
¢¢` a
;
¢¢a b
string
££ 
Line
££ 
=
££ 
logi
££ "
.
££" # 
GetLineaFromCookie
££# 5
(
££5 6
Request
££6 =
)
££= >
.
££> ?
ToString
££? G
(
££G H
)
££H I
;
££I J
SanctionEmployee
§§  
sanction
§§! )
=
§§* +
new
§§, /
SanctionEmployee
§§0 @
(
§§@ A
)
§§A B
;
§§B C
using
•• 
(
•• 
dbModels
•• 
context
••  '
=
••( )
new
••* -
dbModels
••. 6
(
••6 7
)
••7 8
)
••8 9
{
¶¶ 
sanction
ßß 
.
ßß 

idEmployee
ßß '
=
ßß( )
id
ßß* ,
;
ßß, -
sanction
®® 
.
®® 

idSanction
®® '
=
®®( )
	sanctione
®®* 3
;
®®3 4
sanction
©© 
.
©© 
dateRegister
©© )
=
©©* +
boliviaTime
©©, 7
;
©©7 8
context
™™ 
.
™™ 
SanctionEmployee
™™ ,
.
™™, -
Add
™™- 0
(
™™0 1
sanction
™™1 9
)
™™9 :
;
™™: ;
context
´´ 
.
´´ 
SaveChanges
´´ '
(
´´' (
)
´´( )
;
´´) *
}
¨¨ 
return
≠≠ 
RedirectToAction
≠≠ '
(
≠≠' (
$str
≠≠( 6
,
≠≠6 7
$str
≠≠8 B
,
≠≠B C
new
≠≠D G
{
≠≠H I
id
≠≠I K
=
≠≠L M
id
≠≠N P
}
≠≠P Q
)
≠≠Q R
;
≠≠R S
}
ÆÆ 
catch
ØØ 
(
ØØ 
	Exception
ØØ 
)
ØØ 
{
∞∞ 
return
±± 
RedirectToAction
±± '
(
±±' (
$str
±±( /
,
±±/ 0
$str
±±1 7
)
±±7 8
;
±±8 9
}
≤≤ 
}
≥≥ 	
public
¥¥ 
ActionResult
¥¥ "
VerSancionesEscogido
¥¥ 0
(
¥¥0 1
string
¥¥1 7
id
¥¥8 :
,
¥¥: ;
string
¥¥< B
selectedYear
¥¥C O
)
¥¥O P
{
µµ 	
try
∂∂ 
{
∑∑ 
Login
∏∏ 
logi
∏∏ 
=
∏∏ 
new
∏∏  
Login
∏∏! &
(
∏∏& '
)
∏∏' (
;
∏∏( )
var
ππ 

authResult
ππ 
=
ππ   
AutenticarPasosRol
ππ! 3
(
ππ3 4
$num
ππ4 5
)
ππ5 6
;
ππ6 7
if
∫∫ 
(
∫∫ 

authResult
∫∫ 
!=
∫∫ !
null
∫∫" &
)
∫∫& '
return
∫∫( .

authResult
∫∫/ 9
;
∫∫9 :
string
ªª 
Line
ªª 
=
ªª 
logi
ªª "
.
ªª" # 
GetLineaFromCookie
ªª# 5
(
ªª5 6
Request
ªª6 =
)
ªª= >
.
ªª> ?
ToString
ªª? G
(
ªªG H
)
ªªH I
;
ªªI J
List
ºº 
<
ºº &
SancionesEmpleadoMostrar
ºº -
>
ºº- .'
sancionesEmpleadoMostrars
ºº/ H
=
ººI J
new
ººK N
List
ººO S
<
ººS T&
SancionesEmpleadoMostrar
ººT l
>
ººl m
(
ººm n
)
ººn o
;
ººo p
List
ΩΩ 
<
ΩΩ 
SanctionEmployee
ΩΩ %
>
ΩΩ% &
sanction
ΩΩ' /
=
ΩΩ0 1
new
ΩΩ2 5
List
ΩΩ6 :
<
ΩΩ: ;
SanctionEmployee
ΩΩ; K
>
ΩΩK L
(
ΩΩL M
)
ΩΩM N
;
ΩΩN O
using
ææ 
(
ææ 
dbModels
ææ 
context
ææ  '
=
ææ( )
new
ææ* -
dbModels
ææ. 6
(
ææ6 7
)
ææ7 8
)
ææ8 9
{
øø 
var
¿¿ 
	sanctione
¿¿ !
=
¿¿" #
context
¿¿$ +
.
¿¿+ ,
SanctionEmployee
¿¿, <
.
¿¿< =
Where
¿¿= B
(
¿¿B C
x
¿¿C D
=>
¿¿E G
x
¿¿H I
.
¿¿I J

idEmployee
¿¿J T
==
¿¿U W
id
¿¿X Z
)
¿¿Z [
.
¿¿[ \
ToList
¿¿\ b
(
¿¿b c
)
¿¿c d
;
¿¿d e
if
¡¡ 
(
¡¡ 
selectedYear
¡¡ $
!=
¡¡% '
$str
¡¡( 8
)
¡¡8 9
{
¬¬ 
sanction
√√  
=
√√! "
	sanctione
√√# ,
.
√√, -
Where
√√- 2
(
√√2 3
x
√√3 4
=>
√√5 7
DateTime
√√8 @
.
√√@ A
Parse
√√A F
(
√√F G
x
√√G H
.
√√H I
dateRegister
√√I U
.
√√U V
ToString
√√V ^
(
√√^ _
)
√√_ `
)
√√` a
.
√√a b
Year
√√b f
==
√√g i
int
√√j m
.
√√m n
Parse
√√n s
(
√√s t
selectedYear√√t Ä
)√√Ä Å
)√√Å Ç
.√√Ç É
ToList√√É â
(√√â ä
)√√ä ã
;√√ã å
}
ƒƒ 
else
≈≈ 
sanction
≈≈ !
=
≈≈" #
	sanctione
≈≈$ -
;
≈≈- .
if
∆∆ 
(
∆∆ 
sanction
∆∆  
.
∆∆  !
Count
∆∆! &
>
∆∆' (
$num
∆∆) *
)
∆∆* +
{
«« 
foreach
»» 
(
»»  !
var
»»! $
item
»»% )
in
»»* ,
sanction
»»- 5
)
»»5 6
{
…… 
var
   
titulo
    &
=
  ' (
context
  ) 0
.
  0 1
Sanction
  1 9
.
  9 :
Where
  : ?
(
  ? @
x
  @ A
=>
  B D
x
  E F
.
  F G

idSanction
  G Q
==
  R T
item
  U Y
.
  Y Z

idSanction
  Z d
&&
  e g
x
  h i
.
  i j
status
  j p
==
  q s
$num
  t u
)
  u v
.
  v w
FirstOrDefault  w Ö
(  Ö Ü
)  Ü á
;  á à
if
ÀÀ 
(
ÀÀ  
titulo
ÀÀ  &
!=
ÀÀ' )
null
ÀÀ* .
)
ÀÀ. /'
sancionesEmpleadoMostrars
ÃÃ  9
.
ÃÃ9 :
Add
ÃÃ: =
(
ÃÃ= >
new
ÃÃ> A&
SancionesEmpleadoMostrar
ÃÃB Z
(
ÃÃZ [
id
ÃÃ[ ]
,
ÃÃ] ^
titulo
ÃÃ_ e
.
ÃÃe f
title
ÃÃf k
,
ÃÃk l
titulo
ÃÃl r
.
ÃÃr s
description
ÃÃs ~
,
ÃÃ~ 
DateTimeÃÃÄ à
.ÃÃà â
ParseÃÃâ é
(ÃÃé è
itemÃÃè ì
.ÃÃì î
dateRegisterÃÃî †
.ÃÃ† °
ToStringÃÃ° ©
(ÃÃ© ™
)ÃÃ™ ´
)ÃÃ´ ¨
)ÃÃ¨ ≠
)ÃÃ≠ Æ
;ÃÃÆ Ø
}
ÕÕ 
}
ŒŒ 
}
œœ 
ViewBag
–– 
.
–– 
ci
–– 
=
–– 
id
–– 
;
––  
return
—— 
View
—— 
(
—— '
sancionesEmpleadoMostrars
—— 5
)
——5 6
;
——6 7
}
““ 
catch
”” 
(
”” 
	Exception
”” 
)
”” 
{
‘‘ 
return
’’ 
RedirectToAction
’’ '
(
’’' (
$str
’’( /
,
’’/ 0
$str
’’1 7
)
’’7 8
;
’’8 9
}
÷÷ 
}
◊◊ 	
public
ÿÿ 
ActionResult
ÿÿ !
PrintedReportFallas
ÿÿ /
(
ÿÿ/ 0
string
ÿÿ0 6
id
ÿÿ7 9
,
ÿÿ9 :
string
ÿÿ; A
selectedYear
ÿÿB N
)
ÿÿN O
{
ŸŸ 	
try
⁄⁄ 
{
€€ 
Login
‹‹ 
logi
‹‹ 
=
‹‹ 
new
‹‹  
Login
‹‹! &
(
‹‹& '
)
‹‹' (
;
‹‹( )
var
›› 

authResult
›› 
=
››   
AutenticarPasosRol
››! 3
(
››3 4
$num
››4 5
)
››5 6
;
››6 7
if
ﬁﬁ 
(
ﬁﬁ 

authResult
ﬁﬁ 
!=
ﬁﬁ !
null
ﬁﬁ" &
)
ﬁﬁ& '
return
ﬁﬁ( .

authResult
ﬁﬁ/ 9
;
ﬁﬁ9 :
TimeZoneInfo
ﬂﬂ 
boliviaTimeZone
ﬂﬂ ,
=
ﬂﬂ- .
TimeZoneInfo
ﬂﬂ/ ;
.
ﬂﬂ; <$
FindSystemTimeZoneById
ﬂﬂ< R
(
ﬂﬂR S
$str
ﬂﬂS m
)
ﬂﬂm n
;
ﬂﬂn o
DateTime
‡‡ 
boliviaTime
‡‡ $
=
‡‡% &
TimeZoneInfo
‡‡' 3
.
‡‡3 4
ConvertTime
‡‡4 ?
(
‡‡? @
DateTime
‡‡@ H
.
‡‡H I
UtcNow
‡‡I O
,
‡‡O P
boliviaTimeZone
‡‡Q `
)
‡‡` a
;
‡‡a b
return
·· 
new
·· 
ActionAsPdf
·· &
(
··& '
$str
··' =
,
··= >
new
··? B
{
··C D
id
··E G
=
··H I
id
··J L
,
··L M
selectedYear
··N Z
=
··[ \
selectedYear
··] i
}
··j k
)
··k l
{
··m n
FileName
··o w
=
··x y
id
··z |
+
··} ~
$str·· Ç
+··É Ñ
selectedYear··Ö ë
+··í ì
$str··î ó
+··ò ô
boliviaTime··ö •
.··• ¶
Day··¶ ©
+··™ ´
boliviaTime··¨ ∑
.··∑ ∏
Month··∏ Ω
+··æ ø
boliviaTime··¿ À
.··À Ã
Year··Ã –
+··— “
$str··” Ÿ
}··⁄ €
;··€ ‹
}
‚‚ 
catch
„„ 
(
„„ 
	Exception
„„ 
)
„„ 
{
‰‰ 
return
ÂÂ 
RedirectToAction
ÂÂ '
(
ÂÂ' (
$str
ÂÂ( /
,
ÂÂ/ 0
$str
ÂÂ1 7
)
ÂÂ7 8
;
ÂÂ8 9
}
ÊÊ 
}
ÁÁ 	
public
ËË 
ActionResult
ËË  
AutenticarPasosRol
ËË .
(
ËË. /
int
ËË/ 2
role
ËË3 7
)
ËË7 8
{
ÈÈ 	
if
ÍÍ 
(
ÍÍ 
!
ÍÍ 
User
ÍÍ 
.
ÍÍ 
Identity
ÍÍ 
.
ÍÍ 
IsAuthenticated
ÍÍ .
)
ÍÍ. /
return
ÍÍ0 6
RedirectToAction
ÍÍ7 G
(
ÍÍG H
$str
ÍÍH O
,
ÍÍO P
$str
ÍÍQ W
)
ÍÍW X
;
ÍÍX Y
Login
ÎÎ 
logi
ÎÎ 
=
ÎÎ 
new
ÎÎ 
Login
ÎÎ "
(
ÎÎ" #
)
ÎÎ# $
;
ÎÎ$ %
int
ÏÏ 
?
ÏÏ 
roleSession
ÏÏ 
=
ÏÏ 
logi
ÏÏ #
.
ÏÏ# $&
GetRoleSessionFromCookie
ÏÏ$ <
(
ÏÏ< =
Request
ÏÏ= D
)
ÏÏD E
;
ÏÏE F
if
ÌÌ 
(
ÌÌ 
roleSession
ÌÌ 
==
ÌÌ 
null
ÌÌ #
||
ÌÌ$ &
roleSession
ÌÌ' 2
!=
ÌÌ3 5
role
ÌÌ6 :
)
ÌÌ: ;
return
ÌÌ< B
RedirectToAction
ÌÌC S
(
ÌÌS T
$str
ÌÌT [
,
ÌÌ[ \
$str
ÌÌ] c
)
ÌÌc d
;
ÌÌd e
return
ÓÓ 
null
ÓÓ 
;
ÓÓ 
}
ÔÔ 	
}
ÒÒ 
}ÚÚ îº
MC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Controllers\OwnerController.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Controllers" -
{		 
public

 

class

 
OwnerController

  
:

! "

Controller

# -
{ 
public 
ActionResult 
Index !
(! "
string" (
id) +
)+ ,
{ 	
try 
{ 
if 
( 
id 
== 
null 
&& !
Session" )
[) *
$str* 5
]5 6
==7 9
null: >
)> ?
return@ F
RedirectToActionG W
(W X
$strX _
,_ `
$stra g
)g h
;h i
if 
( 
Session 
[ 
$str &
]& '
==( *
null+ /
)/ 0
Session 
[ 
$str #
]# $
=% &
id' )
;) *
id 
= 
Session 
[ 
$str (
]( )
.) *
ToString* 2
(2 3
)3 4
;4 5
var 

authResult 
=  
AutenticarPasosRol! 3
(3 4
$num4 5
)5 6
;6 7
if 
( 

authResult 
!= !
null" &
)& '
return( .

authResult/ 9
;9 :
List 
< 
Owner 
> 
owner !
=" #
new$ '
List( ,
<, -
Owner- 2
>2 3
(3 4
)4 5
;5 6
List 
< 
MuestraOwner !
>! "
muestraOwners# 0
=1 2
new3 6
List7 ;
<; <
MuestraOwner< H
>H I
(I J
)J K
;K L
if 
( 
Session 
[ 
$str /
]/ 0
==1 3
null4 8
)8 9
Session 
[ 
$str /
]/ 0
=1 2
id3 5
;5 6
string 
s 
= 
Session "
[" #
$str# 6
]6 7
.7 8
ToString8 @
(@ A
)A B
;B C
using 
( 
dbModels 
context  '
=( )
new* -
dbModels. 6
(6 7
)7 8
)8 9
{ 
owner 
= 
context #
.# $
Owner$ )
.) *
Where* /
(/ 0
x0 1
=>2 4
x5 6
.6 7
idLine7 =
==> @
sA B
)B C
.C D
ToListD J
(J K
)K L
;L M
} 
if   
(   
owner   
.   
Count   
>    !
$num  " #
)  # $
using!! 
(!! 
dbModels!! #
context!!$ +
=!!, -
new!!. 1
dbModels!!2 :
(!!: ;
)!!; <
)!!< =
{"" 
foreach## 
(##  !
var##! $
item##% )
in##* ,
owner##- 2
)##2 3
{$$ 
Person%% "
person%%# )
=%%* +
context%%, 3
.%%3 4
Person%%4 :
.%%: ;
Where%%; @
(%%@ A
x%%A B
=>%%C E
x%%F G
.%%G H
nit%%H K
==%%L N
item%%O S
.%%S T
idPerson%%T \
)%%\ ]
.%%] ^
FirstOrDefault%%^ l
(%%l m
)%%m n
;%%n o
muestraOwners&& )
.&&) *
Add&&* -
(&&- .
new&&. 1
MuestraOwner&&2 >
(&&> ?
item&&? C
.&&C D
idLine&&D J
.&&J K
ToString&&K S
(&&S T
)&&T U
,&&U V
item&&W [
.&&[ \
idPerson&&\ d
,&&d e
person&&f l
.&&l m
nit&&m p
,&&p q
item&&r v
.&&v w
doc&&w z
,&&z {
item	&&| Ä
.
&&Ä Å
idOwner
&&Å à
)
&&à â
)
&&â ä
;
&&ä ã
}'' 
})) 
return** 
View** 
(** 
muestraOwners** )
)**) *
;*** +
}++ 
catch,, 
(,, 
	Exception,, 
),, 
{-- 
return.. 
RedirectToAction.. '
(..' (
$str..( /
,../ 0
$str..1 7
)..7 8
;..8 9
}// 
}00 	
public11 
ActionResult11 
Details11 #
(11# $
string11$ *
id11+ -
)11- .
{22 	
try33 
{44 
if55 
(55 
id55 
==55 
null55 
)55 
return55  &
RedirectToAction55' 7
(557 8
$str558 ?
,55? @
$str55A G
)55G H
;55H I
var66 

authResult66 
=66  
AutenticarPasosRol66! 3
(663 4
$num664 5
)665 6
;666 7
if77 
(77 

authResult77 
!=77 !
null77" &
)77& '
return77( .

authResult77/ 9
;779 :
using88 
(88 
dbModels88 
context88  '
=88( )
new88* -
dbModels88. 6
(886 7
)887 8
)888 9
{99 
return:: 
View:: 
(::  
context::  '
.::' (
Person::( .
.::. /
Where::/ 4
(::4 5
x::5 6
=>::7 9
x::: ;
.::; <
nit::< ?
==::@ B
id::C E
)::E F
.::F G
FirstOrDefault::G U
(::U V
)::V W
)::W X
;::X Y
};; 
}<< 
catch== 
(== 
	Exception== 
)== 
{>> 
return?? 
RedirectToAction?? '
(??' (
$str??( /
,??/ 0
$str??1 7
)??7 8
;??8 9
}@@ 
}AA 	
publicDD 
ActionResultDD 
CreateDD "
(DD" #
)DD# $
{EE 	
tryFF 
{GG 
varHH 

authResultHH 
=HH  
AutenticarPasosRolHH! 3
(HH3 4
$numHH4 5
)HH5 6
;HH6 7
ifII 
(II 

authResultII 
!=II !
nullII" &
)II& '
returnII( .

authResultII/ 9
;II9 :
OwnerAuxiliarJJ 
ownerAuxiliarJJ +
=JJ, -
newJJ. 1
OwnerAuxiliarJJ2 ?
(JJ? @
)JJ@ A
;JJA B
ifKK 
(KK 
SessionKK 
[KK 
$strKK )
]KK) *
!=KK+ -
nullKK. 2
)KK2 3
ownerAuxiliarKK4 A
.KKA B
nitKKB E
=KKF G
SessionKKH O
[KKO P
$strKKP ]
]KK] ^
.KK^ _
ToStringKK_ g
(KKg h
)KKh i
;KKi j
SessionLL 
[LL 
$strLL %
]LL% &
=LL' (
nullLL) -
;LL- .
returnMM 
ViewMM 
(MM 
ownerAuxiliarMM )
)MM) *
;MM* +
}NN 
catchOO 
(OO 
	ExceptionOO 
)OO 
{PP 
returnQQ 
RedirectToActionQQ '
(QQ' (
$strQQ( /
,QQ/ 0
$strQQ1 7
)QQ7 8
;QQ8 9
}RR 
}SS 	
[VV 	
HttpPostVV	 
]VV 
publicWW 
ActionResultWW 
CreateWW "
(WW" #
OwnerAuxiliarWW# 0
muestraOwnerWW1 =
)WW= >
{XX 	
tryYY 
{ZZ 
var[[ 

authResult[[ 
=[[  
AutenticarPasosRol[[! 3
([[3 4
$num[[4 5
)[[5 6
;[[6 7
if\\ 
(\\ 

authResult\\ 
!=\\ !
null\\" &
)\\& '
return\\( .

authResult\\/ 9
;\\9 :
string]] 
idLine]] 
=]] 
Session]]  '
[]]' (
$str]]( ;
]]]; <
.]]< =
ToString]]= E
(]]E F
)]]F G
;]]G H
Owner^^ 
ow^^ 
=^^ 
new^^ 
Owner^^ $
(^^$ %
)^^% &
;^^& '
Person__ 
valid__ 
=__ 
new__ "
Person__# )
(__) *
)__* +
;__+ ,
Employee`` 
employee`` !
=``" #
new``$ '
Employee``( 0
(``0 1
)``1 2
;``2 3
usingaa 
(aa 
dbModelsaa 
contextaa  '
=aa( )
newaa* -
dbModelsaa. 6
(aa6 7
)aa7 8
)aa8 9
employeeaa: B
=aaC D
contextaaE L
.aaL M
EmployeeaaM U
.aaU V
WhereaaV [
(aa[ \
xaa\ ]
=>aa^ `
xaaa b
.aab c

idEmployeeaac m
==aan p
muestraOwneraaq }
.aa} ~
nit	aa~ Å
.
aaÅ Ç
ToUpper
aaÇ â
(
aaâ ä
)
aaä ã
.
aaã å
Trim
aaå ê
(
aaê ë
)
aaë í
)
aaí ì
.
aaì î
FirstOrDefault
aaî ¢
(
aa¢ £
)
aa£ §
;
aa§ •
usingbb 
(bb 
dbModelsbb 
contextbb  '
=bb( )
newbb* -
dbModelsbb. 6
(bb6 7
)bb7 8
)bb8 9
{cc 
validdd 
=dd 
contextdd #
.dd# $
Persondd$ *
.dd* +
Wheredd+ 0
(dd0 1
xdd1 2
=>dd3 5
xdd6 7
.dd7 8
nitdd8 ;
==dd< >
muestraOwnerdd? K
.ddK L
nitddL O
.ddO P
ToUpperddP W
(ddW X
)ddX Y
.ddY Z
TrimddZ ^
(dd^ _
)dd_ `
&&dda c
xddd e
.dde f
statusddf l
==ddm o
$numddp q
)ddq r
.ddr s
FirstOrDefault	dds Å
(
ddÅ Ç
)
ddÇ É
;
ddÉ Ñ
ifee 
(ee 
validee 
==ee  
nullee! %
)ee% &
returnff 
RedirectToActionff /
(ff/ 0
$strff0 ;
,ff; <
newff= @
{ffA B
idffB D
=ffE F
muestraOwnerffG S
.ffS T
nitffT W
}ffW X
)ffX Y
;ffY Z
elsegg 
ifgg 
(gg 
validgg !
.gg! "
phonegg" '
==gg( *
nullgg+ /
)gg/ 0
{hh 
validii 
.ii 
phoneii #
=ii$ %
$strii& ,
;ii, -
contextjj 
.jj  
Entryjj  %
(jj% &
validjj& +
)jj+ ,
.jj, -
Statejj- 2
=jj3 4
Systemjj5 ;
.jj; <
Datajj< @
.jj@ A
EntityjjA G
.jjG H
EntityStatejjH S
.jjS T
ModifiedjjT \
;jj\ ]
contextkk 
.kk  
SaveChangeskk  +
(kk+ ,
)kk, -
;kk- .
}ll 
}mm 
usingnn 
(nn 
dbModelsnn 
contextnn  '
=nn( )
newnn* -
dbModelsnn. 6
(nn6 7
)nn7 8
)nn8 9
{oo 
owpp 
=pp 
contextpp  
.pp  !
Ownerpp! &
.pp& '
Wherepp' ,
(pp, -
xpp- .
=>pp/ 1
xpp2 3
.pp3 4
idLinepp4 :
==pp; =
idLinepp> D
&&ppE G
xppH I
.ppI J
idPersonppJ R
==ppS U
muestraOwnerppV b
.ppb c
nitppc f
.ppf g
ToUpperppg n
(ppn o
)ppo p
.ppp q
Trimppq u
(ppu v
)ppv w
)ppw x
.ppx y
FirstOrDefault	ppy á
(
ppá à
)
ppà â
;
ppâ ä
ifqq 
(qq 
owqq 
!=qq 
nullqq "
)qq" #
{qq$ %
TempDataqq& .
[qq. /
$strqq/ C
]qqC D
=qqE F
$strqqG ]
;qq] ^
returnqq_ e
Viewqqf j
(qqj k
)qqk l
;qql m
}qqn o
Ownerrr 
ownerrr 
=rr  !
newrr" %
Ownerrr& +
(rr+ ,
)rr, -
;rr- .
ownerss 
.ss 
idLiness  
=ss! "
idLiness# )
;ss) *
ownertt 
.tt 
idPersontt "
=tt# $
muestraOwnertt% 1
.tt1 2
nittt2 5
.tt5 6
ToUppertt6 =
(tt= >
)tt> ?
.tt? @
Trimtt@ D
(ttD E
)ttE F
;ttF G
owneruu 
.uu 
docuu 
=uu 
muestraOwneruu  ,
.uu, -
docuu- 0
;uu0 1
contextvv 
.vv 
Ownervv !
.vv! "
Addvv" %
(vv% &
ownervv& +
)vv+ ,
;vv, -
contextww 
.ww 
SaveChangesww '
(ww' (
)ww( )
;ww) *
returnxx 
RedirectToActionxx +
(xx+ ,
$strxx, 3
,xx3 4
newxx5 8
{xx9 :
idxx; =
=xx> ?
Sessionxx@ G
[xxG H
$strxxH [
]xx[ \
}xx] ^
)xx^ _
;xx_ `
}yy 
}zz 
catch{{ 
({{ 
	Exception{{ 
){{ 
{|| 
return}} 
RedirectToAction}} '
(}}' (
$str}}( /
,}}/ 0
$str}}1 7
)}}7 8
;}}8 9
}~~ 
} 	
public
ÉÉ 
ActionResult
ÉÉ 
Delete
ÉÉ "
(
ÉÉ" #
int
ÉÉ# &
id
ÉÉ' )
)
ÉÉ) *
{
ÑÑ 	
try
ÖÖ 
{
ÜÜ 
var
áá 

authResult
áá 
=
áá   
AutenticarPasosRol
áá! 3
(
áá3 4
$num
áá4 5
)
áá5 6
;
áá6 7
if
àà 
(
àà 

authResult
àà 
!=
àà !
null
àà" &
)
àà& '
return
àà( .

authResult
àà/ 9
;
àà9 :
Owner
ââ 
owner
ââ 
=
ââ 
new
ââ !
Owner
ââ" '
(
ââ' (
)
ââ( )
;
ââ) *
using
ää 
(
ää 
dbModels
ää 
context
ää  '
=
ää( )
new
ää* -
dbModels
ää. 6
(
ää6 7
)
ää7 8
)
ää8 9
{
ãã 
owner
åå 
=
åå 
context
åå #
.
åå# $
Owner
åå$ )
.
åå) *
Where
åå* /
(
åå/ 0
x
åå0 1
=>
åå2 4
x
åå5 6
.
åå6 7
idOwner
åå7 >
==
åå? A
id
ååB D
)
ååD E
.
ååE F
FirstOrDefault
ååF T
(
ååT U
)
ååU V
;
ååV W
context
çç 
.
çç 
Owner
çç !
.
çç! "
Remove
çç" (
(
çç( )
owner
çç) .
)
çç. /
;
çç/ 0
context
éé 
.
éé 
SaveChanges
éé '
(
éé' (
)
éé( )
;
éé) *
}
èè 
return
êê 
RedirectToAction
êê '
(
êê' (
$str
êê( /
)
êê/ 0
;
êê0 1
}
ëë 
catch
íí 
(
íí 
	Exception
íí 
)
íí 
{
ìì 
return
îî 
RedirectToAction
îî '
(
îî' (
$str
îî( /
,
îî/ 0
$str
îî1 7
)
îî7 8
;
îî8 9
}
ïï 
}
ññ 	
public
óó 
ActionResult
óó 
	AddPerson
óó %
(
óó% &
string
óó& ,
id
óó- /
)
óó/ 0
{
òò 	
try
ôô 
{
öö 
if
õõ 
(
õõ 
id
õõ 
==
õõ 
null
õõ 
)
õõ 
return
õõ  &
RedirectToAction
õõ' 7
(
õõ7 8
$str
õõ8 ?
,
õõ? @
$str
õõA G
)
õõG H
;
õõH I
var
úú 

authResult
úú 
=
úú   
AutenticarPasosRol
úú! 3
(
úú3 4
$num
úú4 5
)
úú5 6
;
úú6 7
if
ùù 
(
ùù 

authResult
ùù 
!=
ùù !
null
ùù" &
)
ùù& '
return
ùù( .

authResult
ùù/ 9
;
ùù9 :
Session
ûû 
[
ûû 
$str
ûû %
]
ûû% &
=
ûû' (
id
ûû) +
.
ûû+ ,
ToUpper
ûû, 3
(
ûû3 4
)
ûû4 5
.
ûû5 6
Trim
ûû6 :
(
ûû: ;
)
ûû; <
;
ûû< =
return
üü 
View
üü 
(
üü 
)
üü 
;
üü 
}
†† 
catch
°° 
(
°° 
	Exception
°° 
)
°° 
{
¢¢ 
return
££ 
RedirectToAction
££ '
(
££' (
$str
££( /
,
££/ 0
$str
££1 7
)
££7 8
;
££8 9
}
§§ 
}
¶¶ 	
[
ßß 	
HttpPost
ßß	 
]
ßß 
public
®® 
ActionResult
®® 
	AddPerson
®® %
(
®®% &
string
®®& ,
id
®®- /
,
®®/ 0
OwnerAuxiliar
®®0 =
ownerAuxiliar
®®> K
)
®®K L
{
©© 	
try
™™ 
{
´´ 
var
¨¨ 

authResult
¨¨ 
=
¨¨   
AutenticarPasosRol
¨¨! 3
(
¨¨3 4
$num
¨¨4 5
)
¨¨5 6
;
¨¨6 7
if
≠≠ 
(
≠≠ 

authResult
≠≠ 
!=
≠≠ !
null
≠≠" &
)
≠≠& '
return
≠≠( .

authResult
≠≠/ 9
;
≠≠9 :
string
ÆÆ 
nit
ÆÆ 
=
ÆÆ 
Session
ÆÆ $
[
ÆÆ$ %
$str
ÆÆ% 2
]
ÆÆ2 3
.
ÆÆ3 4
ToString
ÆÆ4 <
(
ÆÆ< =
)
ÆÆ= >
;
ÆÆ> ?
Person
ØØ 
personC
ØØ 
=
ØØ  
new
ØØ! $
Person
ØØ% +
(
ØØ+ ,
)
ØØ, -
;
ØØ- .
using
∞∞ 
(
∞∞ 
dbModels
∞∞ 
context
∞∞  '
=
∞∞( )
new
∞∞* -
dbModels
∞∞. 6
(
∞∞6 7
)
∞∞7 8
)
∞∞8 9
personC
∞∞: A
=
∞∞B C
context
∞∞D K
.
∞∞K L
Person
∞∞L R
.
∞∞R S
Where
∞∞S X
(
∞∞X Y
x
∞∞Y Z
=>
∞∞[ ]
x
∞∞^ _
.
∞∞_ `
nit
∞∞` c
==
∞∞d f
nit
∞∞g j
)
∞∞j k
.
∞∞k l
FirstOrDefault
∞∞l z
(
∞∞z {
)
∞∞{ |
;
∞∞| }
DateTime
±± 
hoy
±± 
=
±± 
DateTime
±± '
.
±±' (
Now
±±( +
;
±±+ ,
Person
≤≤ 
person
≤≤ 
=
≤≤ 
new
≤≤  #
Person
≤≤$ *
(
≤≤* +
)
≤≤+ ,
;
≤≤, -
person
≥≥ 
.
≥≥ 
phone
≥≥ 
=
≥≥ 
ownerAuxiliar
≥≥ ,
.
≥≥, -
phone
≥≥- 2
;
≥≥2 3
person
¥¥ 
.
¥¥ 
nit
¥¥ 
=
¥¥ 
nit
¥¥  
;
¥¥  !
person
µµ 
.
µµ 
name
µµ 
=
µµ 
ownerAuxiliar
µµ +
.
µµ+ ,
name
µµ, 0
;
µµ0 1
person
∂∂ 
.
∂∂ 
lastname
∂∂ 
=
∂∂  !
ownerAuxiliar
∂∂" /
.
∂∂/ 0
lastname
∂∂0 8
;
∂∂8 9
person
∑∑ 
.
∑∑ 
dateRegister
∑∑ #
=
∑∑$ %
hoy
∑∑& )
;
∑∑) *
person
∏∏ 
.
∏∏ 
idRole
∏∏ 
=
∏∏ 
$num
∏∏  !
;
∏∏! "
person
ππ 
.
ππ 
status
ππ 
=
ππ 
$num
ππ  !
;
ππ! "
using
∫∫ 
(
∫∫ 
dbModels
∫∫ 
context
∫∫  '
=
∫∫( )
new
∫∫* -
dbModels
∫∫. 6
(
∫∫6 7
)
∫∫7 8
)
∫∫8 9
{
ªª 
if
ºº 
(
ºº 
personC
ºº 
==
ºº  "
null
ºº# '
)
ºº' (
context
ºº) 0
.
ºº0 1
Person
ºº1 7
.
ºº7 8
Add
ºº8 ;
(
ºº; <
person
ºº< B
)
ººB C
;
ººC D
else
ΩΩ 
if
ΩΩ 
(
ΩΩ 
personC
ΩΩ $
.
ΩΩ$ %
status
ΩΩ% +
==
ΩΩ, .
$num
ΩΩ/ 0
)
ΩΩ0 1
context
ΩΩ2 9
.
ΩΩ9 :
Entry
ΩΩ: ?
(
ΩΩ? @
person
ΩΩ@ F
)
ΩΩF G
.
ΩΩG H
State
ΩΩH M
=
ΩΩN O
System
ΩΩP V
.
ΩΩV W
Data
ΩΩW [
.
ΩΩ[ \
Entity
ΩΩ\ b
.
ΩΩb c
EntityState
ΩΩc n
.
ΩΩn o
Modified
ΩΩo w
;
ΩΩw x
context
ææ 
.
ææ 
SaveChanges
ææ '
(
ææ' (
)
ææ( )
;
ææ) *
}
øø 
Session
¿¿ 
[
¿¿ 
$str
¿¿ %
]
¿¿% &
=
¿¿' (
nit
¿¿) ,
;
¿¿, -
return
¡¡ 
RedirectToAction
¡¡ '
(
¡¡' (
$str
¡¡( 0
)
¡¡0 1
;
¡¡1 2
}
¬¬ 
catch
√√ 
(
√√ 
	Exception
√√ 
)
√√ 
{
ƒƒ 
return
≈≈ 
RedirectToAction
≈≈ '
(
≈≈' (
$str
≈≈( /
,
≈≈/ 0
$str
≈≈1 7
)
≈≈7 8
;
≈≈8 9
}
∆∆ 
}
«« 	
public
»» 
ActionResult
»»  
AutenticarPasosRol
»» .
(
»». /
int
»»/ 2
role
»»3 7
)
»»7 8
{
…… 	
if
   
(
   
!
   
User
   
.
   
Identity
   
.
   
IsAuthenticated
   .
)
  . /
return
  0 6
RedirectToAction
  7 G
(
  G H
$str
  H O
,
  O P
$str
  Q W
)
  W X
;
  X Y
Login
ÀÀ 
logi
ÀÀ 
=
ÀÀ 
new
ÀÀ 
Login
ÀÀ "
(
ÀÀ" #
)
ÀÀ# $
;
ÀÀ$ %
int
ÃÃ 
?
ÃÃ 
roleSession
ÃÃ 
=
ÃÃ 
logi
ÃÃ #
.
ÃÃ# $&
GetRoleSessionFromCookie
ÃÃ$ <
(
ÃÃ< =
Request
ÃÃ= D
)
ÃÃD E
;
ÃÃE F
if
ÕÕ 
(
ÕÕ 
roleSession
ÕÕ 
==
ÕÕ 
null
ÕÕ #
||
ÕÕ$ &
roleSession
ÕÕ' 2
!=
ÕÕ3 5
role
ÕÕ6 :
)
ÕÕ: ;
return
ÕÕ< B
RedirectToAction
ÕÕC S
(
ÕÕS T
$str
ÕÕT [
,
ÕÕ[ \
$str
ÕÕ] c
)
ÕÕc d
;
ÕÕd e
return
ŒŒ 
null
ŒŒ 
;
ŒŒ 
}
œœ 	
}
–– 
}—— ƒ†
MC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Controllers\LoginController.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Controllers" -
{ 
public 

class 
LoginController  
:! "

Controller# -
{ 
public 
ActionResult 
Index !
(! "
)" #
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
HttpPost	 
] 
public 
ActionResult 
Index !
(! "
Login" '
login( -
)- .
{ 	
try 
{ 
User 
users 
= 
new  
User! %
(% &
)& '
;' (
Employee 
employee !
=" #
new$ '
Employee( 0
(0 1
)1 2
;2 3

Encriptado 

encriptado %
=& '
new( +

Encriptado, 6
(6 7
)7 8
;8 9
Person 
person 
= 
new  #
Person$ *
(* +
)+ ,
;, -
if   
(   
login   
.   
Password   "
!=  # %
null  & *
)  * +
{!! 
using"" 
("" 
dbModels"" #
context""$ +
="", -
new"". 1
dbModels""2 :
("": ;
)""; <
)""< =
{## 
users$$ 
=$$ 
context$$  '
.$$' (
User$$( ,
.$$, -
Where$$- 2
($$2 3
x$$3 4
=>$$5 7
x$$8 9
.$$9 :
username$$: B
==$$C E
login$$F K
.$$K L
Username$$L T
)$$T U
.$$U V
FirstOrDefault$$V d
($$d e
)$$e f
;$$f g
if%% 
(%% 
users%% !
!=%%" $
null%%% )
)%%) *
{&& 
if'' 
(''  

encriptado''  *
.''* +
VerifyPassword''+ 9
(''9 :
login'': ?
.''? @
Password''@ H
,''H I
users''J O
.''O P
password''P X
)''X Y
)''Y Z
{(( 
employee))  (
=))) *
context))+ 2
.))2 3
Employee))3 ;
.)); <
Where))< A
())A B
x))B C
=>))D F
x))G H
.))H I

idEmployee))I S
==))T V
users))W \
.))\ ]

idEmployee))] g
&&))h j
x))k l
.))l m
status))m s
!=))t v
$num))w x
)))x y
.))y z
FirstOrDefault	))z à
(
))à â
)
))â ä
;
))ä ã
if**  "
(**# $
employee**$ ,
!=**- /
null**0 4
)**4 5
{++  !
person,,$ *
=,,+ ,
context,,- 4
.,,4 5
Person,,5 ;
.,,; <
Where,,< A
(,,A B
x,,B C
=>,,D F
x,,G H
.,,H I
nit,,I L
==,,M O
employee,,P X
.,,X Y

idEmployee,,Y c
),,c d
.,,d e
FirstOrDefault,,e s
(,,s t
),,t u
;,,u v
if--$ &
(--' (
person--( .
!=--/ 1
null--2 6
)--6 7
{..$ %
if//( *
(//+ ,
users//, 1
.//1 2

firstEntry//2 <
==//= ?
$num//@ A
)//A B
{00( )
return11, 2
RedirectToAction113 C
(11C D
$str11D P
,11P Q
$str11R Y
,11Y Z
new11[ ^
{11_ `
id11a c
=11d e
users11f k
.11k l

idEmployee11l v
}11w x
)11x y
;11y z
}22( )
if33( *
(33+ ,
employee33, 4
.334 5
idLine335 ;
!=33< >
null33? C
)33C D
{44( )
var55, /

cookieData550 :
=55; <
new55= @
{66, -

EmployeeId770 :
=77; <
employee77= E
.77E F

idEmployee77F P
,77P Q
RoleId880 6
=887 8
person889 ?
.88? @
idRole88@ F
,88F G
Linea990 5
=996 7
employee998 @
.99@ A
idLine99A G
}::, -
;::- .
string<<, 2
userData<<3 ;
=<<< =

Newtonsoft<<> H
.<<H I
Json<<I M
.<<M N
JsonConvert<<N Y
.<<Y Z
SerializeObject<<Z i
(<<i j

cookieData<<j t
)<<t u
;<<u v%
FormsAuthenticationTicket>>, E
ticket>>F L
=>>M N
new>>O R%
FormsAuthenticationTicket>>S l
(>>l m
$num??0 1
,??1 2
users@@0 5
.@@5 6
username@@6 >
,@@> ?
DateTimeAA0 8
.AA8 9
NowAA9 <
,AA< =
DateTimeBB0 8
.BB8 9
NowBB9 <
.BB< =

AddMinutesBB= G
(BBG H
$numBBH L
)BBL M
,BBM N
trueCC0 4
,CC4 5
userDataDD0 8
,DD8 9
$strEE0 3
)FF, -
;FF- .
stringHH, 2
encryptedTicketHH3 B
=HHC D
FormsAuthenticationHHE X
.HHX Y
EncryptHHY `
(HH` a
ticketHHa g
)HHg h
;HHh i

HttpCookieJJ, 6

authCookieJJ7 A
=JJB C
newJJD G

HttpCookieJJH R
(JJR S
FormsAuthenticationJJS f
.JJf g
FormsCookieNameJJg v
,JJv w
encryptedTicket	JJx á
)
JJá à
{KK, -
HttpOnlyLL0 8
=LL9 :
trueLL; ?
,LL? @
ExpiresMM0 7
=MM8 9
ticketMM: @
.MM@ A

ExpirationMMA K
,MMK L
}NN, -
;NN- .
ResponsePP, 4
.PP4 5
CookiesPP5 <
.PP< =
AddPP= @
(PP@ A

authCookiePPA K
)PPK L
;PPL M
returnRR, 2
RedirectToActionRR3 C
(RRC D
$strRRD K
,RRK L
$strRRM S
)RRS T
;RRT U
}SS( )
elseTT( ,
{UU( )
varVV, /
linesVV0 5
=VV6 7
contextVV8 ?
.VV? @
LineVV@ D
.VVD E
WhereVVE J
(VVJ K
xVVK L
=>VVM O
xVVP Q
.VVQ R
idAdminVVR Y
==VVZ \
employeeVV] e
.VVe f

idEmployeeVVf p
)VVp q
.VVq r
ToListVVr x
(VVx y
)VVy z
;VVz {
ifWW, .
(WW/ 0
linesWW0 5
==WW6 8
nullWW9 =
)WW= >
{XX, -
TempDataYY0 8
[YY8 9
$strYY9 @
]YY@ A
=YYB C
$strYYD a
;YYa b
returnZZ0 6
ViewZZ7 ;
(ZZ; <
)ZZ< =
;ZZ= >
}[[, -
else\\, 0
{]], -
var^^0 3

cookieData^^4 >
=^^? @
new^^A D
{__0 1

EmployeeId``4 >
=``? @
employee``A I
.``I J

idEmployee``J T
,``T U
RoleIdaa4 :
=aa; <
personaa= C
.aaC D
idRoleaaD J
,aaJ K
Lineabb4 9
=bb: ;
$strbb< >
}cc0 1
;cc1 2
stringee0 6
userDataee7 ?
=ee@ A

NewtonsofteeB L
.eeL M
JsoneeM Q
.eeQ R
JsonConverteeR ]
.ee] ^
SerializeObjectee^ m
(eem n

cookieDataeen x
)eex y
;eey z%
FormsAuthenticationTicketgg0 I
ticketggJ P
=ggQ R
newggS V%
FormsAuthenticationTicketggW p
(ggp q
$numhh4 5
,hh5 6
usersii4 9
.ii9 :
usernameii: B
,iiB C
DateTimejj4 <
.jj< =
Nowjj= @
,jj@ A
DateTimekk4 <
.kk< =
Nowkk= @
.kk@ A

AddMinuteskkA K
(kkK L
$numkkL P
)kkP Q
,kkQ R
truell4 8
,ll8 9
userDatamm4 <
,mm< =
$strnn4 7
)oo0 1
;oo1 2
stringqq0 6
encryptedTicketqq7 F
=qqG H
FormsAuthenticationqqI \
.qq\ ]
Encryptqq] d
(qqd e
ticketqqe k
)qqk l
;qql m

HttpCookiess0 :

authCookiess; E
=ssF G
newssH K

HttpCookiessL V
(ssV W
FormsAuthenticationssW j
.ssj k
FormsCookieNamessk z
,ssz {
encryptedTicket	ss| ã
)
ssã å
{tt0 1
HttpOnlyuu4 <
=uu= >
trueuu? C
,uuC D
Expiresvv4 ;
=vv< =
ticketvv> D
.vvD E

ExpirationvvE O
,vvO P
}ww0 1
;ww1 2
Responseyy0 8
.yy8 9
Cookiesyy9 @
.yy@ A
AddyyA D
(yyD E

authCookieyyE O
)yyO P
;yyP Q
return{{0 6
RedirectToAction{{7 G
({{G H
$str{{H O
,{{O P
$str{{Q W
){{W X
;{{X Y
}||, -
}}}( )
}~~$ %
}  !
}
ÄÄ 
}
ÅÅ 
}
ÇÇ 
}
ÉÉ 
TempData
ÖÖ 
[
ÖÖ 
$str
ÖÖ  
]
ÖÖ  !
=
ÖÖ" #
$str
ÖÖ$ O
;
ÖÖO P
return
ÜÜ 
View
ÜÜ 
(
ÜÜ 
)
ÜÜ 
;
ÜÜ 
}
áá 
catch
àà 
{
ââ 
return
ää 
RedirectToAction
ää '
(
ää' (
$str
ää( /
,
ää/ 0
$str
ää1 7
)
ää7 8
;
ää8 9
}
ãã 
}
åå 	
public
éé 
ActionResult
éé 

Validacion
éé &
(
éé& '
string
éé' -
id
éé. 0
)
éé0 1
{
èè 	
try
êê 
{
ëë 
if
íí 
(
íí 
id
íí 
==
íí 
null
íí 
)
íí 
return
íí  &
RedirectToAction
íí' 7
(
íí7 8
$str
íí8 ?
,
íí? @
$str
ííA G
)
ííG H
;
ííH I
using
ìì 
(
ìì 
dbModels
ìì 
context
ìì  '
=
ìì( )
new
ìì* -
dbModels
ìì. 6
(
ìì6 7
)
ìì7 8
)
ìì8 9
{
îî 
User
ïï 
user
ïï 
=
ïï 
context
ïï  '
.
ïï' (
User
ïï( ,
.
ïï, -
Where
ïï- 2
(
ïï2 3
x
ïï3 4
=>
ïï5 7
x
ïï8 9
.
ïï9 :

idEmployee
ïï: D
==
ïïE G
id
ïïH J
)
ïïJ K
.
ïïK L
FirstOrDefault
ïïL Z
(
ïïZ [
)
ïï[ \
;
ïï\ ]
Session
ññ 
[
ññ 
$str
ññ +
]
ññ+ ,
=
ññ- .
user
ññ/ 3
;
ññ3 4
return
óó 
View
óó 
(
óó  
)
óó  !
;
óó! "
}
òò 
}
ôô 
catch
öö 
{
õõ 
return
úú 
RedirectToAction
úú '
(
úú' (
$str
úú( /
,
úú/ 0
$str
úú1 7
)
úú7 8
;
úú8 9
}
ùù 
}
ûû 	
[
†† 	
HttpPost
††	 
]
†† 
public
°° 
ActionResult
°° 

Validacion
°° &
(
°°& '
EditPass
°°' /
editPass
°°0 8
)
°°8 9
{
¢¢ 	
try
££ 
{
§§ 
Person
•• 
valid
•• 
=
•• 
new
•• "
Person
••# )
(
••) *
)
••* +
;
••+ ,

Encriptado
¶¶ 

encriptado
¶¶ %
=
¶¶& '
new
¶¶( +

Encriptado
¶¶, 6
(
¶¶6 7
)
¶¶7 8
;
¶¶8 9
if
ßß 
(
ßß 
editPass
ßß 
.
ßß 
Password
ßß $
==
ßß% '
editPass
ßß( 0
.
ßß0 1
Password
ßß1 9
)
ßß9 :
using
®® 
(
®® 
dbModels
®® 
context
®®  '
=
®®( )
new
®®* -
dbModels
®®. 6
(
®®6 7
)
®®7 8
)
®®8 9
{
©© 
User
™™ 
user
™™ 
=
™™ 
(
™™  !
User
™™! %
)
™™% &
Session
™™& -
[
™™- .
$str
™™. =
]
™™= >
;
™™> ?
if
´´ 
(
´´ 
editPass
´´ $
.
´´$ %
IsValidString
´´% 2
(
´´2 3
editPass
´´3 ;
.
´´; <
Password
´´< D
)
´´D E
)
´´E F
{
¨¨ 
user
≠≠  
.
≠≠  !
password
≠≠! )
=
≠≠* +

encriptado
≠≠, 6
.
≠≠6 7
	Encriptar
≠≠7 @
(
≠≠@ A
editPass
≠≠A I
.
≠≠I J
Password
≠≠J R
)
≠≠R S
;
≠≠S T
user
ÆÆ  
.
ÆÆ  !

firstEntry
ÆÆ! +
=
ÆÆ, -
$num
ÆÆ. /
;
ÆÆ/ 0
context
ØØ #
.
ØØ# $
Entry
ØØ$ )
(
ØØ) *
user
ØØ* .
)
ØØ. /
.
ØØ/ 0
State
ØØ0 5
=
ØØ6 7
System
ØØ8 >
.
ØØ> ?
Data
ØØ? C
.
ØØC D
Entity
ØØD J
.
ØØJ K
EntityState
ØØK V
.
ØØV W
Modified
ØØW _
;
ØØ_ `
context
∞∞ #
.
∞∞# $
SaveChanges
∞∞$ /
(
∞∞/ 0
)
∞∞0 1
;
∞∞1 2
return
±± "
RedirectToAction
±±# 3
(
±±3 4
$str
±±4 ;
)
±±; <
;
±±< =
}
≤≤ 
}
≥≥ 
ViewBag
¥¥ 
.
¥¥ 
Mess
¥¥ 
=
¥¥ 
$str
¥¥ e
;
¥¥e f
return
µµ 
View
µµ 
(
µµ 
)
µµ 
;
µµ 
}
∂∂ 
catch
∑∑ 
{
∏∏ 
return
ππ 
RedirectToAction
ππ '
(
ππ' (
$str
ππ( /
,
ππ/ 0
$str
ππ1 7
)
ππ7 8
;
ππ8 9
}
∫∫ 
}
ªª 	
public
ºº 
ActionResult
ºº 
ForgotPassword
ºº *
(
ºº* +
)
ºº+ ,
{
ΩΩ 	
try
ææ 
{
øø 
return
¿¿ 
View
¿¿ 
(
¿¿ 
)
¿¿ 
;
¿¿ 
}
¡¡ 
catch
¬¬ 
{
√√ 
return
ƒƒ 
RedirectToAction
ƒƒ '
(
ƒƒ' (
$str
ƒƒ( /
,
ƒƒ/ 0
$str
ƒƒ1 7
)
ƒƒ7 8
;
ƒƒ8 9
}
≈≈ 
}
∆∆ 	
[
»» 	
HttpPost
»»	 
]
»» 
public
…… 
ActionResult
…… 
ForgotPassword
…… *
(
……* +
EmployeeControl
……+ :
employeeControl
……; J
)
……J K
{
   	
try
ÀÀ 
{
ÃÃ 
using
ÕÕ 
(
ÕÕ 
dbModels
ÕÕ 
context
ÕÕ  '
=
ÕÕ( )
new
ÕÕ* -
dbModels
ÕÕ. 6
(
ÕÕ6 7
)
ÕÕ7 8
)
ÕÕ8 9
{
ŒŒ 
User
œœ 
user
œœ 
=
œœ 
context
œœ  '
.
œœ' (
User
œœ( ,
.
œœ, -
Where
œœ- 2
(
œœ2 3
x
œœ3 4
=>
œœ5 7
x
œœ8 9
.
œœ9 :
email
œœ: ?
.
œœ? @
ToLower
œœ@ G
(
œœG H
)
œœH I
.
œœI J
Trim
œœJ N
(
œœN O
)
œœO P
==
œœQ S
employeeControl
œœT c
.
œœc d
email
œœd i
.
œœi j
ToLower
œœj q
(
œœq r
)
œœr s
.
œœs t
Trim
œœt x
(
œœx y
)
œœy z
)
œœz {
.
œœ{ |
FirstOrDefaultœœ| ä
(œœä ã
)œœã å
;œœå ç
if
–– 
(
–– 
user
–– 
!=
–– 
null
––  $
)
––$ %
{
—— 

Encriptado
““ "

encriptado
““# -
=
““. /
new
““0 3

Encriptado
““4 >
(
““> ?
)
““? @
;
““@ A
string
”” 
pass
”” #
=
””$ %
employeeControl
””& 5
.
””5 6
GenerarPassword
””6 E
(
””E F
)
””F G
;
””G H
user
‘‘ 
.
‘‘ 
password
‘‘ %
=
‘‘& '

encriptado
‘‘( 2
.
‘‘2 3
	Encriptar
‘‘3 <
(
‘‘< =
pass
‘‘= A
)
‘‘A B
;
‘‘B C
user
’’ 
.
’’ 

firstEntry
’’ '
=
’’( )
$num
’’* +
;
’’+ ,
employeeControl
÷÷ '
.
÷÷' (
EnviarCorreo
÷÷( 4
(
÷÷4 5
employeeControl
÷÷5 D
.
÷÷D E
email
÷÷E J
.
÷÷J K
ToLower
÷÷K R
(
÷÷R S
)
÷÷S T
.
÷÷T U
Trim
÷÷U Y
(
÷÷Y Z
)
÷÷Z [
,
÷÷[ \
user
÷÷] a
.
÷÷a b
username
÷÷b j
,
÷÷j k
pass
÷÷l p
)
÷÷p q
;
÷÷q r
context
◊◊ 
.
◊◊  
Entry
◊◊  %
(
◊◊% &
user
◊◊& *
)
◊◊* +
.
◊◊+ ,
State
◊◊, 1
=
◊◊2 3
System
◊◊4 :
.
◊◊: ;
Data
◊◊; ?
.
◊◊? @
Entity
◊◊@ F
.
◊◊F G
EntityState
◊◊G R
.
◊◊R S
Modified
◊◊S [
;
◊◊[ \
context
ÿÿ 
.
ÿÿ  
SaveChanges
ÿÿ  +
(
ÿÿ+ ,
)
ÿÿ, -
;
ÿÿ- .
ViewBag
ŸŸ 
.
ŸŸ  
Mess2
ŸŸ  %
=
ŸŸ& '
$str
ŸŸ( P
;
ŸŸP Q
return
⁄⁄ 
View
⁄⁄ #
(
⁄⁄# $
)
⁄⁄$ %
;
⁄⁄% &
}
€€ 
}
‹‹ 
if
›› 
(
›› 
employeeControl
›› "
.
››" #
email
››# (
!=
››( *
null
››* .
)
››. /
ViewBag
ﬁﬁ 
.
ﬁﬁ 
Mess
ﬁﬁ 
=
ﬁﬁ 
$str
ﬁﬁ 2
;
ﬁﬁ2 3
return
ﬂﬂ 
View
ﬂﬂ 
(
ﬂﬂ 
)
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 
catch
·· 
{
‚‚ 
Session
„„ 
[
„„ 
$str
„„ %
]
„„% &
=
„„' (
null
„„) -
;
„„- .
return
‰‰ 
RedirectToAction
‰‰ '
(
‰‰' (
$str
‰‰( /
,
‰‰/ 0
$str
‰‰1 7
)
‰‰7 8
;
‰‰8 9
}
ÂÂ 
}
ÊÊ 	
public
ÁÁ 
ActionResult
ÁÁ  
AutenticarPasosRol
ÁÁ .
(
ÁÁ. /
int
ÁÁ/ 2
role
ÁÁ3 7
)
ÁÁ7 8
{
ËË 	
if
ÈÈ 
(
ÈÈ 
!
ÈÈ 
User
ÈÈ 
.
ÈÈ 
Identity
ÈÈ 
.
ÈÈ 
IsAuthenticated
ÈÈ .
)
ÈÈ. /
return
ÈÈ0 6
RedirectToAction
ÈÈ7 G
(
ÈÈG H
$str
ÈÈH O
,
ÈÈO P
$str
ÈÈQ W
)
ÈÈW X
;
ÈÈX Y
Login
ÍÍ 
logi
ÍÍ 
=
ÍÍ 
new
ÍÍ 
Login
ÍÍ "
(
ÍÍ" #
)
ÍÍ# $
;
ÍÍ$ %
int
ÎÎ 
?
ÎÎ 
roleSession
ÎÎ 
=
ÎÎ 
logi
ÎÎ #
.
ÎÎ# $&
GetRoleSessionFromCookie
ÎÎ$ <
(
ÎÎ< =
Request
ÎÎ= D
)
ÎÎD E
;
ÎÎE F
if
ÏÏ 
(
ÏÏ 
roleSession
ÏÏ 
==
ÏÏ 
null
ÏÏ #
||
ÏÏ$ &
roleSession
ÏÏ' 2
!=
ÏÏ3 5
role
ÏÏ6 :
)
ÏÏ: ;
return
ÏÏ< B
RedirectToAction
ÏÏC S
(
ÏÏS T
$str
ÏÏT [
,
ÏÏ[ \
$str
ÏÏ] c
)
ÏÏc d
;
ÏÏd e
return
ÌÌ 
null
ÌÌ 
;
ÌÌ 
}
ÓÓ 	
}
ÔÔ 
} „¢
LC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Controllers\LineController.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Controllers" -
{ 
public 

class 
LineController 
:  !

Controller" ,
{ 
public 
ActionResult 
Index !
(! "
)" #
{ 	
try 
{ 
var 

authResult 
=  
AutenticarPasosRol! 3
(3 4
$num4 5
)5 6
;6 7
if 
( 

authResult 
!= !
null" &
)& '
return( .

authResult/ 9
;9 :
Session 
[ 
$str #
]# $
=% &
null' +
;+ ,
List 
< 
Line 
> 
lines  
=! "
new# &
List' +
<+ ,
Line, 0
>0 1
(1 2
)2 3
;3 4
using 
( 
dbModels 
context  '
=( )
new* -
dbModels. 6
(6 7
)7 8
)8 9
{ 
lines   
=   
context   #
.  # $
Line  $ (
.  ( )
ToList  ) /
(  / 0
)  0 1
;  1 2
foreach!! 
(!! 
var!!  
item!!! %
in!!& (
lines!!) .
)!!. /
{"" 
var## 
person## "
=### $
context##% ,
.##, -
Person##- 3
.##3 4
Where##4 9
(##9 :
x##: ;
=>##< >
x##? @
.##@ A
nit##A D
==##E G
item##H L
.##L M
idAdmin##M T
)##T U
.##U V
FirstOrDefault##V d
(##d e
)##e f
;##f g
if$$ 
($$ 
person$$ "
!=$$# %
null$$& *
)$$* +
item%%  
.%%  !
description%%! ,
=%%- .
person%%/ 5
.%%5 6
name%%6 :
+%%; <
$str%%= @
+%%A B
person%%C I
.%%I J
lastname%%J R
;%%R S
else&& 
item&& !
.&&! "
description&&" -
=&&. /
null&&0 4
;&&4 5
}'' 
Session(( 
[(( 
$str(( /
]((/ 0
=((1 2
null((3 7
;((7 8
return)) 
View)) 
())  
lines))  %
)))% &
;))& '
}** 
}++ 
catch,, 
(,, 
	Exception,, 
),, 
{-- 
return.. 
RedirectToAction.. '
(..' (
$str..( /
,../ 0
$str..1 7
)..7 8
;..8 9
}// 
}00 	
public33 
ActionResult33 
Create33 "
(33" #
)33# $
{44 	
var55 

authResult55 
=55 
AutenticarPasosRol55 /
(55/ 0
$num550 1
)551 2
;552 3
if66 
(66 

authResult66 
!=66 
null66 "
)66" #
return66$ *

authResult66+ 5
;665 6
return77 
View77 
(77 
)77 
;77 
}88 	
[;; 	
HttpPost;;	 
];; 
public<< 
ActionResult<< 
Create<< "
(<<" #
LineControl<<# .
lineControl<</ :
)<<: ;
{== 	
try>> 
{?? 
var@@ 

authResult@@ 
=@@  
AutenticarPasosRol@@! 3
(@@3 4
$num@@4 5
)@@5 6
;@@6 7
ifAA 
(AA 

authResultAA 
!=AA !
nullAA" &
)AA& '
returnAA( .

authResultAA/ 9
;AA9 :
LineBB 
lineBB 
=BB 
newBB 
LineBB  $
(BB$ %
)BB% &
;BB& '
stringCC 
nameCC 
=CC 
lineControlCC )
.CC) *
	extentionCC* 3
+CC4 5
$strCC6 9
+CC: ;
lineControlCC< G
.CCG H
nameLineCCH P
.CCP Q
TrimCCQ U
(CCU V
)CCV W
;CCW X
usingDD 
(DD 
dbModelsDD 
contextDD  '
=DD( )
newDD* -
dbModelsDD. 6
(DD6 7
)DD7 8
)DD8 9
lineDD: >
=DD? @
contextDDA H
.DDH I
LineDDI M
.DDM N
WhereDDN S
(DDS T
xDDT U
=>DDV X
xDDY Z
.DDZ [
nameLineDD[ c
.DDc d
ToUpperDDd k
(DDk l
)DDl m
.DDm n
TrimDDn r
(DDr s
)DDs t
==DDu w
nameDDx |
.DD| }
ToUpper	DD} Ñ
(
DDÑ Ö
)
DDÖ Ü
.
DDÜ á
Trim
DDá ã
(
DDã å
)
DDå ç
)
DDç é
.
DDé è
FirstOrDefault
DDè ù
(
DDù û
)
DDû ü
;
DDü †
ifEE 
(EE 
lineEE 
!=EE 
nullEE  
)EE  !
{FF 
TempDataGG 
[GG 
$strGG %
]GG% &
=GG' (
$strGG) F
;GGF G
returnHH 
ViewHH 
(HH  
)HH  !
;HH! "
}II 
lineJJ 
=JJ 
newJJ 
LineJJ 
(JJ  
)JJ  !
;JJ! "
lineKK 
.KK 
nameLineKK 
=KK 
nameKK  $
;KK$ %
lineLL 
.LL 
priceLL 
=LL 
$numLL 
;LL 
usingMM 
(MM 
dbModelsMM 
contextMM  '
=MM( )
newMM* -
dbModelsMM. 6
(MM6 7
)MM7 8
)MM8 9
{NN 
lineOO 
.OO 
descriptionOO $
=OO% &
$strOO' 6
;OO6 7
contextPP 
.PP 
LinePP  
.PP  !
AddPP! $
(PP$ %
linePP% )
)PP) *
;PP* +
contextQQ 
.QQ 
SaveChangesQQ '
(QQ' (
)QQ( )
;QQ) *
}RR 
returnSS 
RedirectToActionSS '
(SS' (
$strSS( /
)SS/ 0
;SS0 1
}TT 
catchUU 
(UU 
	ExceptionUU 
)UU 
{VV 
returnWW 
RedirectToActionWW '
(WW' (
$strWW( /
,WW/ 0
$strWW1 7
)WW7 8
;WW8 9
}XX 
}ZZ 	
public[[ 
ActionResult[[ 
Edit[[  
([[  !
)[[! "
{\\ 	
try]] 
{^^ 
Login__ 
logi__ 
=__ 
new__  
Login__! &
(__& '
)__' (
;__( )
var`` 

authResult`` 
=``  
AutenticarPasosRol``! 3
(``3 4
$num``4 5
)``5 6
;``6 7
ifaa 
(aa 

authResultaa 
!=aa !
nullaa" &
)aa& '
returnaa( .

authResultaa/ 9
;aa9 :
Linecc 
linecc 
;cc 
Userdd 
userdd 
;dd 
stringee 
Lineaee 
=ee 
logiee #
.ee# $
GetLineaFromCookieee$ 6
(ee6 7
Requestee7 >
)ee> ?
.ee? @
ToStringee@ H
(eeH I
)eeI J
;eeJ K
usinggg 
(gg 
dbModelsgg 
contextgg  '
=gg( )
newgg* -
dbModelsgg. 6
(gg6 7
)gg7 8
)gg8 9
{hh 
lineii 
=ii 
contextii "
.ii" #
Lineii# '
.ii' (
Whereii( -
(ii- .
xii. /
=>ii0 2
xii3 4
.ii4 5
nameLineii5 =
==ii> @
LineaiiA F
)iiF G
.iiG H
FirstOrDefaultiiH V
(iiV W
)iiW X
;iiX Y
}jj 
ifll 
(ll 
linell 
==ll 
nullll  
)ll  !
{mm 
returnnn 
RedirectToActionnn +
(nn+ ,
$strnn, 3
,nn3 4
$strnn5 ;
)nn; <
;nn< =
}oo 
LineControlqq 
lineControlqq '
=qq( )
newqq* -
LineControlqq. 9
{rr 
descriptionss 
=ss  !
liness" &
.ss& '
descriptionss' 2
,ss2 3
pricett 
=tt 
linett  
.tt  !
pricett! &
}uu 
;uu 
Listvv 
<vv 
stringvv 
>vv 
horasvv "
=vv# $
newvv% (
Listvv) -
<vv- .
stringvv. 4
>vv4 5
(vv5 6
)vv6 7
;vv7 8
Listww 
<ww 
stringww 
>ww 
minutosww $
=ww% &
newww' *
Listww+ /
<ww/ 0
stringww0 6
>ww6 7
{ww8 9
$strww: >
,ww> ?
$strww@ D
,wwD E
$strwwF J
,wwJ K
$strwwL P
}wwQ R
;wwR S
forxx 
(xx 
intxx 
hourxx 
=xx 
$numxx  !
;xx! "
hourxx# '
<xx( )
$numxx* ,
;xx, -
hourxx. 2
++xx2 4
)xx4 5
{yy 
horaszz 
.zz 
Addzz 
(zz 
hourzz "
.zz" #
ToStringzz# +
(zz+ ,
$strzz, 0
)zz0 1
)zz1 2
;zz2 3
}{{ 
string}} 
[}} 
]}} 
descriptionParts}} )
=}}* +
lineControl}}, 7
.}}7 8
description}}8 C
.}}C D
Trim}}D H
(}}H I
)}}I J
.}}J K
Split}}K P
(}}P Q
$char}}Q T
)}}T U
;}}U V
string~~ 
[~~ 
]~~ 
hourMinuteStart~~ (
=~~) *
descriptionParts~~+ ;
[~~; <
$num~~< =
]~~= >
.~~> ?
Trim~~? C
(~~C D
)~~D E
.~~E F
Split~~F K
(~~K L
$char~~L O
)~~O P
;~~P Q
string 
[ 
] 
hourMinuteEnd &
=' (
descriptionParts) 9
[9 :
$num: ;
]; <
.< =
Trim= A
(A B
)B C
.C D
SplitD I
(I J
$charJ M
)M N
;N O
ViewBag
ÄÄ 
.
ÄÄ 
Hours
ÄÄ 
=
ÄÄ 
new
ÄÄ  #

SelectList
ÄÄ$ .
(
ÄÄ. /
horas
ÄÄ/ 4
,
ÄÄ4 5
hourMinuteStart
ÄÄ6 E
[
ÄÄE F
$num
ÄÄF G
]
ÄÄG H
)
ÄÄH I
;
ÄÄI J
ViewBag
ÅÅ 
.
ÅÅ 
Minutes
ÅÅ 
=
ÅÅ  !
new
ÅÅ" %

SelectList
ÅÅ& 0
(
ÅÅ0 1
minutos
ÅÅ1 8
,
ÅÅ8 9
hourMinuteStart
ÅÅ: I
[
ÅÅI J
$num
ÅÅJ K
]
ÅÅK L
)
ÅÅL M
;
ÅÅM N
ViewBag
ÇÇ 
.
ÇÇ 
Hours2
ÇÇ 
=
ÇÇ  
new
ÇÇ! $

SelectList
ÇÇ% /
(
ÇÇ/ 0
horas
ÇÇ0 5
,
ÇÇ5 6
hourMinuteEnd
ÇÇ7 D
[
ÇÇD E
$num
ÇÇE F
]
ÇÇF G
)
ÇÇG H
;
ÇÇH I
ViewBag
ÉÉ 
.
ÉÉ 
Minutes2
ÉÉ  
=
ÉÉ! "
new
ÉÉ# &

SelectList
ÉÉ' 1
(
ÉÉ1 2
minutos
ÉÉ2 9
,
ÉÉ9 :
hourMinuteEnd
ÉÉ; H
[
ÉÉH I
$num
ÉÉI J
]
ÉÉJ K
)
ÉÉK L
;
ÉÉL M
return
ÖÖ 
View
ÖÖ 
(
ÖÖ 
lineControl
ÖÖ '
)
ÖÖ' (
;
ÖÖ( )
}
ÜÜ 
catch
áá 
(
áá 
	Exception
áá 
)
áá 
{
àà 
return
ââ 
RedirectToAction
ââ '
(
ââ' (
$str
ââ( /
,
ââ/ 0
$str
ââ1 7
)
ââ7 8
;
ââ8 9
}
ää 
}
ãã 	
[
çç 	
HttpPost
çç	 
]
çç 
public
éé 
ActionResult
éé 
Edit
éé  
(
éé  !
LineControl
éé! ,
lineControl
éé- 8
,
éé8 9
string
éé: @
Hora1
ééA F
,
ééF G
string
ééH N
Minuto1
ééO V
,
ééV W
string
ééX ^
Hora2
éé_ d
,
ééd e
string
ééf l
Minuto2
éém t
)
éét u
{
èè 	
try
êê 
{
ëë 
Login
íí 
logi
íí 
=
íí 
new
íí  
Login
íí! &
(
íí& '
)
íí' (
;
íí( )
var
ìì 

authResult
ìì 
=
ìì   
AutenticarPasosRol
ìì! 3
(
ìì3 4
$num
ìì4 5
)
ìì5 6
;
ìì6 7
if
îî 
(
îî 

authResult
îî 
!=
îî !
null
îî" &
)
îî& '
return
îî( .

authResult
îî/ 9
;
îî9 :
string
ññ 
Linea
ññ 
=
ññ 
logi
ññ #
.
ññ# $ 
GetLineaFromCookie
ññ$ 6
(
ññ6 7
Request
ññ7 >
)
ññ> ?
.
ññ? @
ToString
ññ@ H
(
ññH I
)
ññI J
;
ññJ K
string
óó 
employee
óó 
=
óó  !
logi
óó" &
.
óó& '%
GetEmployeeIdFromCookie
óó' >
(
óó> ?
Request
óó? F
)
óóF G
.
óóG H
ToString
óóH P
(
óóP Q
)
óóQ R
;
óóR S
List
òò 
<
òò 
string
òò 
>
òò 
horas
òò "
=
òò# $
new
òò% (
List
òò) -
<
òò- .
string
òò. 4
>
òò4 5
(
òò5 6
)
òò6 7
;
òò7 8
List
ôô 
<
ôô 
string
ôô 
>
ôô 
minutos
ôô $
=
ôô% &
new
ôô' *
List
ôô+ /
<
ôô/ 0
string
ôô0 6
>
ôô6 7
{
ôô8 9
$str
ôô: >
,
ôô> ?
$str
ôô@ D
,
ôôD E
$str
ôôF J
,
ôôJ K
$str
ôôL P
}
ôôQ R
;
ôôR S
for
öö 
(
öö 
int
öö 
hour
öö 
=
öö 
$num
öö  !
;
öö! "
hour
öö# '
<
öö( )
$num
öö* ,
;
öö, -
hour
öö. 2
++
öö2 4
)
öö4 5
{
õõ 
horas
úú 
.
úú 
Add
úú 
(
úú 
hour
úú "
.
úú" #
ToString
úú# +
(
úú+ ,
$str
úú, 0
)
úú0 1
)
úú1 2
;
úú2 3
}
ùù 
ViewBag
ûû 
.
ûû 
Hours
ûû 
=
ûû 
new
ûû  #

SelectList
ûû$ .
(
ûû. /
horas
ûû/ 4
,
ûû4 5
Hora1
ûû6 ;
)
ûû; <
;
ûû< =
ViewBag
üü 
.
üü 
Minutes
üü 
=
üü  !
new
üü" %

SelectList
üü& 0
(
üü0 1
minutos
üü1 8
,
üü8 9
Minuto1
üü: A
)
üüA B
;
üüB C
ViewBag
†† 
.
†† 
Hours2
†† 
=
††  
new
††! $

SelectList
††% /
(
††/ 0
horas
††0 5
,
††5 6
Hora2
††7 <
)
††< =
;
††= >
ViewBag
°° 
.
°° 
Minutes2
°°  
=
°°! "
new
°°# &

SelectList
°°' 1
(
°°1 2
minutos
°°2 9
,
°°9 :
Minuto2
°°; B
)
°°B C
;
°°C D
User
¢¢ 
user
¢¢ 
;
¢¢ 
Line
¢¢ 
linea
¢¢  %
;
¢¢% &
using
££ 
(
££ 
dbModels
££ 
context
££  '
=
££( )
new
££* -
dbModels
££. 6
(
££6 7
)
££7 8
)
££8 9
linea
££: ?
=
££@ A
context
££B I
.
££I J
Line
££J N
.
££N O
Where
££O T
(
££T U
x
££U V
=>
££W Y
x
££Z [
.
££[ \
nameLine
££\ d
==
££e g
Linea
££h m
)
££m n
.
££n o
FirstOrDefault
££o }
(
££} ~
)
££~ 
;££ Ä
using
•• 
(
•• 
dbModels
•• 
context
••  '
=
••( )
new
••* -
dbModels
••. 6
(
••6 7
)
••7 8
)
••8 9
{
¶¶ 
linea
ßß 
.
ßß 
price
ßß 
=
ßß  !
$num
ßß" #
;
ßß# $
linea
®® 
.
®® 
description
®® %
=
®®& '
$"
®®( *
{
®®* +
Hora1
®®+ 0
}
®®0 1
$str
®®1 2
{
®®2 3
Minuto1
®®3 :
}
®®: ;
$str
®®; >
{
®®> ?
Hora2
®®? D
}
®®D E
$str
®®E F
{
®®F G
Minuto2
®®G N
}
®®N O
"
®®O P
;
®®P Q
context
™™ 
.
™™ 
Entry
™™ !
(
™™! "
linea
™™" '
)
™™' (
.
™™( )
State
™™) .
=
™™/ 0
System
™™1 7
.
™™7 8
Data
™™8 <
.
™™< =
Entity
™™= C
.
™™C D
EntityState
™™D O
.
™™O P
Modified
™™P X
;
™™X Y
context
´´ 
.
´´ 
SaveChanges
´´ '
(
´´' (
)
´´( )
;
´´) *
}
¨¨ 
return
≠≠ 
RedirectToAction
≠≠ '
(
≠≠' (
$str
≠≠( 2
)
≠≠2 3
;
≠≠3 4
}
ÆÆ 
catch
ØØ 
(
ØØ 
	Exception
ØØ 
)
ØØ 
{
∞∞ 
return
±± 
RedirectToAction
±± '
(
±±' (
$str
±±( /
,
±±/ 0
$str
±±1 7
)
±±7 8
;
±±8 9
}
≤≤ 
}
µµ 	
public
ππ 
ActionResult
ππ 
Delete
ππ "
(
ππ" #
string
ππ# )
id
ππ* ,
)
ππ, -
{
∫∫ 	
try
ªª 
{
ºº 
Login
ΩΩ 
login
ΩΩ 
=
ΩΩ 
new
ΩΩ !
Login
ΩΩ" '
(
ΩΩ' (
)
ΩΩ( )
;
ΩΩ) *
var
ææ 

authResult
ææ 
=
ææ   
AutenticarPasosRol
ææ! 3
(
ææ3 4
$num
ææ4 5
)
ææ5 6
;
ææ6 7
if
øø 
(
øø 

authResult
øø 
!=
øø !
null
øø" &
)
øø& '
return
øø( .

authResult
øø/ 9
;
øø9 :
Line
¡¡ 
line
¡¡ 
=
¡¡ 
new
¡¡ 
Line
¡¡  $
(
¡¡$ %
)
¡¡% &
;
¡¡& '
List
¬¬ 
<
¬¬ 
Employee
¬¬ 
>
¬¬ 
	employees
¬¬ (
=
¬¬) *
new
¬¬+ .
List
¬¬/ 3
<
¬¬3 4
Employee
¬¬4 <
>
¬¬< =
(
¬¬= >
)
¬¬> ?
;
¬¬? @
List
√√ 
<
√√ 

Checkpoint
√√ 
>
√√  
checkpoints
√√! ,
=
√√- .
new
√√/ 2
List
√√3 7
<
√√7 8

Checkpoint
√√8 B
>
√√B C
(
√√C D
)
√√D E
;
√√E F
List
ƒƒ 
<
ƒƒ 
Route
ƒƒ 
>
ƒƒ 
routes
ƒƒ "
=
ƒƒ# $
new
ƒƒ% (
List
ƒƒ) -
<
ƒƒ- .
Route
ƒƒ. 3
>
ƒƒ3 4
(
ƒƒ4 5
)
ƒƒ5 6
;
ƒƒ6 7
List
≈≈ 
<
≈≈ 
DeviationRote
≈≈ "
>
≈≈" #
deviationRotes
≈≈$ 2
=
≈≈3 4
new
≈≈5 8
List
≈≈9 =
<
≈≈= >
DeviationRote
≈≈> K
>
≈≈K L
(
≈≈L M
)
≈≈M N
;
≈≈N O
List
∆∆ 
<
∆∆ 
SanctionEmployee
∆∆ %
>
∆∆% &
sanctionEmployees
∆∆' 8
=
∆∆9 :
new
∆∆; >
List
∆∆? C
<
∆∆C D
SanctionEmployee
∆∆D T
>
∆∆T U
(
∆∆U V
)
∆∆V W
;
∆∆W X
List
«« 
<
«« 
Sanction
«« 
>
«« 
	sanctions
«« (
=
««) *
new
««+ .
List
««/ 3
<
««3 4
Sanction
««4 <
>
««< =
(
««= >
)
««> ?
;
««? @
using
»» 
(
»» 
dbModels
»» 
context
»»  '
=
»»( )
new
»»* -
dbModels
»». 6
(
»»6 7
)
»»7 8
)
»»8 9
line
»»: >
=
»»? @
context
»»A H
.
»»H I
Line
»»I M
.
»»M N
Where
»»N S
(
»»S T
x
»»T U
=>
»»V X
x
»»Y Z
.
»»Z [
nameLine
»»[ c
==
»»d f
id
»»g i
)
»»i j
.
»»j k
FirstOrDefault
»»k y
(
»»y z
)
»»z {
;
»»{ |
using
…… 
(
…… 
dbModels
…… 
context
……  '
=
……( )
new
……* -
dbModels
……. 6
(
……6 7
)
……7 8
)
……8 9
	employees
……: C
=
……D E
context
……F M
.
……M N
Employee
……N V
.
……V W
Where
……W \
(
……\ ]
x
……] ^
=>
……_ a
x
……b c
.
……c d
idLine
……d j
==
……k m
id
……n p
)
……p q
.
……q r
ToList
……r x
(
……x y
)
……y z
;
……z {
using
   
(
   
dbModels
   
context
    '
=
  ( )
new
  * -
dbModels
  . 6
(
  6 7
)
  7 8
)
  8 9
deviationRotes
  : H
=
  I J
context
  K R
.
  R S
DeviationRote
  S `
.
  ` a
Where
  a f
(
  f g
x
  g h
=>
  i k
x
  l m
.
  m n
idLine
  n t
==
  u w
id
  x z
)
  z {
.
  { |
ToList  | Ç
(  Ç É
)  É Ñ
;  Ñ Ö
using
ÀÀ 
(
ÀÀ 
dbModels
ÀÀ 
context
ÀÀ  '
=
ÀÀ( )
new
ÀÀ* -
dbModels
ÀÀ. 6
(
ÀÀ6 7
)
ÀÀ7 8
)
ÀÀ8 9
	sanctions
ÀÀ: C
=
ÀÀD E
context
ÀÀF M
.
ÀÀM N
Sanction
ÀÀN V
.
ÀÀV W
Where
ÀÀW \
(
ÀÀ\ ]
x
ÀÀ] ^
=>
ÀÀ_ a
x
ÀÀb c
.
ÀÀc d
idLine
ÀÀd j
==
ÀÀk m
id
ÀÀn p
)
ÀÀp q
.
ÀÀq r
ToList
ÀÀr x
(
ÀÀx y
)
ÀÀy z
;
ÀÀz {
using
ÃÃ 
(
ÃÃ 
dbModels
ÃÃ 
context
ÃÃ  '
=
ÃÃ( )
new
ÃÃ* -
dbModels
ÃÃ. 6
(
ÃÃ6 7
)
ÃÃ7 8
)
ÃÃ8 9
{
ÕÕ 
foreach
ŒŒ 
(
ŒŒ 
var
ŒŒ  
item
ŒŒ! %
in
ŒŒ& (
	sanctions
ŒŒ) 2
)
ŒŒ2 3
{
œœ 
List
–– 
<
–– 
SanctionEmployee
–– -
>
––- .
sanctionEmployee
––/ ?
=
––@ A
context
––B I
.
––I J
SanctionEmployee
––J Z
.
––Z [
Where
––[ `
(
––` a
x
––a b
=>
––c e
x
––f g
.
––g h

idSanction
––h r
==
––s u
item
––v z
.
––z {

idSanction––{ Ö
)––Ö Ü
.––Ü á
ToList––á ç
(––ç é
)––é è
;––è ê
foreach
—— 
(
——  !
var
——! $
item2
——% *
in
——+ -
sanctionEmployee
——. >
)
——> ?
{
““ 
SanctionEmployee
”” ,
	sanctionE
””- 6
=
””7 8
context
””9 @
.
””@ A
SanctionEmployee
””A Q
.
””Q R
Where
””R W
(
””W X
x
””X Y
=>
””Z \
x
””] ^
.
””^ _ 
idSanctionEmployee
””_ q
==
””r t
item2
””u z
.
””z {!
idSanctionEmployee””{ ç
)””ç é
.””é è
FirstOrDefault””è ù
(””ù û
)””û ü
;””ü †
context
‘‘ #
.
‘‘# $
SanctionEmployee
‘‘$ 4
.
‘‘4 5
Remove
‘‘5 ;
(
‘‘; <
	sanctionE
‘‘< E
)
‘‘E F
;
‘‘F G
}
’’ 
Sanction
÷÷  
sanction
÷÷! )
=
÷÷* +
context
÷÷, 3
.
÷÷3 4
Sanction
÷÷4 <
.
÷÷< =
Where
÷÷= B
(
÷÷B C
x
÷÷C D
=>
÷÷E G
x
÷÷H I
.
÷÷I J

idSanction
÷÷J T
==
÷÷U W
item
÷÷X \
.
÷÷\ ]

idSanction
÷÷] g
)
÷÷g h
.
÷÷h i
FirstOrDefault
÷÷i w
(
÷÷w x
)
÷÷x y
;
÷÷y z
context
◊◊ 
.
◊◊  
Sanction
◊◊  (
.
◊◊( )
Remove
◊◊) /
(
◊◊/ 0
sanction
◊◊0 8
)
◊◊8 9
;
◊◊9 :
}
ÿÿ 
context
ŸŸ 
.
ŸŸ 
SaveChanges
ŸŸ '
(
ŸŸ' (
)
ŸŸ( )
;
ŸŸ) *
}
⁄⁄ 
using
€€ 
(
€€ 
dbModels
€€ 
context
€€  '
=
€€( )
new
€€* -
dbModels
€€. 6
(
€€6 7
)
€€7 8
)
€€8 9
{
‹‹ 
foreach
›› 
(
›› 
var
››  
item
››! %
in
››& (
deviationRotes
››) 7
)
››7 8
{
ﬁﬁ 
DeviationRote
ﬂﬂ %
	deviation
ﬂﬂ& /
=
ﬂﬂ0 1
context
ﬂﬂ2 9
.
ﬂﬂ9 :
DeviationRote
ﬂﬂ: G
.
ﬂﬂG H
Where
ﬂﬂH M
(
ﬂﬂM N
x
ﬂﬂN O
=>
ﬂﬂP R
x
ﬂﬂS T
.
ﬂﬂT U
idDeviation
ﬂﬂU `
==
ﬂﬂa c
item
ﬂﬂd h
.
ﬂﬂh i
idDeviation
ﬂﬂi t
)
ﬂﬂt u
.
ﬂﬂu v
FirstOrDefaultﬂﬂv Ñ
(ﬂﬂÑ Ö
)ﬂﬂÖ Ü
;ﬂﬂÜ á
context
‡‡ 
.
‡‡  
DeviationRote
‡‡  -
.
‡‡- .
Remove
‡‡. 4
(
‡‡4 5
	deviation
‡‡5 >
)
‡‡> ?
;
‡‡? @
}
·· 
context
‚‚ 
.
‚‚ 
SaveChanges
‚‚ '
(
‚‚' (
)
‚‚( )
;
‚‚) *
}
„„ 
using
‰‰ 
(
‰‰ 
dbModels
‰‰ 
context
‰‰  '
=
‰‰( )
new
‰‰* -
dbModels
‰‰. 6
(
‰‰6 7
)
‰‰7 8
)
‰‰8 9
{
ÂÂ 
foreach
ÊÊ 
(
ÊÊ 
var
ÊÊ  
item
ÊÊ! %
in
ÊÊ& (
	employees
ÊÊ) 2
)
ÊÊ2 3
{
ÁÁ 
List
ËË 
<
ËË 
Star
ËË !
>
ËË! "
stars
ËË# (
=
ËË) *
new
ËË+ .
List
ËË/ 3
<
ËË3 4
Star
ËË4 8
>
ËË8 9
(
ËË9 :
)
ËË: ;
;
ËË; <
stars
ÈÈ 
=
ÈÈ 
context
ÈÈ  '
.
ÈÈ' (
Star
ÈÈ( ,
.
ÈÈ, -
Where
ÈÈ- 2
(
ÈÈ2 3
x
ÈÈ3 4
=>
ÈÈ5 7
x
ÈÈ8 9
.
ÈÈ9 :

idEmployee
ÈÈ: D
==
ÈÈE G
item
ÈÈH L
.
ÈÈL M

idEmployee
ÈÈM W
)
ÈÈW X
.
ÈÈX Y
ToList
ÈÈY _
(
ÈÈ_ `
)
ÈÈ` a
;
ÈÈa b
foreach
ÍÍ 
(
ÍÍ  !
var
ÍÍ! $
item2
ÍÍ% *
in
ÍÍ+ -
stars
ÍÍ. 3
)
ÍÍ3 4
{
ÎÎ 
Star
ÏÏ  
	deviation
ÏÏ! *
=
ÏÏ+ ,
context
ÏÏ- 4
.
ÏÏ4 5
Star
ÏÏ5 9
.
ÏÏ9 :
Where
ÏÏ: ?
(
ÏÏ? @
x
ÏÏ@ A
=>
ÏÏB D
x
ÏÏE F
.
ÏÏF G
idStar
ÏÏG M
==
ÏÏN P
item2
ÏÏQ V
.
ÏÏV W
idStar
ÏÏW ]
)
ÏÏ] ^
.
ÏÏ^ _
FirstOrDefault
ÏÏ_ m
(
ÏÏm n
)
ÏÏn o
;
ÏÏo p
context
ÌÌ #
.
ÌÌ# $
Star
ÌÌ$ (
.
ÌÌ( )
Remove
ÌÌ) /
(
ÌÌ/ 0
	deviation
ÌÌ0 9
)
ÌÌ9 :
;
ÌÌ: ;
}
ÓÓ 
}
ÔÔ 
context
 
.
 
SaveChanges
 '
(
' (
)
( )
;
) *
}
ÒÒ 
using
ÚÚ 
(
ÚÚ 
dbModels
ÚÚ 
context
ÚÚ  '
=
ÚÚ( )
new
ÚÚ* -
dbModels
ÚÚ. 6
(
ÚÚ6 7
)
ÚÚ7 8
)
ÚÚ8 9
{
ÛÛ 
foreach
ÙÙ 
(
ÙÙ 
var
ÙÙ  
item
ÙÙ! %
in
ÙÙ& (
	employees
ÙÙ) 2
)
ÙÙ2 3
{
ıı 
List
ˆˆ 
<
ˆˆ  
MechanicalFailures
ˆˆ /
>
ˆˆ/ 0
stars
ˆˆ1 6
=
ˆˆ7 8
new
ˆˆ9 <
List
ˆˆ= A
<
ˆˆA B 
MechanicalFailures
ˆˆB T
>
ˆˆT U
(
ˆˆU V
)
ˆˆV W
;
ˆˆW X
stars
˜˜ 
=
˜˜ 
context
˜˜  '
.
˜˜' ( 
MechanicalFailures
˜˜( :
.
˜˜: ;
Where
˜˜; @
(
˜˜@ A
x
˜˜A B
=>
˜˜C E
x
˜˜F G
.
˜˜G H

idEmployee
˜˜H R
==
˜˜S U
item
˜˜V Z
.
˜˜Z [

idEmployee
˜˜[ e
)
˜˜e f
.
˜˜f g
ToList
˜˜g m
(
˜˜m n
)
˜˜n o
;
˜˜o p
foreach
¯¯ 
(
¯¯  !
var
¯¯! $
item2
¯¯% *
in
¯¯+ -
stars
¯¯. 3
)
¯¯3 4
{
˘˘  
MechanicalFailures
˙˙ .
	deviation
˙˙/ 8
=
˙˙9 :
context
˙˙; B
.
˙˙B C 
MechanicalFailures
˙˙C U
.
˙˙U V
Where
˙˙V [
(
˙˙[ \
x
˙˙\ ]
=>
˙˙^ `
x
˙˙a b
.
˙˙b c"
idMechanicalFailutes
˙˙c w
==
˙˙x z
item2˙˙{ Ä
.˙˙Ä Å$
idMechanicalFailutes˙˙Å ï
)˙˙ï ñ
.˙˙ñ ó
FirstOrDefault˙˙ó •
(˙˙• ¶
)˙˙¶ ß
;˙˙ß ®
context
˚˚ #
.
˚˚# $ 
MechanicalFailures
˚˚$ 6
.
˚˚6 7
Remove
˚˚7 =
(
˚˚= >
	deviation
˚˚> G
)
˚˚G H
;
˚˚H I
}
¸¸ 
}
˝˝ 
context
˛˛ 
.
˛˛ 
SaveChanges
˛˛ '
(
˛˛' (
)
˛˛( )
;
˛˛) *
}
ˇˇ 
using
ÄÄ 
(
ÄÄ 
dbModels
ÄÄ 
context
ÄÄ  '
=
ÄÄ( )
new
ÄÄ* -
dbModels
ÄÄ. 6
(
ÄÄ6 7
)
ÄÄ7 8
)
ÄÄ8 9
{
ÅÅ 
foreach
ÇÇ 
(
ÇÇ 
var
ÇÇ  
item
ÇÇ! %
in
ÇÇ& (
	employees
ÇÇ) 2
)
ÇÇ2 3
{
ÉÉ 
List
ÑÑ 
<
ÑÑ 
Report
ÑÑ #
>
ÑÑ# $
stars
ÑÑ% *
=
ÑÑ+ ,
new
ÑÑ- 0
List
ÑÑ1 5
<
ÑÑ5 6
Report
ÑÑ6 <
>
ÑÑ< =
(
ÑÑ= >
)
ÑÑ> ?
;
ÑÑ? @
stars
ÖÖ 
=
ÖÖ 
context
ÖÖ  '
.
ÖÖ' (
Report
ÖÖ( .
.
ÖÖ. /
Where
ÖÖ/ 4
(
ÖÖ4 5
x
ÖÖ5 6
=>
ÖÖ7 9
x
ÖÖ: ;
.
ÖÖ; <

idEmployee
ÖÖ< F
==
ÖÖG I
item
ÖÖJ N
.
ÖÖN O

idEmployee
ÖÖO Y
)
ÖÖY Z
.
ÖÖZ [
ToList
ÖÖ[ a
(
ÖÖa b
)
ÖÖb c
;
ÖÖc d
foreach
ÜÜ 
(
ÜÜ  !
var
ÜÜ! $
item2
ÜÜ% *
in
ÜÜ+ -
stars
ÜÜ. 3
)
ÜÜ3 4
{
áá 
context
àà #
.
àà# $
Report
àà$ *
.
àà* +
Remove
àà+ 1
(
àà1 2
item2
àà2 7
)
àà7 8
;
àà8 9
}
ââ 
}
ää 
context
ãã 
.
ãã 
SaveChanges
ãã '
(
ãã' (
)
ãã( )
;
ãã) *
}
åå 
using
çç 
(
çç 
dbModels
çç 
context
çç  '
=
çç( )
new
çç* -
dbModels
çç. 6
(
çç6 7
)
çç7 8
)
çç8 9
{
éé 
foreach
èè 
(
èè 
var
èè  
item
èè! %
in
èè& (
	employees
èè) 2
)
èè2 3
{
êê 
User
ëë 
user
ëë !
=
ëë" #
context
ëë$ +
.
ëë+ ,
User
ëë, 0
.
ëë0 1
Where
ëë1 6
(
ëë6 7
x
ëë7 8
=>
ëë9 ;
x
ëë< =
.
ëë= >

idEmployee
ëë> H
==
ëëI K
item
ëëL P
.
ëëP Q

idEmployee
ëëQ [
)
ëë[ \
.
ëë\ ]
FirstOrDefault
ëë] k
(
ëëk l
)
ëël m
;
ëëm n
if
íí 
(
íí 
user
íí  
!=
íí! #
null
íí$ (
)
íí( )
context
ìì #
.
ìì# $
User
ìì$ (
.
ìì( )
Remove
ìì) /
(
ìì/ 0
user
ìì0 4
)
ìì4 5
;
ìì5 6
}
îî 
context
ïï 
.
ïï 
SaveChanges
ïï '
(
ïï' (
)
ïï( )
;
ïï) *
}
ññ 
using
óó 
(
óó 
dbModels
óó 
context
óó  '
=
óó( )
new
óó* -
dbModels
óó. 6
(
óó6 7
)
óó7 8
)
óó8 9
checkpoints
óó: E
=
óóF G
context
óóH O
.
óóO P

Checkpoint
óóP Z
.
óóZ [
Where
óó[ `
(
óó` a
x
óóa b
=>
óóc e
x
óóf g
.
óóg h
idLine
óóh n
==
óóo q
id
óór t
)
óót u
.
óóu v
ToList
óóv |
(
óó| }
)
óó} ~
;
óó~ 
if
òò 
(
òò 
checkpoints
òò 
.
òò  
Count
òò  %
>
òò& '
$num
òò( )
)
òò) *
{
ôô 
using
öö 
(
öö 
dbModels
öö #
context
öö$ +
=
öö, -
new
öö. 1
dbModels
öö2 :
(
öö: ;
)
öö; <
)
öö< =
{
õõ 
foreach
úú 
(
úú  !
var
úú! $
item
úú% )
in
úú* ,
checkpoints
úú- 8
)
úú8 9
{
ùù 
List
ûû  
<
ûû  !
TimeControl
ûû! ,
>
ûû, -
time
ûû. 2
=
ûû3 4
context
ûû5 <
.
ûû< =
TimeControl
ûû= H
.
ûûH I
Where
ûûI N
(
ûûN O
x
ûûO P
=>
ûûQ S
x
ûûT U
.
ûûU V
idCheckpoint
ûûV b
==
ûûc e
item
ûûf j
.
ûûj k
idCheckpoint
ûûk w
)
ûûw x
.
ûûx y
ToList
ûûy 
(ûû Ä
)ûûÄ Å
;ûûÅ Ç
if
üü 
(
üü  
time
üü  $
!=
üü% '
null
üü( ,
)
üü, -
context
††  '
.
††' (
TimeControl
††( 3
.
††3 4
RemoveRange
††4 ?
(
††? @
time
††@ D
)
††D E
;
††E F
}
°° 
context
¢¢ 
.
¢¢  
SaveChanges
¢¢  +
(
¢¢+ ,
)
¢¢, -
;
¢¢- .
}
££ 
using
§§ 
(
§§ 
dbModels
§§ #
context
§§$ +
=
§§, -
new
§§. 1
dbModels
§§2 :
(
§§: ;
)
§§; <
)
§§< =
{
•• 
foreach
¶¶ 
(
¶¶  !
var
¶¶! $
item
¶¶% )
in
¶¶* ,
checkpoints
¶¶- 8
)
¶¶8 9
{
ßß 

Checkpoint
®® &

checkpoint
®®' 1
=
®®2 3
context
®®4 ;
.
®®; <

Checkpoint
®®< F
.
®®F G
Where
®®G L
(
®®L M
x
®®M N
=>
®®O Q
x
®®R S
.
®®S T
idCheckpoint
®®T `
==
®®a c
item
®®d h
.
®®h i
idCheckpoint
®®i u
)
®®u v
.
®®v w
FirstOrDefault®®w Ö
(®®Ö Ü
)®®Ü á
;®®á à
context
©© #
.
©©# $

Checkpoint
©©$ .
.
©©. /
Remove
©©/ 5
(
©©5 6

checkpoint
©©6 @
)
©©@ A
;
©©A B
}
™™ 
context
´´ 
.
´´  
SaveChanges
´´  +
(
´´+ ,
)
´´, -
;
´´- .
}
¨¨ 
}
≠≠ 
	employees
ÆÆ 
=
ÆÆ 
new
ÆÆ 
List
ÆÆ  $
<
ÆÆ$ %
Employee
ÆÆ% -
>
ÆÆ- .
(
ÆÆ. /
)
ÆÆ/ 0
;
ÆÆ0 1
using
ØØ 
(
ØØ 
dbModels
ØØ 
context
ØØ  '
=
ØØ( )
new
ØØ* -
dbModels
ØØ. 6
(
ØØ6 7
)
ØØ7 8
)
ØØ8 9
	employees
ØØ: C
=
ØØD E
context
ØØF M
.
ØØM N
Employee
ØØN V
.
ØØV W
Where
ØØW \
(
ØØ\ ]
x
ØØ] ^
=>
ØØ_ a
x
ØØb c
.
ØØc d
idLine
ØØd j
==
ØØk m
id
ØØn p
)
ØØp q
.
ØØq r
ToList
ØØr x
(
ØØx y
)
ØØy z
;
ØØz {
using
∞∞ 
(
∞∞ 
dbModels
∞∞ 
context
∞∞  '
=
∞∞( )
new
∞∞* -
dbModels
∞∞. 6
(
∞∞6 7
)
∞∞7 8
)
∞∞8 9
{
±± 
foreach
≤≤ 
(
≤≤ 
var
≤≤  
item
≤≤! %
in
≤≤& (
	employees
≤≤) 2
)
≤≤2 3
{
≥≥ 
Employee
¥¥  
employee
¥¥! )
=
¥¥* +
context
¥¥, 3
.
¥¥3 4
Employee
¥¥4 <
.
¥¥< =
Where
¥¥= B
(
¥¥B C
x
¥¥C D
=>
¥¥E G
x
¥¥H I
.
¥¥I J

idEmployee
¥¥J T
==
¥¥U W
item
¥¥X \
.
¥¥\ ]

idEmployee
¥¥] g
)
¥¥g h
.
¥¥h i
FirstOrDefault
¥¥i w
(
¥¥w x
)
¥¥x y
;
¥¥y z
context
µµ 
.
µµ  
Employee
µµ  (
.
µµ( )
Remove
µµ) /
(
µµ/ 0
employee
µµ0 8
)
µµ8 9
;
µµ9 :
}
∂∂ 
context
∑∑ 
.
∑∑ 
SaveChanges
∑∑ '
(
∑∑' (
)
∑∑( )
;
∑∑) *
}
∏∏ 
using
ππ 
(
ππ 
dbModels
ππ 
context
ππ  '
=
ππ( )
new
ππ* -
dbModels
ππ. 6
(
ππ6 7
)
ππ7 8
)
ππ8 9
{
ππ: ;
List
ππ< @
<
ππ@ A
Owner
ππA F
>
ππF G
owner
ππH M
=
ππN O
context
ππP W
.
ππW X
Owner
ππX ]
.
ππ] ^
Where
ππ^ c
(
ππc d
x
ππd e
=>
ππf h
x
ππi j
.
ππj k
idLine
ππk q
==
ππr t
line
ππu y
.
ππy z
nameLineππz Ç
)ππÇ É
.ππÉ Ñ
ToListππÑ ä
(ππä ã
)ππã å
;ππå ç
ifππé ê
(ππë í
ownerππí ó
.ππó ò
Countππò ù
>ππû ü
$numππ† °
)ππ° ¢
{ππ£ §
contextππ• ¨
.ππ¨ ≠
Ownerππ≠ ≤
.ππ≤ ≥
RemoveRangeππ≥ æ
(ππæ ø
ownerππø ƒ
)ππƒ ≈
;ππ≈ ∆
contextππ« Œ
.ππŒ œ
SaveChangesππœ ⁄
(ππ⁄ €
)ππ€ ‹
;ππ‹ ›
}ππﬁ ﬂ
}ππ‡ ·
using
∫∫ 
(
∫∫ 
dbModels
∫∫ 
context
∫∫  '
=
∫∫( )
new
∫∫* -
dbModels
∫∫. 6
(
∫∫6 7
)
∫∫7 8
)
∫∫8 9
{
ªª 
foreach
ºº 
(
ºº 
var
ºº  
item
ºº! %
in
ºº& (
	employees
ºº) 2
)
ºº2 3
{
ΩΩ 
Person
ææ 
person
ææ %
=
ææ& '
context
ææ( /
.
ææ/ 0
Person
ææ0 6
.
ææ6 7
Where
ææ7 <
(
ææ< =
x
ææ= >
=>
ææ? A
x
ææB C
.
ææC D
nit
ææD G
==
ææH J
item
ææK O
.
ææO P

idEmployee
ææP Z
)
ææZ [
.
ææ[ \
FirstOrDefault
ææ\ j
(
ææj k
)
ææk l
;
ææl m
context
øø 
.
øø  
Person
øø  &
.
øø& '
Remove
øø' -
(
øø- .
person
øø. 4
)
øø4 5
;
øø5 6
}
¿¿ 
context
¡¡ 
.
¡¡ 
SaveChanges
¡¡ '
(
¡¡' (
)
¡¡( )
;
¡¡) *
}
¬¬ 
using
√√ 
(
√√ 
dbModels
√√ 
context
√√  '
=
√√( )
new
√√* -
dbModels
√√. 6
(
√√6 7
)
√√7 8
)
√√8 9
routes
√√: @
=
√√A B
context
√√C J
.
√√J K
Route
√√K P
.
√√P Q
Where
√√Q V
(
√√V W
x
√√W X
=>
√√Y [
x
√√\ ]
.
√√] ^
idLine
√√^ d
==
√√e g
id
√√h j
)
√√j k
.
√√k l
ToList
√√l r
(
√√r s
)
√√s t
;
√√t u
if
ƒƒ 
(
ƒƒ 
routes
ƒƒ 
.
ƒƒ 
Count
ƒƒ  
>
ƒƒ! "
$num
ƒƒ# $
)
ƒƒ$ %
using
≈≈ 
(
≈≈ 
dbModels
≈≈ #
context
≈≈$ +
=
≈≈, -
new
≈≈. 1
dbModels
≈≈2 :
(
≈≈: ;
)
≈≈; <
)
≈≈< =
{
∆∆ 
foreach
«« 
(
««  !
var
««! $
item
««% )
in
««* ,
routes
««- 3
)
««3 4
{
»» 
Route
…… !
route
……" '
=
……( )
context
……* 1
.
……1 2
Route
……2 7
.
……7 8
Where
……8 =
(
……= >
x
……> ?
=>
……@ B
x
……C D
.
……D E
idRoute
……E L
==
……M O
item
……P T
.
……T U
idRoute
……U \
)
……\ ]
.
……] ^
FirstOrDefault
……^ l
(
……l m
)
……m n
;
……n o
context
   #
.
  # $
Route
  $ )
.
  ) *
Remove
  * 0
(
  0 1
route
  1 6
)
  6 7
;
  7 8
}
ÃÃ 
context
ÕÕ 
.
ÕÕ  
SaveChanges
ÕÕ  +
(
ÕÕ+ ,
)
ÕÕ, -
;
ÕÕ- .
}
ŒŒ 
using
œœ 
(
œœ 
dbModels
œœ 
context
œœ  '
=
œœ( )
new
œœ* -
dbModels
œœ. 6
(
œœ6 7
)
œœ7 8
)
œœ8 9
{
–– 
line
—— 
=
—— 
context
—— "
.
——" #
Line
——# '
.
——' (
Where
——( -
(
——- .
x
——. /
=>
——0 2
x
——3 4
.
——4 5
nameLine
——5 =
==
——> @
id
——A C
)
——C D
.
——D E
FirstOrDefault
——E S
(
——S T
)
——T U
;
——U V
context
““ 
.
““ 
Line
““  
.
““  !
Remove
““! '
(
““' (
line
““( ,
)
““, -
;
““- .
context
”” 
.
”” 
SaveChanges
”” '
(
””' (
)
””( )
;
””) *
}
‘‘ 
return
’’ 
RedirectToAction
’’ '
(
’’' (
$str
’’( /
)
’’/ 0
;
’’0 1
}
÷÷ 
catch
◊◊ 
(
◊◊ 
	Exception
◊◊ 
)
◊◊ 
{
ÿÿ 
return
ŸŸ 
RedirectToAction
ŸŸ '
(
ŸŸ' (
$str
ŸŸ( /
,
ŸŸ/ 0
$str
ŸŸ1 7
)
ŸŸ7 8
;
ŸŸ8 9
}
⁄⁄ 
}
€€ 	
public
‹‹ 
ActionResult
‹‹ 
	MenuLines
‹‹ %
(
‹‹% &
)
‹‹& '
{
›› 	
Login
ﬁﬁ 
logi
ﬁﬁ 
=
ﬁﬁ 
new
ﬁﬁ 
Login
ﬁﬁ "
(
ﬁﬁ" #
)
ﬁﬁ# $
;
ﬁﬁ$ %
var
ﬂﬂ 

authResult
ﬂﬂ 
=
ﬂﬂ  
AutenticarPasosRol
ﬂﬂ /
(
ﬂﬂ/ 0
$num
ﬂﬂ0 1
)
ﬂﬂ1 2
;
ﬂﬂ2 3
if
‡‡ 
(
‡‡ 

authResult
‡‡ 
!=
‡‡ 
null
‡‡ "
)
‡‡" #
return
‡‡$ *

authResult
‡‡+ 5
;
‡‡5 6
string
‚‚ 
id
‚‚ 
=
‚‚ 
logi
‚‚ 
.
‚‚ %
GetEmployeeIdFromCookie
‚‚ 4
(
‚‚4 5
Request
‚‚5 <
)
‚‚< =
.
‚‚= >
ToString
‚‚> F
(
‚‚F G
)
‚‚G H
;
‚‚H I
using
„„ 
(
„„ 
dbModels
„„ 
context
„„ #
=
„„$ %
new
„„& )
dbModels
„„* 2
(
„„2 3
)
„„3 4
)
„„4 5
{
‰‰ 
List
ÂÂ 
<
ÂÂ 
Line
ÂÂ 
>
ÂÂ 
lines
ÂÂ  
=
ÂÂ! "
context
ÂÂ# *
.
ÂÂ* +
Line
ÂÂ+ /
.
ÂÂ/ 0
Where
ÂÂ0 5
(
ÂÂ5 6
x
ÂÂ6 7
=>
ÂÂ8 :
x
ÂÂ; <
.
ÂÂ< =
idAdmin
ÂÂ= D
==
ÂÂE G
id
ÂÂH J
)
ÂÂJ K
.
ÂÂK L
ToList
ÂÂL R
(
ÂÂR S
)
ÂÂS T
;
ÂÂT U
return
ÊÊ 
View
ÊÊ 
(
ÊÊ 
lines
ÊÊ !
)
ÊÊ! "
;
ÊÊ" #
}
ÁÁ 
}
ËË 	
public
ÈÈ 
ActionResult
ÈÈ 
HomeLine
ÈÈ $
(
ÈÈ$ %
)
ÈÈ% &
{
ÍÍ 	
try
ÎÎ 
{
ÏÏ 
Login
ÌÌ 
logi
ÌÌ 
=
ÌÌ 
new
ÌÌ  
Login
ÌÌ! &
(
ÌÌ& '
)
ÌÌ' (
;
ÌÌ( )
var
ÓÓ 

authResult
ÓÓ 
=
ÓÓ   
AutenticarPasosRol
ÓÓ! 3
(
ÓÓ3 4
$num
ÓÓ4 5
)
ÓÓ5 6
;
ÓÓ6 7
if
ÔÔ 
(
ÔÔ 

authResult
ÔÔ 
!=
ÔÔ !
null
ÔÔ" &
)
ÔÔ& '
return
ÔÔ( .

authResult
ÔÔ/ 9
;
ÔÔ9 :
string
ÒÒ 
Line
ÒÒ 
=
ÒÒ 
logi
ÒÒ "
.
ÒÒ" # 
GetLineaFromCookie
ÒÒ# 5
(
ÒÒ5 6
Request
ÒÒ6 =
)
ÒÒ= >
.
ÒÒ> ?
ToString
ÒÒ? G
(
ÒÒG H
)
ÒÒH I
;
ÒÒI J
string
ÚÚ 
id
ÚÚ 
=
ÚÚ 
logi
ÚÚ  
.
ÚÚ  !%
GetEmployeeIdFromCookie
ÚÚ! 8
(
ÚÚ8 9
Request
ÚÚ9 @
)
ÚÚ@ A
.
ÚÚA B
ToString
ÚÚB J
(
ÚÚJ K
)
ÚÚK L
;
ÚÚL M
if
ÛÛ 
(
ÛÛ 
Line
ÛÛ 
==
ÛÛ 
$str
ÛÛ 
)
ÛÛ 
{
ÙÙ 
using
ıı 
(
ıı 
dbModels
ıı #
context
ıı$ +
=
ıı, -
new
ıı. 1
dbModels
ıı2 :
(
ıı: ;
)
ıı; <
)
ıı< =
{
ˆˆ 
var
˜˜ 
line
˜˜  
=
˜˜! "
context
˜˜# *
.
˜˜* +
Line
˜˜+ /
.
˜˜/ 0
Where
˜˜0 5
(
˜˜5 6
x
˜˜6 7
=>
˜˜8 :
x
˜˜; <
.
˜˜< =
idAdmin
˜˜= D
==
˜˜E G
id
˜˜H J
)
˜˜J K
.
˜˜K L
ToList
˜˜L R
(
˜˜R S
)
˜˜S T
;
˜˜T U
if
¯¯ 
(
¯¯ 
line
¯¯  
.
¯¯  !
Count
¯¯! &
==
¯¯' )
$num
¯¯* +
)
¯¯+ ,
{
˘˘ 
return
˙˙ "
RedirectToAction
˙˙# 3
(
˙˙3 4
$str
˙˙4 F
,
˙˙F G
$str
˙˙H N
,
˙˙N O
new
˙˙P S
{
˙˙T U
linea
˙˙V [
=
˙˙\ ]
line
˙˙^ b
[
˙˙b c
$num
˙˙c d
]
˙˙d e
.
˙˙e f
nameLine
˙˙f n
}
˙˙o p
)
˙˙p q
;
˙˙q r
}
˚˚ 
}
¸¸ 
return
˝˝ 
RedirectToAction
˝˝ +
(
˝˝+ ,
$str
˝˝, 7
)
˝˝7 8
;
˝˝8 9
}
˛˛ 
else
ˇˇ 
{
ÄÄ 
using
ÅÅ 
(
ÅÅ 
dbModels
ÅÅ #
context
ÅÅ$ +
=
ÅÅ, -
new
ÅÅ. 1
dbModels
ÅÅ2 :
(
ÅÅ: ;
)
ÅÅ; <
)
ÅÅ< =
{
ÇÇ 
var
ÉÉ 
line
ÉÉ  
=
ÉÉ! "
context
ÉÉ# *
.
ÉÉ* +
Line
ÉÉ+ /
.
ÉÉ/ 0
Where
ÉÉ0 5
(
ÉÉ5 6
x
ÉÉ6 7
=>
ÉÉ8 :
x
ÉÉ; <
.
ÉÉ< =
idAdmin
ÉÉ= D
==
ÉÉE G
id
ÉÉH J
&&
ÉÉK M
x
ÉÉN O
.
ÉÉO P
nameLine
ÉÉP X
==
ÉÉY [
Line
ÉÉ\ `
)
ÉÉ` a
.
ÉÉa b
FirstOrDefault
ÉÉb p
(
ÉÉp q
)
ÉÉq r
;
ÉÉr s
if
ÑÑ 
(
ÑÑ 
line
ÑÑ  
==
ÑÑ! #
null
ÑÑ$ (
)
ÑÑ( )
return
ÖÖ "
RedirectToAction
ÖÖ# 3
(
ÖÖ3 4
$str
ÖÖ4 B
,
ÖÖB C
$str
ÖÖD J
)
ÖÖJ K
;
ÖÖK L
}
ÜÜ 
using
áá 
(
áá 
dbModels
áá #
context
áá$ +
=
áá, -
new
áá. 1
dbModels
áá2 :
(
áá: ;
)
áá; <
)
áá< =
{
àà 
var
ââ 
line
ââ  
=
ââ! "
context
ââ# *
.
ââ* +
Line
ââ+ /
.
ââ/ 0
Where
ââ0 5
(
ââ5 6
x
ââ6 7
=>
ââ8 :
x
ââ; <
.
ââ< =
idAdmin
ââ= D
==
ââE G
id
ââH J
)
ââJ K
.
ââK L
ToList
ââL R
(
ââR S
)
ââS T
;
ââT U
ViewBag
ää 
.
ää  
count
ää  %
=
ää& '
line
ää( ,
.
ää, -
Count
ää- 2
;
ää2 3
}
ãã 
var
åå 
lineades
åå  
=
åå! "
new
åå# &
Line
åå' +
(
åå+ ,
)
åå, -
;
åå- .
List
çç 
<
çç 

Checkpoint
çç #
>
çç# $
check1
çç% +
=
çç, -
new
çç. 1
List
çç2 6
<
çç6 7

Checkpoint
çç7 A
>
ççA B
(
ççB C
)
ççC D
;
ççD E
List
ççF J
<
ççJ K

Checkpoint
ççK U
>
ççU V
check2
ççW ]
=
çç^ _
new
çç` c
List
ççd h
<
ççh i

Checkpoint
ççi s
>
ççs t
(
ççt u
)
ççu v
;
ççv w
using
éé 
(
éé 
dbModels
éé #
context
éé$ +
=
éé, -
new
éé. 1
dbModels
éé2 :
(
éé: ;
)
éé; <
)
éé< =
{
èè 
check1
êê 
=
êê  
context
êê! (
.
êê( )

Checkpoint
êê) 3
.
êê3 4
Where
êê4 9
(
êê9 :
x
êê: ;
=>
êê< >
x
êê? @
.
êê@ A
status
êêA G
==
êêH J
$num
êêK L
&&
êêM O
x
êêP Q
.
êêQ R
idLine
êêR X
==
êêY [
Line
êê\ `
)
êê` a
.
êêa b
GroupBy
êêb i
(
êêi j
x
êêj k
=>
êêl n
x
êêo p
.
êêp q
numberRoute
êêq |
)
êê| }
.
êê} ~
Selectêê~ Ñ
(êêÑ Ö
xêêÖ Ü
=>êêá â
xêêä ã
.êêã å
FirstOrDefaultêêå ö
(êêö õ
)êêõ ú
)êêú ù
.êêù û
ToListêêû §
(êê§ •
)êê• ¶
;êê¶ ß
check2
ëë 
=
ëë  
context
ëë! (
.
ëë( )

Checkpoint
ëë) 3
.
ëë3 4
Where
ëë4 9
(
ëë9 :
x
ëë: ;
=>
ëë< >
x
ëë? @
.
ëë@ A
status
ëëA G
==
ëëH J
$num
ëëK L
&&
ëëM O
x
ëëP Q
.
ëëQ R
idLine
ëëR X
==
ëëY [
Line
ëë\ `
)
ëë` a
.
ëëa b
GroupBy
ëëb i
(
ëëi j
x
ëëj k
=>
ëël n
x
ëëo p
.
ëëp q
numberRoute
ëëq |
)
ëë| }
.
ëë} ~
Selectëë~ Ñ
(ëëÑ Ö
xëëÖ Ü
=>ëëá â
xëëä ã
.ëëã å
FirstOrDefaultëëå ö
(ëëö õ
)ëëõ ú
)ëëú ù
.ëëù û
ToListëëû §
(ëë§ •
)ëë• ¶
;ëë¶ ß
lineades
íí  
=
íí! "
context
íí# *
.
íí* +
Line
íí+ /
.
íí/ 0
Where
íí0 5
(
íí5 6
x
íí6 7
=>
íí8 :
x
íí; <
.
íí< =
nameLine
íí= E
==
ííF H
Line
ííI M
)
ííM N
.
ííN O
FirstOrDefault
ííO ]
(
íí] ^
)
íí^ _
;
íí_ `
}
ìì 
if
ïï 
(
ïï 
!
ïï 
check1
ïï 
.
ïï  
Any
ïï  #
(
ïï# $
)
ïï$ %
)
ïï& '
return
ïï( .
RedirectToAction
ïï/ ?
(
ïï? @
$str
ïï@ I
,
ïïI J
$str
ïïK R
,
ïïR S
new
ïïT W
{
ïïX Y
numTypeRoute
ïïZ f
=
ïïg h
$num
ïïi j
}
ïïk l
)
ïïl m
;
ïïm n
if
ññ 
(
ññ 
!
ññ 
check2
ññ 
.
ññ  
Any
ññ  #
(
ññ# $
)
ññ$ %
)
ññ% &
return
ññ' -
RedirectToAction
ññ. >
(
ññ> ?
$str
ññ? H
,
ññH I
$str
ññJ Q
,
ññQ R
new
ññS V
{
ññW X
numTypeRoute
ññY e
=
ññf g
$num
ññh i
}
ññj k
)
ññk l
;
ññl m
var
óó 
noCoincidencia
óó &
=
óó' (
check1
óó) /
.
óó/ 0
Where
óó0 5
(
óó5 6
p2
óó6 8
=>
óó9 ;
check2
óó< B
.
óóB C
All
óóC F
(
óóF G
p1
óóG I
=>
óóJ L
p2
óóM O
.
óóO P
numberRoute
óóP [
!=
óó\ ^
p1
óó_ a
.
óóa b
numberRoute
óób m
)
óóm n
)
óón o
.
óóo p
ToList
óóp v
(
óóv w
)
óów x
;
óóx y
ViewBag
òò 
.
òò 
name
òò  
=
òò! "
Line
òò# '
;
òò' (
ViewBag
ôô 
.
ôô 
description
ôô '
=
ôô( )
lineades
ôô* 2
.
ôô2 3
description
ôô3 >
;
ôô> ?
foreach
öö 
(
öö 
var
öö  
item
öö! %
in
öö& (
noCoincidencia
öö) 7
)
öö7 8
{
õõ 
return
úú 
RedirectToAction
úú /
(
úú/ 0
$str
úú0 9
,
úú9 :
$str
úú; B
,
úúB C
new
úúD G
{
úúH I
numTypeRoute
úúJ V
=
úúW X
item
úúY ]
.
úú] ^
numberRoute
úú^ i
}
úúj k
)
úúk l
;
úúl m
}
ùù 
List
ûû 
<
ûû 
MuestraRutasMapas
ûû *
>
ûû* +
mapa
ûû, 0
=
ûû1 2
new
ûû3 6
List
ûû7 ;
<
ûû; <
MuestraRutasMapas
ûû< M
>
ûûM N
(
ûûN O
)
ûûO P
;
ûûP Q
int
üü 
count
üü 
=
üü 
$num
üü  !
;
üü! "
List
†† 
<
†† 
int
†† 
>
†† 
numR
†† "
=
††# $
new
††% (
List
††) -
<
††- .
int
††. 1
>
††1 2
(
††2 3
)
††3 4
;
††4 5
using
°° 
(
°° 
dbModels
°° #
context
°°$ +
=
°°, -
new
°°. 1
dbModels
°°2 :
(
°°: ;
)
°°; <
)
°°< =
numR
¢¢ 
=
¢¢ 
context
¢¢ &
.
¢¢& '
Route
¢¢' ,
.
££ 
Where
££ 
(
££ 
x
££  
=>
££! #
x
££$ %
.
££% &
idLine
££& ,
==
££- /
Line
££0 4
&&
££5 7
x
££8 9
.
££9 :
numTypeRoute
££: F
!=
££G I
null
££J N
)
££N O
.
§§ 
GroupBy
§§  
(
§§  !
x
§§! "
=>
§§# %
x
§§& '
.
§§' (
numTypeRoute
§§( 4
)
§§4 5
.
•• 
Select
•• 
(
••  
g
••  !
=>
••" $
g
••% &
.
••& '
Key
••' *
.
••* +
Value
••+ 0
)
••0 1
.
¶¶ 
Distinct
¶¶ !
(
¶¶! "
)
¶¶" #
.
ßß 
ToList
ßß 
(
ßß  
)
ßß  !
;
ßß! "
foreach
®® 
(
®® 
var
®®  
numType
®®! (
in
®®) +
numR
®®, 0
)
®®0 1
{
©© 
for
™™ 
(
™™ 
int
™™  
i
™™! "
=
™™# $
$num
™™% &
;
™™& '
i
™™( )
<=
™™* ,
$num
™™- .
;
™™. /
i
™™0 1
++
™™1 3
)
™™3 4
{
´´ 
MuestraRutasMapas
¨¨ -
muestraRutasMapas
¨¨. ?
=
¨¨@ A
new
¨¨B E
MuestraRutasMapas
¨¨F W
{
≠≠ 
ListRutasMostrar
ÆÆ  0
=
ÆÆ1 2
new
ÆÆ3 6
List
ÆÆ7 ;
<
ÆÆ; <
RutasMostrar
ÆÆ< H
>
ÆÆH I
(
ÆÆI J
)
ÆÆJ K
,
ÆÆK L 
ListParadasMostrar
ØØ  2
=
ØØ3 4
new
ØØ5 8
List
ØØ9 =
<
ØØ= >
ParadasMostrar
ØØ> L
>
ØØL M
(
ØØM N
)
ØØN O
,
ØØO P!
ListBloqueosMostrar
∞∞  3
=
∞∞4 5
new
∞∞6 9
List
∞∞: >
<
∞∞> ?
BloqueosMostrar
∞∞? N
>
∞∞N O
(
∞∞O P
)
∞∞P Q
,
∞∞Q R

NumeroRuta
±±  *
=
±±+ ,
i
±±- .
}
≤≤ 
;
≤≤ 
List
≥≥  
<
≥≥  !
BloqueosMostrar
≥≥! 0
>
≥≥0 1
nuevosBloqueos
≥≥2 @
=
≥≥A B
new
≥≥C F
List
≥≥G K
<
≥≥K L
BloqueosMostrar
≥≥L [
>
≥≥[ \
(
≥≥\ ]
)
≥≥] ^
;
≥≥^ _
List
¥¥  
<
¥¥  !
RutasMostrar
¥¥! -
>
¥¥- .
nuevasRutas
¥¥/ :
=
¥¥; <
new
¥¥= @
List
¥¥A E
<
¥¥E F
RutasMostrar
¥¥F R
>
¥¥R S
(
¥¥S T
)
¥¥T U
;
¥¥U V
List
µµ  
<
µµ  !
ParadasMostrar
µµ! /
>
µµ/ 0
nuevasParadas
µµ1 >
=
µµ? @
new
µµA D
List
µµE I
<
µµI J
ParadasMostrar
µµJ X
>
µµX Y
(
µµY Z
)
µµZ [
;
µµ[ \
using
∑∑ !
(
∑∑" #
dbModels
∑∑# +
context
∑∑, 3
=
∑∑4 5
new
∑∑6 9
dbModels
∑∑: B
(
∑∑B C
)
∑∑C D
)
∑∑D E
{
∏∏ 
var
ππ  #
checkpoints
ππ$ /
=
ππ0 1
context
ππ2 9
.
ππ9 :

Checkpoint
ππ: D
.
ππD E
Where
ππE J
(
ππJ K
x
ππK L
=>
ππM O
x
ππP Q
.
ππQ R
idLine
ππR X
==
ππY [
Line
ππ\ `
&&
ππa c
x
ππd e
.
ππe f
status
ππf l
!=
ππm o
$num
ππp q
&&
ππr t
x
ππu v
.
ππv w
numberRouteππw Ç
==ππÉ Ö
numTypeππÜ ç
)ππç é
.ππé è
ToListππè ï
(ππï ñ
)ππñ ó
;ππó ò
var
∫∫  #
routes
∫∫$ *
=
∫∫+ ,
context
∫∫- 4
.
∫∫4 5
Route
∫∫5 :
.
ªª$ %
Where
ªª% *
(
ªª* +
x
ªª+ ,
=>
ªª- /
x
ªª0 1
.
ªª1 2
idLine
ªª2 8
==
ªª9 ;
Line
ªª< @
&&
ªªA C
x
ªªD E
.
ªªE F
numberRoute
ªªF Q
==
ªªR T
i
ªªU V
&&
ªªW Y
x
ªªZ [
.
ªª[ \
numTypeRoute
ªª\ h
==
ªªi k
numType
ªªl s
)
ªªs t
.
ºº$ %
ToList
ºº% +
(
ºº+ ,
)
ºº, -
;
ºº- .
var
ΩΩ  #
	deviation
ΩΩ$ -
=
ΩΩ. /
context
ΩΩ0 7
.
ΩΩ7 8
DeviationRote
ΩΩ8 E
.
ΩΩE F
Where
ΩΩF K
(
ΩΩK L
x
ΩΩL M
=>
ΩΩN P
x
ΩΩQ R
.
ΩΩR S
idLine
ΩΩS Y
==
ΩΩZ \
Line
ΩΩ] a
&&
ΩΩb d
x
ΩΩe f
.
ΩΩf g
numberRoute
ΩΩg r
==
ΩΩs u
i
ΩΩv w
&&
ΩΩx z
x
ΩΩ{ |
.
ΩΩ| }
numTypeRouteΩΩ} â
==ΩΩä å
numTypeΩΩç î
)ΩΩî ï
.ΩΩï ñ
ToListΩΩñ ú
(ΩΩú ù
)ΩΩù û
;ΩΩû ü
if
ææ  "
(
ææ# $
	deviation
ææ$ -
.
ææ- .
Count
ææ. 3
>
ææ4 5
$num
ææ6 7
)
ææ7 8
{
øø  !
foreach
¿¿$ +
(
¿¿, -
var
¿¿- 0
item
¿¿1 5
in
¿¿6 8
	deviation
¿¿9 B
)
¿¿B C
{
¡¡$ %
List
¬¬( ,
<
¬¬, -
RutasMostrar
¬¬- 9
>
¬¬9 :
listBloqueos
¬¬; G
=
¬¬H I
new
¬¬J M
List
¬¬N R
<
¬¬R S
RutasMostrar
¬¬S _
>
¬¬_ `
(
¬¬` a
)
¬¬a b
;
¬¬b c
var
√√( +
route1
√√, 2
=
√√3 4
routes
√√5 ;
.
√√; <
Where
√√< A
(
√√A B
x
√√B C
=>
√√D F
x
√√G H
.
√√H I
idRoute
√√I P
==
√√Q S
item
√√T X
.
√√X Y
idRouteStart
√√Y e
&&
√√f h
x
√√i j
.
√√j k
idLine
√√k q
==
√√r t
Line
√√u y
)
√√y z
.
√√z {
FirstOrDefault√√{ â
(√√â ä
)√√ä ã
;√√ã å
var
ƒƒ( +
route2
ƒƒ, 2
=
ƒƒ3 4
routes
ƒƒ5 ;
.
ƒƒ; <
Where
ƒƒ< A
(
ƒƒA B
x
ƒƒB C
=>
ƒƒD F
x
ƒƒG H
.
ƒƒH I
idRoute
ƒƒI P
==
ƒƒQ S
item
ƒƒT X
.
ƒƒX Y

idRouteEnd
ƒƒY c
&&
ƒƒd f
x
ƒƒg h
.
ƒƒh i
idLine
ƒƒi o
==
ƒƒp r
Line
ƒƒs w
)
ƒƒw x
.
ƒƒx y
FirstOrDefaultƒƒy á
(ƒƒá à
)ƒƒà â
;ƒƒâ ä
if
≈≈( *
(
≈≈+ ,
route1
≈≈, 2
!=
≈≈3 5
null
≈≈6 :
&&
≈≈; =
route2
≈≈> D
!=
≈≈E G
null
≈≈H L
)
≈≈L M
{
∆∆( )
var
««, /
routesDeviation
««0 ?
=
««@ A
routes
««B H
.
««H I
Where
««I N
(
««N O
x
««O P
=>
««Q S
x
««T U
.
««U V
numPoint
««V ^
>=
««_ a
route1
««b h
.
««h i
numPoint
««i q
&&
««r t
x
««u v
.
««v w
numPoint
««w 
<=««Ä Ç
route2««É â
.««â ä
numPoint««ä í
&&««ì ï
x««ñ ó
.««ó ò
idLine««ò û
==««ü °
Line««¢ ¶
)««¶ ß
.««ß ®
ToList««® Æ
(««Æ Ø
)««Ø ∞
;««∞ ±
foreach
»», 3
(
»»4 5
var
»»5 8
item2
»»9 >
in
»»? A
routesDeviation
»»B Q
)
»»Q R
{
……, -
listBloqueos
  0 <
.
  < =
Add
  = @
(
  @ A
new
  A D
RutasMostrar
  E Q
(
  Q R
item2
  R W
.
  W X
idRoute
  X _
,
  _ `
item2
  a f
.
  f g
latitud
  g n
,
  n o
item2
  p u
.
  u v
logintud
  v ~
,
  ~ 
$str  Ä Ç
,  Ç É
item2  Ñ â
.  â ä
status  ä ê
,  ê ë
(  í ì
int  ì ñ
)  ñ ó
item2  ó ú
.  ú ù
numPoint  ù •
)  • ¶
)  ¶ ß
;  ß ®
}
ÀÀ, -
var
ÃÃ, /
place1
ÃÃ0 6
=
ÃÃ7 8
context
ÃÃ9 @
.
ÃÃ@ A
Place
ÃÃA F
.
ÃÃF G
Where
ÃÃG L
(
ÃÃL M
x
ÃÃM N
=>
ÃÃO Q
x
ÃÃR S
.
ÃÃS T
idPlace
ÃÃT [
==
ÃÃ\ ^
route1
ÃÃ_ e
.
ÃÃe f
idPlace
ÃÃf m
)
ÃÃm n
.
ÃÃn o
FirstOrDefault
ÃÃo }
(
ÃÃ} ~
)
ÃÃ~ 
;ÃÃ Ä
var
ÕÕ, /
place2
ÕÕ0 6
=
ÕÕ7 8
context
ÕÕ9 @
.
ÕÕ@ A
Place
ÕÕA F
.
ÕÕF G
Where
ÕÕG L
(
ÕÕL M
x
ÕÕM N
=>
ÕÕO Q
x
ÕÕR S
.
ÕÕS T
idPlace
ÕÕT [
==
ÕÕ\ ^
route2
ÕÕ_ e
.
ÕÕe f
idPlace
ÕÕf m
)
ÕÕm n
.
ÕÕn o
FirstOrDefault
ÕÕo }
(
ÕÕ} ~
)
ÕÕ~ 
;ÕÕ Ä
nuevosBloqueos
ŒŒ, :
.
ŒŒ: ;
Add
ŒŒ; >
(
ŒŒ> ?
new
ŒŒ? B
BloqueosMostrar
ŒŒC R
(
ŒŒR S
item
ŒŒS W
.
ŒŒW X
idDeviation
ŒŒX c
,
ŒŒc d
$str
ŒŒe o
+
ŒŒp q
place1
ŒŒr x
.
ŒŒx y
descriptionŒŒy Ñ
+ŒŒÖ Ü
$strŒŒá å
+ŒŒç é
place2ŒŒè ï
.ŒŒï ñ
descriptionŒŒñ °
,ŒŒ° ¢
listBloqueosŒŒ£ Ø
,ŒŒØ ∞
(ŒŒ± ≤
doubleŒŒ≤ ∏
)ŒŒ∏ π
route1ŒŒπ ø
.ŒŒø ¿
latitudŒŒ¿ «
,ŒŒ« »
(ŒŒ…  
doubleŒŒ  –
)ŒŒ– —
route2ŒŒ— ◊
.ŒŒ◊ ÿ
logintudŒŒÿ ‡
)ŒŒ‡ ·
)ŒŒ· ‚
;ŒŒ‚ „
}
œœ( )
}
––$ %
}
——  !
if
““  "
(
““# $
routes
““$ *
.
““* +
Count
““+ 0
>
““1 2
$num
““3 4
)
““4 5
{
””  !
count
‘‘$ )
=
‘‘* +
$num
‘‘, -
;
‘‘- .
foreach
’’$ +
(
’’, -
var
’’- 0
item
’’1 5
in
’’6 8
routes
’’9 ?
)
’’? @
{
÷÷$ %
count
◊◊( -
++
◊◊- /
;
◊◊/ 0
Place
ÿÿ( -
place
ÿÿ. 3
=
ÿÿ4 5
context
ÿÿ6 =
.
ÿÿ= >
Place
ÿÿ> C
.
ÿÿC D
FirstOrDefault
ÿÿD R
(
ÿÿR S
x
ÿÿS T
=>
ÿÿU W
x
ÿÿX Y
.
ÿÿY Z
idPlace
ÿÿZ a
==
ÿÿb d
item
ÿÿe i
.
ÿÿi j
idPlace
ÿÿj q
)
ÿÿq r
;
ÿÿr s
if
ŸŸ( *
(
ŸŸ+ ,
place
ŸŸ, 1
!=
ŸŸ2 4
null
ŸŸ5 9
)
ŸŸ9 :
{
⁄⁄( )
nuevasRutas
€€, 7
.
€€7 8
Add
€€8 ;
(
€€; <
new
€€< ?
RutasMostrar
€€@ L
(
€€L M
item
€€M Q
.
€€Q R
idRoute
€€R Y
,
€€Y Z
item
€€[ _
.
€€_ `
latitud
€€` g
,
€€g h
item
€€i m
.
€€m n
logintud
€€n v
,
€€v w
place
€€x }
.
€€} ~
description€€~ â
,€€â ä
item€€ã è
.€€è ê
status€€ê ñ
,€€ñ ó
(€€ò ô
int€€ô ú
)€€ú ù
item€€ù °
.€€° ¢
numPoint€€¢ ™
)€€™ ´
)€€´ ¨
;€€¨ ≠
}
‹‹( )
}
››$ %
if
ﬂﬂ$ &
(
ﬂﬂ' (
nuevasRutas
ﬂﬂ( 3
.
ﬂﬂ3 4
Any
ﬂﬂ4 7
(
ﬂﬂ7 8
)
ﬂﬂ8 9
)
ﬂﬂ9 :
{
‡‡$ %
RutasMostrar
··( 4
primeraRuta
··5 @
=
··A B
nuevasRutas
··C N
.
··N O
FirstOrDefault
··O ]
(
··] ^
r
··^ _
=>
··` b
r
··c d
.
··d e
status
··e k
==
··l n
$num
··o p
)
··p q
;
··q r
if
‚‚( *
(
‚‚+ ,
primeraRuta
‚‚, 7
!=
‚‚8 :
null
‚‚; ?
)
‚‚? @
{
„„( )
nuevasRutas
‰‰, 7
=
‰‰8 9
nuevasRutas
‰‰: E
.
ÂÂ0 1
OrderBy
ÂÂ1 8
(
ÂÂ8 9
route
ÂÂ9 >
=>
ÂÂ? A
route
ÂÂB G
.
ÂÂG H
numPoint
ÂÂH P
)
ÂÂP Q
.
ÊÊ0 1
ToList
ÊÊ1 7
(
ÊÊ7 8
)
ÊÊ8 9
;
ÊÊ9 :
}
ÁÁ( )
}
ËË$ %
count
ÈÈ$ )
=
ÈÈ* +
$num
ÈÈ, -
;
ÈÈ- .
foreach
ÍÍ$ +
(
ÍÍ, -
var
ÍÍ- 0
item
ÍÍ1 5
in
ÍÍ6 8
nuevasRutas
ÍÍ9 D
)
ÍÍD E
{
ÎÎ$ %
item
ÏÏ( ,
.
ÏÏ, -
name
ÏÏ- 1
=
ÏÏ2 3
item
ÏÏ4 8
.
ÏÏ8 9
name
ÏÏ9 =
+
ÏÏ> ?
$str
ÏÏ@ C
+
ÏÏD E
count
ÏÏF K
;
ÏÏK L
count
ÌÌ( -
++
ÌÌ- /
;
ÌÌ/ 0
}
ÓÓ$ %
}
ÔÔ  !
if
ÒÒ  "
(
ÒÒ# $
checkpoints
ÒÒ$ /
.
ÒÒ/ 0
Count
ÒÒ0 5
>
ÒÒ6 7
$num
ÒÒ8 9
)
ÒÒ9 :
{
ÚÚ  !
count
ÛÛ$ )
=
ÛÛ* +
$num
ÛÛ, -
;
ÛÛ- .
foreach
ÙÙ$ +
(
ÙÙ, -
var
ÙÙ- 0
item
ÙÙ1 5
in
ÙÙ6 8
checkpoints
ÙÙ9 D
)
ÙÙD E
{
ıı$ %
count
ˆˆ( -
++
ˆˆ- /
;
ˆˆ/ 0
nuevasParadas
˜˜( 5
.
˜˜5 6
Add
˜˜6 9
(
˜˜9 :
new
˜˜: =
ParadasMostrar
˜˜> L
(
˜˜L M
item
˜˜M Q
.
˜˜Q R
idCheckpoint
˜˜R ^
,
˜˜^ _
item
˜˜` d
.
˜˜d e
description
˜˜e p
,
˜˜p q
item
˜˜r v
.
˜˜v w
status
˜˜w }
,
˜˜} ~
item˜˜ É
.˜˜É Ñ
latitud˜˜Ñ ã
,˜˜ã å
item˜˜ç ë
.˜˜ë í
longitud˜˜í ö
)˜˜ö õ
)˜˜õ ú
;˜˜ú ù
}
¯¯$ %
if
˙˙$ &
(
˙˙' (
nuevasParadas
˙˙( 5
.
˙˙5 6
Any
˙˙6 9
(
˙˙9 :
)
˙˙: ;
)
˙˙; <
{
˚˚$ %
ParadasMostrar
¸¸( 6
primeraParada
¸¸7 D
=
¸¸E F
nuevasParadas
¸¸G T
.
¸¸T U
FirstOrDefault
¸¸U c
(
¸¸c d
r
¸¸d e
=>
¸¸f h
r
¸¸i j
.
¸¸j k
status
¸¸k q
==
¸¸r t
$num
¸¸u v
)
¸¸v w
;
¸¸w x
if
˝˝( *
(
˝˝+ ,
primeraParada
˝˝, 9
!=
˝˝: <
null
˝˝= A
)
˝˝A B
{
˛˛( )
nuevasParadas
ˇˇ, 9
=
ˇˇ: ;
nuevasParadas
ˇˇ< I
.
ÄÄ0 1
OrderBy
ÄÄ1 8
(
ÄÄ8 9
route
ÄÄ9 >
=>
ÄÄ? A
muestraRutasMapas
ÄÄB S
.
ÄÄS T(
CalcularDistanciaHaversine
ÄÄT n
(
ÄÄn o
(
ÅÅ4 5
decimal
ÅÅ5 <
)
ÅÅ< =
primeraParada
ÅÅ= J
.
ÅÅJ K
latitud
ÅÅK R
,
ÅÅR S
(
ÇÇ4 5
decimal
ÇÇ5 <
)
ÇÇ< =
primeraParada
ÇÇ= J
.
ÇÇJ K
longitud
ÇÇK S
,
ÇÇS T
route
ÉÉ4 9
.
ÉÉ9 :
latitud
ÉÉ: A
,
ÉÉA B
route
ÑÑ4 9
.
ÑÑ9 :
longitud
ÑÑ: B
)
ÑÑB C
)
ÑÑC D
.
ÖÖ0 1
ToList
ÖÖ1 7
(
ÖÖ7 8
)
ÖÖ8 9
;
ÖÖ9 :
}
ÜÜ( )
}
áá$ %
count
àà$ )
=
àà* +
$num
àà, -
;
àà- .
foreach
ââ$ +
(
ââ, -
var
ââ- 0
item
ââ1 5
in
ââ6 8
nuevasParadas
ââ9 F
)
ââF G
{
ää$ %
item
ãã( ,
.
ãã, -
description
ãã- 8
=
ãã9 :
item
ãã; ?
.
ãã? @
description
ãã@ K
+
ããL M
$str
ããN Q
+
ããR S
count
ããT Y
;
ããY Z
count
åå( -
++
åå- /
;
åå/ 0
}
çç$ %
}
éé  !
}
èè 
muestraRutasMapas
êê -
.
êê- .
ListRutasMostrar
êê. >
=
êê? @
nuevasRutas
êêA L
;
êêL M
muestraRutasMapas
ëë -
.
ëë- . 
ListParadasMostrar
ëë. @
=
ëëA B
nuevasParadas
ëëC P
;
ëëP Q
muestraRutasMapas
íí -
.
íí- .!
ListBloqueosMostrar
íí. A
=
ííB C
nuevosBloqueos
ííD R
;
ííR S
mapa
ìì  
.
ìì  !
Add
ìì! $
(
ìì$ %
muestraRutasMapas
ìì% 6
)
ìì6 7
;
ìì7 8
}
îî 
}
ïï 
return
ññ 
View
ññ 
(
ññ  
mapa
ññ  $
)
ññ$ %
;
ññ% &
}
óó 
}
ôô 
catch
öö 
(
öö 
	Exception
öö 
)
öö 
{
õõ 
return
úú 
RedirectToAction
úú '
(
úú' (
$str
úú( /
,
úú/ 0
$str
úú1 7
)
úú7 8
;
úú8 9
}
ùù 
}
ûû 	
public
üü 
ActionResult
üü  
AutenticarPasosRol
üü .
(
üü. /
int
üü/ 2
role
üü3 7
)
üü7 8
{
†† 	
if
°° 
(
°° 
!
°° 
User
°° 
.
°° 
Identity
°° 
.
°° 
IsAuthenticated
°° .
)
°°. /
return
°°0 6
RedirectToAction
°°7 G
(
°°G H
$str
°°H O
,
°°O P
$str
°°Q W
)
°°W X
;
°°X Y
Login
¢¢ 
logi
¢¢ 
=
¢¢ 
new
¢¢ 
Login
¢¢ "
(
¢¢" #
)
¢¢# $
;
¢¢$ %
int
££ 
?
££ 
roleSession
££ 
=
££ 
logi
££ #
.
££# $&
GetRoleSessionFromCookie
££$ <
(
££< =
Request
££= D
)
££D E
;
££E F
if
§§ 
(
§§ 
roleSession
§§ 
==
§§ 
null
§§ #
||
§§$ &
roleSession
§§' 2
!=
§§3 5
role
§§6 :
)
§§: ;
return
§§< B
RedirectToAction
§§C S
(
§§S T
$str
§§T [
,
§§[ \
$str
§§] c
)
§§c d
;
§§d e
return
•• 
null
•• 
;
•• 
}
¶¶ 	
public
ßß 
ActionResult
ßß 
ViewAllLines
ßß (
(
ßß( )
)
ßß) *
{
®® 	
List
™™ 
<
™™  
MuestraTodasLineas
™™ #
>
™™# $
allLines
™™% -
=
™™. /
new
™™0 3
List
™™4 8
<
™™8 9 
MuestraTodasLineas
™™9 K
>
™™K L
(
™™L M
)
™™M N
;
™™N O
List
´´ 
<
´´ 
Line
´´ 
>
´´ 
lines
´´ 
=
´´ 
new
´´ "
List
´´# '
<
´´' (
Line
´´( ,
>
´´, -
(
´´- .
)
´´. /
;
´´/ 0
using
¨¨ 
(
¨¨ 
dbModels
¨¨ 
context
¨¨ #
=
¨¨$ %
new
¨¨& )
dbModels
¨¨* 2
(
¨¨2 3
)
¨¨3 4
)
¨¨4 5
lines
¨¨6 ;
=
¨¨< =
context
¨¨> E
.
¨¨E F
Line
¨¨F J
.
¨¨J K
ToList
¨¨K Q
(
¨¨Q R
)
¨¨R S
;
¨¨S T
foreach
≠≠ 
(
≠≠ 
var
≠≠ 
item3
≠≠ 
in
≠≠ !
lines
≠≠" '
)
≠≠' (
{
ÆÆ 
string
ØØ 
Line
ØØ 
=
ØØ 
item3
ØØ #
.
ØØ# $
nameLine
ØØ$ ,
;
ØØ, -
int
±± 
count
±± 
=
±± 
$num
±± 
;
±± 
List
≤≤ 
<
≤≤ 
int
≤≤ 
>
≤≤ 
numR
≤≤ 
=
≤≤  
new
≤≤! $
List
≤≤% )
<
≤≤) *
int
≤≤* -
>
≤≤- .
(
≤≤. /
)
≤≤/ 0
;
≤≤0 1
using
≥≥ 
(
≥≥ 
dbModels
≥≥ 
context
≥≥  '
=
≥≥( )
new
≥≥* -
dbModels
≥≥. 6
(
≥≥6 7
)
≥≥7 8
)
≥≥8 9
{
¥¥ 
numR
µµ 
=
µµ 
context
µµ "
.
µµ" #
Route
µµ# (
.
∂∂ 
Where
∂∂ 
(
∂∂ 
x
∂∂  
=>
∂∂! #
x
∂∂$ %
.
∂∂% &
idLine
∂∂& ,
==
∂∂- /
Line
∂∂0 4
&&
∂∂5 7
x
∂∂8 9
.
∂∂9 :
numTypeRoute
∂∂: F
!=
∂∂G I
null
∂∂J N
)
∂∂N O
.
∑∑ 
GroupBy
∑∑  
(
∑∑  !
x
∑∑! "
=>
∑∑# %
x
∑∑& '
.
∑∑' (
numTypeRoute
∑∑( 4
)
∑∑4 5
.
∏∏ 
Select
∏∏ 
(
∏∏  
g
∏∏  !
=>
∏∏" $
g
∏∏% &
.
∏∏& '
Key
∏∏' *
.
∏∏* +
Value
∏∏+ 0
)
∏∏0 1
.
ππ 
Distinct
ππ !
(
ππ! "
)
ππ" #
.
∫∫ 
ToList
∫∫ 
(
∫∫  
)
∫∫  !
;
∫∫! "
if
ªª 
(
ªª 
Line
ªª 
==
ªª 
$str
ªª  *
)
ªª* +
ViewBag
ºº 
.
ºº  
	NumRoutes
ºº  )
=
ºº* +
numR
ºº, 0
;
ºº0 1
}
ΩΩ 
foreach
ææ 
(
ææ 
var
ææ 
numType
ææ $
in
ææ% '
numR
ææ( ,
)
ææ, -
{
øø 
List
¿¿ 
<
¿¿ 
MuestraRutasMapas
¿¿ *
>
¿¿* +
mapa
¿¿, 0
=
¿¿1 2
new
¿¿3 6
List
¿¿7 ;
<
¿¿; <
MuestraRutasMapas
¿¿< M
>
¿¿M N
(
¿¿N O
)
¿¿O P
;
¿¿P Q
for
¡¡ 
(
¡¡ 
int
¡¡ 
i
¡¡ 
=
¡¡  
$num
¡¡! "
;
¡¡" #
i
¡¡$ %
<=
¡¡& (
$num
¡¡) *
;
¡¡* +
i
¡¡, -
++
¡¡- /
)
¡¡/ 0
{
¬¬ 
MuestraRutasMapas
√√ )
muestraRutasMapas
√√* ;
=
√√< =
new
√√> A
MuestraRutasMapas
√√B S
{
ƒƒ 
ListRutasMostrar
≈≈ ,
=
≈≈- .
new
≈≈/ 2
List
≈≈3 7
<
≈≈7 8
RutasMostrar
≈≈8 D
>
≈≈D E
(
≈≈E F
)
≈≈F G
,
≈≈G H 
ListParadasMostrar
∆∆ .
=
∆∆/ 0
new
∆∆1 4
List
∆∆5 9
<
∆∆9 :
ParadasMostrar
∆∆: H
>
∆∆H I
(
∆∆I J
)
∆∆J K
,
∆∆K L!
ListBloqueosMostrar
«« /
=
««0 1
new
««2 5
List
««6 :
<
««: ;
BloqueosMostrar
««; J
>
««J K
(
««K L
)
««L M
,
««M N

NumeroRuta
»» &
=
»»' (
i
»») *
}
…… 
;
…… 
List
   
<
   
BloqueosMostrar
   ,
>
  , -
nuevosBloqueos
  . <
=
  = >
new
  ? B
List
  C G
<
  G H
BloqueosMostrar
  H W
>
  W X
(
  X Y
)
  Y Z
;
  Z [
List
ÀÀ 
<
ÀÀ 
RutasMostrar
ÀÀ )
>
ÀÀ) *
nuevasRutas
ÀÀ+ 6
=
ÀÀ7 8
new
ÀÀ9 <
List
ÀÀ= A
<
ÀÀA B
RutasMostrar
ÀÀB N
>
ÀÀN O
(
ÀÀO P
)
ÀÀP Q
;
ÀÀQ R
List
ÃÃ 
<
ÃÃ 
ParadasMostrar
ÃÃ +
>
ÃÃ+ ,
nuevasParadas
ÃÃ- :
=
ÃÃ; <
new
ÃÃ= @
List
ÃÃA E
<
ÃÃE F
ParadasMostrar
ÃÃF T
>
ÃÃT U
(
ÃÃU V
)
ÃÃV W
;
ÃÃW X
using
ÕÕ 
(
ÕÕ 
dbModels
ÕÕ '
context
ÕÕ( /
=
ÕÕ0 1
new
ÕÕ2 5
dbModels
ÕÕ6 >
(
ÕÕ> ?
)
ÕÕ? @
)
ÕÕ@ A
{
ŒŒ 
var
œœ 
checkpoints
œœ  +
=
œœ, -
context
œœ. 5
.
œœ5 6

Checkpoint
œœ6 @
.
œœ@ A
Where
œœA F
(
œœF G
x
œœG H
=>
œœI K
x
œœL M
.
œœM N
idLine
œœN T
==
œœU W
Line
œœX \
&&
œœ] _
x
œœ` a
.
œœa b
status
œœb h
!=
œœi k
$num
œœl m
&&
œœn p
x
œœq r
.
œœr s
numberRoute
œœs ~
==œœ Å
numTypeœœÇ â
)œœâ ä
.œœä ã
ToListœœã ë
(œœë í
)œœí ì
;œœì î
var
–– 
routes
––  &
=
––' (
context
––) 0
.
––0 1
Route
––1 6
.
——  !
Where
——! &
(
——& '
x
——' (
=>
——) +
x
——, -
.
——- .
idLine
——. 4
==
——5 7
Line
——8 <
&&
——= ?
x
——@ A
.
——A B
numberRoute
——B M
==
——N P
i
——Q R
&&
——S U
x
——V W
.
——W X
numTypeRoute
——X d
==
——e g
numType
——h o
)
——o p
.
““  !
ToList
““! '
(
““' (
)
““( )
;
““) *
var
”” 
	deviation
””  )
=
””* +
context
””, 3
.
””3 4
DeviationRote
””4 A
.
””A B
Where
””B G
(
””G H
x
””H I
=>
””J L
x
””M N
.
””N O
idLine
””O U
==
””V X
Line
””Y ]
&&
””^ `
x
””a b
.
””b c
numberRoute
””c n
==
””o q
i
””r s
&&
””t v
x
””w x
.
””x y
numTypeRoute””y Ö
==””Ü à
numType””â ê
)””ê ë
.””ë í
ToList””í ò
(””ò ô
)””ô ö
;””ö õ
if
‘‘ 
(
‘‘  
	deviation
‘‘  )
.
‘‘) *
Count
‘‘* /
>
‘‘0 1
$num
‘‘2 3
)
‘‘3 4
{
’’ 
foreach
÷÷  '
(
÷÷( )
var
÷÷) ,
item
÷÷- 1
in
÷÷2 4
	deviation
÷÷5 >
)
÷÷> ?
{
◊◊  !
List
ÿÿ$ (
<
ÿÿ( )
RutasMostrar
ÿÿ) 5
>
ÿÿ5 6
listBloqueos
ÿÿ7 C
=
ÿÿD E
new
ÿÿF I
List
ÿÿJ N
<
ÿÿN O
RutasMostrar
ÿÿO [
>
ÿÿ[ \
(
ÿÿ\ ]
)
ÿÿ] ^
;
ÿÿ^ _
var
ŸŸ$ '
route1
ŸŸ( .
=
ŸŸ/ 0
routes
ŸŸ1 7
.
ŸŸ7 8
Where
ŸŸ8 =
(
ŸŸ= >
x
ŸŸ> ?
=>
ŸŸ@ B
x
ŸŸC D
.
ŸŸD E
idRoute
ŸŸE L
==
ŸŸM O
item
ŸŸP T
.
ŸŸT U
idRouteStart
ŸŸU a
&&
ŸŸb d
x
ŸŸe f
.
ŸŸf g
idLine
ŸŸg m
==
ŸŸn p
Line
ŸŸq u
)
ŸŸu v
.
ŸŸv w
FirstOrDefaultŸŸw Ö
(ŸŸÖ Ü
)ŸŸÜ á
;ŸŸá à
var
⁄⁄$ '
route2
⁄⁄( .
=
⁄⁄/ 0
routes
⁄⁄1 7
.
⁄⁄7 8
Where
⁄⁄8 =
(
⁄⁄= >
x
⁄⁄> ?
=>
⁄⁄@ B
x
⁄⁄C D
.
⁄⁄D E
idRoute
⁄⁄E L
==
⁄⁄M O
item
⁄⁄P T
.
⁄⁄T U

idRouteEnd
⁄⁄U _
&&
⁄⁄` b
x
⁄⁄c d
.
⁄⁄d e
idLine
⁄⁄e k
==
⁄⁄l n
Line
⁄⁄o s
)
⁄⁄s t
.
⁄⁄t u
FirstOrDefault⁄⁄u É
(⁄⁄É Ñ
)⁄⁄Ñ Ö
;⁄⁄Ö Ü
if
€€$ &
(
€€' (
route1
€€( .
!=
€€/ 1
null
€€2 6
&&
€€7 9
route2
€€: @
!=
€€A C
null
€€D H
)
€€H I
{
‹‹$ %
var
››( +
routesDeviation
››, ;
=
››< =
routes
››> D
.
››D E
Where
››E J
(
››J K
x
››K L
=>
››M O
x
››P Q
.
››Q R
numPoint
››R Z
>=
››[ ]
route1
››^ d
.
››d e
numPoint
››e m
&&
››n p
x
››q r
.
››r s
numPoint
››s {
<=
››| ~
route2›› Ö
.››Ö Ü
numPoint››Ü é
&&››è ë
x››í ì
.››ì î
idLine››î ö
==››õ ù
Line››û ¢
&&››£ •
x››¶ ß
.››ß ®
numTypeRoute››® ¥
==››µ ∑
numType››∏ ø
)››ø ¿
.››¿ ¡
ToList››¡ «
(››« »
)››» …
;››…  
foreach
ﬁﬁ( /
(
ﬁﬁ0 1
var
ﬁﬁ1 4
item2
ﬁﬁ5 :
in
ﬁﬁ; =
routesDeviation
ﬁﬁ> M
)
ﬁﬁM N
{
ﬂﬂ( )
listBloqueos
‡‡, 8
.
‡‡8 9
Add
‡‡9 <
(
‡‡< =
new
‡‡= @
RutasMostrar
‡‡A M
(
‡‡M N
item2
‡‡N S
.
‡‡S T
idRoute
‡‡T [
,
‡‡[ \
item2
‡‡] b
.
‡‡b c
latitud
‡‡c j
,
‡‡j k
item2
‡‡l q
.
‡‡q r
logintud
‡‡r z
,
‡‡z {
$str
‡‡| ~
,
‡‡~ 
item2‡‡Ä Ö
.‡‡Ö Ü
status‡‡Ü å
,‡‡å ç
(‡‡é è
int‡‡è í
)‡‡í ì
item2‡‡ì ò
.‡‡ò ô
numPoint‡‡ô °
)‡‡° ¢
)‡‡¢ £
;‡‡£ §
}
··( )
var
‚‚( +
place1
‚‚, 2
=
‚‚3 4
context
‚‚5 <
.
‚‚< =
Place
‚‚= B
.
‚‚B C
Where
‚‚C H
(
‚‚H I
x
‚‚I J
=>
‚‚K M
x
‚‚N O
.
‚‚O P
idPlace
‚‚P W
==
‚‚X Z
route1
‚‚[ a
.
‚‚a b
idPlace
‚‚b i
)
‚‚i j
.
‚‚j k
FirstOrDefault
‚‚k y
(
‚‚y z
)
‚‚z {
;
‚‚{ |
var
„„( +
place2
„„, 2
=
„„3 4
context
„„5 <
.
„„< =
Place
„„= B
.
„„B C
Where
„„C H
(
„„H I
x
„„I J
=>
„„K M
x
„„N O
.
„„O P
idPlace
„„P W
==
„„X Z
route2
„„[ a
.
„„a b
idPlace
„„b i
)
„„i j
.
„„j k
FirstOrDefault
„„k y
(
„„y z
)
„„z {
;
„„{ |
nuevosBloqueos
‰‰( 6
.
‰‰6 7
Add
‰‰7 :
(
‰‰: ;
new
‰‰; >
BloqueosMostrar
‰‰? N
(
‰‰N O
item
‰‰O S
.
‰‰S T
idDeviation
‰‰T _
,
‰‰_ `
$str
‰‰a k
+
‰‰l m
place1
‰‰n t
.
‰‰t u
description‰‰u Ä
+‰‰Å Ç
$str‰‰É à
+‰‰â ä
place2‰‰ã ë
.‰‰ë í
description‰‰í ù
,‰‰ù û
listBloqueos‰‰ü ´
)‰‰´ ¨
)‰‰¨ ≠
;‰‰≠ Æ
}
ÂÂ$ %
}
ÁÁ  !
}
ËË 
if
ÈÈ 
(
ÈÈ  
routes
ÈÈ  &
.
ÈÈ& '
Count
ÈÈ' ,
>
ÈÈ- .
$num
ÈÈ/ 0
)
ÈÈ0 1
{
ÍÍ 
count
ÎÎ  %
=
ÎÎ& '
$num
ÎÎ( )
;
ÎÎ) *
foreach
ÏÏ  '
(
ÏÏ( )
var
ÏÏ) ,
item
ÏÏ- 1
in
ÏÏ2 4
routes
ÏÏ5 ;
)
ÏÏ; <
{
ÌÌ  !
count
ÓÓ$ )
++
ÓÓ) +
;
ÓÓ+ ,
Place
ÔÔ$ )
place
ÔÔ* /
=
ÔÔ0 1
context
ÔÔ2 9
.
ÔÔ9 :
Place
ÔÔ: ?
.
ÔÔ? @
FirstOrDefault
ÔÔ@ N
(
ÔÔN O
x
ÔÔO P
=>
ÔÔQ S
x
ÔÔT U
.
ÔÔU V
idPlace
ÔÔV ]
==
ÔÔ^ `
item
ÔÔa e
.
ÔÔe f
idPlace
ÔÔf m
)
ÔÔm n
;
ÔÔn o
if
$ &
(
' (
place
( -
!=
. 0
null
1 5
)
5 6
{
ÒÒ$ %
nuevasRutas
ÚÚ( 3
.
ÚÚ3 4
Add
ÚÚ4 7
(
ÚÚ7 8
new
ÚÚ8 ;
RutasMostrar
ÚÚ< H
(
ÚÚH I
item
ÚÚI M
.
ÚÚM N
idRoute
ÚÚN U
,
ÚÚU V
item
ÚÚW [
.
ÚÚ[ \
latitud
ÚÚ\ c
,
ÚÚc d
item
ÚÚe i
.
ÚÚi j
logintud
ÚÚj r
,
ÚÚr s
place
ÚÚt y
.
ÚÚy z
descriptionÚÚz Ö
,ÚÚÖ Ü
itemÚÚá ã
.ÚÚã å
statusÚÚå í
,ÚÚí ì
(ÚÚî ï
intÚÚï ò
)ÚÚò ô
itemÚÚô ù
.ÚÚù û
numPointÚÚû ¶
)ÚÚ¶ ß
)ÚÚß ®
;ÚÚ® ©
}
ÛÛ$ %
}
ÙÙ  !
if
ˆˆ  "
(
ˆˆ# $
nuevasRutas
ˆˆ$ /
.
ˆˆ/ 0
Any
ˆˆ0 3
(
ˆˆ3 4
)
ˆˆ4 5
)
ˆˆ5 6
{
˜˜  !
RutasMostrar
¯¯$ 0
primeraRuta
¯¯1 <
=
¯¯= >
nuevasRutas
¯¯? J
.
¯¯J K
FirstOrDefault
¯¯K Y
(
¯¯Y Z
r
¯¯Z [
=>
¯¯\ ^
r
¯¯_ `
.
¯¯` a
status
¯¯a g
==
¯¯h j
$num
¯¯k l
)
¯¯l m
;
¯¯m n
if
˘˘$ &
(
˘˘' (
primeraRuta
˘˘( 3
!=
˘˘4 6
null
˘˘7 ;
)
˘˘; <
{
˙˙$ %
nuevasRutas
˚˚( 3
=
˚˚4 5
nuevasRutas
˚˚6 A
.
¸¸, -
OrderBy
¸¸- 4
(
¸¸4 5
route
¸¸5 :
=>
¸¸; =
route
¸¸> C
.
¸¸C D
numPoint
¸¸D L
)
¸¸L M
.
˝˝, -
ToList
˝˝- 3
(
˝˝3 4
)
˝˝4 5
;
˝˝5 6
}
˛˛$ %
}
ˇˇ  !
count
ÄÄ  %
=
ÄÄ& '
$num
ÄÄ( )
;
ÄÄ) *
foreach
ÅÅ  '
(
ÅÅ( )
var
ÅÅ) ,
item
ÅÅ- 1
in
ÅÅ2 4
nuevasRutas
ÅÅ5 @
)
ÅÅ@ A
{
ÇÇ  !
item
ÉÉ$ (
.
ÉÉ( )
name
ÉÉ) -
=
ÉÉ. /
item
ÉÉ0 4
.
ÉÉ4 5
name
ÉÉ5 9
+
ÉÉ: ;
$str
ÉÉ< ?
+
ÉÉ@ A
count
ÉÉB G
;
ÉÉG H
count
ÑÑ$ )
++
ÑÑ) +
;
ÑÑ+ ,
}
ÖÖ  !
}
ÜÜ 
if
àà 
(
àà  
checkpoints
àà  +
.
àà+ ,
Count
àà, 1
>
àà2 3
$num
àà4 5
)
àà5 6
{
ââ 
count
ää  %
=
ää& '
$num
ää( )
;
ää) *
foreach
ãã  '
(
ãã( )
var
ãã) ,
item
ãã- 1
in
ãã2 4
checkpoints
ãã5 @
)
ãã@ A
{
åå  !
count
çç$ )
++
çç) +
;
çç+ ,
nuevasParadas
éé$ 1
.
éé1 2
Add
éé2 5
(
éé5 6
new
éé6 9
ParadasMostrar
éé: H
(
ééH I
item
ééI M
.
ééM N
idCheckpoint
ééN Z
,
ééZ [
item
éé\ `
.
éé` a
description
ééa l
,
éél m
item
één r
.
éér s
status
éés y
,
ééy z
item
éé{ 
.éé Ä
latitudééÄ á
,ééá à
itemééâ ç
.ééç é
longitudééé ñ
)ééñ ó
)ééó ò
;ééò ô
}
èè  !
if
ëë  "
(
ëë# $
nuevasParadas
ëë$ 1
.
ëë1 2
Any
ëë2 5
(
ëë5 6
)
ëë6 7
)
ëë7 8
{
íí  !
ParadasMostrar
ìì$ 2
primeraParada
ìì3 @
=
ììA B
nuevasParadas
ììC P
.
ììP Q
FirstOrDefault
ììQ _
(
ìì_ `
r
ìì` a
=>
ììb d
r
ììe f
.
ììf g
status
ììg m
==
ììn p
$num
ììq r
)
ììr s
;
ììs t
if
îî$ &
(
îî' (
primeraParada
îî( 5
!=
îî6 8
null
îî9 =
)
îî= >
{
ïï$ %
nuevasParadas
ññ( 5
=
ññ6 7
nuevasParadas
ññ8 E
.
óó, -
OrderBy
óó- 4
(
óó4 5
route
óó5 :
=>
óó; =
muestraRutasMapas
óó> O
.
óóO P(
CalcularDistanciaHaversine
óóP j
(
óój k
(
òò0 1
decimal
òò1 8
)
òò8 9
primeraParada
òò9 F
.
òòF G
latitud
òòG N
,
òòN O
(
ôô0 1
decimal
ôô1 8
)
ôô8 9
primeraParada
ôô9 F
.
ôôF G
longitud
ôôG O
,
ôôO P
route
öö0 5
.
öö5 6
latitud
öö6 =
,
öö= >
route
õõ0 5
.
õõ5 6
longitud
õõ6 >
)
õõ> ?
)
õõ? @
.
úú, -
ToList
úú- 3
(
úú3 4
)
úú4 5
;
úú5 6
}
ùù$ %
}
ûû  !
count
üü  %
=
üü& '
$num
üü( )
;
üü) *
foreach
††  '
(
††( )
var
††) ,
item
††- 1
in
††2 4
nuevasParadas
††5 B
)
††B C
{
°°  !
item
¢¢$ (
.
¢¢( )
description
¢¢) 4
=
¢¢5 6
item
¢¢7 ;
.
¢¢; <
description
¢¢< G
+
¢¢H I
$str
¢¢J M
+
¢¢N O
count
¢¢P U
;
¢¢U V
count
££$ )
++
££) +
;
££+ ,
}
§§  !
}
•• 
}
¶¶ 
muestraRutasMapas
ßß )
.
ßß) *
ListRutasMostrar
ßß* :
=
ßß; <
nuevasRutas
ßß= H
;
ßßH I
muestraRutasMapas
®® )
.
®®) * 
ListParadasMostrar
®®* <
=
®®= >
nuevasParadas
®®? L
;
®®L M
muestraRutasMapas
©© )
.
©©) *!
ListBloqueosMostrar
©©* =
=
©©> ?
nuevosBloqueos
©©@ N
;
©©N O
mapa
™™ 
.
™™ 
Add
™™  
(
™™  !
muestraRutasMapas
™™! 2
)
™™2 3
;
™™3 4
}
´´ 
allLines
¨¨ 
.
¨¨ 
Add
¨¨  
(
¨¨  !
new
¨¨! $ 
MuestraTodasLineas
¨¨% 7
(
¨¨7 8
Line
¨¨8 <
+
¨¨= >
$str
¨¨? F
+
¨¨G H
numType
¨¨I P
,
¨¨P Q
mapa
¨¨R V
)
¨¨V W
)
¨¨W X
;
¨¨X Y
}
≠≠ 
}
ØØ 
return
±± 
View
±± 
(
±± 
allLines
±±  
)
±±  !
;
±±! "
}
≥≥ 	
public
¥¥ 
ActionResult
¥¥ 
ViewLinesPerson
¥¥ +
(
¥¥+ ,
decimal
¥¥, 3
latitudInicial
¥¥4 B
,
¥¥B C
decimal
¥¥D K
longitudInicial
¥¥L [
,
¥¥[ \
decimal
¥¥] d
latitudFinal
¥¥e q
,
¥¥q r
decimal
¥¥s z
longitudFinal¥¥{ à
)¥¥à â
{
µµ 	
try
∂∂ 
{
∑∑ 
MuestraRutasMapas
∏∏ !
muestraRutasMapas
∏∏" 3
=
∏∏4 5
new
∏∏6 9
MuestraRutasMapas
∏∏: K
(
∏∏K L
)
∏∏L M
;
∏∏M N
if
ππ 
(
ππ 
muestraRutasMapas
ππ %
.
ππ% &(
CalcularDistanciaHaversine
ππ& @
(
ππ@ A
latitudInicial
ππA O
,
ππO P
longitudInicial
ππQ `
,
ππ` a
latitudFinal
ππb n
,
ππn o
longitudFinal
ππp }
)
ππ} ~
<ππ Ä
$numππÅ Ñ
)ππÑ Ö
{
∫∫ 
return
ªª 
RedirectToAction
ªª +
(
ªª+ ,
$str
ªª, 3
,
ªª3 4
$str
ªª5 ;
)
ªª; <
;
ªª< =
}
ºº 
bool
ΩΩ 
verificacion
ΩΩ !
=
ΩΩ" #
false
ΩΩ$ )
;
ΩΩ) *
double
ææ 
	kmMinimos
ææ  
=
ææ! "
$num
ææ# &
;
ææ& '
ViewBag
øø 
.
øø 
latitudInicial
øø &
=
øø' (
latitudInicial
øø) 7
;
øø7 8
ViewBag
¿¿ 
.
¿¿ 
longitudInicial
¿¿ '
=
¿¿( )
longitudInicial
¿¿* 9
;
¿¿9 :
ViewBag
¡¡ 
.
¡¡ 
latitudFinal
¡¡ $
=
¡¡% &
latitudFinal
¡¡' 3
;
¡¡3 4
ViewBag
¬¬ 
.
¬¬ 
longitudFinal
¬¬ %
=
¬¬& '
longitudFinal
¬¬( 5
;
¬¬5 6
List
√√ 
<
√√ 
LineaRutaPasajero
√√ &
>
√√& '
lines
√√( -
=
√√. /
new
√√0 3
List
√√4 8
<
√√8 9
LineaRutaPasajero
√√9 J
>
√√J K
(
√√K L
)
√√L M
;
√√M N
TimeZoneInfo
ƒƒ 
boliviaTimeZone
ƒƒ ,
=
ƒƒ- .
TimeZoneInfo
ƒƒ/ ;
.
ƒƒ; <$
FindSystemTimeZoneById
ƒƒ< R
(
ƒƒR S
$str
ƒƒS m
)
ƒƒm n
;
ƒƒn o
DateTime
≈≈ 
boliviaTime
≈≈ $
=
≈≈% &
TimeZoneInfo
≈≈' 3
.
≈≈3 4
ConvertTime
≈≈4 ?
(
≈≈? @
DateTime
≈≈@ H
.
≈≈H I
UtcNow
≈≈I O
,
≈≈O P
boliviaTimeZone
≈≈Q `
)
≈≈` a
;
≈≈a b
List
∆∆ 
<
∆∆  
MuestraTodasLineas
∆∆ '
>
∆∆' (
allLines
∆∆) 1
=
∆∆2 3
new
∆∆4 7
List
∆∆8 <
<
∆∆< = 
MuestraTodasLineas
∆∆= O
>
∆∆O P
(
∆∆P Q
)
∆∆Q R
;
∆∆R S
while
«« 
(
«« 
verificacion
«« #
==
««$ &
false
««' ,
)
««, -
{
»» 
lines
…… 
=
…… 
new
…… 
List
……  $
<
……$ %
LineaRutaPasajero
……% 6
>
……6 7
(
……7 8
)
……8 9
;
……9 :
using
   
(
   
dbModels
   #
context
  $ +
=
  , -
new
  . 1
dbModels
  2 :
(
  : ;
)
  ; <
)
  < =
{
ÀÀ 
var
ÃÃ 
	allRoutes
ÃÃ %
=
ÃÃ& '
context
ÃÃ( /
.
ÃÃ/ 0
Route
ÃÃ0 5
.
ÃÃ5 6
ToList
ÃÃ6 <
(
ÃÃ< =
)
ÃÃ= >
;
ÃÃ> ?
var
ÕÕ 
linesInicio
ÕÕ '
=
ÕÕ( )
	allRoutes
ÕÕ* 3
.
ŒŒ  !
Where
ŒŒ! &
(
ŒŒ& '
x
ŒŒ' (
=>
ŒŒ) +
muestraRutasMapas
ŒŒ, =
.
ŒŒ= >(
CalcularDistanciaHaversine
ŒŒ> X
(
ŒŒX Y
latitudInicial
ŒŒY g
,
ŒŒg h
longitudInicial
ŒŒi x
,
ŒŒx y
x
ŒŒz {
.
ŒŒ{ |
latitudŒŒ| É
,ŒŒÉ Ñ
xŒŒÖ Ü
.ŒŒÜ á
logintudŒŒá è
)ŒŒè ê
<ŒŒë í
	kmMinimosŒŒì ú
)ŒŒú ù
.
œœ  !
GroupBy
œœ! (
(
œœ( )
x
œœ) *
=>
œœ+ -
new
œœ. 1
{
œœ2 3
x
œœ4 5
.
œœ5 6
idLine
œœ6 <
,
œœ< =
x
œœ> ?
.
œœ? @
numberRoute
œœ@ K
,
œœK L
x
œœM N
.
œœN O
numTypeRoute
œœO [
}
œœ\ ]
)
œœ] ^
.
––  !
Select
––! '
(
––' (
g
––( )
=>
––* ,
new
––- 0
{
——  !
idLine
““$ *
=
““+ ,
g
““- .
.
““. /
Key
““/ 2
.
““2 3
idLine
““3 9
,
““9 :
numberRoute
””$ /
=
””0 1
g
””2 3
.
””3 4
Key
””4 7
.
””7 8
numberRoute
””8 C
,
””C D
numPoint
‘‘$ ,
=
‘‘- .
g
‘‘/ 0
.
‘‘0 1
OrderBy
‘‘1 8
(
‘‘8 9
x
‘‘9 :
=>
‘‘; =
muestraRutasMapas
‘‘> O
.
‘‘O P(
CalcularDistanciaHaversine
‘‘P j
(
‘‘j k
latitudInicial
‘‘k y
,
‘‘y z
longitudInicial‘‘{ ä
,‘‘ä ã
x‘‘å ç
.‘‘ç é
latitud‘‘é ï
,‘‘ï ñ
x‘‘ó ò
.‘‘ò ô
logintud‘‘ô °
)‘‘° ¢
)‘‘¢ £
.‘‘£ §
FirstOrDefault‘‘§ ≤
(‘‘≤ ≥
)‘‘≥ ¥
.‘‘¥ µ
numPoint‘‘µ Ω
,‘‘Ω æ
numType
’’$ +
=
’’, -
g
’’. /
.
’’/ 0
Key
’’0 3
.
’’3 4
numTypeRoute
’’4 @
}
÷÷  !
)
÷÷! "
.
◊◊  !
ToList
◊◊! '
(
◊◊' (
)
◊◊( )
;
◊◊) *
var
ÿÿ 

linesFinal
ÿÿ &
=
ÿÿ' (
	allRoutes
ÿÿ) 2
.
ŸŸ 
Where
ŸŸ "
(
ŸŸ" #
x
ŸŸ# $
=>
ŸŸ% '
muestraRutasMapas
ŸŸ( 9
.
ŸŸ9 :(
CalcularDistanciaHaversine
ŸŸ: T
(
ŸŸT U
latitudFinal
ŸŸU a
,
ŸŸa b
longitudFinal
ŸŸc p
,
ŸŸp q
x
ŸŸr s
.
ŸŸs t
latitud
ŸŸt {
,
ŸŸ{ |
x
ŸŸ} ~
.
ŸŸ~ 
logintudŸŸ á
)ŸŸá à
<ŸŸâ ä
	kmMinimosŸŸã î
)ŸŸî ï
.
⁄⁄ 
GroupBy
⁄⁄ $
(
⁄⁄$ %
x
⁄⁄% &
=>
⁄⁄' )
new
⁄⁄* -
{
⁄⁄. /
x
⁄⁄0 1
.
⁄⁄1 2
idLine
⁄⁄2 8
,
⁄⁄8 9
x
⁄⁄: ;
.
⁄⁄; <
numberRoute
⁄⁄< G
,
⁄⁄G H
x
⁄⁄I J
.
⁄⁄J K
numTypeRoute
⁄⁄K W
}
⁄⁄X Y
)
⁄⁄Y Z
.
€€ 
Select
€€ #
(
€€# $
g
€€$ %
=>
€€& (
new
€€) ,
{
‹‹ 
idLine
››  &
=
››' (
g
››) *
.
››* +
Key
››+ .
.
››. /
idLine
››/ 5
,
››5 6
numberRoute
ﬁﬁ  +
=
ﬁﬁ, -
g
ﬁﬁ. /
.
ﬁﬁ/ 0
Key
ﬁﬁ0 3
.
ﬁﬁ3 4
numberRoute
ﬁﬁ4 ?
,
ﬁﬁ? @
numPoint
ﬂﬂ  (
=
ﬂﬂ) *
g
ﬂﬂ+ ,
.
ﬂﬂ, -
OrderBy
ﬂﬂ- 4
(
ﬂﬂ4 5
x
ﬂﬂ5 6
=>
ﬂﬂ7 9
muestraRutasMapas
ﬂﬂ: K
.
ﬂﬂK L(
CalcularDistanciaHaversine
ﬂﬂL f
(
ﬂﬂf g
latitudFinal
ﬂﬂg s
,
ﬂﬂs t
longitudFinalﬂﬂu Ç
,ﬂﬂÇ É
xﬂﬂÑ Ö
.ﬂﬂÖ Ü
latitudﬂﬂÜ ç
,ﬂﬂç é
xﬂﬂè ê
.ﬂﬂê ë
logintudﬂﬂë ô
)ﬂﬂô ö
)ﬂﬂö õ
.ﬂﬂõ ú
FirstOrDefaultﬂﬂú ™
(ﬂﬂ™ ´
)ﬂﬂ´ ¨
.ﬂﬂ¨ ≠
numPointﬂﬂ≠ µ
,ﬂﬂµ ∂
numType
‡‡  '
=
‡‡( )
g
‡‡* +
.
‡‡+ ,
Key
‡‡, /
.
‡‡/ 0
numTypeRoute
‡‡0 <
}
·· 
)
·· 
.
‚‚ 
ToList
‚‚ #
(
‚‚# $
)
‚‚$ %
;
‚‚% &
foreach
‰‰ 
(
‰‰  !
var
‰‰! $
item
‰‰% )
in
‰‰* ,
linesInicio
‰‰- 8
)
‰‰8 9
{
ÂÂ 
foreach
ÊÊ #
(
ÊÊ$ %
var
ÊÊ% (
item2
ÊÊ) .
in
ÊÊ/ 1

linesFinal
ÊÊ2 <
)
ÊÊ< =
{
ÁÁ 
if
ËË  "
(
ËË# $
lines
ËË$ )
.
ËË) *
Count
ËË* /
<=
ËË0 2
$num
ËË3 4
)
ËË4 5
if
ÈÈ$ &
(
ÈÈ' (
item
ÈÈ( ,
.
ÈÈ, -
idLine
ÈÈ- 3
==
ÈÈ4 6
item2
ÈÈ7 <
.
ÈÈ< =
idLine
ÈÈ= C
&&
ÈÈD F
item
ÈÈG K
.
ÈÈK L
numberRoute
ÈÈL W
==
ÈÈX Z
item2
ÈÈ[ `
.
ÈÈ` a
numberRoute
ÈÈa l
&&
ÈÈm o
item
ÈÈp t
.
ÈÈt u
numPoint
ÈÈu }
<
ÈÈ~ 
item2ÈÈÄ Ö
.ÈÈÖ Ü
numPointÈÈÜ é
)ÈÈé è
{
ÍÍ$ %
if
ÎÎ( *
(
ÎÎ+ ,
!
ÎÎ, -
lines
ÎÎ- 2
.
ÎÎ2 3
Any
ÎÎ3 6
(
ÎÎ6 7
x
ÎÎ7 8
=>
ÎÎ9 ;
x
ÎÎ< =
.
ÎÎ= >
nameLine
ÎÎ> F
==
ÎÎG I
item
ÎÎJ N
.
ÎÎN O
idLine
ÎÎO U
&&
ÎÎV X
x
ÎÎY Z
.
ÎÎZ [
numRuta
ÎÎ[ b
==
ÎÎc e
(
ÎÎf g
int
ÎÎg j
)
ÎÎj k
item
ÎÎk o
.
ÎÎo p
numberRoute
ÎÎp {
&&
ÎÎ| ~
xÎÎ Ä
.ÎÎÄ Å
numTypeÎÎÅ à
==ÎÎâ ã
(ÎÎå ç
intÎÎç ê
)ÎÎê ë
itemÎÎë ï
.ÎÎï ñ
numTypeÎÎñ ù
)ÎÎù û
)ÎÎû ü
lines
ÏÏ, 1
.
ÏÏ1 2
Add
ÏÏ2 5
(
ÏÏ5 6
new
ÏÏ6 9
LineaRutaPasajero
ÏÏ: K
(
ÏÏK L
item
ÏÏL P
.
ÏÏP Q
idLine
ÏÏQ W
,
ÏÏW X
(
ÏÏY Z
int
ÏÏZ ]
)
ÏÏ] ^
item
ÏÏ^ b
.
ÏÏb c
numPoint
ÏÏc k
,
ÏÏk l
(
ÏÏm n
int
ÏÏn q
)
ÏÏq r
item2
ÏÏr w
.
ÏÏw x
numPointÏÏx Ä
,ÏÏÄ Å
(ÏÏÇ É
intÏÏÉ Ü
)ÏÏÜ á
itemÏÏá ã
.ÏÏã å
numberRouteÏÏå ó
,ÏÏó ò
(ÏÏô ö
intÏÏö ù
)ÏÏù û
itemÏÏû ¢
.ÏÏ¢ £
numTypeÏÏ£ ™
)ÏÏ™ ´
)ÏÏ´ ¨
;ÏÏ¨ ≠
}
ÌÌ$ %
}
ÓÓ 
}
ÔÔ 
}
 
	kmMinimos
ÒÒ 
=
ÒÒ 
	kmMinimos
ÒÒ  )
+
ÒÒ* +
$num
ÒÒ, /
;
ÒÒ/ 0
if
ÚÚ 
(
ÚÚ 
lines
ÚÚ 
.
ÚÚ 
Count
ÚÚ #
>
ÚÚ$ %
$num
ÚÚ& '
)
ÚÚ' (
verificacion
ÚÚ) 5
=
ÚÚ6 7
true
ÚÚ8 <
;
ÚÚ< =
}
ÛÛ 
foreach
ÙÙ 
(
ÙÙ 
var
ÙÙ 
item3
ÙÙ "
in
ÙÙ# %
lines
ÙÙ& +
)
ÙÙ+ ,
{
ıı 
string
ˆˆ 
Line
ˆˆ 
=
ˆˆ  !
item3
ˆˆ" '
.
ˆˆ' (
nameLine
ˆˆ( 0
;
ˆˆ0 1
List
˜˜ 
<
˜˜ 
MuestraRutasMapas
˜˜ *
>
˜˜* +
mapa
˜˜, 0
=
˜˜1 2
new
˜˜3 6
List
˜˜7 ;
<
˜˜; <
MuestraRutasMapas
˜˜< M
>
˜˜M N
(
˜˜N O
)
˜˜O P
;
˜˜P Q
int
¯¯ 
count
¯¯ 
=
¯¯ 
$num
¯¯  !
;
¯¯! "
muestraRutasMapas
˙˙ %
=
˙˙& '
new
˙˙( +
MuestraRutasMapas
˙˙, =
{
˚˚ 
ListRutasMostrar
¸¸ (
=
¸¸) *
new
¸¸+ .
List
¸¸/ 3
<
¸¸3 4
RutasMostrar
¸¸4 @
>
¸¸@ A
(
¸¸A B
)
¸¸B C
,
¸¸C D 
ListParadasMostrar
˝˝ *
=
˝˝+ ,
new
˝˝- 0
List
˝˝1 5
<
˝˝5 6
ParadasMostrar
˝˝6 D
>
˝˝D E
(
˝˝E F
)
˝˝F G
,
˝˝G H!
ListBloqueosMostrar
˛˛ +
=
˛˛, -
new
˛˛. 1
List
˛˛2 6
<
˛˛6 7
BloqueosMostrar
˛˛7 F
>
˛˛F G
(
˛˛G H
)
˛˛H I
,
˛˛I J

NumeroRuta
ˇˇ "
=
ˇˇ# $
item3
ˇˇ% *
.
ˇˇ* +
numRuta
ˇˇ+ 2
}
ÄÄ 
;
ÄÄ 
List
ÅÅ 
<
ÅÅ 
BloqueosMostrar
ÅÅ (
>
ÅÅ( )
nuevosBloqueos
ÅÅ* 8
=
ÅÅ9 :
new
ÅÅ; >
List
ÅÅ? C
<
ÅÅC D
BloqueosMostrar
ÅÅD S
>
ÅÅS T
(
ÅÅT U
)
ÅÅU V
;
ÅÅV W
List
ÇÇ 
<
ÇÇ 
RutasMostrar
ÇÇ %
>
ÇÇ% &
nuevasRutas
ÇÇ' 2
=
ÇÇ3 4
new
ÇÇ5 8
List
ÇÇ9 =
<
ÇÇ= >
RutasMostrar
ÇÇ> J
>
ÇÇJ K
(
ÇÇK L
)
ÇÇL M
;
ÇÇM N
List
ÉÉ 
<
ÉÉ 
ParadasMostrar
ÉÉ '
>
ÉÉ' (
nuevasParadas
ÉÉ) 6
=
ÉÉ7 8
new
ÉÉ9 <
List
ÉÉ= A
<
ÉÉA B
ParadasMostrar
ÉÉB P
>
ÉÉP Q
(
ÉÉQ R
)
ÉÉR S
;
ÉÉS T
List
ÑÑ 
<
ÑÑ 
string
ÑÑ 
>
ÑÑ  
choferesTiempo
ÑÑ! /
=
ÑÑ0 1
new
ÑÑ2 5
List
ÑÑ6 :
<
ÑÑ: ;
string
ÑÑ; A
>
ÑÑA B
(
ÑÑB C
)
ÑÑC D
;
ÑÑD E
List
ÖÖ 
<
ÖÖ  
ChoferesTiempoAuxi
ÖÖ +
>
ÖÖ+ , 
choferesTiempoAuxi
ÖÖ- ?
=
ÖÖ@ A
new
ÖÖB E
List
ÖÖF J
<
ÖÖJ K 
ChoferesTiempoAuxi
ÖÖK ]
>
ÖÖ] ^
(
ÖÖ^ _
)
ÖÖ_ `
;
ÖÖ` a
using
ÜÜ 
(
ÜÜ 
dbModels
ÜÜ #
context
ÜÜ$ +
=
ÜÜ, -
new
ÜÜ. 1
dbModels
ÜÜ2 :
(
ÜÜ: ;
)
ÜÜ; <
)
ÜÜ< =
{
áá 
var
àà 
checkpoints
àà '
=
àà( )
context
àà* 1
.
àà1 2

Checkpoint
àà2 <
.
àà< =
Where
àà= B
(
ààB C
x
ààC D
=>
ààE G
x
ààH I
.
ààI J
idLine
ààJ P
==
ààQ S
Line
ààT X
&&
ààY [
x
àà\ ]
.
àà] ^
status
àà^ d
!=
ààe g
$num
ààh i
&&
ààj l
x
ààm n
.
ààn o
numberRoute
àào z
==
àà{ }
item3àà~ É
.ààÉ Ñ
numTypeààÑ ã
)ààã å
.ààå ç
ToListààç ì
(ààì î
)ààî ï
;ààï ñ
var
ââ 
routes
ââ "
=
ââ# $
context
ââ% ,
.
ââ, -
Route
ââ- 2
.
ää 
Where
ää "
(
ää" #
x
ää# $
=>
ää% '
x
ää( )
.
ää) *
idLine
ää* 0
==
ää1 3
Line
ää4 8
&&
ää9 ;
x
ää< =
.
ää= >
numberRoute
ää> I
==
ääJ L
item3
ääM R
.
ääR S
numRuta
ääS Z
&&
ää[ ]
x
ää^ _
.
ää_ `
numTypeRoute
ää` l
==
ääm o
item3
ääp u
.
ääu v
numType
ääv }
)
ää} ~
.
ãã 
ToList
ãã #
(
ãã# $
)
ãã$ %
;
ãã% &
var
åå 
	deviation
åå %
=
åå& '
context
åå( /
.
åå/ 0
DeviationRote
åå0 =
.
åå= >
Where
åå> C
(
ååC D
x
ååD E
=>
ååF H
x
ååI J
.
ååJ K
idLine
ååK Q
==
ååR T
Line
ååU Y
&&
ååZ \
x
åå] ^
.
åå^ _
numberRoute
åå_ j
==
ååk m
item3
åån s
.
åås t
numRuta
ååt {
&&
åå| ~
xåå Ä
.ååÄ Å
numTypeRouteååÅ ç
==ååé ê
item3ååë ñ
.ååñ ó
numTypeååó û
)ååû ü
.ååü †
ToListåå† ¶
(åå¶ ß
)ååß ®
;åå® ©
if
çç 
(
çç 
	deviation
çç %
.
çç% &
Count
çç& +
>
çç, -
$num
çç. /
)
çç/ 0
{
éé 
foreach
èè #
(
èè$ %
var
èè% (
item
èè) -
in
èè. 0
	deviation
èè1 :
)
èè: ;
{
êê 
List
ëë  $
<
ëë$ %
RutasMostrar
ëë% 1
>
ëë1 2
listBloqueos
ëë3 ?
=
ëë@ A
new
ëëB E
List
ëëF J
<
ëëJ K
RutasMostrar
ëëK W
>
ëëW X
(
ëëX Y
)
ëëY Z
;
ëëZ [
var
íí  #
route1
íí$ *
=
íí+ ,
routes
íí- 3
.
íí3 4
Where
íí4 9
(
íí9 :
x
íí: ;
=>
íí< >
x
íí? @
.
íí@ A
idRoute
ííA H
==
ííI K
item
ííL P
.
ííP Q
idRouteStart
ííQ ]
&&
íí^ `
x
íía b
.
ííb c
idLine
ííc i
==
ííj l
Line
íím q
)
ííq r
.
íír s
FirstOrDefaultíís Å
(ííÅ Ç
)ííÇ É
;ííÉ Ñ
var
ìì  #
route2
ìì$ *
=
ìì+ ,
routes
ìì- 3
.
ìì3 4
Where
ìì4 9
(
ìì9 :
x
ìì: ;
=>
ìì< >
x
ìì? @
.
ìì@ A
idRoute
ììA H
==
ììI K
item
ììL P
.
ììP Q

idRouteEnd
ììQ [
&&
ìì\ ^
x
ìì_ `
.
ìì` a
idLine
ììa g
==
ììh j
Line
ììk o
)
ììo p
.
ììp q
FirstOrDefault
ììq 
(ìì Ä
)ììÄ Å
;ììÅ Ç
if
îî  "
(
îî# $
route1
îî$ *
!=
îî+ -
null
îî. 2
&&
îî3 5
route2
îî6 <
!=
îî= ?
null
îî@ D
)
îîD E
{
ïï  !
var
ññ$ '
routesDeviation
ññ( 7
=
ññ8 9
routes
ññ: @
.
ññ@ A
Where
ññA F
(
ññF G
x
ññG H
=>
ññI K
x
ññL M
.
ññM N
numPoint
ññN V
>=
ññW Y
route1
ññZ `
.
ññ` a
numPoint
ñña i
&&
ññj l
x
ññm n
.
ññn o
numPoint
ñño w
<=
ññx z
route2ññ{ Å
.ññÅ Ç
numPointññÇ ä
&&ññã ç
xññé è
.ññè ê
idLineññê ñ
==ññó ô
Lineññö û
)ññû ü
.ññü †
ToListññ† ¶
(ññ¶ ß
)ññß ®
;ññ® ©
foreach
óó$ +
(
óó, -
var
óó- 0
item2
óó1 6
in
óó7 9
routesDeviation
óó: I
)
óóI J
{
òò$ %
listBloqueos
ôô( 4
.
ôô4 5
Add
ôô5 8
(
ôô8 9
new
ôô9 <
RutasMostrar
ôô= I
(
ôôI J
item2
ôôJ O
.
ôôO P
idRoute
ôôP W
,
ôôW X
item2
ôôY ^
.
ôô^ _
latitud
ôô_ f
,
ôôf g
item2
ôôh m
.
ôôm n
logintud
ôôn v
,
ôôv w
$str
ôôx z
,
ôôz {
item2ôô| Å
.ôôÅ Ç
statusôôÇ à
,ôôà â
(ôôä ã
intôôã é
)ôôé è
item2ôôè î
.ôôî ï
numPointôôï ù
)ôôù û
)ôôû ü
;ôôü †
}
öö$ %
var
õõ$ '
place1
õõ( .
=
õõ/ 0
context
õõ1 8
.
õõ8 9
Place
õõ9 >
.
õõ> ?
Where
õõ? D
(
õõD E
x
õõE F
=>
õõG I
x
õõJ K
.
õõK L
idPlace
õõL S
==
õõT V
route1
õõW ]
.
õõ] ^
idPlace
õõ^ e
)
õõe f
.
õõf g
FirstOrDefault
õõg u
(
õõu v
)
õõv w
;
õõw x
var
úú$ '
place2
úú( .
=
úú/ 0
context
úú1 8
.
úú8 9
Place
úú9 >
.
úú> ?
Where
úú? D
(
úúD E
x
úúE F
=>
úúG I
x
úúJ K
.
úúK L
idPlace
úúL S
==
úúT V
route2
úúW ]
.
úú] ^
idPlace
úú^ e
)
úúe f
.
úúf g
FirstOrDefault
úúg u
(
úúu v
)
úúv w
;
úúw x
listBloqueos
ùù$ 0
=
ùù1 2
listBloqueos
ùù3 ?
.
ûû$ %
Where
ûû% *
(
ûû* +
item2
ûû+ 0
=>
ûû1 3
item2
ûû4 9
.
ûû9 :
numPoint
ûû: B
>=
ûûC E
item3
ûûF K
.
ûûK L
inicio
ûûL R
&&
ûûS U
item2
ûûV [
.
ûû[ \
numPoint
ûû\ d
<=
ûûe g
item3
ûûh m
.
ûûm n
final
ûûn s
)
ûûs t
.
üü$ %
ToList
üü% +
(
üü+ ,
)
üü, -
;
üü- .
nuevosBloqueos
††$ 2
.
††2 3
Add
††3 6
(
††6 7
new
††7 :
BloqueosMostrar
††; J
(
††J K
item
††K O
.
††O P
idDeviation
††P [
,
††[ \
$str
††] g
+
††h i
place1
††j p
.
††p q
description
††q |
+
††} ~
$str†† Ñ
+††Ö Ü
place2††á ç
.††ç é
description††é ô
,††ô ö
listBloqueos††õ ß
)††ß ®
)††® ©
;††© ™
}
°°  !
}
¢¢ 
}
££ 
if
§§ 
(
§§ 
routes
§§ "
.
§§" #
Count
§§# (
>
§§) *
$num
§§+ ,
)
§§, -
{
•• 
count
¶¶ !
=
¶¶" #
$num
¶¶$ %
;
¶¶% &
foreach
ßß #
(
ßß$ %
var
ßß% (
item
ßß) -
in
ßß. 0
routes
ßß1 7
)
ßß7 8
{
®® 
count
©©  %
++
©©% '
;
©©' (
Place
™™  %
place
™™& +
=
™™, -
context
™™. 5
.
™™5 6
Place
™™6 ;
.
™™; <
FirstOrDefault
™™< J
(
™™J K
x
™™K L
=>
™™M O
x
™™P Q
.
™™Q R
idPlace
™™R Y
==
™™Z \
item
™™] a
.
™™a b
idPlace
™™b i
)
™™i j
;
™™j k
if
´´  "
(
´´# $
place
´´$ )
!=
´´* ,
null
´´- 1
)
´´1 2
{
¨¨  !
nuevasRutas
≠≠$ /
.
≠≠/ 0
Add
≠≠0 3
(
≠≠3 4
new
≠≠4 7
RutasMostrar
≠≠8 D
(
≠≠D E
item
≠≠E I
.
≠≠I J
idRoute
≠≠J Q
,
≠≠Q R
item
≠≠S W
.
≠≠W X
latitud
≠≠X _
,
≠≠_ `
item
≠≠a e
.
≠≠e f
logintud
≠≠f n
,
≠≠n o
place
≠≠p u
.
≠≠u v
description≠≠v Å
,≠≠Å Ç
item≠≠É á
.≠≠á à
status≠≠à é
,≠≠é è
(≠≠ê ë
int≠≠ë î
)≠≠î ï
item≠≠ï ô
.≠≠ô ö
numPoint≠≠ö ¢
)≠≠¢ £
)≠≠£ §
;≠≠§ •
}
ÆÆ  !
}
ØØ 
if
±± 
(
±±  
nuevasRutas
±±  +
.
±±+ ,
Any
±±, /
(
±±/ 0
)
±±0 1
)
±±1 2
{
≤≤ 
RutasMostrar
≥≥  ,
primeraRuta
≥≥- 8
=
≥≥9 :
nuevasRutas
≥≥; F
.
≥≥F G
FirstOrDefault
≥≥G U
(
≥≥U V
r
≥≥V W
=>
≥≥X Z
r
≥≥[ \
.
≥≥\ ]
status
≥≥] c
==
≥≥d f
$num
≥≥g h
)
≥≥h i
;
≥≥i j
if
¥¥  "
(
¥¥# $
primeraRuta
¥¥$ /
!=
¥¥0 2
null
¥¥3 7
)
¥¥7 8
{
µµ  !
nuevasRutas
∂∂$ /
=
∂∂0 1
nuevasRutas
∂∂2 =
.
∑∑( )
OrderBy
∑∑) 0
(
∑∑0 1
route
∑∑1 6
=>
∑∑7 9
route
∑∑: ?
.
∑∑? @
numPoint
∑∑@ H
)
∑∑H I
.
∏∏( )
ToList
∏∏) /
(
∏∏/ 0
)
∏∏0 1
;
∏∏1 2
}
ππ  !
}
∫∫ 
count
ªª !
=
ªª" #
$num
ªª$ %
;
ªª% &
nuevasRutas
ºº '
=
ºº( )
nuevasRutas
ºº* 5
.
ΩΩ 
Where
ΩΩ "
(
ΩΩ" #
item2
ΩΩ# (
=>
ΩΩ) +
item2
ΩΩ, 1
.
ΩΩ1 2
numPoint
ΩΩ2 :
>=
ΩΩ; =
item3
ΩΩ> C
.
ΩΩC D
inicio
ΩΩD J
&&
ΩΩK M
item2
ΩΩN S
.
ΩΩS T
numPoint
ΩΩT \
<=
ΩΩ] _
item3
ΩΩ` e
.
ΩΩe f
final
ΩΩf k
)
ΩΩk l
.
ææ 
ToList
ææ #
(
ææ# $
)
ææ$ %
;
ææ% &
foreach
øø #
(
øø$ %
var
øø% (
item
øø) -
in
øø. 0
nuevasRutas
øø1 <
)
øø< =
{
¿¿ 
item
¡¡  $
.
¡¡$ %
name
¡¡% )
=
¡¡* +
item
¡¡, 0
.
¡¡0 1
name
¡¡1 5
+
¡¡6 7
$str
¡¡8 ;
+
¡¡< =
count
¡¡> C
;
¡¡C D
count
¬¬  %
++
¬¬% '
;
¬¬' (
}
√√ 
}
ƒƒ 
if
∆∆ 
(
∆∆ 
checkpoints
∆∆ '
.
∆∆' (
Count
∆∆( -
>
∆∆. /
$num
∆∆0 1
)
∆∆1 2
{
«« 
count
»» !
=
»»" #
$num
»»$ %
;
»»% &
foreach
…… #
(
……$ %
var
……% (
item
……) -
in
……. 0
checkpoints
……1 <
)
……< =
{
   
count
ÀÀ  %
++
ÀÀ% '
;
ÀÀ' (
nuevasParadas
ÃÃ  -
.
ÃÃ- .
Add
ÃÃ. 1
(
ÃÃ1 2
new
ÃÃ2 5
ParadasMostrar
ÃÃ6 D
(
ÃÃD E
item
ÃÃE I
.
ÃÃI J
idCheckpoint
ÃÃJ V
,
ÃÃV W
item
ÃÃX \
.
ÃÃ\ ]
description
ÃÃ] h
,
ÃÃh i
item
ÃÃj n
.
ÃÃn o
status
ÃÃo u
,
ÃÃu v
item
ÃÃw {
.
ÃÃ{ |
latitudÃÃ| É
,ÃÃÉ Ñ
itemÃÃÖ â
.ÃÃâ ä
longitudÃÃä í
)ÃÃí ì
)ÃÃì î
;ÃÃî ï
}
ÕÕ 
if
œœ 
(
œœ  
nuevasParadas
œœ  -
.
œœ- .
Any
œœ. 1
(
œœ1 2
)
œœ2 3
)
œœ3 4
{
–– 
ParadasMostrar
——  .
primeraParada
——/ <
=
——= >
nuevasParadas
——? L
.
——L M
FirstOrDefault
——M [
(
——[ \
r
——\ ]
=>
——^ `
r
——a b
.
——b c
status
——c i
==
——j l
$num
——m n
)
——n o
;
——o p
if
““  "
(
““# $
primeraParada
““$ 1
!=
““2 4
null
““5 9
)
““9 :
{
””  !
nuevasParadas
‘‘$ 1
=
‘‘2 3
nuevasParadas
‘‘4 A
.
’’( )
OrderBy
’’) 0
(
’’0 1
route
’’1 6
=>
’’7 9
muestraRutasMapas
’’: K
.
’’K L(
CalcularDistanciaHaversine
’’L f
(
’’f g
(
÷÷, -
decimal
÷÷- 4
)
÷÷4 5
primeraParada
÷÷5 B
.
÷÷B C
latitud
÷÷C J
,
÷÷J K
(
◊◊, -
decimal
◊◊- 4
)
◊◊4 5
primeraParada
◊◊5 B
.
◊◊B C
longitud
◊◊C K
,
◊◊K L
route
ÿÿ, 1
.
ÿÿ1 2
latitud
ÿÿ2 9
,
ÿÿ9 :
route
ŸŸ, 1
.
ŸŸ1 2
longitud
ŸŸ2 :
)
ŸŸ: ;
)
ŸŸ; <
.
⁄⁄( )
ToList
⁄⁄) /
(
⁄⁄/ 0
)
⁄⁄0 1
;
⁄⁄1 2
}
€€  !
}
‹‹ 
count
›› !
=
››" #
$num
››$ %
;
››% &
foreach
ﬁﬁ #
(
ﬁﬁ$ %
var
ﬁﬁ% (
item
ﬁﬁ) -
in
ﬁﬁ. 0
nuevasParadas
ﬁﬁ1 >
)
ﬁﬁ> ?
{
ﬂﬂ 
item
‡‡  $
.
‡‡$ %
description
‡‡% 0
=
‡‡1 2
item
‡‡3 7
.
‡‡7 8
description
‡‡8 C
+
‡‡D E
$str
‡‡F I
+
‡‡J K
count
‡‡L Q
;
‡‡Q R
count
··  %
++
··% '
;
··' (
}
‚‚ 
}
„„ 
List
ÂÂ 
<
ÂÂ 
Employee
ÂÂ %
>
ÂÂ% &
em
ÂÂ' )
=
ÂÂ* +
context
ÂÂ, 3
.
ÂÂ3 4
Employee
ÂÂ4 <
.
ÂÂ< =
Where
ÂÂ= B
(
ÂÂB C
x
ÂÂC D
=>
ÂÂE G
x
ÂÂH I
.
ÂÂI J
status
ÂÂJ P
!=
ÂÂQ S
$num
ÂÂT U
&&
ÂÂV X
x
ÂÂY Z
.
ÂÂZ [
plate
ÂÂ[ `
!=
ÂÂa c
null
ÂÂd h
&&
ÂÂi k
(
ÂÂl m
x
ÂÂm n
.
ÂÂn o
enabled
ÂÂo v
!=
ÂÂw y
null
ÂÂz ~
||ÂÂ Å
xÂÂÇ É
.ÂÂÉ Ñ
enabledÂÂÑ ã
==ÂÂå é
$numÂÂè ê
||ÂÂë ì
xÂÂî ï
.ÂÂï ñ
enabledÂÂñ ù
==ÂÂû †
$numÂÂ° ¢
)ÂÂ¢ £
&&ÂÂ§ ¶
xÂÂß ®
.ÂÂ® ©
idLineÂÂ© Ø
==ÂÂ∞ ≤
LineÂÂ≥ ∑
)ÂÂ∑ ∏
.ÂÂ∏ π
ToListÂÂπ ø
(ÂÂø ¿
)ÂÂ¿ ¡
;ÂÂ¡ ¬
if
ÊÊ 
(
ÊÊ 
em
ÊÊ 
.
ÊÊ 
Count
ÊÊ $
>
ÊÊ% &
$num
ÊÊ' (
)
ÊÊ( )
{
ÁÁ 
foreach
ËË #
(
ËË$ %
var
ËË% (
item
ËË) -
in
ËË. 0
em
ËË1 3
)
ËË3 4
{
ÈÈ 
double
ÍÍ  &
minutes
ÍÍ' .
=
ÍÍ/ 0
$num
ÍÍ1 2
;
ÍÍ2 3
double
ÎÎ  &
	kmTotales
ÎÎ' 0
=
ÎÎ1 2
$num
ÎÎ3 6
;
ÎÎ6 7
double
ÏÏ  &
km
ÏÏ' )
=
ÏÏ* +
$num
ÏÏ, -
;
ÏÏ- .
if
ÌÌ  "
(
ÌÌ# $
item3
ÌÌ$ )
.
ÌÌ) *
numRuta
ÌÌ* 1
==
ÌÌ2 4
$num
ÌÌ5 6
)
ÌÌ6 7
{
ÓÓ  !
var
ÔÔ$ '
timeControls
ÔÔ( 4
=
ÔÔ5 6
context
ÔÔ7 >
.
ÔÔ> ?
TimeControl
ÔÔ? J
.
$ %
Where
% *
(
* +
x
+ ,
=>
- /
x
0 1
.
1 2

idEmployee
2 <
==
= ?
item
@ D
.
D E

idEmployee
E O
&&
P R
x
S T
.
T U
dateRegister
U a
.
a b
HasValue
b j
&&
k m
(
n o
x
o p
.
p q
enable
q w
==
x z
$num
{ |
||
} 
xÄ Å
.Å Ç
enableÇ à
==â ã
$numå ç
)ç é
)é è
.
ÒÒ$ %
AsEnumerable
ÒÒ% 1
(
ÒÒ1 2
)
ÒÒ2 3
.
ÚÚ$ %
OrderBy
ÚÚ% ,
(
ÚÚ, -
x
ÚÚ- .
=>
ÚÚ/ 1
Math
ÚÚ2 6
.
ÚÚ6 7
Abs
ÚÚ7 :
(
ÚÚ: ;
(
ÚÚ; <
x
ÚÚ< =
.
ÚÚ= >
dateRegister
ÚÚ> J
.
ÚÚJ K
Value
ÚÚK P
-
ÚÚQ R
boliviaTime
ÚÚS ^
)
ÚÚ^ _
.
ÚÚ_ `
TotalSeconds
ÚÚ` l
)
ÚÚl m
)
ÚÚm n
.
ÛÛ$ %
ToList
ÛÛ% +
(
ÛÛ+ ,
)
ÛÛ, -
;
ÛÛ- .
var
ÙÙ$ '
timeControl
ÙÙ( 3
=
ÙÙ4 5
timeControls
ÙÙ6 B
.
ÙÙB C
FirstOrDefault
ÙÙC Q
(
ÙÙQ R
)
ÙÙR S
;
ÙÙS T
if
ˆˆ$ &
(
ˆˆ' (
timeControl
ˆˆ( 3
!=
ˆˆ4 6
null
ˆˆ7 ;
)
ˆˆ; <
{
˜˜$ %
var
¯¯( +
tim
¯¯, /
=
¯¯0 1
context
¯¯2 9
.
¯¯9 :

Checkpoint
¯¯: D
.
¯¯D E
Where
¯¯E J
(
¯¯J K
x
¯¯K L
=>
¯¯M O
x
¯¯P Q
.
¯¯Q R
idCheckpoint
¯¯R ^
==
¯¯_ a
timeControl
¯¯b m
.
¯¯m n
idCheckpoint
¯¯n z
&&
¯¯{ }
x
¯¯~ 
.¯¯ Ä
numberRoute¯¯Ä ã
==¯¯å é
item3¯¯è î
.¯¯î ï
numType¯¯ï ú
)¯¯ú ù
.¯¯ù û
FirstOrDefault¯¯û ¨
(¯¯¨ ≠
)¯¯≠ Æ
;¯¯Æ Ø
if
˘˘( *
(
˘˘+ ,
tim
˘˘, /
!=
˘˘0 2
null
˘˘3 7
)
˘˘7 8
{
˙˙( )
var
˚˚, /
paradas
˚˚0 7
=
˚˚8 9
new
˚˚: =
List
˚˚> B
<
˚˚B C
ParadasOrden
˚˚C O
>
˚˚O P
(
˚˚P Q
)
˚˚Q R
;
˚˚R S
foreach
¸¸, 3
(
¸¸4 5
var
¸¸5 8
paradass
¸¸9 A
in
¸¸B D
checkpoints
¸¸E P
)
¸¸P Q
{
˝˝, -
paradas
˛˛0 7
.
˛˛7 8
Add
˛˛8 ;
(
˛˛; <
new
˛˛< ?
ParadasOrden
˛˛@ L
(
˛˛L M
paradass
˛˛M U
.
˛˛U V
idCheckpoint
˛˛V b
,
˛˛b c
paradass
˛˛d l
.
˛˛l m
status
˛˛m s
,
˛˛s t
paradass
˛˛u }
.
˛˛} ~
latitud˛˛~ Ö
,˛˛Ö Ü
paradass˛˛á è
.˛˛è ê
longitud˛˛ê ò
)˛˛ò ô
)˛˛ô ö
;˛˛ö õ
}
ˇˇ, -
var
ÄÄ, /
rota
ÄÄ0 4
=
ÄÄ5 6
routes
ÄÄ7 =
.
ÄÄ= >
Where
ÄÄ> C
(
ÄÄC D
x
ÄÄD E
=>
ÄÄF H
x
ÄÄI J
.
ÄÄJ K
numberRoute
ÄÄK V
==
ÄÄW Y
item3
ÄÄZ _
.
ÄÄ_ `
numRuta
ÄÄ` g
&&
ÄÄh j
x
ÄÄk l
.
ÄÄl m
numPoint
ÄÄm u
==
ÄÄv x
item3
ÄÄy ~
.
ÄÄ~ 
inicioÄÄ Ö
)ÄÄÖ Ü
.ÄÄÜ á
FirstOrDefaultÄÄá ï
(ÄÄï ñ
)ÄÄñ ó
;ÄÄó ò
paradas
ÅÅ, 3
.
ÅÅ3 4
Add
ÅÅ4 7
(
ÅÅ7 8
new
ÅÅ8 ;
ParadasOrden
ÅÅ< H
(
ÅÅH I
$num
ÅÅI J
,
ÅÅJ K
$num
ÅÅL M
,
ÅÅM N
rota
ÅÅO S
.
ÅÅS T
latitud
ÅÅT [
,
ÅÅ[ \
rota
ÅÅ] a
.
ÅÅa b
logintud
ÅÅb j
)
ÅÅj k
)
ÅÅk l
;
ÅÅl m
List
ÇÇ, 0
<
ÇÇ0 1
CheckpointOrden
ÇÇ1 @
>
ÇÇ@ A
checkpointOrdens
ÇÇB R
=
ÇÇS T
new
ÇÇU X
List
ÇÇY ]
<
ÇÇ] ^
CheckpointOrden
ÇÇ^ m
>
ÇÇm n
(
ÇÇn o
)
ÇÇo p
;
ÇÇp q
var
ÉÉ, /
checkTimeControl
ÉÉ0 @
=
ÉÉA B
checkpoints
ÉÉC N
.
ÉÉN O
Where
ÉÉO T
(
ÉÉT U
x
ÉÉU V
=>
ÉÉW Y
x
ÉÉZ [
.
ÉÉ[ \
idCheckpoint
ÉÉ\ h
==
ÉÉi k
timeControl
ÉÉl w
.
ÉÉw x
idCheckpointÉÉx Ñ
)ÉÉÑ Ö
.ÉÉÖ Ü
FirstOrDefaultÉÉÜ î
(ÉÉî ï
)ÉÉï ñ
;ÉÉñ ó
var
ÑÑ, /%
routeCercanaTimeControl
ÑÑ0 G
=
ÑÑH I
routes
ÑÑJ P
.
ÑÑP Q
OrderBy
ÑÑQ X
(
ÑÑX Y
(
ÑÑY Z
route
ÑÑZ _
=>
ÑÑ` b
muestraRutasMapas
ÑÑc t
.
ÑÑt u)
CalcularDistanciaHaversineÑÑu è
(ÑÑè ê
(
ÖÖ0 1
decimal
ÖÖ1 8
)
ÖÖ8 9
checkTimeControl
ÖÖ9 I
.
ÖÖI J
latitud
ÖÖJ Q
,
ÖÖQ R
(
ÜÜ0 1
decimal
ÜÜ1 8
)
ÜÜ8 9
checkTimeControl
ÜÜ9 I
.
ÜÜI J
longitud
ÜÜJ R
,
ÜÜR S
route
áá0 5
.
áá5 6
latitud
áá6 =
,
áá= >
route
àà0 5
.
àà5 6
logintud
àà6 >
)
àà> ?
)
àà? @
)
àà@ A
;
ààA B
var
ââ, /
routeTimeControl
ââ0 @
=
ââA B%
routeCercanaTimeControl
ââC Z
.
ââZ [
FirstOrDefault
ââ[ i
(
ââi j
)
ââj k
;
ââk l
var
ää, /(
checkOrdendesdeRutaInicial
ää0 J
=
ääK L
checkpoints
ääM X
.
ãã4 5
OrderBy
ãã5 <
(
ãã< =
route
ãã= B
=>
ããC E
muestraRutasMapas
ããF W
.
ããW X(
CalcularDistanciaHaversine
ããX r
(
ããr s
(
åå8 9
decimal
åå9 @
)
åå@ A
routeTimeControl
ååA Q
.
ååQ R
latitud
ååR Y
,
ååY Z
(
çç8 9
decimal
çç9 @
)
çç@ A
routeTimeControl
ççA Q
.
ççQ R
logintud
ççR Z
,
ççZ [
route
éé8 =
.
éé= >
latitud
éé> E
,
ééE F
route
èè8 =
.
èè= >
longitud
èè> F
)
èèF G
)
èèG H
.
êê4 5
ToList
êê5 ;
(
êê; <
)
êê< =
;
êê= >
var
ëë, /
primeraParada
ëë0 =
=
ëë> ?
checkpoints
ëë@ K
.
ëëK L
FirstOrDefault
ëëL Z
(
ëëZ [
r
ëë[ \
=>
ëë] _
r
ëë` a
.
ëëa b
status
ëëb h
==
ëëi k
$num
ëël m
)
ëëm n
;
ëën o
var
íí, /
paradasOrder
íí0 <
=
íí= >
paradas
íí? F
.
ííF G
OrderBy
ííG N
(
ííN O
route
ííO T
=>
ííU W
muestraRutasMapas
ííX i
.
ííi j)
CalcularDistanciaHaversineííj Ñ
(ííÑ Ö
(
ìì0 1
decimal
ìì1 8
)
ìì8 9
primeraParada
ìì9 F
.
ììF G
latitud
ììG N
,
ììN O
(
îî0 1
decimal
îî1 8
)
îî8 9
primeraParada
îî9 F
.
îîF G
longitud
îîG O
,
îîO P
route
ïï0 5
.
ïï5 6
latitud
ïï6 =
,
ïï= >
route
ññ0 5
.
ññ5 6
longitud
ññ6 >
)
ññ> ?
)
ññ? @
.
ññ@ A
ToList
ññA G
(
ññG H
)
ññH I
;
ññI J
var
óó, /

checkOrder
óó0 :
=
óó; <
new
óó= @
List
óóA E
<
óóE F

Checkpoint
óóF P
>
óóP Q
(
óóQ R
)
óóR S
;
óóS T
if
òò, .
(
òò/ 0
primeraParada
òò0 =
!=
òò> @
null
òòA E
)
òòE F
{
ôô, -

checkOrder
öö0 :
=
öö; <
checkpoints
öö= H
.
õõ4 5
OrderBy
õõ5 <
(
õõ< =
route
õõ= B
=>
õõC E
muestraRutasMapas
õõF W
.
õõW X(
CalcularDistanciaHaversine
õõX r
(
õõr s
(
úú8 9
decimal
úú9 @
)
úú@ A
primeraParada
úúA N
.
úúN O
latitud
úúO V
,
úúV W
(
ùù8 9
decimal
ùù9 @
)
ùù@ A
primeraParada
ùùA N
.
ùùN O
longitud
ùùO W
,
ùùW X
route
ûû8 =
.
ûû= >
latitud
ûû> E
,
ûûE F
route
üü8 =
.
üü= >
longitud
üü> F
)
üüF G
)
üüG H
.
††4 5
ToList
††5 ;
(
††; <
)
††< =
;
††= >
}
°°, -
int
¢¢, /

countorder
¢¢0 :
=
¢¢; <
$num
¢¢= >
;
¢¢> ?
foreach
££, 3
(
££4 5
var
££5 8
item5
££9 >
in
££? A

checkOrder
££B L
)
££L M
{
§§, -

countorder
••0 :
++
••: <
;
••< =
checkpointOrdens
¶¶0 @
.
¶¶@ A
Add
¶¶A D
(
¶¶D E
new
¶¶E H
CheckpointOrden
¶¶I X
(
¶¶X Y
item5
¶¶Y ^
.
¶¶^ _
idCheckpoint
¶¶_ k
,
¶¶k l

countorder
¶¶m w
)
¶¶w x
)
¶¶x y
;
¶¶y z
}
ßß, -
CheckpointOrden
®®, ;
final
®®< A
=
®®B C
new
®®D G
CheckpointOrden
®®H W
(
®®W X
)
®®X Y
;
®®Y Z
CheckpointOrden
®®[ j
inicio
®®k q
=
®®r s
new
®®t w
CheckpointOrden®®x á
(®®á à
)®®à â
;®®â ä
List
©©, 0
<
©©0 1

Checkpoint
©©1 ;
>
©©; <
ParadasAnteriores
©©= N
=
©©O P
new
©©Q T
List
©©U Y
<
©©Y Z

Checkpoint
©©Z d
>
©©d e
(
©©e f
)
©©f g
;
©©g h
List
™™, 0
<
™™0 1
CheckNumRoute
™™1 >
>
™™> ?
checkNumRoutes
™™@ N
=
™™O P
new
™™Q T
List
™™U Y
<
™™Y Z
CheckNumRoute
™™Z g
>
™™g h
(
™™h i
)
™™i j
;
™™j k
foreach
´´, 3
(
´´4 5
var
´´5 8
c
´´9 :
in
´´; =
checkpointOrdens
´´> N
)
´´N O
{
¨¨, -
var
≠≠0 3
parada
≠≠4 :
=
≠≠; <
checkpoints
≠≠= H
.
≠≠H I
Where
≠≠I N
(
≠≠N O
x
≠≠O P
=>
≠≠Q S
x
≠≠T U
.
≠≠U V
idCheckpoint
≠≠V b
==
≠≠c e
c
≠≠f g
.
≠≠g h
idCheckpoint
≠≠h t
)
≠≠t u
.
≠≠u v
FirstOrDefault≠≠v Ñ
(≠≠Ñ Ö
)≠≠Ö Ü
;≠≠Ü á
if
ÆÆ0 2
(
ÆÆ3 4
c
ÆÆ4 5
.
ÆÆ5 6
idCheckpoint
ÆÆ6 B
==
ÆÆC E
checkTimeControl
ÆÆF V
.
ÆÆV W
idCheckpoint
ÆÆW c
)
ÆÆc d
inicio
ØØ4 :
=
ØØ; <
c
ØØ= >
;
ØØ> ?
ParadasAnteriores
∞∞0 A
.
∞∞A B
Add
∞∞B E
(
∞∞E F
parada
∞∞F L
)
∞∞L M
;
∞∞M N
}
±±, -
foreach
≤≤, 3
(
≤≤4 5
var
≤≤5 8
para
≤≤9 =
in
≤≤> @
checkpoints
≤≤A L
)
≤≤L M
{
≥≥, -
var
¥¥0 3
paraNumPoint
¥¥4 @
=
¥¥A B
routes
¥¥C I
.
µµ4 5
OrderBy
µµ5 <
(
µµ< =
route
µµ= B
=>
µµC E
muestraRutasMapas
µµF W
.
µµW X(
CalcularDistanciaHaversine
µµX r
(
µµr s
(
∂∂8 9
decimal
∂∂9 @
)
∂∂@ A
para
∂∂A E
.
∂∂E F
latitud
∂∂F M
,
∂∂M N
(
∑∑8 9
decimal
∑∑9 @
)
∑∑@ A
para
∑∑A E
.
∑∑E F
longitud
∑∑F N
,
∑∑N O
route
∏∏8 =
.
∏∏= >
latitud
∏∏> E
,
∏∏E F
route
ππ8 =
.
ππ= >
logintud
ππ> F
)
ππF G
)
ππG H
.
∫∫4 5
ToList
∫∫5 ;
(
∫∫; <
)
∫∫< =
;
∫∫= >
var
ªª0 3 
primerParaNumPoint
ªª4 F
=
ªªG H
paraNumPoint
ªªI U
.
ªªU V
FirstOrDefault
ªªV d
(
ªªd e
)
ªªe f
;
ªªf g
checkNumRoutes
ºº0 >
.
ºº> ?
Add
ºº? B
(
ººB C
new
ººC F
CheckNumRoute
ººG T
(
ººT U
para
ººU Y
.
ººY Z
idCheckpoint
ººZ f
,
ººf g
(
ººh i
int
ººi l
)
ººl m 
primerParaNumPoint
ººm 
.ºº Ä
numPointººÄ à
)ººà â
)ººâ ä
;ººä ã
}
ΩΩ, -
var
ææ, /

finalCheck
ææ0 :
=
ææ; <
checkNumRoutes
ææ= K
.
øø0 1
Where
øø1 6
(
øø6 7
x
øø7 8
=>
øø9 ;
x
øø< =
.
øø= >
numPoint
øø> F
>
øøG H
item3
øøI N
.
øøN O
inicio
øøO U
)
øøU V
.
¿¿0 1
OrderBy
¿¿1 8
(
¿¿8 9
x
¿¿9 :
=>
¿¿; =
x
¿¿> ?
.
¿¿? @
numPoint
¿¿@ H
)
¿¿H I
.
¡¡0 1
FirstOrDefault
¡¡1 ?
(
¡¡? @
)
¡¡@ A
;
¡¡A B
final
¬¬, 1
=
¬¬2 3
checkpointOrdens
¬¬4 D
.
¬¬D E
Where
¬¬E J
(
¬¬J K
x
¬¬K L
=>
¬¬M O
x
¬¬P Q
.
¬¬Q R
idCheckpoint
¬¬R ^
==
¬¬_ a

finalCheck
¬¬b l
.
¬¬l m
idCheckpoint
¬¬m y
)
¬¬y z
.
¬¬z {
FirstOrDefault¬¬{ â
(¬¬â ä
)¬¬ä ã
;¬¬ã å
var
√√, /
inicioCheck
√√0 ;
=
√√< =
checkNumRoutes
√√> L
.
ƒƒ, -
Where
ƒƒ- 2
(
ƒƒ2 3
x
ƒƒ3 4
=>
ƒƒ5 7
x
ƒƒ8 9
.
ƒƒ9 :
numPoint
ƒƒ: B
<=
ƒƒC E
item3
ƒƒF K
.
ƒƒK L
inicio
ƒƒL R
)
ƒƒR S
.
≈≈, -
OrderByDescending
≈≈- >
(
≈≈> ?
x
≈≈? @
=>
≈≈A C
x
≈≈D E
.
≈≈E F
numPoint
≈≈F N
)
≈≈N O
.
∆∆, -
FirstOrDefault
∆∆- ;
(
∆∆; <
)
∆∆< =
;
∆∆= >
var
««, /
inicioC
««0 7
=
««8 9
checkpointOrdens
««: J
.
««J K
Where
««K P
(
««P Q
x
««Q R
=>
««S U
x
««V W
.
««W X
idCheckpoint
««X d
==
««e g

finalCheck
««h r
.
««r s
idCheckpoint
««s 
)«« Ä
.««Ä Å
FirstOrDefault««Å è
(««è ê
)««ê ë
;««ë í
var
»», /"
numInicioTimeControl
»»0 D
=
»»E F
checkpointOrdens
»»G W
.
»»W X
Where
»»X ]
(
»»] ^
x
»»^ _
=>
»»` b
x
»»c d
.
»»d e
idCheckpoint
»»e q
==
»»r t
timeControl»»u Ä
.»»Ä Å
idCheckpoint»»Å ç
)»»ç é
.»»é è
FirstOrDefault»»è ù
(»»ù û
)»»û ü
;»»ü †
if
——, .
(
——/ 0
inicio
——0 6
.
——6 7
orden
——7 <
+
——= >
$num
——? @
==
——A C
final
——D I
.
——I J
orden
——J O
)
——O P
{
““, -
var
””0 3
routesInicioFinal
””4 E
=
””F G
routes
””H N
.
””N O
Where
””O T
(
””T U
item2
””U Z
=>
””[ ]
item2
””^ c
.
””c d
numPoint
””d l
>=
””m o
inicioCheck
””p {
.
””{ |
numPoint””| Ñ
&&””Ö á
item2””à ç
.””ç é
numPoint””é ñ
<=””ó ô

finalCheck””ö §
.””§ •
numPoint””• ≠
)””≠ Æ
.””Æ Ø
ToList””Ø µ
(””µ ∂
)””∂ ∑
;””∑ ∏
for
’’0 3
(
’’4 5
int
’’5 8
l
’’9 :
=
’’; <
$num
’’= >
;
’’> ?
l
’’@ A
<
’’B C
routesInicioFinal
’’D U
.
’’U V
Count
’’V [
(
’’[ \
)
’’\ ]
-
’’^ _
$num
’’` a
;
’’a b
l
’’c d
++
’’d f
)
’’f g
{
÷÷0 1
var
◊◊4 7
calc
◊◊8 <
=
◊◊= >
muestraRutasMapas
◊◊? P
.
◊◊P Q(
CalcularDistanciaHaversine
◊◊Q k
(
◊◊k l
(
ÿÿ4 5
decimal
ÿÿ5 <
)
ÿÿ< =
routesInicioFinal
ÿÿ= N
[
ÿÿN O
l
ÿÿO P
]
ÿÿP Q
.
ÿÿQ R
latitud
ÿÿR Y
,
ÿÿY Z
(
ŸŸ4 5
decimal
ŸŸ5 <
)
ŸŸ< =
routesInicioFinal
ŸŸ= N
[
ŸŸN O
l
ŸŸO P
]
ŸŸP Q
.
ŸŸQ R
logintud
ŸŸR Z
,
ŸŸZ [
routesInicioFinal
⁄⁄4 E
[
⁄⁄E F
l
⁄⁄F G
+
⁄⁄H I
$num
⁄⁄J K
]
⁄⁄K L
.
⁄⁄L M
latitud
⁄⁄M T
,
⁄⁄T U
routesInicioFinal
€€4 E
[
€€E F
l
€€F G
+
€€H I
$num
€€J K
]
€€K L
.
€€L M
logintud
€€M U
)
€€U V
;
€€V W
	kmTotales
‹‹4 =
=
‹‹> ?
	kmTotales
‹‹@ I
+
‹‹J K
calc
‹‹L P
;
‹‹P Q
}
››0 1
routesInicioFinal
ﬁﬁ0 A
=
ﬁﬁB C
routes
ﬁﬁD J
.
ﬁﬁJ K
Where
ﬁﬁK P
(
ﬁﬁP Q
item2
ﬁﬁQ V
=>
ﬁﬁW Y
item2
ﬁﬁZ _
.
ﬁﬁ_ `
numPoint
ﬁﬁ` h
>=
ﬁﬁi k
inicioCheck
ﬁﬁl w
.
ﬁﬁw x
numPointﬁﬁx Ä
&&ﬁﬁÅ É
item2ﬁﬁÑ â
.ﬁﬁâ ä
numPointﬁﬁä í
<=ﬁﬁì ï
item3ﬁﬁñ õ
.ﬁﬁõ ú
inicioﬁﬁú ¢
)ﬁﬁ¢ £
.ﬁﬁ£ §
ToListﬁﬁ§ ™
(ﬁﬁ™ ´
)ﬁﬁ´ ¨
;ﬁﬁ¨ ≠
for
ﬂﬂ0 3
(
ﬂﬂ4 5
int
ﬂﬂ5 8
l
ﬂﬂ9 :
=
ﬂﬂ; <
$num
ﬂﬂ= >
;
ﬂﬂ> ?
l
ﬂﬂ@ A
<
ﬂﬂB C
routesInicioFinal
ﬂﬂD U
.
ﬂﬂU V
Count
ﬂﬂV [
(
ﬂﬂ[ \
)
ﬂﬂ\ ]
-
ﬂﬂ^ _
$num
ﬂﬂ` a
;
ﬂﬂa b
l
ﬂﬂc d
++
ﬂﬂd f
)
ﬂﬂf g
{
‡‡0 1
var
··4 7
calc
··8 <
=
··= >
muestraRutasMapas
··? P
.
··P Q(
CalcularDistanciaHaversine
··Q k
(
··k l
(
‚‚4 5
decimal
‚‚5 <
)
‚‚< =
routesInicioFinal
‚‚= N
[
‚‚N O
l
‚‚O P
]
‚‚P Q
.
‚‚Q R
latitud
‚‚R Y
,
‚‚Y Z
(
„„4 5
decimal
„„5 <
)
„„< =
routesInicioFinal
„„= N
[
„„N O
l
„„O P
]
„„P Q
.
„„Q R
logintud
„„R Z
,
„„Z [
routesInicioFinal
‰‰4 E
[
‰‰E F
l
‰‰F G
+
‰‰H I
$num
‰‰J K
]
‰‰K L
.
‰‰L M
latitud
‰‰M T
,
‰‰T U
routesInicioFinal
ÂÂ4 E
[
ÂÂE F
l
ÂÂF G
+
ÂÂH I
$num
ÂÂJ K
]
ÂÂK L
.
ÂÂL M
logintud
ÂÂM U
)
ÂÂU V
;
ÂÂV W
km
ÊÊ4 6
=
ÊÊ7 8
km
ÊÊ9 ;
+
ÊÊ< =
calc
ÊÊ> B
;
ÊÊB C
}
ÁÁ0 1
for
ËË0 3
(
ËË4 5
int
ËË5 8
i
ËË9 :
=
ËË; <
inicio
ËË= C
.
ËËC D
orden
ËËD I
-
ËËJ K
$num
ËËL M
;
ËËM N
i
ËËO P
<
ËËQ R
final
ËËS X
.
ËËX Y
orden
ËËY ^
-
ËË_ `
$num
ËËa b
;
ËËb c
i
ËËd e
++
ËËe g
)
ËËg h
{
ÈÈ0 1
if
ÍÍ4 6
(
ÍÍ7 8
DateTime
ÍÍ8 @
.
ÍÍ@ A
Parse
ÍÍA F
(
ÍÍF G
timeControl
ÍÍG R
.
ÍÍR S
dateRegister
ÍÍS _
.
ÍÍ_ `
ToString
ÍÍ` h
(
ÍÍh i
)
ÍÍi j
)
ÍÍj k
.
ÍÍk l
	DayOfWeek
ÍÍl u
==
ÍÍv x
	DayOfWeekÍÍy Ç
.ÍÍÇ É
	WednesdayÍÍÉ å
||ÍÍç è
DateTimeÍÍê ò
.ÍÍò ô
ParseÍÍô û
(ÍÍû ü
timeControlÍÍü ™
.ÍÍ™ ´
dateRegisterÍÍ´ ∑
.ÍÍ∑ ∏
ToStringÍÍ∏ ¿
(ÍÍ¿ ¡
)ÍÍ¡ ¬
)ÍÍ¬ √
.ÍÍ√ ƒ
	DayOfWeekÍÍƒ Õ
==ÍÍŒ –
	DayOfWeekÍÍ— ⁄
.ÍÍ⁄ €
SaturdayÍÍ€ „
)ÍÍ„ ‰
{
ÎÎ4 5
string
ÏÏ8 >
[
ÏÏ> ?
]
ÏÏ? @
calcularMinutes
ÏÏA P
=
ÏÏQ R
ParadasAnteriores
ÏÏS d
[
ÏÏd e
i
ÏÏe f
+
ÏÏg h
$num
ÏÏi j
]
ÏÏj k
.
ÏÏk l
minArrivalMarket
ÏÏl |
.
ÏÏ| }
SplitÏÏ} Ç
(ÏÏÇ É
$charÏÏÉ Ü
)ÏÏÜ á
;ÏÏá à
int
ÌÌ8 ;
hour
ÌÌ< @
=
ÌÌA B
int
ÌÌC F
.
ÌÌF G
Parse
ÌÌG L
(
ÌÌL M
calcularMinutes
ÌÌM \
[
ÌÌ\ ]
$num
ÌÌ] ^
]
ÌÌ^ _
)
ÌÌ_ `
;
ÌÌ` a
int
ÓÓ8 ;
minute
ÓÓ< B
=
ÓÓC D
int
ÓÓE H
.
ÓÓH I
Parse
ÓÓI N
(
ÓÓN O
calcularMinutes
ÓÓO ^
[
ÓÓ^ _
$num
ÓÓ_ `
]
ÓÓ` a
)
ÓÓa b
;
ÓÓb c
minutes
ÔÔ8 ?
=
ÔÔ@ A
minutes
ÔÔB I
+
ÔÔJ K
hour
ÔÔL P
*
ÔÔQ R
$num
ÔÔS U
+
ÔÔV W
minute
ÔÔX ^
;
ÔÔ^ _
}
ÒÒ4 5
else
ÚÚ4 8
{
ÛÛ4 5
string
ÙÙ8 >
[
ÙÙ> ?
]
ÙÙ? @
calcularMinutes
ÙÙA P
=
ÙÙQ R
ParadasAnteriores
ÙÙS d
[
ÙÙd e
i
ÙÙe f
+
ÙÙg h
$num
ÙÙi j
]
ÙÙj k
.
ÙÙk l

minArrival
ÙÙl v
.
ÙÙv w
Split
ÙÙw |
(
ÙÙ| }
$charÙÙ} Ä
)ÙÙÄ Å
;ÙÙÅ Ç
int
ıı8 ;
hour
ıı< @
=
ııA B
int
ııC F
.
ııF G
Parse
ııG L
(
ııL M
calcularMinutes
ııM \
[
ıı\ ]
$num
ıı] ^
]
ıı^ _
)
ıı_ `
;
ıı` a
int
ˆˆ8 ;
minute
ˆˆ< B
=
ˆˆC D
int
ˆˆE H
.
ˆˆH I
Parse
ˆˆI N
(
ˆˆN O
calcularMinutes
ˆˆO ^
[
ˆˆ^ _
$num
ˆˆ_ `
]
ˆˆ` a
)
ˆˆa b
;
ˆˆb c
minutes
˜˜8 ?
=
˜˜@ A
minutes
˜˜B I
+
˜˜J K
hour
˜˜L P
*
˜˜Q R
$num
˜˜S U
+
˜˜V W
minute
˜˜X ^
;
˜˜^ _
}
¯¯4 5
}
˘˘0 1
TimeSpan
˙˙0 8

diferencia
˙˙9 C
=
˙˙D E
boliviaTime
˙˙F Q
.
˙˙Q R
Subtract
˙˙R Z
(
˙˙Z [
DateTime
˙˙[ c
.
˙˙c d
Parse
˙˙d i
(
˙˙i j
timeControl
˙˙j u
.
˙˙u v
dateRegister˙˙v Ç
.˙˙Ç É
ToString˙˙É ã
(˙˙ã å
)˙˙å ç
)˙˙ç é
)˙˙é è
;˙˙è ê
int
˚˚0 3*
minutesDiferenciaComparacion
˚˚4 P
=
˚˚Q R
(
˚˚S T
int
˚˚T W
)
˚˚W X

diferencia
˚˚X b
.
˚˚b c
TotalMinutes
˚˚c o
;
˚˚o p
	kmTotales
¸¸0 9
=
¸¸: ;
Math
¸¸< @
.
¸¸@ A
Round
¸¸A F
(
¸¸F G
	kmTotales
¸¸G P
,
¸¸P Q
$num
¸¸R S
)
¸¸S T
;
¸¸T U
km
˝˝0 2
=
˝˝3 4
Math
˝˝5 9
.
˝˝9 :
Round
˝˝: ?
(
˝˝? @
km
˝˝@ B
,
˝˝B C
$num
˝˝D E
)
˝˝E F
;
˝˝F G
int
˛˛0 3
res
˛˛4 7
=
˛˛8 9
(
˛˛: ;
int
˛˛; >
)
˛˛> ?
(
˛˛? @
minutes
˛˛@ G
*
˛˛H I
km
˛˛J L
/
˛˛M N
	kmTotales
˛˛O X
)
˛˛X Y
;
˛˛Y Z
var
ÄÄ0 3
chofer
ÄÄ4 :
=
ÄÄ; <
context
ÄÄ= D
.
ÄÄD E
Person
ÄÄE K
.
ÄÄK L
Where
ÄÄL Q
(
ÄÄQ R
x
ÄÄR S
=>
ÄÄT V
x
ÄÄW X
.
ÄÄX Y
nit
ÄÄY \
==
ÄÄ] _
item
ÄÄ` d
.
ÄÄd e

idEmployee
ÄÄe o
)
ÄÄo p
.
ÄÄp q
FirstOrDefault
ÄÄq 
(ÄÄ Ä
)ÄÄÄ Å
;ÄÄÅ Ç
if
ÅÅ0 2
(
ÅÅ3 4*
minutesDiferenciaComparacion
ÅÅ4 P
<
ÅÅQ R
res
ÅÅS V
)
ÅÅV W
{
ÇÇ0 1
List
ÉÉ4 8
<
ÉÉ8 9
Star
ÉÉ9 =
>
ÉÉ= >
stars
ÉÉ? D
=
ÉÉE F
new
ÉÉG J
List
ÉÉK O
<
ÉÉO P
Star
ÉÉP T
>
ÉÉT U
(
ÉÉU V
)
ÉÉV W
;
ÉÉW X
stars
ÑÑ4 9
=
ÑÑ: ;
context
ÑÑ< C
.
ÑÑC D
Star
ÑÑD H
.
ÑÑH I
Where
ÑÑI N
(
ÑÑN O
x
ÑÑO P
=>
ÑÑQ S
x
ÑÑT U
.
ÑÑU V

idEmployee
ÑÑV `
==
ÑÑa c
item
ÑÑd h
.
ÑÑh i

idEmployee
ÑÑi s
)
ÑÑs t
.
ÑÑt u
ToList
ÑÑu {
(
ÑÑ{ |
)
ÑÑ| }
;
ÑÑ} ~
var
ÖÖ4 7
star
ÖÖ8 <
=
ÖÖ= >
stars
ÖÖ? D
.
ÖÖD E
Where
ÖÖE J
(
ÖÖJ K
x
ÖÖK L
=>
ÖÖM O
DateTime
ÖÖP X
.
ÖÖX Y
Parse
ÖÖY ^
(
ÖÖ^ _
x
ÖÖ_ `
.
ÖÖ` a
dateRegister
ÖÖa m
.
ÖÖm n
ToString
ÖÖn v
(
ÖÖv w
)
ÖÖw x
)
ÖÖx y
.
ÖÖy z
Month
ÖÖz 
==ÖÖÄ Ç
boliviaTimeÖÖÉ é
.ÖÖé è
MonthÖÖè î
&&ÖÖï ó
DateTimeÖÖò †
.ÖÖ† °
ParseÖÖ° ¶
(ÖÖ¶ ß
xÖÖß ®
.ÖÖ® ©
dateRegisterÖÖ© µ
.ÖÖµ ∂
ToStringÖÖ∂ æ
(ÖÖæ ø
)ÖÖø ¿
)ÖÖ¿ ¡
.ÖÖ¡ ¬
YearÖÖ¬ ∆
==ÖÖ« …
boliviaTimeÖÖ  ’
.ÖÖ’ ÷
YearÖÖ÷ ⁄
)ÖÖ⁄ €
.ÖÖ€ ‹
ToListÖÖ‹ ‚
(ÖÖ‚ „
)ÖÖ„ ‰
;ÖÖ‰ Â
double
ÜÜ4 :
start
ÜÜ; @
=
ÜÜA B
$num
ÜÜC D
;
ÜÜD E
if
áá4 6
(
áá7 8
stars
áá8 =
.
áá= >
Count
áá> C
>
ááD E
$num
ááF G
)
ááG H
{
àà4 5
int
ââ8 ;

countstars
ââ< F
=
ââG H
$num
ââI J
;
ââJ K
foreach
ää8 ?
(
ää@ A
var
ääA D
st
ääE G
in
ääH J
star
ääK O
)
ääO P
{
ãã8 9

countstars
åå< F
++
ååF H
;
ååH I
start
çç< A
=
ççB C
start
ççD I
+
ççJ K
double
ççL R
.
ççR S
Parse
ççS X
(
ççX Y
st
ççY [
.
çç[ \
numStar
çç\ c
.
ççc d
ToString
ççd l
(
ççl m
)
ççm n
)
ççn o
;
çço p
}
éé8 9
start
èè8 =
=
èè> ?
Math
èè@ D
.
èèD E
Round
èèE J
(
èèJ K
start
èèK P
/
èèQ R

countstars
èèS ]
,
èè] ^
$num
èè_ `
)
èè` a
;
èèa b
}
êê4 5
int
ëë4 7
result
ëë8 >
=
ëë? @
res
ëëA D
-
ëëE F*
minutesDiferenciaComparacion
ëëG c
;
ëëc d 
choferesTiempoAuxi
íí4 F
.
ííF G
Add
ííG J
(
ííJ K
new
ííK N 
ChoferesTiempoAuxi
ííO a
(
íía b
chofer
ííb h
.
ííh i
name
ííi m
+
íín o
$str
ííp s
+
íít u
chofer
íív |
.
íí| }
lastnameíí} Ö
+ííÜ á
$strííà å
+ííç é
startííè î
+ííï ñ
$strííó ö
+ííõ ú
$strííù ¨
+íí≠ Æ
resultííØ µ
,ííµ ∂
resultíí∑ Ω
)ííΩ æ
)ííæ ø
;ííø ¿
}
ìì0 1
}
îî, -
else
ïï, 0
if
ïï1 3
(
ïï4 5
inicio
ïï5 ;
.
ïï; <
orden
ïï< A
<
ïïB C
final
ïïD I
.
ïïI J
orden
ïïJ O
)
ïïO P
{
ññ, -
var
òò0 3
routesInicioFinal
òò4 E
=
òòF G
routes
òòH N
.
òòN O
Where
òòO T
(
òòT U
item2
òòU Z
=>
òò[ ]
item2
òò^ c
.
òòc d
numPoint
òòd l
>=
òòm o
inicioCheck
òòp {
.
òò{ |
numPointòò| Ñ
&&òòÖ á
item2òòà ç
.òòç é
numPointòòé ñ
<=òòó ô

finalCheckòòö §
.òò§ •
numPointòò• ≠
)òò≠ Æ
.òòÆ Ø
ToListòòØ µ
(òòµ ∂
)òò∂ ∑
;òò∑ ∏
for
öö0 3
(
öö4 5
int
öö5 8
l
öö9 :
=
öö; <
$num
öö= >
;
öö> ?
l
öö@ A
<
ööB C
routesInicioFinal
ööD U
.
ööU V
Count
ööV [
(
öö[ \
)
öö\ ]
-
öö^ _
$num
öö` a
;
ööa b
l
ööc d
++
ööd f
)
ööf g
{
õõ0 1
var
úú4 7
calc
úú8 <
=
úú= >
muestraRutasMapas
úú? P
.
úúP Q(
CalcularDistanciaHaversine
úúQ k
(
úúk l
(
ùù4 5
decimal
ùù5 <
)
ùù< =
routesInicioFinal
ùù= N
[
ùùN O
l
ùùO P
]
ùùP Q
.
ùùQ R
latitud
ùùR Y
,
ùùY Z
(
ûû4 5
decimal
ûû5 <
)
ûû< =
routesInicioFinal
ûû= N
[
ûûN O
l
ûûO P
]
ûûP Q
.
ûûQ R
logintud
ûûR Z
,
ûûZ [
routesInicioFinal
üü4 E
[
üüE F
l
üüF G
+
üüH I
$num
üüJ K
]
üüK L
.
üüL M
latitud
üüM T
,
üüT U
routesInicioFinal
††4 E
[
††E F
l
††F G
+
††H I
$num
††J K
]
††K L
.
††L M
logintud
††M U
)
††U V
;
††V W
	kmTotales
°°4 =
=
°°> ?
	kmTotales
°°@ I
+
°°J K
calc
°°L P
;
°°P Q
}
¢¢0 1
routesInicioFinal
££0 A
=
££B C
routes
££D J
.
££J K
Where
££K P
(
££P Q
item2
££Q V
=>
££W Y
item2
££Z _
.
££_ `
numPoint
££` h
>=
££i k
inicioCheck
££l w
.
££w x
numPoint££x Ä
&&££Å É
item2££Ñ â
.££â ä
numPoint££ä í
<=££ì ï
item3££ñ õ
.££õ ú
inicio££ú ¢
)££¢ £
.£££ §
ToList££§ ™
(££™ ´
)££´ ¨
;££¨ ≠
for
§§0 3
(
§§4 5
int
§§5 8
l
§§9 :
=
§§; <
$num
§§= >
;
§§> ?
l
§§@ A
<
§§B C
routesInicioFinal
§§D U
.
§§U V
Count
§§V [
(
§§[ \
)
§§\ ]
-
§§^ _
$num
§§` a
;
§§a b
l
§§c d
++
§§d f
)
§§f g
{
••0 1
var
¶¶4 7
calc
¶¶8 <
=
¶¶= >
muestraRutasMapas
¶¶? P
.
¶¶P Q(
CalcularDistanciaHaversine
¶¶Q k
(
¶¶k l
(
ßß4 5
decimal
ßß5 <
)
ßß< =
routesInicioFinal
ßß= N
[
ßßN O
l
ßßO P
]
ßßP Q
.
ßßQ R
latitud
ßßR Y
,
ßßY Z
(
®®4 5
decimal
®®5 <
)
®®< =
routesInicioFinal
®®= N
[
®®N O
l
®®O P
]
®®P Q
.
®®Q R
logintud
®®R Z
,
®®Z [
routesInicioFinal
©©4 E
[
©©E F
l
©©F G
+
©©H I
$num
©©J K
]
©©K L
.
©©L M
latitud
©©M T
,
©©T U
routesInicioFinal
™™4 E
[
™™E F
l
™™F G
+
™™H I
$num
™™J K
]
™™K L
.
™™L M
logintud
™™M U
)
™™U V
;
™™V W
km
´´4 6
=
´´7 8
km
´´9 ;
+
´´< =
calc
´´> B
;
´´B C
}
¨¨0 1
for
≠≠0 3
(
≠≠4 5
int
≠≠5 8
i
≠≠9 :
=
≠≠; <
final
≠≠= B
.
≠≠B C
orden
≠≠C H
-
≠≠I J
$num
≠≠K L
;
≠≠L M
i
≠≠N O
<
≠≠P Q
final
≠≠R W
.
≠≠W X
orden
≠≠X ]
-
≠≠^ _
$num
≠≠` a
;
≠≠a b
i
≠≠c d
++
≠≠d f
)
≠≠f g
{
ÆÆ0 1
if
ØØ4 6
(
ØØ7 8
DateTime
ØØ8 @
.
ØØ@ A
Parse
ØØA F
(
ØØF G
timeControl
ØØG R
.
ØØR S
dateRegister
ØØS _
.
ØØ_ `
ToString
ØØ` h
(
ØØh i
)
ØØi j
)
ØØj k
.
ØØk l
	DayOfWeek
ØØl u
==
ØØv x
	DayOfWeekØØy Ç
.ØØÇ É
	WednesdayØØÉ å
||ØØç è
DateTimeØØê ò
.ØØò ô
ParseØØô û
(ØØû ü
timeControlØØü ™
.ØØ™ ´
dateRegisterØØ´ ∑
.ØØ∑ ∏
ToStringØØ∏ ¿
(ØØ¿ ¡
)ØØ¡ ¬
)ØØ¬ √
.ØØ√ ƒ
	DayOfWeekØØƒ Õ
==ØØŒ –
	DayOfWeekØØ— ⁄
.ØØ⁄ €
SaturdayØØ€ „
)ØØ„ ‰
{
∞∞4 5
string
±±8 >
[
±±> ?
]
±±? @
calcularMinutes
±±A P
=
±±Q R
ParadasAnteriores
±±S d
[
±±d e
i
±±e f
+
±±g h
$num
±±i j
]
±±j k
.
±±k l
minArrivalMarket
±±l |
.
±±| }
Split±±} Ç
(±±Ç É
$char±±É Ü
)±±Ü á
;±±á à
int
≤≤8 ;
hour
≤≤< @
=
≤≤A B
int
≤≤C F
.
≤≤F G
Parse
≤≤G L
(
≤≤L M
calcularMinutes
≤≤M \
[
≤≤\ ]
$num
≤≤] ^
]
≤≤^ _
)
≤≤_ `
;
≤≤` a
int
≥≥8 ;
minute
≥≥< B
=
≥≥C D
int
≥≥E H
.
≥≥H I
Parse
≥≥I N
(
≥≥N O
calcularMinutes
≥≥O ^
[
≥≥^ _
$num
≥≥_ `
]
≥≥` a
)
≥≥a b
;
≥≥b c
minutes
¥¥8 ?
=
¥¥@ A
minutes
¥¥B I
+
¥¥J K
hour
¥¥L P
*
¥¥Q R
$num
¥¥S U
+
¥¥V W
minute
¥¥X ^
;
¥¥^ _
}
∂∂4 5
else
∑∑4 8
{
∏∏4 5
string
ππ8 >
[
ππ> ?
]
ππ? @
calcularMinutes
ππA P
=
ππQ R
ParadasAnteriores
ππS d
[
ππd e
i
ππe f
+
ππg h
$num
ππi j
]
ππj k
.
ππk l

minArrival
ππl v
.
ππv w
Split
ππw |
(
ππ| }
$charππ} Ä
)ππÄ Å
;ππÅ Ç
int
∫∫8 ;
hour
∫∫< @
=
∫∫A B
int
∫∫C F
.
∫∫F G
Parse
∫∫G L
(
∫∫L M
calcularMinutes
∫∫M \
[
∫∫\ ]
$num
∫∫] ^
]
∫∫^ _
)
∫∫_ `
;
∫∫` a
int
ªª8 ;
minute
ªª< B
=
ªªC D
int
ªªE H
.
ªªH I
Parse
ªªI N
(
ªªN O
calcularMinutes
ªªO ^
[
ªª^ _
$num
ªª_ `
]
ªª` a
)
ªªa b
;
ªªb c
minutes
ºº8 ?
=
ºº@ A
minutes
ººB I
+
ººJ K
hour
ººL P
*
ººQ R
$num
ººS U
+
ººV W
minute
ººX ^
;
ºº^ _
}
ΩΩ4 5
}
ææ0 1
TimeSpan
øø0 8

diferencia
øø9 C
=
øøD E
boliviaTime
øøF Q
.
øøQ R
Subtract
øøR Z
(
øøZ [
DateTime
øø[ c
.
øøc d
Parse
øød i
(
øøi j
timeControl
øøj u
.
øøu v
dateRegisterøøv Ç
.øøÇ É
ToStringøøÉ ã
(øøã å
)øøå ç
)øøç é
)øøé è
;øøè ê
int
¿¿0 3*
minutesDiferenciaComparacion
¿¿4 P
=
¿¿Q R
(
¿¿S T
int
¿¿T W
)
¿¿W X

diferencia
¿¿X b
.
¿¿b c
TotalMinutes
¿¿c o
;
¿¿o p
	kmTotales
¡¡0 9
=
¡¡: ;
Math
¡¡< @
.
¡¡@ A
Round
¡¡A F
(
¡¡F G
	kmTotales
¡¡G P
,
¡¡P Q
$num
¡¡R S
)
¡¡S T
;
¡¡T U
km
¬¬0 2
=
¬¬3 4
Math
¬¬5 9
.
¬¬9 :
Round
¬¬: ?
(
¬¬? @
km
¬¬@ B
,
¬¬B C
$num
¬¬D E
)
¬¬E F
;
¬¬F G
int
√√0 3
res
√√4 7
=
√√8 9
(
√√: ;
int
√√; >
)
√√> ?
(
√√? @
minutes
√√@ G
*
√√H I
km
√√J L
/
√√M N
	kmTotales
√√O X
)
√√X Y
;
√√Y Z
var
ƒƒ0 3
chofer
ƒƒ4 :
=
ƒƒ; <
context
ƒƒ= D
.
ƒƒD E
Person
ƒƒE K
.
ƒƒK L
Where
ƒƒL Q
(
ƒƒQ R
x
ƒƒR S
=>
ƒƒT V
x
ƒƒW X
.
ƒƒX Y
nit
ƒƒY \
==
ƒƒ] _
item
ƒƒ` d
.
ƒƒd e

idEmployee
ƒƒe o
)
ƒƒo p
.
ƒƒp q
FirstOrDefault
ƒƒq 
(ƒƒ Ä
)ƒƒÄ Å
;ƒƒÅ Ç
int
≈≈0 3
time
≈≈4 8
=
≈≈9 :
$num
≈≈; <
;
≈≈< =
for
««0 3
(
««4 5
int
««5 8
i
««9 :
=
««; <"
numInicioTimeControl
««= Q
.
««Q R
orden
««R W
-
««X Y
$num
««Z [
;
««[ \
i
««] ^
<
««_ `
final
««a f
.
««f g
orden
««g l
-
««m n
$num
««o p
;
««p q
i
««r s
++
««s u
)
««u v
{
»»0 1
if
……4 6
(
……7 8
DateTime
……8 @
.
……@ A
Parse
……A F
(
……F G
timeControl
……G R
.
……R S
dateRegister
……S _
.
……_ `
ToString
……` h
(
……h i
)
……i j
)
……j k
.
……k l
	DayOfWeek
……l u
==
……v x
	DayOfWeek……y Ç
.……Ç É
	Wednesday……É å
||……ç è
DateTime……ê ò
.……ò ô
Parse……ô û
(……û ü
timeControl……ü ™
.……™ ´
dateRegister……´ ∑
.……∑ ∏
ToString……∏ ¿
(……¿ ¡
)……¡ ¬
)……¬ √
.……√ ƒ
	DayOfWeek……ƒ Õ
==……Œ –
	DayOfWeek……— ⁄
.……⁄ €
Saturday……€ „
)……„ ‰
{
  4 5
string
ÀÀ8 >
[
ÀÀ> ?
]
ÀÀ? @
calcularMinutes
ÀÀA P
=
ÀÀQ R
ParadasAnteriores
ÀÀS d
[
ÀÀd e
i
ÀÀe f
+
ÀÀg h
$num
ÀÀi j
]
ÀÀj k
.
ÀÀk l
minArrivalMarket
ÀÀl |
.
ÀÀ| }
SplitÀÀ} Ç
(ÀÀÇ É
$charÀÀÉ Ü
)ÀÀÜ á
;ÀÀá à
int
ÃÃ8 ;
hour
ÃÃ< @
=
ÃÃA B
int
ÃÃC F
.
ÃÃF G
Parse
ÃÃG L
(
ÃÃL M
calcularMinutes
ÃÃM \
[
ÃÃ\ ]
$num
ÃÃ] ^
]
ÃÃ^ _
)
ÃÃ_ `
;
ÃÃ` a
int
ÕÕ8 ;
minute
ÕÕ< B
=
ÕÕC D
int
ÕÕE H
.
ÕÕH I
Parse
ÕÕI N
(
ÕÕN O
calcularMinutes
ÕÕO ^
[
ÕÕ^ _
$num
ÕÕ_ `
]
ÕÕ` a
)
ÕÕa b
;
ÕÕb c
time
ŒŒ8 <
=
ŒŒ= >
time
ŒŒ? C
+
ŒŒD E
hour
ŒŒF J
*
ŒŒK L
$num
ŒŒM O
+
ŒŒP Q
minute
ŒŒR X
;
ŒŒX Y
}
––4 5
else
——4 8
{
““4 5
string
””8 >
[
””> ?
]
””? @
calcularMinutes
””A P
=
””Q R
ParadasAnteriores
””S d
[
””d e
i
””e f
+
””g h
$num
””i j
]
””j k
.
””k l

minArrival
””l v
.
””v w
Split
””w |
(
””| }
$char””} Ä
)””Ä Å
;””Å Ç
int
‘‘8 ;
hour
‘‘< @
=
‘‘A B
int
‘‘C F
.
‘‘F G
Parse
‘‘G L
(
‘‘L M
calcularMinutes
‘‘M \
[
‘‘\ ]
$num
‘‘] ^
]
‘‘^ _
)
‘‘_ `
;
‘‘` a
int
’’8 ;
minute
’’< B
=
’’C D
int
’’E H
.
’’H I
Parse
’’I N
(
’’N O
calcularMinutes
’’O ^
[
’’^ _
$num
’’_ `
]
’’` a
)
’’a b
;
’’b c
time
÷÷8 <
=
÷÷= >
time
÷÷? C
+
÷÷D E
hour
÷÷F J
*
÷÷K L
$num
÷÷M O
+
÷÷P Q
minute
÷÷R X
;
÷÷X Y
}
◊◊4 5
}
ÿÿ0 1
res
ŸŸ0 3
=
ŸŸ4 5
time
ŸŸ6 :
+
ŸŸ; <
res
ŸŸ= @
;
ŸŸ@ A
if
⁄⁄0 2
(
⁄⁄3 4*
minutesDiferenciaComparacion
⁄⁄4 P
<
⁄⁄Q R
res
⁄⁄S V
)
⁄⁄V W
{
€€0 1
List
‹‹4 8
<
‹‹8 9
Star
‹‹9 =
>
‹‹= >
stars
‹‹? D
=
‹‹E F
new
‹‹G J
List
‹‹K O
<
‹‹O P
Star
‹‹P T
>
‹‹T U
(
‹‹U V
)
‹‹V W
;
‹‹W X
stars
››4 9
=
››: ;
context
››< C
.
››C D
Star
››D H
.
››H I
Where
››I N
(
››N O
x
››O P
=>
››Q S
x
››T U
.
››U V

idEmployee
››V `
==
››a c
item
››d h
.
››h i

idEmployee
››i s
)
››s t
.
››t u
ToList
››u {
(
››{ |
)
››| }
;
››} ~
var
ﬁﬁ4 7
star
ﬁﬁ8 <
=
ﬁﬁ= >
stars
ﬁﬁ? D
.
ﬁﬁD E
Where
ﬁﬁE J
(
ﬁﬁJ K
x
ﬁﬁK L
=>
ﬁﬁM O
DateTime
ﬁﬁP X
.
ﬁﬁX Y
Parse
ﬁﬁY ^
(
ﬁﬁ^ _
x
ﬁﬁ_ `
.
ﬁﬁ` a
dateRegister
ﬁﬁa m
.
ﬁﬁm n
ToString
ﬁﬁn v
(
ﬁﬁv w
)
ﬁﬁw x
)
ﬁﬁx y
.
ﬁﬁy z
Month
ﬁﬁz 
==ﬁﬁÄ Ç
boliviaTimeﬁﬁÉ é
.ﬁﬁé è
Monthﬁﬁè î
&&ﬁﬁï ó
DateTimeﬁﬁò †
.ﬁﬁ† °
Parseﬁﬁ° ¶
(ﬁﬁ¶ ß
xﬁﬁß ®
.ﬁﬁ® ©
dateRegisterﬁﬁ© µ
.ﬁﬁµ ∂
ToStringﬁﬁ∂ æ
(ﬁﬁæ ø
)ﬁﬁø ¿
)ﬁﬁ¿ ¡
.ﬁﬁ¡ ¬
Yearﬁﬁ¬ ∆
==ﬁﬁ« …
boliviaTimeﬁﬁ  ’
.ﬁﬁ’ ÷
Yearﬁﬁ÷ ⁄
)ﬁﬁ⁄ €
.ﬁﬁ€ ‹
ToListﬁﬁ‹ ‚
(ﬁﬁ‚ „
)ﬁﬁ„ ‰
;ﬁﬁ‰ Â
double
ﬂﬂ4 :
start
ﬂﬂ; @
=
ﬂﬂA B
$num
ﬂﬂC D
;
ﬂﬂD E
if
‡‡4 6
(
‡‡7 8
stars
‡‡8 =
.
‡‡= >
Count
‡‡> C
>
‡‡D E
$num
‡‡F G
)
‡‡G H
{
··4 5
int
‚‚8 ;

countstars
‚‚< F
=
‚‚G H
$num
‚‚I J
;
‚‚J K
foreach
„„8 ?
(
„„@ A
var
„„A D
st
„„E G
in
„„H J
star
„„K O
)
„„O P
{
‰‰8 9

countstars
ÂÂ< F
++
ÂÂF H
;
ÂÂH I
start
ÊÊ< A
=
ÊÊB C
start
ÊÊD I
+
ÊÊJ K
double
ÊÊL R
.
ÊÊR S
Parse
ÊÊS X
(
ÊÊX Y
st
ÊÊY [
.
ÊÊ[ \
numStar
ÊÊ\ c
.
ÊÊc d
ToString
ÊÊd l
(
ÊÊl m
)
ÊÊm n
)
ÊÊn o
;
ÊÊo p
}
ÁÁ8 9
start
ËË8 =
=
ËË> ?
Math
ËË@ D
.
ËËD E
Round
ËËE J
(
ËËJ K
start
ËËK P
/
ËËQ R

countstars
ËËS ]
,
ËË] ^
$num
ËË_ `
)
ËË` a
;
ËËa b
}
ÈÈ4 5
int
ÍÍ4 7
result
ÍÍ8 >
=
ÍÍ? @
res
ÍÍA D
-
ÍÍE F*
minutesDiferenciaComparacion
ÍÍG c
;
ÍÍc d 
choferesTiempoAuxi
ÎÎ4 F
.
ÎÎF G
Add
ÎÎG J
(
ÎÎJ K
new
ÎÎK N 
ChoferesTiempoAuxi
ÎÎO a
(
ÎÎa b
chofer
ÎÎb h
.
ÎÎh i
name
ÎÎi m
+
ÎÎn o
$str
ÎÎp s
+
ÎÎt u
chofer
ÎÎv |
.
ÎÎ| }
lastnameÎÎ} Ö
+ÎÎÜ á
$strÎÎà å
+ÎÎç é
startÎÎè î
+ÎÎï ñ
$strÎÎó ö
+ÎÎõ ú
$strÎÎù ¨
+ÎÎ≠ Æ
resultÎÎØ µ
,ÎÎµ ∂
resultÎÎ∑ Ω
)ÎÎΩ æ
)ÎÎæ ø
;ÎÎø ¿
}
ÏÏ0 1
}
ÌÌ, -
}
ÓÓ( )
}
$ %
}
ÒÒ  !
else
ÚÚ  $
{
ÛÛ  !
var
ÙÙ$ '
timeControls
ÙÙ( 4
=
ÙÙ5 6
context
ÙÙ7 >
.
ÙÙ> ?
TimeControl
ÙÙ? J
.
ıı$ %
Where
ıı% *
(
ıı* +
x
ıı+ ,
=>
ıı- /
x
ıı0 1
.
ıı1 2

idEmployee
ıı2 <
==
ıı= ?
item
ıı@ D
.
ııD E

idEmployee
ııE O
&&
ııP R
x
ııS T
.
ııT U
dateRegister
ııU a
.
ııa b
HasValue
ııb j
&&
ıık m
(
ıın o
x
ııo p
.
ııp q
enable
ııq w
==
ııx z
$num
ıı{ |
||
ıı} 
xııÄ Å
.ııÅ Ç
enableııÇ à
==ııâ ã
$numııå ç
)ııç é
)ııé è
.
ˆˆ$ %
AsEnumerable
ˆˆ% 1
(
ˆˆ1 2
)
ˆˆ2 3
.
˜˜$ %
OrderBy
˜˜% ,
(
˜˜, -
x
˜˜- .
=>
˜˜/ 1
Math
˜˜2 6
.
˜˜6 7
Abs
˜˜7 :
(
˜˜: ;
(
˜˜; <
x
˜˜< =
.
˜˜= >
dateRegister
˜˜> J
.
˜˜J K
Value
˜˜K P
-
˜˜Q R
boliviaTime
˜˜S ^
)
˜˜^ _
.
˜˜_ `
TotalSeconds
˜˜` l
)
˜˜l m
)
˜˜m n
.
¯¯$ %
ToList
¯¯% +
(
¯¯+ ,
)
¯¯, -
;
¯¯- .
var
˘˘$ '
timeControl
˘˘( 3
=
˘˘4 5
timeControls
˘˘6 B
.
˘˘B C
FirstOrDefault
˘˘C Q
(
˘˘Q R
)
˘˘R S
;
˘˘S T
if
˚˚$ &
(
˚˚' (
timeControl
˚˚( 3
!=
˚˚4 6
null
˚˚7 ;
)
˚˚; <
{
¸¸$ %
var
˝˝( +
tim
˝˝, /
=
˝˝0 1
context
˝˝2 9
.
˝˝9 :

Checkpoint
˝˝: D
.
˝˝D E
Where
˝˝E J
(
˝˝J K
x
˝˝K L
=>
˝˝M O
x
˝˝P Q
.
˝˝Q R
idCheckpoint
˝˝R ^
==
˝˝_ a
timeControl
˝˝b m
.
˝˝m n
idCheckpoint
˝˝n z
&&
˝˝{ }
x
˝˝~ 
.˝˝ Ä
numberRoute˝˝Ä ã
==˝˝å é
item3˝˝è î
.˝˝î ï
numType˝˝ï ú
)˝˝ú ù
.˝˝ù û
FirstOrDefault˝˝û ¨
(˝˝¨ ≠
)˝˝≠ Æ
;˝˝Æ Ø
if
˛˛( *
(
˛˛+ ,
tim
˛˛, /
!=
˛˛0 2
null
˛˛3 7
)
˛˛7 8
{
ˇˇ( )
var
Ä	Ä	, /
paradas
Ä	Ä	0 7
=
Ä	Ä	8 9
new
Ä	Ä	: =
List
Ä	Ä	> B
<
Ä	Ä	B C
ParadasOrden
Ä	Ä	C O
>
Ä	Ä	O P
(
Ä	Ä	P Q
)
Ä	Ä	Q R
;
Ä	Ä	R S
foreach
Å	Å	, 3
(
Å	Å	4 5
var
Å	Å	5 8
paradass
Å	Å	9 A
in
Å	Å	B D
checkpoints
Å	Å	E P
)
Å	Å	P Q
{
Ç	Ç	, -
paradas
É	É	0 7
.
É	É	7 8
Add
É	É	8 ;
(
É	É	; <
new
É	É	< ?
ParadasOrden
É	É	@ L
(
É	É	L M
paradass
É	É	M U
.
É	É	U V
idCheckpoint
É	É	V b
,
É	É	b c
paradass
É	É	d l
.
É	É	l m
status
É	É	m s
,
É	É	s t
paradass
É	É	u }
.
É	É	} ~
latitudÉ	É	~ Ö
,É	É	Ö Ü
paradassÉ	É	á è
.É	É	è ê
longitudÉ	É	ê ò
)É	É	ò ô
)É	É	ô ö
;É	É	ö õ
}
Ñ	Ñ	, -
var
Ö	Ö	, /
rota
Ö	Ö	0 4
=
Ö	Ö	5 6
context
Ö	Ö	7 >
.
Ö	Ö	> ?
Route
Ö	Ö	? D
.
Ö	Ö	D E
Where
Ö	Ö	E J
(
Ö	Ö	J K
x
Ö	Ö	K L
=>
Ö	Ö	M O
x
Ö	Ö	P Q
.
Ö	Ö	Q R
numberRoute
Ö	Ö	R ]
==
Ö	Ö	^ `
item3
Ö	Ö	a f
.
Ö	Ö	f g
numRuta
Ö	Ö	g n
&&
Ö	Ö	o q
x
Ö	Ö	r s
.
Ö	Ö	s t
numPoint
Ö	Ö	t |
==
Ö	Ö	} 
item3Ö	Ö	Ä Ö
.Ö	Ö	Ö Ü
inicioÖ	Ö	Ü å
)Ö	Ö	å ç
.Ö	Ö	ç é
FirstOrDefaultÖ	Ö	é ú
(Ö	Ö	ú ù
)Ö	Ö	ù û
;Ö	Ö	û ü
paradas
Ü	Ü	, 3
.
Ü	Ü	3 4
Add
Ü	Ü	4 7
(
Ü	Ü	7 8
new
Ü	Ü	8 ;
ParadasOrden
Ü	Ü	< H
(
Ü	Ü	H I
$num
Ü	Ü	I J
,
Ü	Ü	J K
$num
Ü	Ü	L M
,
Ü	Ü	M N
rota
Ü	Ü	O S
.
Ü	Ü	S T
latitud
Ü	Ü	T [
,
Ü	Ü	[ \
rota
Ü	Ü	] a
.
Ü	Ü	a b
logintud
Ü	Ü	b j
)
Ü	Ü	j k
)
Ü	Ü	k l
;
Ü	Ü	l m
List
á	á	, 0
<
á	á	0 1
CheckpointOrden
á	á	1 @
>
á	á	@ A
checkpointOrdens
á	á	B R
=
á	á	S T
new
á	á	U X
List
á	á	Y ]
<
á	á	] ^
CheckpointOrden
á	á	^ m
>
á	á	m n
(
á	á	n o
)
á	á	o p
;
á	á	p q
var
à	à	, /
checkTimeControl
à	à	0 @
=
à	à	A B
checkpoints
à	à	C N
.
à	à	N O
Where
à	à	O T
(
à	à	T U
x
à	à	U V
=>
à	à	W Y
x
à	à	Z [
.
à	à	[ \
idCheckpoint
à	à	\ h
==
à	à	i k
timeControl
à	à	l w
.
à	à	w x
idCheckpointà	à	x Ñ
)à	à	Ñ Ö
.à	à	Ö Ü
FirstOrDefaultà	à	Ü î
(à	à	î ï
)à	à	ï ñ
;à	à	ñ ó
var
â	â	, /%
routeCercanaTimeControl
â	â	0 G
=
â	â	H I
routes
â	â	J P
.
â	â	P Q
OrderBy
â	â	Q X
(
â	â	X Y
(
â	â	Y Z
route
â	â	Z _
=>
â	â	` b
muestraRutasMapas
â	â	c t
.
â	â	t u)
CalcularDistanciaHaversineâ	â	u è
(â	â	è ê
(
ä	ä	0 1
decimal
ä	ä	1 8
)
ä	ä	8 9
checkTimeControl
ä	ä	9 I
.
ä	ä	I J
latitud
ä	ä	J Q
,
ä	ä	Q R
(
ã	ã	0 1
decimal
ã	ã	1 8
)
ã	ã	8 9
checkTimeControl
ã	ã	9 I
.
ã	ã	I J
longitud
ã	ã	J R
,
ã	ã	R S
route
å	å	0 5
.
å	å	5 6
latitud
å	å	6 =
,
å	å	= >
route
ç	ç	0 5
.
ç	ç	5 6
logintud
ç	ç	6 >
)
ç	ç	> ?
)
ç	ç	? @
)
ç	ç	@ A
;
ç	ç	A B
var
é	é	, /
routeTimeControl
é	é	0 @
=
é	é	A B%
routeCercanaTimeControl
é	é	C Z
.
é	é	Z [
FirstOrDefault
é	é	[ i
(
é	é	i j
)
é	é	j k
;
é	é	k l
var
è	è	, /(
checkOrdendesdeRutaInicial
è	è	0 J
=
è	è	K L
checkpoints
è	è	M X
.
ê	ê	4 5
OrderBy
ê	ê	5 <
(
ê	ê	< =
route
ê	ê	= B
=>
ê	ê	C E
muestraRutasMapas
ê	ê	F W
.
ê	ê	W X(
CalcularDistanciaHaversine
ê	ê	X r
(
ê	ê	r s
(
ë	ë	8 9
decimal
ë	ë	9 @
)
ë	ë	@ A
routeTimeControl
ë	ë	A Q
.
ë	ë	Q R
latitud
ë	ë	R Y
,
ë	ë	Y Z
(
í	í	8 9
decimal
í	í	9 @
)
í	í	@ A
routeTimeControl
í	í	A Q
.
í	í	Q R
logintud
í	í	R Z
,
í	í	Z [
route
ì	ì	8 =
.
ì	ì	= >
latitud
ì	ì	> E
,
ì	ì	E F
route
î	î	8 =
.
î	î	= >
longitud
î	î	> F
)
î	î	F G
)
î	î	G H
.
ï	ï	4 5
ToList
ï	ï	5 ;
(
ï	ï	; <
)
ï	ï	< =
;
ï	ï	= >
var
ñ	ñ	, /$
checkAnteriorPosterior
ñ	ñ	0 F
=
ñ	ñ	G H
new
ñ	ñ	I L
List
ñ	ñ	M Q
<
ñ	ñ	Q R

Checkpoint
ñ	ñ	R \
>
ñ	ñ	\ ]
(
ñ	ñ	] ^
)
ñ	ñ	^ _
;
ñ	ñ	_ `$
checkAnteriorPosterior
ó	ó	, B
.
ó	ó	B C
Add
ó	ó	C F
(
ó	ó	F G(
checkOrdendesdeRutaInicial
ó	ó	G a
[
ó	ó	a b
$num
ó	ó	b c
]
ó	ó	c d
)
ó	ó	d e
;
ó	ó	e f$
checkAnteriorPosterior
ò	ò	, B
.
ò	ò	B C
Add
ò	ò	C F
(
ò	ò	F G(
checkOrdendesdeRutaInicial
ò	ò	G a
[
ò	ò	a b
$num
ò	ò	b c
]
ò	ò	c d
)
ò	ò	d e
;
ò	ò	e f
var
ô	ô	, /
primeraParada
ô	ô	0 =
=
ô	ô	> ?
checkpoints
ô	ô	@ K
.
ô	ô	K L
FirstOrDefault
ô	ô	L Z
(
ô	ô	Z [
r
ô	ô	[ \
=>
ô	ô	] _
r
ô	ô	` a
.
ô	ô	a b
status
ô	ô	b h
==
ô	ô	i k
$num
ô	ô	l m
)
ô	ô	m n
;
ô	ô	n o
var
ö	ö	, /
paradasOrder
ö	ö	0 <
=
ö	ö	= >
paradas
ö	ö	? F
.
ö	ö	F G
OrderBy
ö	ö	G N
(
ö	ö	N O
route
ö	ö	O T
=>
ö	ö	U W
muestraRutasMapas
ö	ö	X i
.
ö	ö	i j)
CalcularDistanciaHaversineö	ö	j Ñ
(ö	ö	Ñ Ö
(
õ	õ	0 1
decimal
õ	õ	1 8
)
õ	õ	8 9
primeraParada
õ	õ	9 F
.
õ	õ	F G
latitud
õ	õ	G N
,
õ	õ	N O
(
ú	ú	0 1
decimal
ú	ú	1 8
)
ú	ú	8 9
primeraParada
ú	ú	9 F
.
ú	ú	F G
longitud
ú	ú	G O
,
ú	ú	O P
route
ù	ù	0 5
.
ù	ù	5 6
latitud
ù	ù	6 =
,
ù	ù	= >
route
û	û	0 5
.
û	û	5 6
longitud
û	û	6 >
)
û	û	> ?
)
û	û	? @
.
û	û	@ A
ToList
û	û	A G
(
û	û	G H
)
û	û	H I
;
û	û	I J
var
ü	ü	, /

checkOrder
ü	ü	0 :
=
ü	ü	; <
new
ü	ü	= @
List
ü	ü	A E
<
ü	ü	E F

Checkpoint
ü	ü	F P
>
ü	ü	P Q
(
ü	ü	Q R
)
ü	ü	R S
;
ü	ü	S T
if
†	†	, .
(
†	†	/ 0
primeraParada
†	†	0 =
!=
†	†	> @
null
†	†	A E
)
†	†	E F
{
°	°	, -

checkOrder
¢	¢	0 :
=
¢	¢	; <
checkpoints
¢	¢	= H
.
£	£	4 5
OrderBy
£	£	5 <
(
£	£	< =
route
£	£	= B
=>
£	£	C E
muestraRutasMapas
£	£	F W
.
£	£	W X(
CalcularDistanciaHaversine
£	£	X r
(
£	£	r s
(
§	§	8 9
decimal
§	§	9 @
)
§	§	@ A
primeraParada
§	§	A N
.
§	§	N O
latitud
§	§	O V
,
§	§	V W
(
•	•	8 9
decimal
•	•	9 @
)
•	•	@ A
primeraParada
•	•	A N
.
•	•	N O
longitud
•	•	O W
,
•	•	W X
route
¶	¶	8 =
.
¶	¶	= >
latitud
¶	¶	> E
,
¶	¶	E F
route
ß	ß	8 =
.
ß	ß	= >
longitud
ß	ß	> F
)
ß	ß	F G
)
ß	ß	G H
.
®	®	4 5
ToList
®	®	5 ;
(
®	®	; <
)
®	®	< =
;
®	®	= >
}
©	©	, -
int
™	™	, /

countorder
™	™	0 :
=
™	™	; <
$num
™	™	= >
;
™	™	> ?
foreach
´	´	, 3
(
´	´	4 5
var
´	´	5 8
item5
´	´	9 >
in
´	´	? A

checkOrder
´	´	B L
)
´	´	L M
{
¨	¨	, -

countorder
≠	≠	0 :
++
≠	≠	: <
;
≠	≠	< =
checkpointOrdens
Æ	Æ	0 @
.
Æ	Æ	@ A
Add
Æ	Æ	A D
(
Æ	Æ	D E
new
Æ	Æ	E H
CheckpointOrden
Æ	Æ	I X
(
Æ	Æ	X Y
item5
Æ	Æ	Y ^
.
Æ	Æ	^ _
idCheckpoint
Æ	Æ	_ k
,
Æ	Æ	k l

countorder
Æ	Æ	m w
)
Æ	Æ	w x
)
Æ	Æ	x y
;
Æ	Æ	y z
}
Ø	Ø	, -
CheckpointOrden
∞	∞	, ;
final
∞	∞	< A
=
∞	∞	B C
new
∞	∞	D G
CheckpointOrden
∞	∞	H W
(
∞	∞	W X
)
∞	∞	X Y
;
∞	∞	Y Z
CheckpointOrden
∞	∞	[ j
inicio
∞	∞	k q
=
∞	∞	r s
new
∞	∞	t w
CheckpointOrden∞	∞	x á
(∞	∞	á à
)∞	∞	à â
;∞	∞	â ä
List
±	±	, 0
<
±	±	0 1

Checkpoint
±	±	1 ;
>
±	±	; <
ParadasAnteriores
±	±	= N
=
±	±	O P
new
±	±	Q T
List
±	±	U Y
<
±	±	Y Z

Checkpoint
±	±	Z d
>
±	±	d e
(
±	±	e f
)
±	±	f g
;
±	±	g h
List
≤	≤	, 0
<
≤	≤	0 1
CheckNumRoute
≤	≤	1 >
>
≤	≤	> ?
checkNumRoutes
≤	≤	@ N
=
≤	≤	O P
new
≤	≤	Q T
List
≤	≤	U Y
<
≤	≤	Y Z
CheckNumRoute
≤	≤	Z g
>
≤	≤	g h
(
≤	≤	h i
)
≤	≤	i j
;
≤	≤	j k
foreach
≥	≥	, 3
(
≥	≥	4 5
var
≥	≥	5 8
c
≥	≥	9 :
in
≥	≥	; =
checkpointOrdens
≥	≥	> N
)
≥	≥	N O
{
¥	¥	, -
var
µ	µ	0 3
parada
µ	µ	4 :
=
µ	µ	; <
checkpoints
µ	µ	= H
.
µ	µ	H I
Where
µ	µ	I N
(
µ	µ	N O
x
µ	µ	O P
=>
µ	µ	Q S
x
µ	µ	T U
.
µ	µ	U V
idCheckpoint
µ	µ	V b
==
µ	µ	c e
c
µ	µ	f g
.
µ	µ	g h
idCheckpoint
µ	µ	h t
)
µ	µ	t u
.
µ	µ	u v
FirstOrDefaultµ	µ	v Ñ
(µ	µ	Ñ Ö
)µ	µ	Ö Ü
;µ	µ	Ü á
if
∂	∂	0 2
(
∂	∂	3 4
c
∂	∂	4 5
.
∂	∂	5 6
idCheckpoint
∂	∂	6 B
==
∂	∂	C E
checkTimeControl
∂	∂	F V
.
∂	∂	V W
idCheckpoint
∂	∂	W c
)
∂	∂	c d
inicio
∑	∑	4 :
=
∑	∑	; <
c
∑	∑	= >
;
∑	∑	> ?
ParadasAnteriores
∏	∏	0 A
.
∏	∏	A B
Add
∏	∏	B E
(
∏	∏	E F
parada
∏	∏	F L
)
∏	∏	L M
;
∏	∏	M N
}
π	π	, -
foreach
∫	∫	, 3
(
∫	∫	4 5
var
∫	∫	5 8
para
∫	∫	9 =
in
∫	∫	> @
checkpoints
∫	∫	A L
)
∫	∫	L M
{
ª	ª	, -
var
º	º	0 3
paraNumPoint
º	º	4 @
=
º	º	A B
routes
º	º	C I
.
Ω	Ω	4 5
OrderBy
Ω	Ω	5 <
(
Ω	Ω	< =
route
Ω	Ω	= B
=>
Ω	Ω	C E
muestraRutasMapas
Ω	Ω	F W
.
Ω	Ω	W X(
CalcularDistanciaHaversine
Ω	Ω	X r
(
Ω	Ω	r s
(
æ	æ	8 9
decimal
æ	æ	9 @
)
æ	æ	@ A
para
æ	æ	A E
.
æ	æ	E F
latitud
æ	æ	F M
,
æ	æ	M N
(
ø	ø	8 9
decimal
ø	ø	9 @
)
ø	ø	@ A
para
ø	ø	A E
.
ø	ø	E F
longitud
ø	ø	F N
,
ø	ø	N O
route
¿	¿	8 =
.
¿	¿	= >
latitud
¿	¿	> E
,
¿	¿	E F
route
¡	¡	8 =
.
¡	¡	= >
logintud
¡	¡	> F
)
¡	¡	F G
)
¡	¡	G H
.
¬	¬	4 5
ToList
¬	¬	5 ;
(
¬	¬	; <
)
¬	¬	< =
;
¬	¬	= >
var
√	√	0 3 
primerParaNumPoint
√	√	4 F
=
√	√	G H
paraNumPoint
√	√	I U
.
√	√	U V
FirstOrDefault
√	√	V d
(
√	√	d e
)
√	√	e f
;
√	√	f g
checkNumRoutes
ƒ	ƒ	0 >
.
ƒ	ƒ	> ?
Add
ƒ	ƒ	? B
(
ƒ	ƒ	B C
new
ƒ	ƒ	C F
CheckNumRoute
ƒ	ƒ	G T
(
ƒ	ƒ	T U
para
ƒ	ƒ	U Y
.
ƒ	ƒ	Y Z
idCheckpoint
ƒ	ƒ	Z f
,
ƒ	ƒ	f g
(
ƒ	ƒ	h i
int
ƒ	ƒ	i l
)
ƒ	ƒ	l m 
primerParaNumPoint
ƒ	ƒ	m 
.ƒ	ƒ	 Ä
numPointƒ	ƒ	Ä à
)ƒ	ƒ	à â
)ƒ	ƒ	â ä
;ƒ	ƒ	ä ã
}
≈	≈	, -
var
∆	∆	, /

finalCheck
∆	∆	0 :
=
∆	∆	; <
checkNumRoutes
∆	∆	= K
.
«	«	0 1
Where
«	«	1 6
(
«	«	6 7
x
«	«	7 8
=>
«	«	9 ;
x
«	«	< =
.
«	«	= >
numPoint
«	«	> F
>
«	«	G H
item3
«	«	I N
.
«	«	N O
inicio
«	«	O U
)
«	«	U V
.
»	»	0 1
OrderBy
»	»	1 8
(
»	»	8 9
x
»	»	9 :
=>
»	»	; =
x
»	»	> ?
.
»	»	? @
numPoint
»	»	@ H
)
»	»	H I
.
…	…	0 1
FirstOrDefault
…	…	1 ?
(
…	…	? @
)
…	…	@ A
;
…	…	A B
final
 	 	, 1
=
 	 	2 3
checkpointOrdens
 	 	4 D
.
 	 	D E
Where
 	 	E J
(
 	 	J K
x
 	 	K L
=>
 	 	M O
x
 	 	P Q
.
 	 	Q R
idCheckpoint
 	 	R ^
==
 	 	_ a

finalCheck
 	 	b l
.
 	 	l m
idCheckpoint
 	 	m y
)
 	 	y z
.
 	 	z {
FirstOrDefault 	 	{ â
( 	 	â ä
) 	 	ä ã
; 	 	ã å
var
À	À	, /
inicioCheck
À	À	0 ;
=
À	À	< =
checkNumRoutes
À	À	> L
.
Ã	Ã	0 1
Where
Ã	Ã	1 6
(
Ã	Ã	6 7
x
Ã	Ã	7 8
=>
Ã	Ã	9 ;
x
Ã	Ã	< =
.
Ã	Ã	= >
numPoint
Ã	Ã	> F
<=
Ã	Ã	G I
item3
Ã	Ã	J O
.
Ã	Ã	O P
inicio
Ã	Ã	P V
)
Ã	Ã	V W
.
Õ	Õ	0 1
OrderByDescending
Õ	Õ	1 B
(
Õ	Õ	B C
x
Õ	Õ	C D
=>
Õ	Õ	E G
x
Õ	Õ	H I
.
Õ	Õ	I J
numPoint
Õ	Õ	J R
)
Õ	Õ	R S
.
Œ	Œ	0 1
FirstOrDefault
Œ	Œ	1 ?
(
Œ	Œ	? @
)
Œ	Œ	@ A
;
Œ	Œ	A B
var
œ	œ	, /
inicioC
œ	œ	0 7
=
œ	œ	8 9
checkpointOrdens
œ	œ	: J
.
œ	œ	J K
Where
œ	œ	K P
(
œ	œ	P Q
x
œ	œ	Q R
=>
œ	œ	S U
x
œ	œ	V W
.
œ	œ	W X
idCheckpoint
œ	œ	X d
==
œ	œ	e g

finalCheck
œ	œ	h r
.
œ	œ	r s
idCheckpoint
œ	œ	s 
)œ	œ	 Ä
.œ	œ	Ä Å
FirstOrDefaultœ	œ	Å è
(œ	œ	è ê
)œ	œ	ê ë
;œ	œ	ë í
var
–	–	, /"
numInicioTimeControl
–	–	0 D
=
–	–	E F
checkpointOrdens
–	–	G W
.
–	–	W X
Where
–	–	X ]
(
–	–	] ^
x
–	–	^ _
=>
–	–	` b
x
–	–	c d
.
–	–	d e
idCheckpoint
–	–	e q
==
–	–	r t
timeControl–	–	u Ä
.–	–	Ä Å
idCheckpoint–	–	Å ç
)–	–	ç é
.–	–	é è
FirstOrDefault–	–	è ù
(–	–	ù û
)–	–	û ü
;–	–	ü †
if
Ÿ	Ÿ	, .
(
Ÿ	Ÿ	/ 0
inicio
Ÿ	Ÿ	0 6
.
Ÿ	Ÿ	6 7
orden
Ÿ	Ÿ	7 <
+
Ÿ	Ÿ	= >
$num
Ÿ	Ÿ	? @
==
Ÿ	Ÿ	A C
final
Ÿ	Ÿ	D I
.
Ÿ	Ÿ	I J
orden
Ÿ	Ÿ	J O
)
Ÿ	Ÿ	O P
{
⁄	⁄	, -
var
€	€	0 3
routesInicioFinal
€	€	4 E
=
€	€	F G
routes
€	€	H N
.
€	€	N O
Where
€	€	O T
(
€	€	T U
item2
€	€	U Z
=>
€	€	[ ]
item2
€	€	^ c
.
€	€	c d
numPoint
€	€	d l
>=
€	€	m o
inicioCheck
€	€	p {
.
€	€	{ |
numPoint€	€	| Ñ
&&€	€	Ö á
item2€	€	à ç
.€	€	ç é
numPoint€	€	é ñ
<=€	€	ó ô

finalCheck€	€	ö §
.€	€	§ •
numPoint€	€	• ≠
)€	€	≠ Æ
.€	€	Æ Ø
ToList€	€	Ø µ
(€	€	µ ∂
)€	€	∂ ∑
;€	€	∑ ∏
for
›	›	0 3
(
›	›	4 5
int
›	›	5 8
l
›	›	9 :
=
›	›	; <
$num
›	›	= >
;
›	›	> ?
l
›	›	@ A
<
›	›	B C
routesInicioFinal
›	›	D U
.
›	›	U V
Count
›	›	V [
(
›	›	[ \
)
›	›	\ ]
-
›	›	^ _
$num
›	›	` a
;
›	›	a b
l
›	›	c d
++
›	›	d f
)
›	›	f g
{
ﬁ	ﬁ	0 1
var
ﬂ	ﬂ	4 7
calc
ﬂ	ﬂ	8 <
=
ﬂ	ﬂ	= >
muestraRutasMapas
ﬂ	ﬂ	? P
.
ﬂ	ﬂ	P Q(
CalcularDistanciaHaversine
ﬂ	ﬂ	Q k
(
ﬂ	ﬂ	k l
(
‡	‡	4 5
decimal
‡	‡	5 <
)
‡	‡	< =
routesInicioFinal
‡	‡	= N
[
‡	‡	N O
l
‡	‡	O P
]
‡	‡	P Q
.
‡	‡	Q R
latitud
‡	‡	R Y
,
‡	‡	Y Z
(
·	·	4 5
decimal
·	·	5 <
)
·	·	< =
routesInicioFinal
·	·	= N
[
·	·	N O
l
·	·	O P
]
·	·	P Q
.
·	·	Q R
logintud
·	·	R Z
,
·	·	Z [
routesInicioFinal
‚	‚	4 E
[
‚	‚	E F
l
‚	‚	F G
+
‚	‚	H I
$num
‚	‚	J K
]
‚	‚	K L
.
‚	‚	L M
latitud
‚	‚	M T
,
‚	‚	T U
routesInicioFinal
„	„	4 E
[
„	„	E F
l
„	„	F G
+
„	„	H I
$num
„	„	J K
]
„	„	K L
.
„	„	L M
logintud
„	„	M U
)
„	„	U V
;
„	„	V W
	kmTotales
‰	‰	4 =
=
‰	‰	> ?
	kmTotales
‰	‰	@ I
+
‰	‰	J K
calc
‰	‰	L P
;
‰	‰	P Q
}
Â	Â	0 1
routesInicioFinal
Ê	Ê	0 A
=
Ê	Ê	B C
routes
Ê	Ê	D J
.
Ê	Ê	J K
Where
Ê	Ê	K P
(
Ê	Ê	P Q
item2
Ê	Ê	Q V
=>
Ê	Ê	W Y
item2
Ê	Ê	Z _
.
Ê	Ê	_ `
numPoint
Ê	Ê	` h
>=
Ê	Ê	i k
inicioCheck
Ê	Ê	l w
.
Ê	Ê	w x
numPointÊ	Ê	x Ä
&&Ê	Ê	Å É
item2Ê	Ê	Ñ â
.Ê	Ê	â ä
numPointÊ	Ê	ä í
<=Ê	Ê	ì ï
item3Ê	Ê	ñ õ
.Ê	Ê	õ ú
inicioÊ	Ê	ú ¢
)Ê	Ê	¢ £
.Ê	Ê	£ §
ToListÊ	Ê	§ ™
(Ê	Ê	™ ´
)Ê	Ê	´ ¨
;Ê	Ê	¨ ≠
for
Á	Á	0 3
(
Á	Á	4 5
int
Á	Á	5 8
l
Á	Á	9 :
=
Á	Á	; <
$num
Á	Á	= >
;
Á	Á	> ?
l
Á	Á	@ A
<
Á	Á	B C
routesInicioFinal
Á	Á	D U
.
Á	Á	U V
Count
Á	Á	V [
(
Á	Á	[ \
)
Á	Á	\ ]
-
Á	Á	^ _
$num
Á	Á	` a
;
Á	Á	a b
l
Á	Á	c d
++
Á	Á	d f
)
Á	Á	f g
{
Ë	Ë	0 1
var
È	È	4 7
calc
È	È	8 <
=
È	È	= >
muestraRutasMapas
È	È	? P
.
È	È	P Q(
CalcularDistanciaHaversine
È	È	Q k
(
È	È	k l
(
Í	Í	4 5
decimal
Í	Í	5 <
)
Í	Í	< =
routesInicioFinal
Í	Í	= N
[
Í	Í	N O
l
Í	Í	O P
]
Í	Í	P Q
.
Í	Í	Q R
latitud
Í	Í	R Y
,
Í	Í	Y Z
(
Î	Î	4 5
decimal
Î	Î	5 <
)
Î	Î	< =
routesInicioFinal
Î	Î	= N
[
Î	Î	N O
l
Î	Î	O P
]
Î	Î	P Q
.
Î	Î	Q R
logintud
Î	Î	R Z
,
Î	Î	Z [
routesInicioFinal
Ï	Ï	4 E
[
Ï	Ï	E F
l
Ï	Ï	F G
+
Ï	Ï	H I
$num
Ï	Ï	J K
]
Ï	Ï	K L
.
Ï	Ï	L M
latitud
Ï	Ï	M T
,
Ï	Ï	T U
routesInicioFinal
Ì	Ì	4 E
[
Ì	Ì	E F
l
Ì	Ì	F G
+
Ì	Ì	H I
$num
Ì	Ì	J K
]
Ì	Ì	K L
.
Ì	Ì	L M
logintud
Ì	Ì	M U
)
Ì	Ì	U V
;
Ì	Ì	V W
km
Ó	Ó	4 6
=
Ó	Ó	7 8
km
Ó	Ó	9 ;
+
Ó	Ó	< =
calc
Ó	Ó	> B
;
Ó	Ó	B C
}
Ô	Ô	0 1
for
		0 3
(
		4 5
int
		5 8
i
		9 :
=
		; <
inicio
		= C
.
		C D
orden
		D I
-
		J K
$num
		L M
;
		M N
i
		O P
<
		Q R
final
		S X
.
		X Y
orden
		Y ^
-
		_ `
$num
		a b
;
		b c
i
		d e
++
		e g
)
		g h
{
Ò	Ò	0 1
if
Ú	Ú	4 6
(
Ú	Ú	7 8
DateTime
Ú	Ú	8 @
.
Ú	Ú	@ A
Parse
Ú	Ú	A F
(
Ú	Ú	F G
timeControl
Ú	Ú	G R
.
Ú	Ú	R S
dateRegister
Ú	Ú	S _
.
Ú	Ú	_ `
ToString
Ú	Ú	` h
(
Ú	Ú	h i
)
Ú	Ú	i j
)
Ú	Ú	j k
.
Ú	Ú	k l
	DayOfWeek
Ú	Ú	l u
==
Ú	Ú	v x
	DayOfWeekÚ	Ú	y Ç
.Ú	Ú	Ç É
	WednesdayÚ	Ú	É å
||Ú	Ú	ç è
DateTimeÚ	Ú	ê ò
.Ú	Ú	ò ô
ParseÚ	Ú	ô û
(Ú	Ú	û ü
timeControlÚ	Ú	ü ™
.Ú	Ú	™ ´
dateRegisterÚ	Ú	´ ∑
.Ú	Ú	∑ ∏
ToStringÚ	Ú	∏ ¿
(Ú	Ú	¿ ¡
)Ú	Ú	¡ ¬
)Ú	Ú	¬ √
.Ú	Ú	√ ƒ
	DayOfWeekÚ	Ú	ƒ Õ
==Ú	Ú	Œ –
	DayOfWeekÚ	Ú	— ⁄
.Ú	Ú	⁄ €
SaturdayÚ	Ú	€ „
)Ú	Ú	„ ‰
{
Û	Û	4 5
string
Ù	Ù	8 >
[
Ù	Ù	> ?
]
Ù	Ù	? @
calcularMinutes
Ù	Ù	A P
=
Ù	Ù	Q R
ParadasAnteriores
Ù	Ù	S d
[
Ù	Ù	d e
i
Ù	Ù	e f
]
Ù	Ù	f g
.
Ù	Ù	g h
minArrivalMarket
Ù	Ù	h x
.
Ù	Ù	x y
Split
Ù	Ù	y ~
(
Ù	Ù	~ 
$charÙ	Ù	 Ç
)Ù	Ù	Ç É
;Ù	Ù	É Ñ
int
ı	ı	8 ;
hour
ı	ı	< @
=
ı	ı	A B
int
ı	ı	C F
.
ı	ı	F G
Parse
ı	ı	G L
(
ı	ı	L M
calcularMinutes
ı	ı	M \
[
ı	ı	\ ]
$num
ı	ı	] ^
]
ı	ı	^ _
)
ı	ı	_ `
;
ı	ı	` a
int
ˆ	ˆ	8 ;
minute
ˆ	ˆ	< B
=
ˆ	ˆ	C D
int
ˆ	ˆ	E H
.
ˆ	ˆ	H I
Parse
ˆ	ˆ	I N
(
ˆ	ˆ	N O
calcularMinutes
ˆ	ˆ	O ^
[
ˆ	ˆ	^ _
$num
ˆ	ˆ	_ `
]
ˆ	ˆ	` a
)
ˆ	ˆ	a b
;
ˆ	ˆ	b c
minutes
˜	˜	8 ?
=
˜	˜	@ A
minutes
˜	˜	B I
+
˜	˜	J K
hour
˜	˜	L P
*
˜	˜	Q R
$num
˜	˜	S U
+
˜	˜	V W
minute
˜	˜	X ^
;
˜	˜	^ _
}
˘	˘	4 5
else
˙	˙	4 8
{
˚	˚	4 5
string
¸	¸	8 >
[
¸	¸	> ?
]
¸	¸	? @
calcularMinutes
¸	¸	A P
=
¸	¸	Q R
ParadasAnteriores
¸	¸	S d
[
¸	¸	d e
i
¸	¸	e f
]
¸	¸	f g
.
¸	¸	g h

minArrival
¸	¸	h r
.
¸	¸	r s
Split
¸	¸	s x
(
¸	¸	x y
$char
¸	¸	y |
)
¸	¸	| }
;
¸	¸	} ~
int
˝	˝	8 ;
hour
˝	˝	< @
=
˝	˝	A B
int
˝	˝	C F
.
˝	˝	F G
Parse
˝	˝	G L
(
˝	˝	L M
calcularMinutes
˝	˝	M \
[
˝	˝	\ ]
$num
˝	˝	] ^
]
˝	˝	^ _
)
˝	˝	_ `
;
˝	˝	` a
int
˛	˛	8 ;
minute
˛	˛	< B
=
˛	˛	C D
int
˛	˛	E H
.
˛	˛	H I
Parse
˛	˛	I N
(
˛	˛	N O
calcularMinutes
˛	˛	O ^
[
˛	˛	^ _
$num
˛	˛	_ `
]
˛	˛	` a
)
˛	˛	a b
;
˛	˛	b c
minutes
ˇ	ˇ	8 ?
=
ˇ	ˇ	@ A
minutes
ˇ	ˇ	B I
+
ˇ	ˇ	J K
hour
ˇ	ˇ	L P
*
ˇ	ˇ	Q R
$num
ˇ	ˇ	S U
+
ˇ	ˇ	V W
minute
ˇ	ˇ	X ^
;
ˇ	ˇ	^ _
}
Ä
Ä
4 5
}
Å
Å
0 1
TimeSpan
Ç
Ç
0 8

diferencia
Ç
Ç
9 C
=
Ç
Ç
D E
boliviaTime
Ç
Ç
F Q
.
Ç
Ç
Q R
Subtract
Ç
Ç
R Z
(
Ç
Ç
Z [
DateTime
Ç
Ç
[ c
.
Ç
Ç
c d
Parse
Ç
Ç
d i
(
Ç
Ç
i j
timeControl
Ç
Ç
j u
.
Ç
Ç
u v
dateRegisterÇ
Ç
v Ç
.Ç
Ç
Ç É
ToStringÇ
Ç
É ã
(Ç
Ç
ã å
)Ç
Ç
å ç
)Ç
Ç
ç é
)Ç
Ç
é è
;Ç
Ç
è ê
int
É
É
0 3*
minutesDiferenciaComparacion
É
É
4 P
=
É
É
Q R
(
É
É
S T
int
É
É
T W
)
É
É
W X

diferencia
É
É
X b
.
É
É
b c
TotalMinutes
É
É
c o
;
É
É
o p
	kmTotales
Ñ
Ñ
0 9
=
Ñ
Ñ
: ;
Math
Ñ
Ñ
< @
.
Ñ
Ñ
@ A
Round
Ñ
Ñ
A F
(
Ñ
Ñ
F G
	kmTotales
Ñ
Ñ
G P
,
Ñ
Ñ
P Q
$num
Ñ
Ñ
R S
)
Ñ
Ñ
S T
;
Ñ
Ñ
T U
km
Ö
Ö
0 2
=
Ö
Ö
3 4
Math
Ö
Ö
5 9
.
Ö
Ö
9 :
Round
Ö
Ö
: ?
(
Ö
Ö
? @
km
Ö
Ö
@ B
,
Ö
Ö
B C
$num
Ö
Ö
D E
)
Ö
Ö
E F
;
Ö
Ö
F G
int
Ü
Ü
0 3
res
Ü
Ü
4 7
=
Ü
Ü
8 9
(
Ü
Ü
: ;
int
Ü
Ü
; >
)
Ü
Ü
> ?
(
Ü
Ü
? @
minutes
Ü
Ü
@ G
*
Ü
Ü
H I
km
Ü
Ü
J L
/
Ü
Ü
M N
	kmTotales
Ü
Ü
O X
)
Ü
Ü
X Y
;
Ü
Ü
Y Z
var
á
á
0 3
chofer
á
á
4 :
=
á
á
; <
context
á
á
= D
.
á
á
D E
Person
á
á
E K
.
á
á
K L
Where
á
á
L Q
(
á
á
Q R
x
á
á
R S
=>
á
á
T V
x
á
á
W X
.
á
á
X Y
nit
á
á
Y \
==
á
á
] _
item
á
á
` d
.
á
á
d e

idEmployee
á
á
e o
)
á
á
o p
.
á
á
p q
FirstOrDefault
á
á
q 
(á
á
 Ä
)á
á
Ä Å
;á
á
Å Ç
if
à
à
0 2
(
à
à
3 4*
minutesDiferenciaComparacion
à
à
4 P
<
à
à
Q R
res
à
à
S V
)
à
à
V W
{
â
â
0 1
List
ä
ä
4 8
<
ä
ä
8 9
Star
ä
ä
9 =
>
ä
ä
= >
stars
ä
ä
? D
=
ä
ä
E F
new
ä
ä
G J
List
ä
ä
K O
<
ä
ä
O P
Star
ä
ä
P T
>
ä
ä
T U
(
ä
ä
U V
)
ä
ä
V W
;
ä
ä
W X
stars
ã
ã
4 9
=
ã
ã
: ;
context
ã
ã
< C
.
ã
ã
C D
Star
ã
ã
D H
.
ã
ã
H I
Where
ã
ã
I N
(
ã
ã
N O
x
ã
ã
O P
=>
ã
ã
Q S
x
ã
ã
T U
.
ã
ã
U V

idEmployee
ã
ã
V `
==
ã
ã
a c
item
ã
ã
d h
.
ã
ã
h i

idEmployee
ã
ã
i s
)
ã
ã
s t
.
ã
ã
t u
ToList
ã
ã
u {
(
ã
ã
{ |
)
ã
ã
| }
;
ã
ã
} ~
var
å
å
4 7
star
å
å
8 <
=
å
å
= >
stars
å
å
? D
.
å
å
D E
Where
å
å
E J
(
å
å
J K
x
å
å
K L
=>
å
å
M O
DateTime
å
å
P X
.
å
å
X Y
Parse
å
å
Y ^
(
å
å
^ _
x
å
å
_ `
.
å
å
` a
dateRegister
å
å
a m
.
å
å
m n
ToString
å
å
n v
(
å
å
v w
)
å
å
w x
)
å
å
x y
.
å
å
y z
Month
å
å
z 
==å
å
Ä Ç
boliviaTimeå
å
É é
.å
å
é è
Monthå
å
è î
&&å
å
ï ó
DateTimeå
å
ò †
.å
å
† °
Parseå
å
° ¶
(å
å
¶ ß
xå
å
ß ®
.å
å
® ©
dateRegisterå
å
© µ
.å
å
µ ∂
ToStringå
å
∂ æ
(å
å
æ ø
)å
å
ø ¿
)å
å
¿ ¡
.å
å
¡ ¬
Yearå
å
¬ ∆
==å
å
« …
boliviaTimeå
å
  ’
.å
å
’ ÷
Yearå
å
÷ ⁄
)å
å
⁄ €
.å
å
€ ‹
ToListå
å
‹ ‚
(å
å
‚ „
)å
å
„ ‰
;å
å
‰ Â
double
ç
ç
4 :
start
ç
ç
; @
=
ç
ç
A B
$num
ç
ç
C D
;
ç
ç
D E
if
é
é
4 6
(
é
é
7 8
stars
é
é
8 =
.
é
é
= >
Count
é
é
> C
>
é
é
D E
$num
é
é
F G
)
é
é
G H
{
è
è
4 5
int
ê
ê
8 ;

countstars
ê
ê
< F
=
ê
ê
G H
$num
ê
ê
I J
;
ê
ê
J K
foreach
ë
ë
8 ?
(
ë
ë
@ A
var
ë
ë
A D
st
ë
ë
E G
in
ë
ë
H J
star
ë
ë
K O
)
ë
ë
O P
{
í
í
8 9

countstars
ì
ì
< F
++
ì
ì
F H
;
ì
ì
H I
start
î
î
< A
=
î
î
B C
start
î
î
D I
+
î
î
J K
double
î
î
L R
.
î
î
R S
Parse
î
î
S X
(
î
î
X Y
st
î
î
Y [
.
î
î
[ \
numStar
î
î
\ c
.
î
î
c d
ToString
î
î
d l
(
î
î
l m
)
î
î
m n
)
î
î
n o
;
î
î
o p
}
ï
ï
8 9
start
ñ
ñ
8 =
=
ñ
ñ
> ?
Math
ñ
ñ
@ D
.
ñ
ñ
D E
Round
ñ
ñ
E J
(
ñ
ñ
J K
start
ñ
ñ
K P
/
ñ
ñ
Q R

countstars
ñ
ñ
S ]
,
ñ
ñ
] ^
$num
ñ
ñ
_ `
)
ñ
ñ
` a
;
ñ
ñ
a b
}
ó
ó
4 5
int
ò
ò
4 7
result
ò
ò
8 >
=
ò
ò
? @
res
ò
ò
A D
-
ò
ò
E F*
minutesDiferenciaComparacion
ò
ò
G c
;
ò
ò
c d 
choferesTiempoAuxi
ô
ô
4 F
.
ô
ô
F G
Add
ô
ô
G J
(
ô
ô
J K
new
ô
ô
K N 
ChoferesTiempoAuxi
ô
ô
O a
(
ô
ô
a b
chofer
ô
ô
b h
.
ô
ô
h i
name
ô
ô
i m
+
ô
ô
n o
$str
ô
ô
p s
+
ô
ô
t u
chofer
ô
ô
v |
.
ô
ô
| }
lastnameô
ô
} Ö
+ô
ô
Ü á
$strô
ô
à å
+ô
ô
ç é
startô
ô
è î
+ô
ô
ï ñ
$strô
ô
ó ö
+ô
ô
õ ú
$strô
ô
ù ¨
+ô
ô
≠ Æ
resultô
ô
Ø µ
,ô
ô
µ ∂
resultô
ô
∑ Ω
)ô
ô
Ω æ
)ô
ô
æ ø
;ô
ô
ø ¿
}
ö
ö
0 1
}
õ
õ
, -
else
ú
ú
, 0
if
ú
ú
1 3
(
ú
ú
4 5"
numInicioTimeControl
ú
ú
5 I
.
ú
ú
I J
orden
ú
ú
J O
<
ú
ú
P Q
final
ú
ú
R W
.
ú
ú
W X
orden
ú
ú
X ]
)
ú
ú
] ^
{
ù
ù
, -
var
û
û
0 3
routesInicioFinal
û
û
4 E
=
û
û
F G
routes
û
û
H N
.
û
û
N O
Where
û
û
O T
(
û
û
T U
item2
û
û
U Z
=>
û
û
[ ]
item2
û
û
^ c
.
û
û
c d
numPoint
û
û
d l
>=
û
û
m o
inicioCheck
û
û
p {
.
û
û
{ |
numPointû
û
| Ñ
&&û
û
Ö á
item2û
û
à ç
.û
û
ç é
numPointû
û
é ñ
<=û
û
ó ô

finalCheckû
û
ö §
.û
û
§ •
numPointû
û
• ≠
)û
û
≠ Æ
.û
û
Æ Ø
ToListû
û
Ø µ
(û
û
µ ∂
)û
û
∂ ∑
;û
û
∑ ∏
for
†
†
0 3
(
†
†
4 5
int
†
†
5 8
l
†
†
9 :
=
†
†
; <
$num
†
†
= >
;
†
†
> ?
l
†
†
@ A
<
†
†
B C
routesInicioFinal
†
†
D U
.
†
†
U V
Count
†
†
V [
(
†
†
[ \
)
†
†
\ ]
-
†
†
^ _
$num
†
†
` a
;
†
†
a b
l
†
†
c d
++
†
†
d f
)
†
†
f g
{
°
°
0 1
var
¢
¢
4 7
calc
¢
¢
8 <
=
¢
¢
= >
muestraRutasMapas
¢
¢
? P
.
¢
¢
P Q(
CalcularDistanciaHaversine
¢
¢
Q k
(
¢
¢
k l
(
£
£
4 5
decimal
£
£
5 <
)
£
£
< =
routesInicioFinal
£
£
= N
[
£
£
N O
l
£
£
O P
]
£
£
P Q
.
£
£
Q R
latitud
£
£
R Y
,
£
£
Y Z
(
§
§
4 5
decimal
§
§
5 <
)
§
§
< =
routesInicioFinal
§
§
= N
[
§
§
N O
l
§
§
O P
]
§
§
P Q
.
§
§
Q R
logintud
§
§
R Z
,
§
§
Z [
routesInicioFinal
•
•
4 E
[
•
•
E F
l
•
•
F G
+
•
•
H I
$num
•
•
J K
]
•
•
K L
.
•
•
L M
latitud
•
•
M T
,
•
•
T U
routesInicioFinal
¶
¶
4 E
[
¶
¶
E F
l
¶
¶
F G
+
¶
¶
H I
$num
¶
¶
J K
]
¶
¶
K L
.
¶
¶
L M
logintud
¶
¶
M U
)
¶
¶
U V
;
¶
¶
V W
	kmTotales
ß
ß
4 =
=
ß
ß
> ?
	kmTotales
ß
ß
@ I
+
ß
ß
J K
calc
ß
ß
L P
;
ß
ß
P Q
}
®
®
0 1
routesInicioFinal
©
©
0 A
=
©
©
B C
routes
©
©
D J
.
©
©
J K
Where
©
©
K P
(
©
©
P Q
item2
©
©
Q V
=>
©
©
W Y
item2
©
©
Z _
.
©
©
_ `
numPoint
©
©
` h
>=
©
©
i k
inicioCheck
©
©
l w
.
©
©
w x
numPoint©
©
x Ä
&&©
©
Å É
item2©
©
Ñ â
.©
©
â ä
numPoint©
©
ä í
<=©
©
ì ï
item3©
©
ñ õ
.©
©
õ ú
inicio©
©
ú ¢
)©
©
¢ £
.©
©
£ §
ToList©
©
§ ™
(©
©
™ ´
)©
©
´ ¨
;©
©
¨ ≠
for
™
™
0 3
(
™
™
4 5
int
™
™
5 8
l
™
™
9 :
=
™
™
; <
$num
™
™
= >
;
™
™
> ?
l
™
™
@ A
<
™
™
B C
routesInicioFinal
™
™
D U
.
™
™
U V
Count
™
™
V [
(
™
™
[ \
)
™
™
\ ]
-
™
™
^ _
$num
™
™
` a
;
™
™
a b
l
™
™
c d
++
™
™
d f
)
™
™
f g
{
´
´
0 1
var
¨
¨
4 7
calc
¨
¨
8 <
=
¨
¨
= >
muestraRutasMapas
¨
¨
? P
.
¨
¨
P Q(
CalcularDistanciaHaversine
¨
¨
Q k
(
¨
¨
k l
(
≠
≠
4 5
decimal
≠
≠
5 <
)
≠
≠
< =
routesInicioFinal
≠
≠
= N
[
≠
≠
N O
l
≠
≠
O P
]
≠
≠
P Q
.
≠
≠
Q R
latitud
≠
≠
R Y
,
≠
≠
Y Z
(
Æ
Æ
4 5
decimal
Æ
Æ
5 <
)
Æ
Æ
< =
routesInicioFinal
Æ
Æ
= N
[
Æ
Æ
N O
l
Æ
Æ
O P
]
Æ
Æ
P Q
.
Æ
Æ
Q R
logintud
Æ
Æ
R Z
,
Æ
Æ
Z [
routesInicioFinal
Ø
Ø
4 E
[
Ø
Ø
E F
l
Ø
Ø
F G
+
Ø
Ø
H I
$num
Ø
Ø
J K
]
Ø
Ø
K L
.
Ø
Ø
L M
latitud
Ø
Ø
M T
,
Ø
Ø
T U
routesInicioFinal
∞
∞
4 E
[
∞
∞
E F
l
∞
∞
F G
+
∞
∞
H I
$num
∞
∞
J K
]
∞
∞
K L
.
∞
∞
L M
logintud
∞
∞
M U
)
∞
∞
U V
;
∞
∞
V W
km
±
±
4 6
=
±
±
7 8
km
±
±
9 ;
+
±
±
< =
calc
±
±
> B
;
±
±
B C
}
≤
≤
0 1
for
≥
≥
0 3
(
≥
≥
4 5
int
≥
≥
5 8
i
≥
≥
9 :
=
≥
≥
; <
final
≥
≥
= B
.
≥
≥
B C
orden
≥
≥
C H
-
≥
≥
I J
$num
≥
≥
K L
;
≥
≥
L M
i
≥
≥
N O
<
≥
≥
P Q
final
≥
≥
R W
.
≥
≥
W X
orden
≥
≥
X ]
-
≥
≥
^ _
$num
≥
≥
` a
;
≥
≥
a b
i
≥
≥
c d
++
≥
≥
d f
)
≥
≥
f g
{
¥
¥
0 1
if
µ
µ
4 6
(
µ
µ
7 8
DateTime
µ
µ
8 @
.
µ
µ
@ A
Parse
µ
µ
A F
(
µ
µ
F G
timeControl
µ
µ
G R
.
µ
µ
R S
dateRegister
µ
µ
S _
.
µ
µ
_ `
ToString
µ
µ
` h
(
µ
µ
h i
)
µ
µ
i j
)
µ
µ
j k
.
µ
µ
k l
	DayOfWeek
µ
µ
l u
==
µ
µ
v x
	DayOfWeekµ
µ
y Ç
.µ
µ
Ç É
	Wednesdayµ
µ
É å
||µ
µ
ç è
DateTimeµ
µ
ê ò
.µ
µ
ò ô
Parseµ
µ
ô û
(µ
µ
û ü
timeControlµ
µ
ü ™
.µ
µ
™ ´
dateRegisterµ
µ
´ ∑
.µ
µ
∑ ∏
ToStringµ
µ
∏ ¿
(µ
µ
¿ ¡
)µ
µ
¡ ¬
)µ
µ
¬ √
.µ
µ
√ ƒ
	DayOfWeekµ
µ
ƒ Õ
==µ
µ
Œ –
	DayOfWeekµ
µ
— ⁄
.µ
µ
⁄ €
Saturdayµ
µ
€ „
)µ
µ
„ ‰
{
∂
∂
4 5
string
∑
∑
8 >
[
∑
∑
> ?
]
∑
∑
? @
calcularMinutes
∑
∑
A P
=
∑
∑
Q R
ParadasAnteriores
∑
∑
S d
[
∑
∑
d e
i
∑
∑
e f
]
∑
∑
f g
.
∑
∑
g h
minArrivalMarket
∑
∑
h x
.
∑
∑
x y
Split
∑
∑
y ~
(
∑
∑
~ 
$char∑
∑
 Ç
)∑
∑
Ç É
;∑
∑
É Ñ
int
∏
∏
8 ;
hour
∏
∏
< @
=
∏
∏
A B
int
∏
∏
C F
.
∏
∏
F G
Parse
∏
∏
G L
(
∏
∏
L M
calcularMinutes
∏
∏
M \
[
∏
∏
\ ]
$num
∏
∏
] ^
]
∏
∏
^ _
)
∏
∏
_ `
;
∏
∏
` a
int
π
π
8 ;
minute
π
π
< B
=
π
π
C D
int
π
π
E H
.
π
π
H I
Parse
π
π
I N
(
π
π
N O
calcularMinutes
π
π
O ^
[
π
π
^ _
$num
π
π
_ `
]
π
π
` a
)
π
π
a b
;
π
π
b c
minutes
∫
∫
8 ?
=
∫
∫
@ A
minutes
∫
∫
B I
+
∫
∫
J K
hour
∫
∫
L P
*
∫
∫
Q R
$num
∫
∫
S U
+
∫
∫
V W
minute
∫
∫
X ^
;
∫
∫
^ _
}
º
º
4 5
else
Ω
Ω
4 8
{
æ
æ
4 5
string
ø
ø
8 >
[
ø
ø
> ?
]
ø
ø
? @
calcularMinutes
ø
ø
A P
=
ø
ø
Q R
ParadasAnteriores
ø
ø
S d
[
ø
ø
d e
i
ø
ø
e f
]
ø
ø
f g
.
ø
ø
g h

minArrival
ø
ø
h r
.
ø
ø
r s
Split
ø
ø
s x
(
ø
ø
x y
$char
ø
ø
y |
)
ø
ø
| }
;
ø
ø
} ~
int
¿
¿
8 ;
hour
¿
¿
< @
=
¿
¿
A B
int
¿
¿
C F
.
¿
¿
F G
Parse
¿
¿
G L
(
¿
¿
L M
calcularMinutes
¿
¿
M \
[
¿
¿
\ ]
$num
¿
¿
] ^
]
¿
¿
^ _
)
¿
¿
_ `
;
¿
¿
` a
int
¡
¡
8 ;
minute
¡
¡
< B
=
¡
¡
C D
int
¡
¡
E H
.
¡
¡
H I
Parse
¡
¡
I N
(
¡
¡
N O
calcularMinutes
¡
¡
O ^
[
¡
¡
^ _
$num
¡
¡
_ `
]
¡
¡
` a
)
¡
¡
a b
;
¡
¡
b c
minutes
¬
¬
8 ?
=
¬
¬
@ A
minutes
¬
¬
B I
+
¬
¬
J K
hour
¬
¬
L P
*
¬
¬
Q R
$num
¬
¬
S U
+
¬
¬
V W
minute
¬
¬
X ^
;
¬
¬
^ _
}
√
√
4 5
}
ƒ
ƒ
0 1
TimeSpan
≈
≈
0 8

diferencia
≈
≈
9 C
=
≈
≈
D E
boliviaTime
≈
≈
F Q
.
≈
≈
Q R
Subtract
≈
≈
R Z
(
≈
≈
Z [
DateTime
≈
≈
[ c
.
≈
≈
c d
Parse
≈
≈
d i
(
≈
≈
i j
timeControl
≈
≈
j u
.
≈
≈
u v
dateRegister≈
≈
v Ç
.≈
≈
Ç É
ToString≈
≈
É ã
(≈
≈
ã å
)≈
≈
å ç
)≈
≈
ç é
)≈
≈
é è
;≈
≈
è ê
int
∆
∆
0 3*
minutesDiferenciaComparacion
∆
∆
4 P
=
∆
∆
Q R
(
∆
∆
S T
int
∆
∆
T W
)
∆
∆
W X

diferencia
∆
∆
X b
.
∆
∆
b c
TotalMinutes
∆
∆
c o
;
∆
∆
o p
	kmTotales
«
«
0 9
=
«
«
: ;
Math
«
«
< @
.
«
«
@ A
Round
«
«
A F
(
«
«
F G
	kmTotales
«
«
G P
,
«
«
P Q
$num
«
«
R S
)
«
«
S T
;
«
«
T U
km
»
»
0 2
=
»
»
3 4
Math
»
»
5 9
.
»
»
9 :
Round
»
»
: ?
(
»
»
? @
km
»
»
@ B
,
»
»
B C
$num
»
»
D E
)
»
»
E F
;
»
»
F G
int
…
…
0 3
res
…
…
4 7
=
…
…
8 9
(
…
…
: ;
int
…
…
; >
)
…
…
> ?
(
…
…
? @
minutes
…
…
@ G
*
…
…
H I
km
…
…
J L
/
…
…
M N
	kmTotales
…
…
O X
)
…
…
X Y
;
…
…
Y Z
var
 
 
0 3
chofer
 
 
4 :
=
 
 
; <
context
 
 
= D
.
 
 
D E
Person
 
 
E K
.
 
 
K L
Where
 
 
L Q
(
 
 
Q R
x
 
 
R S
=>
 
 
T V
x
 
 
W X
.
 
 
X Y
nit
 
 
Y \
==
 
 
] _
item
 
 
` d
.
 
 
d e

idEmployee
 
 
e o
)
 
 
o p
.
 
 
p q
FirstOrDefault
 
 
q 
( 
 
 Ä
) 
 
Ä Å
; 
 
Å Ç
int
À
À
0 3
time
À
À
4 8
=
À
À
9 :
$num
À
À
; <
;
À
À
< =
for
Õ
Õ
0 3
(
Õ
Õ
4 5
int
Õ
Õ
5 8
i
Õ
Õ
9 :
=
Õ
Õ
; <"
numInicioTimeControl
Õ
Õ
= Q
.
Õ
Õ
Q R
orden
Õ
Õ
R W
-
Õ
Õ
X Y
$num
Õ
Õ
Z [
;
Õ
Õ
[ \
i
Õ
Õ
] ^
<
Õ
Õ
_ `
final
Õ
Õ
a f
.
Õ
Õ
f g
orden
Õ
Õ
g l
-
Õ
Õ
m n
$num
Õ
Õ
o p
;
Õ
Õ
p q
i
Õ
Õ
r s
++
Õ
Õ
s u
)
Õ
Õ
u v
{
Œ
Œ
0 1
if
œ
œ
4 6
(
œ
œ
7 8
DateTime
œ
œ
8 @
.
œ
œ
@ A
Parse
œ
œ
A F
(
œ
œ
F G
timeControl
œ
œ
G R
.
œ
œ
R S
dateRegister
œ
œ
S _
.
œ
œ
_ `
ToString
œ
œ
` h
(
œ
œ
h i
)
œ
œ
i j
)
œ
œ
j k
.
œ
œ
k l
	DayOfWeek
œ
œ
l u
==
œ
œ
v x
	DayOfWeekœ
œ
y Ç
.œ
œ
Ç É
	Wednesdayœ
œ
É å
||œ
œ
ç è
DateTimeœ
œ
ê ò
.œ
œ
ò ô
Parseœ
œ
ô û
(œ
œ
û ü
timeControlœ
œ
ü ™
.œ
œ
™ ´
dateRegisterœ
œ
´ ∑
.œ
œ
∑ ∏
ToStringœ
œ
∏ ¿
(œ
œ
¿ ¡
)œ
œ
¡ ¬
)œ
œ
¬ √
.œ
œ
√ ƒ
	DayOfWeekœ
œ
ƒ Õ
==œ
œ
Œ –
	DayOfWeekœ
œ
— ⁄
.œ
œ
⁄ €
Saturdayœ
œ
€ „
)œ
œ
„ ‰
{
–
–
4 5
string
—
—
8 >
[
—
—
> ?
]
—
—
? @
calcularMinutes
—
—
A P
=
—
—
Q R
ParadasAnteriores
—
—
S d
[
—
—
d e
i
—
—
e f
]
—
—
f g
.
—
—
g h
minArrivalMarket
—
—
h x
.
—
—
x y
Split
—
—
y ~
(
—
—
~ 
$char—
—
 Ç
)—
—
Ç É
;—
—
É Ñ
int
“
“
8 ;
hour
“
“
< @
=
“
“
A B
int
“
“
C F
.
“
“
F G
Parse
“
“
G L
(
“
“
L M
calcularMinutes
“
“
M \
[
“
“
\ ]
$num
“
“
] ^
]
“
“
^ _
)
“
“
_ `
;
“
“
` a
int
”
”
8 ;
minute
”
”
< B
=
”
”
C D
int
”
”
E H
.
”
”
H I
Parse
”
”
I N
(
”
”
N O
calcularMinutes
”
”
O ^
[
”
”
^ _
$num
”
”
_ `
]
”
”
` a
)
”
”
a b
;
”
”
b c
time
‘
‘
8 <
=
‘
‘
= >
time
‘
‘
? C
+
‘
‘
D E
hour
‘
‘
F J
*
‘
‘
K L
$num
‘
‘
M O
+
‘
‘
P Q
minute
‘
‘
R X
;
‘
‘
X Y
}
÷
÷
4 5
else
◊
◊
4 8
{
ÿ
ÿ
4 5
string
Ÿ
Ÿ
8 >
[
Ÿ
Ÿ
> ?
]
Ÿ
Ÿ
? @
calcularMinutes
Ÿ
Ÿ
A P
=
Ÿ
Ÿ
Q R
ParadasAnteriores
Ÿ
Ÿ
S d
[
Ÿ
Ÿ
d e
i
Ÿ
Ÿ
e f
]
Ÿ
Ÿ
f g
.
Ÿ
Ÿ
g h

minArrival
Ÿ
Ÿ
h r
.
Ÿ
Ÿ
r s
Split
Ÿ
Ÿ
s x
(
Ÿ
Ÿ
x y
$char
Ÿ
Ÿ
y |
)
Ÿ
Ÿ
| }
;
Ÿ
Ÿ
} ~
int
⁄
⁄
8 ;
hour
⁄
⁄
< @
=
⁄
⁄
A B
int
⁄
⁄
C F
.
⁄
⁄
F G
Parse
⁄
⁄
G L
(
⁄
⁄
L M
calcularMinutes
⁄
⁄
M \
[
⁄
⁄
\ ]
$num
⁄
⁄
] ^
]
⁄
⁄
^ _
)
⁄
⁄
_ `
;
⁄
⁄
` a
int
€
€
8 ;
minute
€
€
< B
=
€
€
C D
int
€
€
E H
.
€
€
H I
Parse
€
€
I N
(
€
€
N O
calcularMinutes
€
€
O ^
[
€
€
^ _
$num
€
€
_ `
]
€
€
` a
)
€
€
a b
;
€
€
b c
time
‹
‹
8 <
=
‹
‹
= >
time
‹
‹
? C
+
‹
‹
D E
hour
‹
‹
F J
*
‹
‹
K L
$num
‹
‹
M O
+
‹
‹
P Q
minute
‹
‹
R X
;
‹
‹
X Y
}
›
›
4 5
}
ﬁ
ﬁ
0 1
res
ﬂ
ﬂ
0 3
=
ﬂ
ﬂ
4 5
time
ﬂ
ﬂ
6 :
+
ﬂ
ﬂ
; <
res
ﬂ
ﬂ
= @
;
ﬂ
ﬂ
@ A
if
‡
‡
0 2
(
‡
‡
3 4*
minutesDiferenciaComparacion
‡
‡
4 P
<
‡
‡
Q R
res
‡
‡
S V
)
‡
‡
V W
{
·
·
0 1
List
‚
‚
4 8
<
‚
‚
8 9
Star
‚
‚
9 =
>
‚
‚
= >
stars
‚
‚
? D
=
‚
‚
E F
new
‚
‚
G J
List
‚
‚
K O
<
‚
‚
O P
Star
‚
‚
P T
>
‚
‚
T U
(
‚
‚
U V
)
‚
‚
V W
;
‚
‚
W X
stars
„
„
4 9
=
„
„
: ;
context
„
„
< C
.
„
„
C D
Star
„
„
D H
.
„
„
H I
Where
„
„
I N
(
„
„
N O
x
„
„
O P
=>
„
„
Q S
x
„
„
T U
.
„
„
U V

idEmployee
„
„
V `
==
„
„
a c
item
„
„
d h
.
„
„
h i

idEmployee
„
„
i s
)
„
„
s t
.
„
„
t u
ToList
„
„
u {
(
„
„
{ |
)
„
„
| }
;
„
„
} ~
var
‰
‰
4 7
star
‰
‰
8 <
=
‰
‰
= >
stars
‰
‰
? D
.
‰
‰
D E
Where
‰
‰
E J
(
‰
‰
J K
x
‰
‰
K L
=>
‰
‰
M O
DateTime
‰
‰
P X
.
‰
‰
X Y
Parse
‰
‰
Y ^
(
‰
‰
^ _
x
‰
‰
_ `
.
‰
‰
` a
dateRegister
‰
‰
a m
.
‰
‰
m n
ToString
‰
‰
n v
(
‰
‰
v w
)
‰
‰
w x
)
‰
‰
x y
.
‰
‰
y z
Month
‰
‰
z 
==‰
‰
Ä Ç
boliviaTime‰
‰
É é
.‰
‰
é è
Month‰
‰
è î
&&‰
‰
ï ó
DateTime‰
‰
ò †
.‰
‰
† °
Parse‰
‰
° ¶
(‰
‰
¶ ß
x‰
‰
ß ®
.‰
‰
® ©
dateRegister‰
‰
© µ
.‰
‰
µ ∂
ToString‰
‰
∂ æ
(‰
‰
æ ø
)‰
‰
ø ¿
)‰
‰
¿ ¡
.‰
‰
¡ ¬
Year‰
‰
¬ ∆
==‰
‰
« …
boliviaTime‰
‰
  ’
.‰
‰
’ ÷
Year‰
‰
÷ ⁄
)‰
‰
⁄ €
.‰
‰
€ ‹
ToList‰
‰
‹ ‚
(‰
‰
‚ „
)‰
‰
„ ‰
;‰
‰
‰ Â
double
Â
Â
4 :
start
Â
Â
; @
=
Â
Â
A B
$num
Â
Â
C D
;
Â
Â
D E
if
Ê
Ê
4 6
(
Ê
Ê
7 8
stars
Ê
Ê
8 =
.
Ê
Ê
= >
Count
Ê
Ê
> C
>
Ê
Ê
D E
$num
Ê
Ê
F G
)
Ê
Ê
G H
{
Á
Á
4 5
int
Ë
Ë
8 ;

countstars
Ë
Ë
< F
=
Ë
Ë
G H
$num
Ë
Ë
I J
;
Ë
Ë
J K
foreach
È
È
8 ?
(
È
È
@ A
var
È
È
A D
st
È
È
E G
in
È
È
H J
star
È
È
K O
)
È
È
O P
{
Í
Í
8 9

countstars
Î
Î
< F
++
Î
Î
F H
;
Î
Î
H I
start
Ï
Ï
< A
=
Ï
Ï
B C
start
Ï
Ï
D I
+
Ï
Ï
J K
double
Ï
Ï
L R
.
Ï
Ï
R S
Parse
Ï
Ï
S X
(
Ï
Ï
X Y
st
Ï
Ï
Y [
.
Ï
Ï
[ \
numStar
Ï
Ï
\ c
.
Ï
Ï
c d
ToString
Ï
Ï
d l
(
Ï
Ï
l m
)
Ï
Ï
m n
)
Ï
Ï
n o
;
Ï
Ï
o p
}
Ì
Ì
8 9
start
Ó
Ó
8 =
=
Ó
Ó
> ?
Math
Ó
Ó
@ D
.
Ó
Ó
D E
Round
Ó
Ó
E J
(
Ó
Ó
J K
start
Ó
Ó
K P
/
Ó
Ó
Q R

countstars
Ó
Ó
S ]
,
Ó
Ó
] ^
$num
Ó
Ó
_ `
)
Ó
Ó
` a
;
Ó
Ó
a b
}
Ô
Ô
4 5
int


4 7
result


8 >
=


? @
res


A D
-


E F*
minutesDiferenciaComparacion


G c
;


c d 
choferesTiempoAuxi
Ò
Ò
4 F
.
Ò
Ò
F G
Add
Ò
Ò
G J
(
Ò
Ò
J K
new
Ò
Ò
K N 
ChoferesTiempoAuxi
Ò
Ò
O a
(
Ò
Ò
a b
chofer
Ò
Ò
b h
.
Ò
Ò
h i
name
Ò
Ò
i m
+
Ò
Ò
n o
$str
Ò
Ò
p s
+
Ò
Ò
t u
chofer
Ò
Ò
v |
.
Ò
Ò
| }
lastnameÒ
Ò
} Ö
+Ò
Ò
Ü á
$strÒ
Ò
à å
+Ò
Ò
ç é
startÒ
Ò
è î
+Ò
Ò
ï ñ
$strÒ
Ò
ó ö
+Ò
Ò
õ ú
$strÒ
Ò
ù ¨
+Ò
Ò
≠ Æ
resultÒ
Ò
Ø µ
,Ò
Ò
µ ∂
resultÒ
Ò
∑ Ω
)Ò
Ò
Ω æ
)Ò
Ò
æ ø
;Ò
Ò
ø ¿
}
Ú
Ú
0 1
}
Û
Û
, -
}
Ù
Ù
( )
}
˜
˜
$ %
}
¯
¯
  !
}
˙
˙
 
}
˚
˚
 
}
¸
¸
  
choferesTiempoAuxi
˝
˝
 &
=
˝
˝
' ( 
choferesTiempoAuxi
˝
˝
) ;
.
˝
˝
; <
OrderBy
˝
˝
< C
(
˝
˝
C D
x
˝
˝
D E
=>
˝
˝
F H
x
˝
˝
I J
.
˝
˝
J K

dateRegist
˝
˝
K U
)
˝
˝
U V
.
˝
˝
V W
ToList
˝
˝
W ]
(
˝
˝
] ^
)
˝
˝
^ _
;
˝
˝
_ ` 
choferesTiempoAuxi
˛
˛
 &
=
˛
˛
' ( 
choferesTiempoAuxi
˛
˛
) ;
.
˛
˛
; <
Take
˛
˛
< @
(
˛
˛
@ A
$num
˛
˛
A B
)
˛
˛
B C
.
˛
˛
C D
ToList
˛
˛
D J
(
˛
˛
J K
)
˛
˛
K L
;
˛
˛
L M
foreach
ˇ
ˇ
 
(
ˇ
ˇ
 
var
ˇ
ˇ
  
item
ˇ
ˇ
! %
in
ˇ
ˇ
& ( 
choferesTiempoAuxi
ˇ
ˇ
) ;
)
ˇ
ˇ
; <
{
ÄÄ 
choferesTiempo
ÅÅ &
.
ÅÅ& '
Add
ÅÅ' *
(
ÅÅ* +
item
ÅÅ+ /
.
ÅÅ/ 0
description
ÅÅ0 ;
)
ÅÅ; <
;
ÅÅ< =
}
ÇÇ 
muestraRutasMapas
ÉÉ %
.
ÉÉ% &
ListRutasMostrar
ÉÉ& 6
=
ÉÉ7 8
nuevasRutas
ÉÉ9 D
;
ÉÉD E
muestraRutasMapas
ÑÑ %
.
ÑÑ% & 
ListParadasMostrar
ÑÑ& 8
=
ÑÑ9 :
nuevasParadas
ÑÑ; H
;
ÑÑH I
muestraRutasMapas
ÖÖ %
.
ÖÖ% &!
ListBloqueosMostrar
ÖÖ& 9
=
ÖÖ: ;
nuevosBloqueos
ÖÖ< J
;
ÖÖJ K
mapa
ÜÜ 
.
ÜÜ 
Add
ÜÜ 
(
ÜÜ 
muestraRutasMapas
ÜÜ .
)
ÜÜ. /
;
ÜÜ/ 0
if
áá 
(
áá 
!
áá 
allLines
áá  
.
áá  !
Any
áá! $
(
áá$ %
x
áá% &
=>
áá' )
x
áá* +
.
áá+ ,
nameLine
áá, 4
==
áá5 7
Line
áá8 <
+
áá< =
$str
áá= E
+
ááE F
item3
ááF K
.
ááK L
numType
ááL S
)
ááS T
)
ááT U
allLines
àà 
.
àà 
Add
àà  
(
àà  !
new
àà! $ 
MuestraTodasLineas
àà% 7
(
àà7 8
Line
àà8 <
+
àà< =
$str
àà= E
+
ààE F
item3
ààF K
.
ààK L
numType
ààL S
,
ààS T
mapa
ààU Y
,
ààY Z
choferesTiempo
àà[ i
)
àài j
)
ààj k
;
ààk l
}
ââ 
return
ää 
View
ää 
(
ää 
allLines
ää $
)
ää$ %
;
ää% &
}
åå 
catch
çç 
(
çç 
	Exception
çç 
)
çç 
{
éé 
throw
èè 
;
èè 
}
êê 
}
ëë 	
public
íí 
ActionResult
íí 
actualizarCookie
íí ,
(
íí, -
string
íí- 3
linea
íí4 9
)
íí9 :
{
ìì 	

HttpCookie
îî 

authCookie
îî !
=
îî" #
Request
îî$ +
.
îî+ ,
Cookies
îî, 3
[
îî3 4!
FormsAuthentication
îî4 G
.
îîG H
FormsCookieName
îîH W
]
îîW X
;
îîX Y
if
ïï 
(
ïï 

authCookie
ïï 
!=
ïï 
null
ïï "
)
ïï" #
{
ññ '
FormsAuthenticationTicket
óó )
ticket
óó* 0
=
óó1 2!
FormsAuthentication
óó3 F
.
óóF G
Decrypt
óóG N
(
óóN O

authCookie
óóO Y
.
óóY Z
Value
óóZ _
)
óó_ `
;
óó` a
var
ôô 

cookieData
ôô 
=
ôô  

Newtonsoft
ôô! +
.
ôô+ ,
Json
ôô, 0
.
ôô0 1
JsonConvert
ôô1 <
.
ôô< =
DeserializeObject
ôô= N
<
ôôN O
dynamic
ôôO V
>
ôôV W
(
ôôW X
ticket
ôôX ^
.
ôô^ _
UserData
ôô_ g
)
ôôg h
;
ôôh i

cookieData
õõ 
.
õõ 
Linea
õõ  
=
õõ! "
linea
õõ# (
;
õõ( )
string
ùù 
userDataUpdated
ùù &
=
ùù' (

Newtonsoft
ùù) 3
.
ùù3 4
Json
ùù4 8
.
ùù8 9
JsonConvert
ùù9 D
.
ùùD E
SerializeObject
ùùE T
(
ùùT U

cookieData
ùùU _
)
ùù_ `
;
ùù` a'
FormsAuthenticationTicket
üü )
	newTicket
üü* 3
=
üü4 5
new
üü6 9'
FormsAuthenticationTicket
üü: S
(
üüS T
ticket
†† 
.
†† 
Version
†† "
,
††" #
ticket
°° 
.
°° 
Name
°° 
,
°°  
ticket
¢¢ 
.
¢¢ 
	IssueDate
¢¢ $
,
¢¢$ %
ticket
££ 
.
££ 

Expiration
££ %
,
££% &
ticket
§§ 
.
§§ 
IsPersistent
§§ '
,
§§' (
userDataUpdated
•• #
,
••# $
ticket
¶¶ 
.
¶¶ 

CookiePath
¶¶ %
)
ßß 
;
ßß 
string
©©  
encryptedNewTicket
©© )
=
©©* +!
FormsAuthentication
©©, ?
.
©©? @
Encrypt
©©@ G
(
©©G H
	newTicket
©©H Q
)
©©Q R
;
©©R S

HttpCookie
´´ 
updatedAuthCookie
´´ ,
=
´´- .
new
´´/ 2

HttpCookie
´´3 =
(
´´= >!
FormsAuthentication
´´> Q
.
´´Q R
FormsCookieName
´´R a
,
´´a b 
encryptedNewTicket
´´c u
)
´´u v
{
¨¨ 
HttpOnly
≠≠ 
=
≠≠ 
true
≠≠ #
,
≠≠# $
Expires
ÆÆ 
=
ÆÆ 
	newTicket
ÆÆ '
.
ÆÆ' (

Expiration
ÆÆ( 2
}
ØØ 
;
ØØ 
Response
±± 
.
±± 
Cookies
±±  
.
±±  !
Set
±±! $
(
±±$ %
updatedAuthCookie
±±% 6
)
±±6 7
;
±±7 8
}
≤≤ 
return
¥¥ 
RedirectToAction
¥¥ #
(
¥¥# $
$str
¥¥$ +
,
¥¥+ ,
$str
¥¥- 3
)
¥¥3 4
;
¥¥4 5
}
µµ 	
public
∂∂ 
ActionResult
∂∂  
olvidarCookieLinea
∂∂ .
(
∂∂. /
)
∂∂/ 0
{
∑∑ 	

HttpCookie
∏∏ 

authCookie
∏∏ !
=
∏∏" #
Request
∏∏$ +
.
∏∏+ ,
Cookies
∏∏, 3
[
∏∏3 4!
FormsAuthentication
∏∏4 G
.
∏∏G H
FormsCookieName
∏∏H W
]
∏∏W X
;
∏∏X Y
if
ππ 
(
ππ 

authCookie
ππ 
!=
ππ 
null
ππ "
)
ππ" #
{
∫∫ '
FormsAuthenticationTicket
ªª )
ticket
ªª* 0
=
ªª1 2!
FormsAuthentication
ªª3 F
.
ªªF G
Decrypt
ªªG N
(
ªªN O

authCookie
ªªO Y
.
ªªY Z
Value
ªªZ _
)
ªª_ `
;
ªª` a
var
ΩΩ 

cookieData
ΩΩ 
=
ΩΩ  

Newtonsoft
ΩΩ! +
.
ΩΩ+ ,
Json
ΩΩ, 0
.
ΩΩ0 1
JsonConvert
ΩΩ1 <
.
ΩΩ< =
DeserializeObject
ΩΩ= N
<
ΩΩN O
dynamic
ΩΩO V
>
ΩΩV W
(
ΩΩW X
ticket
ΩΩX ^
.
ΩΩ^ _
UserData
ΩΩ_ g
)
ΩΩg h
;
ΩΩh i

cookieData
øø 
.
øø 
Linea
øø  
=
øø! "
$str
øø# %
;
øø% &
string
¡¡ 
userDataUpdated
¡¡ &
=
¡¡' (

Newtonsoft
¡¡) 3
.
¡¡3 4
Json
¡¡4 8
.
¡¡8 9
JsonConvert
¡¡9 D
.
¡¡D E
SerializeObject
¡¡E T
(
¡¡T U

cookieData
¡¡U _
)
¡¡_ `
;
¡¡` a'
FormsAuthenticationTicket
√√ )
	newTicket
√√* 3
=
√√4 5
new
√√6 9'
FormsAuthenticationTicket
√√: S
(
√√S T
ticket
ƒƒ 
.
ƒƒ 
Version
ƒƒ "
,
ƒƒ" #
ticket
≈≈ 
.
≈≈ 
Name
≈≈ 
,
≈≈  
ticket
∆∆ 
.
∆∆ 
	IssueDate
∆∆ $
,
∆∆$ %
ticket
«« 
.
«« 

Expiration
«« %
,
««% &
ticket
»» 
.
»» 
IsPersistent
»» '
,
»»' (
userDataUpdated
…… #
,
……# $
ticket
   
.
   

CookiePath
   %
)
ÀÀ 
;
ÀÀ 
string
ÕÕ  
encryptedNewTicket
ÕÕ )
=
ÕÕ* +!
FormsAuthentication
ÕÕ, ?
.
ÕÕ? @
Encrypt
ÕÕ@ G
(
ÕÕG H
	newTicket
ÕÕH Q
)
ÕÕQ R
;
ÕÕR S

HttpCookie
œœ 
updatedAuthCookie
œœ ,
=
œœ- .
new
œœ/ 2

HttpCookie
œœ3 =
(
œœ= >!
FormsAuthentication
œœ> Q
.
œœQ R
FormsCookieName
œœR a
,
œœa b 
encryptedNewTicket
œœc u
)
œœu v
{
–– 
HttpOnly
—— 
=
—— 
true
—— #
,
——# $
Expires
““ 
=
““ 
	newTicket
““ '
.
““' (

Expiration
““( 2
}
”” 
;
”” 
Response
‘‘ 
.
‘‘ 
Cookies
‘‘  
.
‘‘  !
Set
‘‘! $
(
‘‘$ %
updatedAuthCookie
‘‘% 6
)
‘‘6 7
;
‘‘7 8
}
’’ 
return
÷÷ 
RedirectToAction
÷÷ #
(
÷÷# $
$str
÷÷$ +
,
÷÷+ ,
$str
÷÷- 3
)
÷÷3 4
;
÷÷4 5
}
ÿÿ 	
}
ŸŸ 
}⁄⁄ ¿≠
QC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Controllers\NewReportController.cs
	namespace

 	#
ProyectoControlLineaBus


 !
.

! "
Controllers

" -
{ 
public 

class 
NewReportController $
:% &

Controller' 1
{ 
public 
ActionResult !
ReportFallasMecanicas 1
(1 2
string2 8
plate9 >
)> ?
{ 	
try 
{ 
Login 
logi 
= 
new  
Login! &
(& '
)' (
;( )
var 

authResult 
=  
AutenticarPasosRol! 3
(3 4
$num4 5
)5 6
;6 7
if 
( 

authResult 
!= !
null" &
)& '
return( .

authResult/ 9
;9 :
string 
Linea 
= 
logi #
.# $
GetLineaFromCookie$ 6
(6 7
Request7 >
)> ?
.? @
ToString@ H
(H I
)I J
;J K
List 
< "
MostrarFallasMecanicas +
>+ ,
fallas- 3
=4 5
new6 9
List: >
<> ?"
MostrarFallasMecanicas? U
>U V
(V W
)W X
;X Y
using 
( 
dbModels 
context  '
=( )
new* -
dbModels. 6
(6 7
)7 8
)8 9
{ 
var 
failures  
=! "
context# *
.* +
MechanicalFailures+ =
.= >
Where> C
(C D
xD E
=>F H
xI J
.J K
plateK P
==Q S
plateT Y
)Y Z
.Z [
ToList[ a
(a b
)b c
;c d
if 
( 
failures  
.  !
Count! &
>' (
$num) *
)* +
{ 
foreach 
(  !
var! $
item% )
in* ,
failures- 5
)5 6
{ 
fallas   "
.  " #
Add  # &
(  & '
new  ' *"
MostrarFallasMecanicas  + A
(  A B
item  B F
.  F G
plate  G L
,  L M
item  N R
.  R S
description  S ^
,  ^ _
DateTime  ` h
.  h i
Parse  i n
(  n o
item  o s
.  s t
dateRegister	  t Ä
.
  Ä Å
ToString
  Å â
(
  â ä
)
  ä ã
)
  ã å
)
  å ç
)
  ç é
;
  é è
}!! 
}"" 
}## 
TimeZoneInfo%% 
boliviaTimeZone%% ,
=%%- .
TimeZoneInfo%%/ ;
.%%; <"
FindSystemTimeZoneById%%< R
(%%R S
$str%%S m
)%%m n
;%%n o
DateTime&& 
boliviaTime&& $
=&&% &
TimeZoneInfo&&' 3
.&&3 4
ConvertTimeFromUtc&&4 F
(&&F G
DateTime&&G O
.&&O P
UtcNow&&P V
,&&V W
boliviaTimeZone&&X g
)&&g h
;&&h i
ViewBag'' 
.'' 
plate'' 
='' 
plate''  %
;''% &
ViewBag(( 
.(( 
CurrentYear(( #
=(($ %
boliviaTime((& 1
.((1 2
Year((2 6
;((6 7
return)) 
View)) 
()) 
fallas)) "
)))" #
;))# $
}** 
catch++ 
(++ 
	Exception++ 
)++ 
{,, 
return-- 
RedirectToAction-- '
(--' (
$str--( /
,--/ 0
$str--1 7
)--7 8
;--8 9
}.. 
}// 	
public00 
ActionResult00 *
ReportFallasMecanicasEscogidos00 :
(00: ;
int00; >
year00? C
,00C D
string00E K
plate00L Q
)00Q R
{11 	
try22 
{33 
List44 
<44 "
MostrarFallasMecanicas44 +
>44+ ,
fallas44- 3
=444 5
new446 9
List44: >
<44> ?"
MostrarFallasMecanicas44? U
>44U V
(44V W
)44W X
;44X Y
using66 
(66 
dbModels66 
context66  '
=66( )
new66* -
dbModels66. 6
(666 7
)667 8
)668 9
{77 
var88 
	failuress88 !
=88" #
context88$ +
.88+ ,
MechanicalFailures88, >
.99* +
Where99+ 0
(990 1
x991 2
=>993 5
x996 7
.997 8
plate998 =
==99> @
plate99A F
)99F G
.::* +
ToList::+ 1
(::1 2
)::2 3
;::3 4
var;; 
failures;;  
=;;! "
	failuress;;# ,
.;;, -
Where;;- 2
(;;2 3
x;;3 4
=>;;5 7
x;;8 9
.;;9 :
plate;;: ?
==;;@ B
plate;;C H
&&;;I K
DateTime;;L T
.;;T U
Parse;;U Z
(;;Z [
x;;[ \
.;;\ ]
dateRegister;;] i
.;;i j
ToString;;j r
(;;r s
);;s t
);;t u
.;;u v
Year;;v z
==;;{ }
year	;;~ Ç
)
;;Ç É
.
;;É Ñ
ToList
;;Ñ ä
(
;;ä ã
)
;;ã å
;
;;å ç
foreach<< 
(<< 
var<<  
item<<! %
in<<& (
failures<<) 1
)<<1 2
{== 
fallas>> 
.>> 
Add>> "
(>>" #
new>># &"
MostrarFallasMecanicas>>' =
(>>= >
item>>> B
.>>B C
plate>>C H
,>>H I
item>>J N
.>>N O
description>>O Z
,>>Z [
DateTime>>\ d
.>>d e
Parse>>e j
(>>j k
item>>k o
.>>o p
dateRegister>>p |
.>>| }
ToString	>>} Ö
(
>>Ö Ü
)
>>Ü á
)
>>á à
)
>>à â
)
>>â ä
;
>>ä ã
}?? 
ViewBag@@ 
.@@ 
plate@@ !
=@@" #
plate@@$ )
;@@) *
ViewBagAA 
.AA 
CurrentYearAA '
=AA( )
yearAA* .
;AA. /
}BB 
returnDD 
ViewDD 
(DD 
fallasDD "
)DD" #
;DD# $
}EE 
catchFF 
(FF 
	ExceptionFF 
)FF 
{GG 
returnHH 
RedirectToActionHH '
(HH' (
$strHH( /
,HH/ 0
$strHH1 7
)HH7 8
;HH8 9
}II 
}KK 	
publicMM 
ActionResultMM 
PrintedReportFallasMM /
(MM/ 0
intMM0 3
yearMM4 8
,MM8 9
stringMM9 ?
plateMM@ E
)MME F
{NN 	
tryOO 
{PP 
LoginQQ 
logiQQ 
=QQ 
newQQ  
LoginQQ! &
(QQ& '
)QQ' (
;QQ( )
varRR 

authResultRR 
=RR  
AutenticarPasosRolRR! 3
(RR3 4
$numRR4 5
)RR5 6
;RR6 7
ifSS 
(SS 

authResultSS 
!=SS !
nullSS" &
)SS& '
returnSS( .

authResultSS/ 9
;SS9 :
TimeZoneInfoTT 
boliviaTimeZoneTT ,
=TT- .
TimeZoneInfoTT/ ;
.TT; <"
FindSystemTimeZoneByIdTT< R
(TTR S
$strTTS m
)TTm n
;TTn o
DateTimeUU 
boliviaTimeUU $
=UU% &
TimeZoneInfoUU' 3
.UU3 4
ConvertTimeUU4 ?
(UU? @
DateTimeUU@ H
.UUH I
UtcNowUUI O
,UUO P
boliviaTimeZoneUUQ `
)UU` a
;UUa b
returnVV 
newVV 
ActionAsPdfVV &
(VV& '
$strVV' G
,VVG H
newVVI L
{VVM N
yearVVN R
=VVS T
yearVVU Y
,VVY Z
plateVV[ `
=VVa b
plateVVc h
}VVh i
)VVi j
{VVk l
FileNameVVm u
=VVv w
plateVVx }
+VV~ 
$str
VVÄ É
+
VVÉ Ñ
year
VVÑ à
+
VVà â
$str
VVâ å
+
VVç é
boliviaTime
VVè ö
.
VVö õ
Day
VVõ û
+
VVü †
boliviaTime
VV° ¨
.
VV¨ ≠
Month
VV≠ ≤
+
VV≥ ¥
boliviaTime
VVµ ¿
.
VV¿ ¡
Year
VV¡ ≈
+
VV∆ «
$str
VV» Œ
}
VVœ –
;
VV– —
}WW 
catchXX 
(XX 
	ExceptionXX 
)XX 
{YY 
returnZZ 
RedirectToActionZZ '
(ZZ' (
$strZZ( /
,ZZ/ 0
$strZZ1 7
)ZZ7 8
;ZZ8 9
}[[ 
}\\ 	
public]] 
ActionResult]] 
ReportChofer]] (
(]]( )
string]]) /
id]]0 2
)]]2 3
{^^ 	
try__ 
{`` 
Loginaa 
logiaa 
=aa 
newaa  
Loginaa! &
(aa& '
)aa' (
;aa( )
varbb 

authResultbb 
=bb  
AutenticarPasosRolbb! 3
(bb3 4
$numbb4 5
)bb5 6
;bb6 7
ifcc 
(cc 

authResultcc 
!=cc !
nullcc" &
)cc& '
returncc( .

authResultcc/ 9
;cc9 :
Listee 
<ee !
MostrarReportesChoferee *
>ee* +
reportesChofersee, ;
=ee< =
newee> A
ListeeB F
<eeF G!
MostrarReportesChofereeG \
>ee\ ]
(ee] ^
)ee^ _
;ee_ `
usingff 
(ff 
dbModelsff 
contextff  '
=ff( )
newff* -
dbModelsff. 6
(ff6 7
)ff7 8
)ff8 9
{gg 
varhh 
reporthh 
=hh  
contexthh! (
.hh( )
Reporthh) /
.hh/ 0
Wherehh0 5
(hh5 6
xhh6 7
=>hh8 :
xhh; <
.hh< =

idEmployeehh= G
==hhH J
idhhK M
)hhM N
.hhN O
ToListhhO U
(hhU V
)hhV W
;hhW X
varii 
personii 
=ii  
contextii! (
.ii( )
Personii) /
.ii/ 0
Whereii0 5
(ii5 6
xii6 7
=>ii8 :
xii; <
.ii< =
nitii= @
==iiA C
idiiD F
)iiF G
.iiG H
FirstOrDefaultiiH V
(iiV W
)iiW X
;iiX Y
ifkk 
(kk 
reportkk 
.kk 
Countkk $
>kk% &
$numkk' (
&&kk) +
personkk, 2
!=kk3 5
nullkk6 :
)kk: ;
{ll 
reportesChofersmm '
=mm( )
reportmm* 0
.nn 
GroupBynn $
(nn$ %
rnn% &
=>nn' )
newnn* -
{nn. /
rnn0 1
.nn1 2
descriptionnn2 =
,nn= >
Monthnn? D
=nnE F
DateTimennG O
.nnO P
ParsennP U
(nnU V
rnnV W
.nnW X
dateRegisternnX d
.nnd e
ToStringnne m
(nnm n
)nnn o
)nno p
.nnp q
Monthnnq v
,nnv w
Yearnnx |
=nn} ~
DateTime	nn á
.
nná à
Parse
nnà ç
(
nnç é
r
nné è
.
nnè ê
dateRegister
nnê ú
.
nnú ù
ToString
nnù •
(
nn• ¶
)
nn¶ ß
)
nnß ®
.
nn® ©
Year
nn© ≠
}
nnÆ Ø
)
nnØ ∞
.oo 
Selectoo #
(oo# $
goo$ %
=>oo& (
newoo) ,!
MostrarReportesChoferoo- B
(ooB C
gpp  !
.pp! "
Keypp" %
.pp% &
descriptionpp& 1
,pp1 2
gqq  !
.qq! "
Keyqq" %
.qq% &
Monthqq& +
,qq+ ,
grr  !
.rr! "
Keyrr" %
.rr% &
Yearrr& *
,rr* +
gss  !
.ss! "
Countss" '
(ss' (
)ss( )
)tt 
)tt 
.tt 
ToListtt %
(tt% &
)tt& '
;tt' (
}uu 
ViewBagvv 
.vv 
Namevv  
=vv! "
personvv# )
!=vv* ,
nullvv- 1
?vv2 3
personvv4 :
.vv: ;
namevv; ?
+vv@ A
$strvvB E
+vvF G
personvvH N
.vvN O
lastnamevvO W
:vvX Y
$strvvZ g
;vvg h
}ww 
TimeZoneInfoyy 
boliviaTimeZoneyy ,
=yy- .
TimeZoneInfoyy/ ;
.yy; <"
FindSystemTimeZoneByIdyy< R
(yyR S
$stryyS m
)yym n
;yyn o
DateTimezz 
boliviaTimezz $
=zz% &
TimeZoneInfozz' 3
.zz3 4
ConvertTimeFromUtczz4 F
(zzF G
DateTimezzG O
.zzO P
UtcNowzzP V
,zzV W
boliviaTimeZonezzX g
)zzg h
;zzh i
ViewBag{{ 
.{{ 
Id{{ 
={{ 
id{{ 
;{{  
ViewBag|| 
.|| 
CurrentYear|| #
=||$ %
boliviaTime||& 1
.||1 2
Year||2 6
;||6 7
ViewBag}} 
.}} 
CurrentMonth}} $
=}}% &
boliviaTime}}' 2
.}}2 3
Month}}3 8
;}}8 9
return 
View 
( 
reportesChofers +
)+ ,
;, -
}
ÄÄ 
catch
ÅÅ 
(
ÅÅ 
	Exception
ÅÅ 
)
ÅÅ 
{
ÇÇ 
return
ÉÉ 
RedirectToAction
ÉÉ '
(
ÉÉ' (
$str
ÉÉ( /
,
ÉÉ/ 0
$str
ÉÉ1 7
)
ÉÉ7 8
;
ÉÉ8 9
}
ÑÑ 
}
ÖÖ 	
public
àà 
ActionResult
àà "
ReportChoferEscogido
àà 0
(
àà0 1
int
àà1 4
year
àà5 9
,
àà9 :
int
àà; >
month
àà? D
,
ààD E
string
ààF L
id
ààM O
)
ààO P
{
ââ 	
try
ãã 
{
åå 
List
çç 
<
çç #
MostrarReportesChofer
çç *
>
çç* +
reportesFiltrados
çç, =
=
çç> ?
new
çç@ C
List
ççD H
<
ççH I#
MostrarReportesChofer
ççI ^
>
çç^ _
(
çç_ `
)
çç` a
;
çça b
using
èè 
(
èè 
dbModels
èè 
context
èè  '
=
èè( )
new
èè* -
dbModels
èè. 6
(
èè6 7
)
èè7 8
)
èè8 9
{
êê 
var
ëë 
report
ëë 
=
ëë  
context
ëë! (
.
ëë( )
Report
ëë) /
.
ëë/ 0
Where
ëë0 5
(
ëë5 6
x
ëë6 7
=>
ëë8 :
x
ëë; <
.
ëë< =

idEmployee
ëë= G
==
ëëH J
id
ëëK M
)
ëëM N
.
ëëN O
ToList
ëëO U
(
ëëU V
)
ëëV W
;
ëëW X
var
íí 
person
íí 
=
íí  
context
íí! (
.
íí( )
Person
íí) /
.
íí/ 0
Where
íí0 5
(
íí5 6
x
íí6 7
=>
íí8 :
x
íí; <
.
íí< =
nit
íí= @
==
ííA C
id
ííD F
)
ííF G
.
ííG H
FirstOrDefault
ííH V
(
ííV W
)
ííW X
;
ííX Y
var
ìì 
reportFiltrado
ìì &
=
ìì' (
report
ìì) /
.
îî 
Where
îî 
(
îî 
x
îî  
=>
îî! #
x
îî$ %
.
îî% &
dateRegister
îî& 2
.
îî2 3
HasValue
îî3 ;
&&
îî< >
x
îî? @
.
îî@ A
dateRegister
îîA M
.
îîM N
Value
îîN S
.
îîS T
Year
îîT X
==
îîY [
year
îî\ `
&&
îîa c
x
îîd e
.
îîe f
dateRegister
îîf r
.
îîr s
Value
îîs x
.
îîx y
Month
îîy ~
==îî Å
monthîîÇ á
)îîá à
.
ïï 
GroupBy
ïï  
(
ïï  !
r
ïï! "
=>
ïï# %
new
ïï& )
{
ïï* +
r
ïï, -
.
ïï- .
description
ïï. 9
,
ïï9 :
Month
ïï; @
=
ïïA B
r
ïïC D
.
ïïD E
dateRegister
ïïE Q
.
ïïQ R
Value
ïïR W
.
ïïW X
Month
ïïX ]
,
ïï] ^
Year
ïï_ c
=
ïïd e
r
ïïf g
.
ïïg h
dateRegister
ïïh t
.
ïït u
Value
ïïu z
.
ïïz {
Year
ïï{ 
}ïïÄ Å
)ïïÅ Ç
.
ññ 
Select
ññ 
(
ññ  
g
ññ  !
=>
ññ" $
new
ññ% (#
MostrarReportesChofer
ññ) >
(
ññ> ?
g
óó 
.
óó 
Key
óó !
.
óó! "
description
óó" -
,
óó- .
g
òò 
.
òò 
Key
òò !
.
òò! "
Month
òò" '
,
òò' (
g
ôô 
.
ôô 
Key
ôô !
.
ôô! "
Year
ôô" &
,
ôô& '
g
öö 
.
öö 
Count
öö #
(
öö# $
)
öö$ %
)
õõ 
)
õõ 
.
õõ 
ToList
õõ !
(
õõ! "
)
õõ" #
;
õõ# $
reportesFiltrados
ùù %
.
ùù% &
AddRange
ùù& .
(
ùù. /
reportFiltrado
ùù/ =
)
ùù= >
;
ùù> ?
ViewBag
ûû 
.
ûû 
name
ûû  
=
ûû! "
person
ûû# )
.
ûû) *
name
ûû* .
+
ûû/ 0
$str
ûû1 4
+
ûû5 6
person
ûû7 =
.
ûû= >
lastname
ûû> F
;
ûûF G
}
üü 
ViewBag
°° 
.
°° 
Year
°° 
=
°° 
year
°° #
;
°°# $
ViewBag
¢¢ 
.
¢¢ 
Month
¢¢ 
=
¢¢ 
month
¢¢  %
;
¢¢% &
return
§§ 
View
§§ 
(
§§ 
reportesFiltrados
§§ -
)
§§- .
;
§§. /
}
•• 
catch
¶¶ 
(
¶¶ 
	Exception
¶¶ 
)
¶¶ 
{
ßß 
return
®® 
RedirectToAction
®® '
(
®®' (
$str
®®( /
,
®®/ 0
$str
®®1 7
)
®®7 8
;
®®8 9
}
©© 
}
´´ 	
public
¨¨ 
ActionResult
¨¨ !
PrintedReportChofer
¨¨ /
(
¨¨/ 0
int
¨¨0 3
year
¨¨4 8
,
¨¨8 9
int
¨¨: =
month
¨¨> C
,
¨¨C D
string
¨¨E K
id
¨¨L N
)
¨¨N O
{
≠≠ 	
try
ÆÆ 
{
ØØ 
Login
∞∞ 
logi
∞∞ 
=
∞∞ 
new
∞∞  
Login
∞∞! &
(
∞∞& '
)
∞∞' (
;
∞∞( )
var
±± 

authResult
±± 
=
±±   
AutenticarPasosRol
±±! 3
(
±±3 4
$num
±±4 5
)
±±5 6
;
±±6 7
if
≤≤ 
(
≤≤ 

authResult
≤≤ 
!=
≤≤ !
null
≤≤" &
)
≤≤& '
return
≤≤( .

authResult
≤≤/ 9
;
≤≤9 :
TimeZoneInfo
≥≥ 
boliviaTimeZone
≥≥ ,
=
≥≥- .
TimeZoneInfo
≥≥/ ;
.
≥≥; <$
FindSystemTimeZoneById
≥≥< R
(
≥≥R S
$str
≥≥S m
)
≥≥m n
;
≥≥n o
DateTime
¥¥ 
boliviaTime
¥¥ $
=
¥¥% &
TimeZoneInfo
¥¥' 3
.
¥¥3 4
ConvertTime
¥¥4 ?
(
¥¥? @
DateTime
¥¥@ H
.
¥¥H I
UtcNow
¥¥I O
,
¥¥O P
boliviaTimeZone
¥¥Q `
)
¥¥` a
;
¥¥a b
return
µµ 
new
µµ 
ActionAsPdf
µµ &
(
µµ& '
$str
µµ' =
,
µµ= >
new
µµ? B
{
µµC D
year
µµE I
=
µµJ K
year
µµL P
,
µµP Q
month
µµR W
=
µµX Y
month
µµZ _
,
µµ_ `
id
µµ` b
=
µµc d
id
µµe g
}
µµh i
)
µµi j
{
µµk l
FileName
µµm u
=
µµv w
id
µµx z
+
µµ{ |
$strµµ} Ä
+µµÄ Å
monthµµÅ Ü
+µµÜ á
$strµµá ä
+µµã å
yearµµç ë
+µµí ì
$strµµî ó
+µµò ô
boliviaTimeµµö •
.µµ• ¶
Dayµµ¶ ©
+µµ™ ´
boliviaTimeµµ¨ ∑
.µµ∑ ∏
Monthµµ∏ Ω
+µµæ ø
boliviaTimeµµ¿ À
.µµÀ Ã
YearµµÃ –
+µµ— “
$strµµ” Ÿ
}µµ⁄ €
;µµ€ ‹
}
∂∂ 
catch
∑∑ 
(
∑∑ 
	Exception
∑∑ 
)
∑∑ 
{
∏∏ 
return
ππ 
RedirectToAction
ππ '
(
ππ' (
$str
ππ( /
,
ππ/ 0
$str
ππ1 7
)
ππ7 8
;
ππ8 9
}
∫∫ 
}
ªª 	
public
ºº 
ActionResult
ºº  
AutenticarPasosRol
ºº .
(
ºº. /
int
ºº/ 2
role
ºº3 7
)
ºº7 8
{
ΩΩ 	
if
ææ 
(
ææ 
!
ææ 
User
ææ 
.
ææ 
Identity
ææ 
.
ææ 
IsAuthenticated
ææ .
)
ææ. /
return
ææ0 6
RedirectToAction
ææ7 G
(
ææG H
$str
ææH O
,
ææO P
$str
ææQ W
)
ææW X
;
ææX Y
Login
øø 
logi
øø 
=
øø 
new
øø 
Login
øø "
(
øø" #
)
øø# $
;
øø$ %
int
¿¿ 
?
¿¿ 
roleSession
¿¿ 
=
¿¿ 
logi
¿¿ #
.
¿¿# $&
GetRoleSessionFromCookie
¿¿$ <
(
¿¿< =
Request
¿¿= D
)
¿¿D E
;
¿¿E F
if
¡¡ 
(
¡¡ 
roleSession
¡¡ 
==
¡¡ 
null
¡¡ #
||
¡¡$ &
roleSession
¡¡' 2
!=
¡¡3 5
role
¡¡6 :
)
¡¡: ;
return
¡¡< B
RedirectToAction
¡¡C S
(
¡¡S T
$str
¡¡T [
,
¡¡[ \
$str
¡¡] c
)
¡¡c d
;
¡¡d e
return
¬¬ 
null
¬¬ 
;
¬¬ 
}
√√ 	
public
ƒƒ 
ActionResult
ƒƒ 
ReportChoferView
ƒƒ ,
(
ƒƒ, -
)
ƒƒ- .
{
≈≈ 	
try
∆∆ 
{
«« 
Login
»» 
logi
»» 
=
»» 
new
»»  
Login
»»! &
(
»»& '
)
»»' (
;
»»( )
var
…… 

authResult
…… 
=
……   
AutenticarPasosRol
……! 3
(
……3 4
$num
……4 5
)
……5 6
;
……6 7
if
   
(
   

authResult
   
!=
   !
null
  " &
)
  & '
return
  ( .

authResult
  / 9
;
  9 :
string
ÃÃ 
id
ÃÃ 
=
ÃÃ 
logi
ÃÃ  
.
ÃÃ  !%
GetEmployeeIdFromCookie
ÃÃ! 8
(
ÃÃ8 9
Request
ÃÃ9 @
)
ÃÃ@ A
;
ÃÃA B
List
ÕÕ 
<
ÕÕ #
MostrarReportesChofer
ÕÕ *
>
ÕÕ* +
reportesChofers
ÕÕ, ;
=
ÕÕ< =
new
ÕÕ> A
List
ÕÕB F
<
ÕÕF G#
MostrarReportesChofer
ÕÕG \
>
ÕÕ\ ]
(
ÕÕ] ^
)
ÕÕ^ _
;
ÕÕ_ `
using
ŒŒ 
(
ŒŒ 
dbModels
ŒŒ 
context
ŒŒ  '
=
ŒŒ( )
new
ŒŒ* -
dbModels
ŒŒ. 6
(
ŒŒ6 7
)
ŒŒ7 8
)
ŒŒ8 9
{
œœ 
var
–– 
report
–– 
=
––  
context
––! (
.
––( )
Report
––) /
.
––/ 0
Where
––0 5
(
––5 6
x
––6 7
=>
––8 :
x
––; <
.
––< =

idEmployee
––= G
==
––H J
id
––K M
)
––M N
.
––N O
ToList
––O U
(
––U V
)
––V W
;
––W X
var
—— 
person
—— 
=
——  
context
——! (
.
——( )
Person
——) /
.
——/ 0
Where
——0 5
(
——5 6
x
——6 7
=>
——8 :
x
——; <
.
——< =
nit
——= @
==
——A C
id
——D F
)
——F G
.
——G H
FirstOrDefault
——H V
(
——V W
)
——W X
;
——X Y
if
”” 
(
”” 
report
”” 
.
”” 
Count
”” $
>
””% &
$num
””' (
&&
””) +
person
””, 2
!=
””3 5
null
””6 :
)
””: ;
{
‘‘ 
reportesChofers
’’ '
=
’’( )
report
’’* 0
.
÷÷ 
GroupBy
÷÷ $
(
÷÷$ %
r
÷÷% &
=>
÷÷' )
new
÷÷* -
{
÷÷. /
r
÷÷0 1
.
÷÷1 2
description
÷÷2 =
,
÷÷= >
Month
÷÷? D
=
÷÷E F
DateTime
÷÷G O
.
÷÷O P
Parse
÷÷P U
(
÷÷U V
r
÷÷V W
.
÷÷W X
dateRegister
÷÷X d
.
÷÷d e
ToString
÷÷e m
(
÷÷m n
)
÷÷n o
)
÷÷o p
.
÷÷p q
Month
÷÷q v
,
÷÷v w
Year
÷÷x |
=
÷÷} ~
DateTime÷÷ á
.÷÷á à
Parse÷÷à ç
(÷÷ç é
r÷÷é è
.÷÷è ê
dateRegister÷÷ê ú
.÷÷ú ù
ToString÷÷ù •
(÷÷• ¶
)÷÷¶ ß
)÷÷ß ®
.÷÷® ©
Year÷÷© ≠
}÷÷Æ Ø
)÷÷Ø ∞
.
◊◊ 
Select
◊◊ #
(
◊◊# $
g
◊◊$ %
=>
◊◊& (
new
◊◊) ,#
MostrarReportesChofer
◊◊- B
(
◊◊B C
g
ÿÿ  !
.
ÿÿ! "
Key
ÿÿ" %
.
ÿÿ% &
description
ÿÿ& 1
,
ÿÿ1 2
g
ŸŸ  !
.
ŸŸ! "
Key
ŸŸ" %
.
ŸŸ% &
Month
ŸŸ& +
,
ŸŸ+ ,
g
⁄⁄  !
.
⁄⁄! "
Key
⁄⁄" %
.
⁄⁄% &
Year
⁄⁄& *
,
⁄⁄* +
g
€€  !
.
€€! "
Count
€€" '
(
€€' (
)
€€( )
)
‹‹ 
)
‹‹ 
.
‹‹ 
ToList
‹‹ %
(
‹‹% &
)
‹‹& '
;
‹‹' (
}
›› 
ViewBag
ﬁﬁ 
.
ﬁﬁ 
Name
ﬁﬁ  
=
ﬁﬁ! "
person
ﬁﬁ# )
!=
ﬁﬁ* ,
null
ﬁﬁ- 1
?
ﬁﬁ2 3
person
ﬁﬁ4 :
.
ﬁﬁ: ;
name
ﬁﬁ; ?
+
ﬁﬁ@ A
$str
ﬁﬁB E
+
ﬁﬁF G
person
ﬁﬁH N
.
ﬁﬁN O
lastname
ﬁﬁO W
:
ﬁﬁX Y
$str
ﬁﬁZ g
;
ﬁﬁg h
}
ﬂﬂ 
TimeZoneInfo
·· 
boliviaTimeZone
·· ,
=
··- .
TimeZoneInfo
··/ ;
.
··; <$
FindSystemTimeZoneById
··< R
(
··R S
$str
··S m
)
··m n
;
··n o
DateTime
‚‚ 
boliviaTime
‚‚ $
=
‚‚% &
TimeZoneInfo
‚‚' 3
.
‚‚3 4 
ConvertTimeFromUtc
‚‚4 F
(
‚‚F G
DateTime
‚‚G O
.
‚‚O P
UtcNow
‚‚P V
,
‚‚V W
boliviaTimeZone
‚‚X g
)
‚‚g h
;
‚‚h i
ViewBag
„„ 
.
„„ 
Id
„„ 
=
„„ 
id
„„ 
;
„„  
ViewBag
‰‰ 
.
‰‰ 
CurrentYear
‰‰ #
=
‰‰$ %
boliviaTime
‰‰& 1
.
‰‰1 2
Year
‰‰2 6
;
‰‰6 7
ViewBag
ÂÂ 
.
ÂÂ 
CurrentMonth
ÂÂ $
=
ÂÂ% &
boliviaTime
ÂÂ' 2
.
ÂÂ2 3
Month
ÂÂ3 8
;
ÂÂ8 9
return
ÁÁ 
View
ÁÁ 
(
ÁÁ 
reportesChofers
ÁÁ +
)
ÁÁ+ ,
;
ÁÁ, -
}
ËË 
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
)
ÈÈ 
{
ÍÍ 
return
ÎÎ 
RedirectToAction
ÎÎ '
(
ÎÎ' (
$str
ÎÎ( /
,
ÎÎ/ 0
$str
ÎÎ1 7
)
ÎÎ7 8
;
ÎÎ8 9
}
ÏÏ 
}
ÌÌ 	
public
ÓÓ 
ActionResult
ÓÓ #
ReportRankingChoferes
ÓÓ 1
(
ÓÓ1 2
)
ÓÓ2 3
{
ÔÔ 	
try
 
{
ÒÒ 
Login
ÚÚ 
logi
ÚÚ 
=
ÚÚ 
new
ÚÚ  
Login
ÚÚ! &
(
ÚÚ& '
)
ÚÚ' (
;
ÚÚ( )
var
ÛÛ 

authResult
ÛÛ 
=
ÛÛ   
AutenticarPasosRol
ÛÛ! 3
(
ÛÛ3 4
$num
ÛÛ4 5
)
ÛÛ5 6
;
ÛÛ6 7
if
ÙÙ 
(
ÙÙ 

authResult
ÙÙ 
!=
ÙÙ !
null
ÙÙ" &
)
ÙÙ& '
return
ÙÙ( .

authResult
ÙÙ/ 9
;
ÙÙ9 :
string
ıı 
Linea
ıı 
=
ıı 
logi
ıı #
.
ıı# $ 
GetLineaFromCookie
ıı$ 6
(
ıı6 7
Request
ıı7 >
)
ıı> ?
.
ıı? @
ToString
ıı@ H
(
ııH I
)
ııI J
;
ııJ K
List
ˆˆ 
<
ˆˆ 
Employee
ˆˆ 
>
ˆˆ 
	employees
ˆˆ (
=
ˆˆ) *
new
ˆˆ+ .
List
ˆˆ/ 3
<
ˆˆ3 4
Employee
ˆˆ4 <
>
ˆˆ< =
(
ˆˆ= >
)
ˆˆ> ?
;
ˆˆ? @
List
˜˜ 
<
˜˜ 
ChoferRanking
˜˜ "
>
˜˜" #
listRank
˜˜$ ,
=
˜˜- .
new
˜˜/ 2
List
˜˜3 7
<
˜˜7 8
ChoferRanking
˜˜8 E
>
˜˜E F
(
˜˜F G
)
˜˜G H
;
˜˜H I
List
¯¯ 
<
¯¯ 
ChoferRanking
¯¯ "
>
¯¯" #!
listRankMesAnterior
¯¯$ 7
=
¯¯8 9
new
¯¯: =
List
¯¯> B
<
¯¯B C
ChoferRanking
¯¯C P
>
¯¯P Q
(
¯¯Q R
)
¯¯R S
;
¯¯S T
TimeZoneInfo
˘˘ 
boliviaTimeZone
˘˘ ,
=
˘˘- .
TimeZoneInfo
˘˘/ ;
.
˘˘; <$
FindSystemTimeZoneById
˘˘< R
(
˘˘R S
$str
˘˘S m
)
˘˘m n
;
˘˘n o
DateTime
˙˙ 
boliviaTime
˙˙ $
=
˙˙% &
TimeZoneInfo
˙˙' 3
.
˙˙3 4
ConvertTime
˙˙4 ?
(
˙˙? @
DateTime
˙˙@ H
.
˙˙H I
UtcNow
˙˙I O
,
˙˙O P
boliviaTimeZone
˙˙Q `
)
˙˙` a
;
˙˙a b
var
˚˚ "
primerDiaBoliviaTime
˚˚ (
=
˚˚) *
new
˚˚+ .
DateTime
˚˚/ 7
(
˚˚7 8
boliviaTime
˚˚8 C
.
˚˚C D
Year
˚˚D H
,
˚˚H I
boliviaTime
˚˚J U
.
˚˚U V
Month
˚˚V [
,
˚˚[ \
$num
˚˚] ^
)
˚˚^ _
;
˚˚_ `
var
¸¸ -
primerDiaBoliviaTimeMesAnterior
¸¸ 3
=
¸¸4 5"
primerDiaBoliviaTime
¸¸6 J
.
¸¸J K
	AddMonths
¸¸K T
(
¸¸T U
-
¸¸U V
$num
¸¸V W
)
¸¸W X
;
¸¸X Y
using
˝˝ 
(
˝˝ 
dbModels
˝˝ 
context
˝˝  '
=
˝˝( )
new
˝˝* -
dbModels
˝˝. 6
(
˝˝6 7
)
˝˝7 8
)
˝˝8 9
{
˛˛ 
	employees
ˇˇ 
=
ˇˇ 
context
ˇˇ  '
.
ˇˇ' (
Employee
ˇˇ( 0
.
ˇˇ0 1
Where
ˇˇ1 6
(
ˇˇ6 7
e
ˇˇ7 8
=>
ˇˇ9 ;
e
ˇˇ< =
.
ˇˇ= >
idLine
ˇˇ> D
==
ˇˇE G
Linea
ˇˇH M
&&
ˇˇN P
e
ˇˇQ R
.
ˇˇR S
status
ˇˇS Y
==
ˇˇZ \
$num
ˇˇ] ^
&&
ˇˇ_ a
e
ˇˇb c
.
ˇˇc d
plate
ˇˇd i
!=
ˇˇj l
null
ˇˇm q
)
ˇˇq r
.
ˇˇr s
ToList
ˇˇs y
(
ˇˇy z
)
ˇˇz {
;
ˇˇ{ |
if
ÄÄ 
(
ÄÄ 
	employees
ÄÄ !
.
ÄÄ! "
Count
ÄÄ" '
>
ÄÄ( )
$num
ÄÄ* +
)
ÄÄ+ ,
{
ÅÅ 
foreach
ÇÇ 
(
ÇÇ  !
var
ÇÇ! $
employee
ÇÇ% -
in
ÇÇ. 0
	employees
ÇÇ1 :
)
ÇÇ: ;
{
ÉÉ 
var
ÑÑ 
check1
ÑÑ  &
=
ÑÑ' (
context
ÑÑ) 0
.
ÑÑ0 1

Checkpoint
ÑÑ1 ;
.
ÑÑ; <
Where
ÑÑ< A
(
ÑÑA B
x
ÑÑB C
=>
ÑÑD F
x
ÑÑG H
.
ÑÑH I
idLine
ÑÑI O
==
ÑÑP R
Linea
ÑÑS X
&&
ÑÑY [
x
ÑÑ\ ]
.
ÑÑ] ^
status
ÑÑ^ d
==
ÑÑe g
$num
ÑÑh i
)
ÑÑi j
.
ÑÑj k
FirstOrDefault
ÑÑk y
(
ÑÑy z
)
ÑÑz {
;
ÑÑ{ |
var
ÖÖ 
check2
ÖÖ  &
=
ÖÖ' (
context
ÖÖ) 0
.
ÖÖ0 1

Checkpoint
ÖÖ1 ;
.
ÖÖ; <
Where
ÖÖ< A
(
ÖÖA B
x
ÖÖB C
=>
ÖÖD F
x
ÖÖG H
.
ÖÖH I
idLine
ÖÖI O
==
ÖÖP R
Linea
ÖÖS X
&&
ÖÖY [
x
ÖÖ\ ]
.
ÖÖ] ^
status
ÖÖ^ d
==
ÖÖe g
$num
ÖÖh i
)
ÖÖi j
.
ÖÖj k
FirstOrDefault
ÖÖk y
(
ÖÖy z
)
ÖÖz {
;
ÖÖ{ |
var
íí 
person
íí  &
=
íí' (
context
íí) 0
.
íí0 1
Person
íí1 7
.
íí7 8
Where
íí8 =
(
íí= >
x
íí> ?
=>
íí@ B
x
ííC D
.
ííD E
nit
ííE H
==
ííI K
employee
ííL T
.
ííT U

idEmployee
ííU _
)
íí_ `
.
íí` a
FirstOrDefault
íía o
(
íío p
)
ííp q
;
ííq r
var
ìì 
timeControls
ìì  ,
=
ìì- .
context
ìì/ 6
.
ìì6 7
TimeControl
ìì7 B
.
ììB C
Where
ììC H
(
ììH I
x
ììI J
=>
ììK M
x
ììN O
.
ììO P

idEmployee
ììP Z
==
ìì[ ]
employee
ìì^ f
.
ììf g

idEmployee
ììg q
&&
ììr t
(
ììu v
(
ììv w
x
ììw x
.
ììx y
idCheckpointììy Ö
==ììÜ à
check1ììâ è
.ììè ê
idCheckpointììê ú
&&ììù ü
(ìì† °
xìì° ¢
.ìì¢ £
enableìì£ ©
==ìì™ ¨
$numìì≠ Æ
||ììØ ±
xìì≤ ≥
.ìì≥ ¥
enableìì¥ ∫
==ììª Ω
$numììæ ø
)ììø ¿
)ìì¿ ¡
||ìì¬ ƒ
(ìì≈ ∆
xìì∆ «
.ìì« »
idCheckpointìì» ‘
==ìì’ ◊
check2ììÿ ﬁ
.ììﬁ ﬂ
idCheckpointììﬂ Î
&&ììÏ Ó
(ììÔ 
xìì Ò
.ììÒ Ú
enableììÚ ¯
==ìì˘ ˚
$numìì¸ ˝
||ìì˛ Ä
xììÅ Ç
.ììÇ É
enableììÉ â
==ììä å
$numììç é
)ììé è
)ììè ê
)ììê ë
)ììë í
.ììí ì
ToListììì ô
(ììô ö
)ììö õ
;ììõ ú
int
îî 

vueltasMes
îî  *
=
îî+ ,
timeControls
îî- 9
.
îî9 :
Where
îî: ?
(
îî? @
x
îî@ A
=>
îîB D
x
îîE F
.
îîF G
dateRegister
îîG S
>=
îîT V"
primerDiaBoliviaTime
îîW k
&&
îîl n
x
îîo p
.
îîp q
dateRegister
îîq }
<
îî~ $
primerDiaBoliviaTimeîîÄ î
.îîî ï
	AddMonthsîîï û
(îîû ü
$numîîü †
)îî† °
)îî° ¢
.îî¢ £
Countîî£ ®
(îî® ©
)îî© ™
;îî™ ´
int
ïï  
vueltasMesAmterior
ïï  2
=
ïï3 4
timeControls
ïï5 A
.
ïïA B
Where
ïïB G
(
ïïG H
x
ïïH I
=>
ïïJ L
x
ïïM N
.
ïïN O
dateRegister
ïïO [
>=
ïï\ ^-
primerDiaBoliviaTimeMesAnterior
ïï_ ~
&&ïï Å
xïïÇ É
.ïïÉ Ñ
dateRegisterïïÑ ê
<ïïë í$
primerDiaBoliviaTimeïïì ß
)ïïß ®
.ïï® ©
Countïï© Æ
(ïïÆ Ø
)ïïØ ∞
;ïï∞ ±
listRank
ññ $
.
ññ$ %
Add
ññ% (
(
ññ( )
new
ññ) ,
ChoferRanking
ññ- :
(
ññ: ;
person
ññ; A
.
ññA B
name
ññB F
+
ññG H
$str
ññI L
+
ññM N
person
ññO U
.
ññU V
lastname
ññV ^
,
ññ^ _

vueltasMes
ññ` j
,
ññj k
$num
ññl m
)
ññm n
)
ññn o
;
ñño p!
listRankMesAnterior
óó /
.
óó/ 0
Add
óó0 3
(
óó3 4
new
óó4 7
ChoferRanking
óó8 E
(
óóE F
person
óóF L
.
óóL M
name
óóM Q
+
óóR S
$str
óóT W
+
óóX Y
person
óóZ `
.
óó` a
lastname
óóa i
,
óói j 
vueltasMesAmterior
óók }
,
óó} ~
$numóó Ä
)óóÄ Å
)óóÅ Ç
;óóÇ É
}
òò 
listRank
ôô  
=
ôô! "
listRank
ôô# +
.
ôô+ ,
OrderByDescending
ôô, =
(
ôô= >
x
ôô> ?
=>
ôô@ B
x
ôôC D
.
ôôD E
vueltas
ôôE L
)
ôôL M
.
ôôM N
Take
ôôN R
(
ôôR S
$num
ôôS U
)
ôôU V
.
ôôV W
ToList
ôôW ]
(
ôô] ^
)
ôô^ _
;
ôô_ `!
listRankMesAnterior
öö +
=
öö, -!
listRankMesAnterior
öö. A
.
ööA B
OrderByDescending
ööB S
(
ööS T
x
ööT U
=>
ööV X
x
ööY Z
.
ööZ [
vueltas
öö[ b
)
ööb c
.
ööc d
Take
ööd h
(
ööh i
$num
ööi k
)
öök l
.
ööl m
ToList
ööm s
(
öös t
)
ööt u
;
ööu v
listRank
õõ  
=
õõ! "
listRank
õõ# +
.
õõ+ ,
Concat
õõ, 2
(
õõ2 3!
listRankMesAnterior
õõ3 F
)
õõF G
.
õõG H
ToList
õõH N
(
õõN O
)
õõO P
;
õõP Q
}
úú 
}
ùù 
return
ûû 
View
ûû 
(
ûû 
listRank
ûû $
)
ûû$ %
;
ûû% &
}
üü 
catch
†† 
(
†† 
	Exception
†† 
)
†† 
{
°° 
return
¢¢ 
RedirectToAction
¢¢ '
(
¢¢' (
$str
¢¢( /
,
¢¢/ 0
$str
¢¢1 7
)
¢¢7 8
;
¢¢8 9
}
££ 
}
•• 	
public
¶¶ 
ActionResult
¶¶ %
ReportIncidenciasChofer
¶¶ 3
(
¶¶3 4
string
¶¶4 :
id
¶¶; =
)
¶¶= >
{
ßß 	
try
®® 
{
©© 
Login
™™ 
logi
™™ 
=
™™ 
new
™™  
Login
™™! &
(
™™& '
)
™™' (
;
™™( )
var
´´ 

authResult
´´ 
=
´´   
AutenticarPasosRol
´´! 3
(
´´3 4
$num
´´4 5
)
´´5 6
;
´´6 7
if
¨¨ 
(
¨¨ 

authResult
¨¨ 
!=
¨¨ !
null
¨¨" &
)
¨¨& '
return
¨¨( .

authResult
¨¨/ 9
;
¨¨9 :
string
≠≠ 
Linea
≠≠ 
=
≠≠ 
logi
≠≠ #
.
≠≠# $ 
GetLineaFromCookie
≠≠$ 6
(
≠≠6 7
Request
≠≠7 >
)
≠≠> ?
.
≠≠? @
ToString
≠≠@ H
(
≠≠H I
)
≠≠I J
;
≠≠J K
Employee
ÆÆ 
employee
ÆÆ !
=
ÆÆ" #
new
ÆÆ$ '
Employee
ÆÆ( 0
(
ÆÆ0 1
)
ÆÆ1 2
;
ÆÆ2 3
List
ØØ 
<
ØØ !
ChoferObservaciones
ØØ (
>
ØØ( )
listObservaciones
ØØ* ;
=
ØØ< =
new
ØØ> A
List
ØØB F
<
ØØF G!
ChoferObservaciones
ØØG Z
>
ØØZ [
(
ØØ[ \
)
ØØ\ ]
;
ØØ] ^
MuestraRutasMapas
∞∞ !
muestraRutasMapas
∞∞" 3
=
∞∞4 5
new
∞∞6 9
MuestraRutasMapas
∞∞: K
(
∞∞K L
)
∞∞L M
;
∞∞M N
TimeZoneInfo
±± 
boliviaTimeZone
±± ,
=
±±- .
TimeZoneInfo
±±/ ;
.
±±; <$
FindSystemTimeZoneById
±±< R
(
±±R S
$str
±±S m
)
±±m n
;
±±n o
DateTime
≤≤ 
boliviaTime
≤≤ $
=
≤≤% &
TimeZoneInfo
≤≤' 3
.
≤≤3 4
ConvertTime
≤≤4 ?
(
≤≤? @
DateTime
≤≤@ H
.
≤≤H I
UtcNow
≤≤I O
,
≤≤O P
boliviaTimeZone
≤≤Q `
)
≤≤` a
;
≤≤a b
var
≥≥ "
primerDiaBoliviaTime
≥≥ (
=
≥≥) *
new
≥≥+ .
DateTime
≥≥/ 7
(
≥≥7 8
boliviaTime
≥≥8 C
.
≥≥C D
Year
≥≥D H
,
≥≥H I
boliviaTime
≥≥J U
.
≥≥U V
Month
≥≥V [
,
≥≥[ \
$num
≥≥] ^
)
≥≥^ _
;
≥≥_ `
var
¥¥ -
primerDiaBoliviaTimeMesAnterior
¥¥ 3
=
¥¥4 5"
primerDiaBoliviaTime
¥¥6 J
.
¥¥J K
	AddMonths
¥¥K T
(
¥¥T U
-
¥¥U V
$num
¥¥V W
)
¥¥W X
;
¥¥X Y
using
µµ 
(
µµ 
dbModels
µµ 
context
µµ  '
=
µµ( )
new
µµ* -
dbModels
µµ. 6
(
µµ6 7
)
µµ7 8
)
µµ8 9
{
∂∂ 
employee
∑∑ 
=
∑∑ 
context
∑∑ &
.
∑∑& '
Employee
∑∑' /
.
∑∑/ 0
Where
∑∑0 5
(
∑∑5 6
e
∑∑6 7
=>
∑∑8 :
e
∑∑; <
.
∑∑< =
idLine
∑∑= C
==
∑∑D F
Linea
∑∑G L
&&
∑∑M O
e
∑∑P Q
.
∑∑Q R
status
∑∑R X
==
∑∑Y [
$num
∑∑\ ]
&&
∑∑^ `
e
∑∑a b
.
∑∑b c
plate
∑∑c h
!=
∑∑i k
null
∑∑l p
&&
∑∑q s
e
∑∑t u
.
∑∑u v

idEmployee∑∑v Ä
==∑∑Å É
id∑∑Ñ Ü
)∑∑Ü á
.∑∑á à
FirstOrDefault∑∑à ñ
(∑∑ñ ó
)∑∑ó ò
;∑∑ò ô
var
∏∏ 
person
∏∏ 
=
∏∏  
context
∏∏! (
.
∏∏( )
Person
∏∏) /
.
∏∏/ 0
Where
∏∏0 5
(
∏∏5 6
x
∏∏6 7
=>
∏∏8 :
x
∏∏; <
.
∏∏< =
nit
∏∏= @
==
∏∏A C
id
∏∏D F
)
∏∏F G
.
∏∏G H
FirstOrDefault
∏∏H V
(
∏∏V W
)
∏∏W X
;
∏∏X Y
var
ππ  
timeControlsFilter
ππ *
=
ππ+ ,
context
ππ- 4
.
ππ4 5
TimeControl
ππ5 @
.
ππ@ A
Where
ππA F
(
ππF G
x
ππG H
=>
ππI K
x
ππL M
.
ππM N

idEmployee
ππN X
==
ππY [
employee
ππ\ d
.
ππd e

idEmployee
ππe o
)
ππo p
.
ππp q
GroupBy
ππq x
(
ππx y
x
ππy z
=>
ππ{ }
x
ππ~ 
.ππ Ä
	numTicketππÄ â
)ππâ ä
.ππä ã
Selectππã ë
(ππë í
gππí ì
=>ππî ñ
gππó ò
.ππò ô
FirstOrDefaultππô ß
(ππß ®
)ππ® ©
)ππ© ™
.ππ™ ´
ToListππ´ ±
(ππ± ≤
)ππ≤ ≥
;ππ≥ ¥
var
∫∫ 
groupedData
∫∫ #
=
∫∫$ % 
timeControlsFilter
∫∫& 8
.
ªª 
GroupBy
ªª  
(
ªª  !
x
ªª! "
=>
ªª# %
x
ªª& '
.
ªª' (
	numTicket
ªª( 1
)
ªª1 2
.
ºº 
Select
ºº 
(
ºº  
g
ºº  !
=>
ºº" $
g
ºº% &
.
ºº& '
First
ºº' ,
(
ºº, -
)
ºº- .
)
ºº. /
.
ΩΩ 
ToList
ΩΩ 
(
ΩΩ  
)
ΩΩ  !
;
ΩΩ! "
foreach
øø 
(
øø 
var
øø  
t
øø! "
in
øø# %
groupedData
øø& 1
)
øø1 2
{
¿¿ 
DateTime
¡¡  
final
¡¡! &
=
¡¡' (
boliviaTime
¡¡) 4
;
¡¡4 5
var
¬¬ 
timeControls
¬¬ (
=
¬¬) *
context
¬¬+ 2
.
¬¬2 3
TimeControl
¬¬3 >
.
¬¬> ?
Where
¬¬? D
(
¬¬D E
x
¬¬E F
=>
¬¬G I
x
¬¬J K
.
¬¬K L
	numTicket
¬¬L U
==
¬¬V X
t
¬¬[ \
.
¬¬\ ]
	numTicket
¬¬] f
&&
¬¬g i
x
¬¬j k
.
¬¬k l

idEmployee
¬¬l v
==
¬¬w y
t
¬¬z {
.
¬¬{ |

idEmployee¬¬| Ü
)¬¬Ü á
.¬¬á à
ToList¬¬à é
(¬¬é è
)¬¬è ê
;¬¬ê ë
var
√√ 
timess
√√ "
=
√√# $
timeControls
√√% 1
.
√√1 2
FirstOrDefault
√√2 @
(
√√@ A
)
√√A B
;
√√B C
var
ƒƒ 
	checksver
ƒƒ %
=
ƒƒ& '
context
ƒƒ( /
.
ƒƒ/ 0

Checkpoint
ƒƒ0 :
.
ƒƒ: ;
Where
ƒƒ; @
(
ƒƒ@ A
x
ƒƒA B
=>
ƒƒC E
x
ƒƒF G
.
ƒƒG H
idCheckpoint
ƒƒH T
==
ƒƒU W
timess
ƒƒX ^
.
ƒƒ^ _
idCheckpoint
ƒƒ_ k
)
ƒƒk l
.
ƒƒl m
FirstOrDefault
ƒƒm {
(
ƒƒ{ |
)
ƒƒ| }
;
ƒƒ} ~
var
≈≈ 
checkpoints
≈≈ '
=
≈≈( )
context
≈≈* 1
.
≈≈1 2

Checkpoint
≈≈2 <
.
≈≈< =
Where
≈≈= B
(
≈≈B C
x
≈≈C D
=>
≈≈E G
x
≈≈H I
.
≈≈I J
idLine
≈≈J P
==
≈≈Q S
Linea
≈≈T Y
&&
≈≈Z \
x
≈≈] ^
.
≈≈^ _
status
≈≈_ e
!=
≈≈f h
$num
≈≈i j
&&
≈≈k m
x
≈≈n o
.
≈≈o p
numberRoute
≈≈p {
==
≈≈| ~
	checksver≈≈ à
.≈≈à â
numberRoute≈≈â î
)≈≈î ï
.≈≈ï ñ
ToList≈≈ñ ú
(≈≈ú ù
)≈≈ù û
;≈≈û ü
if
∆∆ 
(
∆∆ 
timeControls
∆∆ (
.
∆∆( )
Any
∆∆) ,
(
∆∆, -
)
∆∆- .
)
∆∆. /
{
«« 
int
»» 
statusPrimera
»»  -
=
»». /
$num
»»0 1
;
»»1 2
if
…… 
(
……  
t
……  !
.
……! "
enable
……" (
==
……) +
$num
……, -
||
……. 0
t
……1 2
.
……2 3
enable
……3 9
==
……: <
$num
……= >
)
……> ?
statusPrimera
……@ M
=
……N O
$num
……P Q
;
……Q R

Checkpoint
   &
primerCheckpoint
  ' 7
=
  8 9
checkpoints
  : E
.
  E F
FirstOrDefault
  F T
(
  T U
r
  U V
=>
  W Y
r
  Z [
.
  [ \
status
  \ b
==
  c e
statusPrimera
  f s
)
  s t
;
  t u
List
ÀÀ  
<
ÀÀ  !

Checkpoint
ÀÀ! +
>
ÀÀ+ ,
checkpointsorder
ÀÀ- =
=
ÀÀ> ?
new
ÀÀ@ C
List
ÀÀD H
<
ÀÀH I

Checkpoint
ÀÀI S
>
ÀÀS T
(
ÀÀT U
)
ÀÀU V
;
ÀÀV W
if
ÃÃ 
(
ÃÃ  
primerCheckpoint
ÃÃ  0
!=
ÃÃ1 3
null
ÃÃ4 8
)
ÃÃ8 9
{
ÕÕ 
checkpointsorder
ŒŒ  0
=
ŒŒ1 2
checkpoints
ŒŒ3 >
.
œœ$ %
OrderBy
œœ% ,
(
œœ, -
route
œœ- 2
=>
œœ3 5
muestraRutasMapas
œœ6 G
.
œœG H(
CalcularDistanciaHaversine
œœH b
(
œœb c
(
––( )
decimal
––) 0
)
––0 1
primerCheckpoint
––1 A
.
––A B
latitud
––B I
,
––I J
(
——( )
decimal
——) 0
)
——0 1
primerCheckpoint
——1 A
.
——A B
longitud
——B J
,
——J K
route
““( -
.
““- .
latitud
““. 5
,
““5 6
route
””( -
.
””- .
longitud
””. 6
)
””6 7
)
””7 8
.
‘‘$ %
ToList
‘‘% +
(
‘‘+ ,
)
‘‘, -
;
‘‘- .
}
’’ 
timeControls
÷÷ (
=
÷÷) *
timeControls
÷÷+ 7
.
÷÷7 8
OrderBy
÷÷8 ?
(
÷÷? @
x
÷÷@ A
=>
÷÷B D
x
÷÷E F
.
÷÷F G
dateRegister
÷÷G S
)
÷÷S T
.
÷÷T U
ToList
÷÷U [
(
÷÷[ \
)
÷÷\ ]
;
÷÷] ^
foreach
◊◊ #
(
◊◊$ %
var
◊◊% (
item
◊◊) -
in
◊◊. 0
timeControls
◊◊1 =
)
◊◊= >
{
ÿÿ 
if
ŸŸ  "
(
ŸŸ# $
item
ŸŸ$ (
.
ŸŸ( )
dateRegister
ŸŸ) 5
==
ŸŸ6 8
null
ŸŸ9 =
)
ŸŸ= >
{
⁄⁄  !
var
€€$ '
check
€€( -
=
€€. /
context
€€0 7
.
€€7 8

Checkpoint
€€8 B
.
€€B C
Where
€€C H
(
€€H I
x
€€I J
=>
€€K M
x
€€N O
.
€€O P
idCheckpoint
€€P \
==
€€] _
item
€€` d
.
€€d e
idCheckpoint
€€e q
)
€€q r
.
€€r s
FirstOrDefault€€s Å
(€€Å Ç
)€€Ç É
;€€É Ñ
listObservaciones
‹‹$ 5
.
‹‹5 6
Add
‹‹6 9
(
‹‹9 :
new
‹‹: =!
ChoferObservaciones
‹‹> Q
(
‹‹Q R
$str
‹‹R o
+
‹‹p q
check
‹‹r w
.
‹‹w x
description‹‹x É
+‹‹É Ñ
$str‹‹Ö ç
+‹‹ç é
check‹‹é ì
.‹‹ì î
numberRoute‹‹î ü
,‹‹ü †
DateTime‹‹† ®
.‹‹® ©
Parse‹‹© Æ
(‹‹Æ Ø
t‹‹Ø ∞
.‹‹∞ ±
dateRegister‹‹± Ω
.‹‹Ω æ
ToString‹‹æ ∆
(‹‹∆ «
)‹‹« »
)‹‹» …
)‹‹…  
)‹‹  À
;‹‹À Ã
}
››  !
if
ﬁﬁ  "
(
ﬁﬁ# $
item
ﬁﬁ$ (
.
ﬁﬁ( )
enable
ﬁﬁ) /
>
ﬁﬁ0 1
$num
ﬁﬁ2 3
&&
ﬁﬁ4 6
item
ﬁﬁ7 ;
.
ﬁﬁ; <
dateRegister
ﬁﬁ< H
!=
ﬁﬁI K
null
ﬁﬁL P
)
ﬁﬁP Q
{
ﬂﬂ  !
var
‡‡$ '
check
‡‡( -
=
‡‡. /
context
‡‡0 7
.
‡‡7 8

Checkpoint
‡‡8 B
.
‡‡B C
Where
‡‡C H
(
‡‡H I
x
‡‡I J
=>
‡‡K M
x
‡‡N O
.
‡‡O P
idCheckpoint
‡‡P \
==
‡‡] _
item
‡‡` d
.
‡‡d e
idCheckpoint
‡‡e q
)
‡‡q r
.
‡‡r s
FirstOrDefault‡‡s Å
(‡‡Å Ç
)‡‡Ç É
;‡‡É Ñ
var
··$ '
timeControlChofer
··( 9
=
··: ;
context
··< C
.
··C D
TimeControl
··D O
.
··O P
Where
··P U
(
··U V
x
··V W
=>
··X Z
x
··[ \
.
··\ ]
idCheckpoint
··] i
==
··j l
check
··m r
.
··r s
idCheckpoint
··s 
)·· Ä
.··Ä Å
ToList··Å á
(··á à
)··à â
;··â ä
var
‚‚$ '
ticketCercano
‚‚( 5
=
‚‚6 7
timeControlChofer
‚‚8 I
.
‚‚I J
Where
‚‚J O
(
‚‚O P
x
‚‚P Q
=>
‚‚R T
x
‚‚U V
.
‚‚V W
	numTicket
‚‚W `
>
‚‚a b
t
‚‚c d
.
‚‚d e
	numTicket
‚‚e n
)
‚‚n o
.
‚‚o p
OrderBy
‚‚p w
(
‚‚w x
x
‚‚x y
=>
‚‚z |
x
‚‚} ~
.
‚‚~ 
	numTicket‚‚ à
)‚‚à â
.‚‚â ä
FirstOrDefault‚‚ä ò
(‚‚ò ô
)‚‚ô ö
;‚‚ö õ
var
„„$ '%
timeControlChoferLePaso
„„( ?
=
„„@ A
context
„„B I
.
„„I J
TimeControl
„„J U
.
„„U V
Where
„„V [
(
„„[ \
x
„„\ ]
=>
„„^ `
x
„„a b
.
„„b c
	numTicket
„„c l
==
„„m o
ticketCercano
„„p }
.
„„} ~
	numTicket„„~ á
&&„„à ä
x„„ã å
.„„å ç
idCheckpoint„„ç ô
==„„ö ú
item„„ù °
.„„° ¢
idCheckpoint„„¢ Æ
)„„Æ Ø
.„„Ø ∞
FirstOrDefault„„∞ æ
(„„æ ø
)„„ø ¿
;„„¿ ¡
var
‰‰$ '
chofer
‰‰( .
=
‰‰/ 0
context
‰‰1 8
.
‰‰8 9
Person
‰‰9 ?
.
‰‰? @
Where
‰‰@ E
(
‰‰E F
x
‰‰F G
=>
‰‰H J
x
‰‰K L
.
‰‰L M
nit
‰‰M P
==
‰‰Q S%
timeControlChoferLePaso
‰‰T k
.
‰‰k l

idEmployee
‰‰l v
)
‰‰v w
.
‰‰w x
FirstOrDefault‰‰x Ü
(‰‰Ü á
)‰‰á à
;‰‰à â
listObservaciones
ÂÂ$ 5
.
ÂÂ5 6
Add
ÂÂ6 9
(
ÂÂ9 :
new
ÂÂ: =!
ChoferObservaciones
ÂÂ> Q
(
ÂÂQ R
$str
ÂÂR i
+
ÂÂj k
chofer
ÂÂl r
.
ÂÂr s
name
ÂÂs w
+
ÂÂx y
$str
ÂÂz }
+
ÂÂ~ 
choferÂÂÄ Ü
.ÂÂÜ á
lastnameÂÂá è
+ÂÂê ë
$strÂÂí ò
+ÂÂô ö
checkÂÂõ †
.ÂÂ† °
descriptionÂÂ° ¨
+ÂÂ¨ ≠
$strÂÂÆ ∂
+ÂÂ∂ ∑
checkÂÂ∑ º
.ÂÂº Ω
numberRouteÂÂΩ »
,ÂÂ» …
DateTimeÂÂ  “
.ÂÂ“ ”
ParseÂÂ” ÿ
(ÂÂÿ Ÿ
tÂÂŸ ⁄
.ÂÂ⁄ €
dateRegisterÂÂ€ Á
.ÂÂÁ Ë
ToStringÂÂË 
(ÂÂ Ò
)ÂÂÒ Ú
)ÂÂÚ Û
)ÂÂÛ Ù
)ÂÂÙ ı
;ÂÂı ˆ
}
ÊÊ  !
}
ÁÁ 
List
ËË  
<
ËË  !
TimeControl
ËË! ,
>
ËË, -
orderTimeControl
ËË. >
=
ËË? @
new
ËËA D
List
ËËE I
<
ËËI J
TimeControl
ËËJ U
>
ËËU V
(
ËËV W
)
ËËW X
;
ËËX Y
foreach
ÈÈ #
(
ÈÈ$ %
var
ÈÈ% (
item
ÈÈ) -
in
ÈÈ. 0
checkpointsorder
ÈÈ1 A
)
ÈÈA B
{
ÍÍ 
TimeControl
ÎÎ  +
timeControlOrder
ÎÎ, <
=
ÎÎ= >
timeControls
ÎÎ? K
.
ÎÎK L
Where
ÎÎL Q
(
ÎÎQ R
x
ÎÎR S
=>
ÎÎT V
x
ÎÎW X
.
ÎÎX Y
idCheckpoint
ÎÎY e
==
ÎÎf h
item
ÎÎi m
.
ÎÎm n
idCheckpoint
ÎÎn z
)
ÎÎz {
.
ÎÎ{ |
FirstOrDefaultÎÎ| ä
(ÎÎä ã
)ÎÎã å
;ÎÎå ç
orderTimeControl
ÏÏ  0
.
ÏÏ0 1
Add
ÏÏ1 4
(
ÏÏ4 5
timeControlOrder
ÏÏ5 E
)
ÏÏE F
;
ÏÏF G
}
ÌÌ 
if
ÓÓ 
(
ÓÓ  
t
ÓÓ  !
.
ÓÓ! "
enable
ÓÓ" (
==
ÓÓ) +
$num
ÓÓ, -
||
ÓÓ. 0
t
ÓÓ1 2
.
ÓÓ2 3
enable
ÓÓ3 9
==
ÓÓ: <
$num
ÓÓ= >
)
ÓÓ> ?
{
ÔÔ 
for
  #
(
$ %
int
% (
i
) *
=
+ ,
$num
- .
;
. /
i
0 1
<
2 3
orderTimeControl
4 D
.
D E
Count
E J
-
K L
$num
M N
;
N O
i
P Q
++
Q S
)
S T
{
ÒÒ  !
if
ÚÚ$ &
(
ÚÚ' (
orderTimeControl
ÚÚ( 8
[
ÚÚ8 9
i
ÚÚ9 :
+
ÚÚ; <
$num
ÚÚ= >
]
ÚÚ> ?
.
ÚÚ? @
dateRegister
ÚÚ@ L
.
ÚÚL M
HasValue
ÚÚM U
&&
ÚÚV X
orderTimeControl
ÚÚY i
[
ÚÚi j
i
ÚÚj k
]
ÚÚk l
.
ÚÚl m
dateRegister
ÚÚm y
.
ÚÚy z
HasValueÚÚz Ç
)ÚÚÇ É
{
ÛÛ$ %
var
ÙÙ( +
checkpointPrimer
ÙÙ, <
=
ÙÙ= >
checkpoints
ÙÙ? J
.
ÙÙJ K
Where
ÙÙK P
(
ÙÙP Q
x
ÙÙQ R
=>
ÙÙS U
x
ÙÙV W
.
ÙÙW X
status
ÙÙX ^
==
ÙÙ_ a
$num
ÙÙb c
&&
ÙÙd f
x
ÙÙg h
.
ÙÙh i
idLine
ÙÙi o
==
ÙÙp r
Linea
ÙÙs x
)
ÙÙx y
.
ÙÙy z
FirstOrDefaultÙÙz à
(ÙÙà â
)ÙÙâ ä
;ÙÙä ã
var
ıı( +
timeControlInicio
ıı, =
=
ıı> ?
timeControls
ıı@ L
.
ııL M
Where
ııM R
(
ııR S
x
ııS T
=>
ııU W
x
ııX Y
.
ııY Z
idCheckpoint
ııZ f
==
ııg i
checkpointPrimer
ııj z
.
ıız {
idCheckpointıı{ á
&&ııà ä
tııã å
.ııå ç
	numTicketııç ñ
==ııó ô
xııö õ
.ııõ ú
	numTicketııú •
)ıı• ¶
.ıı¶ ß
FirstOrDefaultııß µ
(ııµ ∂
)ıı∂ ∑
;ıı∑ ∏

Checkpoint
ˆˆ( 2
checkpoint1
ˆˆ3 >
=
ˆˆ? @
new
ˆˆA D

Checkpoint
ˆˆE O
(
ˆˆO P
)
ˆˆP Q
;
ˆˆQ R
double
˜˜( .
minutosParaParada
˜˜/ @
=
˜˜A B
$num
˜˜C D
;
˜˜D E
double
¯¯( .
medicionTime
¯¯/ ;
=
¯¯< =
(
¯¯> ?
orderTimeControl
¯¯? O
[
¯¯O P
i
¯¯P Q
+
¯¯R S
$num
¯¯T U
]
¯¯U V
.
¯¯V W
dateRegister
¯¯W c
.
¯¯c d
Value
¯¯d i
-
¯¯j k
orderTimeControl
¯¯l |
[
¯¯| }
i
¯¯} ~
]
¯¯~ 
.¯¯ Ä
dateRegister¯¯Ä å
.¯¯å ç
Value¯¯ç í
)¯¯í ì
.¯¯ì î
TotalMinutes¯¯î †
;¯¯† °
checkpoint1
˘˘( 3
=
˘˘4 5
checkpointsorder
˘˘6 F
.
˘˘F G
Where
˘˘G L
(
˘˘L M
x
˘˘M N
=>
˘˘O Q
x
˘˘R S
.
˘˘S T
idCheckpoint
˘˘T `
==
˘˘a c
orderTimeControl
˘˘d t
[
˘˘t u
i
˘˘u v
+
˘˘w x
$num
˘˘y z
]
˘˘z {
.
˘˘{ |
idCheckpoint˘˘| à
)˘˘à â
.˘˘â ä
FirstOrDefault˘˘ä ò
(˘˘ò ô
)˘˘ô ö
;˘˘ö õ
TimeSpan
˙˙( 0
timeSpan
˙˙1 9
=
˙˙: ;
new
˙˙< ?
TimeSpan
˙˙@ H
(
˙˙H I
)
˙˙I J
;
˙˙J K
if
˚˚( *
(
˚˚+ ,
DateTime
˚˚, 4
.
˚˚4 5
Parse
˚˚5 :
(
˚˚: ;
timeControlInicio
˚˚; L
.
˚˚L M
dateRegister
˚˚M Y
.
˚˚Y Z
ToString
˚˚Z b
(
˚˚b c
)
˚˚c d
)
˚˚d e
.
˚˚e f
	DayOfWeek
˚˚f o
==
˚˚p r
	DayOfWeek
˚˚s |
.
˚˚| }
	Wednesday˚˚} Ü
||˚˚á â
DateTime˚˚ä í
.˚˚í ì
Parse˚˚ì ò
(˚˚ò ô!
timeControlInicio˚˚ô ™
.˚˚™ ´
dateRegister˚˚´ ∑
.˚˚∑ ∏
ToString˚˚∏ ¿
(˚˚¿ ¡
)˚˚¡ ¬
)˚˚¬ √
.˚˚√ ƒ
	DayOfWeek˚˚ƒ Õ
==˚˚Œ –
	DayOfWeek˚˚— ⁄
.˚˚⁄ €
Saturday˚˚€ „
)˚˚„ ‰
{
¸¸( )
string
˝˝, 2
[
˝˝2 3
]
˝˝3 4
partes
˝˝5 ;
=
˝˝< =
checkpoint1
˝˝> I
.
˝˝I J
minArrivalMarket
˝˝J Z
.
˝˝Z [
Trim
˝˝[ _
(
˝˝_ `
)
˝˝` a
.
˝˝a b
Split
˝˝b g
(
˝˝g h
$char
˝˝h k
)
˝˝k l
;
˝˝l m
minutosParaParada
˛˛, =
=
˛˛> ?
(
˛˛@ A
double
˛˛A G
.
˛˛G H
Parse
˛˛H M
(
˛˛M N
partes
˛˛N T
[
˛˛T U
$num
˛˛U V
]
˛˛V W
)
˛˛W X
*
˛˛Y Z
$num
˛˛[ ]
)
˛˛] ^
+
˛˛_ `
double
˛˛a g
.
˛˛g h
Parse
˛˛h m
(
˛˛m n
partes
˛˛n t
[
˛˛t u
$num
˛˛u v
]
˛˛v w
)
˛˛w x
;
˛˛x y
}
ˇˇ( )
else
ÄÄ( ,
{
ÅÅ( )
string
ÇÇ, 2
[
ÇÇ2 3
]
ÇÇ3 4
partes
ÇÇ5 ;
=
ÇÇ< =
checkpoint1
ÇÇ> I
.
ÇÇI J

minArrival
ÇÇJ T
.
ÇÇT U
Trim
ÇÇU Y
(
ÇÇY Z
)
ÇÇZ [
.
ÇÇ[ \
Split
ÇÇ\ a
(
ÇÇa b
$char
ÇÇb e
)
ÇÇe f
;
ÇÇf g
minutosParaParada
ÉÉ, =
=
ÉÉ> ?
(
ÉÉ@ A
double
ÉÉA G
.
ÉÉG H
Parse
ÉÉH M
(
ÉÉM N
partes
ÉÉN T
[
ÉÉT U
$num
ÉÉU V
]
ÉÉV W
)
ÉÉW X
*
ÉÉY Z
$num
ÉÉ[ ]
)
ÉÉ] ^
+
ÉÉ_ `
double
ÉÉa g
.
ÉÉg h
Parse
ÉÉh m
(
ÉÉm n
partes
ÉÉn t
[
ÉÉt u
$num
ÉÉu v
]
ÉÉv w
)
ÉÉw x
;
ÉÉx y
}
ÑÑ( )
double
ÖÖ( .
diferenciaMinutos
ÖÖ/ @
=
ÖÖA B
medicionTime
ÖÖC O
-
ÖÖP Q
minutosParaParada
ÖÖR c
;
ÖÖc d
int
ÜÜ( +

diferencia
ÜÜ, 6
=
ÜÜ7 8
(
ÜÜ9 :
int
ÜÜ: =
)
ÜÜ= >
Math
ÜÜ> B
.
ÜÜB C
Floor
ÜÜC H
(
ÜÜH I
diferenciaMinutos
ÜÜI Z
)
ÜÜZ [
;
ÜÜ[ \
var
áá( +
check
áá, 1
=
áá2 3
checkpoints
áá4 ?
.
áá? @
Where
áá@ E
(
ááE F
x
ááF G
=>
ááH J
x
ááK L
.
ááL M
idCheckpoint
ááM Y
==
ááZ \
orderTimeControl
áá] m
[
áám n
i
áán o
+
ááp q
$num
áár s
]
áás t
.
áát u
idCheckpointááu Å
)ááÅ Ç
.ááÇ É
FirstOrDefaultááÉ ë
(ááë í
)ááí ì
;ááì î
if
àà( *
(
àà+ ,
minutosParaParada
àà, =
<
àà> ?
medicionTime
àà@ L
)
ààL M
{
ââ( )
listObservaciones
ää, =
.
ää= >
Add
ää> A
(
ääA B
new
ääB E!
ChoferObservaciones
ääF Y
(
ääY Z
$str
ääZ w
+
ääx y
check
ääz 
.ää Ä
descriptionääÄ ã
+ääå ç
$strääé ï
+ääñ ó

diferenciaääò ¢
+ää£ §
$strää• ±
+ää± ≤
checkää≤ ∑
.ää∑ ∏
numberRouteää∏ √
,ää√ ƒ
DateTimeääƒ Ã
.ääÃ Õ
ParseääÕ “
(ää“ ”
tää” ‘
.ää‘ ’
dateRegisterää’ ·
.ää· ‚
ToStringää‚ Í
(ääÍ Î
)ääÎ Ï
)ääÏ Ì
)ääÌ Ó
)ääÓ Ô
;ääÔ 
}
ãã( )
}
åå$ %
}
çç  !
}
éé 
else
èè  
if
èè! #
(
èè$ %
t
èè% &
.
èè& '
enable
èè' -
==
èè. 0
$num
èè1 2
||
èè3 5
t
èè6 7
.
èè7 8
enable
èè8 >
==
èè? A
$num
èèB C
)
èèC D
{
êê 
for
ëë  #
(
ëë$ %
int
ëë% (
i
ëë) *
=
ëë+ ,
$num
ëë- .
;
ëë. /
i
ëë0 1
<
ëë2 3
checkpoints
ëë4 ?
.
ëë? @
Count
ëë@ E
-
ëëF G
$num
ëëH I
;
ëëI J
i
ëëK L
++
ëëL N
)
ëëN O
{
íí  !
if
ìì$ &
(
ìì' (
orderTimeControl
ìì( 8
[
ìì8 9
i
ìì9 :
]
ìì: ;
.
ìì; <
dateRegister
ìì< H
.
ììH I
HasValue
ììI Q
&&
ììR T
orderTimeControl
ììU e
[
ììe f
i
ììf g
+
ììh i
$num
ììj k
]
ììk l
.
ììl m
dateRegister
ììm y
.
ììy z
HasValueììz Ç
)ììÇ É
{
îî$ %
var
ïï( +
checkpointPrimer
ïï, <
=
ïï= >
checkpoints
ïï? J
.
ïïJ K
Where
ïïK P
(
ïïP Q
x
ïïQ R
=>
ïïS U
x
ïïV W
.
ïïW X
status
ïïX ^
==
ïï_ a
$num
ïïb c
&&
ïïd f
x
ïïg h
.
ïïh i
idLine
ïïi o
==
ïïp r
Linea
ïïs x
)
ïïx y
.
ïïy z
FirstOrDefaultïïz à
(ïïà â
)ïïâ ä
;ïïä ã
var
ññ( +
timeControlInicio
ññ, =
=
ññ> ?
timeControls
ññ@ L
.
ññL M
Where
ññM R
(
ññR S
x
ññS T
=>
ññU W
x
ññX Y
.
ññY Z
idCheckpoint
ññZ f
==
ññg i
checkpointPrimer
ññj z
.
ññz {
idCheckpointññ{ á
&&ññà ä
tññã å
.ññå ç
	numTicketññç ñ
==ññó ô
xññö õ
.ññõ ú
	numTicketññú •
)ññ• ¶
.ññ¶ ß
FirstOrDefaultññß µ
(ññµ ∂
)ññ∂ ∑
;ññ∑ ∏

Checkpoint
óó( 2
checkpoint1
óó3 >
=
óó? @
new
óóA D

Checkpoint
óóE O
(
óóO P
)
óóP Q
;
óóQ R
double
òò( .
minutosParaParada
òò/ @
=
òòA B
$num
òòC D
;
òòD E
double
ôô( .
medicionTime
ôô/ ;
=
ôô< =
(
ôô> ?
orderTimeControl
ôô? O
[
ôôO P
i
ôôP Q
+
ôôR S
$num
ôôT U
]
ôôU V
.
ôôV W
dateRegister
ôôW c
.
ôôc d
Value
ôôd i
-
ôôj k
orderTimeControl
ôôl |
[
ôô| }
i
ôô} ~
]
ôô~ 
.ôô Ä
dateRegisterôôÄ å
.ôôå ç
Valueôôç í
)ôôí ì
.ôôì î
TotalMinutesôôî †
;ôô† °
checkpoint1
öö( 3
=
öö4 5
checkpoints
öö6 A
.
ööA B
Where
ööB G
(
ööG H
x
ööH I
=>
ööJ L
x
ööM N
.
ööN O
idCheckpoint
ööO [
==
öö\ ^
orderTimeControl
öö_ o
[
ööo p
i
ööp q
]
ööq r
.
öör s
idCheckpoint
öös 
)öö Ä
.ööÄ Å
FirstOrDefaultööÅ è
(ööè ê
)ööê ë
;ööë í
TimeSpan
õõ( 0
timeSpan
õõ1 9
=
õõ: ;
new
õõ< ?
TimeSpan
õõ@ H
(
õõH I
)
õõI J
;
õõJ K
if
úú( *
(
úú+ ,
DateTime
úú, 4
.
úú4 5
Parse
úú5 :
(
úú: ;
timeControlInicio
úú; L
.
úúL M
dateRegister
úúM Y
.
úúY Z
ToString
úúZ b
(
úúb c
)
úúc d
)
úúd e
.
úúe f
	DayOfWeek
úúf o
==
úúp r
	DayOfWeek
úús |
.
úú| }
	Wednesdayúú} Ü
||úúá â
DateTimeúúä í
.úúí ì
Parseúúì ò
(úúò ô!
timeControlInicioúúô ™
.úú™ ´
dateRegisterúú´ ∑
.úú∑ ∏
ToStringúú∏ ¿
(úú¿ ¡
)úú¡ ¬
)úú¬ √
.úú√ ƒ
	DayOfWeekúúƒ Õ
==úúŒ –
	DayOfWeekúú— ⁄
.úú⁄ €
Saturdayúú€ „
)úú„ ‰
timeSpan
ùù, 4
=
ùù5 6
TimeSpan
ùù7 ?
.
ùù? @
Parse
ùù@ E
(
ùùE F
checkpoint1
ùùF Q
.
ùùQ R
minArrivalMarket
ùùR b
)
ùùb c
;
ùùc d
else
ûû( ,
timeSpan
ûû- 5
=
ûû6 7
TimeSpan
ûû8 @
.
ûû@ A
Parse
ûûA F
(
ûûF G
checkpoint1
ûûG R
.
ûûR S

minArrival
ûûS ]
)
ûû] ^
;
ûû^ _
minutosParaParada
üü( 9
=
üü: ;
timeSpan
üü< D
.
üüD E
TotalMinutes
üüE Q
;
üüQ R
double
††( .
diferenciaMinutos
††/ @
=
††A B
medicionTime
††C O
-
††P Q
minutosParaParada
††R c
;
††c d
int
°°( +

diferencia
°°, 6
=
°°7 8
(
°°9 :
int
°°: =
)
°°= >
Math
°°> B
.
°°B C
Floor
°°C H
(
°°H I
diferenciaMinutos
°°I Z
)
°°Z [
;
°°[ \
var
¢¢( +
check
¢¢, 1
=
¢¢2 3
checkpoints
¢¢4 ?
.
¢¢? @
Where
¢¢@ E
(
¢¢E F
x
¢¢F G
=>
¢¢H J
x
¢¢K L
.
¢¢L M
idCheckpoint
¢¢M Y
==
¢¢Z \
orderTimeControl
¢¢] m
[
¢¢m n
i
¢¢n o
+
¢¢p q
$num
¢¢r s
]
¢¢s t
.
¢¢t u
idCheckpoint¢¢u Å
)¢¢Å Ç
.¢¢Ç É
FirstOrDefault¢¢É ë
(¢¢ë í
)¢¢í ì
;¢¢ì î
if
££( *
(
££+ ,
minutosParaParada
££, =
<
££> ?
medicionTime
££@ L
)
££L M
{
§§( )
listObservaciones
••, =
.
••= >
Add
••> A
(
••A B
new
••B E!
ChoferObservaciones
••F Y
(
••Y Z
$str
••Z w
+
••x y
check
••z 
.•• Ä
description••Ä ã
+••å ç
$str••é ï
+••ñ ó

diferencia••ò ¢
+••£ §
$str••• ±
+••± ≤
check••≤ ∑
.••∑ ∏
numberRoute••∏ √
,••√ ƒ
DateTime••ƒ Ã
.••Ã Õ
Parse••Õ “
(••“ ”
t••” ‘
.••‘ ’
dateRegister••’ ·
.••· ‚
ToString••‚ Í
(••Í Î
)••Î Ï
)••Ï Ì
)••Ì Ó
)••Ó Ô
;••Ô 
}
¶¶( )
}
ßß$ %
}
®®  !
}
©© 
if
™™ 
(
™™  
t
™™  !
.
™™! "
	numTicket
™™" +
!=
™™, .
null
™™/ 3
)
™™3 4
t
™™5 6
.
™™6 7
	numTicket
™™7 @
=
™™A B
$num
™™C D
;
™™D E
if
´´ 
(
´´  
t
´´  !
.
´´! "
dateRegister
´´" .
!=
´´/ 1
null
´´2 6
)
´´6 7
final
´´8 =
=
´´> ?
DateTime
´´@ H
.
´´H I
Parse
´´I N
(
´´N O
t
´´O P
.
´´P Q
dateRegister
´´Q ]
.
´´] ^
ToString
´´^ f
(
´´f g
)
´´g h
)
´´h i
;
´´i j
}
¨¨ 
}
≠≠ 
}
ÆÆ 
ViewBag
ØØ 
.
ØØ 
name
ØØ 
=
ØØ 
id
ØØ !
;
ØØ! "
return
∞∞ 
View
∞∞ 
(
∞∞ 
listObservaciones
∞∞ -
)
∞∞- .
;
∞∞. /
}
≤≤ 
catch
≥≥ 
(
≥≥ 
	Exception
≥≥ 
)
≥≥ 
{
¥¥ 
return
µµ 
RedirectToAction
µµ '
(
µµ' (
$str
µµ( /
,
µµ/ 0
$str
µµ1 7
)
µµ7 8
;
µµ8 9
}
∂∂ 
}
∑∑ 	
public
∏∏ 
ActionResult
∏∏ -
ReportIncidenciasChoferImprimir
∏∏ ;
(
∏∏; <
string
∏∏< B
id
∏∏C E
,
∏∏E F
int
∏∏G J
mes
∏∏K N
,
∏∏N O
int
∏∏P S
anio
∏∏T X
)
∏∏X Y
{
ππ 	
try
∫∫ 
{
ªª 
DateTime
ºº 
primerDiaDelMes
ºº (
=
ºº) *
new
ºº+ .
DateTime
ºº/ 7
(
ºº7 8
anio
ºº8 <
,
ºº< =
mes
ºº> A
,
ººA B
$num
ººC D
)
ººD E
;
ººE F
Login
ΩΩ 
logi
ΩΩ 
=
ΩΩ 
new
ΩΩ  
Login
ΩΩ! &
(
ΩΩ& '
)
ΩΩ' (
;
ΩΩ( )
var
ææ 

authResult
ææ 
=
ææ   
AutenticarPasosRol
ææ! 3
(
ææ3 4
$num
ææ4 5
)
ææ5 6
;
ææ6 7
if
øø 
(
øø 

authResult
øø 
!=
øø !
null
øø" &
)
øø& '
return
øø( .

authResult
øø/ 9
;
øø9 :
string
¿¿ 
Linea
¿¿ 
=
¿¿ 
logi
¿¿ #
.
¿¿# $ 
GetLineaFromCookie
¿¿$ 6
(
¿¿6 7
Request
¿¿7 >
)
¿¿> ?
.
¿¿? @
ToString
¿¿@ H
(
¿¿H I
)
¿¿I J
;
¿¿J K
Employee
¡¡ 
employee
¡¡ !
=
¡¡" #
new
¡¡$ '
Employee
¡¡( 0
(
¡¡0 1
)
¡¡1 2
;
¡¡2 3
List
¬¬ 
<
¬¬ !
ChoferObservaciones
¬¬ (
>
¬¬( )
listObservaciones
¬¬* ;
=
¬¬< =
new
¬¬> A
List
¬¬B F
<
¬¬F G!
ChoferObservaciones
¬¬G Z
>
¬¬Z [
(
¬¬[ \
)
¬¬\ ]
;
¬¬] ^
MuestraRutasMapas
√√ !
muestraRutasMapas
√√" 3
=
√√4 5
new
√√6 9
MuestraRutasMapas
√√: K
(
√√K L
)
√√L M
;
√√M N
TimeZoneInfo
ƒƒ 
boliviaTimeZone
ƒƒ ,
=
ƒƒ- .
TimeZoneInfo
ƒƒ/ ;
.
ƒƒ; <$
FindSystemTimeZoneById
ƒƒ< R
(
ƒƒR S
$str
ƒƒS m
)
ƒƒm n
;
ƒƒn o
DateTime
≈≈ 
boliviaTime
≈≈ $
=
≈≈% &
TimeZoneInfo
≈≈' 3
.
≈≈3 4
ConvertTime
≈≈4 ?
(
≈≈? @
DateTime
≈≈@ H
.
≈≈H I
UtcNow
≈≈I O
,
≈≈O P
boliviaTimeZone
≈≈Q `
)
≈≈` a
;
≈≈a b
using
∆∆ 
(
∆∆ 
dbModels
∆∆ 
context
∆∆  '
=
∆∆( )
new
∆∆* -
dbModels
∆∆. 6
(
∆∆6 7
)
∆∆7 8
)
∆∆8 9
{
«« 
employee
»» 
=
»» 
context
»» &
.
»»& '
Employee
»»' /
.
»»/ 0
Where
»»0 5
(
»»5 6
e
»»6 7
=>
»»8 :
e
»»; <
.
»»< =
idLine
»»= C
==
»»D F
Linea
»»G L
&&
»»M O
e
»»P Q
.
»»Q R
status
»»R X
==
»»Y [
$num
»»\ ]
&&
»»^ `
e
»»a b
.
»»b c
plate
»»c h
!=
»»i k
null
»»l p
&&
»»q s
e
»»t u
.
»»u v

idEmployee»»v Ä
==»»Å É
id»»Ñ Ü
)»»Ü á
.»»á à
FirstOrDefault»»à ñ
(»»ñ ó
)»»ó ò
;»»ò ô
var
…… 
person
…… 
=
……  
context
……! (
.
……( )
Person
……) /
.
……/ 0
Where
……0 5
(
……5 6
x
……6 7
=>
……8 :
x
……; <
.
……< =
nit
……= @
==
……A C
id
……D F
)
……F G
.
……G H
FirstOrDefault
……H V
(
……V W
)
……W X
;
……X Y
var
    
timeControlsFilter
   *
=
  + ,
context
  - 4
.
  4 5
TimeControl
  5 @
.
  @ A
Where
  A F
(
  F G
x
  G H
=>
  I K
x
  L M
.
  M N

idEmployee
  N X
==
  Y [
employee
  \ d
.
  d e

idEmployee
  e o
)
  o p
.
  p q
GroupBy
  q x
(
  x y
x
  y z
=>
  { }
x
  ~ 
.   Ä
	numTicket  Ä â
)  â ä
.  ä ã
Select  ã ë
(  ë í
g  í ì
=>  î ñ
g  ó ò
.  ò ô
FirstOrDefault  ô ß
(  ß ®
)  ® ©
)  © ™
.  ™ ´
ToList  ´ ±
(  ± ≤
)  ≤ ≥
;  ≥ ¥
var
ÀÀ 
groupedData
ÀÀ #
=
ÀÀ$ % 
timeControlsFilter
ÀÀ& 8
.
ÃÃ 
GroupBy
ÃÃ 
(
ÃÃ  
x
ÃÃ  !
=>
ÃÃ" $
x
ÃÃ% &
.
ÃÃ& '
	numTicket
ÃÃ' 0
)
ÃÃ0 1
.
ÕÕ 
Select
ÕÕ 
(
ÕÕ 
g
ÕÕ  
=>
ÕÕ! #
g
ÕÕ$ %
.
ÕÕ% &
First
ÕÕ& +
(
ÕÕ+ ,
)
ÕÕ, -
)
ÕÕ- .
.
ŒŒ 
ToList
ŒŒ 
(
ŒŒ 
)
ŒŒ  
;
ŒŒ  !
foreach
–– 
(
–– 
var
––  
t
––! "
in
––# %
groupedData
––& 1
)
––1 2
{
—— 
DateTime
““  
final
““! &
=
““' (
boliviaTime
““) 4
;
““4 5
var
”” 
timeControls
”” (
=
””) *
context
””+ 2
.
””2 3
TimeControl
””3 >
.
””> ?
Where
””? D
(
””D E
x
””E F
=>
””G I
x
””J K
.
””K L
	numTicket
””L U
==
””V X
t
””Y Z
.
””Z [
	numTicket
””[ d
&&
””e g
x
””h i
.
””i j

idEmployee
””j t
==
””u w
t
””x y
.
””y z

idEmployee””z Ñ
)””Ñ Ö
.””Ö Ü
ToList””Ü å
(””å ç
)””ç é
;””é è
var
‘‘ 
timess
‘‘ "
=
‘‘# $
timeControls
‘‘% 1
.
‘‘1 2
FirstOrDefault
‘‘2 @
(
‘‘@ A
)
‘‘A B
;
‘‘B C
var
’’ 
	checksver
’’ %
=
’’& '
context
’’( /
.
’’/ 0

Checkpoint
’’0 :
.
’’: ;
Where
’’; @
(
’’@ A
x
’’A B
=>
’’C E
x
’’F G
.
’’G H
idCheckpoint
’’H T
==
’’U W
timess
’’X ^
.
’’^ _
idCheckpoint
’’_ k
)
’’k l
.
’’l m
FirstOrDefault
’’m {
(
’’{ |
)
’’| }
;
’’} ~
var
÷÷ 
checkpoints
÷÷ '
=
÷÷( )
context
÷÷* 1
.
÷÷1 2

Checkpoint
÷÷2 <
.
÷÷< =
Where
÷÷= B
(
÷÷B C
x
÷÷C D
=>
÷÷E G
x
÷÷H I
.
÷÷I J
idLine
÷÷J P
==
÷÷Q S
Linea
÷÷T Y
&&
÷÷Z \
x
÷÷] ^
.
÷÷^ _
status
÷÷_ e
!=
÷÷f h
$num
÷÷i j
&&
÷÷k m
x
÷÷n o
.
÷÷o p
numberRoute
÷÷p {
==
÷÷| ~
	checksver÷÷ à
.÷÷à â
numberRoute÷÷â î
)÷÷î ï
.÷÷ï ñ
ToList÷÷ñ ú
(÷÷ú ù
)÷÷ù û
;÷÷û ü
if
◊◊ 
(
◊◊ 
timeControls
◊◊ (
.
◊◊( )
Any
◊◊) ,
(
◊◊, -
)
◊◊- .
)
◊◊. /
{
ÿÿ 
int
ŸŸ 
statusPrimera
ŸŸ  -
=
ŸŸ. /
$num
ŸŸ0 1
;
ŸŸ1 2
if
⁄⁄ 
(
⁄⁄  
t
⁄⁄  !
.
⁄⁄! "
enable
⁄⁄" (
==
⁄⁄) +
$num
⁄⁄, -
||
⁄⁄. 0
t
⁄⁄1 2
.
⁄⁄2 3
enable
⁄⁄3 9
==
⁄⁄: <
$num
⁄⁄= >
)
⁄⁄> ?
statusPrimera
⁄⁄@ M
=
⁄⁄N O
$num
⁄⁄P Q
;
⁄⁄Q R

Checkpoint
€€ &
primerCheckpoint
€€' 7
=
€€8 9
checkpoints
€€: E
.
€€E F
FirstOrDefault
€€F T
(
€€T U
r
€€U V
=>
€€W Y
r
€€Z [
.
€€[ \
status
€€\ b
==
€€c e
statusPrimera
€€f s
)
€€s t
;
€€t u
List
‹‹  
<
‹‹  !

Checkpoint
‹‹! +
>
‹‹+ ,
checkpointsorder
‹‹- =
=
‹‹> ?
new
‹‹@ C
List
‹‹D H
<
‹‹H I

Checkpoint
‹‹I S
>
‹‹S T
(
‹‹T U
)
‹‹U V
;
‹‹V W
if
›› 
(
››  
primerCheckpoint
››  0
!=
››1 3
null
››4 8
)
››8 9
{
ﬁﬁ 
checkpointsorder
ﬂﬂ  0
=
ﬂﬂ1 2
checkpoints
ﬂﬂ3 >
.
‡‡$ %
OrderBy
‡‡% ,
(
‡‡, -
route
‡‡- 2
=>
‡‡3 5
muestraRutasMapas
‡‡6 G
.
‡‡G H(
CalcularDistanciaHaversine
‡‡H b
(
‡‡b c
(
··( )
decimal
··) 0
)
··0 1
primerCheckpoint
··1 A
.
··A B
latitud
··B I
,
··I J
(
‚‚( )
decimal
‚‚) 0
)
‚‚0 1
primerCheckpoint
‚‚1 A
.
‚‚A B
longitud
‚‚B J
,
‚‚J K
route
„„( -
.
„„- .
latitud
„„. 5
,
„„5 6
route
‰‰( -
.
‰‰- .
longitud
‰‰. 6
)
‰‰6 7
)
‰‰7 8
.
ÂÂ$ %
ToList
ÂÂ% +
(
ÂÂ+ ,
)
ÂÂ, -
;
ÂÂ- .
}
ÊÊ 
timeControls
ÁÁ (
=
ÁÁ) *
timeControls
ÁÁ+ 7
.
ÁÁ7 8
OrderBy
ÁÁ8 ?
(
ÁÁ? @
x
ÁÁ@ A
=>
ÁÁB D
x
ÁÁE F
.
ÁÁF G
dateRegister
ÁÁG S
)
ÁÁS T
.
ÁÁT U
ToList
ÁÁU [
(
ÁÁ[ \
)
ÁÁ\ ]
;
ÁÁ] ^
foreach
ËË #
(
ËË$ %
var
ËË% (
item
ËË) -
in
ËË. 0
timeControls
ËË1 =
)
ËË= >
{
ÈÈ 
if
ÍÍ  "
(
ÍÍ# $
item
ÍÍ$ (
.
ÍÍ( )
dateRegister
ÍÍ) 5
==
ÍÍ6 8
null
ÍÍ9 =
)
ÍÍ= >
{
ÎÎ  !
var
ÏÏ$ '
check
ÏÏ( -
=
ÏÏ. /
context
ÏÏ0 7
.
ÏÏ7 8

Checkpoint
ÏÏ8 B
.
ÏÏB C
Where
ÏÏC H
(
ÏÏH I
x
ÏÏI J
=>
ÏÏK M
x
ÏÏN O
.
ÏÏO P
idCheckpoint
ÏÏP \
==
ÏÏ] _
item
ÏÏ` d
.
ÏÏd e
idCheckpoint
ÏÏe q
)
ÏÏq r
.
ÏÏr s
FirstOrDefaultÏÏs Å
(ÏÏÅ Ç
)ÏÏÇ É
;ÏÏÉ Ñ
listObservaciones
ÌÌ$ 5
.
ÌÌ5 6
Add
ÌÌ6 9
(
ÌÌ9 :
new
ÌÌ: =!
ChoferObservaciones
ÌÌ> Q
(
ÌÌQ R
$str
ÌÌR o
+
ÌÌp q
check
ÌÌr w
.
ÌÌw x
descriptionÌÌx É
+ÌÌÉ Ñ
$strÌÌÖ ç
+ÌÌç é
checkÌÌé ì
.ÌÌì î
numberRouteÌÌî ü
,ÌÌü †
DateTimeÌÌ° ©
.ÌÌ© ™
ParseÌÌ™ Ø
(ÌÌØ ∞
tÌÌ∞ ±
.ÌÌ± ≤
dateRegisterÌÌ≤ æ
.ÌÌæ ø
ToStringÌÌø «
(ÌÌ« »
)ÌÌ» …
)ÌÌ…  
)ÌÌ  À
)ÌÌÀ Ã
;ÌÌÃ Õ
}
ÓÓ  !
if
ÔÔ  "
(
ÔÔ# $
item
ÔÔ$ (
.
ÔÔ( )
enable
ÔÔ) /
>
ÔÔ0 1
$num
ÔÔ2 3
&&
ÔÔ4 6
item
ÔÔ7 ;
.
ÔÔ; <
dateRegister
ÔÔ< H
!=
ÔÔI K
null
ÔÔL P
)
ÔÔP Q
{
  !
var
ÒÒ$ '
check
ÒÒ( -
=
ÒÒ. /
context
ÒÒ0 7
.
ÒÒ7 8

Checkpoint
ÒÒ8 B
.
ÒÒB C
Where
ÒÒC H
(
ÒÒH I
x
ÒÒI J
=>
ÒÒK M
x
ÒÒN O
.
ÒÒO P
idCheckpoint
ÒÒP \
==
ÒÒ] _
item
ÒÒ` d
.
ÒÒd e
idCheckpoint
ÒÒe q
)
ÒÒq r
.
ÒÒr s
FirstOrDefaultÒÒs Å
(ÒÒÅ Ç
)ÒÒÇ É
;ÒÒÉ Ñ
var
ÚÚ$ '
timeControlChofer
ÚÚ( 9
=
ÚÚ: ;
context
ÚÚ< C
.
ÚÚC D
TimeControl
ÚÚD O
.
ÚÚO P
Where
ÚÚP U
(
ÚÚU V
x
ÚÚV W
=>
ÚÚX Z
x
ÚÚ[ \
.
ÚÚ\ ]
idCheckpoint
ÚÚ] i
==
ÚÚj l
check
ÚÚm r
.
ÚÚr s
idCheckpoint
ÚÚs 
)ÚÚ Ä
.ÚÚÄ Å
ToListÚÚÅ á
(ÚÚá à
)ÚÚà â
;ÚÚâ ä
var
ÛÛ$ '
ticketCercano
ÛÛ( 5
=
ÛÛ6 7
timeControlChofer
ÛÛ8 I
.
ÛÛI J
Where
ÛÛJ O
(
ÛÛO P
x
ÛÛP Q
=>
ÛÛR T
x
ÛÛU V
.
ÛÛV W
	numTicket
ÛÛW `
>
ÛÛa b
t
ÛÛc d
.
ÛÛd e
	numTicket
ÛÛe n
)
ÛÛn o
.
ÛÛo p
OrderBy
ÛÛp w
(
ÛÛw x
x
ÛÛx y
=>
ÛÛz |
x
ÛÛ} ~
.
ÛÛ~ 
	numTicketÛÛ à
)ÛÛà â
.ÛÛâ ä
FirstOrDefaultÛÛä ò
(ÛÛò ô
)ÛÛô ö
;ÛÛö õ
var
ÙÙ$ '%
timeControlChoferLePaso
ÙÙ( ?
=
ÙÙ@ A
context
ÙÙB I
.
ÙÙI J
TimeControl
ÙÙJ U
.
ÙÙU V
Where
ÙÙV [
(
ÙÙ[ \
x
ÙÙ\ ]
=>
ÙÙ^ `
x
ÙÙa b
.
ÙÙb c
	numTicket
ÙÙc l
==
ÙÙm o
ticketCercano
ÙÙp }
.
ÙÙ} ~
	numTicketÙÙ~ á
&&ÙÙà ä
xÙÙã å
.ÙÙå ç
idCheckpointÙÙç ô
==ÙÙö ú
itemÙÙù °
.ÙÙ° ¢
idCheckpointÙÙ¢ Æ
)ÙÙÆ Ø
.ÙÙØ ∞
FirstOrDefaultÙÙ∞ æ
(ÙÙæ ø
)ÙÙø ¿
;ÙÙ¿ ¡
var
ıı$ '
chofer
ıı( .
=
ıı/ 0
context
ıı1 8
.
ıı8 9
Person
ıı9 ?
.
ıı? @
Where
ıı@ E
(
ııE F
x
ııF G
=>
ııH J
x
ııK L
.
ııL M
nit
ııM P
==
ııQ S%
timeControlChoferLePaso
ııT k
.
ıık l

idEmployee
ııl v
)
ııv w
.
ııw x
FirstOrDefaultııx Ü
(ııÜ á
)ııá à
;ııà â
listObservaciones
ˆˆ$ 5
.
ˆˆ5 6
Add
ˆˆ6 9
(
ˆˆ9 :
new
ˆˆ: =!
ChoferObservaciones
ˆˆ> Q
(
ˆˆQ R
$str
ˆˆR i
+
ˆˆj k
chofer
ˆˆl r
.
ˆˆr s
name
ˆˆs w
+
ˆˆx y
$str
ˆˆz }
+
ˆˆ~ 
choferˆˆÄ Ü
.ˆˆÜ á
lastnameˆˆá è
+ˆˆê ë
$strˆˆí ò
+ˆˆô ö
checkˆˆõ †
.ˆˆ† °
descriptionˆˆ° ¨
+ˆˆ≠ Æ
$strˆˆØ ∑
+ˆˆ∏ π
checkˆˆ∫ ø
.ˆˆø ¿
numberRouteˆˆ¿ À
,ˆˆÀ Ã
DateTimeˆˆÕ ’
.ˆˆ’ ÷
Parseˆˆ÷ €
(ˆˆ€ ‹
tˆˆ‹ ›
.ˆˆ› ﬁ
dateRegisterˆˆﬁ Í
.ˆˆÍ Î
ToStringˆˆÎ Û
(ˆˆÛ Ù
)ˆˆÙ ı
)ˆˆı ˆ
)ˆˆˆ ˜
)ˆˆ˜ ¯
;ˆˆ¯ ˘
}
˜˜  !
}
¯¯ 
List
˘˘  
<
˘˘  !
TimeControl
˘˘! ,
>
˘˘, -
orderTimeControl
˘˘. >
=
˘˘? @
new
˘˘A D
List
˘˘E I
<
˘˘I J
TimeControl
˘˘J U
>
˘˘U V
(
˘˘V W
)
˘˘W X
;
˘˘X Y
foreach
˙˙ #
(
˙˙$ %
var
˙˙% (
item
˙˙) -
in
˙˙. 0
checkpointsorder
˙˙1 A
)
˙˙A B
{
˚˚ 
TimeControl
¸¸  +
timeControlOrder
¸¸, <
=
¸¸= >
timeControls
¸¸? K
.
¸¸K L
Where
¸¸L Q
(
¸¸Q R
x
¸¸R S
=>
¸¸T V
x
¸¸W X
.
¸¸X Y
idCheckpoint
¸¸Y e
==
¸¸f h
item
¸¸i m
.
¸¸m n
idCheckpoint
¸¸n z
)
¸¸z {
.
¸¸{ |
FirstOrDefault¸¸| ä
(¸¸ä ã
)¸¸ã å
;¸¸å ç
orderTimeControl
˝˝  0
.
˝˝0 1
Add
˝˝1 4
(
˝˝4 5
timeControlOrder
˝˝5 E
)
˝˝E F
;
˝˝F G
}
˛˛ 
if
ˇˇ 
(
ˇˇ  
t
ˇˇ  !
.
ˇˇ! "
enable
ˇˇ" (
==
ˇˇ) +
$num
ˇˇ, -
||
ˇˇ. 0
t
ˇˇ1 2
.
ˇˇ2 3
enable
ˇˇ3 9
==
ˇˇ: <
$num
ˇˇ= >
)
ˇˇ> ?
{
ÄÄ 
for
ÅÅ  #
(
ÅÅ$ %
int
ÅÅ% (
i
ÅÅ) *
=
ÅÅ+ ,
$num
ÅÅ- .
;
ÅÅ. /
i
ÅÅ0 1
<
ÅÅ2 3
orderTimeControl
ÅÅ4 D
.
ÅÅD E
Count
ÅÅE J
-
ÅÅK L
$num
ÅÅM N
;
ÅÅN O
i
ÅÅP Q
++
ÅÅQ S
)
ÅÅS T
{
ÇÇ  !
if
ÉÉ$ &
(
ÉÉ' (
orderTimeControl
ÉÉ( 8
[
ÉÉ8 9
i
ÉÉ9 :
+
ÉÉ; <
$num
ÉÉ= >
]
ÉÉ> ?
.
ÉÉ? @
dateRegister
ÉÉ@ L
.
ÉÉL M
HasValue
ÉÉM U
&&
ÉÉV X
orderTimeControl
ÉÉY i
[
ÉÉi j
i
ÉÉj k
]
ÉÉk l
.
ÉÉl m
dateRegister
ÉÉm y
.
ÉÉy z
HasValueÉÉz Ç
)ÉÉÇ É
{
ÑÑ$ %
var
ÖÖ( +
checkpointPrimer
ÖÖ, <
=
ÖÖ= >
checkpoints
ÖÖ? J
.
ÖÖJ K
Where
ÖÖK P
(
ÖÖP Q
x
ÖÖQ R
=>
ÖÖS U
x
ÖÖV W
.
ÖÖW X
status
ÖÖX ^
==
ÖÖ_ a
$num
ÖÖb c
&&
ÖÖd f
x
ÖÖg h
.
ÖÖh i
idLine
ÖÖi o
==
ÖÖp r
Linea
ÖÖs x
)
ÖÖx y
.
ÖÖy z
FirstOrDefaultÖÖz à
(ÖÖà â
)ÖÖâ ä
;ÖÖä ã
var
ÜÜ( +
timeControlInicio
ÜÜ, =
=
ÜÜ> ?
timeControls
ÜÜ@ L
.
ÜÜL M
Where
ÜÜM R
(
ÜÜR S
x
ÜÜS T
=>
ÜÜU W
x
ÜÜX Y
.
ÜÜY Z
idCheckpoint
ÜÜZ f
==
ÜÜg i
checkpointPrimer
ÜÜj z
.
ÜÜz {
idCheckpointÜÜ{ á
&&ÜÜà ä
tÜÜã å
.ÜÜå ç
	numTicketÜÜç ñ
==ÜÜó ô
xÜÜö õ
.ÜÜõ ú
	numTicketÜÜú •
)ÜÜ• ¶
.ÜÜ¶ ß
FirstOrDefaultÜÜß µ
(ÜÜµ ∂
)ÜÜ∂ ∑
;ÜÜ∑ ∏

Checkpoint
áá( 2
checkpoint1
áá3 >
=
áá? @
new
ááA D

Checkpoint
ááE O
(
ááO P
)
ááP Q
;
ááQ R
double
àà( .
minutosParaParada
àà/ @
=
ààA B
$num
ààC D
;
ààD E
double
ââ( .
medicionTime
ââ/ ;
=
ââ< =
(
ââ> ?
orderTimeControl
ââ? O
[
ââO P
i
ââP Q
+
ââR S
$num
ââT U
]
ââU V
.
ââV W
dateRegister
ââW c
.
ââc d
Value
ââd i
-
ââj k
orderTimeControl
ââl |
[
ââ| }
i
ââ} ~
]
ââ~ 
.ââ Ä
dateRegisterââÄ å
.ââå ç
Valueââç í
)ââí ì
.ââì î
TotalMinutesââî †
;ââ† °
checkpoint1
ää( 3
=
ää4 5
checkpointsorder
ää6 F
.
ääF G
Where
ääG L
(
ääL M
x
ääM N
=>
ääO Q
x
ääR S
.
ääS T
idCheckpoint
ääT `
==
ääa c
orderTimeControl
ääd t
[
äät u
i
ääu v
+
ääw x
$num
ääy z
]
ääz {
.
ää{ |
idCheckpointää| à
)ääà â
.ääâ ä
FirstOrDefaultäää ò
(ääò ô
)ääô ö
;ääö õ
TimeSpan
ãã( 0
timeSpan
ãã1 9
=
ãã: ;
new
ãã< ?
TimeSpan
ãã@ H
(
ããH I
)
ããI J
;
ããJ K
if
åå( *
(
åå+ ,
DateTime
åå, 4
.
åå4 5
Parse
åå5 :
(
åå: ;
timeControlInicio
åå; L
.
ååL M
dateRegister
ååM Y
.
ååY Z
ToString
ååZ b
(
ååb c
)
ååc d
)
ååd e
.
ååe f
	DayOfWeek
ååf o
==
ååp r
	DayOfWeek
åås |
.
åå| }
	Wednesdayåå} Ü
||ååá â
DateTimeååä í
.ååí ì
Parseååì ò
(ååò ô!
timeControlInicioååô ™
.åå™ ´
dateRegisteråå´ ∑
.åå∑ ∏
ToStringåå∏ ¿
(åå¿ ¡
)åå¡ ¬
)åå¬ √
.åå√ ƒ
	DayOfWeekååƒ Õ
==ååŒ –
	DayOfWeekåå— ⁄
.åå⁄ €
Saturdayåå€ „
)åå„ ‰
{
çç( )
string
éé, 2
[
éé2 3
]
éé3 4
partes
éé5 ;
=
éé< =
checkpoint1
éé> I
.
ééI J
minArrivalMarket
ééJ Z
.
ééZ [
Trim
éé[ _
(
éé_ `
)
éé` a
.
ééa b
Split
ééb g
(
éég h
$char
ééh k
)
éék l
;
éél m
minutosParaParada
èè, =
=
èè> ?
(
èè@ A
double
èèA G
.
èèG H
Parse
èèH M
(
èèM N
partes
èèN T
[
èèT U
$num
èèU V
]
èèV W
)
èèW X
*
èèY Z
$num
èè[ ]
)
èè] ^
+
èè_ `
double
èèa g
.
èèg h
Parse
èèh m
(
èèm n
partes
èèn t
[
èèt u
$num
èèu v
]
èèv w
)
èèw x
;
èèx y
}
êê( )
else
ëë( ,
{
íí( )
string
ìì, 2
[
ìì2 3
]
ìì3 4
partes
ìì5 ;
=
ìì< =
checkpoint1
ìì> I
.
ììI J

minArrival
ììJ T
.
ììT U
Trim
ììU Y
(
ììY Z
)
ììZ [
.
ìì[ \
Split
ìì\ a
(
ììa b
$char
ììb e
)
ììe f
;
ììf g
minutosParaParada
îî, =
=
îî> ?
(
îî@ A
double
îîA G
.
îîG H
Parse
îîH M
(
îîM N
partes
îîN T
[
îîT U
$num
îîU V
]
îîV W
)
îîW X
*
îîY Z
$num
îî[ ]
)
îî] ^
+
îî_ `
double
îîa g
.
îîg h
Parse
îîh m
(
îîm n
partes
îîn t
[
îît u
$num
îîu v
]
îîv w
)
îîw x
;
îîx y
}
ïï( )
double
ññ( .
diferenciaMinutos
ññ/ @
=
ññA B
medicionTime
ññC O
-
ññP Q
minutosParaParada
ññR c
;
ññc d
int
óó( +

diferencia
óó, 6
=
óó7 8
(
óó9 :
int
óó: =
)
óó= >
Math
óó> B
.
óóB C
Floor
óóC H
(
óóH I
diferenciaMinutos
óóI Z
)
óóZ [
;
óó[ \
var
òò( +
check
òò, 1
=
òò2 3
checkpoints
òò4 ?
.
òò? @
Where
òò@ E
(
òòE F
x
òòF G
=>
òòH J
x
òòK L
.
òòL M
idCheckpoint
òòM Y
==
òòZ \
orderTimeControl
òò] m
[
òòm n
i
òòn o
+
òòp q
$num
òòr s
]
òòs t
.
òòt u
idCheckpointòòu Å
)òòÅ Ç
.òòÇ É
FirstOrDefaultòòÉ ë
(òòë í
)òòí ì
;òòì î
if
ôô( *
(
ôô+ ,
minutosParaParada
ôô, =
<
ôô> ?
medicionTime
ôô@ L
)
ôôL M
{
öö( )
listObservaciones
õõ, =
.
õõ= >
Add
õõ> A
(
õõA B
new
õõB E!
ChoferObservaciones
õõF Y
(
õõY Z
$str
õõZ w
+
õõx y
check
õõz 
.õõ Ä
descriptionõõÄ ã
+õõå ç
$strõõé ï
+õõñ ó

diferenciaõõò ¢
+õõ£ §
$strõõ• ´
+õõ¨ ≠
$strõõÆ ∂
+õõ∂ ∑
checkõõ∑ º
.õõº Ω
numberRouteõõΩ »
,õõ» …
DateTimeõõ  “
.õõ“ ”
Parseõõ” ÿ
(õõÿ Ÿ
tõõŸ ⁄
.õõ⁄ €
dateRegisterõõ€ Á
.õõÁ Ë
ToStringõõË 
(õõ Ò
)õõÒ Ú
)õõÚ Û
)õõÛ Ù
)õõÙ ı
;õõı ˆ
}
úú( )
}
ùù$ %
}
ûû  !
}
üü 
else
††  
if
††! #
(
††$ %
t
††% &
.
††& '
enable
††' -
==
††. 0
$num
††1 2
||
††3 5
t
††6 7
.
††7 8
enable
††8 >
==
††? A
$num
††B C
)
††C D
{
°° 
for
¢¢  #
(
¢¢$ %
int
¢¢% (
i
¢¢) *
=
¢¢+ ,
$num
¢¢- .
;
¢¢. /
i
¢¢0 1
<
¢¢2 3
checkpoints
¢¢4 ?
.
¢¢? @
Count
¢¢@ E
-
¢¢F G
$num
¢¢H I
;
¢¢I J
i
¢¢K L
++
¢¢L N
)
¢¢N O
{
££  !
if
§§$ &
(
§§' (
orderTimeControl
§§( 8
[
§§8 9
i
§§9 :
]
§§: ;
.
§§; <
dateRegister
§§< H
.
§§H I
HasValue
§§I Q
&&
§§R T
orderTimeControl
§§U e
[
§§e f
i
§§f g
+
§§h i
$num
§§j k
]
§§k l
.
§§l m
dateRegister
§§m y
.
§§y z
HasValue§§z Ç
)§§Ç É
{
••$ %
var
¶¶( +
checkpointPrimer
¶¶, <
=
¶¶= >
checkpoints
¶¶? J
.
¶¶J K
Where
¶¶K P
(
¶¶P Q
x
¶¶Q R
=>
¶¶S U
x
¶¶V W
.
¶¶W X
status
¶¶X ^
==
¶¶_ a
$num
¶¶b c
&&
¶¶d f
x
¶¶g h
.
¶¶h i
idLine
¶¶i o
==
¶¶p r
Linea
¶¶s x
)
¶¶x y
.
¶¶y z
FirstOrDefault¶¶z à
(¶¶à â
)¶¶â ä
;¶¶ä ã
var
ßß( +
timeControlInicio
ßß, =
=
ßß> ?
timeControls
ßß@ L
.
ßßL M
Where
ßßM R
(
ßßR S
x
ßßS T
=>
ßßU W
x
ßßX Y
.
ßßY Z
idCheckpoint
ßßZ f
==
ßßg i
checkpointPrimer
ßßj z
.
ßßz {
idCheckpointßß{ á
&&ßßà ä
tßßã å
.ßßå ç
	numTicketßßç ñ
==ßßó ô
xßßö õ
.ßßõ ú
	numTicketßßú •
)ßß• ¶
.ßß¶ ß
FirstOrDefaultßßß µ
(ßßµ ∂
)ßß∂ ∑
;ßß∑ ∏

Checkpoint
®®( 2
checkpoint1
®®3 >
=
®®? @
new
®®A D

Checkpoint
®®E O
(
®®O P
)
®®P Q
;
®®Q R
double
©©( .
minutosParaParada
©©/ @
=
©©A B
$num
©©C D
;
©©D E
double
™™( .
medicionTime
™™/ ;
=
™™< =
(
™™> ?
orderTimeControl
™™? O
[
™™O P
i
™™P Q
+
™™R S
$num
™™T U
]
™™U V
.
™™V W
dateRegister
™™W c
.
™™c d
Value
™™d i
-
™™j k
orderTimeControl
™™l |
[
™™| }
i
™™} ~
]
™™~ 
.™™ Ä
dateRegister™™Ä å
.™™å ç
Value™™ç í
)™™í ì
.™™ì î
TotalMinutes™™î †
;™™† °
checkpoint1
´´( 3
=
´´4 5
checkpoints
´´6 A
.
´´A B
Where
´´B G
(
´´G H
x
´´H I
=>
´´J L
x
´´M N
.
´´N O
idCheckpoint
´´O [
==
´´\ ^
orderTimeControl
´´_ o
[
´´o p
i
´´p q
]
´´q r
.
´´r s
idCheckpoint
´´s 
)´´ Ä
.´´Ä Å
FirstOrDefault´´Å è
(´´è ê
)´´ê ë
;´´ë í
TimeSpan
¨¨( 0
timeSpan
¨¨1 9
=
¨¨: ;
new
¨¨< ?
TimeSpan
¨¨@ H
(
¨¨H I
)
¨¨I J
;
¨¨J K
if
≠≠( *
(
≠≠+ ,
DateTime
≠≠, 4
.
≠≠4 5
Parse
≠≠5 :
(
≠≠: ;
timeControlInicio
≠≠; L
.
≠≠L M
dateRegister
≠≠M Y
.
≠≠Y Z
ToString
≠≠Z b
(
≠≠b c
)
≠≠c d
)
≠≠d e
.
≠≠e f
	DayOfWeek
≠≠f o
==
≠≠p r
	DayOfWeek
≠≠s |
.
≠≠| }
	Wednesday≠≠} Ü
||≠≠á â
DateTime≠≠ä í
.≠≠í ì
Parse≠≠ì ò
(≠≠ò ô!
timeControlInicio≠≠ô ™
.≠≠™ ´
dateRegister≠≠´ ∑
.≠≠∑ ∏
ToString≠≠∏ ¿
(≠≠¿ ¡
)≠≠¡ ¬
)≠≠¬ √
.≠≠√ ƒ
	DayOfWeek≠≠ƒ Õ
==≠≠Œ –
	DayOfWeek≠≠— ⁄
.≠≠⁄ €
Saturday≠≠€ „
)≠≠„ ‰
timeSpan
ÆÆ, 4
=
ÆÆ5 6
TimeSpan
ÆÆ7 ?
.
ÆÆ? @
Parse
ÆÆ@ E
(
ÆÆE F
checkpoint1
ÆÆF Q
.
ÆÆQ R
minArrivalMarket
ÆÆR b
)
ÆÆb c
;
ÆÆc d
else
ØØ( ,
timeSpan
ØØ- 5
=
ØØ6 7
TimeSpan
ØØ8 @
.
ØØ@ A
Parse
ØØA F
(
ØØF G
checkpoint1
ØØG R
.
ØØR S

minArrival
ØØS ]
)
ØØ] ^
;
ØØ^ _
minutosParaParada
∞∞( 9
=
∞∞: ;
timeSpan
∞∞< D
.
∞∞D E
TotalMinutes
∞∞E Q
;
∞∞Q R
double
±±( .
diferenciaMinutos
±±/ @
=
±±A B
medicionTime
±±C O
-
±±P Q
minutosParaParada
±±R c
;
±±c d
int
≤≤( +

diferencia
≤≤, 6
=
≤≤7 8
(
≤≤9 :
int
≤≤: =
)
≤≤= >
Math
≤≤> B
.
≤≤B C
Floor
≤≤C H
(
≤≤H I
diferenciaMinutos
≤≤I Z
)
≤≤Z [
;
≤≤[ \
var
≥≥( +
check
≥≥, 1
=
≥≥2 3
checkpoints
≥≥4 ?
.
≥≥? @
Where
≥≥@ E
(
≥≥E F
x
≥≥F G
=>
≥≥H J
x
≥≥K L
.
≥≥L M
idCheckpoint
≥≥M Y
==
≥≥Z \
orderTimeControl
≥≥] m
[
≥≥m n
i
≥≥n o
+
≥≥p q
$num
≥≥r s
]
≥≥s t
.
≥≥t u
idCheckpoint≥≥u Å
)≥≥Å Ç
.≥≥Ç É
FirstOrDefault≥≥É ë
(≥≥ë í
)≥≥í ì
;≥≥ì î
if
¥¥( *
(
¥¥+ ,
minutosParaParada
¥¥, =
<
¥¥> ?
medicionTime
¥¥@ L
)
¥¥L M
{
µµ( )
listObservaciones
∂∂, =
.
∂∂= >
Add
∂∂> A
(
∂∂A B
new
∂∂B E!
ChoferObservaciones
∂∂F Y
(
∂∂Y Z
$str
∂∂Z w
+
∂∂x y
check
∂∂z 
.∂∂ Ä
description∂∂Ä ã
+∂∂å ç
$str∂∂é ï
+∂∂ñ ó

diferencia∂∂ò ¢
+∂∂£ §
$str∂∂• ´
+∂∂¨ ≠
$str∂∂Æ ∂
+∂∂∑ ∏
check∂∂π æ
.∂∂æ ø
numberRoute∂∂ø  
,∂∂  À
DateTime∂∂Ã ‘
.∂∂‘ ’
Parse∂∂’ ⁄
(∂∂⁄ €
t∂∂€ ‹
.∂∂‹ ›
dateRegister∂∂› È
.∂∂È Í
ToString∂∂Í Ú
(∂∂Ú Û
)∂∂Û Ù
)∂∂Ù ı
)∂∂ı ˆ
)∂∂ˆ ˜
;∂∂˜ ¯
}
∑∑( )
}
∏∏$ %
}
ππ  !
}
∫∫ 
if
ªª 
(
ªª  
t
ªª  !
.
ªª! "
	numTicket
ªª" +
!=
ªª, .
null
ªª/ 3
)
ªª3 4
t
ªª5 6
.
ªª6 7
	numTicket
ªª7 @
=
ªªA B
$num
ªªC D
;
ªªD E
if
ºº 
(
ºº  
t
ºº  !
.
ºº! "
dateRegister
ºº" .
!=
ºº/ 1
null
ºº2 6
)
ºº6 7
final
ºº8 =
=
ºº> ?
DateTime
ºº@ H
.
ººH I
Parse
ººI N
(
ººN O
t
ººO P
.
ººP Q
dateRegister
ººQ ]
.
ºº] ^
ToString
ºº^ f
(
ººf g
)
ººg h
)
ººh i
;
ººi j
}
ΩΩ 
}
ææ 
}
øø 
listObservaciones
¿¿ !
=
¿¿" #
listObservaciones
¿¿$ 5
.
¿¿5 6
Where
¿¿6 ;
(
¿¿; <
x
¿¿< =
=>
¿¿> @
x
¿¿A B
.
¿¿B C
fechaObservacion
¿¿C S
.
¿¿S T
Month
¿¿T Y
==
¿¿Z \
primerDiaDelMes
¿¿] l
.
¿¿l m
Month
¿¿m r
&&
¿¿s u
x
¿¿v w
.
¿¿w x
fechaObservacion¿¿x à
.¿¿à â
Year¿¿â ç
==¿¿é ê
primerDiaDelMes¿¿ë †
.¿¿† °
Year¿¿° •
)¿¿• ¶
.¿¿¶ ß
ToList¿¿ß ≠
(¿¿≠ Æ
)¿¿Æ Ø
;¿¿Ø ∞
return
¡¡ 
View
¡¡ 
(
¡¡ 
listObservaciones
¡¡ -
)
¡¡- .
;
¡¡. /
}
¬¬ 
catch
√√ 
(
√√ 
	Exception
√√ 
)
√√ 
{
ƒƒ 
return
≈≈ 
RedirectToAction
≈≈ '
(
≈≈' (
$str
≈≈( /
,
≈≈/ 0
$str
≈≈1 7
)
≈≈7 8
;
≈≈8 9
}
∆∆ 
}
«« 	
public
»» 
ActionResult
»» (
PrintedReportObservaciones
»» 6
(
»»6 7
string
»»7 =
id
»»> @
,
»»@ A
int
»»B E
mes
»»F I
,
»»I J
int
»»K N
anio
»»O S
)
»»S T
{
…… 	
try
   
{
ÀÀ 
Login
ÃÃ 
logi
ÃÃ 
=
ÃÃ 
new
ÃÃ  
Login
ÃÃ! &
(
ÃÃ& '
)
ÃÃ' (
;
ÃÃ( )
var
ÕÕ 

authResult
ÕÕ 
=
ÕÕ   
AutenticarPasosRol
ÕÕ! 3
(
ÕÕ3 4
$num
ÕÕ4 5
)
ÕÕ5 6
;
ÕÕ6 7
if
ŒŒ 
(
ŒŒ 

authResult
ŒŒ 
!=
ŒŒ !
null
ŒŒ" &
)
ŒŒ& '
return
ŒŒ( .

authResult
ŒŒ/ 9
;
ŒŒ9 :
TimeZoneInfo
œœ 
boliviaTimeZone
œœ ,
=
œœ- .
TimeZoneInfo
œœ/ ;
.
œœ; <$
FindSystemTimeZoneById
œœ< R
(
œœR S
$str
œœS m
)
œœm n
;
œœn o
DateTime
–– 
boliviaTime
–– $
=
––% &
TimeZoneInfo
––' 3
.
––3 4
ConvertTime
––4 ?
(
––? @
DateTime
––@ H
.
––H I
UtcNow
––I O
,
––O P
boliviaTimeZone
––Q `
)
––` a
;
––a b
return
—— 
new
—— 
ActionAsPdf
—— &
(
——& '
$str
——' H
,
——H I
new
——J M
{
——N O
id
——P R
=
——S T
id
——U W
,
——W X
mes
——Y \
=
——] ^
mes
——_ b
,
——b c
anio
——d h
=
——i j
anio
——k o
}
——o p
)
——p q
{
——r s
FileName
——t |
=
——} ~
id—— Å
+——Ç É
$str——Ñ á
+——à â
mes——ä ç
+——é è
$str——ê ì
+——î ï
anio——ñ ö
+——õ ú
$str——ù †
+——° ¢
boliviaTime——£ Æ
.——Æ Ø
Day——Ø ≤
+——≥ ¥
boliviaTime——µ ¿
.——¿ ¡
Month——¡ ∆
+——« »
boliviaTime——… ‘
.——‘ ’
Year——’ Ÿ
+——⁄ €
$str——‹ ‚
}——„ ‰
;——‰ Â
}
““ 
catch
”” 
(
”” 
	Exception
”” 
)
”” 
{
‘‘ 
return
’’ 
RedirectToAction
’’ '
(
’’' (
$str
’’( /
,
’’/ 0
$str
’’1 7
)
’’7 8
;
’’8 9
}
÷÷ 
}
◊◊ 	
public
ÿÿ 
ActionResult
ÿÿ '
ReportVueltasChoferDiario
ÿÿ 5
(
ÿÿ5 6
string
ÿÿ6 <

idEmployee
ÿÿ= G
)
ÿÿG H
{
ŸŸ 	
try
⁄⁄ 
{
€€ 
Login
‹‹ 
logi
‹‹ 
=
‹‹ 
new
‹‹  
Login
‹‹! &
(
‹‹& '
)
‹‹' (
;
‹‹( )
var
›› 

authResult
›› 
=
››   
AutenticarPasosRol
››! 3
(
››3 4
$num
››4 5
)
››5 6
;
››6 7
if
ﬁﬁ 
(
ﬁﬁ 

authResult
ﬁﬁ 
!=
ﬁﬁ !
null
ﬁﬁ" &
)
ﬁﬁ& '
return
ﬁﬁ( .

authResult
ﬁﬁ/ 9
;
ﬁﬁ9 :
string
‡‡ 
Linea
‡‡ 
=
‡‡ 
logi
‡‡ #
.
‡‡# $ 
GetLineaFromCookie
‡‡$ 6
(
‡‡6 7
Request
‡‡7 >
)
‡‡> ?
.
‡‡? @
ToString
‡‡@ H
(
‡‡H I
)
‡‡I J
;
‡‡J K
List
·· 
<
·· 
ChoferVueltas
·· "
>
··" #
listRank
··$ ,
=
··- .
new
··/ 2
List
··3 7
<
··7 8
ChoferVueltas
··8 E
>
··E F
(
··F G
)
··G H
;
··H I
TimeZoneInfo
„„ 
boliviaTimeZone
„„ ,
=
„„- .
TimeZoneInfo
„„/ ;
.
„„; <$
FindSystemTimeZoneById
„„< R
(
„„R S
$str
„„S m
)
„„m n
;
„„n o
DateTime
‰‰ 
boliviaTime
‰‰ $
=
‰‰% &
TimeZoneInfo
‰‰' 3
.
‰‰3 4
ConvertTime
‰‰4 ?
(
‰‰? @
DateTime
‰‰@ H
.
‰‰H I
UtcNow
‰‰I O
,
‰‰O P
boliviaTimeZone
‰‰Q `
)
‰‰` a
;
‰‰a b
using
ÊÊ 
(
ÊÊ 
dbModels
ÊÊ 
context
ÊÊ  '
=
ÊÊ( )
new
ÊÊ* -
dbModels
ÊÊ. 6
(
ÊÊ6 7
)
ÊÊ7 8
)
ÊÊ8 9
{
ÁÁ 
var
ËË 
employee
ËË  
=
ËË! "
context
ËË# *
.
ËË* +
Employee
ËË+ 3
.
ËË3 4
Where
ËË4 9
(
ËË9 :
e
ËË: ;
=>
ËË< >
e
ËË? @
.
ËË@ A
idLine
ËËA G
==
ËËH J
Linea
ËËK P
&&
ËËQ S
e
ËËT U
.
ËËU V
status
ËËV \
==
ËË] _
$num
ËË` a
&&
ËËb d
e
ËËe f
.
ËËf g
plate
ËËg l
!=
ËËm o
null
ËËp t
&&
ËËu w
e
ËËx y
.
ËËy z

idEmployeeËËz Ñ
==ËËÖ á

idEmployeeËËà í
)ËËí ì
.ËËì î
FirstOrDefaultËËî ¢
(ËË¢ £
)ËË£ §
;ËË§ •
var
ÈÈ 
check1
ÈÈ 
=
ÈÈ  
context
ÈÈ! (
.
ÈÈ( )

Checkpoint
ÈÈ) 3
.
ÈÈ3 4
Where
ÈÈ4 9
(
ÈÈ9 :
x
ÈÈ: ;
=>
ÈÈ< >
x
ÈÈ? @
.
ÈÈ@ A
idLine
ÈÈA G
==
ÈÈH J
Linea
ÈÈK P
&&
ÈÈQ S
x
ÈÈT U
.
ÈÈU V
status
ÈÈV \
==
ÈÈ] _
$num
ÈÈ` a
)
ÈÈa b
.
ÈÈb c
FirstOrDefault
ÈÈc q
(
ÈÈq r
)
ÈÈr s
;
ÈÈs t
var
ÍÍ 
check2
ÍÍ 
=
ÍÍ  
context
ÍÍ! (
.
ÍÍ( )

Checkpoint
ÍÍ) 3
.
ÍÍ3 4
Where
ÍÍ4 9
(
ÍÍ9 :
x
ÍÍ: ;
=>
ÍÍ< >
x
ÍÍ? @
.
ÍÍ@ A
idLine
ÍÍA G
==
ÍÍH J
Linea
ÍÍK P
&&
ÍÍQ S
x
ÍÍT U
.
ÍÍU V
status
ÍÍV \
==
ÍÍ] _
$num
ÍÍ` a
)
ÍÍa b
.
ÍÍb c
FirstOrDefault
ÍÍc q
(
ÍÍq r
)
ÍÍr s
;
ÍÍs t
var
ÎÎ 
person
ÎÎ 
=
ÎÎ  
context
ÎÎ! (
.
ÎÎ( )
Person
ÎÎ) /
.
ÎÎ/ 0
Where
ÎÎ0 5
(
ÎÎ5 6
x
ÎÎ6 7
=>
ÎÎ8 :
x
ÎÎ; <
.
ÎÎ< =
nit
ÎÎ= @
==
ÎÎA C
employee
ÎÎD L
.
ÎÎL M

idEmployee
ÎÎM W
)
ÎÎW X
.
ÎÎX Y
FirstOrDefault
ÎÎY g
(
ÎÎg h
)
ÎÎh i
;
ÎÎi j
ViewBag
ÏÏ 
.
ÏÏ 
Name
ÏÏ  
=
ÏÏ! "
person
ÏÏ# )
.
ÏÏ) *
name
ÏÏ* .
+
ÏÏ/ 0
$str
ÏÏ1 4
+
ÏÏ5 6
person
ÏÏ7 =
.
ÏÏ= >
lastname
ÏÏ> F
;
ÏÏF G
var
ÌÌ 
timeControls
ÌÌ $
=
ÌÌ% &
context
ÌÌ' .
.
ÌÌ. /
TimeControl
ÌÌ/ :
.
ÓÓ 
Where
ÓÓ 
(
ÓÓ 
x
ÓÓ  
=>
ÓÓ! #
x
ÓÓ$ %
.
ÓÓ% &

idEmployee
ÓÓ& 0
==
ÓÓ1 3
employee
ÓÓ4 <
.
ÓÓ< =

idEmployee
ÓÓ= G
&&
ÓÓH J
(
ÔÔ# $
(
ÔÔ$ %
x
ÔÔ% &
.
ÔÔ& '
idCheckpoint
ÔÔ' 3
==
ÔÔ4 6
check1
ÔÔ7 =
.
ÔÔ= >
idCheckpoint
ÔÔ> J
&&
ÔÔK M
(
ÔÔN O
x
ÔÔO P
.
ÔÔP Q
enable
ÔÔQ W
==
ÔÔX Z
$num
ÔÔ[ \
||
ÔÔ] _
x
ÔÔ` a
.
ÔÔa b
enable
ÔÔb h
==
ÔÔi k
$num
ÔÔl m
)
ÔÔm n
)
ÔÔn o
||
ÔÔp r
(
$ %
x
% &
.
& '
idCheckpoint
' 3
==
4 6
check2
7 =
.
= >
idCheckpoint
> J
&&
K M
(
N O
x
O P
.
P Q
enable
Q W
==
X Z
$num
[ \
||
] _
x
` a
.
a b
enable
b h
==
i k
$num
l m
)
m n
)
n o
)
o p
&&
q s
x
ÒÒ# $
.
ÒÒ$ %
dateRegister
ÒÒ% 1
.
ÒÒ1 2
HasValue
ÒÒ2 :
)
ÒÒ: ;
.
ÚÚ 
ToList
ÚÚ 
(
ÚÚ  
)
ÚÚ  !
;
ÚÚ! "
var
ÛÛ 
result
ÛÛ 
=
ÛÛ  
timeControls
ÛÛ! -
.
ÙÙ 
GroupBy
ÙÙ  
(
ÙÙ  !
x
ÙÙ! "
=>
ÙÙ# %
x
ÙÙ& '
.
ÙÙ' (
dateRegister
ÙÙ( 4
.
ÙÙ4 5
Value
ÙÙ5 :
.
ÙÙ: ;
Date
ÙÙ; ?
)
ÙÙ? @
.
ıı 
Select
ıı 
(
ıı  
g
ıı  !
=>
ıı" $
new
ıı% (
{
ˆˆ 
Fecha
˜˜ !
=
˜˜" #
g
˜˜$ %
.
˜˜% &
Key
˜˜& )
,
˜˜) *
Vueltas
¯¯ #
=
¯¯$ %
g
¯¯& '
.
¯¯' (
Count
¯¯( -
(
¯¯- .
)
¯¯. /
,
¯¯/ 0
PrimerHorario
˘˘ )
=
˘˘* +
g
˘˘, -
.
˘˘- .
Min
˘˘. 1
(
˘˘1 2
x
˘˘2 3
=>
˘˘4 6
x
˘˘7 8
.
˘˘8 9
dateRegister
˘˘9 E
)
˘˘E F
,
˘˘F G
UltimoHorario
˙˙ )
=
˙˙* +
g
˙˙, -
.
˙˙- .
Max
˙˙. 1
(
˙˙1 2
x
˙˙2 3
=>
˙˙4 6
x
˙˙7 8
.
˙˙8 9
dateRegister
˙˙9 E
)
˙˙E F
,
˙˙F G
UltimoNumTicket
˚˚ +
=
˚˚, -
g
˚˚. /
.
˚˚/ 0
OrderByDescending
˚˚0 A
(
˚˚A B
x
˚˚B C
=>
˚˚D F
x
˚˚G H
.
˚˚H I
dateRegister
˚˚I U
)
˚˚U V
.
˚˚V W
FirstOrDefault
˚˚W e
(
˚˚e f
)
˚˚f g
?
˚˚g h
.
˚˚h i
	numTicket
˚˚i r
}
¸¸ 
)
¸¸ 
.
˝˝ 
ToList
˝˝ 
(
˝˝  
)
˝˝  !
;
˝˝! "
foreach
ˇˇ 
(
ˇˇ 
var
ˇˇ  
item
ˇˇ! %
in
ˇˇ& (
result
ˇˇ) /
)
ˇˇ/ 0
{
ÄÄ 
string
ÅÅ 
horario
ÅÅ &
=
ÅÅ' (
$"
ÅÅ) +
{
ÅÅ+ ,
item
ÅÅ, 0
.
ÅÅ0 1
PrimerHorario
ÅÅ1 >
?
ÅÅ> ?
.
ÅÅ? @
ToString
ÅÅ@ H
(
ÅÅH I
$str
ÅÅI P
)
ÅÅP Q
}
ÅÅQ R
$str
ÅÅR T
"
ÅÅT U
;
ÅÅU V
var
ÇÇ 
ultimoHorario
ÇÇ )
=
ÇÇ* +
context
ÇÇ, 3
.
ÇÇ3 4
TimeControl
ÇÇ4 ?
.
ÇÇ? @
Where
ÇÇ@ E
(
ÇÇE F
x
ÇÇF G
=>
ÇÇH J
x
ÇÇK L
.
ÇÇL M
	numTicket
ÇÇM V
==
ÇÇW Y
item
ÇÇZ ^
.
ÇÇ^ _
UltimoNumTicket
ÇÇ_ n
)
ÇÇn o
.
ÇÇo p 
OrderByDescendingÇÇp Å
(ÇÇÅ Ç
xÇÇÇ É
=>ÇÇÑ Ü
xÇÇá à
.ÇÇà â
dateRegisterÇÇâ ï
)ÇÇï ñ
.ÇÇñ ó
FirstOrDefaultÇÇó •
(ÇÇ• ¶
)ÇÇ¶ ß
;ÇÇß ®
horario
ÉÉ 
=
ÉÉ  !
horario
ÉÉ" )
+
ÉÉ* +
$str
ÉÉ, /
+
ÉÉ0 1
ultimoHorario
ÉÉ2 ?
.
ÉÉ? @
dateRegister
ÉÉ@ L
?
ÉÉL M
.
ÉÉM N
ToString
ÉÉN V
(
ÉÉV W
$str
ÉÉW ^
)
ÉÉ^ _
;
ÉÉ_ `
listRank
ÑÑ  
.
ÑÑ  !
Add
ÑÑ! $
(
ÑÑ$ %
new
ÑÑ% (
ChoferVueltas
ÑÑ) 6
(
ÑÑ6 7
person
ÑÑ7 =
.
ÑÑ= >
name
ÑÑ> B
+
ÑÑC D
$str
ÑÑE H
+
ÑÑI J
person
ÑÑK Q
.
ÑÑQ R
lastname
ÑÑR Z
,
ÑÑZ [
item
ÑÑ[ _
.
ÑÑ_ `
Vueltas
ÑÑ` g
,
ÑÑg h
item
ÑÑi m
.
ÑÑm n
Fecha
ÑÑn s
,
ÑÑs t
horario
ÑÑu |
)
ÑÑ| }
)
ÑÑ} ~
;
ÑÑ~ 
}
ÖÖ 
}
ÜÜ 
ViewBag
àà 
.
àà 
CurrentMonth
àà $
=
àà% &
boliviaTime
àà' 2
.
àà2 3
Month
àà3 8
;
àà8 9
ViewBag
ââ 
.
ââ 
CurrentYear
ââ #
=
ââ$ %
boliviaTime
ââ& 1
.
ââ1 2
Year
ââ2 6
;
ââ6 7
ViewBag
ää 
.
ää 
Id
ää 
=
ää 

idEmployee
ää '
;
ää' (
return
ãã 
View
ãã 
(
ãã 
listRank
ãã $
)
ãã$ %
;
ãã% &
}
åå 
catch
çç 
(
çç 
	Exception
çç 
)
çç 
{
éé 
return
èè 
RedirectToAction
èè '
(
èè' (
$str
èè( /
,
èè/ 0
$str
èè1 7
)
èè7 8
;
èè8 9
}
êê 
}
ëë 	
public
íí 
ActionResult
íí /
!ReportVueltasChoferDiarioEscogido
íí =
(
íí= >
int
íí> A
year
ííB F
,
ííF G
int
ííH K
month
ííL Q
,
ííQ R
string
ííS Y
id
ííZ \
)
íí\ ]
{
ìì 	
try
îî 
{
ïï 
Login
ññ 
logi
ññ 
=
ññ 
new
ññ  
Login
ññ! &
(
ññ& '
)
ññ' (
;
ññ( )
var
óó 

authResult
óó 
=
óó   
AutenticarPasosRol
óó! 3
(
óó3 4
$num
óó4 5
)
óó5 6
;
óó6 7
if
òò 
(
òò 

authResult
òò 
!=
òò !
null
òò" &
)
òò& '
return
òò( .

authResult
òò/ 9
;
òò9 :
string
öö 
Linea
öö 
=
öö 
logi
öö #
.
öö# $ 
GetLineaFromCookie
öö$ 6
(
öö6 7
Request
öö7 >
)
öö> ?
.
öö? @
ToString
öö@ H
(
ööH I
)
ööI J
;
ööJ K
List
õõ 
<
õõ 
ChoferVueltas
õõ "
>
õõ" #
listRank
õõ$ ,
=
õõ- .
new
õõ/ 2
List
õõ3 7
<
õõ7 8
ChoferVueltas
õõ8 E
>
õõE F
(
õõF G
)
õõG H
;
õõH I
TimeZoneInfo
ùù 
boliviaTimeZone
ùù ,
=
ùù- .
TimeZoneInfo
ùù/ ;
.
ùù; <$
FindSystemTimeZoneById
ùù< R
(
ùùR S
$str
ùùS m
)
ùùm n
;
ùùn o
DateTime
ûû 
boliviaTime
ûû $
=
ûû% &
TimeZoneInfo
ûû' 3
.
ûû3 4
ConvertTime
ûû4 ?
(
ûû? @
DateTime
ûû@ H
.
ûûH I
UtcNow
ûûI O
,
ûûO P
boliviaTimeZone
ûûQ `
)
ûû` a
;
ûûa b
using
†† 
(
†† 
dbModels
†† 
context
††  '
=
††( )
new
††* -
dbModels
††. 6
(
††6 7
)
††7 8
)
††8 9
{
°° 
var
¢¢ 
employee
¢¢  
=
¢¢! "
context
¢¢# *
.
¢¢* +
Employee
¢¢+ 3
.
¢¢3 4
Where
¢¢4 9
(
¢¢9 :
e
¢¢: ;
=>
¢¢< >
e
¢¢? @
.
¢¢@ A
idLine
¢¢A G
==
¢¢H J
Linea
¢¢K P
&&
¢¢Q S
e
¢¢T U
.
¢¢U V
status
¢¢V \
==
¢¢] _
$num
¢¢` a
&&
¢¢b d
e
¢¢e f
.
¢¢f g
plate
¢¢g l
!=
¢¢m o
null
¢¢p t
&&
¢¢u w
e
¢¢x y
.
¢¢y z

idEmployee¢¢z Ñ
==¢¢Ö á
id¢¢à ä
)¢¢ä ã
.¢¢ã å
FirstOrDefault¢¢å ö
(¢¢ö õ
)¢¢õ ú
;¢¢ú ù
var
££ 
check1
££ 
=
££  
context
££! (
.
££( )

Checkpoint
££) 3
.
££3 4
Where
££4 9
(
££9 :
x
££: ;
=>
££< >
x
££? @
.
££@ A
idLine
££A G
==
££H J
Linea
££K P
&&
££Q S
x
££T U
.
££U V
status
££V \
==
££] _
$num
££` a
)
££a b
.
££b c
FirstOrDefault
££c q
(
££q r
)
££r s
;
££s t
var
§§ 
check2
§§ 
=
§§  
context
§§! (
.
§§( )

Checkpoint
§§) 3
.
§§3 4
Where
§§4 9
(
§§9 :
x
§§: ;
=>
§§< >
x
§§? @
.
§§@ A
idLine
§§A G
==
§§H J
Linea
§§K P
&&
§§Q S
x
§§T U
.
§§U V
status
§§V \
==
§§] _
$num
§§` a
)
§§a b
.
§§b c
FirstOrDefault
§§c q
(
§§q r
)
§§r s
;
§§s t
var
•• 
person
•• 
=
••  
context
••! (
.
••( )
Person
••) /
.
••/ 0
Where
••0 5
(
••5 6
x
••6 7
=>
••8 :
x
••; <
.
••< =
nit
••= @
==
••A C
employee
••D L
.
••L M

idEmployee
••M W
)
••W X
.
••X Y
FirstOrDefault
••Y g
(
••g h
)
••h i
;
••i j
ViewBag
¶¶ 
.
¶¶ 
Name
¶¶  
=
¶¶! "
person
¶¶# )
.
¶¶) *
name
¶¶* .
+
¶¶/ 0
$str
¶¶1 4
+
¶¶5 6
person
¶¶7 =
.
¶¶= >
lastname
¶¶> F
;
¶¶F G
var
ßß 
timeControlss
ßß %
=
ßß& '
context
ßß( /
.
ßß/ 0
TimeControl
ßß0 ;
.
®® 
Where
®® 
(
®® 
x
®®  
=>
®®! #
x
®®$ %
.
®®% &

idEmployee
®®& 0
==
®®1 3
employee
®®4 <
.
®®< =

idEmployee
®®= G
&&
®®H J
(
©©# $
(
©©$ %
x
©©% &
.
©©& '
idCheckpoint
©©' 3
==
©©4 6
check1
©©7 =
.
©©= >
idCheckpoint
©©> J
&&
©©K M
(
©©N O
x
©©O P
.
©©P Q
enable
©©Q W
==
©©X Z
$num
©©[ \
||
©©] _
x
©©` a
.
©©a b
enable
©©b h
==
©©i k
$num
©©l m
)
©©m n
)
©©n o
||
©©p r
(
™™$ %
x
™™% &
.
™™& '
idCheckpoint
™™' 3
==
™™4 6
check2
™™7 =
.
™™= >
idCheckpoint
™™> J
&&
™™K M
(
™™N O
x
™™O P
.
™™P Q
enable
™™Q W
==
™™X Z
$num
™™[ \
||
™™] _
x
™™` a
.
™™a b
enable
™™b h
==
™™i k
$num
™™l m
)
™™m n
)
™™n o
)
™™o p
&&
™™q s
x
´´# $
.
´´$ %
dateRegister
´´% 1
.
´´1 2
HasValue
´´2 :
)
´´: ;
.
¨¨ 
ToList
¨¨ 
(
¨¨  
)
¨¨  !
;
¨¨! "
var
≠≠ 
timeControls
≠≠ $
=
≠≠% &
timeControlss
≠≠' 4
.
≠≠4 5
Where
≠≠5 :
(
≠≠: ;
x
≠≠; <
=>
≠≠= ?
DateTime
≠≠@ H
.
≠≠H I
Parse
≠≠I N
(
≠≠N O
x
≠≠O P
.
≠≠P Q
dateRegister
≠≠Q ]
.
≠≠] ^
ToString
≠≠^ f
(
≠≠f g
)
≠≠g h
)
≠≠h i
.
≠≠i j
Month
≠≠j o
==
≠≠p r
month
≠≠s x
&&
≠≠y {
DateTime≠≠| Ñ
.≠≠Ñ Ö
Parse≠≠Ö ä
(≠≠ä ã
x≠≠ã å
.≠≠å ç
dateRegister≠≠ç ô
.≠≠ô ö
ToString≠≠ö ¢
(≠≠¢ £
)≠≠£ §
)≠≠§ •
.≠≠• ¶
Year≠≠¶ ™
==≠≠´ ≠
year≠≠Æ ≤
)≠≠≤ ≥
.≠≠≥ ¥
ToList≠≠¥ ∫
(≠≠∫ ª
)≠≠ª º
;≠≠º Ω
var
ÆÆ 
result
ÆÆ 
=
ÆÆ  
timeControls
ÆÆ! -
.
ØØ 
GroupBy
ØØ  
(
ØØ  !
x
ØØ! "
=>
ØØ# %
x
ØØ& '
.
ØØ' (
dateRegister
ØØ( 4
.
ØØ4 5
Value
ØØ5 :
.
ØØ: ;
Date
ØØ; ?
)
ØØ? @
.
∞∞ 
Select
∞∞ 
(
∞∞  
g
∞∞  !
=>
∞∞" $
new
∞∞% (
{
±± 
Fecha
≤≤ !
=
≤≤" #
g
≤≤$ %
.
≤≤% &
Key
≤≤& )
,
≤≤) *
Vueltas
≥≥ #
=
≥≥$ %
g
≥≥& '
.
≥≥' (
Count
≥≥( -
(
≥≥- .
)
≥≥. /
,
≥≥/ 0
PrimerHorario
¥¥ )
=
¥¥* +
g
¥¥, -
.
¥¥- .
Min
¥¥. 1
(
¥¥1 2
x
¥¥2 3
=>
¥¥4 6
x
¥¥7 8
.
¥¥8 9
dateRegister
¥¥9 E
)
¥¥E F
,
¥¥F G
UltimoHorario
µµ )
=
µµ* +
g
µµ, -
.
µµ- .
Max
µµ. 1
(
µµ1 2
x
µµ2 3
=>
µµ4 6
x
µµ7 8
.
µµ8 9
dateRegister
µµ9 E
)
µµE F
,
µµF G
UltimoNumTicket
∂∂ +
=
∂∂, -
g
∂∂. /
.
∂∂/ 0
OrderByDescending
∂∂0 A
(
∂∂A B
x
∂∂B C
=>
∂∂D F
x
∂∂G H
.
∂∂H I
dateRegister
∂∂I U
)
∂∂U V
.
∂∂V W
FirstOrDefault
∂∂W e
(
∂∂e f
)
∂∂f g
?
∂∂g h
.
∂∂h i
	numTicket
∂∂i r
}
∑∑ 
)
∑∑ 
.
∏∏ 
ToList
∏∏ 
(
∏∏  
)
∏∏  !
;
∏∏! "
foreach
∫∫ 
(
∫∫ 
var
∫∫  
item
∫∫! %
in
∫∫& (
result
∫∫) /
)
∫∫/ 0
{
ªª 
string
ºº 
horario
ºº &
=
ºº' (
$"
ºº) +
{
ºº+ ,
item
ºº, 0
.
ºº0 1
PrimerHorario
ºº1 >
?
ºº> ?
.
ºº? @
ToString
ºº@ H
(
ººH I
$str
ººI P
)
ººP Q
}
ººQ R
$str
ººR T
"
ººT U
;
ººU V
var
ΩΩ 
ultimoHorario
ΩΩ )
=
ΩΩ* +
context
ΩΩ, 3
.
ΩΩ3 4
TimeControl
ΩΩ4 ?
.
ΩΩ? @
Where
ΩΩ@ E
(
ΩΩE F
x
ΩΩF G
=>
ΩΩH J
x
ΩΩK L
.
ΩΩL M
	numTicket
ΩΩM V
==
ΩΩW Y
item
ΩΩZ ^
.
ΩΩ^ _
UltimoNumTicket
ΩΩ_ n
)
ΩΩn o
.
ΩΩo p 
OrderByDescendingΩΩp Å
(ΩΩÅ Ç
xΩΩÇ É
=>ΩΩÑ Ü
xΩΩá à
.ΩΩà â
dateRegisterΩΩâ ï
)ΩΩï ñ
.ΩΩñ ó
FirstOrDefaultΩΩó •
(ΩΩ• ¶
)ΩΩ¶ ß
;ΩΩß ®
horario
ææ 
=
ææ  !
horario
ææ" )
+
ææ* +
$str
ææ, /
+
ææ0 1
ultimoHorario
ææ2 ?
.
ææ? @
dateRegister
ææ@ L
?
ææL M
.
ææM N
ToString
ææN V
(
ææV W
$str
ææW ^
)
ææ^ _
;
ææ_ `
listRank
øø  
.
øø  !
Add
øø! $
(
øø$ %
new
øø% (
ChoferVueltas
øø) 6
(
øø6 7
person
øø7 =
.
øø= >
name
øø> B
+
øøC D
$str
øøE H
+
øøI J
person
øøK Q
.
øøQ R
lastname
øøR Z
,
øøZ [
item
øø\ `
.
øø` a
Vueltas
øøa h
,
øøh i
item
øøj n
.
øøn o
Fecha
øøo t
,
øøt u
horario
øøv }
)
øø} ~
)
øø~ 
;øø Ä
}
¿¿ 
}
¡¡ 
ViewBag
√√ 
.
√√ 
CurrentMonth
√√ $
=
√√% &
boliviaTime
√√' 2
.
√√2 3
Month
√√3 8
;
√√8 9
ViewBag
ƒƒ 
.
ƒƒ 
CurrentYear
ƒƒ #
=
ƒƒ$ %
boliviaTime
ƒƒ& 1
.
ƒƒ1 2
Year
ƒƒ2 6
;
ƒƒ6 7
return
≈≈ 
View
≈≈ 
(
≈≈ 
listRank
≈≈ $
)
≈≈$ %
;
≈≈% &
}
∆∆ 
catch
«« 
(
«« 
	Exception
«« 
)
«« 
{
»» 
return
…… 
RedirectToAction
…… '
(
……' (
$str
……( /
,
……/ 0
$str
……1 7
)
……7 8
;
……8 9
}
   
}
ÀÀ 	
public
ÃÃ 
ActionResult
ÃÃ (
PrintedReportVueltasChofer
ÃÃ 6
(
ÃÃ6 7
int
ÃÃ7 :
year
ÃÃ; ?
,
ÃÃ? @
int
ÃÃA D
month
ÃÃE J
,
ÃÃJ K
string
ÃÃL R
id
ÃÃS U
)
ÃÃU V
{
ÕÕ 	
try
ŒŒ 
{
œœ 
Login
–– 
logi
–– 
=
–– 
new
––  
Login
––! &
(
––& '
)
––' (
;
––( )
var
—— 

authResult
—— 
=
——   
AutenticarPasosRol
——! 3
(
——3 4
$num
——4 5
)
——5 6
;
——6 7
if
““ 
(
““ 

authResult
““ 
!=
““ !
null
““" &
)
““& '
return
““( .

authResult
““/ 9
;
““9 :
TimeZoneInfo
”” 
boliviaTimeZone
”” ,
=
””- .
TimeZoneInfo
””/ ;
.
””; <$
FindSystemTimeZoneById
””< R
(
””R S
$str
””S m
)
””m n
;
””n o
DateTime
‘‘ 
boliviaTime
‘‘ $
=
‘‘% &
TimeZoneInfo
‘‘' 3
.
‘‘3 4
ConvertTime
‘‘4 ?
(
‘‘? @
DateTime
‘‘@ H
.
‘‘H I
UtcNow
‘‘I O
,
‘‘O P
boliviaTimeZone
‘‘Q `
)
‘‘` a
;
‘‘a b
return
’’ 
new
’’ 
ActionAsPdf
’’ &
(
’’& '
$str
’’' J
,
’’J K
new
’’L O
{
’’P Q
year
’’R V
=
’’W X
year
’’Y ]
,
’’] ^
month
’’_ d
=
’’e f
month
’’g l
,
’’l m
id
’’n p
=
’’q r
id
’’s u
}
’’v w
)
’’w x
{
’’y z
FileName’’{ É
=’’Ñ Ö
id’’Ü à
+’’â ä
$str’’ã é
+’’è ê
month’’ë ñ
+’’ó ò
$str’’ô ú
+’’ù û
year’’ü £
+’’§ •
$str’’¶ ©
+’’™ ´
boliviaTime’’¨ ∑
.’’∑ ∏
Day’’∏ ª
+’’º Ω
boliviaTime’’æ …
.’’…  
Month’’  œ
+’’– —
boliviaTime’’“ ›
.’’› ﬁ
Year’’ﬁ ‚
+’’„ ‰
$str’’Â Î
}’’Ï Ì
;’’Ì Ó
}
÷÷ 
catch
◊◊ 
(
◊◊ 
	Exception
◊◊ 
)
◊◊ 
{
ÿÿ 
return
ŸŸ 
RedirectToAction
ŸŸ '
(
ŸŸ' (
$str
ŸŸ( /
,
ŸŸ/ 0
$str
ŸŸ1 7
)
ŸŸ7 8
;
ŸŸ8 9
}
⁄⁄ 
}
€€ 	
}
‹‹ 
}›› Æ±
LC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Controllers\HomeController.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Controllers" -
{ 
public 

class 
HomeController 
:  !

Controller" ,
{ 
public 
ActionResult 
Views !
(! "
)" #
{ 	
TimeZoneInfo 
boliviaTimeZone (
=) *
TimeZoneInfo+ 7
.7 8"
FindSystemTimeZoneById8 N
(N O
$strO i
)i j
;j k
DateTime 
boliviaTime  
=! "
TimeZoneInfo# /
./ 0
ConvertTime0 ;
(; <
DateTime< D
.D E
UtcNowE K
,K L
boliviaTimeZoneM \
)\ ]
;] ^
return 
View 
( 
) 
; 
} 	
public 
ActionResult 
Index !
(! "
)" #
{ 	

HttpCookie 

authCookie !
=" #
Request$ +
.+ ,
Cookies, 3
[3 4
FormsAuthentication4 G
.G H
FormsCookieNameH W
]W X
;X Y
if 
( 

authCookie 
!= 
null "
)" #
{ %
FormsAuthenticationTicket )
ticket* 0
=1 2
FormsAuthentication3 F
.F G
DecryptG N
(N O

authCookieO Y
.Y Z
ValueZ _
)_ `
;` a
var!! 

cookieData!! 
=!!  

Newtonsoft!!! +
.!!+ ,
Json!!, 0
.!!0 1
JsonConvert!!1 <
.!!< =
DeserializeObject!!= N
<!!N O
dynamic!!O V
>!!V W
(!!W X
ticket!!X ^
.!!^ _
UserData!!_ g
)!!g h
;!!h i
ViewBag## 
.## 
RoleSession## #
=##$ %

cookieData##& 0
.##0 1
RoleId##1 7
;##7 8
ViewBag$$ 
.$$ 
Employee$$  
=$$! "

cookieData$$# -
.$$- .

EmployeeId$$. 8
;$$8 9
ViewBag%% 
.%% 
Linea%% 
=%% 

cookieData%%  *
.%%* +
Linea%%+ 0
;%%0 1
switch&& 
(&& 
(&& 
int&& 
)&& 
ViewBag&& #
.&&# $
RoleSession&&$ /
)&&/ 0
{'' 
case(( 
$num(( 
:(( 
return)) 
RedirectToAction)) /
())/ 0
$str))0 7
,))7 8
$str))9 A
)))A B
;))B C
case** 
$num** 
:** 
return++ 
RedirectToAction++ /
(++/ 0
$str++0 I
,++I J
$str++K X
)++X Y
;++Y Z
case,, 
$num,, 
:,, 
return-- 
RedirectToAction-- /
(--/ 0
$str--0 :
,--: ;
$str--< B
)--B C
;--C D
case.. 
$num.. 
:.. 
return// 
RedirectToAction// /
(/// 0
$str//0 7
,//7 8
$str//9 ?
)//? @
;//@ A
default00 
:00 
break11 
;11 
}22 
}33 
return44 
View44 
(44 
)44 
;44 
}55 	
[66 	
HttpPost66	 
]66 
public77 
ActionResult77 
Index77 !
(77! "
Place77" '
	placeinfo77( 1
)771 2
{88 	
return99 
RedirectToAction99 #
(99# $
$str99$ /
,99/ 0
new991 4
{995 6
info997 ;
=99< =
	placeinfo99> G
.99G H
description99H S
}99T U
)99U V
;99V W
}:: 	
public<< 
ActionResult<< 
	MapSearch<< %
(<<% &
string<<& ,
info<<- 1
)<<1 2
{== 	
try>> 
{?? 
if@@ 
(@@ 
info@@ 
==@@ 
null@@ 
)@@ 
return@@ %
RedirectToAction@@& 6
(@@6 7
$str@@7 >
,@@> ?
$str@@@ F
)@@F G
;@@G H
ListAA 
<AA 
PlaceAA 
>AA 
placeAA !
=AA" #
newAA$ '
ListAA( ,
<AA, -
PlaceAA- 2
>AA2 3
(AA3 4
)AA4 5
;AA5 6
stringBB 
informBB 
=BB 
infoBB #
.BB# $
ToLowerBB$ +
(BB+ ,
)BB, -
.BB- .
TrimBB. 2
(BB2 3
)BB3 4
;BB4 5
ListCC 
<CC 
LineCC 
>CC 
linesCC  
=CC! "
newCC# &
ListCC' +
<CC+ ,
LineCC, 0
>CC0 1
(CC1 2
)CC2 3
;CC3 4
ListDD 
<DD 
RouteDD 
>DD 
routesDD "
=DD# $
newDD% (
ListDD) -
<DD- .
RouteDD. 3
>DD3 4
(DD4 5
)DD5 6
;DD6 7
usingEE 
(EE 
dbModelsEE 
contextEE  '
=EE( )
newEE* -
dbModelsEE. 6
(EE6 7
)EE7 8
)EE8 9
linesEE: ?
=EE@ A
contextEEB I
.EEI J
LineEEJ N
.EEN O
WhereEEO T
(EET U
xEEU V
=>EEW Y
xEEZ [
.EE[ \
nameLineEE\ d
.EEd e
ToLowerEEe l
(EEl m
)EEm n
.EEn o
ContainsEEo w
(EEw x
informEEx ~
)EE~ 
)	EE Ä
.
EEÄ Å
ToList
EEÅ á
(
EEá à
)
EEà â
;
EEâ ä
if
EEã ç
(
EEé è
lines
EEè î
==
EEï ó
null
EEò ú
)
EEú ù
lines
EEû £
=
EE§ •
new
EE¶ ©
List
EE™ Æ
<
EEÆ Ø
Line
EEØ ≥
>
EE≥ ¥
(
EE¥ µ
)
EEµ ∂
;
EE∂ ∑
usingFF 
(FF 
dbModelsFF 
contextFF  '
=FF( )
newFF* -
dbModelsFF. 6
(FF6 7
)FF7 8
)FF8 9
placeFF: ?
=FF@ A
contextFFB I
.FFI J
PlaceFFJ O
.FFO P
WhereFFP U
(FFU V
xFFV W
=>FFX Z
xFF[ \
.FF\ ]
descriptionFF] h
.FFh i
ToLowerFFi p
(FFp q
)FFq r
.FFr s
ContainsFFs {
(FF{ |
inform	FF| Ç
)
FFÇ É
)
FFÉ Ñ
.
FFÑ Ö
ToList
FFÖ ã
(
FFã å
)
FFå ç
;
FFç é
ifGG 
(GG 
placeGG 
!=GG 
nullGG !
)GG! "
{HH 
usingII 
(II 
dbModelsII #
contextII$ +
=II, -
newII. 1
dbModelsII2 :
(II: ;
)II; <
)II< =
foreachKK 
(KK  !
varKK! $
itemKK% )
inKK* ,
placeKK- 2
)KK2 3
{LL 
ListMM  
<MM  !
RouteMM! &
>MM& '
rMM( )
=MM* +
contextMM, 3
.MM3 4
RouteMM4 9
.MM9 :
WhereMM: ?
(MM? @
xMM@ A
=>MMB D
xMME F
.MMF G
idPlaceMMG N
==MMO Q
itemMMR V
.MMV W
idPlaceMMW ^
)MM^ _
.MM_ `
ToListMM` f
(MMf g
)MMg h
;MMh i
foreachNN #
(NN$ %
varNN% (
item2NN) .
inNN/ 1
rNN2 3
)NN3 4
{OO 
RoutePP  %
r2PP& (
=PP) *
contextPP+ 2
.PP2 3
RoutePP3 8
.PP8 9
WherePP9 >
(PP> ?
xPP? @
=>PPA C
xPPD E
.PPE F
idRoutePPF M
==PPN P
item2PPQ V
.PPV W
idRoutePPW ^
)PP^ _
.PP_ `
FirstOrDefaultPP` n
(PPn o
)PPo p
;PPp q
ifQQ  "
(QQ# $
r2QQ$ &
!=QQ' )
nullQQ* .
)QQ. /
routesRR$ *
.RR* +
AddRR+ .
(RR. /
r2RR/ 1
)RR1 2
;RR2 3
}SS 
}TT 
ifUU 
(UU 
routesUU 
!=UU !
nullUU" &
)UU& '
usingVV 
(VV 
dbModelsVV '
contextVV( /
=VV0 1
newVV2 5
dbModelsVV6 >
(VV> ?
)VV? @
)VV@ A
{WW 
foreachXX #
(XX$ %
varXX% (
itemXX) -
inXX. 0
routesXX1 7
)XX7 8
{YY 
boolZZ  $
validZZ% *
=ZZ+ ,
trueZZ- 1
;ZZ1 2
Line[[  $
line[[% )
=[[* +
context[[, 3
.[[3 4
Line[[4 8
.[[8 9
Where[[9 >
([[> ?
x[[? @
=>[[A C
x[[D E
.[[E F
nameLine[[F N
==[[O Q
item[[R V
.[[V W
idLine[[W ]
)[[] ^
.[[^ _
FirstOrDefault[[_ m
([[m n
)[[n o
;[[o p
foreach\\  '
(\\( )
var\\) ,
item2\\- 2
in\\3 5
lines\\6 ;
)\\; <
{\\= >
if\\? A
(\\B C
item2\\C H
.\\H I
nameLine\\I Q
==\\R T
line\\U Y
.\\Y Z
nameLine\\Z b
)\\b c
valid\\d i
=\\j k
false\\l q
;\\q r
}\\s t
if]]  "
(]]# $
line]]$ (
!=]]) +
null]], 0
&&]]1 3
valid]]4 9
)]]9 :
lines]]; @
.]]@ A
Add]]A D
(]]D E
line]]E I
)]]I J
;]]J K
}^^ 
}__ 
}`` 
ifaa 
(aa 
linesaa 
!=aa 
nullaa !
&&aa" $
linesaa% *
.aa* +
Countaa+ 0
>aa1 2
$numaa3 4
)aa4 5
returnaa6 <
Viewaa= A
(aaA B
linesaaB G
)aaG H
;aaH I
elsebb 
{bb 
Sessionbb 
[bb 
$strbb -
]bb- .
=bb/ 0
$strbb1 4
;bb4 5
returnbb6 <
RedirectToActionbb= M
(bbM N
$strbbN U
)bbU V
;bbV W
}bbX Y
}cc 
catchdd 
(dd 
	Exceptiondd 
)dd 
{ee 
returnff 
RedirectToActionff '
(ff' (
$strff( /
,ff/ 0
$strff1 7
)ff7 8
;ff8 9
}gg 
}hh 	
publicjj 
ActionResultjj 
ViewLinejj $
(jj$ %
stringjj% +
nameLinejj, 4
)jj4 5
{kk 	
tryll 
{mm 
ifnn 
(nn 
nameLinenn 
==nn 
nullnn  $
)nn$ %
returnnn& ,
RedirectToActionnn- =
(nn= >
$strnn> E
,nnE F
$strnnG M
)nnM N
;nnN O
stringoo 
Lineaoo 
=oo 
nameLineoo '
;oo' (
Linepp 
linepp 
=pp 
newpp 
Linepp  $
(pp$ %
)pp% &
;pp& '
Listqq 
<qq 
Routeqq 
>qq 
routesqq "
=qq# $
newqq% (
Listqq) -
<qq- .
Routeqq. 3
>qq3 4
(qq4 5
)qq5 6
;qq6 7
Listrr 
<rr 

Checkpointrr 
>rr  
checkpointsrr! ,
=rr- .
newrr/ 2
Listrr3 7
<rr7 8

Checkpointrr8 B
>rrB C
(rrC D
)rrD E
;rrE F
Listss 
<ss 
Routess 
>ss 
rutasOrdenadasss *
=ss+ ,
newss- 0
Listss1 5
<ss5 6
Routess6 ;
>ss; <
(ss< =
)ss= >
;ss> ?
usingtt 
(tt 
dbModelstt 
contexttt  '
=tt( )
newtt* -
dbModelstt. 6
(tt6 7
)tt7 8
)tt8 9
routestt: @
=ttA B
contextttC J
.ttJ K
RoutettK P
.ttP Q
WherettQ V
(ttV W
xttW X
=>ttY [
xtt\ ]
.tt] ^
idLinett^ d
==tte g
Lineatth m
)ttm n
.ttn o
ToListtto u
(ttu v
)ttv w
;ttw x
usinguu 
(uu 
dbModelsuu 
contextuu  '
=uu( )
newuu* -
dbModelsuu. 6
(uu6 7
)uu7 8
)uu8 9
checkpointsuu: E
=uuF G
contextuuH O
.uuO P

CheckpointuuP Z
.uuZ [
Whereuu[ `
(uu` a
xuua b
=>uuc e
xuuf g
.uug h
idLineuuh n
==uuo q
Lineauur w
&&uux z
xuu{ |
.uu| }
status	uu} É
==
uuÑ Ü
$num
uuá à
)
uuà â
.
uuâ ä
ToList
uuä ê
(
uuê ë
)
uuë í
;
uuí ì
MuestraSearchMapvv  
muestravv! (
=vv) *
newvv+ .
MuestraSearchMapvv/ ?
(vv? @
)vv@ A
;vvA B
muestraww 
.ww #
IntermediateCheckpointsww /
=ww0 1
newww2 5
Listww6 :
<ww: ;
stringww; A
[wwA B
]wwB C
>wwC D
(wwD E
)wwE F
;wwF G
muestraxx 
.xx 
IntermediatePointsxx *
=xx+ ,
newxx- 0
Listxx1 5
<xx5 6
decimalxx6 =
[xx= >
]xx> ?
>xx? @
(xx@ A
)xxA B
;xxB C
muestrayy 
.yy 
NameCheckpointyy &
=yy' (
newyy) ,
Listyy- 1
<yy1 2
stringyy2 8
[yy8 9
]yy9 :
>yy: ;
(yy; <
)yy< =
;yy= >
Listzz 
<zz  
UltCheckpoint_Resultzz )
>zz) * 
ultCheckpoint_Resultzz+ ?
=zz@ A
newzzB E
ListzzF J
<zzJ K 
UltCheckpoint_ResultzzK _
>zz_ `
(zz` a
)zza b
;zzb c
muestra{{ 
.{{ 
ultCheckpoints{{ &
={{' (
new{{) ,
List{{- 1
<{{1 2!
CheckpointInSearchMap{{2 G
>{{G H
({{H I
){{I J
;{{J K
using|| 
(|| 
dbModels|| 
context||  '
=||( )
new||* -
dbModels||. 6
(||6 7
)||7 8
)||8 9
line||: >
=||? @
context||A H
.||H I
Line||I M
.||M N
Where||N S
(||S T
x||T U
=>||V X
x||Y Z
.||Z [
nameLine||[ c
==||d f
Linea||g l
)||l m
.||m n
FirstOrDefault||n |
(||| }
)||} ~
;||~ 
if}} 
(}} 
routes}} 
!=}} 
null}} "
)}}" #
{~~ 
int 
count 
= 
$num  !
;! "
rutasOrdenadas
ÄÄ "
=
ÄÄ# $
routes
ÄÄ% +
.
ÄÄ+ ,
OrderByDescending
ÄÄ, =
(
ÄÄ= >
obj
ÄÄ> A
=>
ÄÄB D
(
ÄÄE F
double
ÄÄF L
)
ÄÄL M
obj
ÄÄM P
.
ÄÄP Q
latitud
ÄÄQ X
-
ÄÄY Z
(
ÄÄ[ \
double
ÄÄ\ b
)
ÄÄb c
obj
ÄÄc f
.
ÄÄf g
logintud
ÄÄg o
)
ÄÄo p
.
ÄÄp q
ToList
ÄÄq w
(
ÄÄw x
)
ÄÄx y
;
ÄÄy z
foreach
ÅÅ 
(
ÅÅ 
var
ÅÅ  
item
ÅÅ! %
in
ÅÅ& (
rutasOrdenadas
ÅÅ) 7
)
ÅÅ7 8
using
ÇÇ 
(
ÇÇ 
dbModels
ÇÇ '
context
ÇÇ( /
=
ÇÇ0 1
new
ÇÇ2 5
dbModels
ÇÇ6 >
(
ÇÇ> ?
)
ÇÇ? @
)
ÇÇ@ A
{
ÉÉ 
Route
ÑÑ !
route
ÑÑ" '
=
ÑÑ( )
context
ÑÑ* 1
.
ÑÑ1 2
Route
ÑÑ2 7
.
ÑÑ7 8
Where
ÑÑ8 =
(
ÑÑ= >
x
ÑÑ> ?
=>
ÑÑ@ B
x
ÑÑC D
.
ÑÑD E
idRoute
ÑÑE L
==
ÑÑM O
item
ÑÑP T
.
ÑÑT U
idRoute
ÑÑU \
)
ÑÑ\ ]
.
ÑÑ] ^
FirstOrDefault
ÑÑ^ l
(
ÑÑl m
)
ÑÑm n
;
ÑÑn o
if
ÖÖ 
(
ÖÖ  
count
ÖÖ  %
==
ÖÖ& (
$num
ÖÖ) *
)
ÖÖ* +
muestra
ÖÖ, 3
.
ÖÖ3 4

StartPoint
ÖÖ4 >
=
ÖÖ? @
new
ÖÖA D
decimal
ÖÖE L
[
ÖÖL M
]
ÖÖM N
{
ÖÖO P
(
ÖÖQ R
decimal
ÖÖR Y
)
ÖÖY Z
route
ÖÖZ _
.
ÖÖ_ `
latitud
ÖÖ` g
,
ÖÖg h
(
ÖÖi j
decimal
ÖÖj q
)
ÖÖq r
route
ÖÖr w
.
ÖÖw x
logintudÖÖx Ä
}ÖÖÅ Ç
;ÖÖÇ É
else
ÜÜ  
if
ÜÜ! #
(
ÜÜ$ %
count
ÜÜ% *
==
ÜÜ+ -
rutasOrdenadas
ÜÜ. <
.
ÜÜ< =
Count
ÜÜ= B
-
ÜÜC D
$num
ÜÜE F
)
ÜÜF G
muestra
ÜÜH O
.
ÜÜO P
EndPoint
ÜÜP X
=
ÜÜY Z
new
ÜÜ[ ^
decimal
ÜÜ_ f
[
ÜÜf g
]
ÜÜg h
{
ÜÜi j
(
ÜÜk l
decimal
ÜÜl s
)
ÜÜs t
route
ÜÜt y
.
ÜÜy z
latitudÜÜz Å
,ÜÜÅ Ç
(ÜÜÉ Ñ
decimalÜÜÑ ã
)ÜÜã å
routeÜÜå ë
.ÜÜë í
logintudÜÜí ö
}ÜÜõ ú
;ÜÜú ù
else
áá  
muestra
áá! (
.
áá( ) 
IntermediatePoints
áá) ;
.
áá; <
Add
áá< ?
(
áá? @
new
áá@ C
decimal
ááD K
[
ááK L
]
ááL M
{
ááN O
(
ááP Q
decimal
ááQ X
)
ááX Y
route
ááY ^
.
áá^ _
latitud
áá_ f
,
ááf g
(
ááh i
decimal
áái p
)
ááp q
route
ááq v
.
ááv w
logintud
ááw 
}ááÄ Å
)ááÅ Ç
;ááÇ É
count
àà !
++
àà! #
;
àà# $
}
ââ 
}
ää 
if
ãã 
(
ãã 
checkpoints
ãã 
!=
ãã  "
null
ãã# '
)
ãã' (
{
åå 
foreach
çç 
(
çç 
var
çç  
item
çç! %
in
çç& (
checkpoints
çç) 4
)
çç4 5
{
éé 
int
èè 
count
èè !
=
èè" #
$num
èè$ %
;
èè% &
using
êê 
(
êê 
dbModels
êê '
context
êê( /
=
êê0 1
new
êê2 5
dbModels
êê6 >
(
êê> ?
)
êê? @
)
êê@ A
{
ëë 

Checkpoint
íí &

checkpoint
íí' 1
=
íí2 3
context
íí4 ;
.
íí; <

Checkpoint
íí< F
.
ííF G
Where
ííG L
(
ííL M
x
ííM N
=>
ííO Q
x
ííR S
.
ííS T
idCheckpoint
ííT `
==
íía c
item
ííd h
.
ííh i
idCheckpoint
ííi u
)
ííu v
.
íív w
FirstOrDefaultííw Ö
(ííÖ Ü
)ííÜ á
;ííá à
if
ìì 
(
ìì  
count
ìì  %
==
ìì& (
$num
ìì) *
&&
ìì+ -
muestra
ìì. 5
.
ìì5 6

StartPoint
ìì6 @
==
ììA C
null
ììD H
)
ììH I
muestra
ììJ Q
.
ììQ R

StartPoint
ììR \
=
ìì] ^
new
ìì_ b
decimal
ììc j
[
ììj k
]
ììk l
{
ììm n
(
ììo p
decimal
ììp w
)
ììw x

checkpointììx Ç
.ììÇ É
latitudììÉ ä
,ììä ã
(ììå ç
decimalììç î
)ììî ï

checkpointììï ü
.ììü †
longitudìì† ®
}ìì© ™
;ìì™ ´
muestra
îî #
.
îî# $%
IntermediateCheckpoints
îî$ ;
.
îî; <
Add
îî< ?
(
îî? @
new
îî@ C
string
îîD J
[
îîJ K
]
îîK L
{
îîM N

checkpoint
îîO Y
.
îîY Z
latitud
îîZ a
.
îîa b
ToString
îîb j
(
îîj k
)
îîk l
,
îîl m

checkpoint
îîn x
.
îîx y
longitudîîy Å
.îîÅ Ç
ToStringîîÇ ä
(îîä ã
)îîã å
,îîå ç

checkpointîîé ò
.îîò ô
descriptionîîô §
}îî• ¶
)îî¶ ß
;îîß ®
count
ïï !
++
ïï! #
;
ïï# $
}
ññ 
}
óó 
foreach
òò 
(
òò 
var
òò  
item
òò! %
in
òò& (
checkpoints
òò) 4
)
òò4 5
{
ôô 

Checkpoint
öö "
check
öö# (
=
öö) *
new
öö+ .

Checkpoint
öö/ 9
(
öö9 :
)
öö: ;
;
öö; <
if
õõ 
(
õõ 
item
õõ  
.
õõ  !
status
õõ! '
==
õõ( *
$num
õõ+ ,
)
õõ, -
using
úú !
(
úú" #
dbModels
úú# +
context
úú, 3
=
úú4 5
new
úú6 9
dbModels
úú: B
(
úúB C
)
úúC D
)
úúD E
{
ùù 
check
ûû  %
=
ûû& '
context
ûû( /
.
ûû/ 0

Checkpoint
ûû0 :
.
ûû: ;
Where
ûû; @
(
ûû@ A
x
ûûA B
=>
ûûC E
x
ûûF G
.
ûûG H
idCheckpoint
ûûH T
==
ûûU W
item
ûûX \
.
ûû\ ]
idCheckpoint
ûû] i
)
ûûi j
.
ûûj k
FirstOrDefault
ûûk y
(
ûûy z
)
ûûz {
;
ûû{ |
if
üü  "
(
üü# $
check
üü$ )
!=
üü* ,
null
üü- 1
)
üü1 2
muestra
üü3 :
.
üü: ;
NameCheckpoint
üü; I
.
üüI J
Add
üüJ M
(
üüM N
new
üüN Q
string
üüR X
[
üüX Y
]
üüY Z
{
üü[ \
item
üü] a
.
üüa b
idCheckpoint
üüb n
.
üün o
ToString
üüo w
(
üüw x
)
üüx y
,
üüy z
checküü{ Ä
.üüÄ Å
descriptionüüÅ å
}üüç é
)üüé è
;üüè ê
}
†† 
}
°° 
}
¢¢ 
using
££ 
(
££ 
dbModels
££ 
context
££  '
=
££( )
new
££* -
dbModels
££. 6
(
££6 7
)
££7 8
)
££8 9"
ultCheckpoint_Result
££: N
=
££O P
context
££Q X
.
££X Y
UltCheckpoint
££Y f
(
££f g
Linea
££g l
)
££l m
.
££m n
ToList
££n t
(
££t u
)
££u v
;
££v w
if
§§ 
(
§§ "
ultCheckpoint_Result
§§ (
!=
§§) +
null
§§, 0
)
§§0 1
{
•• 
foreach
¶¶ 
(
¶¶ 
var
¶¶  
item
¶¶! %
in
¶¶& ("
ultCheckpoint_Result
¶¶) =
)
¶¶= >
{
ßß 
DateTime
®®  
hoy
®®! $
=
®®% &
DateTime
®®' /
.
®®/ 0
Now
®®0 3
;
®®3 4
TimeSpan
©©  

diferencia
©©! +
=
©©, -
(
©©. /
DateTime
©©/ 7
)
©©7 8
item
©©8 <
.
©©< =
dateRegister
©©= I
-
©©J K
hoy
©©L O
;
©©O P
double
™™ 
minutosDiferencia
™™ 0
=
™™1 2
Math
™™3 7
.
™™7 8
Floor
™™8 =
(
™™= >

diferencia
™™> H
.
™™H I
TotalMinutes
™™I U
)
™™U V
;
™™V W
if
´´ 
(
´´ 
minutosDiferencia
´´ -
<
´´. /
$num
´´0 1
)
´´1 2
minutosDiferencia
´´3 D
=
´´E F
minutosDiferencia
´´G X
*
´´Y Z
(
´´[ \
-
´´\ ]
$num
´´] ^
)
´´^ _
;
´´_ `
long
¨¨ 
date
¨¨ !
=
¨¨" #
(
¨¨$ %
long
¨¨% )
)
¨¨) *
minutosDiferencia
¨¨* ;
;
¨¨; <
muestra
≠≠ 
.
≠≠  
ultCheckpoints
≠≠  .
.
≠≠. /
Add
≠≠/ 2
(
≠≠2 3
new
≠≠3 6#
CheckpointInSearchMap
≠≠7 L
(
≠≠L M
item
≠≠M Q
.
≠≠Q R

idEmployee
≠≠R \
,
≠≠\ ]
(
≠≠^ _
int
≠≠_ b
)
≠≠b c
item
≠≠c g
.
≠≠g h
idCheckpoint
≠≠h t
,
≠≠t u
(
≠≠v w
DateTime
≠≠w 
)≠≠ Ä
item≠≠Ä Ñ
.≠≠Ñ Ö
dateRegister≠≠Ö ë
,≠≠ë í
(≠≠ì î
int≠≠î ó
)≠≠ó ò
item≠≠ò ú
.≠≠ú ù
status≠≠ù £
,≠≠£ §
item≠≠§ ®
.≠≠® ©
name≠≠© ≠
.≠≠≠ Æ
ToString≠≠Æ ∂
(≠≠∂ ∑
)≠≠∑ ∏
,≠≠∏ π
date≠≠∫ æ
)≠≠æ ø
)≠≠ø ¿
;≠≠¿ ¡
}
ÆÆ 
}
ØØ 
if
∞∞ 
(
∞∞ 
muestra
∞∞ 
.
∞∞ 
EndPoint
∞∞ $
==
∞∞% '
null
∞∞( ,
)
∞∞, -
muestra
∞∞. 5
.
∞∞5 6
EndPoint
∞∞6 >
=
∞∞? @
muestra
∞∞A H
.
∞∞H I

StartPoint
∞∞I S
;
∞∞S T
muestra
±± 
.
±± 
price
±± 
=
±± 
decimal
±±  '
.
±±' (
Parse
±±( -
(
±±- .
line
±±. 2
.
±±2 3
price
±±3 8
.
±±8 9
ToString
±±9 A
(
±±A B
)
±±B C
)
±±C D
;
±±D E
muestra
≤≤ 
.
≤≤ 
nameLine
≤≤  
=
≤≤! "
line
≤≤# '
.
≤≤' (
nameLine
≤≤( 0
;
≤≤0 1
muestra
≥≥ 
.
≥≥ 
description
≥≥ #
=
≥≥$ %
line
≥≥& *
.
≥≥* +
description
≥≥+ 6
;
≥≥6 7
return
¥¥ 
View
¥¥ 
(
¥¥ 
muestra
¥¥ #
)
¥¥# $
;
¥¥$ %
}
µµ 
catch
∂∂ 
(
∂∂ 
	Exception
∂∂ 
)
∂∂ 
{
∑∑ 
return
∏∏ 
RedirectToAction
∏∏ '
(
∏∏' (
$str
∏∏( /
,
∏∏/ 0
$str
∏∏1 7
)
∏∏7 8
;
∏∏8 9
}
ππ 
}
∫∫ 	
public
ªª 
ActionResult
ªª 
CloseSession
ªª (
(
ªª( )
)
ªª) *
{
ºº 	!
FormsAuthentication
ΩΩ 
.
ΩΩ  
SignOut
ΩΩ  '
(
ΩΩ' (
)
ΩΩ( )
;
ΩΩ) *

HttpCookie
øø 

authCookie
øø !
=
øø" #
new
øø$ '

HttpCookie
øø( 2
(
øø2 3!
FormsAuthentication
øø3 F
.
øøF G
FormsCookieName
øøG V
,
øøV W
$str
øøX Z
)
øøZ [
{
¿¿ 
Expires
¡¡ 
=
¡¡ 
DateTime
¡¡ "
.
¡¡" #
Now
¡¡# &
.
¡¡& '
AddDays
¡¡' .
(
¡¡. /
-
¡¡/ 0
$num
¡¡0 1
)
¡¡1 2
,
¡¡2 3
HttpOnly
¬¬ 
=
¬¬ 
true
¬¬ 
}
√√ 
;
√√ 
Response
ƒƒ 
.
ƒƒ 
Cookies
ƒƒ 
.
ƒƒ 
Add
ƒƒ  
(
ƒƒ  !

authCookie
ƒƒ! +
)
ƒƒ+ ,
;
ƒƒ, -
return
∆∆ 
RedirectToAction
∆∆ #
(
∆∆# $
$str
∆∆$ +
,
∆∆+ ,
$str
∆∆- 3
)
∆∆3 4
;
∆∆4 5
}
«« 	
public
»» 
ActionResult
»» 
Error
»» !
(
»»! "
)
»»" #
{
…… 	
return
   
View
   
(
   
)
   
;
   
}
ÀÀ 	
[
ÃÃ 	
ChildActionOnly
ÃÃ	 
]
ÃÃ 
public
ÕÕ 
ActionResult
ÕÕ 
GetMenuData
ÕÕ '
(
ÕÕ' (
)
ÕÕ( )
{
ŒŒ 	
LayoutViewModel
œœ 
layoutModel
œœ '
=
œœ( )
new
œœ* -
LayoutViewModel
œœ. =
(
œœ= >
)
œœ> ?
;
œœ? @

HttpCookie
–– 

authCookie
–– !
=
––" #
Request
––$ +
.
––+ ,
Cookies
––, 3
[
––3 4!
FormsAuthentication
––4 G
.
––G H
FormsCookieName
––H W
]
––W X
;
––X Y
if
—— 
(
—— 

authCookie
—— 
!=
—— 
null
—— "
)
——" #
{
““ '
FormsAuthenticationTicket
”” )
ticket
””* 0
=
””1 2!
FormsAuthentication
””3 F
.
””F G
Decrypt
””G N
(
””N O

authCookie
””O Y
.
””Y Z
Value
””Z _
)
””_ `
;
””` a
if
’’ 
(
’’ 
ticket
’’ 
!=
’’ 
null
’’ "
&&
’’# %
!
’’& '
ticket
’’' -
.
’’- .
Expired
’’. 5
)
’’5 6
{
÷÷ 
var
◊◊ 

cookieData
◊◊ "
=
◊◊# $

Newtonsoft
◊◊% /
.
◊◊/ 0
Json
◊◊0 4
.
◊◊4 5
JsonConvert
◊◊5 @
.
◊◊@ A
DeserializeObject
◊◊A R
<
◊◊R S
dynamic
◊◊S Z
>
◊◊Z [
(
◊◊[ \
ticket
◊◊\ b
.
◊◊b c
UserData
◊◊c k
)
◊◊k l
;
◊◊l m
layoutModel
ÿÿ 
.
ÿÿ  
RoleSession
ÿÿ  +
=
ÿÿ, -

cookieData
ÿÿ. 8
.
ÿÿ8 9
RoleId
ÿÿ9 ?
;
ÿÿ? @
layoutModel
ŸŸ 
.
ŸŸ  

EmployeeId
ŸŸ  *
=
ŸŸ+ ,

cookieData
ŸŸ- 7
.
ŸŸ7 8

EmployeeId
ŸŸ8 B
;
ŸŸB C
layoutModel
⁄⁄ 
.
⁄⁄  
Linea
⁄⁄  %
=
⁄⁄& '

cookieData
⁄⁄( 2
.
⁄⁄2 3
Linea
⁄⁄3 8
;
⁄⁄8 9
return
€€ 
PartialView
€€ &
(
€€& '
$str
€€' 5
,
€€5 6
layoutModel
€€7 B
)
€€B C
;
€€C D
}
‹‹ 
}
›› 
return
ﬁﬁ 
PartialView
ﬁﬁ 
(
ﬁﬁ 
$str
ﬁﬁ 6
)
ﬁﬁ6 7
;
ﬁﬁ7 8
}
ﬂﬂ 	
public
‡‡ 
ActionResult
‡‡ 
	QRActions
‡‡ %
(
‡‡% &
string
‡‡& ,
placa
‡‡- 2
)
‡‡2 3
{
·· 	
if
‚‚ 
(
‚‚ 
placa
‚‚ 
==
‚‚ 
null
‚‚ 
)
‚‚ 
return
‚‚ %
RedirectToAction
‚‚& 6
(
‚‚6 7
$str
‚‚7 >
,
‚‚> ?
$str
‚‚@ F
)
‚‚F G
;
‚‚G H
ViewBag
„„ 
.
„„ 
placa
„„ 
=
„„ 
placa
„„ !
;
„„! "
return
‰‰ 
View
‰‰ 
(
‰‰ 
)
‰‰ 
;
‰‰ 
}
ÂÂ 	
public
ÁÁ 
ActionResult
ÁÁ  
SubmitCalification
ÁÁ .
(
ÁÁ. /
string
ÁÁ/ 5
id
ÁÁ6 8
,
ÁÁ8 9
int
ÁÁ: =
calificacion
ÁÁ> J
)
ÁÁJ K
{
ËË 	
try
ÈÈ 
{
ÍÍ 
TimeZoneInfo
ÎÎ 
boliviaTimeZone
ÎÎ ,
=
ÎÎ- .
TimeZoneInfo
ÎÎ/ ;
.
ÎÎ; <$
FindSystemTimeZoneById
ÎÎ< R
(
ÎÎR S
$str
ÎÎS m
)
ÎÎm n
;
ÎÎn o
DateTime
ÏÏ 
boliviaTime
ÏÏ $
=
ÏÏ% &
TimeZoneInfo
ÏÏ' 3
.
ÏÏ3 4
ConvertTime
ÏÏ4 ?
(
ÏÏ? @
DateTime
ÏÏ@ H
.
ÏÏH I
UtcNow
ÏÏI O
,
ÏÏO P
boliviaTimeZone
ÏÏQ `
)
ÏÏ` a
;
ÏÏa b
Employee
ÌÌ 
employee
ÌÌ !
=
ÌÌ" #
new
ÌÌ$ '
Employee
ÌÌ( 0
(
ÌÌ0 1
)
ÌÌ1 2
;
ÌÌ2 3
using
ÓÓ 
(
ÓÓ 
dbModels
ÓÓ 
context
ÓÓ  '
=
ÓÓ( )
new
ÓÓ* -
dbModels
ÓÓ. 6
(
ÓÓ6 7
)
ÓÓ7 8
)
ÓÓ8 9
{
ÔÔ 
employee
 
=
 
context
 &
.
& '
Employee
' /
.
/ 0
Where
0 5
(
5 6
x
6 7
=>
8 :
x
; <
.
< =
plate
= B
==
C E
id
F H
.
H I
Trim
I M
(
M N
)
N O
)
O P
.
P Q
FirstOrDefault
Q _
(
_ `
)
` a
;
a b
if
ÒÒ 
(
ÒÒ 
employee
ÒÒ  
==
ÒÒ! #
null
ÒÒ$ (
)
ÒÒ( )
return
ÚÚ 
RedirectToAction
ÚÚ /
(
ÚÚ/ 0
$str
ÚÚ0 7
,
ÚÚ7 8
$str
ÚÚ9 ?
)
ÚÚ? @
;
ÚÚ@ A
var
ÙÙ 
star
ÙÙ 
=
ÙÙ 
new
ÙÙ "
Star
ÙÙ# '
{
ıı 
numStar
ˆˆ 
=
ˆˆ  !
calificacion
ˆˆ" .
,
ˆˆ. /

idEmployee
˜˜ "
=
˜˜# $
employee
˜˜% -
.
˜˜- .

idEmployee
˜˜. 8
,
˜˜8 9
dateRegister
¯¯ $
=
¯¯% &
boliviaTime
¯¯' 2
}
˘˘ 
;
˘˘ 
context
˙˙ 
.
˙˙ 
Star
˙˙  
.
˙˙  !
Add
˙˙! $
(
˙˙$ %
star
˙˙% )
)
˙˙) *
;
˙˙* +
context
˚˚ 
.
˚˚ 
SaveChanges
˚˚ '
(
˚˚' (
)
˚˚( )
;
˚˚) *
}
¸¸ 
return
˝˝ 
RedirectToAction
˝˝ '
(
˝˝' (
$str
˝˝( 3
,
˝˝3 4
$str
˝˝5 ;
,
˝˝; <
new
˝˝= @
{
˝˝A B
placa
˝˝C H
=
˝˝I J
employee
˝˝K S
.
˝˝S T
plate
˝˝T Y
}
˝˝Z [
)
˝˝[ \
;
˝˝\ ]
}
˛˛ 
catch
ˇˇ 
(
ˇˇ 
	Exception
ˇˇ 
ex
ˇˇ 
)
ˇˇ  
{
ÄÄ 
return
ÅÅ 
RedirectToAction
ÅÅ '
(
ÅÅ' (
$str
ÅÅ( /
,
ÅÅ/ 0
$str
ÅÅ1 7
)
ÅÅ7 8
;
ÅÅ8 9
}
ÇÇ 
}
ÉÉ 	
public
ÖÖ 
ActionResult
ÖÖ 
SubmitReport
ÖÖ (
(
ÖÖ( )
string
ÖÖ) /
id
ÖÖ0 2
,
ÖÖ2 3
string
ÖÖ4 :
reason
ÖÖ; A
)
ÖÖA B
{
ÜÜ 	
try
áá 
{
àà 
TimeZoneInfo
ââ 
boliviaTimeZone
ââ ,
=
ââ- .
TimeZoneInfo
ââ/ ;
.
ââ; <$
FindSystemTimeZoneById
ââ< R
(
ââR S
$str
ââS m
)
ââm n
;
âân o
DateTime
ää 
boliviaTime
ää $
=
ää% &
TimeZoneInfo
ää' 3
.
ää3 4
ConvertTime
ää4 ?
(
ää? @
DateTime
ää@ H
.
ääH I
UtcNow
ääI O
,
ääO P
boliviaTimeZone
ääQ `
)
ää` a
;
ääa b
Employee
ãã 
employee
ãã !
=
ãã" #
new
ãã$ '
Employee
ãã( 0
(
ãã0 1
)
ãã1 2
;
ãã2 3
using
åå 
(
åå 
dbModels
åå 
context
åå  '
=
åå( )
new
åå* -
dbModels
åå. 6
(
åå6 7
)
åå7 8
)
åå8 9
{
çç 
employee
éé 
=
éé 
context
éé &
.
éé& '
Employee
éé' /
.
éé/ 0
Where
éé0 5
(
éé5 6
x
éé6 7
=>
éé8 :
x
éé; <
.
éé< =
plate
éé= B
==
ééC E
id
ééF H
.
ééH I
Trim
ééI M
(
ééM N
)
ééN O
)
ééO P
.
ééP Q
FirstOrDefault
ééQ _
(
éé_ `
)
éé` a
;
ééa b
if
èè 
(
èè 
employee
èè  
==
èè! #
null
èè$ (
)
èè( )
return
êê 
RedirectToAction
êê /
(
êê/ 0
$str
êê0 7
,
êê7 8
$str
êê9 ?
)
êê? @
;
êê@ A
var
íí 
report
íí 
=
íí  
new
íí! $
Report
íí% +
{
ìì 

idEmployee
îî "
=
îî# $
employee
îî% -
.
îî- .

idEmployee
îî. 8
,
îî8 9
description
ïï #
=
ïï$ %
reason
ïï& ,
,
ïï, -
dateRegister
ññ $
=
ññ% &
boliviaTime
ññ' 2
}
óó 
;
óó 
context
òò 
.
òò 
Report
òò "
.
òò" #
Add
òò# &
(
òò& '
report
òò' -
)
òò- .
;
òò. /
context
ôô 
.
ôô 
SaveChanges
ôô '
(
ôô' (
)
ôô( )
;
ôô) *
}
öö 
return
õõ 
RedirectToAction
õõ '
(
õõ' (
$str
õõ( 3
,
õõ3 4
$str
õõ5 ;
,
õõ; <
new
õõ= @
{
õõA B
placa
õõC H
=
õõI J
employee
õõK S
.
õõS T
plate
õõT Y
}
õõZ [
)
õõ[ \
;
õõ\ ]
}
úú 
catch
ùù 
(
ùù 
	Exception
ùù 
ex
ùù 
)
ùù  
{
ûû 
return
üü 
RedirectToAction
üü '
(
üü' (
$str
üü( /
,
üü/ 0
$str
üü1 7
)
üü7 8
;
üü8 9
}
†† 
}
°° 	
}
¢¢ 
}§§ óâ
PC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Controllers\EmployeeController.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Controllers" -
{ 
public 

class 
EmployeeController #
:$ %

Controller& 0
{ 
public 
ActionResult 
Index !
(! "
)" #
{ 	
try 
{ 
Login 
logi 
= 
new  
Login! &
(& '
)' (
;( )
var 

authResult 
=  
AutenticarPasosRol! 3
(3 4
$num4 5
)5 6
;6 7
if 
( 

authResult 
!= !
null" &
)& '
return( .

authResult/ 9
;9 :
string 
linea 
= 
logi #
.# $
GetLineaFromCookie$ 6
(6 7
Request7 >
)> ?
.? @
ToString@ H
(H I
)I J
;J K
List 
< 
MuestraEmployee $
>$ %
muestraEmployees& 6
=7 8
new9 <
List= A
<A B
MuestraEmployeeB Q
>Q R
(R S
)S T
;T U
TimeZoneInfo 
boliviaTimeZone ,
=- .
TimeZoneInfo/ ;
.; <"
FindSystemTimeZoneById< R
(R S
$strS m
)m n
;n o
DateTime 
boliviaTime $
=% &
TimeZoneInfo' 3
.3 4
ConvertTime4 ?
(? @
DateTime@ H
.H I
UtcNowI O
,O P
boliviaTimeZoneQ `
)` a
;a b
List   
<   
Employee   
>   
employee   '
=  ( )
new  * -
List  . 2
<  2 3
Employee  3 ;
>  ; <
(  < =
)  = >
;  > ?
using!! 
(!! 
dbModels!! 
context!!  '
=!!( )
new!!* -
dbModels!!. 6
(!!6 7
)!!7 8
)!!8 9
employee"" 
="" 
context"" &
.""& '
Employee""' /
.""/ 0
ToList""0 6
(""6 7
)""7 8
.""8 9
Where""9 >
(""> ?
x""? @
=>""A C
x""D E
.""E F
status""F L
==""M O
$num""P Q
&&""R T
x""U V
.""V W
idLine""W ]
==""^ `
linea""a f
)""f g
.""g h
ToList""h n
(""n o
)""o p
;""p q
foreach## 
(## 
var## 
item## !
in##" $
employee##% -
)##- .
using$$ 
($$ 
dbModels$$ #
context$$$ +
=$$, -
new$$. 1
dbModels$$2 :
($$: ;
)$$; <
)$$< =
{%% 
Person&& 
person&& %
=&&& '
context&&( /
.&&/ 0
Person&&0 6
.&&6 7
Where&&7 <
(&&< =
x&&= >
=>&&? A
x&&B C
.&&C D
nit&&D G
==&&H J
item&&K O
.&&O P

idEmployee&&P Z
)&&Z [
.&&[ \
FirstOrDefault&&\ j
(&&j k
)&&k l
;&&l m
if'' 
('' 
person'' "
.''" #
idRole''# )
==''* ,
$num''- .
)''. /
{(( 
double)) "
start))# (
=))) *
$num))+ ,
;)), -
double** "
count**# (
=**) *
$num**+ ,
;**, -
var++ 
stars++  %
=++& '
context++( /
.++/ 0
Star++0 4
.++4 5
Where++5 :
(++: ;
x++; <
=>++= ?
x++@ A
.++A B

idEmployee++B L
==++M O
item++P T
.++T U

idEmployee++U _
)++_ `
.++` a
ToList++a g
(++g h
)++h i
;++i j
var,, 
star,,  $
=,,% &
stars,,' ,
.,,, -
Where,,- 2
(,,2 3
x,,3 4
=>,,5 7
DateTime,,8 @
.,,@ A
Parse,,A F
(,,F G
x,,G H
.,,H I
dateRegister,,I U
.,,U V
ToString,,V ^
(,,^ _
),,_ `
),,` a
.,,a b
Month,,b g
==,,h j
boliviaTime,,k v
.,,v w
Year,,w {
&&,,| ~
DateTime	,, á
.
,,á à
Parse
,,à ç
(
,,ç é
x
,,é è
.
,,è ê
dateRegister
,,ê ú
.
,,ú ù
ToString
,,ù •
(
,,• ¶
)
,,¶ ß
)
,,ß ®
.
,,® ©
Month
,,© Æ
==
,,Ø ±
boliviaTime
,,≤ Ω
.
,,Ω æ
Year
,,æ ¬
)
,,¬ √
.
,,√ ƒ
ToList
,,ƒ  
(
,,  À
)
,,À Ã
;
,,Ã Õ
if-- 
(--  
stars--  %
.--% &
Count--& +
>--, -
$num--. /
)--/ 0
foreach..  '
(..( )
var..) ,
item2..- 2
in..3 5
stars..6 ;
)..; <
{//  !
count00$ )
++00) +
;00+ ,
start11$ )
=11* +
start11, 1
+112 3
double114 :
.11: ;
Parse11; @
(11@ A
item211A F
.11F G
numStar11G N
.11N O
ToString11O W
(11W X
)11X Y
)11Y Z
;11Z [
}22  !
start33 !
=33" #
start33$ )
/33* +
count33, 1
;331 2
start44 !
=44" #
Math44$ (
.44( )
Round44) .
(44. /
start44/ 4
,444 5
$num446 7
)447 8
;448 9
muestraEmployees55 ,
.55, -
Add55- 0
(550 1
new551 4
MuestraEmployee555 D
(55D E
person55E K
.55K L
nit55L O
,55O P
person55Q W
.55W X
name55X \
+55] ^
$str55_ b
+55c d
person55e k
.55k l
lastname55l t
+55u v
$str55w |
+55} ~
start	55 Ñ
+
55Ö Ü
$str
55á ä
,
55ä ã
(
55å ç
decimal
55ç î
)
55î ï
item
55ï ô
.
55ô ö
salary
55ö †
,
55† °
item
55¢ ¶
.
55¶ ß
plate
55ß ¨
,
55¨ ≠
int
55Æ ±
.
55± ≤
Parse
55≤ ∑
(
55∑ ∏
person
55∏ æ
.
55æ ø
idRole
55ø ≈
.
55≈ ∆
ToString
55∆ Œ
(
55Œ œ
)
55œ –
)
55– —
,
55— “
$str
55” ÷
)
55÷ ◊
)
55◊ ÿ
;
55ÿ Ÿ
}66 
else77 
muestraEmployees88 (
.88( )
Add88) ,
(88, -
new88- 0
MuestraEmployee881 @
(88@ A
person88A G
.88G H
nit88H K
,88K L
person88M S
.88S T
name88T X
+88Y Z
$str88[ ^
+88_ `
person88a g
.88g h
lastname88h p
,88p q
(88r s
decimal88s z
)88z {
item88{ 
.	88 Ä
salary
88Ä Ü
,
88Ü á
item
88à å
.
88å ç
plate
88ç í
,
88í ì
int
88î ó
.
88ó ò
Parse
88ò ù
(
88ù û
person
88û §
.
88§ •
idRole
88• ´
.
88´ ¨
ToString
88¨ ¥
(
88¥ µ
)
88µ ∂
)
88∂ ∑
,
88∑ ∏
$str
88π º
)
88º Ω
)
88Ω æ
;
88æ ø
}99 
foreach:: 
(:: 
var:: 
item:: !
in::" $
muestraEmployees::% 5
)::5 6
{;; 
using<< 
(<< 
dbModels<< #
context<<$ +
=<<, -
new<<. 1
dbModels<<2 :
(<<: ;
)<<; <
)<<< =
{== 

Checkpoint>> "

checkpoint>># -
=>>. /
context>>0 7
.>>7 8

Checkpoint>>8 B
.>>B C
Where>>C H
(>>H I
x>>I J
=>>>K M
x>>N O
.>>O P

idEmployee>>P Z
==>>[ ]
item>>^ b
.>>b c

idEmployee>>c m
)>>m n
.>>n o
FirstOrDefault>>o }
(>>} ~
)>>~ 
;	>> Ä
if?? 
(?? 

checkpoint?? &
!=??' )
null??* .
)??. /
item@@  
.@@  !
description@@! ,
=@@- .

checkpoint@@/ 9
.@@9 :
description@@: E
;@@E F
}AA 
}BB 
returnCC 
ViewCC 
(CC 
muestraEmployeesCC ,
)CC, -
;CC- .
}DD 
catchEE 
(EE 
	ExceptionEE 
)EE 
{FF 
returnGG 
RedirectToActionGG '
(GG' (
$strGG( /
,GG/ 0
$strGG1 7
)GG7 8
;GG8 9
}HH 
}KK 	
publicLL 
ActionResultLL 
VerificationChoferLL .
(LL. /
)LL/ 0
{MM 	
varNN 

authResultNN 
=NN 
AutenticarPasosRolNN /
(NN/ 0
$numNN0 1
)NN1 2
;NN2 3
ifOO 
(OO 

authResultOO 
!=OO 
nullOO "
)OO" #
returnOO$ *

authResultOO+ 5
;OO5 6
SessionPP 
[PP 
$strPP 
]PP 
=PP 
nullPP  $
;PP$ %
SessionQQ 
[QQ 
$strQQ "
]QQ" #
=QQ$ %
nullQQ& *
;QQ* +
returnRR 
ViewRR 
(RR 
)RR 
;RR 
}SS 	
[TT 	
HttpPostTT	 
]TT 
publicUU 
ActionResultUU 
VerificationChoferUU .
(UU. /
EmployeeChoferUU/ =
employeechoferUU> L
)UUL M
{VV 	
varWW 

authResultWW 
=WW 
AutenticarPasosRolWW /
(WW/ 0
$numWW0 1
)WW1 2
;WW2 3
ifXX 
(XX 

authResultXX 
!=XX 
nullXX "
)XX" #
returnXX$ *

authResultXX+ 5
;XX5 6
employeechoferYY 
.YY 

idEmployeeYY %
=YY& '
employeechoferYY( 6
.YY6 7

idEmployeeYY7 A
.YYA B
ToStringYYB J
(YYJ K
)YYK L
.YYL M
ToUpperYYM T
(YYT U
)YYU V
.YYV W
TrimYYW [
(YY[ \
)YY\ ]
;YY] ^
EmployeeZZ 
emZZ 
=ZZ 
newZZ 
EmployeeZZ &
(ZZ& '
)ZZ' (
;ZZ( )
using[[ 
([[ 
dbModels[[ 
context[[ #
=[[$ %
new[[& )
dbModels[[* 2
([[2 3
)[[3 4
)[[4 5
em[[6 8
=[[9 :
context[[; B
.[[B C
Employee[[C K
.[[K L
Where[[L Q
([[Q R
x[[R S
=>[[T V
x[[W X
.[[X Y

idEmployee[[Y c
.[[c d
ToUpper[[d k
([[k l
)[[l m
.[[m n
Trim[[n r
([[r s
)[[s t
==[[u w
employeechofer	[[x Ü
.
[[Ü á

idEmployee
[[á ë
&&
[[í î
x
[[ï ñ
.
[[ñ ó
status
[[ó ù
==
[[û †
$num
[[° ¢
)
[[¢ £
.
[[£ §
FirstOrDefault
[[§ ≤
(
[[≤ ≥
)
[[≥ ¥
;
[[¥ µ
if\\ 
(\\ 
em\\ 
!=\\ 
null\\ 
)\\ 
{]] 
ViewBag^^ 
.^^ 
NIT^^ 
=^^ 
$str^^ >
;^^> ?
return__ 
View__ 
(__ 
)__ 
;__ 
}`` 
Personaa 
personaa 
=aa 
newaa 
Personaa  &
(aa& '
)aa' (
;aa( )
usingbb 
(bb 
dbModelsbb 
contextbb #
=bb$ %
newbb& )
dbModelsbb* 2
(bb2 3
)bb3 4
)bb4 5
personbb6 <
=bb= >
contextbb? F
.bbF G
PersonbbG M
.bbM N
WherebbN S
(bbS T
xbbT U
=>bbV X
xbbY Z
.bbZ [
nitbb[ ^
.bb^ _
ToUpperbb_ f
(bbf g
)bbg h
.bbh i
ToStringbbi q
(bbq r
)bbr s
.bbs t
Trimbbt x
(bbx y
)bby z
==bb{ }
employeechofer	bb~ å
.
bbå ç

idEmployee
bbç ó
&&
bbò ö
x
bbõ ú
.
bbú ù
status
bbù £
==
bb§ ¶
$num
bbß ®
)
bb® ©
.
bb© ™
FirstOrDefault
bb™ ∏
(
bb∏ π
)
bbπ ∫
;
bb∫ ª
Sessioncc 
[cc 
$strcc 
]cc 
=cc 
employeechofercc  .
.cc. /

idEmployeecc/ 9
;cc9 :
ifdd 
(dd 
persondd 
==dd 
nulldd 
)dd 
returndd  &
RedirectToActiondd' 7
(dd7 8
$strdd8 F
)ddF G
;ddG H
elseee 
ifee 
(ee 
personee 
.ee 
statusee "
==ee# %
$numee& '
&&ee( *
personee+ 1
.ee1 2
idRoleee2 8
==ee9 ;
$numee< =
)ee= >
{ff 
Sessiongg 
[gg 
$strgg &
]gg& '
=gg( )
persongg* 0
;gg0 1
returnhh 
RedirectToActionhh '
(hh' (
$strhh( A
)hhA B
;hhB C
}ii 
ViewBagjj 
.jj 
NITjj 
=jj 
$strjj 9
;jj9 :
returnkk 
Viewkk 
(kk 
)kk 
;kk 
}ll 	
publicmm 
ActionResultmm #
CreateExistPersonChofermm 3
(mm3 4
)mm4 5
{nn 	
Loginoo 
logioo 
=oo 
newoo 
Loginoo "
(oo" #
)oo# $
;oo$ %
varpp 

authResultpp 
=pp 
AutenticarPasosRolpp /
(pp/ 0
$numpp0 1
)pp1 2
;pp2 3
ifqq 
(qq 

authResultqq 
!=qq 
nullqq "
)qq" #
returnqq$ *

authResultqq+ 5
;qq5 6
stringrr 
linearr 
=rr 
logirr 
.rr  
GetLineaFromCookierr  2
(rr2 3
Requestrr3 :
)rr: ;
.rr; <
ToStringrr< D
(rrD E
)rrE F
;rrF G
ifss 
(ss 
logiss 
.ss $
GetRoleSessionFromCookiess -
(ss- .
Requestss. 5
)ss5 6
.ss6 7
ToStringss7 ?
(ss? @
)ss@ A
!=ssB D
$strssE H
||ssI K
SessionssL S
[ssS T
$strssT \
]ss\ ]
==ss^ `
nullssa e
||ssf h
Sessionssi p
[ssp q
$strssq 
]	ss Ä
==
ssÅ É
null
ssÑ à
)
ssà â
return
ssä ê
RedirectToAction
ssë °
(
ss° ¢
$str
ss¢ ©
,
ss© ™
$str
ss´ ±
)
ss± ≤
;
ss≤ ≥
returntt 
Viewtt 
(tt 
)tt 
;tt 
}uu 	
[ww 	
HttpPostww	 
]ww 
publicxx 
ActionResultxx #
CreateExistPersonChoferxx 3
(xx3 4
EmployeeChoferxx4 B
employeechoferxxC Q
)xxQ R
{yy 	
tryzz 
{{{ 
Login|| 
logi|| 
=|| 
new||  
Login||! &
(||& '
)||' (
;||( )
var}} 

authResult}} 
=}}  
AutenticarPasosRol}}! 3
(}}3 4
$num}}4 5
)}}5 6
;}}6 7
if~~ 
(~~ 

authResult~~ 
!=~~ !
null~~" &
)~~& '
return~~( .

authResult~~/ 9
;~~9 :
string 
Linea 
= 
logi #
.# $
GetLineaFromCookie$ 6
(6 7
Request7 >
)> ?
.? @
ToString@ H
(H I
)I J
;J K
if
ÄÄ 
(
ÄÄ 
logi
ÄÄ 
.
ÄÄ &
GetRoleSessionFromCookie
ÄÄ 1
(
ÄÄ1 2
Request
ÄÄ2 9
)
ÄÄ9 :
.
ÄÄ: ;
ToString
ÄÄ; C
(
ÄÄC D
)
ÄÄD E
!=
ÄÄF H
$str
ÄÄI L
||
ÄÄM O
Session
ÄÄP W
[
ÄÄW X
$str
ÄÄX `
]
ÄÄ` a
==
ÄÄb d
null
ÄÄe i
||
ÄÄj l
Session
ÄÄm t
[
ÄÄt u
$strÄÄu É
]ÄÄÉ Ñ
==ÄÄÖ á
nullÄÄà å
)ÄÄå ç
returnÄÄé î 
RedirectToActionÄÄï •
(ÄÄ• ¶
$strÄÄ¶ ≠
,ÄÄ≠ Æ
$strÄÄØ µ
)ÄÄµ ∂
;ÄÄ∂ ∑
string
ÅÅ 
numeroFormateado
ÅÅ '
=
ÅÅ( )
$str
ÅÅ* .
;
ÅÅ. /
employeechofer
ÇÇ 
.
ÇÇ 

idEmployee
ÇÇ )
=
ÇÇ* +
Session
ÇÇ, 3
[
ÇÇ3 4
$str
ÇÇ4 <
]
ÇÇ< =
.
ÇÇ= >
ToString
ÇÇ> F
(
ÇÇF G
)
ÇÇG H
;
ÇÇH I
TimeZoneInfo
ÉÉ 
boliviaTimeZone
ÉÉ ,
=
ÉÉ- .
TimeZoneInfo
ÉÉ/ ;
.
ÉÉ; <$
FindSystemTimeZoneById
ÉÉ< R
(
ÉÉR S
$str
ÉÉS m
)
ÉÉm n
;
ÉÉn o
DateTime
ÑÑ 
boliviaTime
ÑÑ $
=
ÑÑ% &
TimeZoneInfo
ÑÑ' 3
.
ÑÑ3 4
ConvertTime
ÑÑ4 ?
(
ÑÑ? @
DateTime
ÑÑ@ H
.
ÑÑH I
UtcNow
ÑÑI O
,
ÑÑO P
boliviaTimeZone
ÑÑQ `
)
ÑÑ` a
;
ÑÑa b
using
ÖÖ 
(
ÖÖ 
dbModels
ÖÖ 
context
ÖÖ  '
=
ÖÖ( )
new
ÖÖ* -
dbModels
ÖÖ. 6
(
ÖÖ6 7
)
ÖÖ7 8
)
ÖÖ8 9
{
ÜÜ 
Employee
áá 
e
áá 
=
áá  
context
áá! (
.
áá( )
Employee
áá) 1
.
áá1 2
Where
áá2 7
(
áá7 8
x
áá8 9
=>
áá: <
x
áá= >
.
áá> ?
plate
áá? D
.
ááD E
ToUpper
ááE L
(
ááL M
)
ááM N
.
ááN O
Trim
ááO S
(
ááS T
)
ááT U
==
ááV X
employeechofer
ááY g
.
áág h
plate
ááh m
.
áám n
ToUpper
áán u
(
ááu v
)
ááv w
.
ááw x
Trim
ááx |
(
áá| }
)
áá} ~
&&áá Å
xááÇ É
.ááÉ Ñ
statusááÑ ä
==ááã ç
$numááé è
)ááè ê
.ááê ë
FirstOrDefaultááë ü
(ááü †
)áá† °
;áá° ¢
if
àà 
(
àà 
e
àà 
!=
àà 
null
àà !
)
àà! "
{
ââ 
TempData
ää  
[
ää  !
$str
ää! (
]
ää( )
=
ää* +
$str
ää, O
;
ääO P
return
ãã 
View
ãã #
(
ãã# $
)
ãã$ %
;
ãã% &
}
åå 
}
çç 
Employee
éé 
em
éé 
=
éé 
new
éé !
Employee
éé" *
(
éé* +
)
éé+ ,
;
éé, -
employeechofer
èè 
.
èè 

idEmployee
èè )
=
èè* +
employeechofer
èè, :
.
èè: ;

idEmployee
èè; E
.
èèE F
ToString
èèF N
(
èèN O
)
èèO P
.
èèP Q
ToUpper
èèQ X
(
èèX Y
)
èèY Z
.
èèZ [
Trim
èè[ _
(
èè_ `
)
èè` a
;
èèa b
using
êê 
(
êê 
dbModels
êê 
context
êê  '
=
êê( )
new
êê* -
dbModels
êê. 6
(
êê6 7
)
êê7 8
)
êê8 9
em
êê: <
=
êê= >
context
êê? F
.
êêF G
Employee
êêG O
.
êêO P
Where
êêP U
(
êêU V
x
êêV W
=>
êêX Z
x
êê[ \
.
êê\ ]

idEmployee
êê] g
.
êêg h
ToUpper
êêh o
(
êêo p
)
êêp q
.
êêq r
ToString
êêr z
(
êêz {
)
êê{ |
.
êê| }
Trimêê} Å
(êêÅ Ç
)êêÇ É
==êêÑ Ü
employeechoferêêá ï
.êêï ñ

idEmployeeêêñ †
&&êê° £
xêê§ •
.êê• ¶
statusêê¶ ¨
==êê≠ Ø
$numêê∞ ±
)êê± ≤
.êê≤ ≥
FirstOrDefaultêê≥ ¡
(êê¡ ¬
)êê¬ √
;êê√ ƒ
if
ëë 
(
ëë 
em
ëë 
!=
ëë 
null
ëë 
)
ëë 
{
íí 
TempData
ìì 
[
ìì 
$str
ìì "
]
ìì" #
=
ìì$ %
$str
ìì& F
;
ììF G
return
îî 
View
îî 
(
îî  
)
îî  !
;
îî! "
}
ïï 
User
ññ 
user
ññ 
=
ññ 
new
ññ 
User
ññ  $
(
ññ$ %
)
ññ% &
;
ññ& '
using
óó 
(
óó 
dbModels
óó 
context
óó  '
=
óó( )
new
óó* -
dbModels
óó. 6
(
óó6 7
)
óó7 8
)
óó8 9
user
óó: >
=
óó? @
context
óóA H
.
óóH I
User
óóI M
.
óóM N
Where
óóN S
(
óóS T
x
óóT U
=>
óóV X
x
óóY Z
.
óóZ [
email
óó[ `
.
óó` a
ToLower
óóa h
(
óóh i
)
óói j
.
óój k
Trim
óók o
(
óóo p
)
óóp q
==
óór t
employeechoferóóu É
.óóÉ Ñ
emailóóÑ â
.óóâ ä
ToLoweróóä ë
(óóë í
)óóí ì
.óóì î
Trimóóî ò
(óóò ô
)óóô ö
)óóö õ
.óóõ ú
FirstOrDefaultóóú ™
(óó™ ´
)óó´ ¨
;óó¨ ≠
if
òò 
(
òò 
user
òò 
!=
òò 
null
òò  
)
òò  !
{
ôô 
TempData
öö 
[
öö 
$str
öö #
]
öö# $
=
öö% &
$str
öö' I
;
ööI J
return
õõ 
View
õõ 
(
õõ  
)
õõ  !
;
õõ! "
}
úú 
Person
ùù 
person
ùù 
=
ùù 
new
ùù  #
Person
ùù$ *
(
ùù* +
)
ùù+ ,
;
ùù, -
using
ûû 
(
ûû 
dbModels
ûû 
context
ûû  '
=
ûû( )
new
ûû* -
dbModels
ûû. 6
(
ûû6 7
)
ûû7 8
)
ûû8 9
person
ûû: @
=
ûûA B
context
ûûC J
.
ûûJ K
Person
ûûK Q
.
ûûQ R
Where
ûûR W
(
ûûW X
x
ûûX Y
=>
ûûZ \
x
ûû] ^
.
ûû^ _
nit
ûû_ b
.
ûûb c
ToString
ûûc k
(
ûûk l
)
ûûl m
==
ûûn p
employeechofer
ûûq 
.ûû Ä

idEmployeeûûÄ ä
.ûûä ã
ToStringûûã ì
(ûûì î
)ûûî ï
)ûûï ñ
.ûûñ ó
FirstOrDefaultûûó •
(ûû• ¶
)ûû¶ ß
;ûûß ®
if
üü 
(
üü 
person
üü 
==
üü 
null
üü "
)
üü" #
{
†† 
using
°° 
(
°° 
dbModels
°° #
context
°°$ +
=
°°, -
new
°°. 1
dbModels
°°2 :
(
°°: ;
)
°°; <
)
°°< =
{
¢¢ 
Person
££ 
personCreate
££ +
=
££, -
new
££. 1
Person
££2 8
(
££8 9
)
££9 :
;
££: ;
personCreate
§§ $
.
§§$ %
idRole
§§% +
=
§§, -
$num
§§. /
;
§§/ 0
personCreate
§§1 =
.
§§= >
status
§§> D
=
§§E F
$num
§§G H
;
§§H I
personCreate
•• $
.
••$ %
dateRegister
••% 1
=
••2 3
boliviaTime
••4 ?
;
••? @
context
¶¶ 
.
¶¶  
Person
¶¶  &
.
¶¶& '
Add
¶¶' *
(
¶¶* +
personCreate
¶¶+ 7
)
¶¶7 8
;
¶¶8 9
context
ßß 
.
ßß  
SaveChanges
ßß  +
(
ßß+ ,
)
ßß, -
;
ßß- .
}
®® 
}
©© 
else
™™ 
if
™™ 
(
™™ 
person
™™ 
.
™™  
status
™™  &
==
™™' )
$num
™™* +
||
™™, .
person
™™/ 5
.
™™5 6
idRole
™™6 <
==
™™= ?
$num
™™@ A
)
™™A B
using
´´ 
(
´´ 
dbModels
´´ #
context
´´$ +
=
´´, -
new
´´. 1
dbModels
´´2 :
(
´´: ;
)
´´; <
)
´´< =
{
¨¨ 
person
≠≠ 
.
≠≠ 
idRole
≠≠ %
=
≠≠& '
$num
≠≠( )
;
≠≠) *
person
≠≠+ 1
.
≠≠1 2
status
≠≠2 8
=
≠≠9 :
$num
≠≠; <
;
≠≠< =
context
ÆÆ 
.
ÆÆ  
Entry
ÆÆ  %
(
ÆÆ% &
person
ÆÆ& ,
)
ÆÆ, -
.
ÆÆ- .
State
ÆÆ. 3
=
ÆÆ4 5
System
ÆÆ6 <
.
ÆÆ< =
Data
ÆÆ= A
.
ÆÆA B
Entity
ÆÆB H
.
ÆÆH I
EntityState
ÆÆI T
.
ÆÆT U
Modified
ÆÆU ]
;
ÆÆ] ^
context
ØØ 
.
ØØ  
SaveChanges
ØØ  +
(
ØØ+ ,
)
ØØ, -
;
ØØ- .
}
∞∞ 
else
±± 
{
≤≤ 
TempData
≥≥ 
[
≥≥ 
$str
≥≥ %
]
≥≥% &
=
≥≥' (
$str
≥≥) H
;
≥≥H I
return
¥¥ 
View
¥¥ 
(
¥¥  
)
¥¥  !
;
¥¥! "
}
µµ 
Employee
∂∂ 
employee
∂∂ !
=
∂∂" #
new
∂∂$ '
Employee
∂∂( 0
(
∂∂0 1
)
∂∂1 2
;
∂∂2 3
employee
∑∑ 
.
∑∑ 
status
∑∑ 
=
∑∑  !
$num
∑∑" #
;
∑∑# $
employee
∑∑% -
.
∑∑- .
dateRegister
∑∑. :
=
∑∑; <
boliviaTime
∑∑= H
;
∑∑H I
employee
∑∑J R
.
∑∑R S
idLine
∑∑S Y
=
∑∑Z [
Linea
∑∑\ a
;
∑∑a b
employee
∏∏ 
.
∏∏ 
plate
∏∏ 
=
∏∏  
employeechofer
∏∏! /
.
∏∏/ 0
plate
∏∏0 5
.
∏∏5 6
ToUpper
∏∏6 =
(
∏∏= >
)
∏∏> ?
.
∏∏? @
Trim
∏∏@ D
(
∏∏D E
)
∏∏E F
;
∏∏F G
employee
∏∏H P
.
∏∏P Q

idEmployee
∏∏Q [
=
∏∏\ ]
employeechofer
∏∏^ l
.
∏∏l m

idEmployee
∏∏m w
.
∏∏w x
Trim
∏∏x |
(
∏∏| }
)
∏∏} ~
;
∏∏~ 
employee
ππ 
.
ππ 
salary
ππ 
=
ππ  !
employeechofer
ππ" 0
.
ππ0 1
salary
ππ1 7
;
ππ7 8
employee
ππ9 A
.
ππA B
enabled
ππB I
=
ππJ K
$num
ππL M
;
ππM N
using
∫∫ 
(
∫∫ 
dbModels
∫∫ 
context
∫∫  '
=
∫∫( )
new
∫∫* -
dbModels
∫∫. 6
(
∫∫6 7
)
∫∫7 8
)
∫∫8 9
em
∫∫: <
=
∫∫= >
context
∫∫? F
.
∫∫F G
Employee
∫∫G O
.
∫∫O P
Where
∫∫P U
(
∫∫U V
x
∫∫V W
=>
∫∫X Z
x
∫∫[ \
.
∫∫\ ]

idEmployee
∫∫] g
.
∫∫g h
ToString
∫∫h p
(
∫∫p q
)
∫∫q r
==
∫∫s u
employeechofer∫∫v Ñ
.∫∫Ñ Ö

idEmployee∫∫Ö è
.∫∫è ê
ToString∫∫ê ò
(∫∫ò ô
)∫∫ô ö
)∫∫ö õ
.∫∫õ ú
FirstOrDefault∫∫ú ™
(∫∫™ ´
)∫∫´ ¨
;∫∫¨ ≠
user
ªª 
=
ªª 
new
ªª 
User
ªª 
(
ªª  
)
ªª  !
;
ªª! "
if
ºº 
(
ºº 
em
ºº 
==
ºº 
null
ºº 
)
ºº 
using
ΩΩ 
(
ΩΩ 
dbModels
ΩΩ #
context
ΩΩ$ +
=
ΩΩ, -
new
ΩΩ. 1
dbModels
ΩΩ2 :
(
ΩΩ: ;
)
ΩΩ; <
)
ΩΩ< =
{
ææ 
context
øø 
.
øø  
Employee
øø  (
.
øø( )
Add
øø) ,
(
øø, -
employee
øø- 5
)
øø5 6
;
øø6 7
context
¿¿ 
.
¿¿  
SaveChanges
¿¿  +
(
¿¿+ ,
)
¿¿, -
;
¿¿- .
}
¡¡ 
else
¬¬ 
if
¬¬ 
(
¬¬ 
em
¬¬ 
.
¬¬ 
status
¬¬ "
==
¬¬# %
$num
¬¬& '
)
¬¬' (
using
√√ 
(
√√ 
dbModels
√√ #
context
√√$ +
=
√√, -
new
√√. 1
dbModels
√√2 :
(
√√: ;
)
√√; <
)
√√< =
{
ƒƒ 
context
≈≈ 
.
≈≈  
Entry
≈≈  %
(
≈≈% &
employee
≈≈& .
)
≈≈. /
.
≈≈/ 0
State
≈≈0 5
=
≈≈6 7
System
≈≈8 >
.
≈≈> ?
Data
≈≈? C
.
≈≈C D
Entity
≈≈D J
.
≈≈J K
EntityState
≈≈K V
.
≈≈V W
Modified
≈≈W _
;
≈≈_ `
context
∆∆ 
.
∆∆  
SaveChanges
∆∆  +
(
∆∆+ ,
)
∆∆, -
;
∆∆- .
}
«« 
EmployeeControl
»» 
employeeControl
»»  /
=
»»0 1
new
»»2 5
EmployeeControl
»»6 E
(
»»E F
)
»»F G
;
»»G H
string
…… 
username
…… 
=
……  !
employeeControl
……" 1
.
……1 2
GenerarUsername
……2 A
(
……A B
person
……B H
.
……H I
name
……I M
.
……M N
Trim
……N R
(
……R S
)
……S T
,
……T U
person
……V \
.
……\ ]
lastname
……] e
.
……e f
Trim
……f j
(
……j k
)
……k l
)
……l m
;
……m n
string
   
pass
   
=
   
employeeControl
   -
.
  - .
GenerarPassword
  . =
(
  = >
)
  > ?
;
  ? @
using
ÀÀ 
(
ÀÀ 
dbModels
ÀÀ 
context
ÀÀ  '
=
ÀÀ( )
new
ÀÀ* -
dbModels
ÀÀ. 6
(
ÀÀ6 7
)
ÀÀ7 8
)
ÀÀ8 9
{
ÃÃ 

Encriptado
ÕÕ 

encriptado
ÕÕ )
=
ÕÕ* +
new
ÕÕ, /

Encriptado
ÕÕ0 :
(
ÕÕ: ;
)
ÕÕ; <
;
ÕÕ< =
user
ŒŒ 
=
ŒŒ 
new
ŒŒ 
User
ŒŒ #
(
ŒŒ# $
)
ŒŒ$ %
;
ŒŒ% &
user
œœ 
.
œœ 

idEmployee
œœ #
=
œœ$ %
employee
œœ& .
.
œœ. /

idEmployee
œœ/ 9
;
œœ9 :
user
–– 
.
–– 
username
–– !
=
––" #
username
––$ ,
;
––, -
user
—— 
.
—— 
password
—— !
=
——" #

encriptado
——$ .
.
——. /
	Encriptar
——/ 8
(
——8 9
pass
——9 =
)
——= >
;
——> ?
user
““ 
.
““ 

firstEntry
““ #
=
““$ %
$num
““& '
;
““' (
user
”” 
.
”” 
email
”” 
=
””  
employeechofer
””! /
.
””/ 0
email
””0 5
.
””5 6
ToLower
””6 =
(
””= >
)
””> ?
.
””? @
Trim
””@ D
(
””D E
)
””E F
;
””F G
context
‘‘ 
.
‘‘ 
User
‘‘  
.
‘‘  !
Add
‘‘! $
(
‘‘$ %
user
‘‘% )
)
‘‘) *
;
‘‘* +
context
’’ 
.
’’ 
SaveChanges
’’ '
(
’’' (
)
’’( )
;
’’) *
employeeControl
÷÷ #
.
÷÷# $
EnviarCorreo
÷÷$ 0
(
÷÷0 1
employeechofer
÷÷1 ?
.
÷÷? @
email
÷÷@ E
.
÷÷E F
ToLower
÷÷F M
(
÷÷M N
)
÷÷N O
.
÷÷O P
Trim
÷÷P T
(
÷÷T U
)
÷÷U V
,
÷÷V W
username
÷÷X `
,
÷÷` a
pass
÷÷b f
)
÷÷f g
;
÷÷g h
}
◊◊ 
return
ÿÿ 
RedirectToAction
ÿÿ '
(
ÿÿ' (
$str
ÿÿ( /
)
ÿÿ/ 0
;
ÿÿ0 1
}
ŸŸ 
catch
⁄⁄ 
{
€€ 
return
‹‹ 
RedirectToAction
‹‹ '
(
‹‹' (
$str
‹‹( /
,
‹‹/ 0
$str
‹‹1 7
)
‹‹7 8
;
‹‹8 9
}
›› 
}
ﬁﬁ 	
public
ﬂﬂ 
ActionResult
ﬂﬂ 
CreateChofer
ﬂﬂ (
(
ﬂﬂ( )
)
ﬂﬂ) *
{
‡‡ 	
Login
·· 
logi
·· 
=
·· 
new
·· 
Login
·· "
(
··" #
)
··# $
;
··$ %
var
‚‚ 

authResult
‚‚ 
=
‚‚  
AutenticarPasosRol
‚‚ /
(
‚‚/ 0
$num
‚‚0 1
)
‚‚1 2
;
‚‚2 3
if
„„ 
(
„„ 

authResult
„„ 
!=
„„ 
null
„„ "
)
„„" #
return
„„$ *

authResult
„„+ 5
;
„„5 6
string
‰‰ 
linea
‰‰ 
=
‰‰ 
logi
‰‰ 
.
‰‰   
GetLineaFromCookie
‰‰  2
(
‰‰2 3
Request
‰‰3 :
)
‰‰: ;
.
‰‰; <
ToString
‰‰< D
(
‰‰D E
)
‰‰E F
;
‰‰F G
if
ÂÂ 
(
ÂÂ 
logi
ÂÂ 
.
ÂÂ &
GetRoleSessionFromCookie
ÂÂ -
(
ÂÂ- .
Request
ÂÂ. 5
)
ÂÂ5 6
.
ÂÂ6 7
ToString
ÂÂ7 ?
(
ÂÂ? @
)
ÂÂ@ A
!=
ÂÂB D
$str
ÂÂE H
||
ÂÂI K
Session
ÂÂL S
[
ÂÂS T
$str
ÂÂT \
]
ÂÂ\ ]
==
ÂÂ^ `
null
ÂÂa e
)
ÂÂe f
return
ÂÂg m
RedirectToAction
ÂÂn ~
(
ÂÂ~ 
$strÂÂ Ü
,ÂÂÜ á
$strÂÂà é
)ÂÂé è
;ÂÂè ê
return
ÊÊ 
View
ÊÊ 
(
ÊÊ 
)
ÊÊ 
;
ÊÊ 
}
ÁÁ 	
[
ÈÈ 	
HttpPost
ÈÈ	 
]
ÈÈ 
public
ÍÍ 
ActionResult
ÍÍ 
CreateChofer
ÍÍ (
(
ÍÍ( )
EmployeeChofer
ÍÍ) 7
employeechofer
ÍÍ8 F
)
ÍÍF G
{
ÎÎ 	
try
ÏÏ 
{
ÌÌ 
Login
ÓÓ 
logi
ÓÓ 
=
ÓÓ 
new
ÓÓ  
Login
ÓÓ! &
(
ÓÓ& '
)
ÓÓ' (
;
ÓÓ( )
var
ÔÔ 

authResult
ÔÔ 
=
ÔÔ   
AutenticarPasosRol
ÔÔ! 3
(
ÔÔ3 4
$num
ÔÔ4 5
)
ÔÔ5 6
;
ÔÔ6 7
if
 
(
 

authResult
 
!=
 !
null
" &
)
& '
return
( .

authResult
/ 9
;
9 :
if
ÒÒ 
(
ÒÒ 
logi
ÒÒ 
.
ÒÒ &
GetRoleSessionFromCookie
ÒÒ 1
(
ÒÒ1 2
Request
ÒÒ2 9
)
ÒÒ9 :
.
ÒÒ: ;
ToString
ÒÒ; C
(
ÒÒC D
)
ÒÒD E
!=
ÒÒF H
$str
ÒÒI L
||
ÒÒM O
Session
ÒÒP W
[
ÒÒW X
$str
ÒÒX `
]
ÒÒ` a
==
ÒÒb d
null
ÒÒe i
)
ÒÒi j
return
ÒÒk q
RedirectToActionÒÒr Ç
(ÒÒÇ É
$strÒÒÉ ä
,ÒÒä ã
$strÒÒå í
)ÒÒí ì
;ÒÒì î
string
ÚÚ 
Linea
ÚÚ 
=
ÚÚ 
logi
ÚÚ #
.
ÚÚ# $ 
GetLineaFromCookie
ÚÚ$ 6
(
ÚÚ6 7
Request
ÚÚ7 >
)
ÚÚ> ?
.
ÚÚ? @
ToString
ÚÚ@ H
(
ÚÚH I
)
ÚÚI J
;
ÚÚJ K
string
ÛÛ 
numeroFormateado
ÛÛ '
=
ÛÛ( )
$str
ÛÛ* .
;
ÛÛ. /
employeechofer
ÙÙ 
.
ÙÙ 

idEmployee
ÙÙ )
=
ÙÙ* +
Session
ÙÙ, 3
[
ÙÙ3 4
$str
ÙÙ4 <
]
ÙÙ< =
.
ÙÙ= >
ToString
ÙÙ> F
(
ÙÙF G
)
ÙÙG H
;
ÙÙH I
TimeZoneInfo
ıı 
boliviaTimeZone
ıı ,
=
ıı- .
TimeZoneInfo
ıı/ ;
.
ıı; <$
FindSystemTimeZoneById
ıı< R
(
ııR S
$str
ııS m
)
ıım n
;
ıın o
DateTime
ˆˆ 
boliviaTime
ˆˆ $
=
ˆˆ% &
TimeZoneInfo
ˆˆ' 3
.
ˆˆ3 4
ConvertTime
ˆˆ4 ?
(
ˆˆ? @
DateTime
ˆˆ@ H
.
ˆˆH I
UtcNow
ˆˆI O
,
ˆˆO P
boliviaTimeZone
ˆˆQ `
)
ˆˆ` a
;
ˆˆa b
User
˜˜ 
user
˜˜ 
=
˜˜ 
new
˜˜ 
User
˜˜  $
(
˜˜$ %
)
˜˜% &
;
˜˜& '
using
¯¯ 
(
¯¯ 
dbModels
¯¯ 
context
¯¯  '
=
¯¯( )
new
¯¯* -
dbModels
¯¯. 6
(
¯¯6 7
)
¯¯7 8
)
¯¯8 9
user
¯¯: >
=
¯¯? @
context
¯¯A H
.
¯¯H I
User
¯¯I M
.
¯¯M N
Where
¯¯N S
(
¯¯S T
x
¯¯T U
=>
¯¯V X
x
¯¯Y Z
.
¯¯Z [
email
¯¯[ `
.
¯¯` a
ToLower
¯¯a h
(
¯¯h i
)
¯¯i j
.
¯¯j k
Trim
¯¯k o
(
¯¯o p
)
¯¯p q
==
¯¯r t
employeechofer¯¯u É
.¯¯É Ñ
email¯¯Ñ â
.¯¯â ä
ToLower¯¯ä ë
(¯¯ë í
)¯¯í ì
.¯¯ì î
Trim¯¯î ò
(¯¯ò ô
)¯¯ô ö
)¯¯ö õ
.¯¯õ ú
FirstOrDefault¯¯ú ™
(¯¯™ ´
)¯¯´ ¨
;¯¯¨ ≠
if
˘˘ 
(
˘˘ 
user
˘˘ 
!=
˘˘ 
null
˘˘  
)
˘˘  !
{
˙˙ 
TempData
˚˚ 
[
˚˚ 
$str
˚˚ #
]
˚˚# $
=
˚˚% &
$str
˚˚' I
;
˚˚I J
return
¸¸ 
View
¸¸ 
(
¸¸  
)
¸¸  !
;
¸¸! "
}
˝˝ 
using
˛˛ 
(
˛˛ 
dbModels
˛˛ 
context
˛˛  '
=
˛˛( )
new
˛˛* -
dbModels
˛˛. 6
(
˛˛6 7
)
˛˛7 8
)
˛˛8 9
{
ˇˇ 
Employee
ÄÄ 
e
ÄÄ 
=
ÄÄ  
context
ÄÄ! (
.
ÄÄ( )
Employee
ÄÄ) 1
.
ÄÄ1 2
Where
ÄÄ2 7
(
ÄÄ7 8
x
ÄÄ8 9
=>
ÄÄ: <
x
ÄÄ= >
.
ÄÄ> ?
plate
ÄÄ? D
.
ÄÄD E
ToUpper
ÄÄE L
(
ÄÄL M
)
ÄÄM N
.
ÄÄN O
Trim
ÄÄO S
(
ÄÄS T
)
ÄÄT U
==
ÄÄV X
employeechofer
ÄÄY g
.
ÄÄg h
plate
ÄÄh m
.
ÄÄm n
ToUpper
ÄÄn u
(
ÄÄu v
)
ÄÄv w
.
ÄÄw x
Trim
ÄÄx |
(
ÄÄ| }
)
ÄÄ} ~
&&ÄÄ Å
xÄÄÇ É
.ÄÄÉ Ñ
statusÄÄÑ ä
==ÄÄã ç
$numÄÄé è
)ÄÄè ê
.ÄÄê ë
FirstOrDefaultÄÄë ü
(ÄÄü †
)ÄÄ† °
;ÄÄ° ¢
if
ÅÅ 
(
ÅÅ 
e
ÅÅ 
!=
ÅÅ 
null
ÅÅ !
)
ÅÅ! "
{
ÇÇ 
TempData
ÉÉ  
[
ÉÉ  !
$str
ÉÉ! (
]
ÉÉ( )
=
ÉÉ* +
$str
ÉÉ, O
;
ÉÉO P
return
ÑÑ 
View
ÑÑ #
(
ÑÑ# $
)
ÑÑ$ %
;
ÑÑ% &
}
ÖÖ 
}
ÜÜ 
Employee
áá 
em
áá 
=
áá 
new
áá !
Employee
áá" *
(
áá* +
)
áá+ ,
;
áá, -
employeechofer
àà 
.
àà 

idEmployee
àà )
=
àà* +
employeechofer
àà, :
.
àà: ;

idEmployee
àà; E
.
ààE F
ToString
ààF N
(
ààN O
)
ààO P
.
ààP Q
ToUpper
ààQ X
(
ààX Y
)
ààY Z
.
ààZ [
Trim
àà[ _
(
àà_ `
)
àà` a
;
ààa b
using
ââ 
(
ââ 
dbModels
ââ 
context
ââ  '
=
ââ( )
new
ââ* -
dbModels
ââ. 6
(
ââ6 7
)
ââ7 8
)
ââ8 9
em
ââ: <
=
ââ= >
context
ââ? F
.
ââF G
Employee
ââG O
.
ââO P
Where
ââP U
(
ââU V
x
ââV W
=>
ââX Z
x
ââ[ \
.
ââ\ ]

idEmployee
ââ] g
.
ââg h
ToUpper
ââh o
(
ââo p
)
ââp q
.
ââq r
ToString
ââr z
(
ââz {
)
ââ{ |
.
ââ| }
Trimââ} Å
(ââÅ Ç
)ââÇ É
==ââÑ Ü
employeechoferââá ï
.ââï ñ

idEmployeeââñ †
.ââ† °
ToUpperââ° ®
(ââ® ©
)ââ© ™
.ââ™ ´
Trimââ´ Ø
(ââØ ∞
)ââ∞ ±
&&ââ≤ ¥
xââµ ∂
.ââ∂ ∑
statusââ∑ Ω
==ââæ ¿
$numââ¡ ¬
)ââ¬ √
.ââ√ ƒ
FirstOrDefaultââƒ “
(ââ“ ”
)ââ” ‘
;ââ‘ ’
if
ää 
(
ää 
em
ää 
!=
ää 
null
ää 
)
ää 
{
ãã 
TempData
åå 
[
åå 
$str
åå "
]
åå" #
=
åå$ %
$str
åå& F
;
ååF G
return
çç 
View
çç 
(
çç  
)
çç  !
;
çç! "
}
éé 
Person
èè 
person
èè 
=
èè 
new
èè  #
Person
èè$ *
(
èè* +
)
èè+ ,
;
èè, -
using
êê 
(
êê 
dbModels
êê 
context
êê  '
=
êê( )
new
êê* -
dbModels
êê. 6
(
êê6 7
)
êê7 8
)
êê8 9
person
êê: @
=
êêA B
context
êêC J
.
êêJ K
Person
êêK Q
.
êêQ R
Where
êêR W
(
êêW X
x
êêX Y
=>
êêZ \
x
êê] ^
.
êê^ _
nit
êê_ b
.
êêb c
ToString
êêc k
(
êêk l
)
êêl m
==
êên p
employeechofer
êêq 
.êê Ä

idEmployeeêêÄ ä
.êêä ã
ToStringêêã ì
(êêì î
)êêî ï
)êêï ñ
.êêñ ó
FirstOrDefaultêêó •
(êê• ¶
)êê¶ ß
;êêß ®
if
ëë 
(
ëë 
person
ëë 
==
ëë 
null
ëë "
)
ëë" #
{
íí 
using
ìì 
(
ìì 
dbModels
ìì #
context
ìì$ +
=
ìì, -
new
ìì. 1
dbModels
ìì2 :
(
ìì: ;
)
ìì; <
)
ìì< =
{
îî 
person
ïï 
=
ïï  
new
ïï! $
Person
ïï% +
(
ïï+ ,
)
ïï, -
;
ïï- .
person
ññ 
.
ññ 
nit
ññ "
=
ññ# $
employeechofer
ññ% 3
.
ññ3 4

idEmployee
ññ4 >
.
ññ> ?
Trim
ññ? C
(
ññC D
)
ññD E
;
ññE F
person
óó 
.
óó 
name
óó #
=
óó$ %
employeechofer
óó& 4
.
óó4 5
name
óó5 9
.
óó9 :
Trim
óó: >
(
óó> ?
)
óó? @
;
óó@ A
person
òò 
.
òò 
lastname
òò '
=
òò( )
employeechofer
òò* 8
.
òò8 9
lastname
òò9 A
.
òòA B
Trim
òòB F
(
òòF G
)
òòG H
;
òòH I
person
ôô 
.
ôô 
idRole
ôô %
=
ôô& '
$num
ôô( )
;
ôô) *
person
ôô+ 1
.
ôô1 2
status
ôô2 8
=
ôô9 :
$num
ôô; <
;
ôô< =
person
öö 
.
öö 
dateRegister
öö +
=
öö, -
boliviaTime
öö. 9
;
öö9 :
context
õõ 
.
õõ  
Person
õõ  &
.
õõ& '
Add
õõ' *
(
õõ* +
person
õõ+ 1
)
õõ1 2
;
õõ2 3
context
úú 
.
úú  
SaveChanges
úú  +
(
úú+ ,
)
úú, -
;
úú- .
}
ùù 
}
ûû 
else
üü 
if
üü 
(
üü 
person
üü 
.
üü 
status
üü %
==
üü& (
$num
üü) *
||
üü+ -
person
üü. 4
.
üü4 5
idRole
üü5 ;
==
üü< >
$num
üü? @
)
üü@ A
using
†† 
(
†† 
dbModels
†† #
context
††$ +
=
††, -
new
††. 1
dbModels
††2 :
(
††: ;
)
††; <
)
††< =
{
°° 
person
¢¢ 
.
¢¢ 
name
¢¢ #
=
¢¢$ %
employeechofer
¢¢& 4
.
¢¢4 5
name
¢¢5 9
.
¢¢9 :
Trim
¢¢: >
(
¢¢> ?
)
¢¢? @
;
¢¢@ A
person
££ 
.
££ 
lastname
££ '
=
££( )
employeechofer
££* 8
.
££8 9
lastname
££9 A
.
££A B
Trim
££B F
(
££F G
)
££G H
;
££H I
person
§§ 
.
§§ 
idRole
§§ %
=
§§& '
$num
§§( )
;
§§) *
person
§§+ 1
.
§§1 2
status
§§2 8
=
§§9 :
$num
§§; <
;
§§< =
context
•• 
.
••  
Entry
••  %
(
••% &
person
••& ,
)
••, -
.
••- .
State
••. 3
=
••4 5
System
••6 <
.
••< =
Data
••= A
.
••A B
Entity
••B H
.
••H I
EntityState
••I T
.
••T U
Modified
••U ]
;
••] ^
context
¶¶ 
.
¶¶  
SaveChanges
¶¶  +
(
¶¶+ ,
)
¶¶, -
;
¶¶- .
}
ßß 
else
®® 
{
©© 
TempData
™™ 
[
™™ 
$str
™™ %
]
™™% &
=
™™' (
$str
™™) H
;
™™H I
return
´´ 
View
´´ 
(
´´  
)
´´  !
;
´´! "
}
¨¨ 
Employee
≠≠ 
employee
≠≠ !
=
≠≠" #
new
≠≠$ '
Employee
≠≠( 0
(
≠≠0 1
)
≠≠1 2
;
≠≠2 3
employee
ÆÆ 
.
ÆÆ 
status
ÆÆ 
=
ÆÆ  !
$num
ÆÆ" #
;
ÆÆ# $
employee
ÆÆ% -
.
ÆÆ- .
dateRegister
ÆÆ. :
=
ÆÆ; <
boliviaTime
ÆÆ= H
;
ÆÆH I
employee
ÆÆK S
.
ÆÆS T
idLine
ÆÆT Z
=
ÆÆ[ \
Linea
ÆÆ] b
;
ÆÆb c
employee
ØØ 
.
ØØ 
plate
ØØ 
=
ØØ  
employeechofer
ØØ! /
.
ØØ/ 0
plate
ØØ0 5
.
ØØ5 6
ToUpper
ØØ6 =
(
ØØ= >
)
ØØ> ?
.
ØØ? @
Trim
ØØ@ D
(
ØØD E
)
ØØE F
;
ØØF G
employee
ØØH P
.
ØØP Q

idEmployee
ØØQ [
=
ØØ\ ]
employeechofer
ØØ^ l
.
ØØl m

idEmployee
ØØm w
.
ØØw x
Trim
ØØx |
(
ØØ| }
)
ØØ} ~
;
ØØ~ 
employee
∞∞ 
.
∞∞ 
salary
∞∞ 
=
∞∞  !
employeechofer
∞∞" 0
.
∞∞0 1
salary
∞∞1 7
;
∞∞7 8
employee
∞∞9 A
.
∞∞A B
enabled
∞∞B I
=
∞∞J K
$num
∞∞L M
;
∞∞M N
using
±± 
(
±± 
dbModels
±± 
context
±±  '
=
±±( )
new
±±* -
dbModels
±±. 6
(
±±6 7
)
±±7 8
)
±±8 9
em
±±: <
=
±±= >
context
±±? F
.
±±F G
Employee
±±G O
.
±±O P
Where
±±P U
(
±±U V
x
±±V W
=>
±±X Z
x
±±[ \
.
±±\ ]

idEmployee
±±] g
.
±±g h
ToString
±±h p
(
±±p q
)
±±q r
==
±±s u
employeechofer±±v Ñ
.±±Ñ Ö

idEmployee±±Ö è
.±±è ê
ToString±±ê ò
(±±ò ô
)±±ô ö
)±±ö õ
.±±õ ú
FirstOrDefault±±ú ™
(±±™ ´
)±±´ ¨
;±±¨ ≠
if
≤≤ 
(
≤≤ 
em
≤≤ 
==
≤≤ 
null
≤≤ 
)
≤≤ 
using
≥≥ 
(
≥≥ 
dbModels
≥≥ #
context
≥≥$ +
=
≥≥, -
new
≥≥. 1
dbModels
≥≥2 :
(
≥≥: ;
)
≥≥; <
)
≥≥< =
{
¥¥ 
context
µµ 
.
µµ  
Employee
µµ  (
.
µµ( )
Add
µµ) ,
(
µµ, -
employee
µµ- 5
)
µµ5 6
;
µµ6 7
context
∂∂ 
.
∂∂  
SaveChanges
∂∂  +
(
∂∂+ ,
)
∂∂, -
;
∂∂- .
}
∑∑ 
else
∏∏ 
if
∏∏ 
(
∏∏ 
em
∏∏ 
.
∏∏ 
status
∏∏ "
==
∏∏# %
$num
∏∏& '
)
∏∏' (
using
ππ 
(
ππ 
dbModels
ππ #
context
ππ$ +
=
ππ, -
new
ππ. 1
dbModels
ππ2 :
(
ππ: ;
)
ππ; <
)
ππ< =
{
∫∫ 
context
ªª 
.
ªª  
Entry
ªª  %
(
ªª% &
employee
ªª& .
)
ªª. /
.
ªª/ 0
State
ªª0 5
=
ªª6 7
System
ªª8 >
.
ªª> ?
Data
ªª? C
.
ªªC D
Entity
ªªD J
.
ªªJ K
EntityState
ªªK V
.
ªªV W
Modified
ªªW _
;
ªª_ `
context
ºº 
.
ºº  
SaveChanges
ºº  +
(
ºº+ ,
)
ºº, -
;
ºº- .
}
ΩΩ 
EmployeeControl
ææ 
employeeControl
ææ  /
=
ææ0 1
new
ææ2 5
EmployeeControl
ææ6 E
(
ææE F
)
ææF G
;
ææG H
string
øø 
username
øø 
=
øø  !
employeeControl
øø" 1
.
øø1 2
GenerarUsername
øø2 A
(
øøA B
person
øøB H
.
øøH I
name
øøI M
.
øøM N
Trim
øøN R
(
øøR S
)
øøS T
,
øøT U
person
øøV \
.
øø\ ]
lastname
øø] e
.
øøe f
Trim
øøf j
(
øøj k
)
øøk l
)
øøl m
;
øøm n
string
¿¿ 
pass
¿¿ 
=
¿¿ 
employeeControl
¿¿ -
.
¿¿- .
GenerarPassword
¿¿. =
(
¿¿= >
)
¿¿> ?
;
¿¿? @
using
¡¡ 
(
¡¡ 
dbModels
¡¡ 
context
¡¡  '
=
¡¡( )
new
¡¡* -
dbModels
¡¡. 6
(
¡¡6 7
)
¡¡7 8
)
¡¡8 9
{
¬¬ 

Encriptado
√√ 

encriptado
√√ )
=
√√* +
new
√√, /

Encriptado
√√0 :
(
√√: ;
)
√√; <
;
√√< =
user
ƒƒ 
=
ƒƒ 
new
ƒƒ 
User
ƒƒ #
(
ƒƒ# $
)
ƒƒ$ %
;
ƒƒ% &
user
≈≈ 
.
≈≈ 

idEmployee
≈≈ #
=
≈≈$ %
employee
≈≈& .
.
≈≈. /

idEmployee
≈≈/ 9
;
≈≈9 :
user
∆∆ 
.
∆∆ 
username
∆∆ !
=
∆∆" #
username
∆∆$ ,
;
∆∆, -
user
«« 
.
«« 
password
«« !
=
««" #

encriptado
««$ .
.
««. /
	Encriptar
««/ 8
(
««8 9
pass
««9 =
)
««= >
;
««> ?
user
»» 
.
»» 

firstEntry
»» #
=
»»$ %
$num
»»& '
;
»»' (
user
…… 
.
…… 
email
…… 
=
……  
employeechofer
……! /
.
……/ 0
email
……0 5
.
……5 6
ToLower
……6 =
(
……= >
)
……> ?
.
……? @
Trim
……@ D
(
……D E
)
……E F
;
……F G
context
   
.
   
User
    
.
    !
Add
  ! $
(
  $ %
user
  % )
)
  ) *
;
  * +
context
ÀÀ 
.
ÀÀ 
SaveChanges
ÀÀ '
(
ÀÀ' (
)
ÀÀ( )
;
ÀÀ) *
employeeControl
ÃÃ #
.
ÃÃ# $
EnviarCorreo
ÃÃ$ 0
(
ÃÃ0 1
employeechofer
ÃÃ1 ?
.
ÃÃ? @
email
ÃÃ@ E
.
ÃÃE F
ToLower
ÃÃF M
(
ÃÃM N
)
ÃÃN O
.
ÃÃO P
Trim
ÃÃP T
(
ÃÃT U
)
ÃÃU V
,
ÃÃV W
username
ÃÃX `
,
ÃÃ` a
pass
ÃÃb f
)
ÃÃf g
;
ÃÃg h
}
ÕÕ 
return
ŒŒ 
RedirectToAction
ŒŒ '
(
ŒŒ' (
$str
ŒŒ( /
)
ŒŒ/ 0
;
ŒŒ0 1
}
œœ 
catch
–– 
{
—— 
return
““ 
RedirectToAction
““ '
(
““' (
$str
““( /
,
““/ 0
$str
““1 7
)
““7 8
;
““8 9
}
”” 
}
‘‘ 	
public
’’ 
ActionResult
’’ !
VerificationControl
’’ /
(
’’/ 0
)
’’0 1
{
÷÷ 	
Login
◊◊ 
logi
◊◊ 
=
◊◊ 
new
◊◊ 
Login
◊◊ "
(
◊◊" #
)
◊◊# $
;
◊◊$ %
var
ÿÿ 

authResult
ÿÿ 
=
ÿÿ  
AutenticarPasosRol
ÿÿ /
(
ÿÿ/ 0
$num
ÿÿ0 1
)
ÿÿ1 2
;
ÿÿ2 3
if
ŸŸ 
(
ŸŸ 

authResult
ŸŸ 
!=
ŸŸ 
null
ŸŸ "
)
ŸŸ" #
return
ŸŸ$ *

authResult
ŸŸ+ 5
;
ŸŸ5 6
Session
⁄⁄ 
[
⁄⁄ 
$str
⁄⁄ 
]
⁄⁄ 
=
⁄⁄  
null
⁄⁄! %
;
⁄⁄% &
Session
€€ 
[
€€ 
$str
€€ #
]
€€# $
=
€€% &
null
€€' +
;
€€+ ,
return
‹‹ 
View
‹‹ 
(
‹‹ 
)
‹‹ 
;
‹‹ 
}
›› 	
[
ﬁﬁ 	
HttpPost
ﬁﬁ	 
]
ﬁﬁ 
public
ﬂﬂ 
ActionResult
ﬂﬂ !
VerificationControl
ﬂﬂ /
(
ﬂﬂ/ 0
EmployeeChofer
ﬂﬂ0 >
employeechofer
ﬂﬂ? M
)
ﬂﬂM N
{
‡‡ 	
Login
·· 
logi
·· 
=
·· 
new
·· 
Login
·· "
(
··" #
)
··# $
;
··$ %
var
‚‚ 

authResult
‚‚ 
=
‚‚  
AutenticarPasosRol
‚‚ /
(
‚‚/ 0
$num
‚‚0 1
)
‚‚1 2
;
‚‚2 3
if
„„ 
(
„„ 

authResult
„„ 
!=
„„ 
null
„„ "
)
„„" #
return
„„$ *

authResult
„„+ 5
;
„„5 6
Employee
‰‰ 
em
‰‰ 
=
‰‰ 
new
‰‰ 
Employee
‰‰ &
(
‰‰& '
)
‰‰' (
;
‰‰( )
employeechofer
ÂÂ 
.
ÂÂ 

idEmployee
ÂÂ %
=
ÂÂ& '
employeechofer
ÂÂ( 6
.
ÂÂ6 7

idEmployee
ÂÂ7 A
.
ÂÂA B
ToString
ÂÂB J
(
ÂÂJ K
)
ÂÂK L
.
ÂÂL M
ToUpper
ÂÂM T
(
ÂÂT U
)
ÂÂU V
.
ÂÂV W
Trim
ÂÂW [
(
ÂÂ[ \
)
ÂÂ\ ]
;
ÂÂ] ^
using
ÊÊ 
(
ÊÊ 
dbModels
ÊÊ 
context
ÊÊ #
=
ÊÊ$ %
new
ÊÊ& )
dbModels
ÊÊ* 2
(
ÊÊ2 3
)
ÊÊ3 4
)
ÊÊ4 5
em
ÊÊ6 8
=
ÊÊ9 :
context
ÊÊ; B
.
ÊÊB C
Employee
ÊÊC K
.
ÊÊK L
Where
ÊÊL Q
(
ÊÊQ R
x
ÊÊR S
=>
ÊÊT V
x
ÊÊW X
.
ÊÊX Y

idEmployee
ÊÊY c
.
ÊÊc d
ToUpper
ÊÊd k
(
ÊÊk l
)
ÊÊl m
.
ÊÊm n
ToString
ÊÊn v
(
ÊÊv w
)
ÊÊw x
.
ÊÊx y
Trim
ÊÊy }
(
ÊÊ} ~
)
ÊÊ~ 
==ÊÊÄ Ç
employeechoferÊÊÉ ë
.ÊÊë í

idEmployeeÊÊí ú
.ÊÊú ù
ToUpperÊÊù §
(ÊÊ§ •
)ÊÊ• ¶
.ÊÊ¶ ß
ToStringÊÊß Ø
(ÊÊØ ∞
)ÊÊ∞ ±
.ÊÊ± ≤
TrimÊÊ≤ ∂
(ÊÊ∂ ∑
)ÊÊ∑ ∏
&&ÊÊπ ª
xÊÊº Ω
.ÊÊΩ æ
statusÊÊæ ƒ
==ÊÊ≈ «
$numÊÊ» …
)ÊÊ…  
.ÊÊ  À
FirstOrDefaultÊÊÀ Ÿ
(ÊÊŸ ⁄
)ÊÊ⁄ €
;ÊÊ€ ‹
if
ÁÁ 
(
ÁÁ 
em
ÁÁ 
!=
ÁÁ 
null
ÁÁ 
)
ÁÁ 
{
ËË 
ViewBag
ÈÈ 
.
ÈÈ 
NIT
ÈÈ 
=
ÈÈ 
$str
ÈÈ >
;
ÈÈ> ?
return
ÍÍ 
View
ÍÍ 
(
ÍÍ 
)
ÍÍ 
;
ÍÍ 
}
ÎÎ 
Person
ÏÏ 
person
ÏÏ 
=
ÏÏ 
new
ÏÏ 
Person
ÏÏ  &
(
ÏÏ& '
)
ÏÏ' (
;
ÏÏ( )
using
ÌÌ 
(
ÌÌ 
dbModels
ÌÌ 
context
ÌÌ #
=
ÌÌ$ %
new
ÌÌ& )
dbModels
ÌÌ* 2
(
ÌÌ2 3
)
ÌÌ3 4
)
ÌÌ4 5
person
ÌÌ6 <
=
ÌÌ= >
context
ÌÌ? F
.
ÌÌF G
Person
ÌÌG M
.
ÌÌM N
Where
ÌÌN S
(
ÌÌS T
x
ÌÌT U
=>
ÌÌV X
x
ÌÌY Z
.
ÌÌZ [
nit
ÌÌ[ ^
.
ÌÌ^ _
ToUpper
ÌÌ_ f
(
ÌÌf g
)
ÌÌg h
.
ÌÌh i
ToString
ÌÌi q
(
ÌÌq r
)
ÌÌr s
.
ÌÌs t
Trim
ÌÌt x
(
ÌÌx y
)
ÌÌy z
==
ÌÌ{ }
employeechoferÌÌ~ å
.ÌÌå ç

idEmployeeÌÌç ó
.ÌÌó ò
ToUpperÌÌò ü
(ÌÌü †
)ÌÌ† °
.ÌÌ° ¢
ToStringÌÌ¢ ™
(ÌÌ™ ´
)ÌÌ´ ¨
.ÌÌ¨ ≠
TrimÌÌ≠ ±
(ÌÌ± ≤
)ÌÌ≤ ≥
&&ÌÌ¥ ∂
xÌÌ∑ ∏
.ÌÌ∏ π
statusÌÌπ ø
==ÌÌ¿ ¬
$numÌÌ√ ƒ
)ÌÌƒ ≈
.ÌÌ≈ ∆
FirstOrDefaultÌÌ∆ ‘
(ÌÌ‘ ’
)ÌÌ’ ÷
;ÌÌ÷ ◊
Session
ÓÓ 
[
ÓÓ 
$str
ÓÓ 
]
ÓÓ 
=
ÓÓ  
employeechofer
ÓÓ! /
.
ÓÓ/ 0

idEmployee
ÓÓ0 :
;
ÓÓ: ;
if
ÔÔ 
(
ÔÔ 
person
ÔÔ 
==
ÔÔ 
null
ÔÔ 
)
ÔÔ 
return
ÔÔ  &
RedirectToAction
ÔÔ' 7
(
ÔÔ7 8
$str
ÔÔ8 K
)
ÔÔK L
;
ÔÔL M
else
 
if
 
(
 
person
 
.
 
status
 "
==
# %
$num
& '
&&
( *
person
+ 1
.
1 2
idRole
2 8
==
9 ;
$num
< =
)
= >
{
ÒÒ 
Session
ÚÚ 
[
ÚÚ 
$str
ÚÚ '
]
ÚÚ' (
=
ÚÚ) *
person
ÚÚ+ 1
;
ÚÚ1 2
return
ÛÛ 
RedirectToAction
ÛÛ '
(
ÛÛ' (
$str
ÛÛ( B
)
ÛÛB C
;
ÛÛC D
}
ÙÙ 
ViewBag
ıı 
.
ıı 
NIT
ıı 
=
ıı 
$str
ıı 9
;
ıı9 :
return
ˆˆ 
View
ˆˆ 
(
ˆˆ 
)
ˆˆ 
;
ˆˆ 
}
˜˜ 	
public
¯¯ 
ActionResult
¯¯ &
CreateExistPersonControl
¯¯ 4
(
¯¯4 5
)
¯¯5 6
{
˘˘ 	
try
˙˙ 
{
˚˚ 
Login
¸¸ 
logi
¸¸ 
=
¸¸ 
new
¸¸  
Login
¸¸! &
(
¸¸& '
)
¸¸' (
;
¸¸( )
var
˝˝ 

authResult
˝˝ 
=
˝˝   
AutenticarPasosRol
˝˝! 3
(
˝˝3 4
$num
˝˝4 5
)
˝˝5 6
;
˝˝6 7
if
˛˛ 
(
˛˛ 

authResult
˛˛ 
!=
˛˛ !
null
˛˛" &
)
˛˛& '
return
˛˛( .

authResult
˛˛/ 9
;
˛˛9 :
if
ˇˇ 
(
ˇˇ 
Session
ˇˇ 
[
ˇˇ 
$str
ˇˇ +
]
ˇˇ+ ,
==
ˇˇ- /
null
ˇˇ0 4
||
ˇˇ5 7
Session
ˇˇ8 ?
[
ˇˇ? @
$str
ˇˇ@ I
]
ˇˇI J
==
ˇˇJ L
null
ˇˇL P
)
ˇˇP Q
return
ˇˇR X
RedirectToAction
ˇˇY i
(
ˇˇi j
$str
ˇˇj q
,
ˇˇq r
$str
ˇˇs y
)
ˇˇy z
;
ˇˇz {
string
ÄÄ 
Linea
ÄÄ 
=
ÄÄ 
logi
ÄÄ #
.
ÄÄ# $ 
GetLineaFromCookie
ÄÄ$ 6
(
ÄÄ6 7
Request
ÄÄ7 >
)
ÄÄ> ?
.
ÄÄ? @
ToString
ÄÄ@ H
(
ÄÄH I
)
ÄÄI J
;
ÄÄJ K
List
ÅÅ 
<
ÅÅ 

Checkpoint
ÅÅ 
>
ÅÅ  

checkpoint
ÅÅ! +
=
ÅÅ, -
new
ÅÅ. 1
List
ÅÅ2 6
<
ÅÅ6 7

Checkpoint
ÅÅ7 A
>
ÅÅA B
(
ÅÅB C
)
ÅÅC D
;
ÅÅD E

Checkpoint
ÇÇ 
valid
ÇÇ  
=
ÇÇ! "
new
ÇÇ# &

Checkpoint
ÇÇ' 1
(
ÇÇ1 2
)
ÇÇ2 3
;
ÇÇ3 4
using
ÉÉ 
(
ÉÉ 
dbModels
ÉÉ 
context
ÉÉ  '
=
ÉÉ( )
new
ÉÉ* -
dbModels
ÉÉ. 6
(
ÉÉ6 7
)
ÉÉ7 8
)
ÉÉ8 9
valid
ÉÉ: ?
=
ÉÉ@ A
context
ÉÉB I
.
ÉÉI J

Checkpoint
ÉÉJ T
.
ÉÉT U
Where
ÉÉU Z
(
ÉÉZ [
x
ÉÉ[ \
=>
ÉÉ] _
x
ÉÉ` a
.
ÉÉa b
idLine
ÉÉb h
==
ÉÉi k
Linea
ÉÉl q
&&
ÉÉr t
x
ÉÉu v
.
ÉÉv w

idEmployeeÉÉw Å
==ÉÉÇ Ñ
nullÉÉÖ â
&&ÉÉä å
xÉÉç é
.ÉÉé è
statusÉÉè ï
!=ÉÉñ ò
$numÉÉô ö
)ÉÉö õ
.ÉÉõ ú
FirstOrDefaultÉÉú ™
(ÉÉ™ ´
)ÉÉ´ ¨
;ÉÉ¨ ≠
using
ÑÑ 
(
ÑÑ 
dbModels
ÑÑ 
context
ÑÑ  '
=
ÑÑ( )
new
ÑÑ* -
dbModels
ÑÑ. 6
(
ÑÑ6 7
)
ÑÑ7 8
)
ÑÑ8 9

checkpoint
ÑÑ: D
=
ÑÑE F
context
ÑÑG N
.
ÑÑN O

Checkpoint
ÑÑO Y
.
ÑÑY Z
Where
ÑÑZ _
(
ÑÑ_ `
x
ÑÑ` a
=>
ÑÑb d
x
ÑÑe f
.
ÑÑf g
idLine
ÑÑg m
==
ÑÑn p
Linea
ÑÑq v
&&
ÑÑw y
x
ÑÑz {
.
ÑÑ{ |

idEmployeeÑÑ| Ü
==ÑÑá â
nullÑÑä é
&&ÑÑè ë
xÑÑí ì
.ÑÑì î
statusÑÑî ö
!=ÑÑõ ù
$numÑÑû ü
)ÑÑü †
.ÑÑ† °
ToListÑÑ° ß
(ÑÑß ®
)ÑÑ® ©
;ÑÑ© ™
if
ÖÖ 
(
ÖÖ 
valid
ÖÖ 
==
ÖÖ 
null
ÖÖ !
)
ÖÖ! "
return
ÖÖ# )
RedirectToAction
ÖÖ* :
(
ÖÖ: ;
$str
ÖÖ; J
,
ÖÖJ K
$str
ÖÖL S
)
ÖÖS T
;
ÖÖT U
ViewBag
ÜÜ 
.
ÜÜ 
idCheckpoint
ÜÜ $
=
ÜÜ% &
new
ÜÜ' *

SelectList
ÜÜ+ 5
(
ÜÜ5 6

checkpoint
ÜÜ6 @
,
ÜÜ@ A
$str
ÜÜB P
,
ÜÜP Q
$str
ÜÜR _
)
ÜÜ_ `
;
ÜÜ` a
return
áá 
View
áá 
(
áá 
)
áá 
;
áá 
}
àà 
catch
ââ 
(
ââ 
	Exception
ââ 
)
ââ 
{
ää 
return
ãã 
RedirectToAction
ãã '
(
ãã' (
$str
ãã( /
,
ãã/ 0
$str
ãã1 7
)
ãã7 8
;
ãã8 9
}
åå 
}
çç 	
[
èè 	
HttpPost
èè	 
]
èè 
public
êê 
ActionResult
êê &
CreateExistPersonControl
êê 4
(
êê4 5
EmployeeControl
êê5 D
employeeControl
êêE T
)
êêT U
{
ëë 	
try
íí 
{
ìì 
Login
îî 
logi
îî 
=
îî 
new
îî  
Login
îî! &
(
îî& '
)
îî' (
;
îî( )
var
ïï 

authResult
ïï 
=
ïï   
AutenticarPasosRol
ïï! 3
(
ïï3 4
$num
ïï4 5
)
ïï5 6
;
ïï6 7
if
ññ 
(
ññ 

authResult
ññ 
!=
ññ !
null
ññ" &
)
ññ& '
return
ññ( .

authResult
ññ/ 9
;
ññ9 :
if
ññ; =
(
ññ> ?
Session
ññ? F
[
ññF G
$str
ññG V
]
ññV W
==
ññX Z
null
ññ[ _
||
ññ` b
Session
ññc j
[
ññj k
$str
ññk t
]
ññt u
==
ññv x
null
ññy }
)
ññ} ~
returnññ Ö 
RedirectToActionññÜ ñ
(ñññ ó
$strññó û
,ññû ü
$strññ† ¶
)ññ¶ ß
;ññß ®
string
óó 
numeroFormateado
óó '
=
óó( )
employeeControl
óó* 9
.
óó9 :
salary
óó: @
.
óó@ A
ToString
óóA I
(
óóI J
$str
óóJ P
)
óóP Q
;
óóQ R
employeeControl
òò 
.
òò  

idEmployee
òò  *
=
òò+ ,
Session
òò- 4
[
òò4 5
$str
òò5 >
]
òò> ?
.
òò? @
ToString
òò@ H
(
òòH I
)
òòI J
;
òòJ K
TimeZoneInfo
ôô 
boliviaTimeZone
ôô ,
=
ôô- .
TimeZoneInfo
ôô/ ;
.
ôô; <$
FindSystemTimeZoneById
ôô< R
(
ôôR S
$str
ôôS m
)
ôôm n
;
ôôn o
DateTime
öö 
boliviaTime
öö $
=
öö% &
TimeZoneInfo
öö' 3
.
öö3 4
ConvertTime
öö4 ?
(
öö? @
DateTime
öö@ H
.
ööH I
UtcNow
ööI O
,
ööO P
boliviaTimeZone
ööQ `
)
öö` a
;
ööa b
if
õõ 
(
õõ 
decimal
õõ 
.
õõ 
Parse
õõ !
(
õõ! "
numeroFormateado
õõ" 2
)
õõ2 3
<=
õõ4 6
$num
õõ7 8
||
õõ9 ;
decimal
õõ< C
.
õõC D
Parse
õõD I
(
õõI J
numeroFormateado
õõJ Z
)
õõZ [
>=
õõ\ ^
$num
õõ_ d
)
õõd e
{
úú 
TempData
ùù 
[
ùù 
$str
ùù %
]
ùù% &
=
ùù' (
$str
ùù) X
;
ùùX Y
return
ûû 
View
ûû 
(
ûû  
)
ûû  !
;
ûû! "
}
üü 
string
†† 
Linea
†† 
=
†† 
logi
†† #
.
††# $ 
GetLineaFromCookie
††$ 6
(
††6 7
Request
††7 >
)
††> ?
.
††? @
ToString
††@ H
(
††H I
)
††I J
;
††J K
List
°° 
<
°° 

Checkpoint
°° 
>
°°  

checkpoint
°°! +
=
°°, -
new
°°. 1
List
°°2 6
<
°°6 7

Checkpoint
°°7 A
>
°°A B
(
°°B C
)
°°C D
;
°°D E
using
¢¢ 
(
¢¢ 
dbModels
¢¢ 
context
¢¢  '
=
¢¢( )
new
¢¢* -
dbModels
¢¢. 6
(
¢¢6 7
)
¢¢7 8
)
¢¢8 9

checkpoint
££ 
=
££  
context
££! (
.
££( )

Checkpoint
££) 3
.
££3 4
Where
££4 9
(
££9 :
x
££: ;
=>
££< >
x
££? @
.
££@ A
idLine
££A G
==
££H J
Linea
££K P
&&
££Q S
x
££T U
.
££U V

idEmployee
££V `
==
££a c
null
££d h
&&
££i k
x
££l m
.
££m n
status
££n t
!=
££u w
$num
££x y
)
££y z
.
££z {
ToList££{ Å
(££Å Ç
)££Ç É
;££É Ñ
if
§§ 
(
§§ 

checkpoint
§§ 
==
§§ !
null
§§" &
)
§§& '
return
§§( .
RedirectToAction
§§/ ?
(
§§? @
$str
§§@ O
,
§§O P
$str
§§Q X
)
§§X Y
;
§§Y Z
ViewBag
•• 
.
•• 
idCheckpoint
•• $
=
••% &
new
••' *

SelectList
••+ 5
(
••5 6

checkpoint
••6 @
,
••@ A
$str
••B P
,
••P Q
$str
••R _
)
••_ `
;
••` a
User
¶¶ 
user
¶¶ 
=
¶¶ 
new
¶¶ 
User
¶¶  $
(
¶¶$ %
)
¶¶% &
;
¶¶& '
using
ßß 
(
ßß 
dbModels
ßß 
context
ßß  '
=
ßß( )
new
ßß* -
dbModels
ßß. 6
(
ßß6 7
)
ßß7 8
)
ßß8 9
user
ßß: >
=
ßß? @
context
ßßA H
.
ßßH I
User
ßßI M
.
ßßM N
Where
ßßN S
(
ßßS T
x
ßßT U
=>
ßßV X
x
ßßY Z
.
ßßZ [
email
ßß[ `
.
ßß` a
ToLower
ßßa h
(
ßßh i
)
ßßi j
.
ßßj k
Trim
ßßk o
(
ßßo p
)
ßßp q
==
ßßr t
employeeControlßßu Ñ
.ßßÑ Ö
emailßßÖ ä
.ßßä ã
ToLowerßßã í
(ßßí ì
)ßßì î
.ßßî ï
Trimßßï ô
(ßßô ö
)ßßö õ
)ßßõ ú
.ßßú ù
FirstOrDefaultßßù ´
(ßß´ ¨
)ßß¨ ≠
;ßß≠ Æ
if
®® 
(
®® 
user
®® 
!=
®® 
null
®®  
)
®®  !
{
©© 
TempData
™™ 
[
™™ 
$str
™™ #
]
™™# $
=
™™% &
$str
™™' I
;
™™I J
return
´´ 
View
´´ 
(
´´  
)
´´  !
;
´´! "
}
¨¨ 
employeeControl
≠≠ 
.
≠≠  

idEmployee
≠≠  *
=
≠≠+ ,
employeeControl
≠≠- <
.
≠≠< =

idEmployee
≠≠= G
.
≠≠G H
ToString
≠≠H P
(
≠≠P Q
)
≠≠Q R
.
≠≠R S
ToUpper
≠≠S Z
(
≠≠Z [
)
≠≠[ \
.
≠≠\ ]
Trim
≠≠] a
(
≠≠a b
)
≠≠b c
;
≠≠c d
Employee
ÆÆ 
em
ÆÆ 
=
ÆÆ 
new
ÆÆ !
Employee
ÆÆ" *
(
ÆÆ* +
)
ÆÆ+ ,
;
ÆÆ, -
using
ØØ 
(
ØØ 
dbModels
ØØ 
context
ØØ  '
=
ØØ( )
new
ØØ* -
dbModels
ØØ. 6
(
ØØ6 7
)
ØØ7 8
)
ØØ8 9
em
ØØ: <
=
ØØ= >
context
ØØ? F
.
ØØF G
Employee
ØØG O
.
ØØO P
Where
ØØP U
(
ØØU V
x
ØØV W
=>
ØØX Z
x
ØØ[ \
.
ØØ\ ]

idEmployee
ØØ] g
.
ØØg h
ToString
ØØh p
(
ØØp q
)
ØØq r
.
ØØr s
ToUpper
ØØs z
(
ØØz {
)
ØØ{ |
.
ØØ| }
TrimØØ} Å
(ØØÅ Ç
)ØØÇ É
==ØØÑ Ü
employeeControlØØá ñ
.ØØñ ó

idEmployeeØØó °
.ØØ° ¢
ToStringØØ¢ ™
(ØØ™ ´
)ØØ´ ¨
.ØØ¨ ≠
ToUpperØØ≠ ¥
(ØØ¥ µ
)ØØµ ∂
.ØØ∂ ∑
TrimØØ∑ ª
(ØØª º
)ØØº Ω
&&ØØæ ¿
xØØ¡ ¬
.ØØ¬ √
statusØØ√ …
==ØØ  Ã
$numØØÕ Œ
)ØØŒ œ
.ØØœ –
FirstOrDefaultØØ– ﬁ
(ØØﬁ ﬂ
)ØØﬂ ‡
;ØØ‡ ·
if
∞∞ 
(
∞∞ 
em
∞∞ 
!=
∞∞ 
null
∞∞ 
)
∞∞ 
{
±± 
TempData
≤≤ 
[
≤≤ 
$str
≤≤ "
]
≤≤" #
=
≤≤$ %
$str
≤≤& F
;
≤≤F G
return
≥≥ 
View
≥≥ 
(
≥≥  
)
≥≥  !
;
≥≥! "
}
¥¥ 
Person
µµ 
person
µµ 
=
µµ 
new
µµ  #
Person
µµ$ *
(
µµ* +
)
µµ+ ,
;
µµ, -
using
∂∂ 
(
∂∂ 
dbModels
∂∂ 
context
∂∂  '
=
∂∂( )
new
∂∂* -
dbModels
∂∂. 6
(
∂∂6 7
)
∂∂7 8
)
∂∂8 9
person
∂∂: @
=
∂∂A B
context
∂∂C J
.
∂∂J K
Person
∂∂K Q
.
∂∂Q R
Where
∂∂R W
(
∂∂W X
x
∂∂X Y
=>
∂∂Z \
x
∂∂] ^
.
∂∂^ _
nit
∂∂_ b
.
∂∂b c
ToString
∂∂c k
(
∂∂k l
)
∂∂l m
.
∂∂m n
ToUpper
∂∂n u
(
∂∂u v
)
∂∂v w
.
∂∂w x
Trim
∂∂x |
(
∂∂| }
)
∂∂} ~
==∂∂ Å
employeeControl∂∂Ç ë
.∂∂ë í

idEmployee∂∂í ú
.∂∂ú ù
ToString∂∂ù •
(∂∂• ¶
)∂∂¶ ß
)∂∂ß ®
.∂∂® ©
FirstOrDefault∂∂© ∑
(∂∂∑ ∏
)∂∂∏ π
;∂∂π ∫
if
∑∑ 
(
∑∑ 
person
∑∑ 
==
∑∑ 
null
∑∑ "
)
∑∑" #
{
∏∏ 
using
ππ 
(
ππ 
dbModels
ππ #
context
ππ$ +
=
ππ, -
new
ππ. 1
dbModels
ππ2 :
(
ππ: ;
)
ππ; <
)
ππ< =
{
∫∫ 
Person
ªª 
personCreate
ªª +
=
ªª, -
new
ªª. 1
Person
ªª2 8
(
ªª8 9
)
ªª9 :
;
ªª: ;
personCreate
ºº $
.
ºº$ %
idRole
ºº% +
=
ºº, -
$num
ºº. /
;
ºº/ 0
personCreate
ºº1 =
.
ºº= >
status
ºº> D
=
ººE F
$num
ººG H
;
ººH I
DateTime
ΩΩ  
hoy
ΩΩ! $
=
ΩΩ% &
boliviaTime
ΩΩ' 2
;
ΩΩ2 3
personCreate
ææ $
.
ææ$ %
dateRegister
ææ% 1
=
ææ2 3
hoy
ææ4 7
;
ææ7 8
context
øø 
.
øø  
Person
øø  &
.
øø& '
Add
øø' *
(
øø* +
personCreate
øø+ 7
)
øø7 8
;
øø8 9
context
¿¿ 
.
¿¿  
SaveChanges
¿¿  +
(
¿¿+ ,
)
¿¿, -
;
¿¿- .
}
¡¡ 
}
¬¬ 
else
√√ 
if
√√ 
(
√√ 
person
√√ 
.
√√  
status
√√  &
==
√√' )
$num
√√* +
||
√√, .
person
√√/ 5
.
√√5 6
idRole
√√6 <
==
√√= ?
$num
√√@ A
)
√√A B
using
ƒƒ 
(
ƒƒ 
dbModels
ƒƒ #
context
ƒƒ$ +
=
ƒƒ, -
new
ƒƒ. 1
dbModels
ƒƒ2 :
(
ƒƒ: ;
)
ƒƒ; <
)
ƒƒ< =
{
≈≈ 
person
∆∆ 
.
∆∆ 
idRole
∆∆ %
=
∆∆& '
$num
∆∆( )
;
∆∆) *
person
∆∆+ 1
.
∆∆1 2
status
∆∆2 8
=
∆∆9 :
$num
∆∆; <
;
∆∆< =
context
«« 
.
««  
Entry
««  %
(
««% &
person
««& ,
)
««, -
.
««- .
State
««. 3
=
««4 5
System
««6 <
.
««< =
Data
««= A
.
««A B
Entity
««B H
.
««H I
EntityState
««I T
.
««T U
Modified
««U ]
;
««] ^
context
»» 
.
»»  
SaveChanges
»»  +
(
»»+ ,
)
»», -
;
»»- .
}
…… 
else
   
{
ÀÀ 
TempData
ÃÃ 
[
ÃÃ 
$str
ÃÃ %
]
ÃÃ% &
=
ÃÃ' (
$str
ÃÃ) H
;
ÃÃH I
return
ÕÕ 
View
ÕÕ 
(
ÕÕ  
)
ÕÕ  !
;
ÕÕ! "
}
ŒŒ 
using
œœ 
(
œœ 
dbModels
œœ 
context
œœ  '
=
œœ( )
new
œœ* -
dbModels
œœ. 6
(
œœ6 7
)
œœ7 8
)
œœ8 9
person
œœ: @
=
œœA B
context
œœC J
.
œœJ K
Person
œœK Q
.
œœQ R
Where
œœR W
(
œœW X
x
œœX Y
=>
œœZ \
x
œœ] ^
.
œœ^ _
nit
œœ_ b
.
œœb c
ToString
œœc k
(
œœk l
)
œœl m
==
œœn p
employeeControlœœq Ä
.œœÄ Å

idEmployeeœœÅ ã
.œœã å
ToStringœœå î
(œœî ï
)œœï ñ
)œœñ ó
.œœó ò
FirstOrDefaultœœò ¶
(œœ¶ ß
)œœß ®
;œœ® ©
User
–– 
validationMail
–– #
=
––$ %
new
––& )
User
––* .
(
––. /
)
––/ 0
;
––0 1
using
—— 
(
—— 
dbModels
—— 
context
——  '
=
——( )
new
——* -
dbModels
——. 6
(
——6 7
)
——7 8
)
——8 9
validationMail
——: H
=
——I J
context
——K R
.
——R S
User
——S W
.
——W X
Where
——X ]
(
——] ^
x
——^ _
=>
——` b
x
——c d
.
——d e
email
——e j
.
——j k
ToLower
——k r
(
——r s
)
——s t
.
——t u
Trim
——u y
(
——y z
)
——z {
==
——| ~
employeeControl—— é
.——é è
email——è î
.——î ï
ToLower——ï ú
(——ú ù
)——ù û
.——û ü
Trim——ü £
(——£ §
)——§ •
)——• ¶
.——¶ ß
FirstOrDefault——ß µ
(——µ ∂
)——∂ ∑
;——∑ ∏
if
““ 
(
““ 
validationMail
““ "
!=
““# %
null
““& *
)
““* +
{
”” 
TempData
‘‘ 
[
‘‘ 
$str
‘‘ #
]
‘‘# $
=
‘‘% &
$str
‘‘' I
;
‘‘I J
return
’’ 
View
’’ 
(
’’  
)
’’  !
;
’’! "
}
÷÷ 
Employee
◊◊ 
employee
◊◊ !
=
◊◊" #
new
◊◊$ '
Employee
◊◊( 0
(
◊◊0 1
)
◊◊1 2
;
◊◊2 3
user
ÿÿ 
=
ÿÿ 
new
ÿÿ 
User
ÿÿ 
(
ÿÿ  
)
ÿÿ  !
;
ÿÿ! "
employee
ŸŸ 
.
ŸŸ 

idEmployee
ŸŸ #
=
ŸŸ$ %
employeeControl
ŸŸ& 5
.
ŸŸ5 6

idEmployee
ŸŸ6 @
.
ŸŸ@ A
Trim
ŸŸA E
(
ŸŸE F
)
ŸŸF G
;
ŸŸG H
employee
ŸŸI Q
.
ŸŸQ R
status
ŸŸR X
=
ŸŸY Z
$num
ŸŸ[ \
;
ŸŸ\ ]
employee
⁄⁄ 
.
⁄⁄ 
dateRegister
⁄⁄ %
=
⁄⁄& '
boliviaTime
⁄⁄( 3
;
⁄⁄3 4
employee
⁄⁄5 =
.
⁄⁄= >
idLine
⁄⁄> D
=
⁄⁄E F
Linea
⁄⁄G L
;
⁄⁄L M
employee
€€ 
.
€€ 
salary
€€ 
=
€€  !
employeeControl
€€" 1
.
€€1 2
salary
€€2 8
;
€€8 9
using
‹‹ 
(
‹‹ 
dbModels
‹‹ 
context
‹‹  '
=
‹‹( )
new
‹‹* -
dbModels
‹‹. 6
(
‹‹6 7
)
‹‹7 8
)
‹‹8 9
em
‹‹: <
=
‹‹= >
context
‹‹? F
.
‹‹F G
Employee
‹‹G O
.
‹‹O P
Where
‹‹P U
(
‹‹U V
x
‹‹V W
=>
‹‹X Z
x
‹‹[ \
.
‹‹\ ]

idEmployee
‹‹] g
.
‹‹g h
ToString
‹‹h p
(
‹‹p q
)
‹‹q r
==
‹‹s u
employeeControl‹‹v Ö
.‹‹Ö Ü

idEmployee‹‹Ü ê
.‹‹ê ë
ToString‹‹ë ô
(‹‹ô ö
)‹‹ö õ
)‹‹õ ú
.‹‹ú ù
FirstOrDefault‹‹ù ´
(‹‹´ ¨
)‹‹¨ ≠
;‹‹≠ Æ
if
›› 
(
›› 
em
›› 
==
›› 
null
›› 
)
›› 
using
ﬁﬁ 
(
ﬁﬁ 
dbModels
ﬁﬁ #
context
ﬁﬁ$ +
=
ﬁﬁ, -
new
ﬁﬁ. 1
dbModels
ﬁﬁ2 :
(
ﬁﬁ: ;
)
ﬁﬁ; <
)
ﬁﬁ< =
{
ﬂﬂ 
context
‡‡ 
.
‡‡  
Employee
‡‡  (
.
‡‡( )
Add
‡‡) ,
(
‡‡, -
employee
‡‡- 5
)
‡‡5 6
;
‡‡6 7
context
·· 
.
··  
SaveChanges
··  +
(
··+ ,
)
··, -
;
··- .
}
‚‚ 
else
„„ 
if
„„ 
(
„„ 
em
„„ 
.
„„ 
status
„„ "
==
„„# %
$num
„„& '
)
„„' (
using
‰‰ 
(
‰‰ 
dbModels
‰‰ #
context
‰‰$ +
=
‰‰, -
new
‰‰. 1
dbModels
‰‰2 :
(
‰‰: ;
)
‰‰; <
)
‰‰< =
{
ÂÂ 
context
ÊÊ 
.
ÊÊ  
Entry
ÊÊ  %
(
ÊÊ% &
employee
ÊÊ& .
)
ÊÊ. /
.
ÊÊ/ 0
State
ÊÊ0 5
=
ÊÊ6 7
System
ÊÊ8 >
.
ÊÊ> ?
Data
ÊÊ? C
.
ÊÊC D
Entity
ÊÊD J
.
ÊÊJ K
EntityState
ÊÊK V
.
ÊÊV W
Modified
ÊÊW _
;
ÊÊ_ `
context
ÁÁ 
.
ÁÁ  
SaveChanges
ÁÁ  +
(
ÁÁ+ ,
)
ÁÁ, -
;
ÁÁ- .
}
ËË 
else
ÈÈ 
{
ÍÍ 
TempData
ÎÎ 
[
ÎÎ 
$str
ÎÎ "
]
ÎÎ" #
=
ÎÎ$ %
$str
ÎÎ& F
;
ÎÎF G
return
ÏÏ 
View
ÏÏ 
(
ÏÏ  
)
ÏÏ  !
;
ÏÏ! "
}
ÌÌ 
string
ÓÓ 
username
ÓÓ 
=
ÓÓ  !
employeeControl
ÓÓ" 1
.
ÓÓ1 2
GenerarUsername
ÓÓ2 A
(
ÓÓA B
person
ÓÓB H
.
ÓÓH I
name
ÓÓI M
.
ÓÓM N
Trim
ÓÓN R
(
ÓÓR S
)
ÓÓS T
,
ÓÓT U
person
ÓÓV \
.
ÓÓ\ ]
lastname
ÓÓ] e
.
ÓÓe f
Trim
ÓÓf j
(
ÓÓj k
)
ÓÓk l
)
ÓÓl m
;
ÓÓm n
string
ÔÔ 
pass
ÔÔ 
=
ÔÔ 
employeeControl
ÔÔ -
.
ÔÔ- .
GenerarPassword
ÔÔ. =
(
ÔÔ= >
)
ÔÔ> ?
;
ÔÔ? @
using
 
(
 
dbModels
 
context
  '
=
( )
new
* -
dbModels
. 6
(
6 7
)
7 8
)
8 9
{
ÒÒ 

Encriptado
ÚÚ 

encriptado
ÚÚ )
=
ÚÚ* +
new
ÚÚ, /

Encriptado
ÚÚ0 :
(
ÚÚ: ;
)
ÚÚ; <
;
ÚÚ< =
user
ÛÛ 
.
ÛÛ 
username
ÛÛ !
=
ÛÛ" #
username
ÛÛ$ ,
.
ÛÛ, -
Trim
ÛÛ- 1
(
ÛÛ1 2
)
ÛÛ2 3
;
ÛÛ3 4
user
ÙÙ 
.
ÙÙ 
password
ÙÙ !
=
ÙÙ" #

encriptado
ÙÙ$ .
.
ÙÙ. /
	Encriptar
ÙÙ/ 8
(
ÙÙ8 9
pass
ÙÙ9 =
)
ÙÙ= >
;
ÙÙ> ?
user
ıı 
.
ıı 
email
ıı 
=
ıı  
employeeControl
ıı! 0
.
ıı0 1
email
ıı1 6
.
ıı6 7
ToLower
ıı7 >
(
ıı> ?
)
ıı? @
.
ıı@ A
Trim
ııA E
(
ııE F
)
ııF G
;
ııG H
user
ˆˆ 
.
ˆˆ 

idEmployee
ˆˆ #
=
ˆˆ$ %
employeeControl
ˆˆ& 5
.
ˆˆ5 6

idEmployee
ˆˆ6 @
.
ˆˆ@ A
Trim
ˆˆA E
(
ˆˆE F
)
ˆˆF G
;
ˆˆG H
user
˜˜ 
.
˜˜ 

firstEntry
˜˜ #
=
˜˜$ %
$num
˜˜& '
;
˜˜' (
context
¯¯ 
.
¯¯ 
User
¯¯  
.
¯¯  !
Add
¯¯! $
(
¯¯$ %
user
¯¯% )
)
¯¯) *
;
¯¯* +
context
˘˘ 
.
˘˘ 
SaveChanges
˘˘ '
(
˘˘' (
)
˘˘( )
;
˘˘) *
employeeControl
˙˙ #
.
˙˙# $
EnviarCorreo
˙˙$ 0
(
˙˙0 1
employeeControl
˙˙1 @
.
˙˙@ A
email
˙˙A F
.
˙˙F G
ToLower
˙˙G N
(
˙˙N O
)
˙˙O P
.
˙˙P Q
Trim
˙˙Q U
(
˙˙U V
)
˙˙V W
,
˙˙W X
username
˙˙Y a
,
˙˙a b
pass
˙˙c g
)
˙˙g h
;
˙˙h i
}
˚˚ 
using
¸¸ 
(
¸¸ 
dbModels
¸¸ 
context
¸¸  '
=
¸¸( )
new
¸¸* -
dbModels
¸¸. 6
(
¸¸6 7
)
¸¸7 8
)
¸¸8 9
{
˝˝ 

Checkpoint
˛˛ 
checkpoint1
˛˛ *
=
˛˛+ ,
context
˛˛- 4
.
˛˛4 5

Checkpoint
˛˛5 ?
.
˛˛? @
Where
˛˛@ E
(
˛˛E F
x
˛˛F G
=>
˛˛H J
x
˛˛K L
.
˛˛L M
idCheckpoint
˛˛M Y
==
˛˛Z \
employeeControl
˛˛] l
.
˛˛l m
idCheckpoint
˛˛m y
)
˛˛y z
.
˛˛z {
FirstOrDefault˛˛{ â
(˛˛â ä
)˛˛ä ã
;˛˛ã å
checkpoint1
ˇˇ 
.
ˇˇ  

idEmployee
ˇˇ  *
=
ˇˇ+ ,
employeeControl
ˇˇ- <
.
ˇˇ< =

idEmployee
ˇˇ= G
.
ˇˇG H
Trim
ˇˇH L
(
ˇˇL M
)
ˇˇM N
;
ˇˇN O
context
ÄÄ 
.
ÄÄ 
Entry
ÄÄ !
(
ÄÄ! "
checkpoint1
ÄÄ" -
)
ÄÄ- .
.
ÄÄ. /
State
ÄÄ/ 4
=
ÄÄ5 6
System
ÄÄ7 =
.
ÄÄ= >
Data
ÄÄ> B
.
ÄÄB C
Entity
ÄÄC I
.
ÄÄI J
EntityState
ÄÄJ U
.
ÄÄU V
Modified
ÄÄV ^
;
ÄÄ^ _
context
ÅÅ 
.
ÅÅ 
SaveChanges
ÅÅ '
(
ÅÅ' (
)
ÅÅ( )
;
ÅÅ) *
}
ÇÇ 
return
ÉÉ 
RedirectToAction
ÉÉ '
(
ÉÉ' (
$str
ÉÉ( /
)
ÉÉ/ 0
;
ÉÉ0 1
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
)
ÖÖ 
{
ÜÜ 
return
áá 
RedirectToAction
áá '
(
áá' (
$str
áá( /
,
áá/ 0
$str
áá1 7
)
áá7 8
;
áá8 9
}
àà 
}
ââ 	
public
ää 
ActionResult
ää 
CreateControlador
ää -
(
ää- .
)
ää. /
{
ãã 	
try
åå 
{
çç 
Login
éé 
logi
éé 
=
éé 
new
éé  
Login
éé! &
(
éé& '
)
éé' (
;
éé( )
var
èè 

authResult
èè 
=
èè   
AutenticarPasosRol
èè! 3
(
èè3 4
$num
èè4 5
)
èè5 6
;
èè6 7
if
êê 
(
êê 

authResult
êê 
!=
êê !
null
êê" &
)
êê& '
return
êê( .

authResult
êê/ 9
;
êê9 :
if
êê; =
(
êê> ?
Session
êê? F
[
êêF G
$str
êêG P
]
êêP Q
==
êêR T
null
êêU Y
)
êêY Z
return
êê[ a
RedirectToAction
êêb r
(
êêr s
$str
êês z
,
êêz {
$strêê| Ç
)êêÇ É
;êêÉ Ñ
string
ëë 
Linea
ëë 
=
ëë 
logi
ëë #
.
ëë# $ 
GetLineaFromCookie
ëë$ 6
(
ëë6 7
Request
ëë7 >
)
ëë> ?
.
ëë? @
ToString
ëë@ H
(
ëëH I
)
ëëI J
;
ëëJ K
List
íí 
<
íí 

Checkpoint
íí 
>
íí  

checkpoint
íí! +
=
íí, -
new
íí. 1
List
íí2 6
<
íí6 7

Checkpoint
íí7 A
>
ííA B
(
ííB C
)
ííC D
;
ííD E

Checkpoint
ìì 
valid
ìì  
=
ìì! "
new
ìì# &

Checkpoint
ìì' 1
(
ìì1 2
)
ìì2 3
;
ìì3 4
using
îî 
(
îî 
dbModels
îî 
context
îî  '
=
îî( )
new
îî* -
dbModels
îî. 6
(
îî6 7
)
îî7 8
)
îî8 9
valid
îî9 >
=
îî? @
context
îîA H
.
îîH I

Checkpoint
îîI S
.
îîS T
Where
îîT Y
(
îîY Z
x
îîZ [
=>
îî\ ^
x
îî_ `
.
îî` a
idLine
îîa g
==
îîh j
Linea
îîk p
&&
îîq s
x
îît u
.
îîu v

idEmployeeîîv Ä
==îîÅ É
nullîîÑ à
&&îîâ ã
xîîå ç
.îîç é
statusîîé î
!=îîï ó
$numîîò ô
)îîô ö
.îîö õ
FirstOrDefaultîîõ ©
(îî© ™
)îî™ ´
;îî´ ¨
using
ïï 
(
ïï 
dbModels
ïï 
context
ïï  '
=
ïï( )
new
ïï* -
dbModels
ïï. 6
(
ïï6 7
)
ïï7 8
)
ïï8 9

checkpoint
ïï: D
=
ïïE F
context
ïïG N
.
ïïN O

Checkpoint
ïïO Y
.
ïïY Z
Where
ïïZ _
(
ïï_ `
x
ïï` a
=>
ïïb d
x
ïïe f
.
ïïf g
idLine
ïïg m
==
ïïn p
Linea
ïïq v
&&
ïïw y
x
ïïz {
.
ïï{ |

idEmployeeïï| Ü
==ïïá â
nullïïä é
&&ïïè ë
xïïí ì
.ïïì î
statusïïî ö
!=ïïõ ù
$numïïû ü
)ïïü †
.ïï† °
ToListïï° ß
(ïïß ®
)ïï® ©
;ïï© ™
if
ññ 
(
ññ 
valid
ññ 
==
ññ 
null
ññ !
)
ññ! "
return
ññ# )
RedirectToAction
ññ* :
(
ññ: ;
$str
ññ; J
,
ññJ K
$str
ññL S
)
ññS T
;
ññT U
ViewBag
óó 
.
óó 
idCheckpoint
óó $
=
óó% &
new
óó' *

SelectList
óó+ 5
(
óó5 6

checkpoint
óó6 @
,
óó@ A
$str
óóB P
,
óóP Q
$str
óóR _
)
óó_ `
;
óó` a
return
òò 
View
òò 
(
òò 
)
òò 
;
òò 
}
ôô 
catch
öö 
(
öö 
	Exception
öö 
)
öö 
{
õõ 
return
úú 
RedirectToAction
úú '
(
úú' (
$str
úú( /
,
úú/ 0
$str
úú1 7
)
úú7 8
;
úú8 9
}
ùù 
}
ûû 	
[
†† 	
HttpPost
††	 
]
†† 
public
°° 
ActionResult
°° 
CreateControlador
°° -
(
°°- .
EmployeeControl
°°. =
employeeControl
°°> M
)
°°M N
{
¢¢ 	
try
££ 
{
§§ 
Login
•• 
logi
•• 
=
•• 
new
••  
Login
••! &
(
••& '
)
••' (
;
••( )
var
¶¶ 

authResult
¶¶ 
=
¶¶   
AutenticarPasosRol
¶¶! 3
(
¶¶3 4
$num
¶¶4 5
)
¶¶5 6
;
¶¶6 7
if
ßß 
(
ßß 

authResult
ßß 
!=
ßß !
null
ßß" &
)
ßß& '
return
ßß( .

authResult
ßß/ 9
;
ßß9 :
if
®® 
(
®® 
Session
®® 
[
®® 
$str
®® %
]
®®% &
==
®®' )
null
®®* .
)
®®. /
return
®®0 6
RedirectToAction
®®7 G
(
®®G H
$str
®®H O
,
®®O P
$str
®®Q W
)
®®W X
;
®®X Y
string
©© 
numeroFormateado
©© '
=
©©( )
employeeControl
©©* 9
.
©©9 :
salary
©©: @
.
©©@ A
ToString
©©A I
(
©©I J
$str
©©J P
)
©©P Q
;
©©Q R
employeeControl
™™ 
.
™™  

idEmployee
™™  *
=
™™+ ,
Session
™™- 4
[
™™4 5
$str
™™5 >
]
™™> ?
.
™™? @
ToString
™™@ H
(
™™H I
)
™™I J
;
™™J K
TimeZoneInfo
´´ 
boliviaTimeZone
´´ ,
=
´´- .
TimeZoneInfo
´´/ ;
.
´´; <$
FindSystemTimeZoneById
´´< R
(
´´R S
$str
´´S m
)
´´m n
;
´´n o
DateTime
¨¨ 
boliviaTime
¨¨ $
=
¨¨% &
TimeZoneInfo
¨¨' 3
.
¨¨3 4
ConvertTime
¨¨4 ?
(
¨¨? @
DateTime
¨¨@ H
.
¨¨H I
UtcNow
¨¨I O
,
¨¨O P
boliviaTimeZone
¨¨Q `
)
¨¨` a
;
¨¨a b
if
≠≠ 
(
≠≠ 
decimal
≠≠ 
.
≠≠ 
Parse
≠≠ !
(
≠≠! "
numeroFormateado
≠≠" 2
)
≠≠2 3
<=
≠≠4 6
$num
≠≠7 8
||
≠≠9 ;
decimal
≠≠< C
.
≠≠C D
Parse
≠≠D I
(
≠≠I J
numeroFormateado
≠≠J Z
)
≠≠Z [
>=
≠≠\ ^
$num
≠≠_ d
)
≠≠d e
{
ÆÆ 
TempData
ØØ 
[
ØØ 
$str
ØØ %
]
ØØ% &
=
ØØ' (
$str
ØØ) X
;
ØØX Y
return
∞∞ 
View
∞∞ 
(
∞∞  
)
∞∞  !
;
∞∞! "
}
±± 
string
≤≤ 
Linea
≤≤ 
=
≤≤ 
logi
≤≤ #
.
≤≤# $ 
GetLineaFromCookie
≤≤$ 6
(
≤≤6 7
Request
≤≤7 >
)
≤≤> ?
.
≤≤? @
ToString
≤≤@ H
(
≤≤H I
)
≤≤I J
;
≤≤J K
List
≥≥ 
<
≥≥ 

Checkpoint
≥≥ 
>
≥≥  

checkpoint
≥≥! +
=
≥≥, -
new
≥≥. 1
List
≥≥2 6
<
≥≥6 7

Checkpoint
≥≥7 A
>
≥≥A B
(
≥≥B C
)
≥≥C D
;
≥≥D E
using
¥¥ 
(
¥¥ 
dbModels
¥¥ 
context
¥¥  '
=
¥¥( )
new
¥¥* -
dbModels
¥¥. 6
(
¥¥6 7
)
¥¥7 8
)
¥¥8 9

checkpoint
µµ 
=
µµ  
context
µµ! (
.
µµ( )

Checkpoint
µµ) 3
.
µµ3 4
Where
µµ4 9
(
µµ9 :
x
µµ: ;
=>
µµ< >
x
µµ? @
.
µµ@ A
idLine
µµA G
==
µµH J
Linea
µµK P
&&
µµQ S
x
µµT U
.
µµU V

idEmployee
µµV `
==
µµa c
null
µµd h
&&
µµi k
x
µµl m
.
µµm n
status
µµn t
!=
µµu w
$num
µµx y
)
µµy z
.
µµz {
ToListµµ{ Å
(µµÅ Ç
)µµÇ É
;µµÉ Ñ
if
∂∂ 
(
∂∂ 

checkpoint
∂∂ 
==
∂∂ !
null
∂∂" &
)
∂∂& '
return
∂∂( .
RedirectToAction
∂∂/ ?
(
∂∂? @
$str
∂∂@ O
,
∂∂O P
$str
∂∂Q X
)
∂∂X Y
;
∂∂Y Z
ViewBag
∑∑ 
.
∑∑ 
idCheckpoint
∑∑ $
=
∑∑% &
new
∑∑' *

SelectList
∑∑+ 5
(
∑∑5 6

checkpoint
∑∑6 @
,
∑∑@ A
$str
∑∑B P
,
∑∑P Q
$str
∑∑R _
)
∑∑_ `
;
∑∑` a
User
∏∏ 
user
∏∏ 
=
∏∏ 
new
∏∏ 
User
∏∏  $
(
∏∏$ %
)
∏∏% &
;
∏∏& '
using
ππ 
(
ππ 
dbModels
ππ 
context
ππ  '
=
ππ( )
new
ππ* -
dbModels
ππ. 6
(
ππ6 7
)
ππ7 8
)
ππ8 9
user
ππ: >
=
ππ? @
context
ππA H
.
ππH I
User
ππI M
.
ππM N
Where
ππN S
(
ππS T
x
ππT U
=>
ππV X
x
ππY Z
.
ππZ [
email
ππ[ `
.
ππ` a
ToLower
ππa h
(
ππh i
)
ππi j
.
ππj k
Trim
ππk o
(
ππo p
)
ππp q
==
ππr t
employeeControlππu Ñ
.ππÑ Ö
emailππÖ ä
.ππä ã
ToLowerππã í
(ππí ì
)ππì î
.ππî ï
Trimππï ô
(ππô ö
)ππö õ
)ππõ ú
.ππú ù
FirstOrDefaultππù ´
(ππ´ ¨
)ππ¨ ≠
;ππ≠ Æ
if
∫∫ 
(
∫∫ 
user
∫∫ 
!=
∫∫ 
null
∫∫  
)
∫∫  !
{
ªª 
TempData
ºº 
[
ºº 
$str
ºº #
]
ºº# $
=
ºº% &
$str
ºº' I
;
ººI J
return
ΩΩ 
View
ΩΩ 
(
ΩΩ  
)
ΩΩ  !
;
ΩΩ! "
}
ææ 
employeeControl
øø 
.
øø  

idEmployee
øø  *
=
øø+ ,
employeeControl
øø- <
.
øø< =

idEmployee
øø= G
.
øøG H
ToString
øøH P
(
øøP Q
)
øøQ R
.
øøR S
ToUpper
øøS Z
(
øøZ [
)
øø[ \
.
øø\ ]
Trim
øø] a
(
øøa b
)
øøb c
;
øøc d
Employee
¿¿ 
em
¿¿ 
=
¿¿ 
new
¿¿ !
Employee
¿¿" *
(
¿¿* +
)
¿¿+ ,
;
¿¿, -
using
¡¡ 
(
¡¡ 
dbModels
¡¡ 
context
¡¡  '
=
¡¡( )
new
¡¡* -
dbModels
¡¡. 6
(
¡¡6 7
)
¡¡7 8
)
¡¡8 9
em
¡¡: <
=
¡¡= >
context
¡¡? F
.
¡¡F G
Employee
¡¡G O
.
¡¡O P
Where
¡¡P U
(
¡¡U V
x
¡¡V W
=>
¡¡X Z
x
¡¡[ \
.
¡¡\ ]

idEmployee
¡¡] g
.
¡¡g h
ToString
¡¡h p
(
¡¡p q
)
¡¡q r
.
¡¡r s
ToUpper
¡¡s z
(
¡¡z {
)
¡¡{ |
.
¡¡| }
Trim¡¡} Å
(¡¡Å Ç
)¡¡Ç É
==¡¡Ñ Ü
employeeControl¡¡á ñ
.¡¡ñ ó

idEmployee¡¡ó °
.¡¡° ¢
ToString¡¡¢ ™
(¡¡™ ´
)¡¡´ ¨
.¡¡¨ ≠
ToUpper¡¡≠ ¥
(¡¡¥ µ
)¡¡µ ∂
.¡¡∂ ∑
Trim¡¡∑ ª
(¡¡ª º
)¡¡º Ω
&&¡¡æ ¿
x¡¡¡ ¬
.¡¡¬ √
status¡¡√ …
==¡¡  Ã
$num¡¡Õ Œ
)¡¡Œ œ
.¡¡œ –
FirstOrDefault¡¡– ﬁ
(¡¡ﬁ ﬂ
)¡¡ﬂ ‡
;¡¡‡ ·
if
¬¬ 
(
¬¬ 
em
¬¬ 
!=
¬¬ 
null
¬¬ 
)
¬¬ 
{
√√ 
TempData
ƒƒ 
[
ƒƒ 
$str
ƒƒ "
]
ƒƒ" #
=
ƒƒ$ %
$str
ƒƒ& F
;
ƒƒF G
return
≈≈ 
View
≈≈ 
(
≈≈  
)
≈≈  !
;
≈≈! "
}
∆∆ 
Person
«« 
person
«« 
=
«« 
new
««  #
Person
««$ *
(
««* +
)
««+ ,
;
««, -
using
»» 
(
»» 
dbModels
»» 
context
»»  '
=
»»( )
new
»»* -
dbModels
»». 6
(
»»6 7
)
»»7 8
)
»»8 9
person
»»: @
=
»»A B
context
»»C J
.
»»J K
Person
»»K Q
.
»»Q R
Where
»»R W
(
»»W X
x
»»X Y
=>
»»Z \
x
»»] ^
.
»»^ _
nit
»»_ b
.
»»b c
ToString
»»c k
(
»»k l
)
»»l m
.
»»m n
ToUpper
»»n u
(
»»u v
)
»»v w
.
»»w x
Trim
»»x |
(
»»| }
)
»»} ~
==»» Å
employeeControl»»Ç ë
.»»ë í

idEmployee»»í ú
.»»ú ù
ToString»»ù •
(»»• ¶
)»»¶ ß
)»»ß ®
.»»® ©
FirstOrDefault»»© ∑
(»»∑ ∏
)»»∏ π
;»»π ∫
if
…… 
(
…… 
person
…… 
==
…… 
null
…… "
)
……" #
{
   
using
ÀÀ 
(
ÀÀ 
dbModels
ÀÀ #
context
ÀÀ$ +
=
ÀÀ, -
new
ÀÀ. 1
dbModels
ÀÀ2 :
(
ÀÀ: ;
)
ÀÀ; <
)
ÀÀ< =
{
ÃÃ 
Person
ÕÕ 
personCreate
ÕÕ +
=
ÕÕ, -
new
ÕÕ. 1
Person
ÕÕ2 8
(
ÕÕ8 9
)
ÕÕ9 :
;
ÕÕ: ;
personCreate
ŒŒ $
.
ŒŒ$ %
nit
ŒŒ% (
=
ŒŒ) *
employeeControl
ŒŒ+ :
.
ŒŒ: ;

idEmployee
ŒŒ; E
.
ŒŒE F
Trim
ŒŒF J
(
ŒŒJ K
)
ŒŒK L
;
ŒŒL M
personCreate
œœ $
.
œœ$ %
name
œœ% )
=
œœ* +
employeeControl
œœ, ;
.
œœ; <
name
œœ< @
.
œœ@ A
Trim
œœA E
(
œœE F
)
œœF G
;
œœG H
personCreate
–– $
.
––$ %
lastname
––% -
=
––. /
employeeControl
––0 ?
.
––? @
lastname
––@ H
.
––H I
Trim
––I M
(
––M N
)
––N O
;
––O P
personCreate
—— $
.
——$ %
idRole
——% +
=
——, -
$num
——. /
;
——/ 0
personCreate
——1 =
.
——= >
status
——> D
=
——E F
$num
——G H
;
——H I
DateTime
““  
hoy
““! $
=
““% &
boliviaTime
““' 2
;
““2 3
personCreate
”” $
.
””$ %
dateRegister
””% 1
=
””2 3
hoy
””4 7
;
””7 8
context
‘‘ 
.
‘‘  
Person
‘‘  &
.
‘‘& '
Add
‘‘' *
(
‘‘* +
personCreate
‘‘+ 7
)
‘‘7 8
;
‘‘8 9
context
’’ 
.
’’  
SaveChanges
’’  +
(
’’+ ,
)
’’, -
;
’’- .
}
÷÷ 
}
◊◊ 
else
ÿÿ 
if
ÿÿ 
(
ÿÿ 
person
ÿÿ 
.
ÿÿ  
status
ÿÿ  &
==
ÿÿ' )
$num
ÿÿ* +
||
ÿÿ, .
person
ÿÿ/ 5
.
ÿÿ5 6
idRole
ÿÿ6 <
==
ÿÿ= ?
$num
ÿÿ@ A
)
ÿÿA B
using
ŸŸ 
(
ŸŸ 
dbModels
ŸŸ #
context
ŸŸ$ +
=
ŸŸ, -
new
ŸŸ. 1
dbModels
ŸŸ2 :
(
ŸŸ: ;
)
ŸŸ; <
)
ŸŸ< =
{
⁄⁄ 
person
€€ 
.
€€ 
name
€€ #
=
€€$ %
employeeControl
€€& 5
.
€€5 6
name
€€6 :
.
€€: ;
Trim
€€; ?
(
€€? @
)
€€@ A
;
€€A B
person
‹‹ 
.
‹‹ 
lastname
‹‹ '
=
‹‹( )
employeeControl
‹‹* 9
.
‹‹9 :
lastname
‹‹: B
.
‹‹B C
Trim
‹‹C G
(
‹‹G H
)
‹‹H I
;
‹‹I J
person
›› 
.
›› 
idRole
›› %
=
››& '
$num
››( )
;
››) *
person
››+ 1
.
››1 2
status
››2 8
=
››9 :
$num
››; <
;
››< =
context
ﬁﬁ 
.
ﬁﬁ  
Entry
ﬁﬁ  %
(
ﬁﬁ% &
person
ﬁﬁ& ,
)
ﬁﬁ, -
.
ﬁﬁ- .
State
ﬁﬁ. 3
=
ﬁﬁ4 5
System
ﬁﬁ6 <
.
ﬁﬁ< =
Data
ﬁﬁ= A
.
ﬁﬁA B
Entity
ﬁﬁB H
.
ﬁﬁH I
EntityState
ﬁﬁI T
.
ﬁﬁT U
Modified
ﬁﬁU ]
;
ﬁﬁ] ^
context
ﬂﬂ 
.
ﬂﬂ  
SaveChanges
ﬂﬂ  +
(
ﬂﬂ+ ,
)
ﬂﬂ, -
;
ﬂﬂ- .
}
‡‡ 
else
·· 
{
‚‚ 
TempData
„„ 
[
„„ 
$str
„„ %
]
„„% &
=
„„' (
$str
„„) H
;
„„H I
return
‰‰ 
View
‰‰ 
(
‰‰  
)
‰‰  !
;
‰‰! "
}
ÂÂ 
using
ÊÊ 
(
ÊÊ 
dbModels
ÊÊ 
context
ÊÊ  '
=
ÊÊ( )
new
ÊÊ* -
dbModels
ÊÊ. 6
(
ÊÊ6 7
)
ÊÊ7 8
)
ÊÊ8 9
person
ÊÊ: @
=
ÊÊA B
context
ÊÊC J
.
ÊÊJ K
Person
ÊÊK Q
.
ÊÊQ R
Where
ÊÊR W
(
ÊÊW X
x
ÊÊX Y
=>
ÊÊZ \
x
ÊÊ] ^
.
ÊÊ^ _
nit
ÊÊ_ b
.
ÊÊb c
ToString
ÊÊc k
(
ÊÊk l
)
ÊÊl m
==
ÊÊn p
employeeControlÊÊq Ä
.ÊÊÄ Å

idEmployeeÊÊÅ ã
.ÊÊã å
ToStringÊÊå î
(ÊÊî ï
)ÊÊï ñ
)ÊÊñ ó
.ÊÊó ò
FirstOrDefaultÊÊò ¶
(ÊÊ¶ ß
)ÊÊß ®
;ÊÊ® ©
User
ÁÁ 
validationMail
ÁÁ #
=
ÁÁ$ %
new
ÁÁ& )
User
ÁÁ* .
(
ÁÁ. /
)
ÁÁ/ 0
;
ÁÁ0 1
using
ËË 
(
ËË 
dbModels
ËË 
context
ËË  '
=
ËË( )
new
ËË* -
dbModels
ËË. 6
(
ËË6 7
)
ËË7 8
)
ËË8 9
validationMail
ËË: H
=
ËËI J
context
ËËK R
.
ËËR S
User
ËËS W
.
ËËW X
Where
ËËX ]
(
ËË] ^
x
ËË^ _
=>
ËË` b
x
ËËc d
.
ËËd e
email
ËËe j
.
ËËj k
ToLower
ËËk r
(
ËËr s
)
ËËs t
.
ËËt u
Trim
ËËu y
(
ËËy z
)
ËËz {
==
ËË| ~
employeeControlËË é
.ËËé è
emailËËè î
.ËËî ï
ToLowerËËï ú
(ËËú ù
)ËËù û
.ËËû ü
TrimËËü £
(ËË£ §
)ËË§ •
)ËË• ¶
.ËË¶ ß
FirstOrDefaultËËß µ
(ËËµ ∂
)ËË∂ ∑
;ËË∑ ∏
if
ÈÈ 
(
ÈÈ 
validationMail
ÈÈ "
!=
ÈÈ# %
null
ÈÈ& *
)
ÈÈ* +
{
ÍÍ 
TempData
ÎÎ 
[
ÎÎ 
$str
ÎÎ #
]
ÎÎ# $
=
ÎÎ% &
$str
ÎÎ' I
;
ÎÎI J
return
ÏÏ 
View
ÏÏ 
(
ÏÏ  
)
ÏÏ  !
;
ÏÏ! "
}
ÌÌ 
Employee
ÓÓ 
employee
ÓÓ !
=
ÓÓ" #
new
ÓÓ$ '
Employee
ÓÓ( 0
(
ÓÓ0 1
)
ÓÓ1 2
;
ÓÓ2 3
user
ÔÔ 
=
ÔÔ 
new
ÔÔ 
User
ÔÔ 
(
ÔÔ  
)
ÔÔ  !
;
ÔÔ! "
employee
 
.
 

idEmployee
 #
=
$ %
employeeControl
& 5
.
5 6

idEmployee
6 @
.
@ A
Trim
A E
(
E F
)
F G
;
G H
employee
I Q
.
Q R
status
R X
=
Y Z
$num
[ \
;
\ ]
employee
ÒÒ 
.
ÒÒ 
dateRegister
ÒÒ %
=
ÒÒ& '
boliviaTime
ÒÒ( 3
;
ÒÒ3 4
employee
ÒÒ5 =
.
ÒÒ= >
idLine
ÒÒ> D
=
ÒÒE F
Linea
ÒÒG L
;
ÒÒL M
employee
ÚÚ 
.
ÚÚ 
salary
ÚÚ 
=
ÚÚ  !
employeeControl
ÚÚ" 1
.
ÚÚ1 2
salary
ÚÚ2 8
;
ÚÚ8 9
using
ÛÛ 
(
ÛÛ 
dbModels
ÛÛ 
context
ÛÛ  '
=
ÛÛ( )
new
ÛÛ* -
dbModels
ÛÛ. 6
(
ÛÛ6 7
)
ÛÛ7 8
)
ÛÛ8 9
em
ÛÛ: <
=
ÛÛ= >
context
ÛÛ? F
.
ÛÛF G
Employee
ÛÛG O
.
ÛÛO P
Where
ÛÛP U
(
ÛÛU V
x
ÛÛV W
=>
ÛÛX Z
x
ÛÛ[ \
.
ÛÛ\ ]

idEmployee
ÛÛ] g
.
ÛÛg h
ToString
ÛÛh p
(
ÛÛp q
)
ÛÛq r
==
ÛÛs u
employeeControlÛÛv Ö
.ÛÛÖ Ü

idEmployeeÛÛÜ ê
.ÛÛê ë
ToStringÛÛë ô
(ÛÛô ö
)ÛÛö õ
)ÛÛõ ú
.ÛÛú ù
FirstOrDefaultÛÛù ´
(ÛÛ´ ¨
)ÛÛ¨ ≠
;ÛÛ≠ Æ
if
ÙÙ 
(
ÙÙ 
em
ÙÙ 
==
ÙÙ 
null
ÙÙ 
)
ÙÙ 
using
ıı 
(
ıı 
dbModels
ıı #
context
ıı$ +
=
ıı, -
new
ıı. 1
dbModels
ıı2 :
(
ıı: ;
)
ıı; <
)
ıı< =
{
ˆˆ 
context
˜˜ 
.
˜˜  
Employee
˜˜  (
.
˜˜( )
Add
˜˜) ,
(
˜˜, -
employee
˜˜- 5
)
˜˜5 6
;
˜˜6 7
context
¯¯ 
.
¯¯  
SaveChanges
¯¯  +
(
¯¯+ ,
)
¯¯, -
;
¯¯- .
}
˘˘ 
else
˙˙ 
if
˙˙ 
(
˙˙ 
em
˙˙ 
.
˙˙ 
status
˙˙ "
==
˙˙# %
$num
˙˙& '
)
˙˙' (
using
˚˚ 
(
˚˚ 
dbModels
˚˚ #
context
˚˚$ +
=
˚˚, -
new
˚˚. 1
dbModels
˚˚2 :
(
˚˚: ;
)
˚˚; <
)
˚˚< =
{
¸¸ 
context
˝˝ 
.
˝˝  
Entry
˝˝  %
(
˝˝% &
employee
˝˝& .
)
˝˝. /
.
˝˝/ 0
State
˝˝0 5
=
˝˝6 7
System
˝˝8 >
.
˝˝> ?
Data
˝˝? C
.
˝˝C D
Entity
˝˝D J
.
˝˝J K
EntityState
˝˝K V
.
˝˝V W
Modified
˝˝W _
;
˝˝_ `
context
˛˛ 
.
˛˛  
SaveChanges
˛˛  +
(
˛˛+ ,
)
˛˛, -
;
˛˛- .
}
ˇˇ 
else
ÄÄ 
{
ÅÅ 
TempData
ÇÇ 
[
ÇÇ 
$str
ÇÇ "
]
ÇÇ" #
=
ÇÇ$ %
$str
ÇÇ& F
;
ÇÇF G
return
ÉÉ 
View
ÉÉ 
(
ÉÉ  
)
ÉÉ  !
;
ÉÉ! "
}
ÑÑ 
string
ÖÖ 
username
ÖÖ 
=
ÖÖ  !
employeeControl
ÖÖ" 1
.
ÖÖ1 2
GenerarUsername
ÖÖ2 A
(
ÖÖA B
person
ÖÖB H
.
ÖÖH I
name
ÖÖI M
.
ÖÖM N
Trim
ÖÖN R
(
ÖÖR S
)
ÖÖS T
,
ÖÖT U
person
ÖÖV \
.
ÖÖ\ ]
lastname
ÖÖ] e
.
ÖÖe f
Trim
ÖÖf j
(
ÖÖj k
)
ÖÖk l
)
ÖÖl m
;
ÖÖm n
string
ÜÜ 
pass
ÜÜ 
=
ÜÜ 
employeeControl
ÜÜ -
.
ÜÜ- .
GenerarPassword
ÜÜ. =
(
ÜÜ= >
)
ÜÜ> ?
;
ÜÜ? @
using
áá 
(
áá 
dbModels
áá 
context
áá  '
=
áá( )
new
áá* -
dbModels
áá. 6
(
áá6 7
)
áá7 8
)
áá8 9
{
àà 

Encriptado
ââ 

encriptado
ââ )
=
ââ* +
new
ââ, /

Encriptado
ââ0 :
(
ââ: ;
)
ââ; <
;
ââ< =
user
ää 
.
ää 
username
ää !
=
ää" #
username
ää$ ,
.
ää, -
Trim
ää- 1
(
ää1 2
)
ää2 3
;
ää3 4
user
ãã 
.
ãã 
password
ãã !
=
ãã" #

encriptado
ãã$ .
.
ãã. /
	Encriptar
ãã/ 8
(
ãã8 9
pass
ãã9 =
)
ãã= >
;
ãã> ?
user
åå 
.
åå 
email
åå 
=
åå  
employeeControl
åå! 0
.
åå0 1
email
åå1 6
.
åå6 7
ToLower
åå7 >
(
åå> ?
)
åå? @
.
åå@ A
Trim
ååA E
(
ååE F
)
ååF G
;
ååG H
user
çç 
.
çç 

idEmployee
çç #
=
çç$ %
employeeControl
çç& 5
.
çç5 6

idEmployee
çç6 @
.
çç@ A
Trim
ççA E
(
ççE F
)
ççF G
;
ççG H
user
éé 
.
éé 

firstEntry
éé #
=
éé$ %
$num
éé& '
;
éé' (
context
èè 
.
èè 
User
èè  
.
èè  !
Add
èè! $
(
èè$ %
user
èè% )
)
èè) *
;
èè* +
context
êê 
.
êê 
SaveChanges
êê '
(
êê' (
)
êê( )
;
êê) *
employeeControl
ëë #
.
ëë# $
EnviarCorreo
ëë$ 0
(
ëë0 1
employeeControl
ëë1 @
.
ëë@ A
email
ëëA F
.
ëëF G
ToLower
ëëG N
(
ëëN O
)
ëëO P
.
ëëP Q
Trim
ëëQ U
(
ëëU V
)
ëëV W
,
ëëW X
username
ëëY a
,
ëëa b
pass
ëëc g
)
ëëg h
;
ëëh i
}
íí 
using
ìì 
(
ìì 
dbModels
ìì 
context
ìì  '
=
ìì( )
new
ìì* -
dbModels
ìì. 6
(
ìì6 7
)
ìì7 8
)
ìì8 9
{
îî 

Checkpoint
ïï 
checkpoint1
ïï *
=
ïï+ ,
context
ïï- 4
.
ïï4 5

Checkpoint
ïï5 ?
.
ïï? @
Where
ïï@ E
(
ïïE F
x
ïïF G
=>
ïïH J
x
ïïK L
.
ïïL M
idCheckpoint
ïïM Y
==
ïïZ \
employeeControl
ïï] l
.
ïïl m
idCheckpoint
ïïm y
)
ïïy z
.
ïïz {
FirstOrDefaultïï{ â
(ïïâ ä
)ïïä ã
;ïïã å
checkpoint1
ññ 
.
ññ  

idEmployee
ññ  *
=
ññ+ ,
employeeControl
ññ- <
.
ññ< =

idEmployee
ññ= G
.
ññG H
Trim
ññH L
(
ññL M
)
ññM N
;
ññN O
context
óó 
.
óó 
Entry
óó !
(
óó! "
checkpoint1
óó" -
)
óó- .
.
óó. /
State
óó/ 4
=
óó5 6
System
óó7 =
.
óó= >
Data
óó> B
.
óóB C
Entity
óóC I
.
óóI J
EntityState
óóJ U
.
óóU V
Modified
óóV ^
;
óó^ _
context
òò 
.
òò 
SaveChanges
òò '
(
òò' (
)
òò( )
;
òò) *
}
ôô 
return
öö 
RedirectToAction
öö '
(
öö' (
$str
öö( /
)
öö/ 0
;
öö0 1
}
õõ 
catch
úú 
(
úú 
	Exception
úú 
)
úú 
{
ùù 
return
ûû 
RedirectToAction
ûû '
(
ûû' (
$str
ûû( /
,
ûû/ 0
$str
ûû1 7
)
ûû7 8
;
ûû8 9
}
üü 
}
†† 	
public
°° 
ActionResult
°° 

EditChofer
°° &
(
°°& '
string
°°' -
id
°°. 0
)
°°0 1
{
¢¢ 	
try
££ 
{
§§ 
if
•• 
(
•• 
id
•• 
==
•• 
null
•• 
)
•• 
return
••  &
RedirectToAction
••' 7
(
••7 8
$str
••8 ?
,
••? @
$str
••A G
)
••G H
;
••H I
Login
¶¶ 
logi
¶¶ 
=
¶¶ 
new
¶¶  
Login
¶¶! &
(
¶¶& '
)
¶¶' (
;
¶¶( )
var
ßß 

authResult
ßß 
=
ßß   
AutenticarPasosRol
ßß! 3
(
ßß3 4
$num
ßß4 5
)
ßß5 6
;
ßß6 7
if
®® 
(
®® 

authResult
®® 
!=
®® !
null
®®" &
)
®®& '
return
®®( .

authResult
®®/ 9
;
®®9 :
Session
©© 
[
©© 
$str
©© ,
]
©©, -
=
©©. /
null
©©0 4
;
©©4 5
Session
©©6 =
[
©©= >
$str
©©> Q
]
©©Q R
=
©©S T
null
©©U Y
;
©©Y Z
EmployeeChofer
™™ 
employeeChofer
™™ -
=
™™. /
new
™™0 3
EmployeeChofer
™™4 B
(
™™B C
)
™™C D
;
™™D E
Employee
´´ 
employee
´´ !
=
´´" #
new
´´$ '
Employee
´´( 0
(
´´0 1
)
´´1 2
;
´´2 3
User
¨¨ 
user
¨¨ 
=
¨¨ 
new
¨¨ 
User
¨¨  $
(
¨¨$ %
)
¨¨% &
;
¨¨& '
using
≠≠ 
(
≠≠ 
dbModels
≠≠ 
context
≠≠  '
=
≠≠( )
new
≠≠* -
dbModels
≠≠. 6
(
≠≠6 7
)
≠≠7 8
)
≠≠8 9
employee
≠≠: B
=
≠≠C D
context
≠≠E L
.
≠≠L M
Employee
≠≠M U
.
≠≠U V
Where
≠≠V [
(
≠≠[ \
x
≠≠\ ]
=>
≠≠^ `
x
≠≠a b
.
≠≠b c

idEmployee
≠≠c m
.
≠≠m n
ToString
≠≠n v
(
≠≠v w
)
≠≠w x
==
≠≠y {
id
≠≠| ~
)
≠≠~ 
.≠≠ Ä
FirstOrDefault≠≠Ä é
(≠≠é è
)≠≠è ê
;≠≠ê ë
employeeChofer
ÆÆ 
.
ÆÆ 

idEmployee
ÆÆ )
=
ÆÆ* +
id
ÆÆ, .
;
ÆÆ. /
employeeChofer
ØØ 
.
ØØ 
plate
ØØ $
=
ØØ% &
employee
ØØ' /
.
ØØ/ 0
plate
ØØ0 5
;
ØØ5 6
Person
∞∞ 
person
∞∞ 
=
∞∞ 
new
∞∞  #
Person
∞∞$ *
(
∞∞* +
)
∞∞+ ,
;
∞∞, -
using
±± 
(
±± 
dbModels
±± 
context
±±  '
=
±±( )
new
±±* -
dbModels
±±. 6
(
±±6 7
)
±±7 8
)
±±8 9
person
±±: @
=
±±A B
context
±±C J
.
±±J K
Person
±±K Q
.
±±Q R
Where
±±R W
(
±±W X
x
±±X Y
=>
±±Z \
x
±±] ^
.
±±^ _
nit
±±_ b
.
±±b c
ToString
±±c k
(
±±k l
)
±±l m
==
±±n p
id
±±q s
)
±±s t
.
±±t u
FirstOrDefault±±u É
(±±É Ñ
)±±Ñ Ö
;±±Ö Ü
employeeChofer
≤≤ 
.
≤≤ 
name
≤≤ #
=
≤≤$ %
person
≤≤& ,
.
≤≤, -
name
≤≤- 1
;
≤≤1 2
employeeChofer
≥≥ 
.
≥≥ 
lastname
≥≥ '
=
≥≥( )
person
≥≥* 0
.
≥≥0 1
lastname
≥≥1 9
;
≥≥9 :
using
¥¥ 
(
¥¥ 
dbModels
¥¥ 
context
¥¥  '
=
¥¥( )
new
¥¥* -
dbModels
¥¥. 6
(
¥¥6 7
)
¥¥7 8
)
¥¥8 9
user
¥¥: >
=
¥¥? @
context
¥¥A H
.
¥¥H I
User
¥¥I M
.
¥¥M N
Where
¥¥N S
(
¥¥S T
x
¥¥T U
=>
¥¥V X
x
¥¥Y Z
.
¥¥Z [

idEmployee
¥¥[ e
.
¥¥e f
ToString
¥¥f n
(
¥¥n o
)
¥¥o p
==
¥¥q s
id
¥¥t v
)
¥¥v w
.
¥¥w x
FirstOrDefault¥¥x Ü
(¥¥Ü á
)¥¥á à
;¥¥à â
employeeChofer
µµ 
.
µµ 
email
µµ $
=
µµ% &
user
µµ' +
.
µµ+ ,
email
µµ, 1
;
µµ1 2
if
∂∂ 
(
∂∂ 
employee
∂∂ 
.
∂∂ 
salary
∂∂ #
!=
∂∂$ &
null
∂∂' +
)
∂∂+ ,
employeeChofer
∂∂- ;
.
∂∂; <
salary
∂∂< B
=
∂∂C D
decimal
∂∂E L
.
∂∂L M
Parse
∂∂M R
(
∂∂R S
employee
∂∂S [
.
∂∂[ \
salary
∂∂\ b
.
∂∂b c
ToString
∂∂c k
(
∂∂k l
)
∂∂l m
)
∂∂m n
;
∂∂n o
Session
∑∑ 
[
∑∑ 
$str
∑∑ +
]
∑∑+ ,
=
∑∑- .
person
∑∑/ 5
;
∑∑5 6
Session
∑∑7 >
[
∑∑> ?
$str
∑∑? S
]
∑∑S T
=
∑∑U V
employee
∑∑W _
;
∑∑_ `
Session
∑∑a h
[
∑∑h i
$str
∑∑i y
]
∑∑y z
=
∑∑{ |
user∑∑} Å
;∑∑Å Ç
return
∏∏ 
View
∏∏ 
(
∏∏ 
employeeChofer
∏∏ *
)
∏∏* +
;
∏∏+ ,
}
ππ 
catch
∫∫ 
(
∫∫ 
	Exception
∫∫ 
)
∫∫ 
{
ªª 
return
ºº 
RedirectToAction
ºº '
(
ºº' (
$str
ºº( /
,
ºº/ 0
$str
ºº1 7
)
ºº7 8
;
ºº8 9
}
ΩΩ 
}
ææ 	
[
¿¿ 	
HttpPost
¿¿	 
]
¿¿ 
public
¡¡ 
ActionResult
¡¡ 

EditChofer
¡¡ &
(
¡¡& '
EmployeeChofer
¡¡' 5
employeeChofer
¡¡6 D
)
¡¡D E
{
¬¬ 	
try
√√ 
{
ƒƒ 
Login
≈≈ 
logi
≈≈ 
=
≈≈ 
new
≈≈  
Login
≈≈! &
(
≈≈& '
)
≈≈' (
;
≈≈( )
var
∆∆ 

authResult
∆∆ 
=
∆∆   
AutenticarPasosRol
∆∆! 3
(
∆∆3 4
$num
∆∆4 5
)
∆∆5 6
;
∆∆6 7
if
«« 
(
«« 

authResult
«« 
!=
«« !
null
««" &
)
««& '
return
««( .

authResult
««/ 9
;
««9 :
Employee
»» 
employee
»» !
=
»»" #
(
»»$ %
Employee
»»% -
)
»»- .
Session
»». 5
[
»»5 6
$str
»»6 J
]
»»J K
;
»»K L
Person
…… 
person
…… 
=
…… 
(
……  !
Person
……! '
)
……' (
Session
……( /
[
……/ 0
$str
……0 C
]
……C D
;
……D E
User
   
user
   
=
   
(
   
User
   !
)
  ! "
Session
  " )
[
  ) *
$str
  * :
]
  : ;
;
  ; <
string
ÀÀ 
numeroFormateado
ÀÀ '
=
ÀÀ( )
$str
ÀÀ* .
;
ÀÀ. /
User
ÃÃ 
validationMail
ÃÃ #
=
ÃÃ$ %
new
ÃÃ& )
User
ÃÃ* .
(
ÃÃ. /
)
ÃÃ/ 0
;
ÃÃ0 1
using
ÕÕ 
(
ÕÕ 
dbModels
ÕÕ 
context
ÕÕ  '
=
ÕÕ( )
new
ÕÕ* -
dbModels
ÕÕ. 6
(
ÕÕ6 7
)
ÕÕ7 8
)
ÕÕ8 9
validationMail
ÕÕ: H
=
ÕÕI J
context
ÕÕK R
.
ÕÕR S
User
ÕÕS W
.
ÕÕW X
Where
ÕÕX ]
(
ÕÕ] ^
x
ÕÕ^ _
=>
ÕÕ` b
x
ÕÕc d
.
ÕÕd e
email
ÕÕe j
.
ÕÕj k
ToLower
ÕÕk r
(
ÕÕr s
)
ÕÕs t
.
ÕÕt u
Trim
ÕÕu y
(
ÕÕy z
)
ÕÕz {
==
ÕÕ| ~
employeeChoferÕÕ ç
.ÕÕç é
emailÕÕé ì
.ÕÕì î
ToLowerÕÕî õ
(ÕÕõ ú
)ÕÕú ù
.ÕÕù û
TrimÕÕû ¢
(ÕÕ¢ £
)ÕÕ£ §
)ÕÕ§ •
.ÕÕ• ¶
FirstOrDefaultÕÕ¶ ¥
(ÕÕ¥ µ
)ÕÕµ ∂
;ÕÕ∂ ∑
if
ŒŒ 
(
ŒŒ 
validationMail
ŒŒ "
!=
ŒŒ# %
null
ŒŒ& *
&&
ŒŒ+ -
user
ŒŒ. 2
.
ŒŒ2 3
email
ŒŒ3 8
.
ŒŒ8 9
ToLower
ŒŒ9 @
(
ŒŒ@ A
)
ŒŒA B
.
ŒŒB C
Trim
ŒŒC G
(
ŒŒG H
)
ŒŒH I
!=
ŒŒJ L
employeeChofer
ŒŒM [
.
ŒŒ[ \
email
ŒŒ\ a
.
ŒŒa b
ToLower
ŒŒb i
(
ŒŒi j
)
ŒŒj k
.
ŒŒk l
Trim
ŒŒl p
(
ŒŒp q
)
ŒŒq r
)
ŒŒr s
{
œœ 
TempData
–– 
[
–– 
$str
–– #
]
––# $
=
––% &
$str
––' I
;
––I J
return
—— 
View
—— 
(
——  
)
——  !
;
——! "
}
““ 
using
”” 
(
”” 
dbModels
”” 
context
””  '
=
””( )
new
””* -
dbModels
””. 6
(
””6 7
)
””7 8
)
””8 9
{
‘‘ 
Employee
’’ 
e
’’ 
=
’’  
context
’’! (
.
’’( )
Employee
’’) 1
.
’’1 2
Where
’’2 7
(
’’7 8
x
’’8 9
=>
’’: <
x
’’= >
.
’’> ?
plate
’’? D
.
’’D E
ToUpper
’’E L
(
’’L M
)
’’M N
.
’’N O
Trim
’’O S
(
’’S T
)
’’T U
==
’’V X
employeeChofer
’’Y g
.
’’g h
plate
’’h m
.
’’m n
ToUpper
’’n u
(
’’u v
)
’’v w
.
’’w x
Trim
’’x |
(
’’| }
)
’’} ~
)
’’~ 
.’’ Ä
FirstOrDefault’’Ä é
(’’é è
)’’è ê
;’’ê ë
if
÷÷ 
(
÷÷ 
e
÷÷ 
!=
÷÷ 
null
÷÷ !
&&
÷÷" $
employee
÷÷% -
.
÷÷- .
plate
÷÷. 3
.
÷÷3 4
ToUpper
÷÷4 ;
(
÷÷; <
)
÷÷< =
.
÷÷= >
Trim
÷÷> B
(
÷÷B C
)
÷÷C D
!=
÷÷E G
employeeChofer
÷÷H V
.
÷÷V W
plate
÷÷W \
.
÷÷\ ]
ToUpper
÷÷] d
(
÷÷d e
)
÷÷e f
.
÷÷f g
Trim
÷÷g k
(
÷÷k l
)
÷÷l m
)
÷÷m n
{
◊◊ 
TempData
ÿÿ  
[
ÿÿ  !
$str
ÿÿ! (
]
ÿÿ( )
=
ÿÿ* +
$str
ÿÿ, O
;
ÿÿO P
return
ŸŸ 
View
ŸŸ #
(
ŸŸ# $
)
ŸŸ$ %
;
ŸŸ% &
}
⁄⁄ 
}
€€ 
using
‹‹ 
(
‹‹ 
dbModels
‹‹ 
context
‹‹  '
=
‹‹( )
new
‹‹* -
dbModels
‹‹. 6
(
‹‹6 7
)
‹‹7 8
)
‹‹8 9
{
›› 
person
ﬁﬁ 
.
ﬁﬁ 
name
ﬁﬁ 
=
ﬁﬁ  !
employeeChofer
ﬁﬁ" 0
.
ﬁﬁ0 1
name
ﬁﬁ1 5
.
ﬁﬁ5 6
Trim
ﬁﬁ6 :
(
ﬁﬁ: ;
)
ﬁﬁ; <
;
ﬁﬁ< =
person
ﬂﬂ 
.
ﬂﬂ 
lastname
ﬂﬂ #
=
ﬂﬂ$ %
employeeChofer
ﬂﬂ& 4
.
ﬂﬂ4 5
lastname
ﬂﬂ5 =
.
ﬂﬂ= >
Trim
ﬂﬂ> B
(
ﬂﬂB C
)
ﬂﬂC D
;
ﬂﬂD E
context
‡‡ 
.
‡‡ 
Entry
‡‡ !
(
‡‡! "
person
‡‡" (
)
‡‡( )
.
‡‡) *
State
‡‡* /
=
‡‡0 1
System
‡‡2 8
.
‡‡8 9
Data
‡‡9 =
.
‡‡= >
Entity
‡‡> D
.
‡‡D E
EntityState
‡‡E P
.
‡‡P Q
Modified
‡‡Q Y
;
‡‡Y Z
context
·· 
.
·· 
SaveChanges
·· '
(
··' (
)
··( )
;
··) *
}
‚‚ 
using
„„ 
(
„„ 
dbModels
„„ 
context
„„  '
=
„„( )
new
„„* -
dbModels
„„. 6
(
„„6 7
)
„„7 8
)
„„8 9
{
‰‰ 
employee
ÂÂ 
.
ÂÂ 
plate
ÂÂ "
=
ÂÂ# $
employeeChofer
ÂÂ% 3
.
ÂÂ3 4
plate
ÂÂ4 9
.
ÂÂ9 :
ToUpper
ÂÂ: A
(
ÂÂA B
)
ÂÂB C
.
ÂÂC D
Trim
ÂÂD H
(
ÂÂH I
)
ÂÂI J
;
ÂÂJ K
employee
ÊÊ 
.
ÊÊ 
salary
ÊÊ #
=
ÊÊ$ %
employeeChofer
ÊÊ& 4
.
ÊÊ4 5
salary
ÊÊ5 ;
;
ÊÊ; <
context
ÁÁ 
.
ÁÁ 
Entry
ÁÁ !
(
ÁÁ! "
employee
ÁÁ" *
)
ÁÁ* +
.
ÁÁ+ ,
State
ÁÁ, 1
=
ÁÁ2 3
System
ÁÁ4 :
.
ÁÁ: ;
Data
ÁÁ; ?
.
ÁÁ? @
Entity
ÁÁ@ F
.
ÁÁF G
EntityState
ÁÁG R
.
ÁÁR S
Modified
ÁÁS [
;
ÁÁ[ \
context
ËË 
.
ËË 
SaveChanges
ËË '
(
ËË' (
)
ËË( )
;
ËË) *
}
ÈÈ 
using
ÍÍ 
(
ÍÍ 
dbModels
ÍÍ 
context
ÍÍ  '
=
ÍÍ( )
new
ÍÍ* -
dbModels
ÍÍ. 6
(
ÍÍ6 7
)
ÍÍ7 8
)
ÍÍ8 9
{
ÎÎ 
user
ÏÏ 
.
ÏÏ 
email
ÏÏ 
=
ÏÏ  
employeeChofer
ÏÏ! /
.
ÏÏ/ 0
email
ÏÏ0 5
.
ÏÏ5 6
ToLower
ÏÏ6 =
(
ÏÏ= >
)
ÏÏ> ?
.
ÏÏ? @
Trim
ÏÏ@ D
(
ÏÏD E
)
ÏÏE F
;
ÏÏF G
context
ÌÌ 
.
ÌÌ 
Entry
ÌÌ !
(
ÌÌ! "
user
ÌÌ" &
)
ÌÌ& '
.
ÌÌ' (
State
ÌÌ( -
=
ÌÌ. /
System
ÌÌ0 6
.
ÌÌ6 7
Data
ÌÌ7 ;
.
ÌÌ; <
Entity
ÌÌ< B
.
ÌÌB C
EntityState
ÌÌC N
.
ÌÌN O
Modified
ÌÌO W
;
ÌÌW X
context
ÓÓ 
.
ÓÓ 
SaveChanges
ÓÓ '
(
ÓÓ' (
)
ÓÓ( )
;
ÓÓ) *
}
ÔÔ 
Session
 
[
 
$str
 ,
]
, -
=
. /
null
0 4
;
4 5
Session
6 =
[
= >
$str
> Q
]
Q R
=
S T
null
U Y
;
Y Z
Session
[ b
[
b c
$str
c s
]
s t
=
u v
null
w {
;
{ |
return
ÒÒ 
RedirectToAction
ÒÒ '
(
ÒÒ' (
$str
ÒÒ( /
)
ÒÒ/ 0
;
ÒÒ0 1
}
ÚÚ 
catch
ÛÛ 
(
ÛÛ 
	Exception
ÛÛ 
)
ÛÛ 
{
ÙÙ 
return
ıı 
RedirectToAction
ıı '
(
ıı' (
$str
ıı( /
,
ıı/ 0
$str
ıı1 7
)
ıı7 8
;
ıı8 9
}
ˆˆ 
}
˜˜ 	
public
˘˘ 
ActionResult
˘˘ 
EditControlador
˘˘ +
(
˘˘+ ,
string
˘˘, 2
id
˘˘3 5
)
˘˘5 6
{
˙˙ 	
try
˚˚ 
{
¸¸ 
Login
˝˝ 
logi
˝˝ 
=
˝˝ 
new
˝˝  
Login
˝˝! &
(
˝˝& '
)
˝˝' (
;
˝˝( )
var
˛˛ 

authResult
˛˛ 
=
˛˛   
AutenticarPasosRol
˛˛! 3
(
˛˛3 4
$num
˛˛4 5
)
˛˛5 6
;
˛˛6 7
if
ˇˇ 
(
ˇˇ 

authResult
ˇˇ 
!=
ˇˇ !
null
ˇˇ" &
)
ˇˇ& '
return
ˇˇ( .

authResult
ˇˇ/ 9
;
ˇˇ9 :
Session
ÄÄ 
[
ÄÄ 
$str
ÄÄ -
]
ÄÄ- .
=
ÄÄ/ 0
null
ÄÄ1 5
;
ÄÄ5 6
Session
ÄÄ7 >
[
ÄÄ> ?
$str
ÄÄ? S
]
ÄÄS T
=
ÄÄU V
null
ÄÄW [
;
ÄÄ[ \
Session
ÄÄ] d
[
ÄÄd e
$str
ÄÄe v
]
ÄÄv w
=
ÄÄx y
null
ÄÄz ~
;
ÄÄ~ 
EmployeeControl
ÅÅ 
employeeControl
ÅÅ  /
=
ÅÅ0 1
new
ÅÅ2 5
EmployeeControl
ÅÅ6 E
(
ÅÅE F
)
ÅÅF G
;
ÅÅG H
User
ÇÇ 
user
ÇÇ 
=
ÇÇ 
new
ÇÇ 
User
ÇÇ  $
(
ÇÇ$ %
)
ÇÇ% &
;
ÇÇ& '
Employee
ÉÉ 
employee
ÉÉ !
=
ÉÉ" #
new
ÉÉ$ '
Employee
ÉÉ( 0
(
ÉÉ0 1
)
ÉÉ1 2
;
ÉÉ2 3
using
ÑÑ 
(
ÑÑ 
dbModels
ÑÑ 
context
ÑÑ  '
=
ÑÑ( )
new
ÑÑ* -
dbModels
ÑÑ. 6
(
ÑÑ6 7
)
ÑÑ7 8
)
ÑÑ8 9
employee
ÑÑ: B
=
ÑÑC D
context
ÑÑE L
.
ÑÑL M
Employee
ÑÑM U
.
ÑÑU V
Where
ÑÑV [
(
ÑÑ[ \
x
ÑÑ\ ]
=>
ÑÑ^ `
x
ÑÑa b
.
ÑÑb c

idEmployee
ÑÑc m
.
ÑÑm n
ToString
ÑÑn v
(
ÑÑv w
)
ÑÑw x
==
ÑÑy {
id
ÑÑ| ~
)
ÑÑ~ 
.ÑÑ Ä
FirstOrDefaultÑÑÄ é
(ÑÑé è
)ÑÑè ê
;ÑÑê ë
using
ÖÖ 
(
ÖÖ 
dbModels
ÖÖ 
context
ÖÖ  '
=
ÖÖ( )
new
ÖÖ* -
dbModels
ÖÖ. 6
(
ÖÖ6 7
)
ÖÖ7 8
)
ÖÖ8 9
user
ÖÖ: >
=
ÖÖ? @
context
ÖÖA H
.
ÖÖH I
User
ÖÖI M
.
ÖÖM N
Where
ÖÖN S
(
ÖÖS T
x
ÖÖT U
=>
ÖÖV X
x
ÖÖY Z
.
ÖÖZ [

idEmployee
ÖÖ[ e
.
ÖÖe f
ToString
ÖÖf n
(
ÖÖn o
)
ÖÖo p
==
ÖÖq s
id
ÖÖt v
)
ÖÖv w
.
ÖÖw x
FirstOrDefaultÖÖx Ü
(ÖÖÜ á
)ÖÖá à
;ÖÖà â
employeeControl
ÜÜ 
.
ÜÜ  

idEmployee
ÜÜ  *
=
ÜÜ+ ,
id
ÜÜ- /
;
ÜÜ/ 0
employeeControl
áá 
.
áá  
email
áá  %
=
áá& '
user
áá( ,
.
áá, -
email
áá- 2
.
áá2 3
ToLower
áá3 :
(
áá: ;
)
áá; <
.
áá< =
Trim
áá= A
(
ááA B
)
ááB C
;
ááC D
Person
àà 
person
àà 
=
àà 
new
àà  #
Person
àà$ *
(
àà* +
)
àà+ ,
;
àà, -
using
ââ 
(
ââ 
dbModels
ââ 
context
ââ  '
=
ââ( )
new
ââ* -
dbModels
ââ. 6
(
ââ6 7
)
ââ7 8
)
ââ8 9
person
ââ: @
=
ââA B
context
ââC J
.
ââJ K
Person
ââK Q
.
ââQ R
Where
ââR W
(
ââW X
x
ââX Y
=>
ââZ \
x
ââ] ^
.
ââ^ _
nit
ââ_ b
.
ââb c
ToString
ââc k
(
ââk l
)
ââl m
==
âân p
id
ââq s
)
ââs t
.
âât u
FirstOrDefaultââu É
(ââÉ Ñ
)ââÑ Ö
;ââÖ Ü
employeeControl
ää 
.
ää  
name
ää  $
=
ää% &
person
ää' -
.
ää- .
name
ää. 2
;
ää2 3
employeeControl
ãã 
.
ãã  
lastname
ãã  (
=
ãã) *
person
ãã+ 1
.
ãã1 2
lastname
ãã2 :
;
ãã: ;
employeeControl
åå 
.
åå  
salary
åå  &
=
åå' (
(
åå) *
decimal
åå* 1
)
åå1 2
employee
åå2 :
.
åå: ;
salary
åå; A
;
ååA B
Session
çç 
[
çç 
$str
çç ,
]
çç, -
=
çç. /
person
çç0 6
;
çç6 7
Session
çç8 ?
[
çç? @
$str
çç@ Q
]
ççQ R
=
ççS T
user
ççU Y
;
ççY Z
Session
çç[ b
[
ççb c
$str
ççc x
]
ççx y
=
ççz {
employeeçç| Ñ
;ççÑ Ö
return
éé 
View
éé 
(
éé 
employeeControl
éé +
)
éé+ ,
;
éé, -
}
èè 
catch
êê 
(
êê 
	Exception
êê 
)
êê 
{
ëë 
return
íí 
RedirectToAction
íí '
(
íí' (
$str
íí( /
,
íí/ 0
$str
íí1 7
)
íí7 8
;
íí8 9
}
ìì 
}
îî 	
[
ññ 	
HttpPost
ññ	 
]
ññ 
public
óó 
ActionResult
óó 
EditControlador
óó +
(
óó+ ,
EmployeeControl
óó, ;
employeeControl
óó< K
)
óóK L
{
òò 	
try
ôô 
{
öö 
Login
õõ 
logi
õõ 
=
õõ 
new
õõ  
Login
õõ! &
(
õõ& '
)
õõ' (
;
õõ( )
var
úú 

authResult
úú 
=
úú   
AutenticarPasosRol
úú! 3
(
úú3 4
$num
úú4 5
)
úú5 6
;
úú6 7
if
ùù 
(
ùù 

authResult
ùù 
!=
ùù !
null
ùù" &
)
ùù& '
return
ùù( .

authResult
ùù/ 9
;
ùù9 :
User
ûû 
validationMail
ûû #
=
ûû$ %
new
ûû& )
User
ûû* .
(
ûû. /
)
ûû/ 0
;
ûû0 1
User
üü 
user
üü 
=
üü 
(
üü 
User
üü !
)
üü! "
Session
üü" )
[
üü) *
$str
üü* ;
]
üü; <
;
üü< =
Person
üü> D
person
üüE K
=
üüL M
(
üüN O
Person
üüO U
)
üüU V
Session
üüV ]
[
üü] ^
$str
üü^ r
]
üür s
;
üüs t
Employee
üüu }
employeeüü~ Ü
=üüá à
(üüâ ä
Employeeüüä í
)üüí ì
Sessionüüì ö
[üüö õ
$strüüõ ∞
]üü∞ ±
;üü± ≤
using
†† 
(
†† 
dbModels
†† 
context
††  '
=
††( )
new
††* -
dbModels
††. 6
(
††6 7
)
††7 8
)
††8 9
validationMail
††: H
=
††I J
context
††K R
.
††R S
User
††S W
.
††W X
Where
††X ]
(
††] ^
x
††^ _
=>
††` b
x
††c d
.
††d e
email
††e j
.
††j k
ToLower
††k r
(
††r s
)
††s t
.
††t u
Trim
††u y
(
††y z
)
††z {
==
††| ~
employeeControl†† é
.††é è
email††è î
.††î ï
ToLower††ï ú
(††ú ù
)††ù û
.††û ü
Trim††ü £
(††£ §
)††§ •
)††• ¶
.††¶ ß
FirstOrDefault††ß µ
(††µ ∂
)††∂ ∑
;††∑ ∏
string
°° 
numeroFormateado
°° '
=
°°( )
employeeControl
°°* 9
.
°°9 :
salary
°°: @
.
°°@ A
ToString
°°A I
(
°°I J
$str
°°J P
)
°°P Q
;
°°Q R
if
¢¢ 
(
¢¢ 
decimal
¢¢ 
.
¢¢ 
Parse
¢¢ !
(
¢¢! "
numeroFormateado
¢¢" 2
)
¢¢2 3
<=
¢¢4 6
$num
¢¢7 8
||
¢¢9 ;
decimal
¢¢< C
.
¢¢C D
Parse
¢¢D I
(
¢¢I J
numeroFormateado
¢¢J Z
)
¢¢Z [
>=
¢¢\ ^
$num
¢¢_ d
)
¢¢d e
{
££ 
TempData
§§ 
[
§§ 
$str
§§ %
]
§§% &
=
§§' (
$str
§§) X
;
§§X Y
return
•• 
View
•• 
(
••  
)
••  !
;
••! "
}
¶¶ 
if
ßß 
(
ßß 
validationMail
ßß "
!=
ßß# %
null
ßß& *
&&
ßß+ -
user
ßß. 2
.
ßß2 3
email
ßß3 8
.
ßß8 9
ToLower
ßß9 @
(
ßß@ A
)
ßßA B
.
ßßB C
Trim
ßßC G
(
ßßG H
)
ßßH I
!=
ßßJ L
employeeControl
ßßM \
.
ßß\ ]
email
ßß] b
.
ßßb c
ToLower
ßßc j
(
ßßj k
)
ßßk l
.
ßßl m
Trim
ßßm q
(
ßßq r
)
ßßr s
)
ßßs t
{
®® 
TempData
©© 
[
©© 
$str
©© #
]
©©# $
=
©©% &
$str
©©' I
;
©©I J
return
™™ 
View
™™ 
(
™™  
)
™™  !
;
™™! "
}
´´ 
using
¨¨ 
(
¨¨ 
dbModels
¨¨ 
context
¨¨  '
=
¨¨( )
new
¨¨* -
dbModels
¨¨. 6
(
¨¨6 7
)
¨¨7 8
)
¨¨8 9
{
≠≠ 
person
ÆÆ 
.
ÆÆ 
name
ÆÆ 
=
ÆÆ  !
employeeControl
ÆÆ" 1
.
ÆÆ1 2
name
ÆÆ2 6
.
ÆÆ6 7
Trim
ÆÆ7 ;
(
ÆÆ; <
)
ÆÆ< =
;
ÆÆ= >
person
ØØ 
.
ØØ 
lastname
ØØ #
=
ØØ$ %
employeeControl
ØØ& 5
.
ØØ5 6
lastname
ØØ6 >
.
ØØ> ?
Trim
ØØ? C
(
ØØC D
)
ØØD E
;
ØØE F
context
∞∞ 
.
∞∞ 
Entry
∞∞ !
(
∞∞! "
person
∞∞" (
)
∞∞( )
.
∞∞) *
State
∞∞* /
=
∞∞0 1
System
∞∞2 8
.
∞∞8 9
Data
∞∞9 =
.
∞∞= >
Entity
∞∞> D
.
∞∞D E
EntityState
∞∞E P
.
∞∞P Q
Modified
∞∞Q Y
;
∞∞Y Z
context
±± 
.
±± 
SaveChanges
±± '
(
±±' (
)
±±( )
;
±±) *
}
≤≤ 
using
≥≥ 
(
≥≥ 
dbModels
≥≥ 
context
≥≥  '
=
≥≥( )
new
≥≥* -
dbModels
≥≥. 6
(
≥≥6 7
)
≥≥7 8
)
≥≥8 9
{
¥¥ 
person
µµ 
.
µµ 
name
µµ 
=
µµ  !
employeeControl
µµ" 1
.
µµ1 2
name
µµ2 6
;
µµ6 7
person
∂∂ 
.
∂∂ 
lastname
∂∂ #
=
∂∂$ %
employeeControl
∂∂& 5
.
∂∂5 6
lastname
∂∂6 >
;
∂∂> ?
context
∑∑ 
.
∑∑ 
Entry
∑∑ !
(
∑∑! "
person
∑∑" (
)
∑∑( )
.
∑∑) *
State
∑∑* /
=
∑∑0 1
System
∑∑2 8
.
∑∑8 9
Data
∑∑9 =
.
∑∑= >
Entity
∑∑> D
.
∑∑D E
EntityState
∑∑E P
.
∑∑P Q
Modified
∑∑Q Y
;
∑∑Y Z
context
∏∏ 
.
∏∏ 
SaveChanges
∏∏ '
(
∏∏' (
)
∏∏( )
;
∏∏) *
}
ππ 
using
∫∫ 
(
∫∫ 
dbModels
∫∫ 
context
∫∫  '
=
∫∫( )
new
∫∫* -
dbModels
∫∫. 6
(
∫∫6 7
)
∫∫7 8
)
∫∫8 9
{
ªª 
user
ºº 
.
ºº 
email
ºº 
=
ºº  
employeeControl
ºº! 0
.
ºº0 1
email
ºº1 6
.
ºº6 7
ToLower
ºº7 >
(
ºº> ?
)
ºº? @
.
ºº@ A
Trim
ººA E
(
ººE F
)
ººF G
;
ººG H
context
ΩΩ 
.
ΩΩ 
Entry
ΩΩ !
(
ΩΩ! "
user
ΩΩ" &
)
ΩΩ& '
.
ΩΩ' (
State
ΩΩ( -
=
ΩΩ. /
System
ΩΩ0 6
.
ΩΩ6 7
Data
ΩΩ7 ;
.
ΩΩ; <
Entity
ΩΩ< B
.
ΩΩB C
EntityState
ΩΩC N
.
ΩΩN O
Modified
ΩΩO W
;
ΩΩW X
context
ææ 
.
ææ 
SaveChanges
ææ '
(
ææ' (
)
ææ( )
;
ææ) *
}
øø 
using
¿¿ 
(
¿¿ 
dbModels
¿¿ 
context
¿¿  '
=
¿¿( )
new
¿¿* -
dbModels
¿¿. 6
(
¿¿6 7
)
¿¿7 8
)
¿¿8 9
{
¡¡ 
employee
¬¬ 
.
¬¬ 
salary
¬¬ #
=
¬¬$ %
employeeControl
¬¬& 5
.
¬¬5 6
salary
¬¬6 <
;
¬¬< =
context
√√ 
.
√√ 
Entry
√√ !
(
√√! "
employee
√√" *
)
√√* +
.
√√+ ,
State
√√, 1
=
√√2 3
System
√√4 :
.
√√: ;
Data
√√; ?
.
√√? @
Entity
√√@ F
.
√√F G
EntityState
√√G R
.
√√R S
Modified
√√S [
;
√√[ \
context
ƒƒ 
.
ƒƒ 
SaveChanges
ƒƒ '
(
ƒƒ' (
)
ƒƒ( )
;
ƒƒ) *
}
≈≈ 
Session
∆∆ 
[
∆∆ 
$str
∆∆ -
]
∆∆- .
=
∆∆/ 0
null
∆∆1 5
;
∆∆5 6
Session
∆∆7 >
[
∆∆> ?
$str
∆∆? S
]
∆∆S T
=
∆∆U V
null
∆∆W [
;
∆∆[ \
Session
∆∆] d
[
∆∆d e
$str
∆∆e v
]
∆∆v w
=
∆∆x y
null
∆∆z ~
;
∆∆~ 
return
«« 
RedirectToAction
«« '
(
««' (
$str
««( /
)
««/ 0
;
««0 1
}
»» 
catch
…… 
(
…… 
	Exception
…… 
)
…… 
{
   
return
ÀÀ 
RedirectToAction
ÀÀ '
(
ÀÀ' (
$str
ÀÀ( /
,
ÀÀ/ 0
$str
ÀÀ1 7
)
ÀÀ7 8
;
ÀÀ8 9
}
ÃÃ 
}
ÕÕ 	
public
œœ 
ActionResult
œœ 
DeleteChofer
œœ (
(
œœ( )
string
œœ) /
id
œœ0 2
)
œœ2 3
{
–– 	
try
—— 
{
““ 
Login
”” 
logi
”” 
=
”” 
new
””  
Login
””! &
(
””& '
)
””' (
;
””( )
var
‘‘ 

authResult
‘‘ 
=
‘‘   
AutenticarPasosRol
‘‘! 3
(
‘‘3 4
$num
‘‘4 5
)
‘‘5 6
;
‘‘6 7
if
’’ 
(
’’ 

authResult
’’ 
!=
’’ !
null
’’" &
)
’’& '
return
’’( .

authResult
’’/ 9
;
’’9 :
Employee
÷÷ 
employee
÷÷ !
=
÷÷" #
new
÷÷$ '
Employee
÷÷( 0
(
÷÷0 1
)
÷÷1 2
;
÷÷2 3
using
◊◊ 
(
◊◊ 
dbModels
◊◊ 
context
◊◊  '
=
◊◊( )
new
◊◊* -
dbModels
◊◊. 6
(
◊◊6 7
)
◊◊7 8
)
◊◊8 9
employee
◊◊: B
=
◊◊C D
context
◊◊E L
.
◊◊L M
Employee
◊◊M U
.
◊◊U V
Where
◊◊V [
(
◊◊[ \
x
◊◊\ ]
=>
◊◊^ `
x
◊◊a b
.
◊◊b c

idEmployee
◊◊c m
.
◊◊m n
ToString
◊◊n v
(
◊◊v w
)
◊◊w x
==
◊◊y {
id
◊◊| ~
)
◊◊~ 
.◊◊ Ä
FirstOrDefault◊◊Ä é
(◊◊é è
)◊◊è ê
;◊◊ê ë
Person
ÿÿ 
person
ÿÿ 
=
ÿÿ 
new
ÿÿ  #
Person
ÿÿ$ *
(
ÿÿ* +
)
ÿÿ+ ,
;
ÿÿ, -
using
ŸŸ 
(
ŸŸ 
dbModels
ŸŸ 
context
ŸŸ  '
=
ŸŸ( )
new
ŸŸ* -
dbModels
ŸŸ. 6
(
ŸŸ6 7
)
ŸŸ7 8
)
ŸŸ8 9
person
ŸŸ: @
=
ŸŸA B
context
ŸŸC J
.
ŸŸJ K
Person
ŸŸK Q
.
ŸŸQ R
Where
ŸŸR W
(
ŸŸW X
x
ŸŸX Y
=>
ŸŸZ \
x
ŸŸ] ^
.
ŸŸ^ _
nit
ŸŸ_ b
.
ŸŸb c
ToString
ŸŸc k
(
ŸŸk l
)
ŸŸl m
==
ŸŸn p
id
ŸŸq s
)
ŸŸs t
.
ŸŸt u
FirstOrDefaultŸŸu É
(ŸŸÉ Ñ
)ŸŸÑ Ö
;ŸŸÖ Ü
using
⁄⁄ 
(
⁄⁄ 
dbModels
⁄⁄ 
context
⁄⁄  '
=
⁄⁄( )
new
⁄⁄* -
dbModels
⁄⁄. 6
(
⁄⁄6 7
)
⁄⁄7 8
)
⁄⁄8 9
{
€€ 
employee
‹‹ 
.
‹‹ 
status
‹‹ #
=
‹‹$ %
$num
‹‹& '
;
‹‹' (
employee
›› 
.
›› 
plate
›› "
=
››# $
null
››% )
;
››) *
context
ﬁﬁ 
.
ﬁﬁ 
Entry
ﬁﬁ !
(
ﬁﬁ! "
employee
ﬁﬁ" *
)
ﬁﬁ* +
.
ﬁﬁ+ ,
State
ﬁﬁ, 1
=
ﬁﬁ2 3
System
ﬁﬁ4 :
.
ﬁﬁ: ;
Data
ﬁﬁ; ?
.
ﬁﬁ? @
Entity
ﬁﬁ@ F
.
ﬁﬁF G
EntityState
ﬁﬁG R
.
ﬁﬁR S
Modified
ﬁﬁS [
;
ﬁﬁ[ \
context
ﬂﬂ 
.
ﬂﬂ 
SaveChanges
ﬂﬂ '
(
ﬂﬂ' (
)
ﬂﬂ( )
;
ﬂﬂ) *
}
‡‡ 
List
·· 
<
·· 
Owner
·· 
>
·· 
owners
·· "
=
··# $
new
··% (
List
··) -
<
··- .
Owner
··. 3
>
··3 4
(
··4 5
)
··5 6
;
··6 7
using
‚‚ 
(
‚‚ 
dbModels
‚‚ 
context
‚‚  '
=
‚‚( )
new
‚‚* -
dbModels
‚‚. 6
(
‚‚6 7
)
‚‚7 8
)
‚‚8 9
owners
‚‚: @
=
‚‚A B
context
‚‚C J
.
‚‚J K
Owner
‚‚K P
.
‚‚P Q
Where
‚‚Q V
(
‚‚V W
x
‚‚W X
=>
‚‚Y [
x
‚‚\ ]
.
‚‚] ^
idPerson
‚‚^ f
.
‚‚f g
ToString
‚‚g o
(
‚‚o p
)
‚‚p q
==
‚‚r t
id
‚‚u w
)
‚‚w x
.
‚‚x y
ToList
‚‚y 
(‚‚ Ä
)‚‚Ä Å
;‚‚Å Ç
if
„„ 
(
„„ 
owners
„„ 
.
„„ 
Count
„„  
>
„„! "
$num
„„# $
)
„„$ %
using
‰‰ 
(
‰‰ 
dbModels
‰‰ #
context
‰‰$ +
=
‰‰, -
new
‰‰. 1
dbModels
‰‰2 :
(
‰‰: ;
)
‰‰; <
)
‰‰< =
{
ÂÂ 
person
ÊÊ 
.
ÊÊ 
status
ÊÊ %
=
ÊÊ& '
$num
ÊÊ( )
;
ÊÊ) *
person
ÁÁ 
.
ÁÁ 
idRole
ÁÁ %
=
ÁÁ& '
$num
ÁÁ( )
;
ÁÁ) *
context
ËË 
.
ËË  
Entry
ËË  %
(
ËË% &
person
ËË& ,
)
ËË, -
.
ËË- .
State
ËË. 3
=
ËË4 5
System
ËË6 <
.
ËË< =
Data
ËË= A
.
ËËA B
Entity
ËËB H
.
ËËH I
EntityState
ËËI T
.
ËËT U
Modified
ËËU ]
;
ËË] ^
context
ÈÈ 
.
ÈÈ  
SaveChanges
ÈÈ  +
(
ÈÈ+ ,
)
ÈÈ, -
;
ÈÈ- .
}
ÍÍ 
else
ÎÎ 
using
ÏÏ 
(
ÏÏ 
dbModels
ÏÏ #
context
ÏÏ$ +
=
ÏÏ, -
new
ÏÏ. 1
dbModels
ÏÏ2 :
(
ÏÏ: ;
)
ÏÏ; <
)
ÏÏ< =
{
ÌÌ 
person
ÓÓ 
.
ÓÓ 
status
ÓÓ %
=
ÓÓ& '
$num
ÓÓ( )
;
ÓÓ) *
person
ÔÔ 
.
ÔÔ 
idRole
ÔÔ %
=
ÔÔ& '
$num
ÔÔ( )
;
ÔÔ) *
context
 
.
  
Entry
  %
(
% &
person
& ,
)
, -
.
- .
State
. 3
=
4 5
System
6 <
.
< =
Data
= A
.
A B
Entity
B H
.
H I
EntityState
I T
.
T U
Modified
U ]
;
] ^
context
ÒÒ 
.
ÒÒ  
SaveChanges
ÒÒ  +
(
ÒÒ+ ,
)
ÒÒ, -
;
ÒÒ- .
}
ÚÚ 
using
ÛÛ 
(
ÛÛ 
dbModels
ÛÛ 
context
ÛÛ  '
=
ÛÛ( )
new
ÛÛ* -
dbModels
ÛÛ. 6
(
ÛÛ6 7
)
ÛÛ7 8
)
ÛÛ8 9
{
ÙÙ 
User
ıı 
user
ıı 
=
ıı 
context
ıı  '
.
ıı' (
User
ıı( ,
.
ıı, -
Where
ıı- 2
(
ıı2 3
x
ıı3 4
=>
ıı5 7
x
ıı8 9
.
ıı9 :

idEmployee
ıı: D
.
ııD E
ToString
ııE M
(
ııM N
)
ııN O
==
ııP R
id
ııS U
)
ııU V
.
ııV W
FirstOrDefault
ııW e
(
ııe f
)
ııf g
;
ııg h
context
ˆˆ 
.
ˆˆ 
User
ˆˆ  
.
ˆˆ  !
Remove
ˆˆ! '
(
ˆˆ' (
user
ˆˆ( ,
)
ˆˆ, -
;
ˆˆ- .
context
ˆˆ/ 6
.
ˆˆ6 7
SaveChanges
ˆˆ7 B
(
ˆˆB C
)
ˆˆC D
;
ˆˆD E
}
˜˜ 
return
¯¯ 
RedirectToAction
¯¯ '
(
¯¯' (
$str
¯¯( /
)
¯¯/ 0
;
¯¯0 1
}
˘˘ 
catch
˙˙ 
(
˙˙ 
	Exception
˙˙ 
)
˙˙ 
{
˚˚ 
return
¸¸ 
RedirectToAction
¸¸ '
(
¸¸' (
$str
¸¸( /
,
¸¸/ 0
$str
¸¸1 7
)
¸¸7 8
;
¸¸8 9
}
˝˝ 
}
˛˛ 	
public
ˇˇ 
ActionResult
ˇˇ 
DeleteControlador
ˇˇ -
(
ˇˇ- .
string
ˇˇ. 4
id
ˇˇ5 7
)
ˇˇ7 8
{
ÄÄ 	
try
ÅÅ 
{
ÇÇ 
Login
ÉÉ 
logi
ÉÉ 
=
ÉÉ 
new
ÉÉ  
Login
ÉÉ! &
(
ÉÉ& '
)
ÉÉ' (
;
ÉÉ( )
var
ÑÑ 

authResult
ÑÑ 
=
ÑÑ   
AutenticarPasosRol
ÑÑ! 3
(
ÑÑ3 4
$num
ÑÑ4 5
)
ÑÑ5 6
;
ÑÑ6 7
if
ÖÖ 
(
ÖÖ 

authResult
ÖÖ 
!=
ÖÖ !
null
ÖÖ" &
)
ÖÖ& '
return
ÖÖ( .

authResult
ÖÖ/ 9
;
ÖÖ9 :
List
ÜÜ 
<
ÜÜ 
Owner
ÜÜ 
>
ÜÜ 
owners
ÜÜ "
=
ÜÜ# $
new
ÜÜ% (
List
ÜÜ) -
<
ÜÜ- .
Owner
ÜÜ. 3
>
ÜÜ3 4
(
ÜÜ4 5
)
ÜÜ5 6
;
ÜÜ6 7
using
áá 
(
áá 
dbModels
áá 
context
áá  '
=
áá( )
new
áá* -
dbModels
áá. 6
(
áá6 7
)
áá7 8
)
áá8 9
owners
áá: @
=
ááA B
context
ááC J
.
ááJ K
Owner
ááK P
.
ááP Q
Where
ááQ V
(
ááV W
x
ááW X
=>
ááY [
x
áá\ ]
.
áá] ^
idPerson
áá^ f
.
ááf g
ToString
áág o
(
ááo p
)
ááp q
==
áár t
id
ááu w
)
ááw x
.
ááx y
ToList
ááy 
(áá Ä
)ááÄ Å
;ááÅ Ç
using
àà 
(
àà 
dbModels
àà 
context
àà  '
=
àà( )
new
àà* -
dbModels
àà. 6
(
àà6 7
)
àà7 8
)
àà8 9
{
ââ 
Employee
ää 
employee
ää %
=
ää& '
context
ää( /
.
ää/ 0
Employee
ää0 8
.
ää8 9
Where
ää9 >
(
ää> ?
x
ää? @
=>
ääA C
x
ääD E
.
ääE F

idEmployee
ääF P
.
ääP Q
ToString
ääQ Y
(
ääY Z
)
ääZ [
==
ää\ ^
id
ää_ a
)
ääa b
.
ääb c
FirstOrDefault
ääc q
(
ääq r
)
äär s
;
ääs t
employee
ãã 
.
ãã 
status
ãã #
=
ãã$ %
$num
ãã& '
;
ãã' (
context
åå 
.
åå 
Entry
åå !
(
åå! "
employee
åå" *
)
åå* +
.
åå+ ,
State
åå, 1
=
åå2 3
System
åå4 :
.
åå: ;
Data
åå; ?
.
åå? @
Entity
åå@ F
.
ååF G
EntityState
ååG R
.
ååR S
Modified
ååS [
;
åå[ \
context
çç 
.
çç 
SaveChanges
çç '
(
çç' (
)
çç( )
;
çç) *
}
éé 
using
èè 
(
èè 
dbModels
èè 
context
èè  '
=
èè( )
new
èè* -
dbModels
èè. 6
(
èè6 7
)
èè7 8
)
èè8 9
{
êê 
Person
ëë 
person
ëë !
=
ëë" #
context
ëë$ +
.
ëë+ ,
Person
ëë, 2
.
ëë2 3
Where
ëë3 8
(
ëë8 9
x
ëë9 :
=>
ëë; =
x
ëë> ?
.
ëë? @
nit
ëë@ C
.
ëëC D
ToString
ëëD L
(
ëëL M
)
ëëM N
==
ëëO Q
id
ëëR T
)
ëëT U
.
ëëU V
FirstOrDefault
ëëV d
(
ëëd e
)
ëëe f
;
ëëf g
if
íí 
(
íí 
owners
íí 
.
íí 
Count
íí $
>
íí% &
$num
íí' (
)
íí( )
person
íí* 0
.
íí0 1
status
íí1 7
=
íí8 9
$num
íí: ;
;
íí; <
else
ìì 
person
ìì 
.
ìì  
status
ìì  &
=
ìì' (
$num
ìì) *
;
ìì* +
person
îî 
.
îî 
idRole
îî !
=
îî" #
$num
îî$ %
;
îî% &
context
ïï 
.
ïï 
Entry
ïï !
(
ïï! "
person
ïï" (
)
ïï( )
.
ïï) *
State
ïï* /
=
ïï0 1
System
ïï2 8
.
ïï8 9
Data
ïï9 =
.
ïï= >
Entity
ïï> D
.
ïïD E
EntityState
ïïE P
.
ïïP Q
Modified
ïïQ Y
;
ïïY Z
context
ïï[ b
.
ïïb c
SaveChanges
ïïc n
(
ïïn o
)
ïïo p
;
ïïp q
}
ññ 
using
óó 
(
óó 
dbModels
óó 
context
óó  '
=
óó( )
new
óó* -
dbModels
óó. 6
(
óó6 7
)
óó7 8
)
óó8 9
{
òò 
User
ôô 
user
ôô 
=
ôô 
context
ôô  '
.
ôô' (
User
ôô( ,
.
ôô, -
Where
ôô- 2
(
ôô2 3
x
ôô3 4
=>
ôô5 7
x
ôô8 9
.
ôô9 :

idEmployee
ôô: D
.
ôôD E
ToString
ôôE M
(
ôôM N
)
ôôN O
==
ôôP R
id
ôôS U
)
ôôU V
.
ôôV W
FirstOrDefault
ôôW e
(
ôôe f
)
ôôf g
;
ôôg h
context
öö 
.
öö 
User
öö  
.
öö  !
Remove
öö! '
(
öö' (
user
öö( ,
)
öö, -
;
öö- .
context
öö/ 6
.
öö6 7
SaveChanges
öö7 B
(
ööB C
)
ööC D
;
ööD E
}
õõ 
using
úú 
(
úú 
dbModels
úú 
context
úú  '
=
úú( )
new
úú* -
dbModels
úú. 6
(
úú6 7
)
úú7 8
)
úú8 9
{
ùù 
List
ûû 
<
ûû 

Checkpoint
ûû #
>
ûû# $

checkpoint
ûû% /
=
ûû/ 0
context
ûû1 8
.
ûû8 9

Checkpoint
ûû9 C
.
ûûC D
Where
ûûD I
(
ûûI J
x
ûûJ K
=>
ûûL N
x
ûûO P
.
ûûP Q

idEmployee
ûûQ [
.
ûû[ \
ToString
ûû\ d
(
ûûd e
)
ûûe f
==
ûûg i
id
ûûj l
)
ûûl m
.
ûûm n
ToList
ûûn t
(
ûût u
)
ûûu v
;
ûûv w
if
üü 
(
üü 

checkpoint
üü "
!=
üü# %
null
üü& *
)
üü* +
{
†† 
foreach
°° 
(
°°  !
var
°°! $
item
°°% )
in
°°* ,

checkpoint
°°- 7
)
°°7 8
{
¢¢ 

Checkpoint
££ &
check
££' ,
=
££- .
context
££/ 6
.
££6 7

Checkpoint
££7 A
.
££A B
Where
££B G
(
££G H
x
££H I
=>
££J L
x
££M N
.
££N O
idCheckpoint
££O [
==
££\ ^
item
££_ c
.
££c d
idCheckpoint
££d p
)
££p q
.
££q r
FirstOrDefault££r Ä
(££Ä Å
)££Å Ç
;££Ç É
check
§§ !
.
§§! "

idEmployee
§§" ,
=
§§- .
null
§§/ 3
;
§§3 4
context
•• #
.
••# $
Entry
••$ )
(
••) *
check
••* /
)
••/ 0
.
••0 1
State
••1 6
=
••7 8
System
••9 ?
.
••? @
Data
••@ D
.
••D E
Entity
••E K
.
••K L
EntityState
••L W
.
••W X
Modified
••X `
;
••` a
context
••b i
.
••i j
SaveChanges
••j u
(
••u v
)
••v w
;
••w x
}
¶¶ 
}
®® 
}
©© 
return
™™ 
RedirectToAction
™™ '
(
™™' (
$str
™™( /
)
™™/ 0
;
™™0 1
}
´´ 
catch
¨¨ 
(
¨¨ 
	Exception
¨¨ 
)
¨¨ 
{
≠≠ 
return
ÆÆ 
RedirectToAction
ÆÆ '
(
ÆÆ' (
$str
ÆÆ( /
,
ÆÆ/ 0
$str
ÆÆ1 7
)
ÆÆ7 8
;
ÆÆ8 9
}
ØØ 
}
∞∞ 	
public
±± 
ActionResult
±± 
CheckpointDelete
±± ,
(
±±, -
string
±±- 3
id
±±4 6
)
±±6 7
{
≤≤ 	
try
≥≥ 
{
¥¥ 
Login
µµ 
logi
µµ 
=
µµ 
new
µµ  
Login
µµ! &
(
µµ& '
)
µµ' (
;
µµ( )
var
∂∂ 

authResult
∂∂ 
=
∂∂   
AutenticarPasosRol
∂∂! 3
(
∂∂3 4
$num
∂∂4 5
)
∂∂5 6
;
∂∂6 7
if
∑∑ 
(
∑∑ 

authResult
∑∑ 
!=
∑∑ !
null
∑∑" &
)
∑∑& '
return
∑∑( .

authResult
∑∑/ 9
;
∑∑9 :
using
∏∏ 
(
∏∏ 
dbModels
∏∏ 
context
∏∏  '
=
∏∏( )
new
∏∏* -
dbModels
∏∏. 6
(
∏∏6 7
)
∏∏7 8
)
∏∏8 9
{
ππ 

Checkpoint
∫∫ 

checkpoint
∫∫ )
=
∫∫* +
context
∫∫, 3
.
∫∫3 4

Checkpoint
∫∫4 >
.
∫∫> ?
Where
∫∫? D
(
∫∫D E
x
∫∫E F
=>
∫∫G I
x
∫∫J K
.
∫∫K L

idEmployee
∫∫L V
.
∫∫V W
ToString
∫∫W _
(
∫∫_ `
)
∫∫` a
==
∫∫b d
id
∫∫e g
)
∫∫g h
.
∫∫h i
FirstOrDefault
∫∫i w
(
∫∫w x
)
∫∫x y
;
∫∫y z

checkpoint
ªª 
.
ªª 

idEmployee
ªª )
=
ªª* +
null
ªª, 0
;
ªª0 1
context
ºº 
.
ºº 
Entry
ºº !
(
ºº! "

checkpoint
ºº" ,
)
ºº, -
.
ºº- .
State
ºº. 3
=
ºº4 5
System
ºº6 <
.
ºº< =
Data
ºº= A
.
ººA B
Entity
ººB H
.
ººH I
EntityState
ººI T
.
ººT U
Modified
ººU ]
;
ºº] ^
context
ΩΩ 
.
ΩΩ 
SaveChanges
ΩΩ '
(
ΩΩ' (
)
ΩΩ( )
;
ΩΩ) *
}
ææ 
return
øø 
RedirectToAction
øø '
(
øø' (
$str
øø( /
)
øø/ 0
;
øø0 1
}
¿¿ 
catch
¡¡ 
(
¡¡ 
	Exception
¡¡ 
)
¡¡ 
{
¬¬ 
return
√√ 
RedirectToAction
√√ '
(
√√' (
$str
√√( /
,
√√/ 0
$str
√√1 7
)
√√7 8
;
√√8 9
}
ƒƒ 
}
≈≈ 	
public
∆∆ 
ActionResult
∆∆ 
AddCheckpoint
∆∆ )
(
∆∆) *
string
∆∆* 0
id
∆∆1 3
)
∆∆3 4
{
«« 	
try
»» 
{
…… 
Login
   
logi
   
=
   
new
    
Login
  ! &
(
  & '
)
  ' (
;
  ( )
var
ÀÀ 

authResult
ÀÀ 
=
ÀÀ   
AutenticarPasosRol
ÀÀ! 3
(
ÀÀ3 4
$num
ÀÀ4 5
)
ÀÀ5 6
;
ÀÀ6 7
if
ÃÃ 
(
ÃÃ 

authResult
ÃÃ 
!=
ÃÃ !
null
ÃÃ" &
)
ÃÃ& '
return
ÃÃ( .

authResult
ÃÃ/ 9
;
ÃÃ9 :
string
ÕÕ 
Linea
ÕÕ 
=
ÕÕ 
logi
ÕÕ #
.
ÕÕ# $ 
GetLineaFromCookie
ÕÕ$ 6
(
ÕÕ6 7
Request
ÕÕ7 >
)
ÕÕ> ?
.
ÕÕ? @
ToString
ÕÕ@ H
(
ÕÕH I
)
ÕÕI J
;
ÕÕJ K
Session
ŒŒ 
[
ŒŒ 
$str
ŒŒ /
]
ŒŒ/ 0
=
ŒŒ1 2
id
ŒŒ3 5
;
ŒŒ5 6
List
œœ 
<
œœ 

Checkpoint
œœ 
>
œœ  

checkpoint
œœ! +
=
œœ, -
new
œœ. 1
List
œœ2 6
<
œœ6 7

Checkpoint
œœ7 A
>
œœA B
(
œœB C
)
œœC D
;
œœD E
using
–– 
(
–– 
dbModels
–– 
context
––  '
=
––( )
new
––* -
dbModels
––. 6
(
––6 7
)
––7 8
)
––8 9

checkpoint
—— 
=
——  
context
——! (
.
——( )

Checkpoint
——) 3
.
——3 4
Where
——4 9
(
——9 :
x
——: ;
=>
——< >
x
——? @
.
——@ A
idLine
——A G
==
——H J
Linea
——K P
&&
——Q S
x
——T U
.
——U V

idEmployee
——V `
==
——a c
null
——d h
&&
——i k
x
——l m
.
——m n
status
——n t
!=
——u w
$num
——x y
)
——y z
.
——z {
ToList——{ Å
(——Å Ç
)——Ç É
;——É Ñ
if
““ 
(
““ 

checkpoint
““ 
==
““ !
null
““" &
)
““& '
return
““( .
RedirectToAction
““/ ?
(
““? @
$str
““@ O
,
““O P
$str
““Q X
)
““X Y
;
““Y Z
ViewBag
”” 
.
”” 
idCheckpoint
”” $
=
””% &
new
””' *

SelectList
””+ 5
(
””5 6

checkpoint
””6 @
,
””@ A
$str
””B P
,
””P Q
$str
””R _
)
””_ `
;
””` a
return
‘‘ 
View
‘‘ 
(
‘‘ 
)
‘‘ 
;
‘‘ 
}
’’ 
catch
÷÷ 
(
÷÷ 
	Exception
÷÷ 
)
÷÷ 
{
◊◊ 
return
ÿÿ 
RedirectToAction
ÿÿ '
(
ÿÿ' (
$str
ÿÿ( /
,
ÿÿ/ 0
$str
ÿÿ1 7
)
ÿÿ7 8
;
ÿÿ8 9
}
ŸŸ 
}
⁄⁄ 	
[
€€ 	
HttpPost
€€	 
]
€€ 
public
‹‹ 
ActionResult
‹‹ 
AddCheckpoint
‹‹ )
(
‹‹) *
EmployeeControl
‹‹* 9
employeeControl
‹‹: I
)
‹‹I J
{
›› 	
try
ﬁﬁ 
{
ﬂﬂ 
Login
‡‡ 
logi
‡‡ 
=
‡‡ 
new
‡‡  
Login
‡‡! &
(
‡‡& '
)
‡‡' (
;
‡‡( )
var
·· 

authResult
·· 
=
··   
AutenticarPasosRol
··! 3
(
··3 4
$num
··4 5
)
··5 6
;
··6 7
if
‚‚ 
(
‚‚ 

authResult
‚‚ 
!=
‚‚ !
null
‚‚" &
)
‚‚& '
return
‚‚( .

authResult
‚‚/ 9
;
‚‚9 :
string
„„ 
Linea
„„ 
=
„„ 
logi
„„ #
.
„„# $ 
GetLineaFromCookie
„„$ 6
(
„„6 7
Request
„„7 >
)
„„> ?
.
„„? @
ToString
„„@ H
(
„„H I
)
„„I J
;
„„J K
string
‰‰ 
ControlEmployee
‰‰ &
=
‰‰' (
Session
‰‰) 0
[
‰‰0 1
$str
‰‰1 H
]
‰‰H I
.
‰‰I J
ToString
‰‰J R
(
‰‰R S
)
‰‰S T
;
‰‰T U
List
ÂÂ 
<
ÂÂ 

Checkpoint
ÂÂ 
>
ÂÂ  

checkpoint
ÂÂ! +
=
ÂÂ, -
new
ÂÂ. 1
List
ÂÂ2 6
<
ÂÂ6 7

Checkpoint
ÂÂ7 A
>
ÂÂA B
(
ÂÂB C
)
ÂÂC D
;
ÂÂD E
using
ÊÊ 
(
ÊÊ 
dbModels
ÊÊ 
context
ÊÊ  '
=
ÊÊ( )
new
ÊÊ* -
dbModels
ÊÊ. 6
(
ÊÊ6 7
)
ÊÊ7 8
)
ÊÊ8 9

checkpoint
ÁÁ 
=
ÁÁ  
context
ÁÁ! (
.
ÁÁ( )

Checkpoint
ÁÁ) 3
.
ÁÁ3 4
Where
ÁÁ4 9
(
ÁÁ9 :
x
ÁÁ: ;
=>
ÁÁ< >
x
ÁÁ? @
.
ÁÁ@ A
idLine
ÁÁA G
==
ÁÁH J
Linea
ÁÁK P
&&
ÁÁQ S
x
ÁÁT U
.
ÁÁU V

idEmployee
ÁÁV `
==
ÁÁa c
null
ÁÁd h
&&
ÁÁi k
x
ÁÁl m
.
ÁÁm n
status
ÁÁn t
!=
ÁÁu w
$num
ÁÁx y
)
ÁÁy z
.
ÁÁz {
ToListÁÁ{ Å
(ÁÁÅ Ç
)ÁÁÇ É
;ÁÁÉ Ñ
if
ËË 
(
ËË 

checkpoint
ËË 
==
ËË !
null
ËË" &
)
ËË& '
return
ËË( .
RedirectToAction
ËË/ ?
(
ËË? @
$str
ËË@ O
,
ËËO P
$str
ËËQ X
)
ËËX Y
;
ËËY Z
ViewBag
ÈÈ 
.
ÈÈ 
idCheckpoint
ÈÈ $
=
ÈÈ% &
new
ÈÈ' *

SelectList
ÈÈ+ 5
(
ÈÈ5 6

checkpoint
ÈÈ6 @
,
ÈÈ@ A
$str
ÈÈB P
,
ÈÈP Q
$str
ÈÈR _
)
ÈÈ_ `
;
ÈÈ` a
using
ÍÍ 
(
ÍÍ 
dbModels
ÍÍ 
context
ÍÍ  '
=
ÍÍ( )
new
ÍÍ* -
dbModels
ÍÍ. 6
(
ÍÍ6 7
)
ÍÍ7 8
)
ÍÍ8 9
{
ÎÎ 

Checkpoint
ÏÏ 
c
ÏÏ  
=
ÏÏ! "
context
ÏÏ# *
.
ÏÏ* +

Checkpoint
ÏÏ+ 5
.
ÏÏ5 6
Where
ÏÏ6 ;
(
ÏÏ; <
x
ÏÏ< =
=>
ÏÏ> @
x
ÏÏA B
.
ÏÏB C
idCheckpoint
ÏÏC O
==
ÏÏP R
employeeControl
ÏÏS b
.
ÏÏb c
idCheckpoint
ÏÏc o
)
ÏÏo p
.
ÏÏp q
FirstOrDefault
ÏÏq 
(ÏÏ Ä
)ÏÏÄ Å
;ÏÏÅ Ç
c
ÌÌ 
.
ÌÌ 

idEmployee
ÌÌ  
=
ÌÌ! "
ControlEmployee
ÌÌ# 2
;
ÌÌ2 3
context
ÓÓ 
.
ÓÓ 
Entry
ÓÓ !
(
ÓÓ! "
c
ÓÓ" #
)
ÓÓ# $
.
ÓÓ$ %
State
ÓÓ% *
=
ÓÓ+ ,
System
ÓÓ- 3
.
ÓÓ3 4
Data
ÓÓ4 8
.
ÓÓ8 9
Entity
ÓÓ9 ?
.
ÓÓ? @
EntityState
ÓÓ@ K
.
ÓÓK L
Modified
ÓÓL T
;
ÓÓT U
context
ÔÔ 
.
ÔÔ 
SaveChanges
ÔÔ '
(
ÔÔ' (
)
ÔÔ( )
;
ÔÔ) *
}
 
Session
ÒÒ 
[
ÒÒ 
$str
ÒÒ /
]
ÒÒ/ 0
=
ÒÒ1 2
null
ÒÒ3 7
;
ÒÒ7 8
return
ÚÚ 
RedirectToAction
ÚÚ '
(
ÚÚ' (
$str
ÚÚ( /
)
ÚÚ/ 0
;
ÚÚ0 1
}
ÛÛ 
catch
ÙÙ 
(
ÙÙ 
	Exception
ÙÙ 
)
ÙÙ 
{
ıı 
return
ˆˆ 
RedirectToAction
ˆˆ '
(
ˆˆ' (
$str
ˆˆ( /
,
ˆˆ/ 0
$str
ˆˆ1 7
)
ˆˆ7 8
;
ˆˆ8 9
}
˜˜ 
}
¯¯ 	
public
˘˘ 
ActionResult
˘˘  
AutenticarPasosRol
˘˘ .
(
˘˘. /
int
˘˘/ 2
role
˘˘3 7
)
˘˘7 8
{
˙˙ 	
if
˚˚ 
(
˚˚ 
!
˚˚ 
User
˚˚ 
.
˚˚ 
Identity
˚˚ 
.
˚˚ 
IsAuthenticated
˚˚ .
)
˚˚. /
return
˚˚0 6
RedirectToAction
˚˚7 G
(
˚˚G H
$str
˚˚H O
,
˚˚O P
$str
˚˚Q W
)
˚˚W X
;
˚˚X Y
Login
¸¸ 
logi
¸¸ 
=
¸¸ 
new
¸¸ 
Login
¸¸ "
(
¸¸" #
)
¸¸# $
;
¸¸$ %
int
˝˝ 
?
˝˝ 
roleSession
˝˝ 
=
˝˝ 
logi
˝˝ #
.
˝˝# $&
GetRoleSessionFromCookie
˝˝$ <
(
˝˝< =
Request
˝˝= D
)
˝˝D E
;
˝˝E F
if
˛˛ 
(
˛˛ 
roleSession
˛˛ 
==
˛˛ 
null
˛˛ #
||
˛˛$ &
roleSession
˛˛' 2
!=
˛˛3 5
role
˛˛6 :
)
˛˛: ;
return
˛˛< B
RedirectToAction
˛˛C S
(
˛˛S T
$str
˛˛T [
,
˛˛[ \
$str
˛˛] c
)
˛˛c d
;
˛˛d e
return
ˇˇ 
null
ˇˇ 
;
ˇˇ 
}
ÄÄ 	
public
ÅÅ 
ActionResult
ÅÅ 
DriverQR
ÅÅ $
(
ÅÅ$ %
string
ÅÅ% +
placa
ÅÅ, 1
)
ÅÅ1 2
{
ÇÇ 	
ViewBag
ÉÉ 
.
ÉÉ 
PlacaChofer
ÉÉ 
=
ÉÉ  !
placa
ÉÉ" '
;
ÉÉ' (
return
ÑÑ 
View
ÑÑ 
(
ÑÑ 
)
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
public
áá 
ActionResult
áá 

GenerateQR
áá &
(
áá& '
string
áá' -
content
áá. 5
)
áá5 6
{
àà 	
using
ââ 
(
ââ 
MemoryStream
ââ 
ms
ââ  "
=
ââ# $
new
ââ% (
MemoryStream
ââ) 5
(
ââ5 6
)
ââ6 7
)
ââ7 8
{
ää 
QRCodeGenerator
ãã 
qrGenerator
ãã  +
=
ãã, -
new
ãã. 1
QRCodeGenerator
ãã2 A
(
ããA B
)
ããB C
;
ããC D

QRCodeData
åå 

qrCodeData
åå %
=
åå& '
qrGenerator
åå( 3
.
åå3 4
CreateQrCode
åå4 @
(
åå@ A
(
ååA B
$str
ååB q
+
åår s
content
ååt {
)
åå{ |
,
åå| }
QRCodeGeneratoråå~ ç
.ååç é
ECCLevelååé ñ
.ååñ ó
Qååó ò
)ååò ô
;ååô ö
QRCode
çç 
qrCode
çç 
=
çç 
new
çç  #
QRCode
çç$ *
(
çç* +

qrCodeData
çç+ 5
)
çç5 6
;
çç6 7
using
èè 
(
èè 
Bitmap
èè 
bitmap
èè $
=
èè% &
qrCode
èè' -
.
èè- .

GetGraphic
èè. 8
(
èè8 9
$num
èè9 ;
)
èè; <
)
èè< =
{
êê 
bitmap
ëë 
.
ëë 
Save
ëë 
(
ëë  
ms
ëë  "
,
ëë" #
ImageFormat
ëë$ /
.
ëë/ 0
Png
ëë0 3
)
ëë3 4
;
ëë4 5
return
íí 
File
íí 
(
íí  
ms
íí  "
.
íí" #
ToArray
íí# *
(
íí* +
)
íí+ ,
,
íí, -
$str
íí. 9
)
íí9 :
;
íí: ;
}
ìì 
}
îî 
}
ïï 	
public
óó 
ActionResult
óó 
PrintQRDiver
óó (
(
óó( )
string
óó) /
placa
óó0 5
)
óó5 6
{
òò 	
try
ôô 
{
öö 
TimeZoneInfo
õõ 
boliviaTimeZone
õõ ,
=
õõ- .
TimeZoneInfo
õõ/ ;
.
õõ; <$
FindSystemTimeZoneById
õõ< R
(
õõR S
$str
õõS m
)
õõm n
;
õõn o
DateTime
úú 
boliviaTime
úú $
=
úú% &
TimeZoneInfo
úú' 3
.
úú3 4
ConvertTime
úú4 ?
(
úú? @
DateTime
úú@ H
.
úúH I
UtcNow
úúI O
,
úúO P
boliviaTimeZone
úúQ `
)
úú` a
;
úúa b
return
ùù 
new
ùù 
ActionAsPdf
ùù &
(
ùù& '
$str
ùù' 1
,
ùù1 2
new
ùù3 6
{
ùù7 8
placa
ùù8 =
=
ùù> ?
placa
ùù@ E
}
ùùE F
)
ùùF G
{
ùùH I
FileName
ùùJ R
=
ùùS T
placa
ùùU Z
+
ùù[ \
$str
ùù] `
+
ùùa b
boliviaTime
ùùc n
.
ùùn o
Day
ùùo r
+
ùùs t
boliviaTimeùùu Ä
.ùùÄ Å
MonthùùÅ Ü
+ùùá à
boliviaTimeùùâ î
.ùùî ï
Yearùùï ô
+ùùö õ
$strùùú ¢
}ùù£ §
;ùù§ •
}
ûû 
catch
üü 
(
üü 
	Exception
üü 
)
üü 
{
†† 
return
°° 
RedirectToAction
°° '
(
°°' (
$str
°°( /
,
°°/ 0
$str
°°1 7
)
°°7 8
;
°°8 9
}
¢¢ 
}
££ 	
}
§§ 
}•• äË
NC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Controllers\ChoferController.cs
	namespace

 	#
ProyectoControlLineaBus


 !
.

! "
Controllers

" -
{ 
public 

class 
ChoferController !
:" #

Controller$ .
{ 
public 
ActionResult 
Index !
(! "
)" #
{ 	
Login 
logi 
= 
new 
Login "
(" #
)# $
;$ %
var 

authResult 
= 
AutenticarPasosRol /
(/ 0
$num0 1
)1 2
;2 3
if 
( 

authResult 
!= 
null "
)" #
return$ *

authResult+ 5
;5 6
return 
View 
( 
) 
; 
} 	
public 
ActionResult 

ListRoutes &
(& '
)' (
{ 	
Login 
logi 
= 
new 
Login "
(" #
)# $
;$ %
var 

authResult 
= 
AutenticarPasosRol /
(/ 0
$num0 1
)1 2
;2 3
if 
( 

authResult 
!= 
null "
)" #
return$ *

authResult+ 5
;5 6
string 
Line 
= 
logi 
. 
GetLineaFromCookie 1
(1 2
Request2 9
)9 :
.: ;
ToString; C
(C D
)D E
;E F
List 
< 
Route 
> 
routes 
=  
new! $
List% )
<) *
Route* /
>/ 0
(0 1
)1 2
;2 3
using 
( 
dbModels 
context #
=$ %
new& )
dbModels* 2
(2 3
)3 4
)4 5
{ 
routes   
=   
context    
.    !
Route  ! &
.  & '
Where  ' ,
(  , -
x  - .
=>  / 1
x  2 3
.  3 4
idLine  4 :
==  ; =
Line  > B
)  B C
.  C D
GroupBy  D K
(  K L
x  L M
=>  N P
x  Q R
.  R S
numTypeRoute  S _
)  _ `
.  ` a
Select  a g
(  g h
x  h i
=>  j l
x  m n
.  n o
FirstOrDefault  o }
(  } ~
)  ~ 
)	   Ä
.
  Ä Å
ToList
  Å á
(
  á à
)
  à â
;
  â ä
}!! 
return"" 
View"" 
("" 
routes"" 
)"" 
;""  
}## 	
public%% 
ActionResult%% 
	ViewRuta1%% %
(%%% &
int%%& )
numTypeRoute%%* 6
)%%6 7
{&& 	
try'' 
{(( 
Login)) 
logi)) 
=)) 
new))  
Login))! &
())& '
)))' (
;))( )
var** 

authResult** 
=**  
AutenticarPasosRol**! 3
(**3 4
$num**4 5
)**5 6
;**6 7
if++ 
(++ 

authResult++ 
!=++ !
null++" &
)++& '
return++( .

authResult++/ 9
;++9 :
string-- 
Line-- 
=-- 
logi-- "
.--" #
GetLineaFromCookie--# 5
(--5 6
Request--6 =
)--= >
.--> ?
ToString--? G
(--G H
)--H I
;--I J
List.. 
<.. 
MuestraRutasMapas.. &
>..& '
mapa..( ,
=..- .
new../ 2
List..3 7
<..7 8
MuestraRutasMapas..8 I
>..I J
(..J K
)..K L
;..L M
int// 
count// 
=// 
$num// 
;// 
for00 
(00 
int00 
i00 
=00 
$num00 
;00 
i00  !
<=00" $
$num00% &
;00& '
i00( )
++00) +
)00+ ,
{11 
MuestraRutasMapas22 %
muestraRutasMapas22& 7
=228 9
new22: =
MuestraRutasMapas22> O
{33 
ListRutasMostrar44 (
=44) *
new44+ .
List44/ 3
<443 4
RutasMostrar444 @
>44@ A
(44A B
)44B C
,44C D
ListParadasMostrar55 *
=55+ ,
new55- 0
List551 5
<555 6
ParadasMostrar556 D
>55D E
(55E F
)55F G
,55G H
ListBloqueosMostrar66 +
=66, -
new66. 1
List662 6
<666 7
BloqueosMostrar667 F
>66F G
(66G H
)66H I
,66I J

NumeroRuta77 "
=77# $
i77% &
}88 
;88 
List99 
<99 
BloqueosMostrar99 (
>99( )
nuevosBloqueos99* 8
=999 :
new99; >
List99? C
<99C D
BloqueosMostrar99D S
>99S T
(99T U
)99U V
;99V W
List:: 
<:: 
RutasMostrar:: %
>::% &
nuevasRutas::' 2
=::3 4
new::5 8
List::9 =
<::= >
RutasMostrar::> J
>::J K
(::K L
)::L M
;::M N
List;; 
<;; 
ParadasMostrar;; '
>;;' (
nuevasParadas;;) 6
=;;7 8
new;;9 <
List;;= A
<;;A B
ParadasMostrar;;B P
>;;P Q
(;;Q R
);;R S
;;;S T
using== 
(== 
dbModels== #
context==$ +
===, -
new==. 1
dbModels==2 :
(==: ;
)==; <
)==< =
{>> 
var?? 
checkpoints?? '
=??( )
context??* 1
.??1 2

Checkpoint??2 <
.??< =
Where??= B
(??B C
x??C D
=>??E G
x??H I
.??I J
idLine??J P
==??Q S
Line??T X
&&??Y [
x??\ ]
.??] ^
status??^ d
!=??e g
$num??h i
&&??j l
x??m n
.??n o
numberRoute??o z
==??{ }
numTypeRoute	??~ ä
)
??ä ã
.
??ã å
ToList
??å í
(
??í ì
)
??ì î
;
??î ï
var@@ 
routes@@ "
=@@# $
context@@% ,
.@@, -
Route@@- 2
.AA 
WhereAA "
(AA" #
xAA# $
=>AA% '
xAA( )
.AA) *
idLineAA* 0
==AA1 3
LineAA4 8
&&AA9 ;
xAA< =
.AA= >
numberRouteAA> I
==AAJ L
iAAM N
&&AAO Q
xAAR S
.AAS T
numTypeRouteAAT `
==AAa c
numTypeRouteAAd p
)AAp q
.BB 
ToListBB #
(BB# $
)BB$ %
;BB% &
varCC 
	deviationCC %
=CC& '
contextCC( /
.CC/ 0
DeviationRoteCC0 =
.CC= >
WhereCC> C
(CCC D
xCCD E
=>CCF H
xCCI J
.CCJ K
idLineCCK Q
==CCR T
LineCCU Y
&&CCZ \
xCC] ^
.CC^ _
numberRouteCC_ j
==CCk m
iCCn o
&&CCp r
xCCs t
.CCt u
numTypeRoute	CCu Å
==
CCÇ Ñ
numTypeRoute
CCÖ ë
)
CCë í
.
CCí ì
ToList
CCì ô
(
CCô ö
)
CCö õ
;
CCõ ú
ifDD 
(DD 
	deviationDD %
.DD% &
CountDD& +
>DD, -
$numDD. /
)DD/ 0
{EE 
foreachFF #
(FF$ %
varFF% (
itemFF) -
inFF. 0
	deviationFF1 :
)FF: ;
{GG 
ListHH  $
<HH$ %
RutasMostrarHH% 1
>HH1 2
listBloqueosHH3 ?
=HH@ A
newHHB E
ListHHF J
<HHJ K
RutasMostrarHHK W
>HHW X
(HHX Y
)HHY Z
;HHZ [
varII  #
route1II$ *
=II+ ,
routesII- 3
.II3 4
WhereII4 9
(II9 :
xII: ;
=>II< >
xII? @
.II@ A
idRouteIIA H
==III K
itemIIL P
.IIP Q
idRouteStartIIQ ]
&&II^ `
xIIa b
.IIb c
idLineIIc i
==IIj l
LineIIm q
)IIq r
.IIr s
FirstOrDefault	IIs Å
(
IIÅ Ç
)
IIÇ É
;
IIÉ Ñ
varJJ  #
route2JJ$ *
=JJ+ ,
routesJJ- 3
.JJ3 4
WhereJJ4 9
(JJ9 :
xJJ: ;
=>JJ< >
xJJ? @
.JJ@ A
idRouteJJA H
==JJI K
itemJJL P
.JJP Q

idRouteEndJJQ [
&&JJ\ ^
xJJ_ `
.JJ` a
idLineJJa g
==JJh j
LineJJk o
)JJo p
.JJp q
FirstOrDefaultJJq 
(	JJ Ä
)
JJÄ Å
;
JJÅ Ç
ifKK  "
(KK# $
route1KK$ *
!=KK+ -
nullKK. 2
&&KK3 5
route2KK6 <
!=KK= ?
nullKK@ D
)KKD E
{LL  !
varMM$ '
routesDeviationMM( 7
=MM8 9
routesMM: @
.MM@ A
WhereMMA F
(MMF G
xMMG H
=>MMI K
xMML M
.MMM N
numPointMMN V
>=MMW Y
route1MMZ `
.MM` a
numPointMMa i
&&MMj l
xMMm n
.MMn o
numPointMMo w
<=MMx z
route2	MM{ Å
.
MMÅ Ç
numPoint
MMÇ ä
&&
MMã ç
x
MMé è
.
MMè ê
idLine
MMê ñ
==
MMó ô
Line
MMö û
)
MMû ü
.
MMü †
ToList
MM† ¶
(
MM¶ ß
)
MMß ®
;
MM® ©
foreachNN$ +
(NN, -
varNN- 0
item2NN1 6
inNN7 9
routesDeviationNN: I
)NNI J
{OO$ %
listBloqueosPP( 4
.PP4 5
AddPP5 8
(PP8 9
newPP9 <
RutasMostrarPP= I
(PPI J
item2PPJ O
.PPO P
idRoutePPP W
,PPW X
item2PPY ^
.PP^ _
latitudPP_ f
,PPf g
item2PPh m
.PPm n
logintudPPn v
,PPv w
$strPPx z
,PPz {
item2	PP| Å
.
PPÅ Ç
status
PPÇ à
,
PPà â
(
PPä ã
int
PPã é
)
PPé è
item2
PPè î
.
PPî ï
numPoint
PPï ù
)
PPù û
)
PPû ü
;
PPü †
}QQ$ %
varRR$ '
place1RR( .
=RR/ 0
contextRR1 8
.RR8 9
PlaceRR9 >
.RR> ?
WhereRR? D
(RRD E
xRRE F
=>RRG I
xRRJ K
.RRK L
idPlaceRRL S
==RRT V
route1RRW ]
.RR] ^
idPlaceRR^ e
)RRe f
.RRf g
FirstOrDefaultRRg u
(RRu v
)RRv w
;RRw x
varSS$ '
place2SS( .
=SS/ 0
contextSS1 8
.SS8 9
PlaceSS9 >
.SS> ?
WhereSS? D
(SSD E
xSSE F
=>SSG I
xSSJ K
.SSK L
idPlaceSSL S
==SST V
route2SSW ]
.SS] ^
idPlaceSS^ e
)SSe f
.SSf g
FirstOrDefaultSSg u
(SSu v
)SSv w
;SSw x
nuevosBloqueosTT$ 2
.TT2 3
AddTT3 6
(TT6 7
newTT7 :
BloqueosMostrarTT; J
(TTJ K
itemTTK O
.TTO P
idDeviationTTP [
,TT[ \
$strTT] g
+TTh i
place1TTj p
.TTp q
descriptionTTq |
+TT} ~
$str	TT Ñ
+
TTÖ Ü
place2
TTá ç
.
TTç é
description
TTé ô
,
TTô ö
listBloqueos
TTõ ß
)
TTß ®
)
TT® ©
;
TT© ™
}UU  !
}VV 
}WW 
ifXX 
(XX 
routesXX "
.XX" #
CountXX# (
>XX) *
$numXX+ ,
)XX, -
{YY 
countZZ !
=ZZ" #
$numZZ$ %
;ZZ% &
foreach[[ #
([[$ %
var[[% (
item[[) -
in[[. 0
routes[[1 7
)[[7 8
{\\ 
count]]  %
++]]% '
;]]' (
Place^^  %
place^^& +
=^^, -
context^^. 5
.^^5 6
Place^^6 ;
.^^; <
FirstOrDefault^^< J
(^^J K
x^^K L
=>^^M O
x^^P Q
.^^Q R
idPlace^^R Y
==^^Z \
item^^] a
.^^a b
idPlace^^b i
)^^i j
;^^j k
if__  "
(__# $
place__$ )
!=__* ,
null__- 1
)__1 2
{``  !
nuevasRutasaa$ /
.aa/ 0
Addaa0 3
(aa3 4
newaa4 7
RutasMostraraa8 D
(aaD E
itemaaE I
.aaI J
idRouteaaJ Q
,aaQ R
itemaaS W
.aaW X
latitudaaX _
,aa_ `
itemaaa e
.aae f
logintudaaf n
,aan o
placeaap u
.aau v
description	aav Å
,
aaÅ Ç
item
aaÉ á
.
aaá à
status
aaà é
,
aaé è
(
aaê ë
int
aaë î
)
aaî ï
item
aaï ô
.
aaô ö
numPoint
aaö ¢
)
aa¢ £
)
aa£ §
;
aa§ •
}bb  !
}cc 
ifee 
(ee  
nuevasRutasee  +
.ee+ ,
Anyee, /
(ee/ 0
)ee0 1
)ee1 2
{ff 
RutasMostrargg  ,
primeraRutagg- 8
=gg9 :
nuevasRutasgg; F
.ggF G
FirstOrDefaultggG U
(ggU V
rggV W
=>ggX Z
rgg[ \
.gg\ ]
statusgg] c
==ggd f
$numggg h
)ggh i
;ggi j
ifhh  "
(hh# $
primeraRutahh$ /
!=hh0 2
nullhh3 7
)hh7 8
{ii  !
nuevasRutasjj$ /
=jj0 1
nuevasRutasjj2 =
.kk( )
OrderBykk) 0
(kk0 1
routekk1 6
=>kk7 9
routekk: ?
.kk? @
numPointkk@ H
)kkH I
.ll( )
ToListll) /
(ll/ 0
)ll0 1
;ll1 2
}mm  !
}nn 
countoo !
=oo" #
$numoo$ %
;oo% &
foreachpp #
(pp$ %
varpp% (
itempp) -
inpp. 0
nuevasRutaspp1 <
)pp< =
{qq 
itemrr  $
.rr$ %
namerr% )
=rr* +
itemrr, 0
.rr0 1
namerr1 5
+rr6 7
$strrr8 ;
+rr< =
countrr> C
;rrC D
countss  %
++ss% '
;ss' (
}tt 
}uu 
ifww 
(ww 
checkpointsww '
.ww' (
Countww( -
>ww. /
$numww0 1
)ww1 2
{xx 
countyy !
=yy" #
$numyy$ %
;yy% &
foreachzz #
(zz$ %
varzz% (
itemzz) -
inzz. 0
checkpointszz1 <
)zz< =
{{{ 
count||  %
++||% '
;||' (
nuevasParadas}}  -
.}}- .
Add}}. 1
(}}1 2
new}}2 5
ParadasMostrar}}6 D
(}}D E
item}}E I
.}}I J
idCheckpoint}}J V
,}}V W
item}}X \
.}}\ ]
description}}] h
,}}h i
item}}j n
.}}n o
status}}o u
,}}u v
item}}w {
.}}{ |
latitud	}}| É
,
}}É Ñ
item
}}Ö â
.
}}â ä
longitud
}}ä í
)
}}í ì
)
}}ì î
;
}}î ï
}~~ 
if
ÄÄ 
(
ÄÄ  
nuevasParadas
ÄÄ  -
.
ÄÄ- .
Any
ÄÄ. 1
(
ÄÄ1 2
)
ÄÄ2 3
)
ÄÄ3 4
{
ÅÅ 
ParadasMostrar
ÇÇ  .
primeraParada
ÇÇ/ <
=
ÇÇ= >
nuevasParadas
ÇÇ? L
.
ÇÇL M
FirstOrDefault
ÇÇM [
(
ÇÇ[ \
r
ÇÇ\ ]
=>
ÇÇ^ `
r
ÇÇa b
.
ÇÇb c
status
ÇÇc i
==
ÇÇj l
$num
ÇÇm n
)
ÇÇn o
;
ÇÇo p
if
ÉÉ  "
(
ÉÉ# $
primeraParada
ÉÉ$ 1
!=
ÉÉ2 4
null
ÉÉ5 9
)
ÉÉ9 :
{
ÑÑ  !
nuevasParadas
ÖÖ$ 1
=
ÖÖ2 3
nuevasParadas
ÖÖ4 A
.
ÜÜ( )
OrderBy
ÜÜ) 0
(
ÜÜ0 1
route
ÜÜ1 6
=>
ÜÜ7 9
muestraRutasMapas
ÜÜ: K
.
ÜÜK L(
CalcularDistanciaHaversine
ÜÜL f
(
ÜÜf g
(
áá, -
decimal
áá- 4
)
áá4 5
primeraParada
áá5 B
.
ááB C
latitud
ááC J
,
ááJ K
(
àà, -
decimal
àà- 4
)
àà4 5
primeraParada
àà5 B
.
ààB C
longitud
ààC K
,
ààK L
route
ââ, 1
.
ââ1 2
latitud
ââ2 9
,
ââ9 :
route
ää, 1
.
ää1 2
longitud
ää2 :
)
ää: ;
)
ää; <
.
ãã( )
ToList
ãã) /
(
ãã/ 0
)
ãã0 1
;
ãã1 2
}
åå  !
}
çç 
count
éé !
=
éé" #
$num
éé$ %
;
éé% &
foreach
èè #
(
èè$ %
var
èè% (
item
èè) -
in
èè. 0
nuevasParadas
èè1 >
)
èè> ?
{
êê 
item
ëë  $
.
ëë$ %
description
ëë% 0
=
ëë1 2
item
ëë3 7
.
ëë7 8
description
ëë8 C
+
ëëD E
$str
ëëF I
+
ëëJ K
count
ëëL Q
;
ëëQ R
count
íí  %
++
íí% '
;
íí' (
}
ìì 
}
îî 
}
ïï 
muestraRutasMapas
ññ %
.
ññ% &
ListRutasMostrar
ññ& 6
=
ññ7 8
nuevasRutas
ññ9 D
;
ññD E
muestraRutasMapas
óó %
.
óó% & 
ListParadasMostrar
óó& 8
=
óó9 :
nuevasParadas
óó; H
;
óóH I
muestraRutasMapas
òò %
.
òò% &!
ListBloqueosMostrar
òò& 9
=
òò: ;
nuevosBloqueos
òò< J
;
òòJ K
mapa
ôô 
.
ôô 
Add
ôô 
(
ôô 
muestraRutasMapas
ôô .
)
ôô. /
;
ôô/ 0
ViewBag
öö 
.
öö 
numTypeRoute
öö (
=
öö) *
numTypeRoute
öö+ 7
;
öö7 8
}
õõ 
return
ùù 
View
ùù 
(
ùù 
mapa
ùù  
)
ùù  !
;
ùù! "
}
ûû 
catch
üü 
(
üü 
	Exception
üü 
)
üü 
{
†† 
return
°° 
RedirectToAction
°° '
(
°°' (
$str
°°( /
,
°°/ 0
$str
°°1 7
)
°°7 8
;
°°8 9
}
¢¢ 
}
££ 	
public
§§ 
ActionResult
§§ 
	ViewRuta2
§§ %
(
§§% &
int
§§& )
numTypeRoute
§§* 6
)
§§6 7
{
•• 	
try
¶¶ 
{
ßß 
Login
®® 
logi
®® 
=
®® 
new
®®  
Login
®®! &
(
®®& '
)
®®' (
;
®®( )
var
©© 

authResult
©© 
=
©©   
AutenticarPasosRol
©©! 3
(
©©3 4
$num
©©4 5
)
©©5 6
;
©©6 7
if
™™ 
(
™™ 

authResult
™™ 
!=
™™ !
null
™™" &
)
™™& '
return
™™( .

authResult
™™/ 9
;
™™9 :
string
¨¨ 
Line
¨¨ 
=
¨¨ 
logi
¨¨ "
.
¨¨" # 
GetLineaFromCookie
¨¨# 5
(
¨¨5 6
Request
¨¨6 =
)
¨¨= >
.
¨¨> ?
ToString
¨¨? G
(
¨¨G H
)
¨¨H I
;
¨¨I J
List
≠≠ 
<
≠≠ 
MuestraRutasMapas
≠≠ &
>
≠≠& '
mapa
≠≠( ,
=
≠≠- .
new
≠≠/ 2
List
≠≠3 7
<
≠≠7 8
MuestraRutasMapas
≠≠8 I
>
≠≠I J
(
≠≠J K
)
≠≠K L
;
≠≠L M
int
ÆÆ 
count
ÆÆ 
=
ÆÆ 
$num
ÆÆ 
;
ÆÆ 
for
ØØ 
(
ØØ 
int
ØØ 
i
ØØ 
=
ØØ 
$num
ØØ 
;
ØØ 
i
ØØ  !
<=
ØØ" $
$num
ØØ% &
;
ØØ& '
i
ØØ( )
++
ØØ) +
)
ØØ+ ,
{
∞∞ 
MuestraRutasMapas
±± %
muestraRutasMapas
±±& 7
=
±±8 9
new
±±: =
MuestraRutasMapas
±±> O
{
≤≤ 
ListRutasMostrar
≥≥ (
=
≥≥) *
new
≥≥+ .
List
≥≥/ 3
<
≥≥3 4
RutasMostrar
≥≥4 @
>
≥≥@ A
(
≥≥A B
)
≥≥B C
,
≥≥C D 
ListParadasMostrar
¥¥ *
=
¥¥+ ,
new
¥¥- 0
List
¥¥1 5
<
¥¥5 6
ParadasMostrar
¥¥6 D
>
¥¥D E
(
¥¥E F
)
¥¥F G
,
¥¥G H!
ListBloqueosMostrar
µµ +
=
µµ, -
new
µµ. 1
List
µµ2 6
<
µµ6 7
BloqueosMostrar
µµ7 F
>
µµF G
(
µµG H
)
µµH I
,
µµI J

NumeroRuta
∂∂ "
=
∂∂# $
i
∂∂% &
}
∑∑ 
;
∑∑ 
List
∏∏ 
<
∏∏ 
BloqueosMostrar
∏∏ (
>
∏∏( )
nuevosBloqueos
∏∏* 8
=
∏∏9 :
new
∏∏; >
List
∏∏? C
<
∏∏C D
BloqueosMostrar
∏∏D S
>
∏∏S T
(
∏∏T U
)
∏∏U V
;
∏∏V W
List
ππ 
<
ππ 
RutasMostrar
ππ %
>
ππ% &
nuevasRutas
ππ' 2
=
ππ3 4
new
ππ5 8
List
ππ9 =
<
ππ= >
RutasMostrar
ππ> J
>
ππJ K
(
ππK L
)
ππL M
;
ππM N
List
∫∫ 
<
∫∫ 
ParadasMostrar
∫∫ '
>
∫∫' (
nuevasParadas
∫∫) 6
=
∫∫7 8
new
∫∫9 <
List
∫∫= A
<
∫∫A B
ParadasMostrar
∫∫B P
>
∫∫P Q
(
∫∫Q R
)
∫∫R S
;
∫∫S T
using
ºº 
(
ºº 
dbModels
ºº #
context
ºº$ +
=
ºº, -
new
ºº. 1
dbModels
ºº2 :
(
ºº: ;
)
ºº; <
)
ºº< =
{
ΩΩ 
var
ææ 
checkpoints
ææ '
=
ææ( )
context
ææ* 1
.
ææ1 2

Checkpoint
ææ2 <
.
ææ< =
Where
ææ= B
(
ææB C
x
ææC D
=>
ææE G
x
ææH I
.
ææI J
idLine
ææJ P
==
ææQ S
Line
ææT X
&&
ææY [
x
ææ\ ]
.
ææ] ^
status
ææ^ d
!=
ææe g
$num
ææh i
&&
ææj l
x
ææm n
.
ææn o
numberRoute
ææo z
==
ææ{ }
numTypeRouteææ~ ä
)ææä ã
.ææã å
ToListææå í
(ææí ì
)ææì î
;ææî ï
var
øø 
routes
øø "
=
øø# $
context
øø% ,
.
øø, -
Route
øø- 2
.
¿¿ 
Where
¿¿ "
(
¿¿" #
x
¿¿# $
=>
¿¿% '
x
¿¿( )
.
¿¿) *
idLine
¿¿* 0
==
¿¿1 3
Line
¿¿4 8
&&
¿¿9 ;
x
¿¿< =
.
¿¿= >
numberRoute
¿¿> I
==
¿¿J L
i
¿¿M N
&&
¿¿O Q
x
¿¿R S
.
¿¿S T
numTypeRoute
¿¿T `
==
¿¿a c
numTypeRoute
¿¿d p
)
¿¿p q
.
¡¡ 
ToList
¡¡ #
(
¡¡# $
)
¡¡$ %
;
¡¡% &
var
¬¬ 
	deviation
¬¬ %
=
¬¬& '
context
¬¬( /
.
¬¬/ 0
DeviationRote
¬¬0 =
.
¬¬= >
Where
¬¬> C
(
¬¬C D
x
¬¬D E
=>
¬¬F H
x
¬¬I J
.
¬¬J K
idLine
¬¬K Q
==
¬¬R T
Line
¬¬U Y
&&
¬¬Z \
x
¬¬] ^
.
¬¬^ _
numberRoute
¬¬_ j
==
¬¬k m
i
¬¬n o
&&
¬¬p r
x
¬¬s t
.
¬¬t u
numTypeRoute¬¬u Å
==¬¬Ç Ñ
numTypeRoute¬¬Ö ë
)¬¬ë í
.¬¬í ì
ToList¬¬ì ô
(¬¬ô ö
)¬¬ö õ
;¬¬õ ú
if
√√ 
(
√√ 
	deviation
√√ %
.
√√% &
Count
√√& +
>
√√, -
$num
√√. /
)
√√/ 0
{
ƒƒ 
foreach
≈≈ #
(
≈≈$ %
var
≈≈% (
item
≈≈) -
in
≈≈. 0
	deviation
≈≈1 :
)
≈≈: ;
{
∆∆ 
List
««  $
<
««$ %
RutasMostrar
««% 1
>
««1 2
listBloqueos
««3 ?
=
««@ A
new
««B E
List
««F J
<
««J K
RutasMostrar
««K W
>
««W X
(
««X Y
)
««Y Z
;
««Z [
var
»»  #
route1
»»$ *
=
»»+ ,
routes
»»- 3
.
»»3 4
Where
»»4 9
(
»»9 :
x
»»: ;
=>
»»< >
x
»»? @
.
»»@ A
idRoute
»»A H
==
»»I K
item
»»L P
.
»»P Q
idRouteStart
»»Q ]
&&
»»^ `
x
»»a b
.
»»b c
idLine
»»c i
==
»»j l
Line
»»m q
)
»»q r
.
»»r s
FirstOrDefault»»s Å
(»»Å Ç
)»»Ç É
;»»É Ñ
var
……  #
route2
……$ *
=
……+ ,
routes
……- 3
.
……3 4
Where
……4 9
(
……9 :
x
……: ;
=>
……< >
x
……? @
.
……@ A
idRoute
……A H
==
……I K
item
……L P
.
……P Q

idRouteEnd
……Q [
&&
……\ ^
x
……_ `
.
……` a
idLine
……a g
==
……h j
Line
……k o
)
……o p
.
……p q
FirstOrDefault
……q 
(…… Ä
)……Ä Å
;……Å Ç
if
    "
(
  # $
route1
  $ *
!=
  + -
null
  . 2
&&
  3 5
route2
  6 <
!=
  = ?
null
  @ D
)
  D E
{
ÀÀ  !
var
ÃÃ$ '
routesDeviation
ÃÃ( 7
=
ÃÃ8 9
routes
ÃÃ: @
.
ÃÃ@ A
Where
ÃÃA F
(
ÃÃF G
x
ÃÃG H
=>
ÃÃI K
x
ÃÃL M
.
ÃÃM N
numPoint
ÃÃN V
>=
ÃÃW Y
route1
ÃÃZ `
.
ÃÃ` a
numPoint
ÃÃa i
&&
ÃÃj l
x
ÃÃm n
.
ÃÃn o
numPoint
ÃÃo w
<=
ÃÃx z
route2ÃÃ{ Å
.ÃÃÅ Ç
numPointÃÃÇ ä
&&ÃÃã ç
xÃÃé è
.ÃÃè ê
idLineÃÃê ñ
==ÃÃó ô
LineÃÃö û
)ÃÃû ü
.ÃÃü †
ToListÃÃ† ¶
(ÃÃ¶ ß
)ÃÃß ®
;ÃÃ® ©
foreach
ÕÕ$ +
(
ÕÕ, -
var
ÕÕ- 0
item2
ÕÕ1 6
in
ÕÕ7 9
routesDeviation
ÕÕ: I
)
ÕÕI J
{
ŒŒ$ %
listBloqueos
œœ( 4
.
œœ4 5
Add
œœ5 8
(
œœ8 9
new
œœ9 <
RutasMostrar
œœ= I
(
œœI J
item2
œœJ O
.
œœO P
idRoute
œœP W
,
œœW X
item2
œœY ^
.
œœ^ _
latitud
œœ_ f
,
œœf g
item2
œœh m
.
œœm n
logintud
œœn v
,
œœv w
$str
œœx z
,
œœz {
item2œœ| Å
.œœÅ Ç
statusœœÇ à
,œœà â
(œœä ã
intœœã é
)œœé è
item2œœè î
.œœî ï
numPointœœï ù
)œœù û
)œœû ü
;œœü †
}
––$ %
var
——$ '
place1
——( .
=
——/ 0
context
——1 8
.
——8 9
Place
——9 >
.
——> ?
Where
——? D
(
——D E
x
——E F
=>
——G I
x
——J K
.
——K L
idPlace
——L S
==
——T V
route1
——W ]
.
——] ^
idPlace
——^ e
)
——e f
.
——f g
FirstOrDefault
——g u
(
——u v
)
——v w
;
——w x
var
““$ '
place2
““( .
=
““/ 0
context
““1 8
.
““8 9
Place
““9 >
.
““> ?
Where
““? D
(
““D E
x
““E F
=>
““G I
x
““J K
.
““K L
idPlace
““L S
==
““T V
route2
““W ]
.
““] ^
idPlace
““^ e
)
““e f
.
““f g
FirstOrDefault
““g u
(
““u v
)
““v w
;
““w x
nuevosBloqueos
””$ 2
.
””2 3
Add
””3 6
(
””6 7
new
””7 :
BloqueosMostrar
””; J
(
””J K
item
””K O
.
””O P
idDeviation
””P [
,
””[ \
$str
””] g
+
””h i
place1
””j p
.
””p q
description
””q |
+
””} ~
$str”” Ñ
+””Ö Ü
place2””á ç
.””ç é
description””é ô
,””ô ö
listBloqueos””õ ß
)””ß ®
)””® ©
;””© ™
}
‘‘  !
}
’’ 
}
÷÷ 
if
◊◊ 
(
◊◊ 
routes
◊◊ "
.
◊◊" #
Count
◊◊# (
>
◊◊) *
$num
◊◊+ ,
)
◊◊, -
{
ÿÿ 
count
ŸŸ !
=
ŸŸ" #
$num
ŸŸ$ %
;
ŸŸ% &
foreach
⁄⁄ #
(
⁄⁄$ %
var
⁄⁄% (
item
⁄⁄) -
in
⁄⁄. 0
routes
⁄⁄1 7
)
⁄⁄7 8
{
€€ 
count
‹‹  %
++
‹‹% '
;
‹‹' (
Place
››  %
place
››& +
=
››, -
context
››. 5
.
››5 6
Place
››6 ;
.
››; <
FirstOrDefault
››< J
(
››J K
x
››K L
=>
››M O
x
››P Q
.
››Q R
idPlace
››R Y
==
››Z \
item
››] a
.
››a b
idPlace
››b i
)
››i j
;
››j k
if
ﬁﬁ  "
(
ﬁﬁ# $
place
ﬁﬁ$ )
!=
ﬁﬁ* ,
null
ﬁﬁ- 1
)
ﬁﬁ1 2
{
ﬂﬂ  !
nuevasRutas
‡‡$ /
.
‡‡/ 0
Add
‡‡0 3
(
‡‡3 4
new
‡‡4 7
RutasMostrar
‡‡8 D
(
‡‡D E
item
‡‡E I
.
‡‡I J
idRoute
‡‡J Q
,
‡‡Q R
item
‡‡S W
.
‡‡W X
latitud
‡‡X _
,
‡‡_ `
item
‡‡a e
.
‡‡e f
logintud
‡‡f n
,
‡‡n o
place
‡‡p u
.
‡‡u v
description‡‡v Å
,‡‡Å Ç
item‡‡É á
.‡‡á à
status‡‡à é
,‡‡é è
(‡‡ê ë
int‡‡ë î
)‡‡î ï
item‡‡ï ô
.‡‡ô ö
numPoint‡‡ö ¢
)‡‡¢ £
)‡‡£ §
;‡‡§ •
}
··  !
}
‚‚ 
if
‰‰ 
(
‰‰  
nuevasRutas
‰‰  +
.
‰‰+ ,
Any
‰‰, /
(
‰‰/ 0
)
‰‰0 1
)
‰‰1 2
{
ÂÂ 
RutasMostrar
ÊÊ  ,
primeraRuta
ÊÊ- 8
=
ÊÊ9 :
nuevasRutas
ÊÊ; F
.
ÊÊF G
FirstOrDefault
ÊÊG U
(
ÊÊU V
r
ÊÊV W
=>
ÊÊX Z
r
ÊÊ[ \
.
ÊÊ\ ]
status
ÊÊ] c
==
ÊÊd f
$num
ÊÊg h
)
ÊÊh i
;
ÊÊi j
if
ÁÁ  "
(
ÁÁ# $
primeraRuta
ÁÁ$ /
!=
ÁÁ0 2
null
ÁÁ3 7
)
ÁÁ7 8
{
ËË  !
nuevasRutas
ÈÈ$ /
=
ÈÈ0 1
nuevasRutas
ÈÈ2 =
.
ÍÍ( )
OrderBy
ÍÍ) 0
(
ÍÍ0 1
route
ÍÍ1 6
=>
ÍÍ7 9
route
ÍÍ: ?
.
ÍÍ? @
numPoint
ÍÍ@ H
)
ÍÍH I
.
ÎÎ( )
ToList
ÎÎ) /
(
ÎÎ/ 0
)
ÎÎ0 1
;
ÎÎ1 2
}
ÏÏ  !
}
ÌÌ 
count
ÓÓ !
=
ÓÓ" #
$num
ÓÓ$ %
;
ÓÓ% &
foreach
ÔÔ #
(
ÔÔ$ %
var
ÔÔ% (
item
ÔÔ) -
in
ÔÔ. 0
nuevasRutas
ÔÔ1 <
)
ÔÔ< =
{
 
item
ÒÒ  $
.
ÒÒ$ %
name
ÒÒ% )
=
ÒÒ* +
item
ÒÒ, 0
.
ÒÒ0 1
name
ÒÒ1 5
+
ÒÒ6 7
$str
ÒÒ8 ;
+
ÒÒ< =
count
ÒÒ> C
;
ÒÒC D
count
ÚÚ  %
++
ÚÚ% '
;
ÚÚ' (
}
ÛÛ 
}
ÙÙ 
if
ˆˆ 
(
ˆˆ 
checkpoints
ˆˆ '
.
ˆˆ' (
Count
ˆˆ( -
>
ˆˆ. /
$num
ˆˆ0 1
)
ˆˆ1 2
{
˜˜ 
count
¯¯ !
=
¯¯" #
$num
¯¯$ %
;
¯¯% &
foreach
˘˘ #
(
˘˘$ %
var
˘˘% (
item
˘˘) -
in
˘˘. 0
checkpoints
˘˘1 <
)
˘˘< =
{
˙˙ 
count
˚˚  %
++
˚˚% '
;
˚˚' (
nuevasParadas
¸¸  -
.
¸¸- .
Add
¸¸. 1
(
¸¸1 2
new
¸¸2 5
ParadasMostrar
¸¸6 D
(
¸¸D E
item
¸¸E I
.
¸¸I J
idCheckpoint
¸¸J V
,
¸¸V W
item
¸¸X \
.
¸¸\ ]
description
¸¸] h
,
¸¸h i
item
¸¸j n
.
¸¸n o
status
¸¸o u
,
¸¸u v
item
¸¸w {
.
¸¸{ |
latitud¸¸| É
,¸¸É Ñ
item¸¸Ö â
.¸¸â ä
longitud¸¸ä í
)¸¸í ì
)¸¸ì î
;¸¸î ï
}
˝˝ 
if
ˇˇ 
(
ˇˇ  
nuevasParadas
ˇˇ  -
.
ˇˇ- .
Any
ˇˇ. 1
(
ˇˇ1 2
)
ˇˇ2 3
)
ˇˇ3 4
{
ÄÄ 
ParadasMostrar
ÅÅ  .
primeraParada
ÅÅ/ <
=
ÅÅ= >
nuevasParadas
ÅÅ? L
.
ÅÅL M
FirstOrDefault
ÅÅM [
(
ÅÅ[ \
r
ÅÅ\ ]
=>
ÅÅ^ `
r
ÅÅa b
.
ÅÅb c
status
ÅÅc i
==
ÅÅj l
$num
ÅÅm n
)
ÅÅn o
;
ÅÅo p
if
ÇÇ  "
(
ÇÇ# $
primeraParada
ÇÇ$ 1
!=
ÇÇ2 4
null
ÇÇ5 9
)
ÇÇ9 :
{
ÉÉ  !
nuevasParadas
ÑÑ$ 1
=
ÑÑ2 3
nuevasParadas
ÑÑ4 A
.
ÖÖ( )
OrderBy
ÖÖ) 0
(
ÖÖ0 1
route
ÖÖ1 6
=>
ÖÖ7 9
muestraRutasMapas
ÖÖ: K
.
ÖÖK L(
CalcularDistanciaHaversine
ÖÖL f
(
ÖÖf g
(
ÜÜ, -
decimal
ÜÜ- 4
)
ÜÜ4 5
primeraParada
ÜÜ5 B
.
ÜÜB C
latitud
ÜÜC J
,
ÜÜJ K
(
áá, -
decimal
áá- 4
)
áá4 5
primeraParada
áá5 B
.
ááB C
longitud
ááC K
,
ááK L
route
àà, 1
.
àà1 2
latitud
àà2 9
,
àà9 :
route
ââ, 1
.
ââ1 2
longitud
ââ2 :
)
ââ: ;
)
ââ; <
.
ää( )
ToList
ää) /
(
ää/ 0
)
ää0 1
;
ää1 2
}
ãã  !
}
åå 
count
çç !
=
çç" #
$num
çç$ %
;
çç% &
foreach
éé #
(
éé$ %
var
éé% (
item
éé) -
in
éé. 0
nuevasParadas
éé1 >
)
éé> ?
{
èè 
item
êê  $
.
êê$ %
description
êê% 0
=
êê1 2
item
êê3 7
.
êê7 8
description
êê8 C
+
êêD E
$str
êêF I
+
êêJ K
count
êêL Q
;
êêQ R
count
ëë  %
++
ëë% '
;
ëë' (
}
íí 
}
ìì 
}
îî 
muestraRutasMapas
ïï %
.
ïï% &
ListRutasMostrar
ïï& 6
=
ïï7 8
nuevasRutas
ïï9 D
;
ïïD E
muestraRutasMapas
ññ %
.
ññ% & 
ListParadasMostrar
ññ& 8
=
ññ9 :
nuevasParadas
ññ; H
;
ññH I
muestraRutasMapas
óó %
.
óó% &!
ListBloqueosMostrar
óó& 9
=
óó: ;
nuevosBloqueos
óó< J
;
óóJ K
ViewBag
òò 
.
òò 
numTypeRoute
òò (
=
òò) *
numTypeRoute
òò+ 7
;
òò7 8
mapa
ôô 
.
ôô 
Add
ôô 
(
ôô 
muestraRutasMapas
ôô .
)
ôô. /
;
ôô/ 0
}
öö 
return
úú 
View
úú 
(
úú 
mapa
úú  
)
úú  !
;
úú! "
}
ùù 
catch
ûû 
(
ûû 
	Exception
ûû 
)
ûû 
{
üü 
return
†† 
RedirectToAction
†† '
(
††' (
$str
††( /
,
††/ 0
$str
††1 7
)
††7 8
;
††8 9
}
°° 
}
¢¢ 	
public
¶¶ 
ActionResult
¶¶ 
	ViewRutas
¶¶ %
(
¶¶% &
)
¶¶& '
{
ßß 	
try
®® 
{
©© 
Login
™™ 
logi
™™ 
=
™™ 
new
™™  
Login
™™! &
(
™™& '
)
™™' (
;
™™( )
var
´´ 

authResult
´´ 
=
´´   
AutenticarPasosRol
´´! 3
(
´´3 4
$num
´´4 5
)
´´5 6
;
´´6 7
if
¨¨ 
(
¨¨ 

authResult
¨¨ 
!=
¨¨ !
null
¨¨" &
)
¨¨& '
return
¨¨( .

authResult
¨¨/ 9
;
¨¨9 :
string
ÆÆ 
Line
ÆÆ 
=
ÆÆ 
logi
ÆÆ "
.
ÆÆ" # 
GetLineaFromCookie
ÆÆ# 5
(
ÆÆ5 6
Request
ÆÆ6 =
)
ÆÆ= >
.
ÆÆ> ?
ToString
ÆÆ? G
(
ÆÆG H
)
ÆÆH I
;
ÆÆI J
List
ØØ 
<
ØØ 
MuestraRutasMapas
ØØ &
>
ØØ& '
mapa
ØØ( ,
=
ØØ- .
new
ØØ/ 2
List
ØØ3 7
<
ØØ7 8
MuestraRutasMapas
ØØ8 I
>
ØØI J
(
ØØJ K
)
ØØK L
;
ØØL M
int
∞∞ 
count
∞∞ 
=
∞∞ 
$num
∞∞ 
;
∞∞ 
for
±± 
(
±± 
int
±± 
i
±± 
=
±± 
$num
±± 
;
±± 
i
±±  !
<=
±±" $
$num
±±% &
;
±±& '
i
±±( )
++
±±) +
)
±±+ ,
{
≤≤ 
MuestraRutasMapas
≥≥ %
muestraRutasMapas
≥≥& 7
=
≥≥8 9
new
≥≥: =
MuestraRutasMapas
≥≥> O
{
¥¥ 
ListRutasMostrar
µµ (
=
µµ) *
new
µµ+ .
List
µµ/ 3
<
µµ3 4
RutasMostrar
µµ4 @
>
µµ@ A
(
µµA B
)
µµB C
,
µµC D 
ListParadasMostrar
∂∂ *
=
∂∂+ ,
new
∂∂- 0
List
∂∂1 5
<
∂∂5 6
ParadasMostrar
∂∂6 D
>
∂∂D E
(
∂∂E F
)
∂∂F G
,
∂∂G H!
ListBloqueosMostrar
∑∑ +
=
∑∑, -
new
∑∑. 1
List
∑∑2 6
<
∑∑6 7
BloqueosMostrar
∑∑7 F
>
∑∑F G
(
∑∑G H
)
∑∑H I
,
∑∑I J

NumeroRuta
∏∏ "
=
∏∏# $
i
∏∏% &
}
ππ 
;
ππ 
List
∫∫ 
<
∫∫ 
BloqueosMostrar
∫∫ (
>
∫∫( )
nuevosBloqueos
∫∫* 8
=
∫∫9 :
new
∫∫; >
List
∫∫? C
<
∫∫C D
BloqueosMostrar
∫∫D S
>
∫∫S T
(
∫∫T U
)
∫∫U V
;
∫∫V W
List
ªª 
<
ªª 
RutasMostrar
ªª %
>
ªª% &
nuevasRutas
ªª' 2
=
ªª3 4
new
ªª5 8
List
ªª9 =
<
ªª= >
RutasMostrar
ªª> J
>
ªªJ K
(
ªªK L
)
ªªL M
;
ªªM N
List
ºº 
<
ºº 
ParadasMostrar
ºº '
>
ºº' (
nuevasParadas
ºº) 6
=
ºº7 8
new
ºº9 <
List
ºº= A
<
ººA B
ParadasMostrar
ººB P
>
ººP Q
(
ººQ R
)
ººR S
;
ººS T
using
ææ 
(
ææ 
dbModels
ææ #
context
ææ$ +
=
ææ, -
new
ææ. 1
dbModels
ææ2 :
(
ææ: ;
)
ææ; <
)
ææ< =
{
øø 
var
¿¿ 
checkpoints
¿¿ '
=
¿¿( )
context
¿¿* 1
.
¿¿1 2

Checkpoint
¿¿2 <
.
¿¿< =
Where
¿¿= B
(
¿¿B C
x
¿¿C D
=>
¿¿E G
x
¿¿H I
.
¿¿I J
idLine
¿¿J P
==
¿¿Q S
Line
¿¿T X
&&
¿¿Y [
x
¿¿\ ]
.
¿¿] ^
status
¿¿^ d
!=
¿¿e g
$num
¿¿h i
&&
¿¿j l
x
¿¿m n
.
¿¿n o
numberRoute
¿¿o z
==
¿¿{ }
$num
¿¿~ 
)¿¿ Ä
.¿¿Ä Å
ToList¿¿Å á
(¿¿á à
)¿¿à â
;¿¿â ä
var
¡¡ 
routes
¡¡ "
=
¡¡# $
context
¡¡% ,
.
¡¡, -
Route
¡¡- 2
.
¬¬ 
Where
¬¬ "
(
¬¬" #
x
¬¬# $
=>
¬¬% '
x
¬¬( )
.
¬¬) *
idLine
¬¬* 0
==
¬¬1 3
Line
¬¬4 8
&&
¬¬9 ;
x
¬¬< =
.
¬¬= >
numberRoute
¬¬> I
==
¬¬J L
i
¬¬M N
)
¬¬N O
.
√√ 
ToList
√√ #
(
√√# $
)
√√$ %
;
√√% &
var
ƒƒ 
	deviation
ƒƒ %
=
ƒƒ& '
context
ƒƒ( /
.
ƒƒ/ 0
DeviationRote
ƒƒ0 =
.
ƒƒ= >
Where
ƒƒ> C
(
ƒƒC D
x
ƒƒD E
=>
ƒƒF H
x
ƒƒI J
.
ƒƒJ K
idLine
ƒƒK Q
==
ƒƒR T
Line
ƒƒU Y
&&
ƒƒZ \
x
ƒƒ] ^
.
ƒƒ^ _
numberRoute
ƒƒ_ j
==
ƒƒk m
i
ƒƒn o
)
ƒƒo p
.
ƒƒp q
ToList
ƒƒq w
(
ƒƒw x
)
ƒƒx y
;
ƒƒy z
if
≈≈ 
(
≈≈ 
	deviation
≈≈ %
.
≈≈% &
Count
≈≈& +
>
≈≈, -
$num
≈≈. /
)
≈≈/ 0
{
∆∆ 
foreach
«« #
(
««$ %
var
««% (
item
««) -
in
««. 0
	deviation
««1 :
)
««: ;
{
»» 
List
……  $
<
……$ %
RutasMostrar
……% 1
>
……1 2
listBloqueos
……3 ?
=
……@ A
new
……B E
List
……F J
<
……J K
RutasMostrar
……K W
>
……W X
(
……X Y
)
……Y Z
;
……Z [
var
    #
route1
  $ *
=
  + ,
context
  - 4
.
  4 5
Route
  5 :
.
  : ;
Where
  ; @
(
  @ A
x
  A B
=>
  C E
x
  F G
.
  G H
idRoute
  H O
==
  P R
item
  S W
.
  W X
idRouteStart
  X d
&&
  e g
x
  h i
.
  i j
idLine
  j p
==
  q s
Line
  t x
)
  x y
.
  y z
FirstOrDefault  z à
(  à â
)  â ä
;  ä ã
var
ÀÀ  #
route2
ÀÀ$ *
=
ÀÀ+ ,
context
ÀÀ- 4
.
ÀÀ4 5
Route
ÀÀ5 :
.
ÀÀ: ;
Where
ÀÀ; @
(
ÀÀ@ A
x
ÀÀA B
=>
ÀÀC E
x
ÀÀF G
.
ÀÀG H
idRoute
ÀÀH O
==
ÀÀP R
item
ÀÀS W
.
ÀÀW X

idRouteEnd
ÀÀX b
&&
ÀÀc e
x
ÀÀf g
.
ÀÀg h
idLine
ÀÀh n
==
ÀÀo q
Line
ÀÀr v
)
ÀÀv w
.
ÀÀw x
FirstOrDefaultÀÀx Ü
(ÀÀÜ á
)ÀÀá à
;ÀÀà â
var
ÃÃ  #
routesDeviation
ÃÃ$ 3
=
ÃÃ4 5
context
ÃÃ6 =
.
ÃÃ= >
Route
ÃÃ> C
.
ÃÃC D
Where
ÃÃD I
(
ÃÃI J
x
ÃÃJ K
=>
ÃÃL N
x
ÃÃO P
.
ÃÃP Q
numPoint
ÃÃQ Y
>=
ÃÃZ \
route1
ÃÃ] c
.
ÃÃc d
numPoint
ÃÃd l
&&
ÃÃm o
x
ÃÃp q
.
ÃÃq r
numPoint
ÃÃr z
<=
ÃÃ{ }
route2ÃÃ~ Ñ
.ÃÃÑ Ö
numPointÃÃÖ ç
&&ÃÃé ê
xÃÃë í
.ÃÃí ì
idLineÃÃì ô
==ÃÃö ú
LineÃÃù °
)ÃÃ° ¢
.ÃÃ¢ £
ToListÃÃ£ ©
(ÃÃ© ™
)ÃÃ™ ´
;ÃÃ´ ¨
foreach
ÕÕ  '
(
ÕÕ( )
var
ÕÕ) ,
item2
ÕÕ- 2
in
ÕÕ3 5
routesDeviation
ÕÕ6 E
)
ÕÕE F
{
ŒŒ  !
listBloqueos
œœ$ 0
.
œœ0 1
Add
œœ1 4
(
œœ4 5
new
œœ5 8
RutasMostrar
œœ9 E
(
œœE F
item2
œœF K
.
œœK L
idRoute
œœL S
,
œœS T
item2
œœU Z
.
œœZ [
latitud
œœ[ b
,
œœb c
item2
œœd i
.
œœi j
logintud
œœj r
,
œœr s
$str
œœt v
,
œœv w
item2
œœx }
.
œœ} ~
statusœœ~ Ñ
,œœÑ Ö
(œœÜ á
intœœá ä
)œœä ã
item2œœã ê
.œœê ë
numPointœœë ô
)œœô ö
)œœö õ
;œœõ ú
}
––  !
var
——  #
place1
——$ *
=
——+ ,
context
——- 4
.
——4 5
Place
——5 :
.
——: ;
Where
——; @
(
——@ A
x
——A B
=>
——C E
x
——F G
.
——G H
idPlace
——H O
==
——P R
route1
——S Y
.
——Y Z
idPlace
——Z a
)
——a b
.
——b c
FirstOrDefault
——c q
(
——q r
)
——r s
;
——s t
var
““  #
place2
““$ *
=
““+ ,
context
““- 4
.
““4 5
Place
““5 :
.
““: ;
Where
““; @
(
““@ A
x
““A B
=>
““C E
x
““F G
.
““G H
idPlace
““H O
==
““P R
route2
““S Y
.
““Y Z
idPlace
““Z a
)
““a b
.
““b c
FirstOrDefault
““c q
(
““q r
)
““r s
;
““s t
nuevosBloqueos
””  .
.
””. /
Add
””/ 2
(
””2 3
new
””3 6
BloqueosMostrar
””7 F
(
””F G
item
””G K
.
””K L
idDeviation
””L W
,
””W X
$str
””Y c
+
””d e
place1
””f l
.
””l m
description
””m x
+
””y z
$str””{ Ä
+””Å Ç
place2””É â
.””â ä
description””ä ï
,””ï ñ
listBloqueos””ó £
)””£ §
)””§ •
;””• ¶
}
‘‘ 
}
’’ 
if
÷÷ 
(
÷÷ 
routes
÷÷ "
.
÷÷" #
Count
÷÷# (
>
÷÷) *
$num
÷÷+ ,
)
÷÷, -
{
◊◊ 
count
ÿÿ !
=
ÿÿ" #
$num
ÿÿ$ %
;
ÿÿ% &
foreach
ŸŸ #
(
ŸŸ$ %
var
ŸŸ% (
item
ŸŸ) -
in
ŸŸ. 0
routes
ŸŸ1 7
)
ŸŸ7 8
{
⁄⁄ 
count
€€  %
++
€€% '
;
€€' (
Place
‹‹  %
place
‹‹& +
=
‹‹, -
context
‹‹. 5
.
‹‹5 6
Place
‹‹6 ;
.
‹‹; <
FirstOrDefault
‹‹< J
(
‹‹J K
x
‹‹K L
=>
‹‹M O
x
‹‹P Q
.
‹‹Q R
idPlace
‹‹R Y
==
‹‹Z \
item
‹‹] a
.
‹‹a b
idPlace
‹‹b i
)
‹‹i j
;
‹‹j k
if
››  "
(
››# $
place
››$ )
!=
››* ,
null
››- 1
)
››1 2
{
ﬁﬁ  !
nuevasRutas
ﬂﬂ$ /
.
ﬂﬂ/ 0
Add
ﬂﬂ0 3
(
ﬂﬂ3 4
new
ﬂﬂ4 7
RutasMostrar
ﬂﬂ8 D
(
ﬂﬂD E
item
ﬂﬂE I
.
ﬂﬂI J
idRoute
ﬂﬂJ Q
,
ﬂﬂQ R
item
ﬂﬂS W
.
ﬂﬂW X
latitud
ﬂﬂX _
,
ﬂﬂ_ `
item
ﬂﬂa e
.
ﬂﬂe f
logintud
ﬂﬂf n
,
ﬂﬂn o
place
ﬂﬂp u
.
ﬂﬂu v
descriptionﬂﬂv Å
,ﬂﬂÅ Ç
itemﬂﬂÉ á
.ﬂﬂá à
statusﬂﬂà é
,ﬂﬂé è
(ﬂﬂê ë
intﬂﬂë î
)ﬂﬂî ï
itemﬂﬂï ô
.ﬂﬂô ö
numPointﬂﬂö ¢
)ﬂﬂ¢ £
)ﬂﬂ£ §
;ﬂﬂ§ •
}
‡‡  !
}
·· 
if
„„ 
(
„„  
nuevasRutas
„„  +
.
„„+ ,
Any
„„, /
(
„„/ 0
)
„„0 1
)
„„1 2
{
‰‰ 
RutasMostrar
ÂÂ  ,
primeraRuta
ÂÂ- 8
=
ÂÂ9 :
nuevasRutas
ÂÂ; F
.
ÂÂF G
FirstOrDefault
ÂÂG U
(
ÂÂU V
r
ÂÂV W
=>
ÂÂX Z
r
ÂÂ[ \
.
ÂÂ\ ]
status
ÂÂ] c
==
ÂÂd f
$num
ÂÂg h
)
ÂÂh i
;
ÂÂi j
if
ÊÊ  "
(
ÊÊ# $
primeraRuta
ÊÊ$ /
!=
ÊÊ0 2
null
ÊÊ3 7
)
ÊÊ7 8
{
ÁÁ  !
nuevasRutas
ËË$ /
=
ËË0 1
nuevasRutas
ËË2 =
.
ÈÈ( )
OrderBy
ÈÈ) 0
(
ÈÈ0 1
route
ÈÈ1 6
=>
ÈÈ7 9
route
ÈÈ: ?
.
ÈÈ? @
numPoint
ÈÈ@ H
)
ÈÈH I
.
ÍÍ( )
ToList
ÍÍ) /
(
ÍÍ/ 0
)
ÍÍ0 1
;
ÍÍ1 2
}
ÎÎ  !
}
ÏÏ 
count
ÌÌ !
=
ÌÌ" #
$num
ÌÌ$ %
;
ÌÌ% &
foreach
ÓÓ #
(
ÓÓ$ %
var
ÓÓ% (
item
ÓÓ) -
in
ÓÓ. 0
nuevasRutas
ÓÓ1 <
)
ÓÓ< =
{
ÔÔ 
item
  $
.
$ %
name
% )
=
* +
item
, 0
.
0 1
name
1 5
+
6 7
$str
8 ;
+
< =
count
> C
;
C D
count
ÒÒ  %
++
ÒÒ% '
;
ÒÒ' (
}
ÚÚ 
}
ÛÛ 
if
ıı 
(
ıı 
checkpoints
ıı '
.
ıı' (
Count
ıı( -
>
ıı. /
$num
ıı0 1
)
ıı1 2
{
ˆˆ 
count
˜˜ !
=
˜˜" #
$num
˜˜$ %
;
˜˜% &
foreach
¯¯ #
(
¯¯$ %
var
¯¯% (
item
¯¯) -
in
¯¯. 0
checkpoints
¯¯1 <
)
¯¯< =
{
˘˘ 
count
˙˙  %
++
˙˙% '
;
˙˙' (
nuevasParadas
˚˚  -
.
˚˚- .
Add
˚˚. 1
(
˚˚1 2
new
˚˚2 5
ParadasMostrar
˚˚6 D
(
˚˚D E
item
˚˚E I
.
˚˚I J
idCheckpoint
˚˚J V
,
˚˚V W
item
˚˚X \
.
˚˚\ ]
description
˚˚] h
,
˚˚h i
item
˚˚j n
.
˚˚n o
status
˚˚o u
,
˚˚u v
item
˚˚w {
.
˚˚{ |
latitud˚˚| É
,˚˚É Ñ
item˚˚Ö â
.˚˚â ä
longitud˚˚ä í
)˚˚í ì
)˚˚ì î
;˚˚î ï
}
¸¸ 
if
˛˛ 
(
˛˛  
nuevasParadas
˛˛  -
.
˛˛- .
Any
˛˛. 1
(
˛˛1 2
)
˛˛2 3
)
˛˛3 4
{
ˇˇ 
ParadasMostrar
ÄÄ  .
primeraParada
ÄÄ/ <
=
ÄÄ= >
nuevasParadas
ÄÄ? L
.
ÄÄL M
FirstOrDefault
ÄÄM [
(
ÄÄ[ \
r
ÄÄ\ ]
=>
ÄÄ^ `
r
ÄÄa b
.
ÄÄb c
status
ÄÄc i
==
ÄÄj l
$num
ÄÄm n
)
ÄÄn o
;
ÄÄo p
if
ÅÅ  "
(
ÅÅ# $
primeraParada
ÅÅ$ 1
!=
ÅÅ2 4
null
ÅÅ5 9
)
ÅÅ9 :
{
ÇÇ  !
nuevasParadas
ÉÉ$ 1
=
ÉÉ2 3
nuevasParadas
ÉÉ4 A
.
ÑÑ( )
OrderBy
ÑÑ) 0
(
ÑÑ0 1
route
ÑÑ1 6
=>
ÑÑ7 9
muestraRutasMapas
ÑÑ: K
.
ÑÑK L(
CalcularDistanciaHaversine
ÑÑL f
(
ÑÑf g
(
ÖÖ, -
decimal
ÖÖ- 4
)
ÖÖ4 5
primeraParada
ÖÖ5 B
.
ÖÖB C
latitud
ÖÖC J
,
ÖÖJ K
(
ÜÜ, -
decimal
ÜÜ- 4
)
ÜÜ4 5
primeraParada
ÜÜ5 B
.
ÜÜB C
longitud
ÜÜC K
,
ÜÜK L
route
áá, 1
.
áá1 2
latitud
áá2 9
,
áá9 :
route
àà, 1
.
àà1 2
longitud
àà2 :
)
àà: ;
)
àà; <
.
ââ( )
ToList
ââ) /
(
ââ/ 0
)
ââ0 1
;
ââ1 2
}
ää  !
}
ãã 
count
åå !
=
åå" #
$num
åå$ %
;
åå% &
foreach
çç #
(
çç$ %
var
çç% (
item
çç) -
in
çç. 0
nuevasParadas
çç1 >
)
çç> ?
{
éé 
item
èè  $
.
èè$ %
description
èè% 0
=
èè1 2
item
èè3 7
.
èè7 8
description
èè8 C
+
èèD E
$str
èèF I
+
èèJ K
count
èèL Q
;
èèQ R
count
êê  %
++
êê% '
;
êê' (
}
ëë 
}
íí 
}
ìì 
muestraRutasMapas
îî %
.
îî% &
ListRutasMostrar
îî& 6
=
îî7 8
nuevasRutas
îî9 D
;
îîD E
muestraRutasMapas
ïï %
.
ïï% & 
ListParadasMostrar
ïï& 8
=
ïï9 :
nuevasParadas
ïï; H
;
ïïH I
muestraRutasMapas
ññ %
.
ññ% &!
ListBloqueosMostrar
ññ& 9
=
ññ: ;
nuevosBloqueos
ññ< J
;
ññJ K
mapa
óó 
.
óó 
Add
óó 
(
óó 
muestraRutasMapas
óó .
)
óó. /
;
óó/ 0
}
òò 
return
öö 
View
öö 
(
öö 
mapa
öö  
)
öö  !
;
öö! "
}
õõ 
catch
úú 
(
úú 
	Exception
úú 
)
úú 
{
ùù 
return
ûû 
RedirectToAction
ûû '
(
ûû' (
$str
ûû( /
,
ûû/ 0
$str
ûû1 7
)
ûû7 8
;
ûû8 9
}
üü 
}
†† 	
public
¢¢ 
ActionResult
¢¢  
AutenticarPasosRol
¢¢ .
(
¢¢. /
int
¢¢/ 2
role
¢¢3 7
)
¢¢7 8
{
££ 	
if
§§ 
(
§§ 
!
§§ 
User
§§ 
.
§§ 
Identity
§§ 
.
§§ 
IsAuthenticated
§§ .
)
§§. /
return
§§0 6
RedirectToAction
§§7 G
(
§§G H
$str
§§H O
,
§§O P
$str
§§Q W
)
§§W X
;
§§X Y
Login
•• 
logi
•• 
=
•• 
new
•• 
Login
•• "
(
••" #
)
••# $
;
••$ %
int
¶¶ 
?
¶¶ 
roleSession
¶¶ 
=
¶¶ 
logi
¶¶ #
.
¶¶# $&
GetRoleSessionFromCookie
¶¶$ <
(
¶¶< =
Request
¶¶= D
)
¶¶D E
;
¶¶E F
if
ßß 
(
ßß 
roleSession
ßß 
==
ßß 
null
ßß #
||
ßß$ &
roleSession
ßß' 2
!=
ßß3 5
role
ßß6 :
)
ßß: ;
return
ßß< B
RedirectToAction
ßßC S
(
ßßS T
$str
ßßT [
,
ßß[ \
$str
ßß] c
)
ßßc d
;
ßßd e
return
®® 
null
®® 
;
®® 
}
©© 	
public
™™ 
ActionResult
™™ "
ReportRuta1Deviation
™™ 0
(
™™0 1
int
™™1 4
numTypeRoute
™™5 A
)
™™A B
{
´´ 	
try
¨¨ 
{
≠≠ 
Login
ÆÆ 
logi
ÆÆ 
=
ÆÆ 
new
ÆÆ  
Login
ÆÆ! &
(
ÆÆ& '
)
ÆÆ' (
;
ÆÆ( )
var
ØØ 

authResult
ØØ 
=
ØØ   
AutenticarPasosRol
ØØ! 3
(
ØØ3 4
$num
ØØ4 5
)
ØØ5 6
;
ØØ6 7
if
∞∞ 
(
∞∞ 

authResult
∞∞ 
!=
∞∞ !
null
∞∞" &
)
∞∞& '
return
∞∞( .

authResult
∞∞/ 9
;
∞∞9 :
string
≤≤ 
Line
≤≤ 
=
≤≤ 
logi
≤≤ "
.
≤≤" # 
GetLineaFromCookie
≤≤# 5
(
≤≤5 6
Request
≤≤6 =
)
≤≤= >
.
≤≤> ?
ToString
≤≤? G
(
≤≤G H
)
≤≤H I
;
≤≤I J
List
≥≥ 
<
≥≥ 
MuestraRutasMapas
≥≥ &
>
≥≥& '
mapa
≥≥( ,
=
≥≥- .
new
≥≥/ 2
List
≥≥3 7
<
≥≥7 8
MuestraRutasMapas
≥≥8 I
>
≥≥I J
(
≥≥J K
)
≥≥K L
;
≥≥L M
int
¥¥ 
count
¥¥ 
=
¥¥ 
$num
¥¥ 
;
¥¥ 
for
µµ 
(
µµ 
int
µµ 
i
µµ 
=
µµ 
$num
µµ 
;
µµ 
i
µµ  !
<=
µµ" $
$num
µµ% &
;
µµ& '
i
µµ( )
++
µµ) +
)
µµ+ ,
{
∂∂ 
MuestraRutasMapas
∑∑ %
muestraRutasMapas
∑∑& 7
=
∑∑8 9
new
∑∑: =
MuestraRutasMapas
∑∑> O
{
∏∏ 
ListRutasMostrar
ππ (
=
ππ) *
new
ππ+ .
List
ππ/ 3
<
ππ3 4
RutasMostrar
ππ4 @
>
ππ@ A
(
ππA B
)
ππB C
,
ππC D 
ListParadasMostrar
∫∫ *
=
∫∫+ ,
new
∫∫- 0
List
∫∫1 5
<
∫∫5 6
ParadasMostrar
∫∫6 D
>
∫∫D E
(
∫∫E F
)
∫∫F G
,
∫∫G H!
ListBloqueosMostrar
ªª +
=
ªª, -
new
ªª. 1
List
ªª2 6
<
ªª6 7
BloqueosMostrar
ªª7 F
>
ªªF G
(
ªªG H
)
ªªH I
,
ªªI J

NumeroRuta
ºº "
=
ºº# $
i
ºº% &
}
ΩΩ 
;
ΩΩ 
List
ææ 
<
ææ 
BloqueosMostrar
ææ (
>
ææ( )
nuevosBloqueos
ææ* 8
=
ææ9 :
new
ææ; >
List
ææ? C
<
ææC D
BloqueosMostrar
ææD S
>
ææS T
(
ææT U
)
ææU V
;
ææV W
List
øø 
<
øø 
RutasMostrar
øø %
>
øø% &
nuevasRutas
øø' 2
=
øø3 4
new
øø5 8
List
øø9 =
<
øø= >
RutasMostrar
øø> J
>
øøJ K
(
øøK L
)
øøL M
;
øøM N
List
¿¿ 
<
¿¿ 
ParadasMostrar
¿¿ '
>
¿¿' (
nuevasParadas
¿¿) 6
=
¿¿7 8
new
¿¿9 <
List
¿¿= A
<
¿¿A B
ParadasMostrar
¿¿B P
>
¿¿P Q
(
¿¿Q R
)
¿¿R S
;
¿¿S T
using
¬¬ 
(
¬¬ 
dbModels
¬¬ #
context
¬¬$ +
=
¬¬, -
new
¬¬. 1
dbModels
¬¬2 :
(
¬¬: ;
)
¬¬; <
)
¬¬< =
{
√√ 
var
ƒƒ 
checkpoints
ƒƒ '
=
ƒƒ( )
context
ƒƒ* 1
.
ƒƒ1 2

Checkpoint
ƒƒ2 <
.
ƒƒ< =
Where
ƒƒ= B
(
ƒƒB C
x
ƒƒC D
=>
ƒƒE G
x
ƒƒH I
.
ƒƒI J
idLine
ƒƒJ P
==
ƒƒQ S
Line
ƒƒT X
&&
ƒƒY [
x
ƒƒ\ ]
.
ƒƒ] ^
status
ƒƒ^ d
!=
ƒƒe g
$num
ƒƒh i
&&
ƒƒj l
x
ƒƒm n
.
ƒƒn o
numberRoute
ƒƒo z
==
ƒƒ{ }
numTypeRouteƒƒ~ ä
)ƒƒä ã
.ƒƒã å
ToListƒƒå í
(ƒƒí ì
)ƒƒì î
;ƒƒî ï
var
≈≈ 
routes
≈≈ "
=
≈≈# $
context
≈≈% ,
.
≈≈, -
Route
≈≈- 2
.
∆∆ 
Where
∆∆ "
(
∆∆" #
x
∆∆# $
=>
∆∆% '
x
∆∆( )
.
∆∆) *
idLine
∆∆* 0
==
∆∆1 3
Line
∆∆4 8
&&
∆∆9 ;
x
∆∆< =
.
∆∆= >
numberRoute
∆∆> I
==
∆∆J L
i
∆∆M N
&&
∆∆O Q
x
∆∆R S
.
∆∆S T
numTypeRoute
∆∆T `
==
∆∆a c
numTypeRoute
∆∆d p
)
∆∆p q
.
«« 
ToList
«« #
(
««# $
)
««$ %
;
««% &
var
»» 
	deviation
»» %
=
»»& '
context
»»( /
.
»»/ 0
DeviationRote
»»0 =
.
»»= >
Where
»»> C
(
»»C D
x
»»D E
=>
»»F H
x
»»I J
.
»»J K
idLine
»»K Q
==
»»R T
Line
»»U Y
&&
»»Z \
x
»»] ^
.
»»^ _
numberRoute
»»_ j
==
»»k m
i
»»n o
&&
»»p r
x
»»s t
.
»»t u
numTypeRoute»»u Å
==»»Ç Ñ
numTypeRoute»»Ö ë
)»»ë í
.»»í ì
ToList»»ì ô
(»»ô ö
)»»ö õ
;»»õ ú
if
…… 
(
…… 
	deviation
…… %
.
……% &
Count
……& +
>
……, -
$num
……. /
)
……/ 0
{
   
foreach
ÀÀ #
(
ÀÀ$ %
var
ÀÀ% (
item
ÀÀ) -
in
ÀÀ. 0
	deviation
ÀÀ1 :
)
ÀÀ: ;
{
ÃÃ 
List
ÕÕ  $
<
ÕÕ$ %
RutasMostrar
ÕÕ% 1
>
ÕÕ1 2
listBloqueos
ÕÕ3 ?
=
ÕÕ@ A
new
ÕÕB E
List
ÕÕF J
<
ÕÕJ K
RutasMostrar
ÕÕK W
>
ÕÕW X
(
ÕÕX Y
)
ÕÕY Z
;
ÕÕZ [
var
ŒŒ  #
route1
ŒŒ$ *
=
ŒŒ+ ,
routes
ŒŒ- 3
.
ŒŒ3 4
Where
ŒŒ4 9
(
ŒŒ9 :
x
ŒŒ: ;
=>
ŒŒ< >
x
ŒŒ? @
.
ŒŒ@ A
idRoute
ŒŒA H
==
ŒŒI K
item
ŒŒL P
.
ŒŒP Q
idRouteStart
ŒŒQ ]
&&
ŒŒ^ `
x
ŒŒa b
.
ŒŒb c
idLine
ŒŒc i
==
ŒŒj l
Line
ŒŒm q
)
ŒŒq r
.
ŒŒr s
FirstOrDefaultŒŒs Å
(ŒŒÅ Ç
)ŒŒÇ É
;ŒŒÉ Ñ
var
œœ  #
route2
œœ$ *
=
œœ+ ,
routes
œœ- 3
.
œœ3 4
Where
œœ4 9
(
œœ9 :
x
œœ: ;
=>
œœ< >
x
œœ? @
.
œœ@ A
idRoute
œœA H
==
œœI K
item
œœL P
.
œœP Q

idRouteEnd
œœQ [
&&
œœ\ ^
x
œœ_ `
.
œœ` a
idLine
œœa g
==
œœh j
Line
œœk o
)
œœo p
.
œœp q
FirstOrDefault
œœq 
(œœ Ä
)œœÄ Å
;œœÅ Ç
if
––  "
(
––# $
route1
––$ *
!=
––+ -
null
––. 2
&&
––3 5
route2
––6 <
!=
––= ?
null
––@ D
)
––D E
{
——  !
var
““$ '
routesDeviation
““( 7
=
““8 9
routes
““: @
.
““@ A
Where
““A F
(
““F G
x
““G H
=>
““I K
x
““L M
.
““M N
numPoint
““N V
>=
““W Y
route1
““Z `
.
““` a
numPoint
““a i
&&
““j l
x
““m n
.
““n o
numPoint
““o w
<=
““x z
route2““{ Å
.““Å Ç
numPoint““Ç ä
&&““ã ç
x““é è
.““è ê
idLine““ê ñ
==““ó ô
Line““ö û
)““û ü
.““ü †
ToList““† ¶
(““¶ ß
)““ß ®
;““® ©
foreach
””$ +
(
””, -
var
””- 0
item2
””1 6
in
””7 9
routesDeviation
””: I
)
””I J
{
‘‘$ %
listBloqueos
’’( 4
.
’’4 5
Add
’’5 8
(
’’8 9
new
’’9 <
RutasMostrar
’’= I
(
’’I J
item2
’’J O
.
’’O P
idRoute
’’P W
,
’’W X
item2
’’Y ^
.
’’^ _
latitud
’’_ f
,
’’f g
item2
’’h m
.
’’m n
logintud
’’n v
,
’’v w
$str
’’x z
,
’’z {
item2’’| Å
.’’Å Ç
status’’Ç à
,’’à â
(’’ä ã
int’’ã é
)’’é è
item2’’è î
.’’î ï
numPoint’’ï ù
)’’ù û
)’’û ü
;’’ü †
}
÷÷$ %
var
◊◊$ '
place1
◊◊( .
=
◊◊/ 0
context
◊◊1 8
.
◊◊8 9
Place
◊◊9 >
.
◊◊> ?
Where
◊◊? D
(
◊◊D E
x
◊◊E F
=>
◊◊G I
x
◊◊J K
.
◊◊K L
idPlace
◊◊L S
==
◊◊T V
route1
◊◊W ]
.
◊◊] ^
idPlace
◊◊^ e
)
◊◊e f
.
◊◊f g
FirstOrDefault
◊◊g u
(
◊◊u v
)
◊◊v w
;
◊◊w x
var
ÿÿ$ '
place2
ÿÿ( .
=
ÿÿ/ 0
context
ÿÿ1 8
.
ÿÿ8 9
Place
ÿÿ9 >
.
ÿÿ> ?
Where
ÿÿ? D
(
ÿÿD E
x
ÿÿE F
=>
ÿÿG I
x
ÿÿJ K
.
ÿÿK L
idPlace
ÿÿL S
==
ÿÿT V
route2
ÿÿW ]
.
ÿÿ] ^
idPlace
ÿÿ^ e
)
ÿÿe f
.
ÿÿf g
FirstOrDefault
ÿÿg u
(
ÿÿu v
)
ÿÿv w
;
ÿÿw x
nuevosBloqueos
ŸŸ$ 2
.
ŸŸ2 3
Add
ŸŸ3 6
(
ŸŸ6 7
new
ŸŸ7 :
BloqueosMostrar
ŸŸ; J
(
ŸŸJ K
item
ŸŸK O
.
ŸŸO P
idDeviation
ŸŸP [
,
ŸŸ[ \
$str
ŸŸ] g
+
ŸŸh i
place1
ŸŸj p
.
ŸŸp q
description
ŸŸq |
+
ŸŸ} ~
$strŸŸ Ñ
+ŸŸÖ Ü
place2ŸŸá ç
.ŸŸç é
descriptionŸŸé ô
,ŸŸô ö
listBloqueosŸŸõ ß
)ŸŸß ®
)ŸŸ® ©
;ŸŸ© ™
}
⁄⁄  !
}
€€ 
}
‹‹ 
if
›› 
(
›› 
routes
›› "
.
››" #
Count
››# (
>
››) *
$num
››+ ,
)
››, -
{
ﬁﬁ 
count
ﬂﬂ !
=
ﬂﬂ" #
$num
ﬂﬂ$ %
;
ﬂﬂ% &
foreach
‡‡ #
(
‡‡$ %
var
‡‡% (
item
‡‡) -
in
‡‡. 0
routes
‡‡1 7
)
‡‡7 8
{
·· 
count
‚‚  %
++
‚‚% '
;
‚‚' (
Place
„„  %
place
„„& +
=
„„, -
context
„„. 5
.
„„5 6
Place
„„6 ;
.
„„; <
FirstOrDefault
„„< J
(
„„J K
x
„„K L
=>
„„M O
x
„„P Q
.
„„Q R
idPlace
„„R Y
==
„„Z \
item
„„] a
.
„„a b
idPlace
„„b i
)
„„i j
;
„„j k
if
‰‰  "
(
‰‰# $
place
‰‰$ )
!=
‰‰* ,
null
‰‰- 1
)
‰‰1 2
{
ÂÂ  !
nuevasRutas
ÊÊ$ /
.
ÊÊ/ 0
Add
ÊÊ0 3
(
ÊÊ3 4
new
ÊÊ4 7
RutasMostrar
ÊÊ8 D
(
ÊÊD E
item
ÊÊE I
.
ÊÊI J
idRoute
ÊÊJ Q
,
ÊÊQ R
item
ÊÊS W
.
ÊÊW X
latitud
ÊÊX _
,
ÊÊ_ `
item
ÊÊa e
.
ÊÊe f
logintud
ÊÊf n
,
ÊÊn o
place
ÊÊp u
.
ÊÊu v
descriptionÊÊv Å
,ÊÊÅ Ç
itemÊÊÉ á
.ÊÊá à
statusÊÊà é
,ÊÊé è
(ÊÊê ë
intÊÊë î
)ÊÊî ï
itemÊÊï ô
.ÊÊô ö
numPointÊÊö ¢
)ÊÊ¢ £
)ÊÊ£ §
;ÊÊ§ •
}
ÁÁ  !
}
ËË 
if
ÍÍ 
(
ÍÍ  
nuevasRutas
ÍÍ  +
.
ÍÍ+ ,
Any
ÍÍ, /
(
ÍÍ/ 0
)
ÍÍ0 1
)
ÍÍ1 2
{
ÎÎ 
RutasMostrar
ÏÏ  ,
primeraRuta
ÏÏ- 8
=
ÏÏ9 :
nuevasRutas
ÏÏ; F
.
ÏÏF G
FirstOrDefault
ÏÏG U
(
ÏÏU V
r
ÏÏV W
=>
ÏÏX Z
r
ÏÏ[ \
.
ÏÏ\ ]
status
ÏÏ] c
==
ÏÏd f
$num
ÏÏg h
)
ÏÏh i
;
ÏÏi j
if
ÌÌ  "
(
ÌÌ# $
primeraRuta
ÌÌ$ /
!=
ÌÌ0 2
null
ÌÌ3 7
)
ÌÌ7 8
{
ÓÓ  !
nuevasRutas
ÔÔ$ /
=
ÔÔ0 1
nuevasRutas
ÔÔ2 =
.
( )
OrderBy
) 0
(
0 1
route
1 6
=>
7 9
route
: ?
.
? @
numPoint
@ H
)
H I
.
ÒÒ( )
ToList
ÒÒ) /
(
ÒÒ/ 0
)
ÒÒ0 1
;
ÒÒ1 2
}
ÚÚ  !
}
ÛÛ 
count
ÙÙ !
=
ÙÙ" #
$num
ÙÙ$ %
;
ÙÙ% &
foreach
ıı #
(
ıı$ %
var
ıı% (
item
ıı) -
in
ıı. 0
nuevasRutas
ıı1 <
)
ıı< =
{
ˆˆ 
item
˜˜  $
.
˜˜$ %
name
˜˜% )
=
˜˜* +
item
˜˜, 0
.
˜˜0 1
name
˜˜1 5
+
˜˜6 7
$str
˜˜8 ;
+
˜˜< =
count
˜˜> C
;
˜˜C D
count
¯¯  %
++
¯¯% '
;
¯¯' (
}
˘˘ 
}
˙˙ 
if
¸¸ 
(
¸¸ 
checkpoints
¸¸ '
.
¸¸' (
Count
¸¸( -
>
¸¸. /
$num
¸¸0 1
)
¸¸1 2
{
˝˝ 
count
˛˛ !
=
˛˛" #
$num
˛˛$ %
;
˛˛% &
foreach
ˇˇ #
(
ˇˇ$ %
var
ˇˇ% (
item
ˇˇ) -
in
ˇˇ. 0
checkpoints
ˇˇ1 <
)
ˇˇ< =
{
ÄÄ 
count
ÅÅ  %
++
ÅÅ% '
;
ÅÅ' (
nuevasParadas
ÇÇ  -
.
ÇÇ- .
Add
ÇÇ. 1
(
ÇÇ1 2
new
ÇÇ2 5
ParadasMostrar
ÇÇ6 D
(
ÇÇD E
item
ÇÇE I
.
ÇÇI J
idCheckpoint
ÇÇJ V
,
ÇÇV W
item
ÇÇX \
.
ÇÇ\ ]
description
ÇÇ] h
,
ÇÇh i
item
ÇÇj n
.
ÇÇn o
status
ÇÇo u
,
ÇÇu v
item
ÇÇw {
.
ÇÇ{ |
latitudÇÇ| É
,ÇÇÉ Ñ
itemÇÇÖ â
.ÇÇâ ä
longitudÇÇä í
)ÇÇí ì
)ÇÇì î
;ÇÇî ï
}
ÉÉ 
if
ÖÖ 
(
ÖÖ  
nuevasParadas
ÖÖ  -
.
ÖÖ- .
Any
ÖÖ. 1
(
ÖÖ1 2
)
ÖÖ2 3
)
ÖÖ3 4
{
ÜÜ 
ParadasMostrar
áá  .
primeraParada
áá/ <
=
áá= >
nuevasParadas
áá? L
.
ááL M
FirstOrDefault
ááM [
(
áá[ \
r
áá\ ]
=>
áá^ `
r
ááa b
.
ááb c
status
áác i
==
ááj l
$num
áám n
)
áán o
;
ááo p
if
àà  "
(
àà# $
primeraParada
àà$ 1
!=
àà2 4
null
àà5 9
)
àà9 :
{
ââ  !
nuevasParadas
ää$ 1
=
ää2 3
nuevasParadas
ää4 A
.
ãã( )
OrderBy
ãã) 0
(
ãã0 1
route
ãã1 6
=>
ãã7 9
muestraRutasMapas
ãã: K
.
ããK L(
CalcularDistanciaHaversine
ããL f
(
ããf g
(
åå, -
decimal
åå- 4
)
åå4 5
primeraParada
åå5 B
.
ååB C
latitud
ååC J
,
ååJ K
(
çç, -
decimal
çç- 4
)
çç4 5
primeraParada
çç5 B
.
ççB C
longitud
ççC K
,
ççK L
route
éé, 1
.
éé1 2
latitud
éé2 9
,
éé9 :
route
èè, 1
.
èè1 2
longitud
èè2 :
)
èè: ;
)
èè; <
.
êê( )
ToList
êê) /
(
êê/ 0
)
êê0 1
;
êê1 2
}
ëë  !
}
íí 
count
ìì !
=
ìì" #
$num
ìì$ %
;
ìì% &
foreach
îî #
(
îî$ %
var
îî% (
item
îî) -
in
îî. 0
nuevasParadas
îî1 >
)
îî> ?
{
ïï 
item
ññ  $
.
ññ$ %
description
ññ% 0
=
ññ1 2
item
ññ3 7
.
ññ7 8
description
ññ8 C
+
ññD E
$str
ññF I
+
ññJ K
count
ññL Q
;
ññQ R
count
óó  %
++
óó% '
;
óó' (
}
òò 
}
ôô 
}
öö 
muestraRutasMapas
õõ %
.
õõ% &
ListRutasMostrar
õõ& 6
=
õõ7 8
nuevasRutas
õõ9 D
;
õõD E
muestraRutasMapas
úú %
.
úú% & 
ListParadasMostrar
úú& 8
=
úú9 :
nuevasParadas
úú; H
;
úúH I
muestraRutasMapas
ùù %
.
ùù% &!
ListBloqueosMostrar
ùù& 9
=
ùù: ;
nuevosBloqueos
ùù< J
;
ùùJ K
mapa
ûû 
.
ûû 
Add
ûû 
(
ûû 
muestraRutasMapas
ûû .
)
ûû. /
;
ûû/ 0
ViewBag
üü 
.
üü 
numTypeRoute
üü (
=
üü) *
numTypeRoute
üü+ 7
;
üü7 8
}
†† 
return
¢¢ 
View
¢¢ 
(
¢¢ 
mapa
¢¢  
)
¢¢  !
;
¢¢! "
}
££ 
catch
§§ 
(
§§ 
	Exception
§§ 
)
§§ 
{
•• 
return
¶¶ 
RedirectToAction
¶¶ '
(
¶¶' (
$str
¶¶( /
,
¶¶/ 0
$str
¶¶1 7
)
¶¶7 8
;
¶¶8 9
}
ßß 
}
®® 	
[
©© 	
HttpPost
©©	 
]
©© 
public
™™ 
ActionResult
™™ "
ReportRuta1Deviation
™™ 0
(
™™0 1
string
™™1 7
ubicaciones
™™8 C
,
™™C D
int
™™E H
numTypeRoute
™™I U
)
™™U V
{
´´ 	
try
¨¨ 
{
≠≠ 
Login
ÆÆ 
logi
ÆÆ 
=
ÆÆ 
new
ÆÆ  
Login
ÆÆ! &
(
ÆÆ& '
)
ÆÆ' (
;
ÆÆ( )
var
ØØ 

authResult
ØØ 
=
ØØ   
AutenticarPasosRol
ØØ! 3
(
ØØ3 4
$num
ØØ4 5
)
ØØ5 6
;
ØØ6 7
if
∞∞ 
(
∞∞ 

authResult
∞∞ 
!=
∞∞ !
null
∞∞" &
)
∞∞& '
return
∞∞( .

authResult
∞∞/ 9
;
∞∞9 :
string
±± 
Line
±± 
=
±± 
logi
±± "
.
±±" # 
GetLineaFromCookie
±±# 5
(
±±5 6
Request
±±6 =
)
±±= >
.
±±> ?
ToString
±±? G
(
±±G H
)
±±H I
;
±±I J
string
≥≥ 
[
≥≥ 
]
≥≥  
ubicacionesConvert
≥≥ +
=
≥≥, -
ubicaciones
≥≥. 9
.
≥≥9 :
Split
≥≥: ?
(
≥≥? @
new
≥≥@ C
[
≥≥C D
]
≥≥D E
{
≥≥F G
$char
≥≥H L
}
≥≥M N
,
≥≥N O 
StringSplitOptions
≥≥P b
.
≥≥b c 
RemoveEmptyEntries
≥≥c u
)
≥≥u v
;
≥≥v w
if
µµ 
(
µµ  
ubicacionesConvert
µµ &
.
µµ& '
Length
µµ' -
==
µµ. 0
$num
µµ1 2
)
µµ2 3
{
∂∂ 
string
∏∏ 
[
∏∏ 
]
∏∏ 
primeraUbicacion
∏∏ -
=
∏∏. / 
ubicacionesConvert
∏∏0 B
[
∏∏B C
$num
∏∏C D
]
∏∏D E
.
∏∏E F
Split
∏∏F K
(
∏∏K L
$char
∏∏L O
)
∏∏O P
;
∏∏P Q
decimal
ππ 
latitud1
ππ $
=
ππ% &
Convert
ππ' .
.
ππ. /
	ToDecimal
ππ/ 8
(
ππ8 9
primeraUbicacion
ππ9 I
[
ππI J
$num
ππJ K
]
ππK L
,
ππL M
System
ππN T
.
ππT U
Globalization
ππU b
.
ππb c
CultureInfo
ππc n
.
ππn o
InvariantCulture
ππo 
)ππ Ä
;ππÄ Å
decimal
∫∫ 
	longitud1
∫∫ %
=
∫∫& '
Convert
∫∫( /
.
∫∫/ 0
	ToDecimal
∫∫0 9
(
∫∫9 :
primeraUbicacion
∫∫: J
[
∫∫J K
$num
∫∫K L
]
∫∫L M
,
∫∫M N
System
∫∫O U
.
∫∫U V
Globalization
∫∫V c
.
∫∫c d
CultureInfo
∫∫d o
.
∫∫o p
InvariantCulture∫∫p Ä
)∫∫Ä Å
;∫∫Å Ç
string
ΩΩ 
[
ΩΩ 
]
ΩΩ 
segundaUbicacion
ΩΩ -
=
ΩΩ. / 
ubicacionesConvert
ΩΩ0 B
[
ΩΩB C
$num
ΩΩC D
]
ΩΩD E
.
ΩΩE F
Split
ΩΩF K
(
ΩΩK L
$char
ΩΩL O
)
ΩΩO P
;
ΩΩP Q
decimal
ææ 
latitud2
ææ $
=
ææ% &
Convert
ææ' .
.
ææ. /
	ToDecimal
ææ/ 8
(
ææ8 9
segundaUbicacion
ææ9 I
[
ææI J
$num
ææJ K
]
ææK L
,
ææL M
System
ææN T
.
ææT U
Globalization
ææU b
.
ææb c
CultureInfo
ææc n
.
ææn o
InvariantCulture
ææo 
)ææ Ä
;ææÄ Å
decimal
øø 
	longitud2
øø %
=
øø& '
Convert
øø( /
.
øø/ 0
	ToDecimal
øø0 9
(
øø9 :
segundaUbicacion
øø: J
[
øøJ K
$num
øøK L
]
øøL M
,
øøM N
System
øøO U
.
øøU V
Globalization
øøV c
.
øøc d
CultureInfo
øød o
.
øøo p
InvariantCultureøøp Ä
)øøÄ Å
;øøÅ Ç
List
¡¡ 
<
¡¡ 
Route
¡¡ 
>
¡¡ 
	RouteList
¡¡  )
=
¡¡* +
new
¡¡, /
List
¡¡0 4
<
¡¡4 5
Route
¡¡5 :
>
¡¡: ;
(
¡¡; <
)
¡¡< =
;
¡¡= >
List
¡¡? C
<
¡¡C D
Route
¡¡D I
>
¡¡I J

RouteOrder
¡¡K U
=
¡¡V W
new
¡¡X [
List
¡¡\ `
<
¡¡` a
Route
¡¡a f
>
¡¡f g
(
¡¡g h
)
¡¡h i
;
¡¡i j
List
¡¡k o
<
¡¡o p
Route
¡¡p u
>
¡¡u v
RouteOrder2¡¡w Ç
=¡¡É Ñ
new¡¡Ö à
List¡¡â ç
<¡¡ç é
Route¡¡é ì
>¡¡ì î
(¡¡î ï
)¡¡ï ñ
;¡¡ñ ó
MuestraRutasMapas
¬¬ %
muestraRutasMapas
¬¬& 7
=
¬¬8 9
new
¬¬: =
MuestraRutasMapas
¬¬> O
(
¬¬O P
)
¬¬P Q
;
¬¬Q R
using
√√ 
(
√√ 
dbModels
√√ #
context
√√$ +
=
√√, -
new
√√. 1
dbModels
√√2 :
(
√√: ;
)
√√; <
)
√√< =
	RouteList
√√> G
=
√√H I
context
√√J Q
.
√√Q R
Route
√√R W
.
√√W X
Where
√√X ]
(
√√] ^
x
√√^ _
=>
√√` b
x
√√c d
.
√√d e
idLine
√√e k
==
√√l n
Line
√√o s
&&
√√t v
x
√√w x
.
√√x y
numberRoute√√y Ñ
==√√Ö á
$num√√à â
&&√√ä å
x√√ç é
.√√é è
status√√è ï
!=√√ñ ò
$num√√ô ö
&&√√õ ù
x√√û ü
.√√ü †
numTypeRoute√√† ¨
==√√≠ Ø
numTypeRoute√√∞ º
)√√º Ω
.√√Ω æ
ToList√√æ ƒ
(√√ƒ ≈
)√√≈ ∆
;√√∆ «
List
ƒƒ 
<
ƒƒ 
Route
ƒƒ 
>
ƒƒ 

RouteList2
ƒƒ  *
=
ƒƒ+ ,
	RouteList
ƒƒ- 6
;
ƒƒ6 7
int
≈≈ 
idInicio
≈≈  
=
≈≈! "
$num
≈≈# $
;
≈≈$ %
int
≈≈& )
idFinal
≈≈* 1
=
≈≈2 3
$num
≈≈4 5
;
≈≈5 6
bool
≈≈7 ;
verificacion
≈≈< H
=
≈≈I J
false
≈≈K P
;
≈≈P Q
while
∆∆ 
(
∆∆ 
verificacion
∆∆ '
==
∆∆( *
false
∆∆+ 0
)
∆∆0 1
{
«« 

RouteOrder
»» "
=
»»# $
	RouteList
»»% .
.
……$ %
OrderBy
……% ,
(
……, -
route
……- 2
=>
……3 5
muestraRutasMapas
……6 G
.
……G H(
CalcularDistanciaHaversine
……H b
(
……b c
(
  ( )
decimal
  ) 0
)
  0 1
latitud1
  1 9
,
  9 :
(
ÀÀ( )
decimal
ÀÀ) 0
)
ÀÀ0 1
	longitud1
ÀÀ1 :
,
ÀÀ: ;
(
ÃÃ( )
decimal
ÃÃ) 0
)
ÃÃ0 1
route
ÃÃ1 6
.
ÃÃ6 7
latitud
ÃÃ7 >
,
ÃÃ> ?
(
ÕÕ( )
decimal
ÕÕ) 0
)
ÕÕ0 1
route
ÕÕ1 6
.
ÕÕ6 7
logintud
ÕÕ7 ?
)
ÕÕ? @
)
ÕÕ@ A
.
ŒŒ$ %
ToList
ŒŒ% +
(
ŒŒ+ ,
)
ŒŒ, -
;
ŒŒ- .
RouteOrder2
œœ #
=
œœ$ %

RouteList2
œœ& 0
.
––$ %
OrderBy
––% ,
(
––, -
route
––- 2
=>
––3 5
muestraRutasMapas
––6 G
.
––G H(
CalcularDistanciaHaversine
––H b
(
––b c
(
——( )
decimal
——) 0
)
——0 1
latitud2
——1 9
,
——9 :
(
““( )
decimal
““) 0
)
““0 1
	longitud2
““1 :
,
““: ;
(
””( )
decimal
””) 0
)
””0 1
route
””1 6
.
””6 7
latitud
””7 >
,
””> ?
(
‘‘( )
decimal
‘‘) 0
)
‘‘0 1
route
‘‘1 6
.
‘‘6 7
logintud
‘‘7 ?
)
‘‘? @
)
‘‘@ A
.
’’$ %
ToList
’’% +
(
’’+ ,
)
’’, -
;
’’- .
if
÷÷ 
(
÷÷ 

RouteOrder
÷÷ &
[
÷÷& '
$num
÷÷' (
]
÷÷( )
==
÷÷* ,
null
÷÷- 1
||
÷÷2 4
RouteOrder2
÷÷5 @
[
÷÷@ A
$num
÷÷A B
]
÷÷B C
==
÷÷D F
null
÷÷G K
)
÷÷K L
{
◊◊ 
return
ÿÿ "
RedirectToAction
ÿÿ# 3
(
ÿÿ3 4
$str
ÿÿ4 ;
,
ÿÿ; <
$str
ÿÿ= E
)
ÿÿE F
;
ÿÿF G
}
ŸŸ 
if
⁄⁄ 
(
⁄⁄ 

RouteOrder
⁄⁄ &
[
⁄⁄& '
$num
⁄⁄' (
]
⁄⁄( )
.
⁄⁄) *
numPoint
⁄⁄* 2
>
⁄⁄3 4
RouteOrder2
⁄⁄5 @
[
⁄⁄@ A
$num
⁄⁄A B
]
⁄⁄B C
.
⁄⁄C D
numPoint
⁄⁄D L
)
⁄⁄L M
{
€€ 
idInicio
‹‹ $
=
‹‹% &
int
‹‹' *
.
‹‹* +
Parse
‹‹+ 0
(
‹‹0 1
RouteOrder2
‹‹1 <
[
‹‹< =
$num
‹‹= >
]
‹‹> ?
.
‹‹? @
idRoute
‹‹@ G
.
‹‹G H
ToString
‹‹H P
(
‹‹P Q
)
‹‹Q R
)
‹‹R S
;
‹‹S T
idFinal
›› #
=
››$ %
int
››& )
.
››) *
Parse
››* /
(
››/ 0

RouteOrder
››0 :
[
››: ;
$num
››; <
]
››< =
.
››= >
idRoute
››> E
.
››E F
ToString
››F N
(
››N O
)
››O P
)
››P Q
;
››Q R
}
ﬁﬁ 
else
ﬂﬂ 
{
‡‡ 
idFinal
·· #
=
··$ %
int
··& )
.
··) *
Parse
··* /
(
··/ 0
RouteOrder2
··0 ;
[
··; <
$num
··< =
]
··= >
.
··> ?
idRoute
··? F
.
··F G
ToString
··G O
(
··O P
)
··P Q
)
··Q R
;
··R S
idInicio
‚‚ $
=
‚‚% &
int
‚‚' *
.
‚‚* +
Parse
‚‚+ 0
(
‚‚0 1

RouteOrder
‚‚1 ;
[
‚‚; <
$num
‚‚< =
]
‚‚= >
.
‚‚> ?
idRoute
‚‚? F
.
‚‚F G
ToString
‚‚G O
(
‚‚O P
)
‚‚P Q
)
‚‚Q R
;
‚‚R S
}
„„ 
if
‰‰ 
(
‰‰ 
idInicio
‰‰ $
!=
‰‰% '
idFinal
‰‰( /
)
‰‰/ 0
verificacion
‰‰1 =
=
‰‰> ?
true
‰‰@ D
;
‰‰D E
}
ÂÂ 
using
ÊÊ 
(
ÊÊ 
dbModels
ÊÊ #
context
ÊÊ$ +
=
ÊÊ, -
new
ÊÊ. 1
dbModels
ÊÊ2 :
(
ÊÊ: ;
)
ÊÊ; <
)
ÊÊ< =
{
ÁÁ 
DeviationRote
ËË %
deviationRoute
ËË& 4
=
ËË5 6
new
ËË7 :
DeviationRote
ËË; H
{
ÈÈ 
numberRoute
ÍÍ '
=
ÍÍ( )
$num
ÍÍ* +
,
ÍÍ+ ,
idLine
ÎÎ "
=
ÎÎ# $
Line
ÎÎ% )
,
ÎÎ) *
idRouteStart
ÏÏ (
=
ÏÏ) *
idInicio
ÏÏ+ 3
,
ÏÏ3 4

idRouteEnd
ÌÌ &
=
ÌÌ' (
idFinal
ÌÌ) 0
,
ÌÌ0 1
numTypeRoute
ÓÓ (
=
ÓÓ) *
numTypeRoute
ÓÓ+ 7
}
ÔÔ 
;
ÔÔ 
context
 
.
  
DeviationRote
  -
.
- .
Add
. 1
(
1 2
deviationRoute
2 @
)
@ A
;
A B
context
ÒÒ 
.
ÒÒ  
SaveChanges
ÒÒ  +
(
ÒÒ+ ,
)
ÒÒ, -
;
ÒÒ- .
}
ÚÚ 
return
ÛÛ 
RedirectToAction
ÛÛ +
(
ÛÛ+ ,
$str
ÛÛ, 7
,
ÛÛ7 8
$str
ÛÛ9 A
,
ÛÛA B
new
ÛÛC F
{
ÛÛG H
numTypeRoute
ÛÛI U
=
ÛÛW X
numTypeRoute
ÛÛY e
}
ÛÛf g
)
ÛÛg h
;
ÛÛh i
}
ÙÙ 
else
ıı 
return
ıı 
RedirectToAction
ıı ,
(
ıı, -
$str
ıı- 8
,
ıı8 9
$str
ıı: B
,
ııB C
new
ııD G
{
ııH I
numTypeRoute
ııJ V
=
ııW X
numTypeRoute
ııY e
}
ııf g
)
ııg h
;
ııh i
}
ˆˆ 
catch
˜˜ 
(
˜˜ 
	Exception
˜˜ 
)
˜˜ 
{
¯¯ 
return
˘˘ 
RedirectToAction
˘˘ '
(
˘˘' (
$str
˘˘( /
,
˘˘/ 0
$str
˘˘1 7
)
˘˘7 8
;
˘˘8 9
}
˙˙ 
}
˚˚ 	
public
¸¸ 
ActionResult
¸¸ "
ReportRuta2Deviation
¸¸ 0
(
¸¸0 1
int
¸¸1 4
numTypeRoute
¸¸5 A
)
¸¸A B
{
˝˝ 	
try
˛˛ 
{
ˇˇ 
Login
ÄÄ 
logi
ÄÄ 
=
ÄÄ 
new
ÄÄ  
Login
ÄÄ! &
(
ÄÄ& '
)
ÄÄ' (
;
ÄÄ( )
var
ÅÅ 

authResult
ÅÅ 
=
ÅÅ   
AutenticarPasosRol
ÅÅ! 3
(
ÅÅ3 4
$num
ÅÅ4 5
)
ÅÅ5 6
;
ÅÅ6 7
if
ÇÇ 
(
ÇÇ 

authResult
ÇÇ 
!=
ÇÇ !
null
ÇÇ" &
)
ÇÇ& '
return
ÇÇ( .

authResult
ÇÇ/ 9
;
ÇÇ9 :
string
ÑÑ 
Line
ÑÑ 
=
ÑÑ 
logi
ÑÑ "
.
ÑÑ" # 
GetLineaFromCookie
ÑÑ# 5
(
ÑÑ5 6
Request
ÑÑ6 =
)
ÑÑ= >
.
ÑÑ> ?
ToString
ÑÑ? G
(
ÑÑG H
)
ÑÑH I
;
ÑÑI J
List
ÖÖ 
<
ÖÖ 
MuestraRutasMapas
ÖÖ &
>
ÖÖ& '
mapa
ÖÖ( ,
=
ÖÖ- .
new
ÖÖ/ 2
List
ÖÖ3 7
<
ÖÖ7 8
MuestraRutasMapas
ÖÖ8 I
>
ÖÖI J
(
ÖÖJ K
)
ÖÖK L
;
ÖÖL M
int
ÜÜ 
count
ÜÜ 
=
ÜÜ 
$num
ÜÜ 
;
ÜÜ 
for
áá 
(
áá 
int
áá 
i
áá 
=
áá 
$num
áá 
;
áá 
i
áá  !
<=
áá" $
$num
áá% &
;
áá& '
i
áá( )
++
áá) +
)
áá+ ,
{
àà 
MuestraRutasMapas
ââ %
muestraRutasMapas
ââ& 7
=
ââ8 9
new
ââ: =
MuestraRutasMapas
ââ> O
{
ää 
ListRutasMostrar
ãã (
=
ãã) *
new
ãã+ .
List
ãã/ 3
<
ãã3 4
RutasMostrar
ãã4 @
>
ãã@ A
(
ããA B
)
ããB C
,
ããC D 
ListParadasMostrar
åå *
=
åå+ ,
new
åå- 0
List
åå1 5
<
åå5 6
ParadasMostrar
åå6 D
>
ååD E
(
ååE F
)
ååF G
,
ååG H!
ListBloqueosMostrar
çç +
=
çç, -
new
çç. 1
List
çç2 6
<
çç6 7
BloqueosMostrar
çç7 F
>
ççF G
(
ççG H
)
ççH I
,
ççI J

NumeroRuta
éé "
=
éé# $
i
éé% &
}
èè 
;
èè 
List
êê 
<
êê 
BloqueosMostrar
êê (
>
êê( )
nuevosBloqueos
êê* 8
=
êê9 :
new
êê; >
List
êê? C
<
êêC D
BloqueosMostrar
êêD S
>
êêS T
(
êêT U
)
êêU V
;
êêV W
List
ëë 
<
ëë 
RutasMostrar
ëë %
>
ëë% &
nuevasRutas
ëë' 2
=
ëë3 4
new
ëë5 8
List
ëë9 =
<
ëë= >
RutasMostrar
ëë> J
>
ëëJ K
(
ëëK L
)
ëëL M
;
ëëM N
List
íí 
<
íí 
ParadasMostrar
íí '
>
íí' (
nuevasParadas
íí) 6
=
íí7 8
new
íí9 <
List
íí= A
<
ííA B
ParadasMostrar
ííB P
>
ííP Q
(
ííQ R
)
ííR S
;
ííS T
using
îî 
(
îî 
dbModels
îî #
context
îî$ +
=
îî, -
new
îî. 1
dbModels
îî2 :
(
îî: ;
)
îî; <
)
îî< =
{
ïï 
var
ññ 
checkpoints
ññ '
=
ññ( )
context
ññ* 1
.
ññ1 2

Checkpoint
ññ2 <
.
ññ< =
Where
ññ= B
(
ññB C
x
ññC D
=>
ññE G
x
ññH I
.
ññI J
idLine
ññJ P
==
ññQ S
Line
ññT X
&&
ññY [
x
ññ\ ]
.
ññ] ^
status
ññ^ d
!=
ññe g
$num
ññh i
&&
ññj l
x
ññm n
.
ññn o
numberRoute
ñño z
==
ññ{ }
numTypeRouteññ~ ä
)ññä ã
.ññã å
ToListññå í
(ññí ì
)ññì î
;ññî ï
var
óó 
routes
óó "
=
óó# $
context
óó% ,
.
óó, -
Route
óó- 2
.
òò 
Where
òò "
(
òò" #
x
òò# $
=>
òò% '
x
òò( )
.
òò) *
idLine
òò* 0
==
òò1 3
Line
òò4 8
&&
òò9 ;
x
òò< =
.
òò= >
numberRoute
òò> I
==
òòJ L
i
òòM N
&&
òòO Q
x
òòR S
.
òòS T
numTypeRoute
òòT `
==
òòa c
numTypeRoute
òòd p
)
òòp q
.
ôô 
ToList
ôô #
(
ôô# $
)
ôô$ %
;
ôô% &
var
öö 
	deviation
öö %
=
öö& '
context
öö( /
.
öö/ 0
DeviationRote
öö0 =
.
öö= >
Where
öö> C
(
ööC D
x
ööD E
=>
ööF H
x
ööI J
.
ööJ K
idLine
ööK Q
==
ööR T
Line
ööU Y
&&
ööZ \
x
öö] ^
.
öö^ _
numberRoute
öö_ j
==
öök m
i
öön o
&&
ööp r
x
öös t
.
ööt u
numTypeRouteööu Å
==ööÇ Ñ
numTypeRouteööÖ ë
)ööë í
.ööí ì
ToListööì ô
(ööô ö
)ööö õ
;ööõ ú
if
õõ 
(
õõ 
	deviation
õõ %
.
õõ% &
Count
õõ& +
>
õõ, -
$num
õõ. /
)
õõ/ 0
{
úú 
foreach
ùù #
(
ùù$ %
var
ùù% (
item
ùù) -
in
ùù. 0
	deviation
ùù1 :
)
ùù: ;
{
ûû 
List
üü  $
<
üü$ %
RutasMostrar
üü% 1
>
üü1 2
listBloqueos
üü3 ?
=
üü@ A
new
üüB E
List
üüF J
<
üüJ K
RutasMostrar
üüK W
>
üüW X
(
üüX Y
)
üüY Z
;
üüZ [
var
††  #
route1
††$ *
=
††+ ,
routes
††- 3
.
††3 4
Where
††4 9
(
††9 :
x
††: ;
=>
††< >
x
††? @
.
††@ A
idRoute
††A H
==
††I K
item
††L P
.
††P Q
idRouteStart
††Q ]
&&
††^ `
x
††a b
.
††b c
idLine
††c i
==
††j l
Line
††m q
)
††q r
.
††r s
FirstOrDefault††s Å
(††Å Ç
)††Ç É
;††É Ñ
var
°°  #
route2
°°$ *
=
°°+ ,
routes
°°- 3
.
°°3 4
Where
°°4 9
(
°°9 :
x
°°: ;
=>
°°< >
x
°°? @
.
°°@ A
idRoute
°°A H
==
°°I K
item
°°L P
.
°°P Q

idRouteEnd
°°Q [
&&
°°\ ^
x
°°_ `
.
°°` a
idLine
°°a g
==
°°h j
Line
°°k o
)
°°o p
.
°°p q
FirstOrDefault
°°q 
(°° Ä
)°°Ä Å
;°°Å Ç
if
¢¢  "
(
¢¢# $
route1
¢¢$ *
!=
¢¢+ -
null
¢¢. 2
&&
¢¢3 5
route2
¢¢6 <
!=
¢¢= ?
null
¢¢@ D
)
¢¢D E
{
££  !
var
§§$ '
routesDeviation
§§( 7
=
§§8 9
routes
§§: @
.
§§@ A
Where
§§A F
(
§§F G
x
§§G H
=>
§§I K
x
§§L M
.
§§M N
numPoint
§§N V
>=
§§W Y
route1
§§Z `
.
§§` a
numPoint
§§a i
&&
§§j l
x
§§m n
.
§§n o
numPoint
§§o w
<=
§§x z
route2§§{ Å
.§§Å Ç
numPoint§§Ç ä
&&§§ã ç
x§§é è
.§§è ê
idLine§§ê ñ
==§§ó ô
Line§§ö û
)§§û ü
.§§ü †
ToList§§† ¶
(§§¶ ß
)§§ß ®
;§§® ©
foreach
••$ +
(
••, -
var
••- 0
item2
••1 6
in
••7 9
routesDeviation
••: I
)
••I J
{
¶¶$ %
listBloqueos
ßß( 4
.
ßß4 5
Add
ßß5 8
(
ßß8 9
new
ßß9 <
RutasMostrar
ßß= I
(
ßßI J
item2
ßßJ O
.
ßßO P
idRoute
ßßP W
,
ßßW X
item2
ßßY ^
.
ßß^ _
latitud
ßß_ f
,
ßßf g
item2
ßßh m
.
ßßm n
logintud
ßßn v
,
ßßv w
$str
ßßx z
,
ßßz {
item2ßß| Å
.ßßÅ Ç
statusßßÇ à
,ßßà â
(ßßä ã
intßßã é
)ßßé è
item2ßßè î
.ßßî ï
numPointßßï ù
)ßßù û
)ßßû ü
;ßßü †
}
®®$ %
var
©©$ '
place1
©©( .
=
©©/ 0
context
©©1 8
.
©©8 9
Place
©©9 >
.
©©> ?
Where
©©? D
(
©©D E
x
©©E F
=>
©©G I
x
©©J K
.
©©K L
idPlace
©©L S
==
©©T V
route1
©©W ]
.
©©] ^
idPlace
©©^ e
)
©©e f
.
©©f g
FirstOrDefault
©©g u
(
©©u v
)
©©v w
;
©©w x
var
™™$ '
place2
™™( .
=
™™/ 0
context
™™1 8
.
™™8 9
Place
™™9 >
.
™™> ?
Where
™™? D
(
™™D E
x
™™E F
=>
™™G I
x
™™J K
.
™™K L
idPlace
™™L S
==
™™T V
route2
™™W ]
.
™™] ^
idPlace
™™^ e
)
™™e f
.
™™f g
FirstOrDefault
™™g u
(
™™u v
)
™™v w
;
™™w x
nuevosBloqueos
´´$ 2
.
´´2 3
Add
´´3 6
(
´´6 7
new
´´7 :
BloqueosMostrar
´´; J
(
´´J K
item
´´K O
.
´´O P
idDeviation
´´P [
,
´´[ \
$str
´´] g
+
´´h i
place1
´´j p
.
´´p q
description
´´q |
+
´´} ~
$str´´ Ñ
+´´Ö Ü
place2´´á ç
.´´ç é
description´´é ô
,´´ô ö
listBloqueos´´õ ß
)´´ß ®
)´´® ©
;´´© ™
}
¨¨  !
}
≠≠ 
}
ÆÆ 
if
ØØ 
(
ØØ 
routes
ØØ "
.
ØØ" #
Count
ØØ# (
>
ØØ) *
$num
ØØ+ ,
)
ØØ, -
{
∞∞ 
count
±± !
=
±±" #
$num
±±$ %
;
±±% &
foreach
≤≤ #
(
≤≤$ %
var
≤≤% (
item
≤≤) -
in
≤≤. 0
routes
≤≤1 7
)
≤≤7 8
{
≥≥ 
count
¥¥  %
++
¥¥% '
;
¥¥' (
Place
µµ  %
place
µµ& +
=
µµ, -
context
µµ. 5
.
µµ5 6
Place
µµ6 ;
.
µµ; <
FirstOrDefault
µµ< J
(
µµJ K
x
µµK L
=>
µµM O
x
µµP Q
.
µµQ R
idPlace
µµR Y
==
µµZ \
item
µµ] a
.
µµa b
idPlace
µµb i
)
µµi j
;
µµj k
if
∂∂  "
(
∂∂# $
place
∂∂$ )
!=
∂∂* ,
null
∂∂- 1
)
∂∂1 2
{
∑∑  !
nuevasRutas
∏∏$ /
.
∏∏/ 0
Add
∏∏0 3
(
∏∏3 4
new
∏∏4 7
RutasMostrar
∏∏8 D
(
∏∏D E
item
∏∏E I
.
∏∏I J
idRoute
∏∏J Q
,
∏∏Q R
item
∏∏S W
.
∏∏W X
latitud
∏∏X _
,
∏∏_ `
item
∏∏a e
.
∏∏e f
logintud
∏∏f n
,
∏∏n o
place
∏∏p u
.
∏∏u v
description∏∏v Å
,∏∏Å Ç
item∏∏É á
.∏∏á à
status∏∏à é
,∏∏é è
(∏∏ê ë
int∏∏ë î
)∏∏î ï
item∏∏ï ô
.∏∏ô ö
numPoint∏∏ö ¢
)∏∏¢ £
)∏∏£ §
;∏∏§ •
}
ππ  !
}
∫∫ 
if
ºº 
(
ºº  
nuevasRutas
ºº  +
.
ºº+ ,
Any
ºº, /
(
ºº/ 0
)
ºº0 1
)
ºº1 2
{
ΩΩ 
RutasMostrar
ææ  ,
primeraRuta
ææ- 8
=
ææ9 :
nuevasRutas
ææ; F
.
ææF G
FirstOrDefault
ææG U
(
ææU V
r
ææV W
=>
ææX Z
r
ææ[ \
.
ææ\ ]
status
ææ] c
==
ææd f
$num
ææg h
)
ææh i
;
ææi j
if
øø  "
(
øø# $
primeraRuta
øø$ /
!=
øø0 2
null
øø3 7
)
øø7 8
{
¿¿  !
nuevasRutas
¡¡$ /
=
¡¡0 1
nuevasRutas
¡¡2 =
.
¬¬( )
OrderBy
¬¬) 0
(
¬¬0 1
route
¬¬1 6
=>
¬¬7 9
route
¬¬: ?
.
¬¬? @
numPoint
¬¬@ H
)
¬¬H I
.
√√( )
ToList
√√) /
(
√√/ 0
)
√√0 1
;
√√1 2
}
ƒƒ  !
}
≈≈ 
count
∆∆ !
=
∆∆" #
$num
∆∆$ %
;
∆∆% &
foreach
«« #
(
««$ %
var
««% (
item
««) -
in
««. 0
nuevasRutas
««1 <
)
««< =
{
»» 
item
……  $
.
……$ %
name
……% )
=
……* +
item
……, 0
.
……0 1
name
……1 5
+
……6 7
$str
……8 ;
+
……< =
count
……> C
;
……C D
count
    %
++
  % '
;
  ' (
}
ÀÀ 
}
ÃÃ 
if
ŒŒ 
(
ŒŒ 
checkpoints
ŒŒ '
.
ŒŒ' (
Count
ŒŒ( -
>
ŒŒ. /
$num
ŒŒ0 1
)
ŒŒ1 2
{
œœ 
count
–– !
=
––" #
$num
––$ %
;
––% &
foreach
—— #
(
——$ %
var
——% (
item
——) -
in
——. 0
checkpoints
——1 <
)
——< =
{
““ 
count
””  %
++
””% '
;
””' (
nuevasParadas
‘‘  -
.
‘‘- .
Add
‘‘. 1
(
‘‘1 2
new
‘‘2 5
ParadasMostrar
‘‘6 D
(
‘‘D E
item
‘‘E I
.
‘‘I J
idCheckpoint
‘‘J V
,
‘‘V W
item
‘‘X \
.
‘‘\ ]
description
‘‘] h
,
‘‘h i
item
‘‘j n
.
‘‘n o
status
‘‘o u
,
‘‘u v
item
‘‘w {
.
‘‘{ |
latitud‘‘| É
,‘‘É Ñ
item‘‘Ö â
.‘‘â ä
longitud‘‘ä í
)‘‘í ì
)‘‘ì î
;‘‘î ï
}
’’ 
if
◊◊ 
(
◊◊  
nuevasParadas
◊◊  -
.
◊◊- .
Any
◊◊. 1
(
◊◊1 2
)
◊◊2 3
)
◊◊3 4
{
ÿÿ 
ParadasMostrar
ŸŸ  .
primeraParada
ŸŸ/ <
=
ŸŸ= >
nuevasParadas
ŸŸ? L
.
ŸŸL M
FirstOrDefault
ŸŸM [
(
ŸŸ[ \
r
ŸŸ\ ]
=>
ŸŸ^ `
r
ŸŸa b
.
ŸŸb c
status
ŸŸc i
==
ŸŸj l
$num
ŸŸm n
)
ŸŸn o
;
ŸŸo p
if
⁄⁄  "
(
⁄⁄# $
primeraParada
⁄⁄$ 1
!=
⁄⁄2 4
null
⁄⁄5 9
)
⁄⁄9 :
{
€€  !
nuevasParadas
‹‹$ 1
=
‹‹2 3
nuevasParadas
‹‹4 A
.
››( )
OrderBy
››) 0
(
››0 1
route
››1 6
=>
››7 9
muestraRutasMapas
››: K
.
››K L(
CalcularDistanciaHaversine
››L f
(
››f g
(
ﬁﬁ, -
decimal
ﬁﬁ- 4
)
ﬁﬁ4 5
primeraParada
ﬁﬁ5 B
.
ﬁﬁB C
latitud
ﬁﬁC J
,
ﬁﬁJ K
(
ﬂﬂ, -
decimal
ﬂﬂ- 4
)
ﬂﬂ4 5
primeraParada
ﬂﬂ5 B
.
ﬂﬂB C
longitud
ﬂﬂC K
,
ﬂﬂK L
route
‡‡, 1
.
‡‡1 2
latitud
‡‡2 9
,
‡‡9 :
route
··, 1
.
··1 2
longitud
··2 :
)
··: ;
)
··; <
.
‚‚( )
ToList
‚‚) /
(
‚‚/ 0
)
‚‚0 1
;
‚‚1 2
}
„„  !
}
‰‰ 
count
ÂÂ !
=
ÂÂ" #
$num
ÂÂ$ %
;
ÂÂ% &
foreach
ÊÊ #
(
ÊÊ$ %
var
ÊÊ% (
item
ÊÊ) -
in
ÊÊ. 0
nuevasParadas
ÊÊ1 >
)
ÊÊ> ?
{
ÁÁ 
item
ËË  $
.
ËË$ %
description
ËË% 0
=
ËË1 2
item
ËË3 7
.
ËË7 8
description
ËË8 C
+
ËËD E
$str
ËËF I
+
ËËJ K
count
ËËL Q
;
ËËQ R
count
ÈÈ  %
++
ÈÈ% '
;
ÈÈ' (
}
ÍÍ 
}
ÎÎ 
}
ÏÏ 
muestraRutasMapas
ÌÌ %
.
ÌÌ% &
ListRutasMostrar
ÌÌ& 6
=
ÌÌ7 8
nuevasRutas
ÌÌ9 D
;
ÌÌD E
muestraRutasMapas
ÓÓ %
.
ÓÓ% & 
ListParadasMostrar
ÓÓ& 8
=
ÓÓ9 :
nuevasParadas
ÓÓ; H
;
ÓÓH I
muestraRutasMapas
ÔÔ %
.
ÔÔ% &!
ListBloqueosMostrar
ÔÔ& 9
=
ÔÔ: ;
nuevosBloqueos
ÔÔ< J
;
ÔÔJ K
mapa
 
.
 
Add
 
(
 
muestraRutasMapas
 .
)
. /
;
/ 0
ViewBag
ÒÒ 
.
ÒÒ 
numTypeRoute
ÒÒ (
=
ÒÒ) *
numTypeRoute
ÒÒ+ 7
;
ÒÒ7 8
}
ÚÚ 
return
ÙÙ 
View
ÙÙ 
(
ÙÙ 
mapa
ÙÙ  
)
ÙÙ  !
;
ÙÙ! "
}
ıı 
catch
ˆˆ 
(
ˆˆ 
	Exception
ˆˆ 
)
ˆˆ 
{
˜˜ 
return
¯¯ 
RedirectToAction
¯¯ '
(
¯¯' (
$str
¯¯( /
,
¯¯/ 0
$str
¯¯1 7
)
¯¯7 8
;
¯¯8 9
}
˘˘ 
}
˙˙ 	
[
˚˚ 	
HttpPost
˚˚	 
]
˚˚ 
public
¸¸ 
ActionResult
¸¸ "
ReportRuta2Deviation
¸¸ 0
(
¸¸0 1
string
¸¸1 7
ubicaciones
¸¸8 C
,
¸¸C D
int
¸¸E H
numTypeRoute
¸¸I U
)
¸¸U V
{
˝˝ 	
try
˛˛ 
{
ˇˇ 
Login
ÄÄ 
logi
ÄÄ 
=
ÄÄ 
new
ÄÄ  
Login
ÄÄ! &
(
ÄÄ& '
)
ÄÄ' (
;
ÄÄ( )
var
ÅÅ 

authResult
ÅÅ 
=
ÅÅ   
AutenticarPasosRol
ÅÅ! 3
(
ÅÅ3 4
$num
ÅÅ4 5
)
ÅÅ5 6
;
ÅÅ6 7
if
ÇÇ 
(
ÇÇ 

authResult
ÇÇ 
!=
ÇÇ !
null
ÇÇ" &
)
ÇÇ& '
return
ÇÇ( .

authResult
ÇÇ/ 9
;
ÇÇ9 :
string
ÉÉ 
Line
ÉÉ 
=
ÉÉ 
logi
ÉÉ "
.
ÉÉ" # 
GetLineaFromCookie
ÉÉ# 5
(
ÉÉ5 6
Request
ÉÉ6 =
)
ÉÉ= >
.
ÉÉ> ?
ToString
ÉÉ? G
(
ÉÉG H
)
ÉÉH I
;
ÉÉI J
string
ÖÖ 
[
ÖÖ 
]
ÖÖ  
ubicacionesConvert
ÖÖ +
=
ÖÖ, -
ubicaciones
ÖÖ. 9
.
ÖÖ9 :
Split
ÖÖ: ?
(
ÖÖ? @
new
ÖÖ@ C
[
ÖÖC D
]
ÖÖD E
{
ÖÖF G
$char
ÖÖH L
}
ÖÖM N
,
ÖÖN O 
StringSplitOptions
ÖÖP b
.
ÖÖb c 
RemoveEmptyEntries
ÖÖc u
)
ÖÖu v
;
ÖÖv w
if
áá 
(
áá  
ubicacionesConvert
áá &
.
áá& '
Length
áá' -
==
áá. 0
$num
áá1 2
)
áá2 3
{
àà 
string
ää 
[
ää 
]
ää 
primeraUbicacion
ää -
=
ää. / 
ubicacionesConvert
ää0 B
[
ääB C
$num
ääC D
]
ääD E
.
ääE F
Split
ääF K
(
ääK L
$char
ääL O
)
ääO P
;
ääP Q
decimal
ãã 
latitud1
ãã $
=
ãã% &
Convert
ãã' .
.
ãã. /
	ToDecimal
ãã/ 8
(
ãã8 9
primeraUbicacion
ãã9 I
[
ããI J
$num
ããJ K
]
ããK L
,
ããL M
System
ããN T
.
ããT U
Globalization
ããU b
.
ããb c
CultureInfo
ããc n
.
ããn o
InvariantCulture
ãão 
)ãã Ä
;ããÄ Å
decimal
åå 
	longitud1
åå %
=
åå& '
Convert
åå( /
.
åå/ 0
	ToDecimal
åå0 9
(
åå9 :
primeraUbicacion
åå: J
[
ååJ K
$num
ååK L
]
ååL M
,
ååM N
System
ååO U
.
ååU V
Globalization
ååV c
.
ååc d
CultureInfo
ååd o
.
ååo p
InvariantCultureååp Ä
)ååÄ Å
;ååÅ Ç
string
èè 
[
èè 
]
èè 
segundaUbicacion
èè -
=
èè. / 
ubicacionesConvert
èè0 B
[
èèB C
$num
èèC D
]
èèD E
.
èèE F
Split
èèF K
(
èèK L
$char
èèL O
)
èèO P
;
èèP Q
decimal
êê 
latitud2
êê $
=
êê% &
Convert
êê' .
.
êê. /
	ToDecimal
êê/ 8
(
êê8 9
segundaUbicacion
êê9 I
[
êêI J
$num
êêJ K
]
êêK L
,
êêL M
System
êêN T
.
êêT U
Globalization
êêU b
.
êêb c
CultureInfo
êêc n
.
êên o
InvariantCulture
êêo 
)êê Ä
;êêÄ Å
decimal
ëë 
	longitud2
ëë %
=
ëë& '
Convert
ëë( /
.
ëë/ 0
	ToDecimal
ëë0 9
(
ëë9 :
segundaUbicacion
ëë: J
[
ëëJ K
$num
ëëK L
]
ëëL M
,
ëëM N
System
ëëO U
.
ëëU V
Globalization
ëëV c
.
ëëc d
CultureInfo
ëëd o
.
ëëo p
InvariantCultureëëp Ä
)ëëÄ Å
;ëëÅ Ç
List
ìì 
<
ìì 
Route
ìì 
>
ìì 
	RouteList
ìì  )
=
ìì* +
new
ìì, /
List
ìì0 4
<
ìì4 5
Route
ìì5 :
>
ìì: ;
(
ìì; <
)
ìì< =
;
ìì= >
List
ìì? C
<
ììC D
Route
ììD I
>
ììI J

RouteOrder
ììK U
=
ììV W
new
ììX [
List
ìì\ `
<
ìì` a
Route
ììa f
>
ììf g
(
ììg h
)
ììh i
;
ììi j
List
ììk o
<
ììo p
Route
ììp u
>
ììu v
RouteOrder2ììw Ç
=ììÉ Ñ
newììÖ à
Listììâ ç
<ììç é
Routeììé ì
>ììì î
(ììî ï
)ììï ñ
;ììñ ó
MuestraRutasMapas
îî %
muestraRutasMapas
îî& 7
=
îî8 9
new
îî: =
MuestraRutasMapas
îî> O
(
îîO P
)
îîP Q
;
îîQ R
using
ïï 
(
ïï 
dbModels
ïï #
context
ïï$ +
=
ïï, -
new
ïï. 1
dbModels
ïï2 :
(
ïï: ;
)
ïï; <
)
ïï< =
	RouteList
ïï> G
=
ïïH I
context
ïïJ Q
.
ïïQ R
Route
ïïR W
.
ïïW X
Where
ïïX ]
(
ïï] ^
x
ïï^ _
=>
ïï` b
x
ïïc d
.
ïïd e
idLine
ïïe k
==
ïïl n
Line
ïïo s
&&
ïït v
x
ïïw x
.
ïïx y
numberRouteïïy Ñ
==ïïÖ á
$numïïà â
&&ïïä å
xïïç é
.ïïé è
statusïïè ï
!=ïïñ ò
$numïïô ö
&&ïïõ ù
xïïû ü
.ïïü †
numTypeRouteïï† ¨
==ïï≠ Ø
numTypeRouteïï∞ º
)ïïº Ω
.ïïΩ æ
ToListïïæ ƒ
(ïïƒ ≈
)ïï≈ ∆
;ïï∆ «
List
ññ 
<
ññ 
Route
ññ 
>
ññ 

RouteList2
ññ  *
=
ññ+ ,
	RouteList
ññ- 6
;
ññ6 7
int
óó 
idInicio
óó  
=
óó! "
$num
óó# $
;
óó$ %
int
óó& )
idFinal
óó* 1
=
óó2 3
$num
óó4 5
;
óó5 6
bool
óó7 ;
verificacion
óó< H
=
óóI J
false
óóK P
;
óóP Q
while
òò 
(
òò 
verificacion
òò '
==
òò( *
false
òò+ 0
)
òò0 1
{
ôô 

RouteOrder
öö "
=
öö# $
	RouteList
öö% .
.
õõ$ %
OrderBy
õõ% ,
(
õõ, -
route
õõ- 2
=>
õõ3 5
muestraRutasMapas
õõ6 G
.
õõG H(
CalcularDistanciaHaversine
õõH b
(
õõb c
(
úú( )
decimal
úú) 0
)
úú0 1
latitud1
úú1 9
,
úú9 :
(
ùù( )
decimal
ùù) 0
)
ùù0 1
	longitud1
ùù1 :
,
ùù: ;
(
ûû( )
decimal
ûû) 0
)
ûû0 1
route
ûû1 6
.
ûû6 7
latitud
ûû7 >
,
ûû> ?
(
üü( )
decimal
üü) 0
)
üü0 1
route
üü1 6
.
üü6 7
logintud
üü7 ?
)
üü? @
)
üü@ A
.
††$ %
ToList
††% +
(
††+ ,
)
††, -
;
††- .
RouteOrder2
°° #
=
°°$ %

RouteList2
°°& 0
.
¢¢$ %
OrderBy
¢¢% ,
(
¢¢, -
route
¢¢- 2
=>
¢¢3 5
muestraRutasMapas
¢¢6 G
.
¢¢G H(
CalcularDistanciaHaversine
¢¢H b
(
¢¢b c
(
££( )
decimal
££) 0
)
££0 1
latitud2
££1 9
,
££9 :
(
§§( )
decimal
§§) 0
)
§§0 1
	longitud2
§§1 :
,
§§: ;
(
••( )
decimal
••) 0
)
••0 1
route
••1 6
.
••6 7
latitud
••7 >
,
••> ?
(
¶¶( )
decimal
¶¶) 0
)
¶¶0 1
route
¶¶1 6
.
¶¶6 7
logintud
¶¶7 ?
)
¶¶? @
)
¶¶@ A
.
ßß$ %
ToList
ßß% +
(
ßß+ ,
)
ßß, -
;
ßß- .
if
®® 
(
®® 

RouteOrder
®® &
[
®®& '
$num
®®' (
]
®®( )
==
®®* ,
null
®®- 1
||
®®2 4
RouteOrder2
®®5 @
[
®®@ A
$num
®®A B
]
®®B C
==
®®D F
null
®®G K
)
®®K L
{
©© 
return
™™ "
RedirectToAction
™™# 3
(
™™3 4
$str
™™4 ;
,
™™; <
$str
™™= E
)
™™E F
;
™™F G
}
´´ 
if
¨¨ 
(
¨¨ 

RouteOrder
¨¨ &
[
¨¨& '
$num
¨¨' (
]
¨¨( )
.
¨¨) *
numPoint
¨¨* 2
>
¨¨3 4
RouteOrder2
¨¨5 @
[
¨¨@ A
$num
¨¨A B
]
¨¨B C
.
¨¨C D
numPoint
¨¨D L
)
¨¨L M
{
≠≠ 
idInicio
ÆÆ $
=
ÆÆ% &
int
ÆÆ' *
.
ÆÆ* +
Parse
ÆÆ+ 0
(
ÆÆ0 1
RouteOrder2
ÆÆ1 <
[
ÆÆ< =
$num
ÆÆ= >
]
ÆÆ> ?
.
ÆÆ? @
idRoute
ÆÆ@ G
.
ÆÆG H
ToString
ÆÆH P
(
ÆÆP Q
)
ÆÆQ R
)
ÆÆR S
;
ÆÆS T
idFinal
ØØ #
=
ØØ$ %
int
ØØ& )
.
ØØ) *
Parse
ØØ* /
(
ØØ/ 0

RouteOrder
ØØ0 :
[
ØØ: ;
$num
ØØ; <
]
ØØ< =
.
ØØ= >
idRoute
ØØ> E
.
ØØE F
ToString
ØØF N
(
ØØN O
)
ØØO P
)
ØØP Q
;
ØØQ R
}
∞∞ 
else
±± 
{
≤≤ 
idFinal
≥≥ #
=
≥≥$ %
int
≥≥& )
.
≥≥) *
Parse
≥≥* /
(
≥≥/ 0
RouteOrder2
≥≥0 ;
[
≥≥; <
$num
≥≥< =
]
≥≥= >
.
≥≥> ?
idRoute
≥≥? F
.
≥≥F G
ToString
≥≥G O
(
≥≥O P
)
≥≥P Q
)
≥≥Q R
;
≥≥R S
idInicio
¥¥ $
=
¥¥% &
int
¥¥' *
.
¥¥* +
Parse
¥¥+ 0
(
¥¥0 1

RouteOrder
¥¥1 ;
[
¥¥; <
$num
¥¥< =
]
¥¥= >
.
¥¥> ?
idRoute
¥¥? F
.
¥¥F G
ToString
¥¥G O
(
¥¥O P
)
¥¥P Q
)
¥¥Q R
;
¥¥R S
}
µµ 
if
∂∂ 
(
∂∂ 
idInicio
∂∂ $
!=
∂∂% '
idFinal
∂∂( /
)
∂∂/ 0
verificacion
∂∂1 =
=
∂∂> ?
true
∂∂@ D
;
∂∂D E
}
∑∑ 
using
∏∏ 
(
∏∏ 
dbModels
∏∏ #
context
∏∏$ +
=
∏∏, -
new
∏∏. 1
dbModels
∏∏2 :
(
∏∏: ;
)
∏∏; <
)
∏∏< =
{
ππ 
DeviationRote
∫∫ %
deviationRoute
∫∫& 4
=
∫∫5 6
new
∫∫7 :
DeviationRote
∫∫; H
{
ªª 
numberRoute
ºº '
=
ºº( )
$num
ºº* +
,
ºº+ ,
idLine
ΩΩ "
=
ΩΩ# $
Line
ΩΩ% )
,
ΩΩ) *
idRouteStart
ææ (
=
ææ) *
idInicio
ææ+ 3
,
ææ3 4

idRouteEnd
øø &
=
øø' (
idFinal
øø) 0
,
øø0 1
numTypeRoute
¿¿ (
=
¿¿) *
numTypeRoute
¿¿+ 7
}
¡¡ 
;
¡¡ 
context
¬¬ 
.
¬¬  
DeviationRote
¬¬  -
.
¬¬- .
Add
¬¬. 1
(
¬¬1 2
deviationRoute
¬¬2 @
)
¬¬@ A
;
¬¬A B
context
√√ 
.
√√  
SaveChanges
√√  +
(
√√+ ,
)
√√, -
;
√√- .
}
ƒƒ 
return
≈≈ 
RedirectToAction
≈≈ +
(
≈≈+ ,
$str
≈≈, 7
,
≈≈7 8
$str
≈≈9 A
,
≈≈A B
new
≈≈C F
{
≈≈G H
numTypeRoute
≈≈I U
=
≈≈V W
numTypeRoute
≈≈X d
}
≈≈e f
)
≈≈f g
;
≈≈g h
}
∆∆ 
else
«« 
return
«« 
RedirectToAction
«« ,
(
««, -
$str
««- 8
,
««8 9
$str
««: B
,
««B C
new
««D G
{
««H I
numTypeRoute
««J V
=
««W X
numTypeRoute
««Y e
}
««f g
)
««g h
;
««h i
}
»» 
catch
…… 
(
…… 
	Exception
…… 
)
…… 
{
   
return
ÀÀ 
RedirectToAction
ÀÀ '
(
ÀÀ' (
$str
ÀÀ( /
,
ÀÀ/ 0
$str
ÀÀ1 7
)
ÀÀ7 8
;
ÀÀ8 9
}
ÃÃ 
}
ÕÕ 	
public
ŒŒ 
ActionResult
ŒŒ /
!reportChoferBusMechanicalFailures
ŒŒ =
(
ŒŒ= >
string
ŒŒ> D
description
ŒŒE P
)
ŒŒP Q
{
œœ 	
try
–– 
{
—— 
Login
““ 
logi
““ 
=
““ 
new
““  
Login
““! &
(
““& '
)
““' (
;
““( )
var
”” 

authResult
”” 
=
””   
AutenticarPasosRol
””! 3
(
””3 4
$num
””4 5
)
””5 6
;
””6 7
if
‘‘ 
(
‘‘ 

authResult
‘‘ 
!=
‘‘ !
null
‘‘" &
)
‘‘& '
return
‘‘( .

authResult
‘‘/ 9
;
‘‘9 :
string
’’ 
Line
’’ 
=
’’ 
logi
’’ "
.
’’" # 
GetLineaFromCookie
’’# 5
(
’’5 6
Request
’’6 =
)
’’= >
.
’’> ?
ToString
’’? G
(
’’G H
)
’’H I
;
’’I J
string
÷÷ 
Employe
÷÷ 
=
÷÷  
logi
÷÷! %
.
÷÷% &%
GetEmployeeIdFromCookie
÷÷& =
(
÷÷= >
Request
÷÷> E
)
÷÷E F
.
÷÷F G
ToString
÷÷G O
(
÷÷O P
)
÷÷P Q
;
÷÷Q R
TimeZoneInfo
◊◊ 
boliviaTimeZone
◊◊ ,
=
◊◊- .
TimeZoneInfo
◊◊/ ;
.
◊◊; <$
FindSystemTimeZoneById
◊◊< R
(
◊◊R S
$str
◊◊S m
)
◊◊m n
;
◊◊n o
DateTime
ÿÿ 
boliviaTime
ÿÿ $
=
ÿÿ% &
TimeZoneInfo
ÿÿ' 3
.
ÿÿ3 4
ConvertTime
ÿÿ4 ?
(
ÿÿ? @
DateTime
ÿÿ@ H
.
ÿÿH I
UtcNow
ÿÿI O
,
ÿÿO P
boliviaTimeZone
ÿÿQ `
)
ÿÿ` a
;
ÿÿa b
Employee
ŸŸ 
employee
ŸŸ !
=
ŸŸ" #
new
ŸŸ$ '
Employee
ŸŸ( 0
(
ŸŸ0 1
)
ŸŸ1 2
;
ŸŸ2 3
using
⁄⁄ 
(
⁄⁄ 
dbModels
⁄⁄ 
context
⁄⁄  '
=
⁄⁄( )
new
⁄⁄* -
dbModels
⁄⁄. 6
(
⁄⁄6 7
)
⁄⁄7 8
)
⁄⁄8 9
{
€€ 
employee
‹‹ 
=
‹‹ 
context
‹‹ &
.
‹‹& '
Employee
‹‹' /
.
‹‹/ 0
Where
‹‹0 5
(
‹‹5 6
x
‹‹6 7
=>
‹‹8 :
x
‹‹; <
.
‹‹< =
status
‹‹= C
==
‹‹D F
$num
‹‹G H
&&
‹‹I K
x
‹‹L M
.
‹‹M N

idEmployee
‹‹N X
==
‹‹Y [
Employe
‹‹\ c
&&
‹‹d f
x
‹‹g h
.
‹‹h i
idLine
‹‹i o
==
‹‹p r
Line
‹‹s w
)
‹‹w x
.
‹‹x y
FirstOrDefault‹‹y á
(‹‹á à
)‹‹à â
;‹‹â ä
if
›› 
(
›› 
employee
››  
==
››! #
null
››$ (
)
››( )
return
››* 0
RedirectToAction
››1 A
(
››A B
$str
››B I
,
››I J
$str
››K Q
)
››Q R
;
››R S 
MechanicalFailures
ﬁﬁ &
report
ﬁﬁ' -
=
ﬁﬁ. /
new
ﬁﬁ0 3 
MechanicalFailures
ﬁﬁ4 F
(
ﬁﬁF G
)
ﬁﬁG H
;
ﬁﬁH I
report
ﬂﬂ 
.
ﬂﬂ 

idEmployee
ﬂﬂ %
=
ﬂﬂ& '
employee
ﬂﬂ( 0
.
ﬂﬂ0 1

idEmployee
ﬂﬂ1 ;
;
ﬂﬂ; <
report
‡‡ 
.
‡‡ 
plate
‡‡  
=
‡‡! "
employee
‡‡# +
.
‡‡+ ,
plate
‡‡, 1
;
‡‡1 2
report
·· 
.
·· 
description
·· &
=
··' (
description
··) 4
;
··4 5
report
‚‚ 
.
‚‚ 
dateRegister
‚‚ '
=
‚‚( )
boliviaTime
‚‚* 5
;
‚‚5 6
context
„„ 
.
„„  
MechanicalFailures
„„ .
.
„„. /
Add
„„/ 2
(
„„2 3
report
„„3 9
)
„„9 :
;
„„: ;
context
‰‰ 
.
‰‰ 
SaveChanges
‰‰ '
(
‰‰' (
)
‰‰( )
;
‰‰) *
}
ÂÂ 
return
ÊÊ 
RedirectToAction
ÊÊ '
(
ÊÊ' (
$str
ÊÊ( /
,
ÊÊ/ 0
$str
ÊÊ1 9
)
ÊÊ9 :
;
ÊÊ: ;
}
ÁÁ 
catch
ËË 
(
ËË 
	Exception
ËË 
)
ËË 
{
ÈÈ 
return
ÍÍ 
RedirectToAction
ÍÍ '
(
ÍÍ' (
$str
ÍÍ( /
,
ÍÍ/ 0
$str
ÍÍ1 7
)
ÍÍ7 8
;
ÍÍ8 9
}
ÎÎ 
}
ÏÏ 	
public
ÌÌ 
ActionResult
ÌÌ )
reportBusMechanicalFailures
ÌÌ 7
(
ÌÌ7 8
string
ÌÌ8 >
plate
ÌÌ? D
,
ÌÌD E
string
ÌÌF L
description
ÌÌM X
)
ÌÌX Y
{
ÓÓ 	
try
ÔÔ 
{
 
Login
ÒÒ 
logi
ÒÒ 
=
ÒÒ 
new
ÒÒ  
Login
ÒÒ! &
(
ÒÒ& '
)
ÒÒ' (
;
ÒÒ( )
var
ÚÚ 

authResult
ÚÚ 
=
ÚÚ   
AutenticarPasosRol
ÚÚ! 3
(
ÚÚ3 4
$num
ÚÚ4 5
)
ÚÚ5 6
;
ÚÚ6 7
if
ÛÛ 
(
ÛÛ 

authResult
ÛÛ 
!=
ÛÛ !
null
ÛÛ" &
)
ÛÛ& '
return
ÛÛ( .

authResult
ÛÛ/ 9
;
ÛÛ9 :
string
ÙÙ 
Line
ÙÙ 
=
ÙÙ 
logi
ÙÙ "
.
ÙÙ" # 
GetLineaFromCookie
ÙÙ# 5
(
ÙÙ5 6
Request
ÙÙ6 =
)
ÙÙ= >
.
ÙÙ> ?
ToString
ÙÙ? G
(
ÙÙG H
)
ÙÙH I
;
ÙÙI J
TimeZoneInfo
ıı 
boliviaTimeZone
ıı ,
=
ıı- .
TimeZoneInfo
ıı/ ;
.
ıı; <$
FindSystemTimeZoneById
ıı< R
(
ııR S
$str
ııS m
)
ıım n
;
ıın o
DateTime
ˆˆ 
boliviaTime
ˆˆ $
=
ˆˆ% &
TimeZoneInfo
ˆˆ' 3
.
ˆˆ3 4
ConvertTime
ˆˆ4 ?
(
ˆˆ? @
DateTime
ˆˆ@ H
.
ˆˆH I
UtcNow
ˆˆI O
,
ˆˆO P
boliviaTimeZone
ˆˆQ `
)
ˆˆ` a
;
ˆˆa b
Employee
˜˜ 
employee
˜˜ !
=
˜˜" #
new
˜˜$ '
Employee
˜˜( 0
(
˜˜0 1
)
˜˜1 2
;
˜˜2 3
using
¯¯ 
(
¯¯ 
dbModels
¯¯ 
context
¯¯  '
=
¯¯( )
new
¯¯* -
dbModels
¯¯. 6
(
¯¯6 7
)
¯¯7 8
)
¯¯8 9
{
˘˘ 
employee
˙˙ 
=
˙˙ 
context
˙˙ &
.
˙˙& '
Employee
˙˙' /
.
˙˙/ 0
Where
˙˙0 5
(
˙˙5 6
x
˙˙6 7
=>
˙˙8 :
x
˙˙; <
.
˙˙< =
status
˙˙= C
==
˙˙D F
$num
˙˙G H
&&
˙˙I K
x
˙˙L M
.
˙˙M N
plate
˙˙N S
==
˙˙T V
plate
˙˙W \
&&
˙˙] _
x
˙˙` a
.
˙˙a b
idLine
˙˙b h
==
˙˙i k
Line
˙˙l p
)
˙˙p q
.
˙˙q r
FirstOrDefault˙˙r Ä
(˙˙Ä Å
)˙˙Å Ç
;˙˙Ç É
if
˚˚ 
(
˚˚ 
employee
˚˚  
==
˚˚! #
null
˚˚$ (
)
˚˚( )
return
˚˚* 0
RedirectToAction
˚˚1 A
(
˚˚A B
$str
˚˚B I
,
˚˚I J
$str
˚˚K Q
)
˚˚Q R
;
˚˚R S 
MechanicalFailures
¸¸ &
report
¸¸' -
=
¸¸. /
new
¸¸0 3 
MechanicalFailures
¸¸4 F
(
¸¸F G
)
¸¸G H
;
¸¸H I
report
˝˝ 
.
˝˝ 

idEmployee
˝˝ %
=
˝˝& '
employee
˝˝( 0
.
˝˝0 1

idEmployee
˝˝1 ;
;
˝˝; <
report
˛˛ 
.
˛˛ 
plate
˛˛  
=
˛˛! "
plate
˛˛# (
;
˛˛( )
report
ˇˇ 
.
ˇˇ 
description
ˇˇ &
=
ˇˇ' (
description
ˇˇ) 4
;
ˇˇ4 5
report
ÄÄ 
.
ÄÄ 
dateRegister
ÄÄ '
=
ÄÄ( )
boliviaTime
ÄÄ* 5
;
ÄÄ5 6
context
ÅÅ 
.
ÅÅ  
MechanicalFailures
ÅÅ .
.
ÅÅ. /
Add
ÅÅ/ 2
(
ÅÅ2 3
report
ÅÅ3 9
)
ÅÅ9 :
;
ÅÅ: ;
context
ÇÇ 
.
ÇÇ 
SaveChanges
ÇÇ '
(
ÇÇ' (
)
ÇÇ( )
;
ÇÇ) *
}
ÉÉ 
return
ÑÑ 
RedirectToAction
ÑÑ '
(
ÑÑ' (
$str
ÑÑ( /
,
ÑÑ/ 0
$str
ÑÑ1 ;
)
ÑÑ; <
;
ÑÑ< =
}
ÖÖ 
catch
ÜÜ 
(
ÜÜ 
	Exception
ÜÜ 
)
ÜÜ 
{
áá 
return
àà 
RedirectToAction
àà '
(
àà' (
$str
àà( /
,
àà/ 0
$str
àà1 7
)
àà7 8
;
àà8 9
}
ââ 
}
ää 	
}
ãã 
}åå ò®
RC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Controllers\CheckpointController.cs
	namespace 	#
ProyectoControlLineaBus
 !
.! "
Controllers" -
{ 
public 

class  
CheckpointController %
:& '

Controller( 2
{ 
public 
ActionResult 
Index !
(! "
)" #
{ 	
try 
{ 
Login 
logi 
= 
new  
Login! &
(& '
)' (
;( )
var 

authResult 
=  
AutenticarPasosRol! 3
(3 4
$num4 5
)5 6
;6 7
if 
( 

authResult 
!= !
null" &
)& '
return( .

authResult/ 9
;9 :
string 
Linea 
= 
logi #
.# $
GetLineaFromCookie$ 6
(6 7
Request7 >
)> ?
.? @
ToString@ H
(H I
)I J
;J K
Line 
line 
= 
new 
Line  $
($ %
)% &
;& '
List 
< 
Route 
> 
routes "
=# $
new% (
List) -
<- .
Route. 3
>3 4
(4 5
)5 6
;6 7
List 
< 

Checkpoint 
>  
checkpoints! ,
=- .
new/ 2
List3 7
<7 8

Checkpoint8 B
>B C
(C D
)D E
;E F
List 
< 
Route 
> 
rutasOrdenadas *
=+ ,
new- 0
List1 5
<5 6
Route6 ;
>; <
(< =
)= >
;> ?
using 
( 
dbModels 
context  '
=( )
new* -
dbModels. 6
(6 7
)7 8
)8 9
routes: @
=A B
contextC J
.J K
RouteK P
.P Q
WhereQ V
(V W
xW X
=>Y [
x\ ]
.] ^
idLine^ d
==e g
Lineah m
)m n
.n o
ToListo u
(u v
)v w
;w x
using 
( 
dbModels 
context  '
=( )
new* -
dbModels. 6
(6 7
)7 8
)8 9
checkpoints: E
=F G
contextH O
.O P

CheckpointP Z
.Z [
Where[ `
(` a
xa b
=>c e
xf g
.g h
idLineh n
==o q
Linear w
&&x z
x{ |
.| }
status	} É
!=
Ñ Ü
$num
á à
)
à â
.
â ä
ToList
ä ê
(
ê ë
)
ë í
;
í ì
MuestraCheckpoint !
muestra" )
=* +
new, /
MuestraCheckpoint0 A
(A B
)B C
;C D
muestra 
. #
IntermediateCheckpoints /
=0 1
new2 5
List6 :
<: ;
string; A
[A B
]B C
>C D
(D E
)E F
;F G
muestra   
.   
IntermediatePoints   *
=  + ,
new  - 0
List  1 5
<  5 6
decimal  6 =
[  = >
]  > ?
>  ? @
(  @ A
)  A B
;  B C
muestra!! 
.!! 
checkpoints!! #
=!!$ %
new!!& )
List!!* .
<!!. /

Checkpoint!!/ 9
>!!9 :
(!!: ;
)!!; <
;!!< =
using"" 
("" 
dbModels"" 
context""  '
=""( )
new""* -
dbModels"". 6
(""6 7
)""7 8
)""8 9
line"": >
=""? @
context""A H
.""H I
Line""I M
.""M N
Where""N S
(""S T
x""T U
=>""V X
x""Y Z
.""Z [
nameLine""[ c
==""d f
Linea""g l
)""l m
.""m n
FirstOrDefault""n |
(""| }
)""} ~
;""~ 
if## 
(## 
routes## 
!=## 
null## "
)##" #
{$$ 
int%% 
count%% 
=%% 
$num%%  !
;%%! "
rutasOrdenadas&& "
=&&# $
routes&&% +
.&&+ ,
OrderByDescending&&, =
(&&= >
obj&&> A
=>&&B D
(&&E F
double&&F L
)&&L M
obj&&M P
.&&P Q
latitud&&Q X
-&&Y Z
(&&[ \
double&&\ b
)&&b c
obj&&c f
.&&f g
logintud&&g o
)&&o p
.&&p q
ToList&&q w
(&&w x
)&&x y
;&&y z
foreach'' 
('' 
var''  
item''! %
in''& (
rutasOrdenadas'') 7
)''7 8
using(( 
((( 
dbModels(( '
context((( /
=((0 1
new((2 5
dbModels((6 >
(((> ?
)((? @
)((@ A
{)) 
Route** !
route**" '
=**( )
context*** 1
.**1 2
Route**2 7
.**7 8
Where**8 =
(**= >
x**> ?
=>**@ B
x**C D
.**D E
idRoute**E L
==**M O
item**P T
.**T U
idRoute**U \
)**\ ]
.**] ^
FirstOrDefault**^ l
(**l m
)**m n
;**n o
if++ 
(++  
count++  %
==++& (
$num++) *
)++* +
muestra++, 3
.++3 4

StartPoint++4 >
=++? @
new++A D
decimal++E L
[++L M
]++M N
{++O P
(++Q R
decimal++R Y
)++Y Z
route++Z _
.++_ `
latitud++` g
,++g h
(++i j
decimal++j q
)++q r
route++r w
.++w x
logintud	++x Ä
}
++Å Ç
;
++Ç É
else,,  
if,,! #
(,,$ %
count,,% *
==,,+ -
rutasOrdenadas,,. <
.,,< =
Count,,= B
-,,C D
$num,,E F
),,F G
muestra,,H O
.,,O P
EndPoint,,P X
=,,Y Z
new,,[ ^
decimal,,_ f
[,,f g
],,g h
{,,i j
(,,k l
decimal,,l s
),,s t
route,,t y
.,,y z
latitud	,,z Å
,
,,Å Ç
(
,,É Ñ
decimal
,,Ñ ã
)
,,ã å
route
,,å ë
.
,,ë í
logintud
,,í ö
}
,,õ ú
;
,,ú ù
else--  
muestra--! (
.--( )
IntermediatePoints--) ;
.--; <
Add--< ?
(--? @
new--@ C
decimal--D K
[--K L
]--L M
{--N O
(--P Q
decimal--Q X
)--X Y
route--Y ^
.--^ _
latitud--_ f
,--f g
(--h i
decimal--i p
)--p q
route--q v
.--v w
logintud--w 
}
--Ä Å
)
--Å Ç
;
--Ç É
count.. !
++..! #
;..# $
}// 
}00 
if11 
(11 
checkpoints11 
!=11  "
null11# '
)11' (
{22 
foreach33 
(33 
var33  
item33! %
in33& (
checkpoints33) 4
)334 5
{44 
int55 
count55 !
=55" #
$num55$ %
;55% &
using66 
(66 
dbModels66 '
context66( /
=660 1
new662 5
dbModels666 >
(66> ?
)66? @
)66@ A
{77 

Checkpoint88 &

checkpoint88' 1
=882 3
context884 ;
.88; <

Checkpoint88< F
.88F G
Where88G L
(88L M
x88M N
=>88O Q
x88R S
.88S T
idCheckpoint88T `
==88a c
item88d h
.88h i
idCheckpoint88i u
)88u v
.88v w
FirstOrDefault	88w Ö
(
88Ö Ü
)
88Ü á
;
88á à
if99 
(99  
count99  %
==99& (
$num99) *
&&99+ -
muestra99. 5
.995 6

StartPoint996 @
==99A C
null99D H
)99H I
muestra99J Q
.99Q R

StartPoint99R \
=99] ^
new99_ b
decimal99c j
[99j k
]99k l
{99m n
(99o p
decimal99p w
)99w x

checkpoint	99x Ç
.
99Ç É
latitud
99É ä
,
99ä ã
(
99å ç
decimal
99ç î
)
99î ï

checkpoint
99ï ü
.
99ü †
longitud
99† ®
}
99© ™
;
99™ ´
muestra:: #
.::# $#
IntermediateCheckpoints::$ ;
.::; <
Add::< ?
(::? @
new::@ C
string::D J
[::J K
]::K L
{::M N

checkpoint::O Y
.::Y Z
latitud::Z a
.::a b
ToString::b j
(::j k
)::k l
,::l m

checkpoint::n x
.::x y
longitud	::y Å
.
::Å Ç
ToString
::Ç ä
(
::ä ã
)
::ã å
,
::å ç

checkpoint
::é ò
.
::ò ô
description
::ô §
}
::• ¶
)
::¶ ß
;
::ß ®
count;; !
++;;! #
;;;# $
}<< 
}== 
}>> 
if?? 
(?? 
muestra?? 
.?? 
EndPoint?? $
==??% '
null??( ,
)??, -
muestra??. 5
.??5 6
EndPoint??6 >
=??? @
muestra??A H
.??H I

StartPoint??I S
;??S T
muestra@@ 
.@@ 
checkpoints@@ #
=@@$ %
checkpoints@@& 1
;@@1 2
returnAA 
ViewAA 
(AA 
muestraAA #
)AA# $
;AA$ %
}BB 
catchCC 
(CC 
	ExceptionCC 
)CC 
{DD 
returnEE 
RedirectToActionEE '
(EE' (
$strEE( /
,EE/ 0
$strEE1 7
)EE7 8
;EE8 9
}FF 
}GG 	
publicII 
ActionResultII 
CreateII "
(II" #
)II# $
{JJ 	
varKK 

authResultKK 
=KK 
AutenticarPasosRolKK /
(KK/ 0
$numKK0 1
)KK1 2
;KK2 3
ifLL 
(LL 

authResultLL 
!=LL 
nullLL "
)LL" #
returnLL$ *

authResultLL+ 5
;LL5 6
returnMM 
ViewMM 
(MM 
)MM 
;MM 
}NN 	
[QQ 	
HttpPostQQ	 
]QQ 
publicRR 
ActionResultRR 
CreateRR "
(RR" #
AddCheckpointRR# 0
addCheckpointRR1 >
)RR> ?
{SS 	
tryTT 
{UU 
LoginVV 
logiVV 
=VV 
newVV  
LoginVV! &
(VV& '
)VV' (
;VV( )
varWW 

authResultWW 
=WW  
AutenticarPasosRolWW! 3
(WW3 4
$numWW4 5
)WW5 6
;WW6 7
ifXX 
(XX 

authResultXX 
!=XX !
nullXX" &
)XX& '
returnXX( .

authResultXX/ 9
;XX9 :
stringYY 
LineaYY 
=YY 
logiYY #
.YY# $
GetLineaFromCookieYY$ 6
(YY6 7
RequestYY7 >
)YY> ?
.YY? @
ToStringYY@ H
(YYH I
)YYI J
;YYJ K

CheckpointZZ 

checkpointZZ %
=ZZ& '
newZZ( +

CheckpointZZ, 6
(ZZ6 7
)ZZ7 8
;ZZ8 9
using[[ 
([[ 
dbModels[[ 
context[[  '
=[[( )
new[[* -
dbModels[[. 6
([[6 7
)[[7 8
)[[8 9
{\\ 

checkpoint]] 
.]] 
description]] *
=]]+ ,
addCheckpoint]]- :
.]]: ;
description]]; F
;]]F G
if^^ 
(^^ 
addCheckpoint^^ $
.^^$ %
final^^% *
)^^* +

checkpoint^^, 6
.^^6 7
status^^7 =
=^^> ?
$num^^@ A
;^^A B
else__ 

checkpoint__ #
.__# $
status__$ *
=__+ ,
$num__- .
;__. /
decimal`` 
latitud`` #
=``$ %
decimal``& -
.``- .
Parse``. 3
(``3 4
addCheckpoint``4 A
.``A B
latitud_longitud``B R
.``R S
Split``S X
(``X Y
$char``Y \
)``\ ]
[``] ^
$num``^ _
]``_ `
.``` a
ToString``a i
(``i j
)``j k
.``k l
Trim``l p
(``p q
)``q r
)``r s
;``s t
decimalaa 
longitudaa $
=aa% &
decimalaa' .
.aa. /
Parseaa/ 4
(aa4 5
addCheckpointaa5 B
.aaB C
latitud_longitudaaC S
.aaS T
SplitaaT Y
(aaY Z
$charaaZ ]
)aa] ^
[aa^ _
$numaa_ `
]aa` a
.aaa b
ToStringaab j
(aaj k
)aak l
.aal m
Trimaam q
(aaq r
)aar s
)aas t
;aat u

checkpointbb 
.bb 
idLinebb %
=bb& '
Lineabb( -
;bb- .

checkpointcc 
.cc 
latitudcc &
=cc' (
latitudcc) 0
;cc0 1

checkpointdd 
.dd 
longituddd '
=dd( )
longituddd* 2
;dd2 3

checkpointee 
.ee 
numberRouteee *
=ee+ ,
$numee- .
;ee. /
contextff 
.ff 

Checkpointff &
.ff& '
Addff' *
(ff* +

checkpointff+ 5
)ff5 6
;ff6 7
contextgg 
.gg 
SaveChangesgg '
(gg' (
)gg( )
;gg) *
}hh 
returnii 
RedirectToActionii '
(ii' (
$strii( /
)ii/ 0
;ii0 1
}jj 
catchkk 
{ll 
returnmm 
RedirectToActionmm '
(mm' (
$strmm( /
,mm/ 0
$strmm1 7
)mm7 8
;mm8 9
}nn 
}oo 	
publicqq 
ActionResultqq 
Deleteqq "
(qq" #
intqq# &
idqq' )
)qq) *
{rr 	
tryss 
{tt 
varuu 

authResultuu 
=uu  
AutenticarPasosRoluu! 3
(uu3 4
$numuu4 5
)uu5 6
;uu6 7
ifvv 
(vv 

authResultvv 
!=vv !
nullvv" &
)vv& '
returnvv( .

authResultvv/ 9
;vv9 :

Checkpointww 

checkpointww %
=ww& '
newww( +

Checkpointww, 6
(ww6 7
)ww7 8
;ww8 9
usingxx 
(xx 
dbModelsxx 
contextxx  '
=xx( )
newxx* -
dbModelsxx. 6
(xx6 7
)xx7 8
)xx8 9

checkpointxx: D
=xxE F
contextxxG N
.xxN O

CheckpointxxO Y
.xxY Z
ToListxxZ `
(xx` a
)xxa b
.xxb c
Wherexxc h
(xxh i
xxxi j
=>xxk m
xxxn o
.xxo p
idCheckpointxxp |
==xx} 
id
xxÄ Ç
)
xxÇ É
.
xxÉ Ñ
FirstOrDefault
xxÑ í
(
xxí ì
)
xxì î
;
xxî ï
usingzz 
(zz 
dbModelszz 
contextzz  '
=zz( )
newzz* -
dbModelszz. 6
(zz6 7
)zz7 8
)zz8 9
{{{ 

checkpoint|| 
.|| 
status|| %
=||& '
$num||( )
;||) *

checkpoint}} 
.}} 

idEmployee}} )
=}}* +
null}}, 0
;}}0 1
context~~ 
.~~ 
Entry~~ !
(~~! "

checkpoint~~" ,
)~~, -
.~~- .
State~~. 3
=~~4 5
System~~6 <
.~~< =
Data~~= A
.~~A B
Entity~~B H
.~~H I
EntityState~~I T
.~~T U
Modified~~U ]
;~~] ^
context 
. 
SaveChanges '
(' (
)( )
;) *
}
ÄÄ 
return
ÅÅ 
RedirectToAction
ÅÅ '
(
ÅÅ' (
$str
ÅÅ( /
,
ÅÅ/ 0
$str
ÅÅ0 7
,
ÅÅ7 8
new
ÅÅ9 <
{
ÅÅ= >
numTypeRoute
ÅÅ? K
=
ÅÅL M

checkpoint
ÅÅN X
.
ÅÅX Y
numberRoute
ÅÅY d
}
ÅÅd e
)
ÅÅe f
;
ÅÅf g
}
ÇÇ 
catch
ÉÉ 
(
ÉÉ 
	Exception
ÉÉ 
)
ÉÉ 
{
ÑÑ 
return
ÖÖ 
RedirectToAction
ÖÖ '
(
ÖÖ' (
$str
ÖÖ( /
,
ÖÖ/ 0
$str
ÖÖ1 7
)
ÖÖ7 8
;
ÖÖ8 9
}
ÜÜ 
}
áá 	
public
àà 
ActionResult
àà 
DeleteEmployee
àà *
(
àà* +
int
àà+ .
id
àà/ 1
,
àà1 2
string
àà3 9
employee
àà: B
)
ààB C
{
ââ 	
try
ää 
{
ãã 
var
åå 

authResult
åå 
=
åå   
AutenticarPasosRol
åå! 3
(
åå3 4
$num
åå4 5
)
åå5 6
;
åå6 7
if
çç 
(
çç 

authResult
çç 
!=
çç !
null
çç" &
)
çç& '
return
çç( .

authResult
çç/ 9
;
çç9 :

Checkpoint
éé 

checkpoint
éé %
=
éé& '
new
éé( +

Checkpoint
éé, 6
(
éé6 7
)
éé7 8
;
éé8 9
using
èè 
(
èè 
dbModels
èè 
context
èè  '
=
èè( )
new
èè* -
dbModels
èè. 6
(
èè6 7
)
èè7 8
)
èè8 9

checkpoint
èè: D
=
èèE F
context
èèG N
.
èèN O

Checkpoint
èèO Y
.
èèY Z
ToList
èèZ `
(
èè` a
)
èèa b
.
èèb c
Where
èèc h
(
èèh i
x
èèi j
=>
èèk m
x
èèn o
.
èèo p
idCheckpoint
èèp |
==
èè} 
idèèÄ Ç
)èèÇ É
.èèÉ Ñ
FirstOrDefaultèèÑ í
(èèí ì
)èèì î
;èèî ï
using
ëë 
(
ëë 
dbModels
ëë 
context
ëë  '
=
ëë( )
new
ëë* -
dbModels
ëë. 6
(
ëë6 7
)
ëë7 8
)
ëë8 9
{
íí 

checkpoint
ìì 
.
ìì 

idEmployee
ìì )
=
ìì* +
null
ìì, 0
;
ìì0 1
context
îî 
.
îî 
Entry
îî !
(
îî! "

checkpoint
îî" ,
)
îî, -
.
îî- .
State
îî. 3
=
îî4 5
System
îî6 <
.
îî< =
Data
îî= A
.
îîA B
Entity
îîB H
.
îîH I
EntityState
îîI T
.
îîT U
Modified
îîU ]
;
îî] ^
context
ïï 
.
ïï 
SaveChanges
ïï '
(
ïï' (
)
ïï( )
;
ïï) *
}
ññ 
return
óó 
RedirectToAction
óó '
(
óó' (
$str
óó( <
,
óó< =
$str
óó> J
,
óóJ K
new
óóL O
{
óóP Q
id
óóQ S
=
óóT U
employee
óóV ^
}
óó^ _
)
óó_ `
;
óó` a
}
òò 
catch
ôô 
(
ôô 
	Exception
ôô 
)
ôô 
{
öö 
return
õõ 
RedirectToAction
õõ '
(
õõ' (
$str
õõ( /
,
õõ/ 0
$str
õõ1 7
)
õõ7 8
;
õõ8 9
}
úú 
}
ùù 	
public
ûû 
ActionResult
ûû  
ListChecksEmployee
ûû .
(
ûû. /
string
ûû/ 5
id
ûû6 8
)
ûû8 9
{
üü 	
try
†† 
{
°° 
Login
¢¢ 
logi
¢¢ 
=
¢¢ 
new
¢¢  
Login
¢¢! &
(
¢¢& '
)
¢¢' (
;
¢¢( )
var
££ 

authResult
££ 
=
££   
AutenticarPasosRol
££! 3
(
££3 4
$num
££4 5
)
££5 6
;
££6 7
if
§§ 
(
§§ 

authResult
§§ 
!=
§§ !
null
§§" &
)
§§& '
return
§§( .

authResult
§§/ 9
;
§§9 :
string
•• 
Linea
•• 
=
•• 
logi
•• #
.
••# $ 
GetLineaFromCookie
••$ 6
(
••6 7
Request
••7 >
)
••> ?
.
••? @
ToString
••@ H
(
••H I
)
••I J
;
••J K
List
ßß 
<
ßß #
MuestraListCheckpoint
ßß *
>
ßß* +
muestra
ßß, 3
=
ßß4 5
new
ßß6 9
List
ßß: >
<
ßß> ?#
MuestraListCheckpoint
ßß? T
>
ßßT U
(
ßßU V
)
ßßV W
;
ßßW X
List
®® 
<
®® 

Checkpoint
®® 
>
®®  

checkpoint
®®! +
=
®®, -
new
®®. 1
List
®®2 6
<
®®6 7

Checkpoint
®®7 A
>
®®A B
(
®®B C
)
®®C D
;
®®D E
using
©© 
(
©© 
dbModels
©© 
context
©©  '
=
©©( )
new
©©* -
dbModels
©©. 6
(
©©6 7
)
©©7 8
)
©©8 9
{
©©: ;

checkpoint
™™ 
=
™™  
context
™™! (
.
™™( )

Checkpoint
™™) 3
.
™™3 4
Where
™™4 9
(
™™9 :
x
™™: ;
=>
™™< >
x
™™? @
.
™™@ A
idLine
™™A G
==
™™H J
Linea
™™K P
&&
™™Q S
x
™™T U
.
™™U V

idEmployee
™™V `
==
™™a c
id
™™d f
&&
™™g i
x
™™j k
.
™™k l
status
™™l r
!=
™™s u
$num
™™v w
)
™™w x
.
™™x y
ToList
™™y 
(™™ Ä
)™™Ä Å
;™™Å Ç
if
´´ 
(
´´ 

checkpoint
´´ "
==
´´# %
null
´´& *
)
´´* +
return
´´, 2
RedirectToAction
´´3 C
(
´´C D
$str
´´D K
,
´´K L
$str
´´M W
)
´´W X
;
´´X Y
foreach
¨¨ 
(
¨¨ 
var
¨¨  
item
¨¨! %
in
¨¨& (

checkpoint
¨¨) 3
)
¨¨3 4
{
≠≠ 
muestra
ÆÆ 
.
ÆÆ  
Add
ÆÆ  #
(
ÆÆ# $
new
ÆÆ$ '#
MuestraListCheckpoint
ÆÆ( =
(
ÆÆ= >
id
ÆÆ> @
,
ÆÆ@ A
item
ÆÆB F
.
ÆÆF G
idCheckpoint
ÆÆG S
,
ÆÆS T
item
ÆÆU Y
.
ÆÆY Z
description
ÆÆZ e
+
ÆÆe f
$str
ÆÆf o
+
ÆÆo p
item
ÆÆp t
.
ÆÆt u
numberRouteÆÆu Ä
)ÆÆÄ Å
)ÆÆÅ Ç
;ÆÆÇ É
}
ØØ 
}
∞∞ 
ViewBag
±± 
.
±± 
ci
±± 
=
±± 
id
±± 
;
±±  
return
≤≤ 
View
≤≤ 
(
≤≤ 
muestra
≤≤ #
)
≤≤# $
;
≤≤$ %
}
≥≥ 
catch
¥¥ 
(
¥¥ 
	Exception
¥¥ 
)
¥¥ 
{
µµ 
return
∂∂ 
RedirectToAction
∂∂ '
(
∂∂' (
$str
∂∂( /
,
∂∂/ 0
$str
∂∂1 7
)
∂∂7 8
;
∂∂8 9
}
∑∑ 
}
∏∏ 	
public
ππ 
ActionResult
ππ 
AddCheckpoint
ππ )
(
ππ) *
string
ππ* 0
id
ππ1 3
)
ππ3 4
{
∫∫ 	
try
ªª 
{
ºº 
Login
ΩΩ 
logi
ΩΩ 
=
ΩΩ 
new
ΩΩ  
Login
ΩΩ! &
(
ΩΩ& '
)
ΩΩ' (
;
ΩΩ( )
var
ææ 

authResult
ææ 
=
ææ   
AutenticarPasosRol
ææ! 3
(
ææ3 4
$num
ææ4 5
)
ææ5 6
;
ææ6 7
if
øø 
(
øø 

authResult
øø 
!=
øø !
null
øø" &
)
øø& '
return
øø( .

authResult
øø/ 9
;
øø9 :
string
¿¿ 
Linea
¿¿ 
=
¿¿ 
logi
¿¿ #
.
¿¿# $ 
GetLineaFromCookie
¿¿$ 6
(
¿¿6 7
Request
¿¿7 >
)
¿¿> ?
.
¿¿? @
ToString
¿¿@ H
(
¿¿H I
)
¿¿I J
;
¿¿J K
Session
¡¡ 
[
¡¡ 
$str
¡¡ /
]
¡¡/ 0
=
¡¡1 2
id
¡¡3 5
;
¡¡5 6
List
¬¬ 
<
¬¬ 

Checkpoint
¬¬ 
>
¬¬  

checkpoint
¬¬! +
=
¬¬, -
new
¬¬. 1
List
¬¬2 6
<
¬¬6 7

Checkpoint
¬¬7 A
>
¬¬A B
(
¬¬B C
)
¬¬C D
;
¬¬D E
List
√√ 
<
√√ 

Checkpoint
√√ 
>
√√  
check
√√! &
=
√√' (
new
√√) ,
List
√√- 1
<
√√1 2

Checkpoint
√√2 <
>
√√< =
(
√√= >
)
√√> ?
;
√√? @
using
ƒƒ 
(
ƒƒ 
dbModels
ƒƒ 
context
ƒƒ  '
=
ƒƒ( )
new
ƒƒ* -
dbModels
ƒƒ. 6
(
ƒƒ6 7
)
ƒƒ7 8
)
ƒƒ8 9
{
≈≈ 
check
∆∆ 
=
∆∆ 
context
∆∆ #
.
∆∆# $

Checkpoint
∆∆$ .
.
∆∆. /
Where
∆∆/ 4
(
∆∆4 5
x
∆∆5 6
=>
∆∆7 9
x
∆∆: ;
.
∆∆; <
idLine
∆∆< B
==
∆∆C E
Linea
∆∆F K
&&
∆∆L N
x
∆∆O P
.
∆∆P Q

idEmployee
∆∆Q [
==
∆∆\ ^
id
∆∆_ a
&&
∆∆b d
x
∆∆e f
.
∆∆f g
status
∆∆g m
!=
∆∆n p
$num
∆∆q r
)
∆∆r s
.
∆∆s t
ToList
∆∆t z
(
∆∆z {
)
∆∆{ |
;
∆∆| }

checkpoint
«« 
=
««  
context
««! (
.
««( )

Checkpoint
««) 3
.
««3 4
Where
««4 9
(
««9 :
x
««: ;
=>
««< >
x
««? @
.
««@ A
idLine
««A G
==
««H J
Linea
««K P
&&
««Q S
x
««T U
.
««U V

idEmployee
««V `
==
««a c
null
««d h
&&
««i k
x
««l m
.
««m n
status
««n t
==
««u w
$num
««x y
)
««y z
.
««z {
ToList««{ Å
(««Å Ç
)««Ç É
;««É Ñ
var
»» 
c
»» 
=
»» 
check
»» !
.
»»! "
FirstOrDefault
»»" 0
(
»»0 1
)
»»1 2
;
»»2 3
if
…… 
(
…… 
c
…… 
.
…… 
status
……  
==
……! #
$num
……$ %
||
……& (
c
……) *
.
……* +
status
……+ 1
==
……2 4
$num
……5 6
)
……6 7
{
   

checkpoint
ÀÀ "
=
ÀÀ# $
context
ÀÀ% ,
.
ÀÀ, -

Checkpoint
ÀÀ- 7
.
ÀÀ7 8
Where
ÀÀ8 =
(
ÀÀ= >
x
ÀÀ> ?
=>
ÀÀ@ B
x
ÀÀC D
.
ÀÀD E
idLine
ÀÀE K
==
ÀÀL N
Linea
ÀÀO T
&&
ÀÀU W
x
ÀÀX Y
.
ÀÀY Z

idEmployee
ÀÀZ d
==
ÀÀe g
null
ÀÀh l
&&
ÀÀm o
x
ÀÀp q
.
ÀÀq r
status
ÀÀr x
==
ÀÀy {
$num
ÀÀ| }
||ÀÀ~ Ä
xÀÀÅ Ç
.ÀÀÇ É
statusÀÀÉ â
==ÀÀä å
$numÀÀç é
)ÀÀé è
.ÀÀè ê
ToListÀÀê ñ
(ÀÀñ ó
)ÀÀó ò
;ÀÀò ô
}
ÃÃ 
var
ÕÕ 
noCoincidenLista1
ÕÕ )
=
ÕÕ* +

checkpoint
ÕÕ, 6
.
ÕÕ6 7
Where
ÕÕ7 <
(
ÕÕ< =
p1
ÕÕ= ?
=>
ÕÕ@ B
check
ÕÕC H
.
ÕÕH I
All
ÕÕI L
(
ÕÕL M
p2
ÕÕM O
=>
ÕÕP R
p1
ÕÕS U
.
ÕÕU V
numberRoute
ÕÕV a
!=
ÕÕb d
p2
ÕÕe g
.
ÕÕg h
numberRoute
ÕÕh s
)
ÕÕs t
)
ÕÕt u
.
ÕÕu v
ToList
ÕÕv |
(
ÕÕ| }
)
ÕÕ} ~
;
ÕÕ~ 
if
ŒŒ 
(
ŒŒ 

checkpoint
ŒŒ "
==
ŒŒ# %
null
ŒŒ& *
)
ŒŒ* +
return
ŒŒ, 2
RedirectToAction
ŒŒ3 C
(
ŒŒC D
$str
ŒŒD K
,
ŒŒK L
$str
ŒŒM W
)
ŒŒW X
;
ŒŒX Y
var
œœ 
lista
œœ 
=
œœ 
noCoincidenLista1
œœ  1
.
œœ1 2
Select
œœ2 8
(
œœ8 9
x
œœ9 :
=>
œœ; =
new
œœ> A
{
œœB C
idCheckpoint
–– $
=
––% &
x
––' (
.
––( )
idCheckpoint
––) 5
,
––5 6
description
—— #
=
——$ %
x
——& '
.
——' (
description
——( 3
+
——4 5
$str
——6 ?
+
——@ A
x
——B C
.
——C D
numberRoute
——D O
}
““ 
)
““ 
.
““ 
ToList
““ 
(
““ 
)
““ 
;
““  
ViewBag
”” 
.
”” 
idCheckpoint
”” (
=
””) *
new
””+ .

SelectList
””/ 9
(
””9 :
lista
””: ?
,
””? @
$str
””A O
,
””O P
$str
””Q ^
)
””^ _
;
””_ `
}
‘‘ 
ViewBag
’’ 
.
’’ 
ci
’’ 
=
’’ 
id
’’ 
;
’’  
return
÷÷ 
View
÷÷ 
(
÷÷ 
)
÷÷ 
;
÷÷ 
}
◊◊ 
catch
ÿÿ 
(
ÿÿ 
	Exception
ÿÿ 
)
ÿÿ 
{
ŸŸ 
return
⁄⁄ 
RedirectToAction
⁄⁄ '
(
⁄⁄' (
$str
⁄⁄( /
,
⁄⁄/ 0
$str
⁄⁄1 7
)
⁄⁄7 8
;
⁄⁄8 9
}
€€ 
}
‹‹ 	
[
›› 	
HttpPost
››	 
]
›› 
public
ﬁﬁ 
ActionResult
ﬁﬁ 
AddCheckpoint
ﬁﬁ )
(
ﬁﬁ) *
EmployeeControl
ﬁﬁ* 9
employeeControl
ﬁﬁ: I
)
ﬁﬁI J
{
ﬂﬂ 	
try
‡‡ 
{
·· 
Login
‚‚ 
logi
‚‚ 
=
‚‚ 
new
‚‚  
Login
‚‚! &
(
‚‚& '
)
‚‚' (
;
‚‚( )
var
„„ 

authResult
„„ 
=
„„   
AutenticarPasosRol
„„! 3
(
„„3 4
$num
„„4 5
)
„„5 6
;
„„6 7
if
‰‰ 
(
‰‰ 

authResult
‰‰ 
!=
‰‰ !
null
‰‰" &
)
‰‰& '
return
‰‰( .

authResult
‰‰/ 9
;
‰‰9 :
string
ÂÂ 
Linea
ÂÂ 
=
ÂÂ 
logi
ÂÂ #
.
ÂÂ# $ 
GetLineaFromCookie
ÂÂ$ 6
(
ÂÂ6 7
Request
ÂÂ7 >
)
ÂÂ> ?
.
ÂÂ? @
ToString
ÂÂ@ H
(
ÂÂH I
)
ÂÂI J
;
ÂÂJ K
string
ÊÊ 
ControlEmployee
ÊÊ &
=
ÊÊ' (
Session
ÊÊ) 0
[
ÊÊ0 1
$str
ÊÊ1 H
]
ÊÊH I
.
ÊÊI J
ToString
ÊÊJ R
(
ÊÊR S
)
ÊÊS T
;
ÊÊT U
List
ÁÁ 
<
ÁÁ 

Checkpoint
ÁÁ 
>
ÁÁ  

checkpoint
ÁÁ! +
=
ÁÁ, -
new
ÁÁ. 1
List
ÁÁ2 6
<
ÁÁ6 7

Checkpoint
ÁÁ7 A
>
ÁÁA B
(
ÁÁB C
)
ÁÁC D
;
ÁÁD E
using
ËË 
(
ËË 
dbModels
ËË 
context
ËË  '
=
ËË( )
new
ËË* -
dbModels
ËË. 6
(
ËË6 7
)
ËË7 8
)
ËË8 9

checkpoint
ÈÈ 
=
ÈÈ  
context
ÈÈ! (
.
ÈÈ( )

Checkpoint
ÈÈ) 3
.
ÈÈ3 4
Where
ÈÈ4 9
(
ÈÈ9 :
x
ÈÈ: ;
=>
ÈÈ< >
x
ÈÈ? @
.
ÈÈ@ A
idLine
ÈÈA G
==
ÈÈH J
Linea
ÈÈK P
&&
ÈÈQ S
x
ÈÈT U
.
ÈÈU V

idEmployee
ÈÈV `
==
ÈÈa c
null
ÈÈd h
&&
ÈÈi k
x
ÈÈl m
.
ÈÈm n
status
ÈÈn t
!=
ÈÈu w
$num
ÈÈx y
)
ÈÈy z
.
ÈÈz {
ToListÈÈ{ Å
(ÈÈÅ Ç
)ÈÈÇ É
;ÈÈÉ Ñ
if
ÍÍ 
(
ÍÍ 

checkpoint
ÍÍ 
==
ÍÍ !
null
ÍÍ" &
)
ÍÍ& '
return
ÍÍ( .
RedirectToAction
ÍÍ/ ?
(
ÍÍ? @
$str
ÍÍ@ O
,
ÍÍO P
$str
ÍÍQ X
)
ÍÍX Y
;
ÍÍY Z
ViewBag
ÎÎ 
.
ÎÎ 
idCheckpoint
ÎÎ $
=
ÎÎ% &
new
ÎÎ' *

SelectList
ÎÎ+ 5
(
ÎÎ5 6

checkpoint
ÎÎ6 @
,
ÎÎ@ A
$str
ÎÎB P
,
ÎÎP Q
$str
ÎÎR _
)
ÎÎ_ `
;
ÎÎ` a
using
ÏÏ 
(
ÏÏ 
dbModels
ÏÏ 
context
ÏÏ  '
=
ÏÏ( )
new
ÏÏ* -
dbModels
ÏÏ. 6
(
ÏÏ6 7
)
ÏÏ7 8
)
ÏÏ8 9
{
ÌÌ 

Checkpoint
ÓÓ 
c
ÓÓ  
=
ÓÓ! "
context
ÓÓ# *
.
ÓÓ* +

Checkpoint
ÓÓ+ 5
.
ÓÓ5 6
Where
ÓÓ6 ;
(
ÓÓ; <
x
ÓÓ< =
=>
ÓÓ> @
x
ÓÓA B
.
ÓÓB C
idCheckpoint
ÓÓC O
==
ÓÓP R
employeeControl
ÓÓS b
.
ÓÓb c
idCheckpoint
ÓÓc o
)
ÓÓo p
.
ÓÓp q
FirstOrDefault
ÓÓq 
(ÓÓ Ä
)ÓÓÄ Å
;ÓÓÅ Ç
c
ÔÔ 
.
ÔÔ 

idEmployee
ÔÔ  
=
ÔÔ! "
ControlEmployee
ÔÔ# 2
;
ÔÔ2 3
context
 
.
 
Entry
 !
(
! "
c
" #
)
# $
.
$ %
State
% *
=
+ ,
System
- 3
.
3 4
Data
4 8
.
8 9
Entity
9 ?
.
? @
EntityState
@ K
.
K L
Modified
L T
;
T U
context
ÒÒ 
.
ÒÒ 
SaveChanges
ÒÒ '
(
ÒÒ' (
)
ÒÒ( )
;
ÒÒ) *
}
ÚÚ 
Session
ÛÛ 
[
ÛÛ 
$str
ÛÛ /
]
ÛÛ/ 0
=
ÛÛ1 2
null
ÛÛ3 7
;
ÛÛ7 8
return
ÙÙ 
RedirectToAction
ÙÙ '
(
ÙÙ' (
$str
ÙÙ( <
,
ÙÙ< =
$str
ÙÙ> J
,
ÙÙJ K
new
ÙÙK N
{
ÙÙN O
id
ÙÙO Q
=
ÙÙR S
ControlEmployee
ÙÙT c
}
ÙÙc d
)
ÙÙd e
;
ÙÙe f
}
ıı 
catch
ˆˆ 
(
ˆˆ 
	Exception
ˆˆ 
)
ˆˆ 
{
˜˜ 
return
¯¯ 
RedirectToAction
¯¯ '
(
¯¯' (
$str
¯¯( /
,
¯¯/ 0
$str
¯¯1 7
)
¯¯7 8
;
¯¯8 9
}
˘˘ 
}
˙˙ 	
public
˚˚ 
ActionResult
˚˚  
AutenticarPasosRol
˚˚ .
(
˚˚. /
int
˚˚/ 2
role
˚˚3 7
)
˚˚7 8
{
¸¸ 	
if
˝˝ 
(
˝˝ 
!
˝˝ 
User
˝˝ 
.
˝˝ 
Identity
˝˝ 
.
˝˝ 
IsAuthenticated
˝˝ .
)
˝˝. /
return
˝˝0 6
RedirectToAction
˝˝7 G
(
˝˝G H
$str
˝˝H O
,
˝˝O P
$str
˝˝Q W
)
˝˝W X
;
˝˝X Y
Login
˛˛ 
logi
˛˛ 
=
˛˛ 
new
˛˛ 
Login
˛˛ "
(
˛˛" #
)
˛˛# $
;
˛˛$ %
int
ˇˇ 
?
ˇˇ 
roleSession
ˇˇ 
=
ˇˇ 
logi
ˇˇ #
.
ˇˇ# $&
GetRoleSessionFromCookie
ˇˇ$ <
(
ˇˇ< =
Request
ˇˇ= D
)
ˇˇD E
;
ˇˇE F
if
ÄÄ 
(
ÄÄ 
roleSession
ÄÄ 
==
ÄÄ 
null
ÄÄ #
||
ÄÄ$ &
roleSession
ÄÄ' 2
!=
ÄÄ3 5
role
ÄÄ6 :
)
ÄÄ: ;
return
ÄÄ< B
RedirectToAction
ÄÄC S
(
ÄÄS T
$str
ÄÄT [
,
ÄÄ[ \
$str
ÄÄ] c
)
ÄÄc d
;
ÄÄd e
return
ÅÅ 
null
ÅÅ 
;
ÅÅ 
}
ÇÇ 	
}
ÉÉ 
}ÑÑ ˛-
CC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Clases\Encriptado.cs
	namespace		 	#
ProyectoControlLineaBus		
 !
.		! "
Clases		" (
{

 
public 

class 

Encriptado 
{ 
public 
string 
	Encriptar 
(  
string  &
input' ,
), -
{ 	
byte 
[ 
] 
salt 
= 
new 
byte "
[" #
$num# %
]% &
;& '
using 
( 
var 
rng 
= 
new  $
RNGCryptoServiceProvider! 9
(9 :
): ;
); <
{ 
rng 
. 
GetBytes 
( 
salt !
)! "
;" #
} 
var 
argon2 
= 
new 
Argon2id %
(% &
Encoding& .
.. /
UTF8/ 3
.3 4
GetBytes4 <
(< =
input= B
)B C
)C D
;D E
argon2 
. 
Salt 
= 
salt 
; 
argon2 
. 
DegreeOfParallelism &
=' (
$num) *
;* +
argon2 
. 

MemorySize 
= 
$num  %
;% &
argon2 
. 

Iterations 
= 
$num  !
;! "
byte 
[ 
] 
hash 
= 
argon2  
.  !
GetBytes! )
() *
$num* ,
), -
;- .
byte!! 
[!! 
]!! 

saltedHash!! 
=!! 
new!!  #
byte!!$ (
[!!( )
salt!!) -
.!!- .
Length!!. 4
+!!5 6
hash!!7 ;
.!!; <
Length!!< B
]!!B C
;!!C D
Array"" 
."" 
Copy"" 
("" 
salt"" 
,"" 
$num"" 
,"" 

saltedHash""  *
,""* +
$num"", -
,""- .
salt""/ 3
.""3 4
Length""4 :
)"": ;
;""; <
Array## 
.## 
Copy## 
(## 
hash## 
,## 
$num## 
,## 

saltedHash##  *
,##* +
salt##, 0
.##0 1
Length##1 7
,##7 8
hash##9 =
.##= >
Length##> D
)##D E
;##E F
return%% 
Convert%% 
.%% 
ToBase64String%% )
(%%) *

saltedHash%%* 4
)%%4 5
;%%5 6
}&& 	
public'' 
bool'' 
VerifyPassword'' "
(''" #
string''# )
password''* 2
,''2 3
string''4 :
hashedPassword''; I
)''I J
{(( 	
byte** 
[** 
]** 

saltedHash** 
=** 
Convert**  '
.**' (
FromBase64String**( 8
(**8 9
hashedPassword**9 G
)**G H
;**H I
byte-- 
[-- 
]-- 
salt-- 
=-- 
new-- 
byte-- "
[--" #
$num--# %
]--% &
;--& '
byte.. 
[.. 
].. 

storedHash.. 
=.. 
new..  #
byte..$ (
[..( )
$num..) +
]..+ ,
;.., -
Array// 
.// 
Copy// 
(// 

saltedHash// !
,//! "
$num//# $
,//$ %
salt//& *
,//* +
$num//, -
,//- .
salt/// 3
.//3 4
Length//4 :
)//: ;
;//; <
Array00 
.00 
Copy00 
(00 

saltedHash00 !
,00! "
salt00# '
.00' (
Length00( .
,00. /

storedHash000 :
,00: ;
$num00< =
,00= >

storedHash00? I
.00I J
Length00J P
)00P Q
;00Q R
var33 
argon233 
=33 
new33 
Argon2id33 %
(33% &
Encoding33& .
.33. /
UTF833/ 3
.333 4
GetBytes334 <
(33< =
password33= E
)33E F
)33F G
;33G H
argon244 
.44 
Salt44 
=44 
salt44 
;44 
argon255 
.55 
DegreeOfParallelism55 &
=55' (
$num55) *
;55* +
argon266 
.66 

MemorySize66 
=66 
$num66  %
;66% &
argon277 
.77 

Iterations77 
=77 
$num77  !
;77! "
byte:: 
[:: 
]:: 
hash:: 
=:: 
argon2::  
.::  !
GetBytes::! )
(::) *
$num::* ,
)::, -
;::- .
for;; 
(;; 
int;; 
i;; 
=;; 
$num;; 
;;; 
i;; 
<;; 
hash;;  $
.;;$ %
Length;;% +
;;;+ ,
i;;- .
++;;. 0
);;0 1
{<< 
if== 
(== 
hash== 
[== 
i== 
]== 
!=== 

storedHash== )
[==) *
i==* +
]==+ ,
)==, -
{>> 
return?? 
false??  
;??  !
}@@ 
}AA 
returnBB 
trueBB 
;BB 
}CC 	
}DD 
}EE ‡
GC:\Users\Ferna\Desktop\ProyectoControlLineaBus\App_Start\RouteConfig.cs
	namespace 	#
ProyectoControlLineaBus
 !
{		 
public

 

class

 
RouteConfig

 
{ 
public 
static 
void 
RegisterRoutes )
() *
RouteCollection* 9
routes: @
)@ A
{ 	
routes 
. 
IgnoreRoute 
( 
$str ;
); <
;< =
routes 
. 
MapRoute 
( 
name 
: 
$str 
,  
url 
: 
$str 1
,1 2
defaults 
: 
new 
{ 

controller  *
=+ ,
$str- 3
,3 4
action5 ;
=< =
$str> E
,E F
idG I
=J K
UrlParameterL X
.X Y
OptionalY a
}b c
) 
; 
} 	
} 
} Î
MC:\Users\Ferna\Desktop\ProyectoControlLineaBus\Controllers\AdminController.cs
	namespace		 	#
ProyectoControlLineaBus		
 !
.		! "
Controllers		" -
{

 
public 

class 
AdminController  
:! "

Controller# -
{ 
public 
ActionResult 
Index !
(! "
)" #
{ 	
try 
{ 
var 

authResult 
=  
AutenticarPasosRol! 3
(3 4
$num4 5
)5 6
;6 7
if 
( 

authResult 
!= !
null" &
)& '
return( .

authResult/ 9
;9 :
using 
( 
dbModels 
context  '
=( )
new* -
dbModels. 6
(6 7
)7 8
)8 9
{ 
List 
< 
Person 
>  
person! '
=( )
context* 1
.1 2
Person2 8
.8 9
Where9 >
(> ?
x? @
=>A C
xD E
.E F
idRoleF L
==M O
$numP Q
&&R T
xU V
.V W
statusW ]
==^ `
$numa b
)b c
.c d
ToListd j
(j k
)k l
;l m
return 
View 
(  
person  &
)& '
;' (
} 
} 
catch 
( 
	Exception 
) 
{ 
return 
RedirectToAction '
(' (
$str( /
,/ 0
$str1 7
)7 8
;8 9
} 
} 	
public 
ActionResult 
VerificationGestor .
(. /
)/ 0
{   	
try!! 
{"" 
var## 

authResult## 
=##  
AutenticarPasosRol##! 3
(##3 4
$num##4 5
)##5 6
;##6 7
if$$ 
($$ 

authResult$$ 
!=$$ !
null$$" &
)$$& '
return$$( .

authResult$$/ 9
;$$9 :
return%% 
View%% 
(%% 
)%% 
;%% 
}&& 
catch'' 
('' 
	Exception'' 
)'' 
{(( 
return)) 
RedirectToAction)) '
())' (
$str))( /
,))/ 0
$str))1 7
)))7 8
;))8 9
}** 
},, 	
[.. 	
HttpPost..	 
].. 
public// 
ActionResult// 
VerificationGestor// .
(//. /
EmployeeChofer/// =
employeechofer//> L
)//L M
{00 	
try11 
{22 
var33 

authResult33 
=33  
AutenticarPasosRol33! 3
(333 4
$num334 5
)335 6
;336 7
if44 
(44 

authResult44 
!=44 !
null44" &
)44& '
return44( .

authResult44/ 9
;449 :
employeechofer55 
.55 

idEmployee55 )
=55* +
employeechofer55, :
.55: ;

idEmployee55; E
.55E F
ToString55F N
(55N O
)55O P
.55P Q
ToUpper55Q X
(55X Y
)55Y Z
.55Z [
Trim55[ _
(55_ `
)55` a
;55a b
Employee66 
em66 
=66 
new66 !
Employee66" *
(66* +
)66+ ,
;66, -
Person77 
person77 
=77 
new77  #
Person77$ *
(77* +
)77+ ,
;77, -
using88 
(88 
dbModels88 
context88  '
=88( )
new88* -
dbModels88. 6
(886 7
)887 8
)888 9
person88: @
=88A B
context88C J
.88J K
Person88K Q
.88Q R
Where88R W
(88W X
x88X Y
=>88Z \
x88] ^
.88^ _
nit88_ b
.88b c
ToUpper88c j
(88j k
)88k l
.88l m
ToString88m u
(88u v
)88v w
.88w x
Trim88x |
(88| }
)88} ~
==	88 Å
employeechofer
88Ç ê
.
88ê ë

idEmployee
88ë õ
&&
88ú û
x
88ü †
.
88† °
status
88° ß
==
88® ™
$num
88´ ¨
)
88¨ ≠
.
88≠ Æ
FirstOrDefault
88Æ º
(
88º Ω
)
88Ω æ
;
88æ ø
Session99 
[99 
$str99  
]99  !
=99" #
employeechofer99$ 2
.992 3

idEmployee993 =
;99= >
if:: 
(:: 
person:: 
==:: 
null:: "
)::" #
return::$ *
RedirectToAction::+ ;
(::; <
$str::< D
)::D E
;::E F
ViewBag;; 
.;; 
NIT;; 
=;; 
$str;; 4
;;;4 5
return<< 
View<< 
(<< 
)<< 
;<< 
}== 
catch>> 
(>> 
	Exception>> 
)>> 
{?? 
return@@ 
RedirectToAction@@ '
(@@' (
$str@@( /
,@@/ 0
$str@@1 7
)@@7 8
;@@8 9
}AA 
}CC 	
publicFF 
ActionResultFF 
CreateFF "
(FF" #
)FF# $
{GG 	
tryHH 
{II 
LoginJJ 
logiJJ 
=JJ 
newJJ  
LoginJJ! &
(JJ& '
)JJ' (
;JJ( )
varKK 

authResultKK 
=KK  
AutenticarPasosRolKK! 3
(KK3 4
$numKK4 5
)KK5 6
;KK6 7
ifLL 
(LL 

authResultLL 
!=LL !
nullLL" &
)LL& '
returnLL( .

authResultLL/ 9
;LL9 :
ifMM 
(MM 
logiMM 
.MM $
GetRoleSessionFromCookieMM 1
(MM1 2
RequestMM2 9
)MM9 :
.MM: ;
ToStringMM; C
(MMC D
)MMD E
!=MMF H
$strMMI L
||MMM O
SessionMMP W
[MMW X
$strMMX `
]MM` a
==MMb d
nullMMe i
)MMi j
returnMMk q
RedirectToAction	MMr Ç
(
MMÇ É
$str
MMÉ ä
,
MMä ã
$str
MMå ì
)
MMì î
;
MMî ï
returnNN 
ViewNN 
(NN 
)NN 
;NN 
}OO 
catchPP 
(PP 
	ExceptionPP 
)PP 
{QQ 
returnRR 
RedirectToActionRR '
(RR' (
$strRR( /
,RR/ 0
$strRR1 7
)RR7 8
;RR8 9
}SS 
}UU 	
[WW 	
HttpPostWW	 
]WW 
publicXX 
ActionResultXX 
CreateXX "
(XX" #
EmployeeGestorXX# 1
employeechoferXX2 @
)XX@ A
{YY 	
tryZZ 
{[[ 
Login\\ 
logi\\ 
=\\ 
new\\  
Login\\! &
(\\& '
)\\' (
;\\( )
var]] 

authResult]] 
=]]  
AutenticarPasosRol]]! 3
(]]3 4
$num]]4 5
)]]5 6
;]]6 7
if^^ 
(^^ 

authResult^^ 
!=^^ !
null^^" &
)^^& '
return^^( .

authResult^^/ 9
;^^9 :
if__ 
(__ 
logi__ 
.__ $
GetRoleSessionFromCookie__ 1
(__1 2
Request__2 9
)__9 :
.__: ;
ToString__; C
(__C D
)__D E
!=__F H
$str__I L
||__M O
Session__P W
[__W X
$str__X `
]__` a
==__b d
null__e i
)__i j
return__k q
RedirectToAction	__r Ç
(
__Ç É
$str
__É ä
,
__ä ã
$str
__å ì
)
__ì î
;
__î ï
employeechofer`` 
.`` 

idEmployee`` )
=``* +
Session``, 3
[``3 4
$str``4 <
]``< =
.``= >
ToString``> F
(``F G
)``G H
;``H I
TimeZoneInfoaa 
boliviaTimeZoneaa ,
=aa- .
TimeZoneInfoaa/ ;
.aa; <"
FindSystemTimeZoneByIdaa< R
(aaR S
$straaS m
)aam n
;aan o
DateTimebb 
boliviaTimebb $
=bb% &
TimeZoneInfobb' 3
.bb3 4
ConvertTimebb4 ?
(bb? @
DateTimebb@ H
.bbH I
UtcNowbbI O
,bbO P
boliviaTimeZonebbQ `
)bb` a
;bba b
Usercc 
usercc 
=cc 
newcc 
Usercc  $
(cc$ %
)cc% &
;cc& '
usingdd 
(dd 
dbModelsdd 
contextdd  '
=dd( )
newdd* -
dbModelsdd. 6
(dd6 7
)dd7 8
)dd8 9
userdd: >
=dd? @
contextddA H
.ddH I
UserddI M
.ddM N
WhereddN S
(ddS T
xddT U
=>ddV X
xddY Z
.ddZ [
emaildd[ `
.dd` a
ToLowerdda h
(ddh i
)ddi j
.ddj k
Trimddk o
(ddo p
)ddp q
==ddr t
employeechofer	ddu É
.
ddÉ Ñ
email
ddÑ â
.
ddâ ä
ToLower
ddä ë
(
ddë í
)
ddí ì
.
ddì î
Trim
ddî ò
(
ddò ô
)
ddô ö
)
ddö õ
.
ddõ ú
FirstOrDefault
ddú ™
(
dd™ ´
)
dd´ ¨
;
dd¨ ≠
ifee 
(ee 
useree 
!=ee 
nullee  
)ee  !
{ff 
TempDatagg 
[gg 
$strgg #
]gg# $
=gg% &
$strgg' I
;ggI J
returnhh 
Viewhh 
(hh  
)hh  !
;hh! "
}ii 
Personjj 
personjj 
=jj 
newjj  #
Personjj$ *
(jj* +
)jj+ ,
;jj, -
usingkk 
(kk 
dbModelskk 
contextkk  '
=kk( )
newkk* -
dbModelskk. 6
(kk6 7
)kk7 8
)kk8 9
personkk: @
=kkA B
contextkkC J
.kkJ K
PersonkkK Q
.kkQ R
WherekkR W
(kkW X
xkkX Y
=>kkZ \
xkk] ^
.kk^ _
nitkk_ b
.kkb c
ToStringkkc k
(kkk l
)kkl m
==kkn p
employeechoferkkq 
.	kk Ä

idEmployee
kkÄ ä
.
kkä ã
ToString
kkã ì
(
kkì î
)
kkî ï
)
kkï ñ
.
kkñ ó
FirstOrDefault
kkó •
(
kk• ¶
)
kk¶ ß
;
kkß ®
ifll 
(ll 
personll 
==ll 
nullll "
)ll" #
{mm 
usingnn 
(nn 
dbModelsnn #
contextnn$ +
=nn, -
newnn. 1
dbModelsnn2 :
(nn: ;
)nn; <
)nn< =
{oo 
personpp 
=pp  
newpp! $
Personpp% +
(pp+ ,
)pp, -
;pp- .
personqq 
.qq 
nitqq "
=qq# $
employeechoferqq% 3
.qq3 4

idEmployeeqq4 >
.qq> ?
Trimqq? C
(qqC D
)qqD E
;qqE F
personrr 
.rr 
namerr #
=rr$ %
employeechoferrr& 4
.rr4 5
namerr5 9
.rr9 :
Trimrr: >
(rr> ?
)rr? @
;rr@ A
personss 
.ss 
lastnamess '
=ss( )
employeechoferss* 8
.ss8 9
lastnamess9 A
.ssA B
TrimssB F
(ssF G
)ssG H
;ssH I
persontt 
.tt 
phonett $
=tt% &
employeechofertt' 5
.tt5 6
phonett6 ;
.tt; <
Trimtt< @
(tt@ A
)ttA B
;ttB C
personuu 
.uu 
idRoleuu %
=uu& '
$numuu( )
;uu) *
personuu+ 1
.uu1 2
statusuu2 8
=uu9 :
$numuu; <
;uu< =
personvv 
.vv 
dateRegistervv +
=vv, -
boliviaTimevv. 9
;vv9 :
contextww 
.ww  
Personww  &
.ww& '
Addww' *
(ww* +
personww+ 1
)ww1 2
;ww2 3
contextxx 
.xx  
SaveChangesxx  +
(xx+ ,
)xx, -
;xx- .
}yy 
}zz 
else{{ 
if{{ 
({{ 
person{{ 
.{{  
status{{  &
=={{' )
$num{{* +
||{{, .
person{{/ 5
.{{5 6
idRole{{6 <
=={{= ?
$num{{@ A
){{A B
using|| 
(|| 
dbModels|| #
context||$ +
=||, -
new||. 1
dbModels||2 :
(||: ;
)||; <
)||< =
{}} 
person~~ 
.~~ 
name~~ #
=~~$ %
employeechofer~~& 4
.~~4 5
name~~5 9
.~~9 :
Trim~~: >
(~~> ?
)~~? @
;~~@ A
person 
. 
lastname '
=( )
employeechofer* 8
.8 9
lastname9 A
.A B
TrimB F
(F G
)G H
;H I
person
ÄÄ 
.
ÄÄ 
idRole
ÄÄ %
=
ÄÄ& '
$num
ÄÄ( )
;
ÄÄ) *
person
ÄÄ+ 1
.
ÄÄ1 2
status
ÄÄ2 8
=
ÄÄ9 :
$num
ÄÄ; <
;
ÄÄ< =
person
ÅÅ 
.
ÅÅ 
phone
ÅÅ $
=
ÅÅ% &
employeechofer
ÅÅ' 5
.
ÅÅ5 6
phone
ÅÅ6 ;
.
ÅÅ; <
Trim
ÅÅ< @
(
ÅÅ@ A
)
ÅÅA B
;
ÅÅB C
context
ÇÇ 
.
ÇÇ  
Entry
ÇÇ  %
(
ÇÇ% &
person
ÇÇ& ,
)
ÇÇ, -
.
ÇÇ- .
State
ÇÇ. 3
=
ÇÇ4 5
System
ÇÇ6 <
.
ÇÇ< =
Data
ÇÇ= A
.
ÇÇA B
Entity
ÇÇB H
.
ÇÇH I
EntityState
ÇÇI T
.
ÇÇT U
Modified
ÇÇU ]
;
ÇÇ] ^
context
ÉÉ 
.
ÉÉ  
SaveChanges
ÉÉ  +
(
ÉÉ+ ,
)
ÉÉ, -
;
ÉÉ- .
}
ÑÑ 
else
ÖÖ 
{
ÜÜ 
TempData
áá 
[
áá 
$str
áá %
]
áá% &
=
áá' (
$str
áá) H
;
ááH I
return
àà 
View
àà 
(
àà  
)
àà  !
;
àà! "
}
ââ 
Employee
ää 
employee
ää !
=
ää" #
new
ää$ '
Employee
ää( 0
(
ää0 1
)
ää1 2
;
ää2 3
employee
ãã 
.
ãã 
dateRegister
ãã %
=
ãã& '
boliviaTime
ãã( 3
;
ãã3 4
employee
åå 
.
åå 

idEmployee
åå #
=
åå$ %
employeechofer
åå& 4
.
åå4 5

idEmployee
åå5 ?
.
åå? @
Trim
åå@ D
(
ååD E
)
ååE F
;
ååF G
employee
çç 
.
çç 
status
çç 
=
çç  !
$num
çç" #
;
çç# $
Employee
éé 
em
éé 
=
éé 
new
éé !
Employee
éé" *
(
éé* +
)
éé+ ,
;
éé, -
using
èè 
(
èè 
dbModels
èè 
context
èè  '
=
èè( )
new
èè* -
dbModels
èè. 6
(
èè6 7
)
èè7 8
)
èè8 9
em
èè: <
=
èè= >
context
èè? F
.
èèF G
Employee
èèG O
.
èèO P
Where
èèP U
(
èèU V
x
èèV W
=>
èèX Z
x
èè[ \
.
èè\ ]

idEmployee
èè] g
.
èèg h
ToString
èèh p
(
èèp q
)
èèq r
==
èès u
employeechoferèèv Ñ
.èèÑ Ö

idEmployeeèèÖ è
.èèè ê
ToStringèèê ò
(èèò ô
)èèô ö
)èèö õ
.èèõ ú
FirstOrDefaultèèú ™
(èè™ ´
)èè´ ¨
;èè¨ ≠
if
êê 
(
êê 
em
êê 
==
êê 
null
êê 
)
êê 
using
ëë 
(
ëë 
dbModels
ëë #
context
ëë$ +
=
ëë, -
new
ëë. 1
dbModels
ëë2 :
(
ëë: ;
)
ëë; <
)
ëë< =
{
íí 
context
ìì 
.
ìì  
Employee
ìì  (
.
ìì( )
Add
ìì) ,
(
ìì, -
employee
ìì- 5
)
ìì5 6
;
ìì6 7
context
îî 
.
îî  
SaveChanges
îî  +
(
îî+ ,
)
îî, -
;
îî- .
}
ïï 
else
ññ 
if
ññ 
(
ññ 
em
ññ 
.
ññ 
status
ññ "
==
ññ# %
$num
ññ& '
)
ññ' (
using
óó 
(
óó 
dbModels
óó #
context
óó$ +
=
óó, -
new
óó. 1
dbModels
óó2 :
(
óó: ;
)
óó; <
)
óó< =
{
òò 
context
ôô 
.
ôô  
Entry
ôô  %
(
ôô% &
employee
ôô& .
)
ôô. /
.
ôô/ 0
State
ôô0 5
=
ôô6 7
System
ôô8 >
.
ôô> ?
Data
ôô? C
.
ôôC D
Entity
ôôD J
.
ôôJ K
EntityState
ôôK V
.
ôôV W
Modified
ôôW _
;
ôô_ `
context
öö 
.
öö  
SaveChanges
öö  +
(
öö+ ,
)
öö, -
;
öö- .
}
õõ 
EmployeeControl
úú 
employeeControl
úú  /
=
úú0 1
new
úú2 5
EmployeeControl
úú6 E
(
úúE F
)
úúF G
;
úúG H
string
ùù 
username
ùù 
=
ùù  !
employeeControl
ùù" 1
.
ùù1 2
GenerarUsername
ùù2 A
(
ùùA B
person
ùùB H
.
ùùH I
name
ùùI M
.
ùùM N
Trim
ùùN R
(
ùùR S
)
ùùS T
,
ùùT U
person
ùùV \
.
ùù\ ]
lastname
ùù] e
.
ùùe f
Trim
ùùf j
(
ùùj k
)
ùùk l
)
ùùl m
;
ùùm n
string
ûû 
pass
ûû 
=
ûû 
employeeControl
ûû -
.
ûû- .
GenerarPassword
ûû. =
(
ûû= >
)
ûû> ?
;
ûû? @
using
üü 
(
üü 
dbModels
üü 
context
üü  '
=
üü( )
new
üü* -
dbModels
üü. 6
(
üü6 7
)
üü7 8
)
üü8 9
{
†† 

Encriptado
°° 

encriptado
°° )
=
°°* +
new
°°, /

Encriptado
°°0 :
(
°°: ;
)
°°; <
;
°°< =
user
¢¢ 
=
¢¢ 
new
¢¢ 
User
¢¢ #
(
¢¢# $
)
¢¢$ %
;
¢¢% &
user
££ 
.
££ 

idEmployee
££ #
=
££$ %
employee
££& .
.
££. /

idEmployee
££/ 9
;
££9 :
user
§§ 
.
§§ 
username
§§ !
=
§§" #
username
§§$ ,
;
§§, -
user
•• 
.
•• 
password
•• !
=
••" #

encriptado
••$ .
.
••. /
	Encriptar
••/ 8
(
••8 9
pass
••9 =
)
••= >
;
••> ?
user
¶¶ 
.
¶¶ 

firstEntry
¶¶ #
=
¶¶$ %
$num
¶¶& '
;
¶¶' (
user
ßß 
.
ßß 
email
ßß 
=
ßß  
employeechofer
ßß! /
.
ßß/ 0
email
ßß0 5
.
ßß5 6
ToLower
ßß6 =
(
ßß= >
)
ßß> ?
.
ßß? @
Trim
ßß@ D
(
ßßD E
)
ßßE F
;
ßßF G
context
®® 
.
®® 
User
®®  
.
®®  !
Add
®®! $
(
®®$ %
user
®®% )
)
®®) *
;
®®* +
context
©© 
.
©© 
SaveChanges
©© '
(
©©' (
)
©©( )
;
©©) *
employeeControl
™™ #
.
™™# $
EnviarCorreo
™™$ 0
(
™™0 1
employeechofer
™™1 ?
.
™™? @
email
™™@ E
.
™™E F
ToLower
™™F M
(
™™M N
)
™™N O
.
™™O P
Trim
™™P T
(
™™T U
)
™™U V
,
™™V W
username
™™X `
,
™™` a
pass
™™b f
)
™™f g
;
™™g h
}
´´ 
return
¨¨ 
RedirectToAction
¨¨ '
(
¨¨' (
$str
¨¨( /
)
¨¨/ 0
;
¨¨0 1
}
≠≠ 
catch
ÆÆ 
{
ØØ 
return
∞∞ 
RedirectToAction
∞∞ '
(
∞∞' (
$str
∞∞( /
,
∞∞/ 0
$str
∞∞1 7
)
∞∞7 8
;
∞∞8 9
}
±± 
}
≤≤ 	
public
¥¥ 
ActionResult
¥¥ 
Edit
¥¥  
(
¥¥  !
string
¥¥! '
id
¥¥( *
)
¥¥* +
{
µµ 	
try
∂∂ 
{
∑∑ 
if
∏∏ 
(
∏∏ 
id
∏∏ 
==
∏∏ 
null
∏∏ 
)
∏∏ 
return
∏∏  &
RedirectToAction
∏∏' 7
(
∏∏7 8
$str
∏∏8 ?
,
∏∏? @
$str
∏∏A G
)
∏∏G H
;
∏∏H I
Login
ππ 
logi
ππ 
=
ππ 
new
ππ  
Login
ππ! &
(
ππ& '
)
ππ' (
;
ππ( )
var
∫∫ 

authResult
∫∫ 
=
∫∫   
AutenticarPasosRol
∫∫! 3
(
∫∫3 4
$num
∫∫4 5
)
∫∫5 6
;
∫∫6 7
if
ªª 
(
ªª 

authResult
ªª 
!=
ªª !
null
ªª" &
)
ªª& '
return
ªª( .

authResult
ªª/ 9
;
ªª9 :
Session
ºº 
[
ºº 
$str
ºº ,
]
ºº, -
=
ºº. /
null
ºº0 4
;
ºº4 5
Session
ºº6 =
[
ºº= >
$str
ºº> Q
]
ººQ R
=
ººS T
null
ººU Y
;
ººY Z
EmployeeGestor
ΩΩ 
employeeChofer
ΩΩ -
=
ΩΩ. /
new
ΩΩ0 3
EmployeeGestor
ΩΩ4 B
(
ΩΩB C
)
ΩΩC D
;
ΩΩD E
Employee
ææ 
employee
ææ !
=
ææ" #
new
ææ$ '
Employee
ææ( 0
(
ææ0 1
)
ææ1 2
;
ææ2 3
Person
øø 
person
øø 
=
øø 
new
øø  #
Person
øø$ *
(
øø* +
)
øø+ ,
;
øø, -
User
¿¿ 
user
¿¿ 
=
¿¿ 
new
¿¿ 
User
¿¿  $
(
¿¿$ %
)
¿¿% &
;
¿¿& '
using
¡¡ 
(
¡¡ 
dbModels
¡¡ 
context
¡¡  '
=
¡¡( )
new
¡¡* -
dbModels
¡¡. 6
(
¡¡6 7
)
¡¡7 8
)
¡¡8 9
employee
¡¡: B
=
¡¡C D
context
¡¡E L
.
¡¡L M
Employee
¡¡M U
.
¡¡U V
Where
¡¡V [
(
¡¡[ \
x
¡¡\ ]
=>
¡¡^ `
x
¡¡a b
.
¡¡b c

idEmployee
¡¡c m
.
¡¡m n
ToString
¡¡n v
(
¡¡v w
)
¡¡w x
==
¡¡y {
id
¡¡| ~
)
¡¡~ 
.¡¡ Ä
FirstOrDefault¡¡Ä é
(¡¡é è
)¡¡è ê
;¡¡ê ë
employeeChofer
¬¬ 
.
¬¬ 

idEmployee
¬¬ )
=
¬¬* +
id
¬¬, .
;
¬¬. /
using
√√ 
(
√√ 
dbModels
√√ 
context
√√  '
=
√√( )
new
√√* -
dbModels
√√. 6
(
√√6 7
)
√√7 8
)
√√8 9
person
√√: @
=
√√A B
context
√√C J
.
√√J K
Person
√√K Q
.
√√Q R
Where
√√R W
(
√√W X
x
√√X Y
=>
√√Z \
x
√√] ^
.
√√^ _
nit
√√_ b
.
√√b c
ToString
√√c k
(
√√k l
)
√√l m
==
√√n p
id
√√q s
)
√√s t
.
√√t u
FirstOrDefault√√u É
(√√É Ñ
)√√Ñ Ö
;√√Ö Ü
employeeChofer
ƒƒ 
.
ƒƒ 
phone
ƒƒ $
=
ƒƒ% &
person
ƒƒ' -
.
ƒƒ- .
phone
ƒƒ. 3
;
ƒƒ3 4
employeeChofer
≈≈ 
.
≈≈ 
name
≈≈ #
=
≈≈$ %
person
≈≈& ,
.
≈≈, -
name
≈≈- 1
;
≈≈1 2
employeeChofer
∆∆ 
.
∆∆ 
lastname
∆∆ '
=
∆∆( )
person
∆∆* 0
.
∆∆0 1
lastname
∆∆1 9
;
∆∆9 :
using
«« 
(
«« 
dbModels
«« 
context
««  '
=
««( )
new
««* -
dbModels
««. 6
(
««6 7
)
««7 8
)
««8 9
user
««: >
=
««? @
context
««A H
.
««H I
User
««I M
.
««M N
Where
««N S
(
««S T
x
««T U
=>
««V X
x
««Y Z
.
««Z [

idEmployee
««[ e
.
««e f
ToString
««f n
(
««n o
)
««o p
==
««q s
id
««t v
)
««v w
.
««w x
FirstOrDefault««x Ü
(««Ü á
)««á à
;««à â
employeeChofer
»» 
.
»» 
email
»» $
=
»»% &
user
»»' +
.
»»+ ,
email
»», 1
;
»»1 2
Session
…… 
[
…… 
$str
…… +
]
……+ ,
=
……- .
person
……/ 5
;
……5 6
Session
……7 >
[
……> ?
$str
……? S
]
……S T
=
……U V
employee
……W _
;
……_ `
Session
……a h
[
……h i
$str
……i y
]
……y z
=
……{ |
user……} Å
;……Å Ç
return
   
View
   
(
   
employeeChofer
   *
)
  * +
;
  + ,
}
ÀÀ 
catch
ÃÃ 
(
ÃÃ 
	Exception
ÃÃ 
)
ÃÃ 
{
ÕÕ 
return
ŒŒ 
RedirectToAction
ŒŒ '
(
ŒŒ' (
$str
ŒŒ( /
,
ŒŒ/ 0
$str
ŒŒ1 7
)
ŒŒ7 8
;
ŒŒ8 9
}
œœ 
}
–– 	
[
““ 	
HttpPost
““	 
]
““ 
public
”” 
ActionResult
”” 
Edit
””  
(
””  !
EmployeeGestor
””! /
employeeChofer
””0 >
)
””> ?
{
‘‘ 	
try
’’ 
{
÷÷ 
Login
◊◊ 
logi
◊◊ 
=
◊◊ 
new
◊◊  
Login
◊◊! &
(
◊◊& '
)
◊◊' (
;
◊◊( )
var
ÿÿ 

authResult
ÿÿ 
=
ÿÿ   
AutenticarPasosRol
ÿÿ! 3
(
ÿÿ3 4
$num
ÿÿ4 5
)
ÿÿ5 6
;
ÿÿ6 7
if
ŸŸ 
(
ŸŸ 

authResult
ŸŸ 
!=
ŸŸ !
null
ŸŸ" &
)
ŸŸ& '
return
ŸŸ( .

authResult
ŸŸ/ 9
;
ŸŸ9 :
Employee
⁄⁄ 
employee
⁄⁄ !
=
⁄⁄" #
(
⁄⁄$ %
Employee
⁄⁄% -
)
⁄⁄- .
Session
⁄⁄. 5
[
⁄⁄5 6
$str
⁄⁄6 J
]
⁄⁄J K
;
⁄⁄K L
Person
€€ 
person
€€ 
=
€€ 
(
€€  !
Person
€€! '
)
€€' (
Session
€€( /
[
€€/ 0
$str
€€0 C
]
€€C D
;
€€D E
User
‹‹ 
user
‹‹ 
=
‹‹ 
(
‹‹ 
User
‹‹ !
)
‹‹! "
Session
‹‹" )
[
‹‹) *
$str
‹‹* :
]
‹‹: ;
;
‹‹; <
User
›› 
validationMail
›› #
=
››$ %
new
››& )
User
››* .
(
››. /
)
››/ 0
;
››0 1
using
ﬁﬁ 
(
ﬁﬁ 
dbModels
ﬁﬁ 
context
ﬁﬁ  '
=
ﬁﬁ( )
new
ﬁﬁ* -
dbModels
ﬁﬁ. 6
(
ﬁﬁ6 7
)
ﬁﬁ7 8
)
ﬁﬁ8 9
validationMail
ﬁﬁ: H
=
ﬁﬁI J
context
ﬁﬁK R
.
ﬁﬁR S
User
ﬁﬁS W
.
ﬁﬁW X
Where
ﬁﬁX ]
(
ﬁﬁ] ^
x
ﬁﬁ^ _
=>
ﬁﬁ` b
x
ﬁﬁc d
.
ﬁﬁd e
email
ﬁﬁe j
.
ﬁﬁj k
ToLower
ﬁﬁk r
(
ﬁﬁr s
)
ﬁﬁs t
.
ﬁﬁt u
Trim
ﬁﬁu y
(
ﬁﬁy z
)
ﬁﬁz {
==
ﬁﬁ| ~
employeeChoferﬁﬁ ç
.ﬁﬁç é
emailﬁﬁé ì
.ﬁﬁì î
ToLowerﬁﬁî õ
(ﬁﬁõ ú
)ﬁﬁú ù
.ﬁﬁù û
Trimﬁﬁû ¢
(ﬁﬁ¢ £
)ﬁﬁ£ §
)ﬁﬁ§ •
.ﬁﬁ• ¶
FirstOrDefaultﬁﬁ¶ ¥
(ﬁﬁ¥ µ
)ﬁﬁµ ∂
;ﬁﬁ∂ ∑
if
ﬂﬂ 
(
ﬂﬂ 
validationMail
ﬂﬂ "
!=
ﬂﬂ# %
null
ﬂﬂ& *
&&
ﬂﬂ+ -
user
ﬂﬂ. 2
.
ﬂﬂ2 3
email
ﬂﬂ3 8
.
ﬂﬂ8 9
ToLower
ﬂﬂ9 @
(
ﬂﬂ@ A
)
ﬂﬂA B
.
ﬂﬂB C
Trim
ﬂﬂC G
(
ﬂﬂG H
)
ﬂﬂH I
!=
ﬂﬂJ L
employeeChofer
ﬂﬂM [
.
ﬂﬂ[ \
email
ﬂﬂ\ a
.
ﬂﬂa b
ToLower
ﬂﬂb i
(
ﬂﬂi j
)
ﬂﬂj k
.
ﬂﬂk l
Trim
ﬂﬂl p
(
ﬂﬂp q
)
ﬂﬂq r
)
ﬂﬂr s
{
‡‡ 
TempData
·· 
[
·· 
$str
·· #
]
··# $
=
··% &
$str
··' I
;
··I J
return
‚‚ 
View
‚‚ 
(
‚‚  
)
‚‚  !
;
‚‚! "
}
„„ 
using
‰‰ 
(
‰‰ 
dbModels
‰‰ 
context
‰‰  '
=
‰‰( )
new
‰‰* -
dbModels
‰‰. 6
(
‰‰6 7
)
‰‰7 8
)
‰‰8 9
{
ÂÂ 
person
ÊÊ 
.
ÊÊ 
name
ÊÊ 
=
ÊÊ  !
employeeChofer
ÊÊ" 0
.
ÊÊ0 1
name
ÊÊ1 5
.
ÊÊ5 6
Trim
ÊÊ6 :
(
ÊÊ: ;
)
ÊÊ; <
;
ÊÊ< =
person
ÁÁ 
.
ÁÁ 
lastname
ÁÁ #
=
ÁÁ$ %
employeeChofer
ÁÁ& 4
.
ÁÁ4 5
lastname
ÁÁ5 =
.
ÁÁ= >
Trim
ÁÁ> B
(
ÁÁB C
)
ÁÁC D
;
ÁÁD E
person
ËË 
.
ËË 
phone
ËË  
=
ËË! "
employeeChofer
ËË# 1
.
ËË1 2
phone
ËË2 7
.
ËË7 8
Trim
ËË8 <
(
ËË< =
)
ËË= >
;
ËË> ?
context
ÈÈ 
.
ÈÈ 
Entry
ÈÈ !
(
ÈÈ! "
person
ÈÈ" (
)
ÈÈ( )
.
ÈÈ) *
State
ÈÈ* /
=
ÈÈ0 1
System
ÈÈ2 8
.
ÈÈ8 9
Data
ÈÈ9 =
.
ÈÈ= >
Entity
ÈÈ> D
.
ÈÈD E
EntityState
ÈÈE P
.
ÈÈP Q
Modified
ÈÈQ Y
;
ÈÈY Z
context
ÍÍ 
.
ÍÍ 
SaveChanges
ÍÍ '
(
ÍÍ' (
)
ÍÍ( )
;
ÍÍ) *
}
ÎÎ 
using
ÏÏ 
(
ÏÏ 
dbModels
ÏÏ 
context
ÏÏ  '
=
ÏÏ( )
new
ÏÏ* -
dbModels
ÏÏ. 6
(
ÏÏ6 7
)
ÏÏ7 8
)
ÏÏ8 9
{
ÌÌ 
user
ÓÓ 
.
ÓÓ 
email
ÓÓ 
=
ÓÓ  
employeeChofer
ÓÓ! /
.
ÓÓ/ 0
email
ÓÓ0 5
.
ÓÓ5 6
ToLower
ÓÓ6 =
(
ÓÓ= >
)
ÓÓ> ?
.
ÓÓ? @
Trim
ÓÓ@ D
(
ÓÓD E
)
ÓÓE F
;
ÓÓF G
context
ÔÔ 
.
ÔÔ 
Entry
ÔÔ !
(
ÔÔ! "
user
ÔÔ" &
)
ÔÔ& '
.
ÔÔ' (
State
ÔÔ( -
=
ÔÔ. /
System
ÔÔ0 6
.
ÔÔ6 7
Data
ÔÔ7 ;
.
ÔÔ; <
Entity
ÔÔ< B
.
ÔÔB C
EntityState
ÔÔC N
.
ÔÔN O
Modified
ÔÔO W
;
ÔÔW X
context
 
.
 
SaveChanges
 '
(
' (
)
( )
;
) *
}
ÒÒ 
Session
ÚÚ 
[
ÚÚ 
$str
ÚÚ ,
]
ÚÚ, -
=
ÚÚ. /
null
ÚÚ0 4
;
ÚÚ4 5
Session
ÚÚ6 =
[
ÚÚ= >
$str
ÚÚ> Q
]
ÚÚQ R
=
ÚÚS T
null
ÚÚU Y
;
ÚÚY Z
Session
ÚÚ[ b
[
ÚÚb c
$str
ÚÚc s
]
ÚÚs t
=
ÚÚu v
null
ÚÚw {
;
ÚÚ{ |
return
ÛÛ 
RedirectToAction
ÛÛ '
(
ÛÛ' (
$str
ÛÛ( /
)
ÛÛ/ 0
;
ÛÛ0 1
}
ÙÙ 
catch
ıı 
(
ıı 
	Exception
ıı 
)
ıı 
{
ˆˆ 
return
˜˜ 
RedirectToAction
˜˜ '
(
˜˜' (
$str
˜˜( /
,
˜˜/ 0
$str
˜˜1 7
)
˜˜7 8
;
˜˜8 9
}
¯¯ 
}
˘˘ 	
public
¸¸ 
ActionResult
¸¸ 
Delete
¸¸ "
(
¸¸" #
string
¸¸# )
id
¸¸* ,
)
¸¸, -
{
˝˝ 	
try
˛˛ 
{
ˇˇ 
using
ÄÄ 
(
ÄÄ 
dbModels
ÄÄ 
context
ÄÄ  '
=
ÄÄ( )
new
ÄÄ* -
dbModels
ÄÄ. 6
(
ÄÄ6 7
)
ÄÄ7 8
)
ÄÄ8 9
{
ÅÅ 
List
ÇÇ 
<
ÇÇ 
Line
ÇÇ 
>
ÇÇ 
lines
ÇÇ $
=
ÇÇ% &
context
ÇÇ' .
.
ÇÇ. /
Line
ÇÇ/ 3
.
ÇÇ3 4
Where
ÇÇ4 9
(
ÇÇ9 :
x
ÇÇ: ;
=>
ÇÇ< >
x
ÇÇ? @
.
ÇÇ@ A
idAdmin
ÇÇA H
==
ÇÇI K
id
ÇÇL N
)
ÇÇN O
.
ÇÇO P
ToList
ÇÇP V
(
ÇÇV W
)
ÇÇW X
;
ÇÇX Y
foreach
ÉÉ 
(
ÉÉ 
var
ÉÉ  
item
ÉÉ! %
in
ÉÉ& (
lines
ÉÉ) .
)
ÉÉ. /
{
ÑÑ 
Line
ÖÖ 
line
ÖÖ !
=
ÖÖ" #
context
ÖÖ$ +
.
ÖÖ+ ,
Line
ÖÖ, 0
.
ÖÖ0 1
Where
ÖÖ1 6
(
ÖÖ6 7
x
ÖÖ7 8
=>
ÖÖ9 ;
x
ÖÖ< =
.
ÖÖ= >
nameLine
ÖÖ> F
==
ÖÖG I
item
ÖÖJ N
.
ÖÖN O
nameLine
ÖÖO W
)
ÖÖW X
.
ÖÖX Y
FirstOrDefault
ÖÖY g
(
ÖÖg h
)
ÖÖh i
;
ÖÖi j
line
ÜÜ 
.
ÜÜ 
idAdmin
ÜÜ $
=
ÜÜ% &
null
ÜÜ' +
;
ÜÜ+ ,
context
áá 
.
áá  
Entry
áá  %
(
áá% &
line
áá& *
)
áá* +
.
áá+ ,
State
áá, 1
=
áá2 3
System
áá4 :
.
áá: ;
Data
áá; ?
.
áá? @
Entity
áá@ F
.
ááF G
EntityState
ááG R
.
ááR S
Modified
ááS [
;
áá[ \
context
àà 
.
àà  
SaveChanges
àà  +
(
àà+ ,
)
àà, -
;
àà- .
}
ââ 
User
ää 
user
ää 
=
ää 
context
ää  '
.
ää' (
User
ää( ,
.
ää, -
Where
ää- 2
(
ää2 3
x
ää3 4
=>
ää5 7
x
ää8 9
.
ää9 :

idEmployee
ää: D
==
ääE G
id
ääH J
)
ääJ K
.
ääK L
FirstOrDefault
ääL Z
(
ääZ [
)
ää[ \
;
ää\ ]
context
ãã 
.
ãã 
User
ãã  
.
ãã  !
Remove
ãã! '
(
ãã' (
user
ãã( ,
)
ãã, -
;
ãã- .
Employee
åå 
employee
åå %
=
åå& '
context
åå( /
.
åå/ 0
Employee
åå0 8
.
åå8 9
Where
åå9 >
(
åå> ?
x
åå? @
=>
ååA C
x
ååD E
.
ååE F

idEmployee
ååF P
==
ååQ S
id
ååT V
)
ååV W
.
ååW X
FirstOrDefault
ååX f
(
ååf g
)
ååg h
;
ååh i
context
çç 
.
çç 
Employee
çç $
.
çç$ %
Remove
çç% +
(
çç+ ,
employee
çç, 4
)
çç4 5
;
çç5 6
Person
éé 
person
éé !
=
éé" #
context
éé$ +
.
éé+ ,
Person
éé, 2
.
éé2 3
Where
éé3 8
(
éé8 9
x
éé9 :
=>
éé; =
x
éé> ?
.
éé? @
nit
éé@ C
==
ééD F
id
ééG I
)
ééI J
.
ééJ K
FirstOrDefault
ééK Y
(
ééY Z
)
ééZ [
;
éé[ \
context
èè 
.
èè 
Person
èè "
.
èè" #
Remove
èè# )
(
èè) *
person
èè* 0
)
èè0 1
;
èè1 2
context
êê 
.
êê 
SaveChanges
êê '
(
êê' (
)
êê( )
;
êê) *
}
ëë 
return
íí 
RedirectToAction
íí '
(
íí' (
$str
íí( /
)
íí/ 0
;
íí0 1
}
ìì 
catch
îî 
(
îî 
	Exception
îî 
)
îî 
{
ïï 
return
ññ 
RedirectToAction
ññ '
(
ññ' (
$str
ññ( /
,
ññ/ 0
$str
ññ1 7
)
ññ7 8
;
ññ8 9
}
óó 
}
ôô 	
public
öö 
ActionResult
öö  
AutenticarPasosRol
öö .
(
öö. /
int
öö/ 2
role
öö3 7
)
öö7 8
{
õõ 	
if
úú 
(
úú 
!
úú 
User
úú 
.
úú 
Identity
úú 
.
úú 
IsAuthenticated
úú .
)
úú. /
return
úú0 6
RedirectToAction
úú7 G
(
úúG H
$str
úúH O
,
úúO P
$str
úúQ W
)
úúW X
;
úúX Y
Login
ùù 
logi
ùù 
=
ùù 
new
ùù 
Login
ùù "
(
ùù" #
)
ùù# $
;
ùù$ %
int
ûû 
?
ûû 
roleSession
ûû 
=
ûû 
logi
ûû #
.
ûû# $&
GetRoleSessionFromCookie
ûû$ <
(
ûû< =
Request
ûû= D
)
ûûD E
;
ûûE F
if
üü 
(
üü 
roleSession
üü 
==
üü 
null
üü #
||
üü$ &
roleSession
üü' 2
!=
üü3 5
role
üü6 :
)
üü: ;
return
üü< B
RedirectToAction
üüC S
(
üüS T
$str
üüT [
,
üü[ \
$str
üü] c
)
üüc d
;
üüd e
return
†† 
null
†† 
;
†† 
}
°° 	
public
¢¢ 
ActionResult
¢¢ 
AsignarGestor
¢¢ )
(
¢¢) *
string
¢¢* 0
nameLine
¢¢1 9
)
¢¢9 :
{
££ 	
try
§§ 
{
•• 
var
¶¶ 

authResult
¶¶ 
=
¶¶   
AutenticarPasosRol
¶¶! 3
(
¶¶3 4
$num
¶¶4 5
)
¶¶5 6
;
¶¶6 7
if
ßß 
(
ßß 

authResult
ßß 
!=
ßß !
null
ßß" &
)
ßß& '
return
ßß( .

authResult
ßß/ 9
;
ßß9 :
ViewBag
®® 
.
®® 
NameLine
®®  
=
®®! "
nameLine
®®# +
;
®®+ ,
using
©© 
(
©© 
dbModels
©© 
context
©©  '
=
©©( )
new
©©* -
dbModels
©©. 6
(
©©6 7
)
©©7 8
)
©©8 9
{
™™ 
List
´´ 
<
´´ 
Person
´´ 
>
´´  
person
´´! '
=
´´( )
context
´´* 1
.
´´1 2
Person
´´2 8
.
´´8 9
Where
´´9 >
(
´´> ?
x
´´? @
=>
´´A C
x
´´D E
.
´´E F
idRole
´´F L
==
´´M O
$num
´´P Q
&&
´´R T
x
´´U V
.
´´V W
status
´´W ]
==
´´^ `
$num
´´a b
)
´´b c
.
´´c d
ToList
´´d j
(
´´j k
)
´´k l
;
´´l m
return
¨¨ 
View
¨¨ 
(
¨¨  
person
¨¨  &
)
¨¨& '
;
¨¨' (
}
≠≠ 
}
ÆÆ 
catch
ØØ 
(
ØØ 
	Exception
ØØ 
)
ØØ 
{
∞∞ 
return
±± 
RedirectToAction
±± '
(
±±' (
$str
±±( /
,
±±/ 0
$str
±±1 7
)
±±7 8
;
±±8 9
}
≤≤ 
}
¥¥ 	
public
µµ 
ActionResult
µµ 
AsignarGestors
µµ *
(
µµ* +
string
µµ+ 1
nameLine
µµ2 :
,
µµ: ;
string
µµ< B
id
µµC E
)
µµE F
{
∂∂ 	
try
∑∑ 
{
∏∏ 
var
ππ 

authResult
ππ 
=
ππ   
AutenticarPasosRol
ππ! 3
(
ππ3 4
$num
ππ4 5
)
ππ5 6
;
ππ6 7
if
∫∫ 
(
∫∫ 

authResult
∫∫ 
!=
∫∫ !
null
∫∫" &
)
∫∫& '
return
∫∫( .

authResult
∫∫/ 9
;
∫∫9 :
using
ªª 
(
ªª 
dbModels
ªª 
context
ªª  '
=
ªª( )
new
ªª* -
dbModels
ªª. 6
(
ªª6 7
)
ªª7 8
)
ªª8 9
{
ºº 
Line
ΩΩ 
line
ΩΩ 
=
ΩΩ 
context
ΩΩ  '
.
ΩΩ' (
Line
ΩΩ( ,
.
ΩΩ, -
Where
ΩΩ- 2
(
ΩΩ2 3
x
ΩΩ3 4
=>
ΩΩ5 7
x
ΩΩ8 9
.
ΩΩ9 :
nameLine
ΩΩ: B
==
ΩΩC E
nameLine
ΩΩF N
)
ΩΩN O
.
ΩΩO P
FirstOrDefault
ΩΩP ^
(
ΩΩ^ _
)
ΩΩ_ `
;
ΩΩ` a
Person
ææ 
person
ææ !
=
ææ" #
context
ææ$ +
.
ææ+ ,
Person
ææ, 2
.
ææ2 3
Where
ææ3 8
(
ææ8 9
x
ææ9 :
=>
ææ; =
x
ææ> ?
.
ææ? @
nit
ææ@ C
==
ææD F
id
ææG I
&&
ææJ L
x
ææM N
.
ææN O
idRole
ææO U
==
ææV X
$num
ææY Z
&&
ææ[ ]
x
ææ^ _
.
ææ_ `
status
ææ` f
==
ææg i
$num
ææj k
)
ææk l
.
ææl m
FirstOrDefault
ææm {
(
ææ{ |
)
ææ| }
;
ææ} ~
if
øø 
(
øø 
person
øø 
!=
øø !
null
øø" &
&&
øø' )
line
øø+ /
!=
øø0 2
null
øø3 7
)
øø7 8
{
¿¿ 
line
¡¡ 
.
¡¡ 
idAdmin
¡¡ $
=
¡¡% &
id
¡¡' )
;
¡¡) *
context
¬¬ 
.
¬¬  
Entry
¬¬  %
(
¬¬% &
line
¬¬& *
)
¬¬* +
.
¬¬+ ,
State
¬¬, 1
=
¬¬2 3
System
¬¬4 :
.
¬¬: ;
Data
¬¬; ?
.
¬¬? @
Entity
¬¬@ F
.
¬¬F G
EntityState
¬¬G R
.
¬¬R S
Modified
¬¬S [
;
¬¬[ \
context
√√ 
.
√√  
SaveChanges
√√  +
(
√√+ ,
)
√√, -
;
√√- .
}
ƒƒ 
}
≈≈ 
return
∆∆ 
RedirectToAction
∆∆ '
(
∆∆' (
$str
∆∆( /
,
∆∆/ 0
$str
∆∆1 7
)
∆∆7 8
;
∆∆8 9
}
«« 
catch
»» 
(
»» 
	Exception
»» 
)
»» 
{
…… 
return
   
RedirectToAction
   '
(
  ' (
$str
  ( /
,
  / 0
$str
  1 7
)
  7 8
;
  8 9
}
ÀÀ 
}
ÃÃ 	
public
ÕÕ 
ActionResult
ÕÕ 
QuitarGestor
ÕÕ (
(
ÕÕ( )
string
ÕÕ) /
nameLine
ÕÕ0 8
)
ÕÕ8 9
{
ŒŒ 	
try
œœ 
{
–– 
var
—— 

authResult
—— 
=
——   
AutenticarPasosRol
——! 3
(
——3 4
$num
——4 5
)
——5 6
;
——6 7
if
““ 
(
““ 

authResult
““ 
!=
““ !
null
““" &
)
““& '
return
““( .

authResult
““/ 9
;
““9 :
using
”” 
(
”” 
dbModels
”” 
context
””  '
=
””( )
new
””* -
dbModels
””. 6
(
””6 7
)
””7 8
)
””8 9
{
‘‘ 
Line
’’ 
line
’’ 
=
’’ 
context
’’  '
.
’’' (
Line
’’( ,
.
’’, -
Where
’’- 2
(
’’2 3
x
’’3 4
=>
’’5 7
x
’’8 9
.
’’9 :
nameLine
’’: B
==
’’C E
nameLine
’’F N
)
’’N O
.
’’O P
FirstOrDefault
’’P ^
(
’’^ _
)
’’_ `
;
’’` a
line
÷÷ 
.
÷÷ 
idAdmin
÷÷  
=
÷÷! "
null
÷÷# '
;
÷÷' (
context
◊◊ 
.
◊◊ 
Entry
◊◊ !
(
◊◊! "
line
◊◊" &
)
◊◊& '
.
◊◊' (
State
◊◊( -
=
◊◊. /
System
◊◊0 6
.
◊◊6 7
Data
◊◊7 ;
.
◊◊; <
Entity
◊◊< B
.
◊◊B C
EntityState
◊◊C N
.
◊◊N O
Modified
◊◊O W
;
◊◊W X
context
ÿÿ 
.
ÿÿ 
SaveChanges
ÿÿ '
(
ÿÿ' (
)
ÿÿ( )
;
ÿÿ) *
}
ŸŸ 
return
⁄⁄ 
RedirectToAction
⁄⁄ '
(
⁄⁄' (
$str
⁄⁄( /
,
⁄⁄/ 0
$str
⁄⁄0 6
)
⁄⁄6 7
;
⁄⁄7 8
}
€€ 
catch
‹‹ 
(
‹‹ 
	Exception
‹‹ 
)
‹‹ 
{
›› 
return
ﬁﬁ 
RedirectToAction
ﬁﬁ '
(
ﬁﬁ' (
$str
ﬁﬁ( /
,
ﬁﬁ/ 0
$str
ﬁﬁ1 7
)
ﬁﬁ7 8
;
ﬁﬁ8 9
}
ﬂﬂ 
}
‡‡ 	
}
·· 
}‚‚ Ç
HC:\Users\Ferna\Desktop\ProyectoControlLineaBus\App_Start\FilterConfig.cs
	namespace 	#
ProyectoControlLineaBus
 !
{ 
public 

class 
FilterConfig 
{ 
public 
static 
void !
RegisterGlobalFilters 0
(0 1"
GlobalFilterCollection1 G
filtersH O
)O P
{		 	
filters

 
.

 
Add

 
(

 
new

  
HandleErrorAttribute

 0
(

0 1
)

1 2
)

2 3
;

3 4
} 	
} 
} ≤
HC:\Users\Ferna\Desktop\ProyectoControlLineaBus\App_Start\BundleConfig.cs
	namespace 	#
ProyectoControlLineaBus
 !
{ 
public 

class 
BundleConfig 
{ 
public		 
static		 
void		 
RegisterBundles		 *
(		* +
BundleCollection		+ ;
bundles		< C
)		C D
{

 	
bundles 
. 
Add 
( 
new 
ScriptBundle (
(( )
$str) ;
); <
.< =
Include= D
(D E
$str 7
)7 8
)8 9
;9 :
bundles 
. 
Add 
( 
new 
ScriptBundle (
(( )
$str) >
)> ?
.? @
Include@ G
(G H
$str 4
)4 5
)5 6
;6 7
bundles 
. 
Add 
( 
new 
ScriptBundle (
(( )
$str) >
)> ?
.? @
Include@ G
(G H
$str /
)/ 0
)0 1
;1 2
bundles 
. 
Add 
( 
new 
Bundle "
(" #
$str# 8
)8 9
.9 :
Include: A
(A B
$str .
). /
)/ 0
;0 1
bundles 
. 
Add 
( 
new 
StyleBundle '
(' (
$str( 7
)7 8
.8 9
Include9 @
(@ A
$str /
,/ 0
$str *
)* +
)+ ,
;, -
} 	
} 
} 